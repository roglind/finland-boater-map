var $y=Object.defineProperty;var qy=(_,y,b)=>y in _?$y(_,y,{enumerable:!0,configurable:!0,writable:!0,value:b}):_[y]=b;var Jo=(_,y,b)=>qy(_,typeof y!="symbol"?y+"":y,b);(function(){const y=document.createElement("link").relList;if(y&&y.supports&&y.supports("modulepreload"))return;for(const D of document.querySelectorAll('link[rel="modulepreload"]'))C(D);new MutationObserver(D=>{for(const F of D)if(F.type==="childList")for(const T of F.addedNodes)T.tagName==="LINK"&&T.rel==="modulepreload"&&C(T)}).observe(document,{childList:!0,subtree:!0});function b(D){const F={};return D.integrity&&(F.integrity=D.integrity),D.referrerPolicy&&(F.referrerPolicy=D.referrerPolicy),D.crossOrigin==="use-credentials"?F.credentials="include":D.crossOrigin==="anonymous"?F.credentials="omit":F.credentials="same-origin",F}function C(D){if(D.ep)return;D.ep=!0;const F=b(D);fetch(D.href,F)}})();function Om(_){return _&&_.__esModule&&Object.prototype.hasOwnProperty.call(_,"default")?_.default:_}var Yf={exports:{}},Fd={},Jf={exports:{}},vr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pg;function Zy(){if(pg)return vr;pg=1;var _=Symbol.for("react.element"),y=Symbol.for("react.portal"),b=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),D=Symbol.for("react.profiler"),F=Symbol.for("react.provider"),T=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),X=Symbol.for("react.suspense"),ae=Symbol.for("react.memo"),Q=Symbol.for("react.lazy"),Y=Symbol.iterator;function Z(xe){return xe===null||typeof xe!="object"?null:(xe=Y&&xe[Y]||xe["@@iterator"],typeof xe=="function"?xe:null)}var Ie={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Re=Object.assign,Pe={};function Le(xe,Ne,Xt){this.props=xe,this.context=Ne,this.refs=Pe,this.updater=Xt||Ie}Le.prototype.isReactComponent={},Le.prototype.setState=function(xe,Ne){if(typeof xe!="object"&&typeof xe!="function"&&xe!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,xe,Ne,"setState")},Le.prototype.forceUpdate=function(xe){this.updater.enqueueForceUpdate(this,xe,"forceUpdate")};function De(){}De.prototype=Le.prototype;function ze(xe,Ne,Xt){this.props=xe,this.context=Ne,this.refs=Pe,this.updater=Xt||Ie}var $e=ze.prototype=new De;$e.constructor=ze,Re($e,Le.prototype),$e.isPureReactComponent=!0;var et=Array.isArray,Je=Object.prototype.hasOwnProperty,He={current:null},je={key:!0,ref:!0,__self:!0,__source:!0};function ut(xe,Ne,Xt){var Yt,ir={},hr=null,cr=null;if(Ne!=null)for(Yt in Ne.ref!==void 0&&(cr=Ne.ref),Ne.key!==void 0&&(hr=""+Ne.key),Ne)Je.call(Ne,Yt)&&!je.hasOwnProperty(Yt)&&(ir[Yt]=Ne[Yt]);var lr=arguments.length-2;if(lr===1)ir.children=Xt;else if(1<lr){for(var Ir=Array(lr),mn=0;mn<lr;mn++)Ir[mn]=arguments[mn+2];ir.children=Ir}if(xe&&xe.defaultProps)for(Yt in lr=xe.defaultProps,lr)ir[Yt]===void 0&&(ir[Yt]=lr[Yt]);return{$$typeof:_,type:xe,key:hr,ref:cr,props:ir,_owner:He.current}}function Ve(xe,Ne){return{$$typeof:_,type:xe.type,key:Ne,ref:xe.ref,props:xe.props,_owner:xe._owner}}function tr(xe){return typeof xe=="object"&&xe!==null&&xe.$$typeof===_}function vt(xe){var Ne={"=":"=0",":":"=2"};return"$"+xe.replace(/[=:]/g,function(Xt){return Ne[Xt]})}var ar=/\/+/g;function Rt(xe,Ne){return typeof xe=="object"&&xe!==null&&xe.key!=null?vt(""+xe.key):Ne.toString(36)}function Bt(xe,Ne,Xt,Yt,ir){var hr=typeof xe;(hr==="undefined"||hr==="boolean")&&(xe=null);var cr=!1;if(xe===null)cr=!0;else switch(hr){case"string":case"number":cr=!0;break;case"object":switch(xe.$$typeof){case _:case y:cr=!0}}if(cr)return cr=xe,ir=ir(cr),xe=Yt===""?"."+Rt(cr,0):Yt,et(ir)?(Xt="",xe!=null&&(Xt=xe.replace(ar,"$&/")+"/"),Bt(ir,Ne,Xt,"",function(mn){return mn})):ir!=null&&(tr(ir)&&(ir=Ve(ir,Xt+(!ir.key||cr&&cr.key===ir.key?"":(""+ir.key).replace(ar,"$&/")+"/")+xe)),Ne.push(ir)),1;if(cr=0,Yt=Yt===""?".":Yt+":",et(xe))for(var lr=0;lr<xe.length;lr++){hr=xe[lr];var Ir=Yt+Rt(hr,lr);cr+=Bt(hr,Ne,Xt,Ir,ir)}else if(Ir=Z(xe),typeof Ir=="function")for(xe=Ir.call(xe),lr=0;!(hr=xe.next()).done;)hr=hr.value,Ir=Yt+Rt(hr,lr++),cr+=Bt(hr,Ne,Xt,Ir,ir);else if(hr==="object")throw Ne=String(xe),Error("Objects are not valid as a React child (found: "+(Ne==="[object Object]"?"object with keys {"+Object.keys(xe).join(", ")+"}":Ne)+"). If you meant to render a collection of children, use an array instead.");return cr}function $r(xe,Ne,Xt){if(xe==null)return xe;var Yt=[],ir=0;return Bt(xe,Yt,"","",function(hr){return Ne.call(Xt,hr,ir++)}),Yt}function Or(xe){if(xe._status===-1){var Ne=xe._result;Ne=Ne(),Ne.then(function(Xt){(xe._status===0||xe._status===-1)&&(xe._status=1,xe._result=Xt)},function(Xt){(xe._status===0||xe._status===-1)&&(xe._status=2,xe._result=Xt)}),xe._status===-1&&(xe._status=0,xe._result=Ne)}if(xe._status===1)return xe._result.default;throw xe._result}var Ht={current:null},lt={transition:null},Pt={ReactCurrentDispatcher:Ht,ReactCurrentBatchConfig:lt,ReactCurrentOwner:He};function ft(){throw Error("act(...) is not supported in production builds of React.")}return vr.Children={map:$r,forEach:function(xe,Ne,Xt){$r(xe,function(){Ne.apply(this,arguments)},Xt)},count:function(xe){var Ne=0;return $r(xe,function(){Ne++}),Ne},toArray:function(xe){return $r(xe,function(Ne){return Ne})||[]},only:function(xe){if(!tr(xe))throw Error("React.Children.only expected to receive a single React element child.");return xe}},vr.Component=Le,vr.Fragment=b,vr.Profiler=D,vr.PureComponent=ze,vr.StrictMode=C,vr.Suspense=X,vr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Pt,vr.act=ft,vr.cloneElement=function(xe,Ne,Xt){if(xe==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+xe+".");var Yt=Re({},xe.props),ir=xe.key,hr=xe.ref,cr=xe._owner;if(Ne!=null){if(Ne.ref!==void 0&&(hr=Ne.ref,cr=He.current),Ne.key!==void 0&&(ir=""+Ne.key),xe.type&&xe.type.defaultProps)var lr=xe.type.defaultProps;for(Ir in Ne)Je.call(Ne,Ir)&&!je.hasOwnProperty(Ir)&&(Yt[Ir]=Ne[Ir]===void 0&&lr!==void 0?lr[Ir]:Ne[Ir])}var Ir=arguments.length-2;if(Ir===1)Yt.children=Xt;else if(1<Ir){lr=Array(Ir);for(var mn=0;mn<Ir;mn++)lr[mn]=arguments[mn+2];Yt.children=lr}return{$$typeof:_,type:xe.type,key:ir,ref:hr,props:Yt,_owner:cr}},vr.createContext=function(xe){return xe={$$typeof:T,_currentValue:xe,_currentValue2:xe,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},xe.Provider={$$typeof:F,_context:xe},xe.Consumer=xe},vr.createElement=ut,vr.createFactory=function(xe){var Ne=ut.bind(null,xe);return Ne.type=xe,Ne},vr.createRef=function(){return{current:null}},vr.forwardRef=function(xe){return{$$typeof:h,render:xe}},vr.isValidElement=tr,vr.lazy=function(xe){return{$$typeof:Q,_payload:{_status:-1,_result:xe},_init:Or}},vr.memo=function(xe,Ne){return{$$typeof:ae,type:xe,compare:Ne===void 0?null:Ne}},vr.startTransition=function(xe){var Ne=lt.transition;lt.transition={};try{xe()}finally{lt.transition=Ne}},vr.unstable_act=ft,vr.useCallback=function(xe,Ne){return Ht.current.useCallback(xe,Ne)},vr.useContext=function(xe){return Ht.current.useContext(xe)},vr.useDebugValue=function(){},vr.useDeferredValue=function(xe){return Ht.current.useDeferredValue(xe)},vr.useEffect=function(xe,Ne){return Ht.current.useEffect(xe,Ne)},vr.useId=function(){return Ht.current.useId()},vr.useImperativeHandle=function(xe,Ne,Xt){return Ht.current.useImperativeHandle(xe,Ne,Xt)},vr.useInsertionEffect=function(xe,Ne){return Ht.current.useInsertionEffect(xe,Ne)},vr.useLayoutEffect=function(xe,Ne){return Ht.current.useLayoutEffect(xe,Ne)},vr.useMemo=function(xe,Ne){return Ht.current.useMemo(xe,Ne)},vr.useReducer=function(xe,Ne,Xt){return Ht.current.useReducer(xe,Ne,Xt)},vr.useRef=function(xe){return Ht.current.useRef(xe)},vr.useState=function(xe){return Ht.current.useState(xe)},vr.useSyncExternalStore=function(xe,Ne,Xt){return Ht.current.useSyncExternalStore(xe,Ne,Xt)},vr.useTransition=function(){return Ht.current.useTransition()},vr.version="18.3.1",vr}var fg;function Nm(){return fg||(fg=1,Jf.exports=Zy()),Jf.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mg;function Gy(){if(mg)return Fd;mg=1;var _=Nm(),y=Symbol.for("react.element"),b=Symbol.for("react.fragment"),C=Object.prototype.hasOwnProperty,D=_.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,F={key:!0,ref:!0,__self:!0,__source:!0};function T(h,X,ae){var Q,Y={},Z=null,Ie=null;ae!==void 0&&(Z=""+ae),X.key!==void 0&&(Z=""+X.key),X.ref!==void 0&&(Ie=X.ref);for(Q in X)C.call(X,Q)&&!F.hasOwnProperty(Q)&&(Y[Q]=X[Q]);if(h&&h.defaultProps)for(Q in X=h.defaultProps,X)Y[Q]===void 0&&(Y[Q]=X[Q]);return{$$typeof:y,type:h,key:Z,ref:Ie,props:Y,_owner:D.current}}return Fd.Fragment=b,Fd.jsx=T,Fd.jsxs=T,Fd}var gg;function Hy(){return gg||(gg=1,Yf.exports=Gy()),Yf.exports}var at=Hy(),Xr=Nm();const Ky=Om(Xr);var Yp={},Qf={exports:{}},Fs={},em={exports:{}},tm={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yg;function Wy(){return yg||(yg=1,(function(_){function y(lt,Pt){var ft=lt.length;lt.push(Pt);e:for(;0<ft;){var xe=ft-1>>>1,Ne=lt[xe];if(0<D(Ne,Pt))lt[xe]=Pt,lt[ft]=Ne,ft=xe;else break e}}function b(lt){return lt.length===0?null:lt[0]}function C(lt){if(lt.length===0)return null;var Pt=lt[0],ft=lt.pop();if(ft!==Pt){lt[0]=ft;e:for(var xe=0,Ne=lt.length,Xt=Ne>>>1;xe<Xt;){var Yt=2*(xe+1)-1,ir=lt[Yt],hr=Yt+1,cr=lt[hr];if(0>D(ir,ft))hr<Ne&&0>D(cr,ir)?(lt[xe]=cr,lt[hr]=ft,xe=hr):(lt[xe]=ir,lt[Yt]=ft,xe=Yt);else if(hr<Ne&&0>D(cr,ft))lt[xe]=cr,lt[hr]=ft,xe=hr;else break e}}return Pt}function D(lt,Pt){var ft=lt.sortIndex-Pt.sortIndex;return ft!==0?ft:lt.id-Pt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var F=performance;_.unstable_now=function(){return F.now()}}else{var T=Date,h=T.now();_.unstable_now=function(){return T.now()-h}}var X=[],ae=[],Q=1,Y=null,Z=3,Ie=!1,Re=!1,Pe=!1,Le=typeof setTimeout=="function"?setTimeout:null,De=typeof clearTimeout=="function"?clearTimeout:null,ze=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function $e(lt){for(var Pt=b(ae);Pt!==null;){if(Pt.callback===null)C(ae);else if(Pt.startTime<=lt)C(ae),Pt.sortIndex=Pt.expirationTime,y(X,Pt);else break;Pt=b(ae)}}function et(lt){if(Pe=!1,$e(lt),!Re)if(b(X)!==null)Re=!0,Or(Je);else{var Pt=b(ae);Pt!==null&&Ht(et,Pt.startTime-lt)}}function Je(lt,Pt){Re=!1,Pe&&(Pe=!1,De(ut),ut=-1),Ie=!0;var ft=Z;try{for($e(Pt),Y=b(X);Y!==null&&(!(Y.expirationTime>Pt)||lt&&!vt());){var xe=Y.callback;if(typeof xe=="function"){Y.callback=null,Z=Y.priorityLevel;var Ne=xe(Y.expirationTime<=Pt);Pt=_.unstable_now(),typeof Ne=="function"?Y.callback=Ne:Y===b(X)&&C(X),$e(Pt)}else C(X);Y=b(X)}if(Y!==null)var Xt=!0;else{var Yt=b(ae);Yt!==null&&Ht(et,Yt.startTime-Pt),Xt=!1}return Xt}finally{Y=null,Z=ft,Ie=!1}}var He=!1,je=null,ut=-1,Ve=5,tr=-1;function vt(){return!(_.unstable_now()-tr<Ve)}function ar(){if(je!==null){var lt=_.unstable_now();tr=lt;var Pt=!0;try{Pt=je(!0,lt)}finally{Pt?Rt():(He=!1,je=null)}}else He=!1}var Rt;if(typeof ze=="function")Rt=function(){ze(ar)};else if(typeof MessageChannel<"u"){var Bt=new MessageChannel,$r=Bt.port2;Bt.port1.onmessage=ar,Rt=function(){$r.postMessage(null)}}else Rt=function(){Le(ar,0)};function Or(lt){je=lt,He||(He=!0,Rt())}function Ht(lt,Pt){ut=Le(function(){lt(_.unstable_now())},Pt)}_.unstable_IdlePriority=5,_.unstable_ImmediatePriority=1,_.unstable_LowPriority=4,_.unstable_NormalPriority=3,_.unstable_Profiling=null,_.unstable_UserBlockingPriority=2,_.unstable_cancelCallback=function(lt){lt.callback=null},_.unstable_continueExecution=function(){Re||Ie||(Re=!0,Or(Je))},_.unstable_forceFrameRate=function(lt){0>lt||125<lt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ve=0<lt?Math.floor(1e3/lt):5},_.unstable_getCurrentPriorityLevel=function(){return Z},_.unstable_getFirstCallbackNode=function(){return b(X)},_.unstable_next=function(lt){switch(Z){case 1:case 2:case 3:var Pt=3;break;default:Pt=Z}var ft=Z;Z=Pt;try{return lt()}finally{Z=ft}},_.unstable_pauseExecution=function(){},_.unstable_requestPaint=function(){},_.unstable_runWithPriority=function(lt,Pt){switch(lt){case 1:case 2:case 3:case 4:case 5:break;default:lt=3}var ft=Z;Z=lt;try{return Pt()}finally{Z=ft}},_.unstable_scheduleCallback=function(lt,Pt,ft){var xe=_.unstable_now();switch(typeof ft=="object"&&ft!==null?(ft=ft.delay,ft=typeof ft=="number"&&0<ft?xe+ft:xe):ft=xe,lt){case 1:var Ne=-1;break;case 2:Ne=250;break;case 5:Ne=1073741823;break;case 4:Ne=1e4;break;default:Ne=5e3}return Ne=ft+Ne,lt={id:Q++,callback:Pt,priorityLevel:lt,startTime:ft,expirationTime:Ne,sortIndex:-1},ft>xe?(lt.sortIndex=ft,y(ae,lt),b(X)===null&&lt===b(ae)&&(Pe?(De(ut),ut=-1):Pe=!0,Ht(et,ft-xe))):(lt.sortIndex=Ne,y(X,lt),Re||Ie||(Re=!0,Or(Je))),lt},_.unstable_shouldYield=vt,_.unstable_wrapCallback=function(lt){var Pt=Z;return function(){var ft=Z;Z=Pt;try{return lt.apply(this,arguments)}finally{Z=ft}}}})(tm)),tm}var _g;function Xy(){return _g||(_g=1,em.exports=Wy()),em.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vg;function Yy(){if(vg)return Fs;vg=1;var _=Nm(),y=Xy();function b(i){for(var a="https://reactjs.org/docs/error-decoder.html?invariant="+i,d=1;d<arguments.length;d++)a+="&args[]="+encodeURIComponent(arguments[d]);return"Minified React error #"+i+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var C=new Set,D={};function F(i,a){T(i,a),T(i+"Capture",a)}function T(i,a){for(D[i]=a,i=0;i<a.length;i++)C.add(a[i])}var h=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),X=Object.prototype.hasOwnProperty,ae=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Q={},Y={};function Z(i){return X.call(Y,i)?!0:X.call(Q,i)?!1:ae.test(i)?Y[i]=!0:(Q[i]=!0,!1)}function Ie(i,a,d,v){if(d!==null&&d.type===0)return!1;switch(typeof a){case"function":case"symbol":return!0;case"boolean":return v?!1:d!==null?!d.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function Re(i,a,d,v){if(a===null||typeof a>"u"||Ie(i,a,d,v))return!0;if(v)return!1;if(d!==null)switch(d.type){case 3:return!a;case 4:return a===!1;case 5:return isNaN(a);case 6:return isNaN(a)||1>a}return!1}function Pe(i,a,d,v,I,M,$){this.acceptsBooleans=a===2||a===3||a===4,this.attributeName=v,this.attributeNamespace=I,this.mustUseProperty=d,this.propertyName=i,this.type=a,this.sanitizeURL=M,this.removeEmptyString=$}var Le={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){Le[i]=new Pe(i,0,!1,i,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var a=i[0];Le[a]=new Pe(a,1,!1,i[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(i){Le[i]=new Pe(i,2,!1,i.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){Le[i]=new Pe(i,2,!1,i,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){Le[i]=new Pe(i,3,!1,i.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(i){Le[i]=new Pe(i,3,!0,i,null,!1,!1)}),["capture","download"].forEach(function(i){Le[i]=new Pe(i,4,!1,i,null,!1,!1)}),["cols","rows","size","span"].forEach(function(i){Le[i]=new Pe(i,6,!1,i,null,!1,!1)}),["rowSpan","start"].forEach(function(i){Le[i]=new Pe(i,5,!1,i.toLowerCase(),null,!1,!1)});var De=/[\-:]([a-z])/g;function ze(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var a=i.replace(De,ze);Le[a]=new Pe(a,1,!1,i,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var a=i.replace(De,ze);Le[a]=new Pe(a,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(i){var a=i.replace(De,ze);Le[a]=new Pe(a,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(i){Le[i]=new Pe(i,1,!1,i.toLowerCase(),null,!1,!1)}),Le.xlinkHref=new Pe("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(i){Le[i]=new Pe(i,1,!1,i.toLowerCase(),null,!0,!0)});function $e(i,a,d,v){var I=Le.hasOwnProperty(a)?Le[a]:null;(I!==null?I.type!==0:v||!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(Re(a,d,I,v)&&(d=null),v||I===null?Z(a)&&(d===null?i.removeAttribute(a):i.setAttribute(a,""+d)):I.mustUseProperty?i[I.propertyName]=d===null?I.type===3?!1:"":d:(a=I.attributeName,v=I.attributeNamespace,d===null?i.removeAttribute(a):(I=I.type,d=I===3||I===4&&d===!0?"":""+d,v?i.setAttributeNS(v,a,d):i.setAttribute(a,d))))}var et=_.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Je=Symbol.for("react.element"),He=Symbol.for("react.portal"),je=Symbol.for("react.fragment"),ut=Symbol.for("react.strict_mode"),Ve=Symbol.for("react.profiler"),tr=Symbol.for("react.provider"),vt=Symbol.for("react.context"),ar=Symbol.for("react.forward_ref"),Rt=Symbol.for("react.suspense"),Bt=Symbol.for("react.suspense_list"),$r=Symbol.for("react.memo"),Or=Symbol.for("react.lazy"),Ht=Symbol.for("react.offscreen"),lt=Symbol.iterator;function Pt(i){return i===null||typeof i!="object"?null:(i=lt&&i[lt]||i["@@iterator"],typeof i=="function"?i:null)}var ft=Object.assign,xe;function Ne(i){if(xe===void 0)try{throw Error()}catch(d){var a=d.stack.trim().match(/\n( *(at )?)/);xe=a&&a[1]||""}return`
`+xe+i}var Xt=!1;function Yt(i,a){if(!i||Xt)return"";Xt=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(a)if(a=function(){throw Error()},Object.defineProperty(a.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(a,[])}catch(Ce){var v=Ce}Reflect.construct(i,[],a)}else{try{a.call()}catch(Ce){v=Ce}i.call(a.prototype)}else{try{throw Error()}catch(Ce){v=Ce}i()}}catch(Ce){if(Ce&&v&&typeof Ce.stack=="string"){for(var I=Ce.stack.split(`
`),M=v.stack.split(`
`),$=I.length-1,oe=M.length-1;1<=$&&0<=oe&&I[$]!==M[oe];)oe--;for(;1<=$&&0<=oe;$--,oe--)if(I[$]!==M[oe]){if($!==1||oe!==1)do if($--,oe--,0>oe||I[$]!==M[oe]){var pe=`
`+I[$].replace(" at new "," at ");return i.displayName&&pe.includes("<anonymous>")&&(pe=pe.replace("<anonymous>",i.displayName)),pe}while(1<=$&&0<=oe);break}}}finally{Xt=!1,Error.prepareStackTrace=d}return(i=i?i.displayName||i.name:"")?Ne(i):""}function ir(i){switch(i.tag){case 5:return Ne(i.type);case 16:return Ne("Lazy");case 13:return Ne("Suspense");case 19:return Ne("SuspenseList");case 0:case 2:case 15:return i=Yt(i.type,!1),i;case 11:return i=Yt(i.type.render,!1),i;case 1:return i=Yt(i.type,!0),i;default:return""}}function hr(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case je:return"Fragment";case He:return"Portal";case Ve:return"Profiler";case ut:return"StrictMode";case Rt:return"Suspense";case Bt:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case vt:return(i.displayName||"Context")+".Consumer";case tr:return(i._context.displayName||"Context")+".Provider";case ar:var a=i.render;return i=i.displayName,i||(i=a.displayName||a.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case $r:return a=i.displayName||null,a!==null?a:hr(i.type)||"Memo";case Or:a=i._payload,i=i._init;try{return hr(i(a))}catch{}}return null}function cr(i){var a=i.type;switch(i.tag){case 24:return"Cache";case 9:return(a.displayName||"Context")+".Consumer";case 10:return(a._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=a.render,i=i.displayName||i.name||"",a.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return a;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return hr(a);case 8:return a===ut?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a}return null}function lr(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function Ir(i){var a=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function mn(i){var a=Ir(i)?"checked":"value",d=Object.getOwnPropertyDescriptor(i.constructor.prototype,a),v=""+i[a];if(!i.hasOwnProperty(a)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var I=d.get,M=d.set;return Object.defineProperty(i,a,{configurable:!0,get:function(){return I.call(this)},set:function($){v=""+$,M.call(this,$)}}),Object.defineProperty(i,a,{enumerable:d.enumerable}),{getValue:function(){return v},setValue:function($){v=""+$},stopTracking:function(){i._valueTracker=null,delete i[a]}}}}function fa(i){i._valueTracker||(i._valueTracker=mn(i))}function ws(i){if(!i)return!1;var a=i._valueTracker;if(!a)return!0;var d=a.getValue(),v="";return i&&(v=Ir(i)?i.checked?"true":"false":i.value),i=v,i!==d?(a.setValue(i),!0):!1}function Yi(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function bs(i,a){var d=a.checked;return ft({},a,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:d??i._wrapperState.initialChecked})}function Ba(i,a){var d=a.defaultValue==null?"":a.defaultValue,v=a.checked!=null?a.checked:a.defaultChecked;d=lr(a.value!=null?a.value:d),i._wrapperState={initialChecked:v,initialValue:d,controlled:a.type==="checkbox"||a.type==="radio"?a.checked!=null:a.value!=null}}function Ee(i,a){a=a.checked,a!=null&&$e(i,"checked",a,!1)}function js(i,a){Ee(i,a);var d=lr(a.value),v=a.type;if(d!=null)v==="number"?(d===0&&i.value===""||i.value!=d)&&(i.value=""+d):i.value!==""+d&&(i.value=""+d);else if(v==="submit"||v==="reset"){i.removeAttribute("value");return}a.hasOwnProperty("value")?fr(i,a.type,d):a.hasOwnProperty("defaultValue")&&fr(i,a.type,lr(a.defaultValue)),a.checked==null&&a.defaultChecked!=null&&(i.defaultChecked=!!a.defaultChecked)}function co(i,a,d){if(a.hasOwnProperty("value")||a.hasOwnProperty("defaultValue")){var v=a.type;if(!(v!=="submit"&&v!=="reset"||a.value!==void 0&&a.value!==null))return;a=""+i._wrapperState.initialValue,d||a===i.value||(i.value=a),i.defaultValue=a}d=i.name,d!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,d!==""&&(i.name=d)}function fr(i,a,d){(a!=="number"||Yi(i.ownerDocument)!==i)&&(d==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+d&&(i.defaultValue=""+d))}var Dr=Array.isArray;function Ss(i,a,d,v){if(i=i.options,a){a={};for(var I=0;I<d.length;I++)a["$"+d[I]]=!0;for(d=0;d<i.length;d++)I=a.hasOwnProperty("$"+i[d].value),i[d].selected!==I&&(i[d].selected=I),I&&v&&(i[d].defaultSelected=!0)}else{for(d=""+lr(d),a=null,I=0;I<i.length;I++){if(i[I].value===d){i[I].selected=!0,v&&(i[I].defaultSelected=!0);return}a!==null||i[I].disabled||(a=i[I])}a!==null&&(a.selected=!0)}}function ks(i,a){if(a.dangerouslySetInnerHTML!=null)throw Error(b(91));return ft({},a,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function Ts(i,a){var d=a.value;if(d==null){if(d=a.children,a=a.defaultValue,d!=null){if(a!=null)throw Error(b(92));if(Dr(d)){if(1<d.length)throw Error(b(93));d=d[0]}a=d}a==null&&(a=""),d=a}i._wrapperState={initialValue:lr(d)}}function Fa(i,a){var d=lr(a.value),v=lr(a.defaultValue);d!=null&&(d=""+d,d!==i.value&&(i.value=d),a.defaultValue==null&&i.defaultValue!==d&&(i.defaultValue=d)),v!=null&&(i.defaultValue=""+v)}function mi(i){var a=i.textContent;a===i._wrapperState.initialValue&&a!==""&&a!==null&&(i.value=a)}function ho(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Oa(i,a){return i==null||i==="http://www.w3.org/1999/xhtml"?ho(a):i==="http://www.w3.org/2000/svg"&&a==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var Ke,Ji=(function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(a,d,v,I){MSApp.execUnsafeLocalFunction(function(){return i(a,d,v,I)})}:i})(function(i,a){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=a;else{for(Ke=Ke||document.createElement("div"),Ke.innerHTML="<svg>"+a.valueOf().toString()+"</svg>",a=Ke.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;a.firstChild;)i.appendChild(a.firstChild)}});function gn(i,a){if(a){var d=i.firstChild;if(d&&d===i.lastChild&&d.nodeType===3){d.nodeValue=a;return}}i.textContent=a}var Jn={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ma=["Webkit","ms","Moz","O"];Object.keys(Jn).forEach(function(i){ma.forEach(function(a){a=a+i.charAt(0).toUpperCase()+i.substring(1),Jn[a]=Jn[i]})});function rt(i,a,d){return a==null||typeof a=="boolean"||a===""?"":d||typeof a!="number"||a===0||Jn.hasOwnProperty(i)&&Jn[i]?(""+a).trim():a+"px"}function Jt(i,a){i=i.style;for(var d in a)if(a.hasOwnProperty(d)){var v=d.indexOf("--")===0,I=rt(d,a[d],v);d==="float"&&(d="cssFloat"),v?i.setProperty(d,I):i[d]=I}}var Ft=ft({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ln(i,a){if(a){if(Ft[i]&&(a.children!=null||a.dangerouslySetInnerHTML!=null))throw Error(b(137,i));if(a.dangerouslySetInnerHTML!=null){if(a.children!=null)throw Error(b(60));if(typeof a.dangerouslySetInnerHTML!="object"||!("__html"in a.dangerouslySetInnerHTML))throw Error(b(61))}if(a.style!=null&&typeof a.style!="object")throw Error(b(62))}}function gi(i,a){if(i.indexOf("-")===-1)return typeof a.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Vt=null;function Ai(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var Qi=null,yi=null,Un=null;function ie(i){if(i=vl(i)){if(typeof Qi!="function")throw Error(b(280));var a=i.stateNode;a&&(a=xl(a),Qi(i.stateNode,i.type,a))}}function j(i){yi?Un?Un.push(i):Un=[i]:yi=i}function N(){if(yi){var i=yi,a=Un;if(Un=yi=null,ie(i),a)for(i=0;i<a.length;i++)ie(a[i])}}function H(i,a){return i(a)}function te(){}var he=!1;function me(i,a,d){if(he)return i(a,d);he=!0;try{return H(i,a,d)}finally{he=!1,(yi!==null||Un!==null)&&(te(),N())}}function ve(i,a){var d=i.stateNode;if(d===null)return null;var v=xl(d);if(v===null)return null;d=v[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(v=!v.disabled)||(i=i.type,v=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!v;break e;default:i=!1}if(i)return null;if(d&&typeof d!="function")throw Error(b(231,a,typeof d));return d}var ue=!1;if(h)try{var Me={};Object.defineProperty(Me,"passive",{get:function(){ue=!0}}),window.addEventListener("test",Me,Me),window.removeEventListener("test",Me,Me)}catch{ue=!1}function Oe(i,a,d,v,I,M,$,oe,pe){var Ce=Array.prototype.slice.call(arguments,3);try{a.apply(d,Ce)}catch(Ze){this.onError(Ze)}}var ke=!1,Ye=null,wt=!1,Ct=null,mr={onError:function(i){ke=!0,Ye=i}};function Zt(i,a,d,v,I,M,$,oe,pe){ke=!1,Ye=null,Oe.apply(mr,arguments)}function gr(i,a,d,v,I,M,$,oe,pe){if(Zt.apply(this,arguments),ke){if(ke){var Ce=Ye;ke=!1,Ye=null}else throw Error(b(198));wt||(wt=!0,Ct=Ce)}}function Wt(i){var a=i,d=i;if(i.alternate)for(;a.return;)a=a.return;else{i=a;do a=i,(a.flags&4098)!==0&&(d=a.return),i=a.return;while(i)}return a.tag===3?d:null}function sn(i){if(i.tag===13){var a=i.memoizedState;if(a===null&&(i=i.alternate,i!==null&&(a=i.memoizedState)),a!==null)return a.dehydrated}return null}function Gr(i){if(Wt(i)!==i)throw Error(b(188))}function rr(i){var a=i.alternate;if(!a){if(a=Wt(i),a===null)throw Error(b(188));return a!==i?null:i}for(var d=i,v=a;;){var I=d.return;if(I===null)break;var M=I.alternate;if(M===null){if(v=I.return,v!==null){d=v;continue}break}if(I.child===M.child){for(M=I.child;M;){if(M===d)return Gr(I),i;if(M===v)return Gr(I),a;M=M.sibling}throw Error(b(188))}if(d.return!==v.return)d=I,v=M;else{for(var $=!1,oe=I.child;oe;){if(oe===d){$=!0,d=I,v=M;break}if(oe===v){$=!0,v=I,d=M;break}oe=oe.sibling}if(!$){for(oe=M.child;oe;){if(oe===d){$=!0,d=M,v=I;break}if(oe===v){$=!0,v=M,d=I;break}oe=oe.sibling}if(!$)throw Error(b(189))}}if(d.alternate!==v)throw Error(b(190))}if(d.tag!==3)throw Error(b(188));return d.stateNode.current===d?i:a}function br(i){return i=rr(i),i!==null?Nr(i):null}function Nr(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var a=Nr(i);if(a!==null)return a;i=i.sibling}return null}var yn=y.unstable_scheduleCallback,Sn=y.unstable_cancelCallback,$n=y.unstable_shouldYield,po=y.unstable_requestPaint,Ut=y.unstable_now,zu=y.unstable_getCurrentPriorityLevel,tl=y.unstable_ImmediatePriority,Qn=y.unstable_UserBlockingPriority,Rn=y.unstable_NormalPriority,Jh=y.unstable_LowPriority,_i=y.unstable_IdlePriority,Bn=null,qn=null;function Na(i){if(qn&&typeof qn.onCommitFiberRoot=="function")try{qn.onCommitFiberRoot(Bn,i,void 0,(i.current.flags&128)===128)}catch{}}var Er=Math.clz32?Math.clz32:an,rl=Math.log,es=Math.LN2;function an(i){return i>>>=0,i===0?32:31-(rl(i)/es|0)|0}var ja=64,ei=4194304;function Va(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function ti(i,a){var d=i.pendingLanes;if(d===0)return 0;var v=0,I=i.suspendedLanes,M=i.pingedLanes,$=d&268435455;if($!==0){var oe=$&~I;oe!==0?v=Va(oe):(M&=$,M!==0&&(v=Va(M)))}else $=d&~I,$!==0?v=Va($):M!==0&&(v=Va(M));if(v===0)return 0;if(a!==0&&a!==v&&(a&I)===0&&(I=v&-v,M=a&-a,I>=M||I===16&&(M&4194240)!==0))return a;if((v&4)!==0&&(v|=d&16),a=i.entangledLanes,a!==0)for(i=i.entanglements,a&=v;0<a;)d=31-Er(a),I=1<<d,v|=i[d],a&=~I;return v}function Qh(i,a){switch(i){case 1:case 2:case 4:return a+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function $l(i,a){for(var d=i.suspendedLanes,v=i.pingedLanes,I=i.expirationTimes,M=i.pendingLanes;0<M;){var $=31-Er(M),oe=1<<$,pe=I[$];pe===-1?((oe&d)===0||(oe&v)!==0)&&(I[$]=Qh(oe,a)):pe<=a&&(i.expiredLanes|=oe),M&=~oe}}function Vs(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function Us(){var i=ja;return ja<<=1,(ja&4194240)===0&&(ja=64),i}function yr(i){for(var a=[],d=0;31>d;d++)a.push(i);return a}function Ua(i,a,d){i.pendingLanes|=a,a!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,a=31-Er(a),i[a]=d}function Du(i,a){var d=i.pendingLanes&~a;i.pendingLanes=a,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=a,i.mutableReadLanes&=a,i.entangledLanes&=a,a=i.entanglements;var v=i.eventTimes;for(i=i.expirationTimes;0<d;){var I=31-Er(d),M=1<<I;a[I]=0,v[I]=-1,i[I]=-1,d&=~M}}function ga(i,a){var d=i.entangledLanes|=a;for(i=i.entanglements;d;){var v=31-Er(d),I=1<<v;I&a|i[v]&a&&(i[v]|=a),d&=~I}}var Sr=0;function nl(i){return i&=-i,1<i?4<i?(i&268435455)!==0?16:536870912:4:1}var fo,mo,$a,Lu,qc,ql=!1,Zl=[],ri=null,zi=null,on=null,kn=new Map,ya=new Map,ts=[],Gl="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ru(i,a){switch(i){case"focusin":case"focusout":ri=null;break;case"dragenter":case"dragleave":zi=null;break;case"mouseover":case"mouseout":on=null;break;case"pointerover":case"pointerout":kn.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":ya.delete(a.pointerId)}}function Is(i,a,d,v,I,M){return i===null||i.nativeEvent!==M?(i={blockedOn:a,domEventName:d,eventSystemFlags:v,nativeEvent:M,targetContainers:[I]},a!==null&&(a=vl(a),a!==null&&mo(a)),i):(i.eventSystemFlags|=v,a=i.targetContainers,I!==null&&a.indexOf(I)===-1&&a.push(I),i)}function ed(i,a,d,v,I){switch(a){case"focusin":return ri=Is(ri,i,a,d,v,I),!0;case"dragenter":return zi=Is(zi,i,a,d,v,I),!0;case"mouseover":return on=Is(on,i,a,d,v,I),!0;case"pointerover":var M=I.pointerId;return kn.set(M,Is(kn.get(M)||null,i,a,d,v,I)),!0;case"gotpointercapture":return M=I.pointerId,ya.set(M,Is(ya.get(M)||null,i,a,d,v,I)),!0}return!1}function Bu(i){var a=ea(i.target);if(a!==null){var d=Wt(a);if(d!==null){if(a=d.tag,a===13){if(a=sn(d),a!==null){i.blockedOn=a,qc(i.priority,function(){$a(d)});return}}else if(a===3&&d.stateNode.current.memoizedState.isDehydrated){i.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}i.blockedOn=null}function il(i){if(i.blockedOn!==null)return!1;for(var a=i.targetContainers;0<a.length;){var d=sl(i.domEventName,i.eventSystemFlags,a[0],i.nativeEvent);if(d===null){d=i.nativeEvent;var v=new d.constructor(d.type,d);Vt=v,d.target.dispatchEvent(v),Vt=null}else return a=vl(d),a!==null&&mo(a),i.blockedOn=d,!1;a.shift()}return!0}function Zc(i,a,d){il(i)&&d.delete(a)}function td(){ql=!1,ri!==null&&il(ri)&&(ri=null),zi!==null&&il(zi)&&(zi=null),on!==null&&il(on)&&(on=null),kn.forEach(Zc),ya.forEach(Zc)}function go(i,a){i.blockedOn===a&&(i.blockedOn=null,ql||(ql=!0,y.unstable_scheduleCallback(y.unstable_NormalPriority,td)))}function $s(i){function a(I){return go(I,i)}if(0<Zl.length){go(Zl[0],i);for(var d=1;d<Zl.length;d++){var v=Zl[d];v.blockedOn===i&&(v.blockedOn=null)}}for(ri!==null&&go(ri,i),zi!==null&&go(zi,i),on!==null&&go(on,i),kn.forEach(a),ya.forEach(a),d=0;d<ts.length;d++)v=ts[d],v.blockedOn===i&&(v.blockedOn=null);for(;0<ts.length&&(d=ts[0],d.blockedOn===null);)Bu(d),d.blockedOn===null&&ts.shift()}var _a=et.ReactCurrentBatchConfig,qa=!0;function Fu(i,a,d,v){var I=Sr,M=_a.transition;_a.transition=null;try{Sr=1,Di(i,a,d,v)}finally{Sr=I,_a.transition=M}}function Ou(i,a,d,v){var I=Sr,M=_a.transition;_a.transition=null;try{Sr=4,Di(i,a,d,v)}finally{Sr=I,_a.transition=M}}function Di(i,a,d,v){if(qa){var I=sl(i,a,d,v);if(I===null)_l(i,a,v,Hl,d),Ru(i,v);else if(ed(I,i,a,d,v))v.stopPropagation();else if(Ru(i,v),a&4&&-1<Gl.indexOf(i)){for(;I!==null;){var M=vl(I);if(M!==null&&fo(M),M=sl(i,a,d,v),M===null&&_l(i,a,v,Hl,d),M===I)break;I=M}I!==null&&v.stopPropagation()}else _l(i,a,v,null,d)}}var Hl=null;function sl(i,a,d,v){if(Hl=null,i=Ai(v),i=ea(i),i!==null)if(a=Wt(i),a===null)i=null;else if(d=a.tag,d===13){if(i=sn(a),i!==null)return i;i=null}else if(d===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;i=null}else a!==i&&(i=null);return Hl=i,null}function va(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(zu()){case tl:return 1;case Qn:return 4;case Rn:case Jh:return 16;case _i:return 536870912;default:return 16}default:return 16}}var Zn=null,_r=null,Za=null;function Gc(){if(Za)return Za;var i,a=_r,d=a.length,v,I="value"in Zn?Zn.value:Zn.textContent,M=I.length;for(i=0;i<d&&a[i]===I[i];i++);var $=d-i;for(v=1;v<=$&&a[d-v]===I[M-v];v++);return Za=I.slice(i,1<v?1-v:void 0)}function qs(i){var a=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&a===13&&(i=13)):i=a,i===10&&(i=13),32<=i||i===13?i:0}function Kl(){return!0}function Nu(){return!1}function vi(i){function a(d,v,I,M,$){this._reactName=d,this._targetInst=I,this.type=v,this.nativeEvent=M,this.target=$,this.currentTarget=null;for(var oe in i)i.hasOwnProperty(oe)&&(d=i[oe],this[oe]=d?d(M):M[oe]);return this.isDefaultPrevented=(M.defaultPrevented!=null?M.defaultPrevented:M.returnValue===!1)?Kl:Nu,this.isPropagationStopped=Nu,this}return ft(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=Kl)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=Kl)},persist:function(){},isPersistent:Kl}),a}var Ga={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},al=vi(Ga),yo=ft({},Ga,{view:0,detail:0}),Hc=vi(yo),Wl,Xl,rs,ol=ft({},yo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ul,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==rs&&(rs&&i.type==="mousemove"?(Wl=i.screenX-rs.screenX,Xl=i.screenY-rs.screenY):Xl=Wl=0,rs=i),Wl)},movementY:function(i){return"movementY"in i?i.movementY:Xl}}),Kc=vi(ol),Wc=ft({},ol,{dataTransfer:0}),ll=vi(Wc),rd=ft({},yo,{relatedTarget:0}),_o=vi(rd),nd=ft({},Ga,{animationName:0,elapsedTime:0,pseudoElement:0}),id=vi(nd),Xc=ft({},Ga,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),Yc=vi(Xc),Jc=ft({},Ga,{data:0}),Yl=vi(Jc),Qc={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Jl={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Zs={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ju(i){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(i):(i=Zs[i])?!!a[i]:!1}function ul(){return ju}var Vu=ft({},yo,{key:function(i){if(i.key){var a=Qc[i.key]||i.key;if(a!=="Unidentified")return a}return i.type==="keypress"?(i=qs(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?Jl[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ul,charCode:function(i){return i.type==="keypress"?qs(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?qs(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),Ql=vi(Vu),Uu=ft({},ol,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),xa=vi(Uu),$u=ft({},yo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ul}),sd=vi($u),tn=ft({},Ga,{propertyName:0,elapsedTime:0,pseudoElement:0}),ad=vi(tn),sr=ft({},ol,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),eu=vi(sr),Lr=[9,13,27,32],kr=h&&"CompositionEvent"in window,ns=null;h&&"documentMode"in document&&(ns=document.documentMode);var cl=h&&"TextEvent"in window&&!ns,vo=h&&(!kr||ns&&8<ns&&11>=ns),tu=" ",wa=!1;function Ha(i,a){switch(i){case"keyup":return Lr.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function xi(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var ba=!1;function qu(i,a){switch(i){case"compositionend":return xi(a);case"keypress":return a.which!==32?null:(wa=!0,tu);case"textInput":return i=a.data,i===tu&&wa?null:i;default:return null}}function Zu(i,a){if(ba)return i==="compositionend"||!kr&&Ha(i,a)?(i=Gc(),Za=_r=Zn=null,ba=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return vo&&a.locale!=="ko"?null:a.data;default:return null}}var Ka={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function xo(i){var a=i&&i.nodeName&&i.nodeName.toLowerCase();return a==="input"?!!Ka[i.type]:a==="textarea"}function wo(i,a,d,v){j(v),a=Eo(a,"onChange"),0<a.length&&(d=new al("onChange","change",null,d,v),i.push({event:d,listeners:a}))}var Es=null,Gs=null;function ru(i){ou(i,0)}function Hs(i){var a=os(i);if(ws(a))return i}function bo(i,a){if(i==="change")return a}var Gu=!1;if(h){var hl;if(h){var dr="oninput"in document;if(!dr){var dl=document.createElement("div");dl.setAttribute("oninput","return;"),dr=typeof dl.oninput=="function"}hl=dr}else hl=!1;Gu=hl&&(!document.documentMode||9<document.documentMode)}function eh(){Es&&(Es.detachEvent("onpropertychange",Hu),Gs=Es=null)}function Hu(i){if(i.propertyName==="value"&&Hs(Gs)){var a=[];wo(a,Gs,i,Ai(i)),me(ru,a)}}function So(i,a,d){i==="focusin"?(eh(),Es=a,Gs=d,Es.attachEvent("onpropertychange",Hu)):i==="focusout"&&eh()}function th(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return Hs(Gs)}function nu(i,a){if(i==="click")return Hs(a)}function rh(i,a){if(i==="input"||i==="change")return Hs(a)}function nh(i,a){return i===a&&(i!==0||1/i===1/a)||i!==i&&a!==a}var ni=typeof Object.is=="function"?Object.is:nh;function Sa(i,a){if(ni(i,a))return!0;if(typeof i!="object"||i===null||typeof a!="object"||a===null)return!1;var d=Object.keys(i),v=Object.keys(a);if(d.length!==v.length)return!1;for(v=0;v<d.length;v++){var I=d[v];if(!X.call(a,I)||!ni(i[I],a[I]))return!1}return!0}function Wa(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function Xa(i,a){var d=Wa(i);i=0;for(var v;d;){if(d.nodeType===3){if(v=i+d.textContent.length,i<=a&&v>=a)return{node:d,offset:a-i};i=v}e:{for(;d;){if(d.nextSibling){d=d.nextSibling;break e}d=d.parentNode}d=void 0}d=Wa(d)}}function Ya(i,a){return i&&a?i===a?!0:i&&i.nodeType===3?!1:a&&a.nodeType===3?Ya(i,a.parentNode):"contains"in i?i.contains(a):i.compareDocumentPosition?!!(i.compareDocumentPosition(a)&16):!1:!1}function iu(){for(var i=window,a=Yi();a instanceof i.HTMLIFrameElement;){try{var d=typeof a.contentWindow.location.href=="string"}catch{d=!1}if(d)i=a.contentWindow;else break;a=Yi(i.document)}return a}function ka(i){var a=i&&i.nodeName&&i.nodeName.toLowerCase();return a&&(a==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||a==="textarea"||i.contentEditable==="true")}function pl(i){var a=iu(),d=i.focusedElem,v=i.selectionRange;if(a!==d&&d&&d.ownerDocument&&Ya(d.ownerDocument.documentElement,d)){if(v!==null&&ka(d)){if(a=v.start,i=v.end,i===void 0&&(i=a),"selectionStart"in d)d.selectionStart=a,d.selectionEnd=Math.min(i,d.value.length);else if(i=(a=d.ownerDocument||document)&&a.defaultView||window,i.getSelection){i=i.getSelection();var I=d.textContent.length,M=Math.min(v.start,I);v=v.end===void 0?M:Math.min(v.end,I),!i.extend&&M>v&&(I=v,v=M,M=I),I=Xa(d,M);var $=Xa(d,v);I&&$&&(i.rangeCount!==1||i.anchorNode!==I.node||i.anchorOffset!==I.offset||i.focusNode!==$.node||i.focusOffset!==$.offset)&&(a=a.createRange(),a.setStart(I.node,I.offset),i.removeAllRanges(),M>v?(i.addRange(a),i.extend($.node,$.offset)):(a.setEnd($.node,$.offset),i.addRange(a)))}}for(a=[],i=d;i=i.parentNode;)i.nodeType===1&&a.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof d.focus=="function"&&d.focus(),d=0;d<a.length;d++)i=a[d],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var su=h&&"documentMode"in document&&11>=document.documentMode,Ks=null,fl=null,ml=null,au=!1;function gl(i,a,d){var v=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;au||Ks==null||Ks!==Yi(v)||(v=Ks,"selectionStart"in v&&ka(v)?v={start:v.selectionStart,end:v.selectionEnd}:(v=(v.ownerDocument&&v.ownerDocument.defaultView||window).getSelection(),v={anchorNode:v.anchorNode,anchorOffset:v.anchorOffset,focusNode:v.focusNode,focusOffset:v.focusOffset}),ml&&Sa(ml,v)||(ml=v,v=Eo(fl,"onSelect"),0<v.length&&(a=new al("onSelect","select",null,a,d),i.push({event:a,listeners:v}),a.target=Ks)))}function ko(i,a){var d={};return d[i.toLowerCase()]=a.toLowerCase(),d["Webkit"+i]="webkit"+a,d["Moz"+i]="moz"+a,d}var Ps={animationend:ko("Animation","AnimationEnd"),animationiteration:ko("Animation","AnimationIteration"),animationstart:ko("Animation","AnimationStart"),transitionend:ko("Transition","TransitionEnd")},Ja={},Pn={};h&&(Pn=document.createElement("div").style,"AnimationEvent"in window||(delete Ps.animationend.animation,delete Ps.animationiteration.animation,delete Ps.animationstart.animation),"TransitionEvent"in window||delete Ps.transitionend.transition);function Cs(i){if(Ja[i])return Ja[i];if(!Ps[i])return i;var a=Ps[i],d;for(d in a)if(a.hasOwnProperty(d)&&d in Pn)return Ja[i]=a[d];return i}var Ku=Cs("animationend"),Wu=Cs("animationiteration"),Yr=Cs("animationstart"),Li=Cs("transitionend"),ii=new Map,To="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ms(i,a){ii.set(i,a),F(a,[i])}for(var Io=0;Io<To.length;Io++){var Ta=To[Io],Ws=Ta.toLowerCase(),Xu=Ta[0].toUpperCase()+Ta.slice(1);Ms(Ws,"on"+Xu)}Ms(Ku,"onAnimationEnd"),Ms(Wu,"onAnimationIteration"),Ms(Yr,"onAnimationStart"),Ms("dblclick","onDoubleClick"),Ms("focusin","onFocus"),Ms("focusout","onBlur"),Ms(Li,"onTransitionEnd"),T("onMouseEnter",["mouseout","mouseover"]),T("onMouseLeave",["mouseout","mouseover"]),T("onPointerEnter",["pointerout","pointerover"]),T("onPointerLeave",["pointerout","pointerover"]),F("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),F("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),F("onBeforeInput",["compositionend","keypress","textInput","paste"]),F("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),F("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),F("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ia="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Yu=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ia));function yl(i,a,d){var v=i.type||"unknown-event";i.currentTarget=d,gr(v,a,void 0,i),i.currentTarget=null}function ou(i,a){a=(a&4)!==0;for(var d=0;d<i.length;d++){var v=i[d],I=v.event;v=v.listeners;e:{var M=void 0;if(a)for(var $=v.length-1;0<=$;$--){var oe=v[$],pe=oe.instance,Ce=oe.currentTarget;if(oe=oe.listener,pe!==M&&I.isPropagationStopped())break e;yl(I,oe,Ce),M=pe}else for($=0;$<v.length;$++){if(oe=v[$],pe=oe.instance,Ce=oe.currentTarget,oe=oe.listener,pe!==M&&I.isPropagationStopped())break e;yl(I,oe,Ce),M=pe}}}if(wt)throw i=Ct,wt=!1,Ct=null,i}function Rr(i,a){var d=a[or];d===void 0&&(d=a[or]=new Set);var v=i+"__bubble";d.has(v)||(lu(a,i,2,!1),d.add(v))}function Xs(i,a,d){var v=0;a&&(v|=4),lu(d,i,v,a)}var Qa="_reactListening"+Math.random().toString(36).slice(2);function Ys(i){if(!i[Qa]){i[Qa]=!0,C.forEach(function(d){d!=="selectionchange"&&(Yu.has(d)||Xs(d,!1,i),Xs(d,!0,i))});var a=i.nodeType===9?i:i.ownerDocument;a===null||a[Qa]||(a[Qa]=!0,Xs("selectionchange",!1,a))}}function lu(i,a,d,v){switch(va(a)){case 1:var I=Fu;break;case 4:I=Ou;break;default:I=Di}d=I.bind(null,a,d,i),I=void 0,!ue||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(I=!0),v?I!==void 0?i.addEventListener(a,d,{capture:!0,passive:I}):i.addEventListener(a,d,!0):I!==void 0?i.addEventListener(a,d,{passive:I}):i.addEventListener(a,d,!1)}function _l(i,a,d,v,I){var M=v;if((a&1)===0&&(a&2)===0&&v!==null)e:for(;;){if(v===null)return;var $=v.tag;if($===3||$===4){var oe=v.stateNode.containerInfo;if(oe===I||oe.nodeType===8&&oe.parentNode===I)break;if($===4)for($=v.return;$!==null;){var pe=$.tag;if((pe===3||pe===4)&&(pe=$.stateNode.containerInfo,pe===I||pe.nodeType===8&&pe.parentNode===I))return;$=$.return}for(;oe!==null;){if($=ea(oe),$===null)return;if(pe=$.tag,pe===5||pe===6){v=M=$;continue e}oe=oe.parentNode}}v=v.return}me(function(){var Ce=M,Ze=Ai(d),We=[];e:{var qe=ii.get(i);if(qe!==void 0){var ht=al,bt=i;switch(i){case"keypress":if(qs(d)===0)break e;case"keydown":case"keyup":ht=Ql;break;case"focusin":bt="focus",ht=_o;break;case"focusout":bt="blur",ht=_o;break;case"beforeblur":case"afterblur":ht=_o;break;case"click":if(d.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ht=Kc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ht=ll;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ht=sd;break;case Ku:case Wu:case Yr:ht=id;break;case Li:ht=ad;break;case"scroll":ht=Hc;break;case"wheel":ht=eu;break;case"copy":case"cut":case"paste":ht=Yc;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ht=xa}var Mt=(a&4)!==0,dn=!Mt&&i==="scroll",Se=Mt?qe!==null?qe+"Capture":null:qe;Mt=[];for(var ge=Ce,Te;ge!==null;){Te=ge;var it=Te.stateNode;if(Te.tag===5&&it!==null&&(Te=it,Se!==null&&(it=ve(ge,Se),it!=null&&Mt.push(eo(ge,it,Te)))),dn)break;ge=ge.return}0<Mt.length&&(qe=new ht(qe,bt,null,d,Ze),We.push({event:qe,listeners:Mt}))}}if((a&7)===0){e:{if(qe=i==="mouseover"||i==="pointerover",ht=i==="mouseout"||i==="pointerout",qe&&d!==Vt&&(bt=d.relatedTarget||d.fromElement)&&(ea(bt)||bt[as]))break e;if((ht||qe)&&(qe=Ze.window===Ze?Ze:(qe=Ze.ownerDocument)?qe.defaultView||qe.parentWindow:window,ht?(bt=d.relatedTarget||d.toElement,ht=Ce,bt=bt?ea(bt):null,bt!==null&&(dn=Wt(bt),bt!==dn||bt.tag!==5&&bt.tag!==6)&&(bt=null)):(ht=null,bt=Ce),ht!==bt)){if(Mt=Kc,it="onMouseLeave",Se="onMouseEnter",ge="mouse",(i==="pointerout"||i==="pointerover")&&(Mt=xa,it="onPointerLeave",Se="onPointerEnter",ge="pointer"),dn=ht==null?qe:os(ht),Te=bt==null?qe:os(bt),qe=new Mt(it,ge+"leave",ht,d,Ze),qe.target=dn,qe.relatedTarget=Te,it=null,ea(Ze)===Ce&&(Mt=new Mt(Se,ge+"enter",bt,d,Ze),Mt.target=Te,Mt.relatedTarget=dn,it=Mt),dn=it,ht&&bt)t:{for(Mt=ht,Se=bt,ge=0,Te=Mt;Te;Te=Js(Te))ge++;for(Te=0,it=Se;it;it=Js(it))Te++;for(;0<ge-Te;)Mt=Js(Mt),ge--;for(;0<Te-ge;)Se=Js(Se),Te--;for(;ge--;){if(Mt===Se||Se!==null&&Mt===Se.alternate)break t;Mt=Js(Mt),Se=Js(Se)}Mt=null}else Mt=null;ht!==null&&Po(We,qe,ht,Mt,!1),bt!==null&&dn!==null&&Po(We,dn,bt,Mt,!0)}}e:{if(qe=Ce?os(Ce):window,ht=qe.nodeName&&qe.nodeName.toLowerCase(),ht==="select"||ht==="input"&&qe.type==="file")var zt=bo;else if(xo(qe))if(Gu)zt=rh;else{zt=th;var jt=So}else(ht=qe.nodeName)&&ht.toLowerCase()==="input"&&(qe.type==="checkbox"||qe.type==="radio")&&(zt=nu);if(zt&&(zt=zt(i,Ce))){wo(We,zt,d,Ze);break e}jt&&jt(i,qe,Ce),i==="focusout"&&(jt=qe._wrapperState)&&jt.controlled&&qe.type==="number"&&fr(qe,"number",qe.value)}switch(jt=Ce?os(Ce):window,i){case"focusin":(xo(jt)||jt.contentEditable==="true")&&(Ks=jt,fl=Ce,ml=null);break;case"focusout":ml=fl=Ks=null;break;case"mousedown":au=!0;break;case"contextmenu":case"mouseup":case"dragend":au=!1,gl(We,d,Ze);break;case"selectionchange":if(su)break;case"keydown":case"keyup":gl(We,d,Ze)}var Dt;if(kr)e:{switch(i){case"compositionstart":var Kt="onCompositionStart";break e;case"compositionend":Kt="onCompositionEnd";break e;case"compositionupdate":Kt="onCompositionUpdate";break e}Kt=void 0}else ba?Ha(i,d)&&(Kt="onCompositionEnd"):i==="keydown"&&d.keyCode===229&&(Kt="onCompositionStart");Kt&&(vo&&d.locale!=="ko"&&(ba||Kt!=="onCompositionStart"?Kt==="onCompositionEnd"&&ba&&(Dt=Gc()):(Zn=Ze,_r="value"in Zn?Zn.value:Zn.textContent,ba=!0)),jt=Eo(Ce,Kt),0<jt.length&&(Kt=new Yl(Kt,i,null,d,Ze),We.push({event:Kt,listeners:jt}),Dt?Kt.data=Dt:(Dt=xi(d),Dt!==null&&(Kt.data=Dt)))),(Dt=cl?qu(i,d):Zu(i,d))&&(Ce=Eo(Ce,"onBeforeInput"),0<Ce.length&&(Ze=new Yl("onBeforeInput","beforeinput",null,d,Ze),We.push({event:Ze,listeners:Ce}),Ze.data=Dt))}ou(We,a)})}function eo(i,a,d){return{instance:i,listener:a,currentTarget:d}}function Eo(i,a){for(var d=a+"Capture",v=[];i!==null;){var I=i,M=I.stateNode;I.tag===5&&M!==null&&(I=M,M=ve(i,d),M!=null&&v.unshift(eo(i,M,I)),M=ve(i,a),M!=null&&v.push(eo(i,M,I))),i=i.return}return v}function Js(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function Po(i,a,d,v,I){for(var M=a._reactName,$=[];d!==null&&d!==v;){var oe=d,pe=oe.alternate,Ce=oe.stateNode;if(pe!==null&&pe===v)break;oe.tag===5&&Ce!==null&&(oe=Ce,I?(pe=ve(d,M),pe!=null&&$.unshift(eo(d,pe,oe))):I||(pe=ve(d,M),pe!=null&&$.push(eo(d,pe,oe)))),d=d.return}$.length!==0&&i.push({event:a,listeners:$})}var ih=/\r\n?/g,Ri=/\u0000|\uFFFD/g;function is(i){return(typeof i=="string"?i:""+i).replace(ih,`
`).replace(Ri,"")}function Co(i,a,d){if(a=is(a),is(i)!==a&&d)throw Error(b(425))}function si(){}var Qs=null,Ju=null;function Qu(i,a){return i==="textarea"||i==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var uu=typeof setTimeout=="function"?setTimeout:void 0,sh=typeof clearTimeout=="function"?clearTimeout:void 0,cu=typeof Promise=="function"?Promise:void 0,Mo=typeof queueMicrotask=="function"?queueMicrotask:typeof cu<"u"?function(i){return cu.resolve(null).then(i).catch(Bi)}:uu;function Bi(i){setTimeout(function(){throw i})}function mt(i,a){var d=a,v=0;do{var I=d.nextSibling;if(i.removeChild(d),I&&I.nodeType===8)if(d=I.data,d==="/$"){if(v===0){i.removeChild(I),$s(a);return}v--}else d!=="$"&&d!=="$?"&&d!=="$!"||v++;d=I}while(d);$s(a)}function ss(i){for(;i!=null;i=i.nextSibling){var a=i.nodeType;if(a===1||a===3)break;if(a===8){if(a=i.data,a==="$"||a==="$!"||a==="$?")break;if(a==="/$")return null}}return i}function hu(i){i=i.previousSibling;for(var a=0;i;){if(i.nodeType===8){var d=i.data;if(d==="$"||d==="$!"||d==="$?"){if(a===0)return i;a--}else d==="/$"&&a++}i=i.previousSibling}return null}var to=Math.random().toString(36).slice(2),Gn="__reactFiber$"+to,As="__reactProps$"+to,as="__reactContainer$"+to,or="__reactEvents$"+to,ec="__reactListeners$"+to,od="__reactHandles$"+to;function ea(i){var a=i[Gn];if(a)return a;for(var d=i.parentNode;d;){if(a=d[as]||d[Gn]){if(d=a.alternate,a.child!==null||d!==null&&d.child!==null)for(i=hu(i);i!==null;){if(d=i[Gn])return d;i=hu(i)}return a}i=d,d=i.parentNode}return null}function vl(i){return i=i[Gn]||i[as],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function os(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(b(33))}function xl(i){return i[As]||null}var wl=[],ro=-1;function Ea(i){return{current:i}}function Br(i){0>ro||(i.current=wl[ro],wl[ro]=null,ro--)}function jr(i,a){ro++,wl[ro]=i.current,i.current=a}var Pa={},Cr=Ea(Pa),ur=Ea(!1),Fi=Pa;function ta(i,a){var d=i.type.contextTypes;if(!d)return Pa;var v=i.stateNode;if(v&&v.__reactInternalMemoizedUnmaskedChildContext===a)return v.__reactInternalMemoizedMaskedChildContext;var I={},M;for(M in d)I[M]=a[M];return v&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=a,i.__reactInternalMemoizedMaskedChildContext=I),I}function Cn(i){return i=i.childContextTypes,i!=null}function bl(){Br(ur),Br(Cr)}function Ao(i,a,d){if(Cr.current!==Pa)throw Error(b(168));jr(Cr,a),jr(ur,d)}function zo(i,a,d){var v=i.stateNode;if(a=a.childContextTypes,typeof v.getChildContext!="function")return d;v=v.getChildContext();for(var I in v)if(!(I in a))throw Error(b(108,cr(i)||"Unknown",I));return ft({},d,v)}function wi(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||Pa,Fi=Cr.current,jr(Cr,i),jr(ur,ur.current),!0}function Do(i,a,d){var v=i.stateNode;if(!v)throw Error(b(169));d?(i=zo(i,a,Fi),v.__reactInternalMemoizedMergedChildContext=i,Br(ur),Br(Cr),jr(Cr,i)):Br(ur),jr(ur,d)}var gt=null,At=!1,Lo=!1;function Sl(i){gt===null?gt=[i]:gt.push(i)}function tc(i){At=!0,Sl(i)}function f(){if(!Lo&&gt!==null){Lo=!0;var i=0,a=Sr;try{var d=gt;for(Sr=1;i<d.length;i++){var v=d[i];do v=v(!0);while(v!==null)}gt=null,At=!1}catch(I){throw gt!==null&&(gt=gt.slice(i+1)),yn(tl,f),I}finally{Sr=a,Lo=!1}}return null}var e=[],s=0,l=null,u=0,p=[],w=0,k=null,E=1,A="";function R(i,a){e[s++]=u,e[s++]=l,l=i,u=a}function B(i,a,d){p[w++]=E,p[w++]=A,p[w++]=k,k=i;var v=E;i=A;var I=32-Er(v)-1;v&=~(1<<I),d+=1;var M=32-Er(a)+I;if(30<M){var $=I-I%5;M=(v&(1<<$)-1).toString(32),v>>=$,I-=$,E=1<<32-Er(a)+I|d<<I|v,A=M+i}else E=1<<M|d<<I|v,A=i}function U(i){i.return!==null&&(R(i,1),B(i,1,0))}function G(i){for(;i===l;)l=e[--s],e[s]=null,u=e[--s],e[s]=null;for(;i===k;)k=p[--w],p[w]=null,A=p[--w],p[w]=null,E=p[--w],p[w]=null}var W=null,J=null,re=!1,se=null;function ce(i,a){var d=qi(5,null,null,0);d.elementType="DELETED",d.stateNode=a,d.return=i,a=i.deletions,a===null?(i.deletions=[d],i.flags|=16):a.push(d)}function ee(i,a){switch(i.tag){case 5:var d=i.type;return a=a.nodeType!==1||d.toLowerCase()!==a.nodeName.toLowerCase()?null:a,a!==null?(i.stateNode=a,W=i,J=ss(a.firstChild),!0):!1;case 6:return a=i.pendingProps===""||a.nodeType!==3?null:a,a!==null?(i.stateNode=a,W=i,J=null,!0):!1;case 13:return a=a.nodeType!==8?null:a,a!==null?(d=k!==null?{id:E,overflow:A}:null,i.memoizedState={dehydrated:a,treeContext:d,retryLane:1073741824},d=qi(18,null,null,0),d.stateNode=a,d.return=i,i.child=d,W=i,J=null,!0):!1;default:return!1}}function fe(i){return(i.mode&1)!==0&&(i.flags&128)===0}function ye(i){if(re){var a=J;if(a){var d=a;if(!ee(i,a)){if(fe(i))throw Error(b(418));a=ss(d.nextSibling);var v=W;a&&ee(i,a)?ce(v,d):(i.flags=i.flags&-4097|2,re=!1,W=i)}}else{if(fe(i))throw Error(b(418));i.flags=i.flags&-4097|2,re=!1,W=i}}}function be(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;W=i}function Fe(i){if(i!==W)return!1;if(!re)return be(i),re=!0,!1;var a;if((a=i.tag!==3)&&!(a=i.tag!==5)&&(a=i.type,a=a!=="head"&&a!=="body"&&!Qu(i.type,i.memoizedProps)),a&&(a=J)){if(fe(i))throw Ge(),Error(b(418));for(;a;)ce(i,a),a=ss(a.nextSibling)}if(be(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(b(317));e:{for(i=i.nextSibling,a=0;i;){if(i.nodeType===8){var d=i.data;if(d==="/$"){if(a===0){J=ss(i.nextSibling);break e}a--}else d!=="$"&&d!=="$!"&&d!=="$?"||a++}i=i.nextSibling}J=null}}else J=W?ss(i.stateNode.nextSibling):null;return!0}function Ge(){for(var i=J;i;)i=ss(i.nextSibling)}function Qe(){J=W=null,re=!1}function ct(i){se===null?se=[i]:se.push(i)}var tt=et.ReactCurrentBatchConfig;function Xe(i,a,d){if(i=d.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(d._owner){if(d=d._owner,d){if(d.tag!==1)throw Error(b(309));var v=d.stateNode}if(!v)throw Error(b(147,i));var I=v,M=""+i;return a!==null&&a.ref!==null&&typeof a.ref=="function"&&a.ref._stringRef===M?a.ref:(a=function($){var oe=I.refs;$===null?delete oe[M]:oe[M]=$},a._stringRef=M,a)}if(typeof i!="string")throw Error(b(284));if(!d._owner)throw Error(b(290,i))}return i}function _t(i,a){throw i=Object.prototype.toString.call(a),Error(b(31,i==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":i))}function Nt(i){var a=i._init;return a(i._payload)}function nt(i){function a(Se,ge){if(i){var Te=Se.deletions;Te===null?(Se.deletions=[ge],Se.flags|=16):Te.push(ge)}}function d(Se,ge){if(!i)return null;for(;ge!==null;)a(Se,ge),ge=ge.sibling;return null}function v(Se,ge){for(Se=new Map;ge!==null;)ge.key!==null?Se.set(ge.key,ge):Se.set(ge.index,ge),ge=ge.sibling;return Se}function I(Se,ge){return Se=Go(Se,ge),Se.index=0,Se.sibling=null,Se}function M(Se,ge,Te){return Se.index=Te,i?(Te=Se.alternate,Te!==null?(Te=Te.index,Te<ge?(Se.flags|=2,ge):Te):(Se.flags|=2,ge)):(Se.flags|=1048576,ge)}function $(Se){return i&&Se.alternate===null&&(Se.flags|=2),Se}function oe(Se,ge,Te,it){return ge===null||ge.tag!==6?(ge=Rs(Te,Se.mode,it),ge.return=Se,ge):(ge=I(ge,Te),ge.return=Se,ge)}function pe(Se,ge,Te,it){var zt=Te.type;return zt===je?Ze(Se,ge,Te.props.children,it,Te.key):ge!==null&&(ge.elementType===zt||typeof zt=="object"&&zt!==null&&zt.$$typeof===Or&&Nt(zt)===ge.type)?(it=I(ge,Te.props),it.ref=Xe(Se,ge,Te),it.return=Se,it):(it=Cc(Te.type,Te.key,Te.props,null,Se.mode,it),it.ref=Xe(Se,ge,Te),it.return=Se,it)}function Ce(Se,ge,Te,it){return ge===null||ge.tag!==4||ge.stateNode.containerInfo!==Te.containerInfo||ge.stateNode.implementation!==Te.implementation?(ge=Da(Te,Se.mode,it),ge.return=Se,ge):(ge=I(ge,Te.children||[]),ge.return=Se,ge)}function Ze(Se,ge,Te,it,zt){return ge===null||ge.tag!==7?(ge=Ho(Te,Se.mode,it,zt),ge.return=Se,ge):(ge=I(ge,Te),ge.return=Se,ge)}function We(Se,ge,Te){if(typeof ge=="string"&&ge!==""||typeof ge=="number")return ge=Rs(""+ge,Se.mode,Te),ge.return=Se,ge;if(typeof ge=="object"&&ge!==null){switch(ge.$$typeof){case Je:return Te=Cc(ge.type,ge.key,ge.props,null,Se.mode,Te),Te.ref=Xe(Se,null,ge),Te.return=Se,Te;case He:return ge=Da(ge,Se.mode,Te),ge.return=Se,ge;case Or:var it=ge._init;return We(Se,it(ge._payload),Te)}if(Dr(ge)||Pt(ge))return ge=Ho(ge,Se.mode,Te,null),ge.return=Se,ge;_t(Se,ge)}return null}function qe(Se,ge,Te,it){var zt=ge!==null?ge.key:null;if(typeof Te=="string"&&Te!==""||typeof Te=="number")return zt!==null?null:oe(Se,ge,""+Te,it);if(typeof Te=="object"&&Te!==null){switch(Te.$$typeof){case Je:return Te.key===zt?pe(Se,ge,Te,it):null;case He:return Te.key===zt?Ce(Se,ge,Te,it):null;case Or:return zt=Te._init,qe(Se,ge,zt(Te._payload),it)}if(Dr(Te)||Pt(Te))return zt!==null?null:Ze(Se,ge,Te,it,null);_t(Se,Te)}return null}function ht(Se,ge,Te,it,zt){if(typeof it=="string"&&it!==""||typeof it=="number")return Se=Se.get(Te)||null,oe(ge,Se,""+it,zt);if(typeof it=="object"&&it!==null){switch(it.$$typeof){case Je:return Se=Se.get(it.key===null?Te:it.key)||null,pe(ge,Se,it,zt);case He:return Se=Se.get(it.key===null?Te:it.key)||null,Ce(ge,Se,it,zt);case Or:var jt=it._init;return ht(Se,ge,Te,jt(it._payload),zt)}if(Dr(it)||Pt(it))return Se=Se.get(Te)||null,Ze(ge,Se,it,zt,null);_t(ge,it)}return null}function bt(Se,ge,Te,it){for(var zt=null,jt=null,Dt=ge,Kt=ge=0,Dn=null;Dt!==null&&Kt<Te.length;Kt++){Dt.index>Kt?(Dn=Dt,Dt=null):Dn=Dt.sibling;var Tr=qe(Se,Dt,Te[Kt],it);if(Tr===null){Dt===null&&(Dt=Dn);break}i&&Dt&&Tr.alternate===null&&a(Se,Dt),ge=M(Tr,ge,Kt),jt===null?zt=Tr:jt.sibling=Tr,jt=Tr,Dt=Dn}if(Kt===Te.length)return d(Se,Dt),re&&R(Se,Kt),zt;if(Dt===null){for(;Kt<Te.length;Kt++)Dt=We(Se,Te[Kt],it),Dt!==null&&(ge=M(Dt,ge,Kt),jt===null?zt=Dt:jt.sibling=Dt,jt=Dt);return re&&R(Se,Kt),zt}for(Dt=v(Se,Dt);Kt<Te.length;Kt++)Dn=ht(Dt,Se,Kt,Te[Kt],it),Dn!==null&&(i&&Dn.alternate!==null&&Dt.delete(Dn.key===null?Kt:Dn.key),ge=M(Dn,ge,Kt),jt===null?zt=Dn:jt.sibling=Dn,jt=Dn);return i&&Dt.forEach(function(ao){return a(Se,ao)}),re&&R(Se,Kt),zt}function Mt(Se,ge,Te,it){var zt=Pt(Te);if(typeof zt!="function")throw Error(b(150));if(Te=zt.call(Te),Te==null)throw Error(b(151));for(var jt=zt=null,Dt=ge,Kt=ge=0,Dn=null,Tr=Te.next();Dt!==null&&!Tr.done;Kt++,Tr=Te.next()){Dt.index>Kt?(Dn=Dt,Dt=null):Dn=Dt.sibling;var ao=qe(Se,Dt,Tr.value,it);if(ao===null){Dt===null&&(Dt=Dn);break}i&&Dt&&ao.alternate===null&&a(Se,Dt),ge=M(ao,ge,Kt),jt===null?zt=ao:jt.sibling=ao,jt=ao,Dt=Dn}if(Tr.done)return d(Se,Dt),re&&R(Se,Kt),zt;if(Dt===null){for(;!Tr.done;Kt++,Tr=Te.next())Tr=We(Se,Tr.value,it),Tr!==null&&(ge=M(Tr,ge,Kt),jt===null?zt=Tr:jt.sibling=Tr,jt=Tr);return re&&R(Se,Kt),zt}for(Dt=v(Se,Dt);!Tr.done;Kt++,Tr=Te.next())Tr=ht(Dt,Se,Kt,Tr.value,it),Tr!==null&&(i&&Tr.alternate!==null&&Dt.delete(Tr.key===null?Kt:Tr.key),ge=M(Tr,ge,Kt),jt===null?zt=Tr:jt.sibling=Tr,jt=Tr);return i&&Dt.forEach(function(Nf){return a(Se,Nf)}),re&&R(Se,Kt),zt}function dn(Se,ge,Te,it){if(typeof Te=="object"&&Te!==null&&Te.type===je&&Te.key===null&&(Te=Te.props.children),typeof Te=="object"&&Te!==null){switch(Te.$$typeof){case Je:e:{for(var zt=Te.key,jt=ge;jt!==null;){if(jt.key===zt){if(zt=Te.type,zt===je){if(jt.tag===7){d(Se,jt.sibling),ge=I(jt,Te.props.children),ge.return=Se,Se=ge;break e}}else if(jt.elementType===zt||typeof zt=="object"&&zt!==null&&zt.$$typeof===Or&&Nt(zt)===jt.type){d(Se,jt.sibling),ge=I(jt,Te.props),ge.ref=Xe(Se,jt,Te),ge.return=Se,Se=ge;break e}d(Se,jt);break}else a(Se,jt);jt=jt.sibling}Te.type===je?(ge=Ho(Te.props.children,Se.mode,it,Te.key),ge.return=Se,Se=ge):(it=Cc(Te.type,Te.key,Te.props,null,Se.mode,it),it.ref=Xe(Se,ge,Te),it.return=Se,Se=it)}return $(Se);case He:e:{for(jt=Te.key;ge!==null;){if(ge.key===jt)if(ge.tag===4&&ge.stateNode.containerInfo===Te.containerInfo&&ge.stateNode.implementation===Te.implementation){d(Se,ge.sibling),ge=I(ge,Te.children||[]),ge.return=Se,Se=ge;break e}else{d(Se,ge);break}else a(Se,ge);ge=ge.sibling}ge=Da(Te,Se.mode,it),ge.return=Se,Se=ge}return $(Se);case Or:return jt=Te._init,dn(Se,ge,jt(Te._payload),it)}if(Dr(Te))return bt(Se,ge,Te,it);if(Pt(Te))return Mt(Se,ge,Te,it);_t(Se,Te)}return typeof Te=="string"&&Te!==""||typeof Te=="number"?(Te=""+Te,ge!==null&&ge.tag===6?(d(Se,ge.sibling),ge=I(ge,Te),ge.return=Se,Se=ge):(d(Se,ge),ge=Rs(Te,Se.mode,it),ge.return=Se,Se=ge),$(Se)):d(Se,ge)}return dn}var st=nt(!0),Ot=nt(!1),Pr=Ea(null),Gt=null,Qt=null,Mr=null;function Tn(){Mr=Qt=Gt=null}function bi(i){var a=Pr.current;Br(Pr),i._currentValue=a}function Ar(i,a,d){for(;i!==null;){var v=i.alternate;if((i.childLanes&a)!==a?(i.childLanes|=a,v!==null&&(v.childLanes|=a)):v!==null&&(v.childLanes&a)!==a&&(v.childLanes|=a),i===d)break;i=i.return}}function _n(i,a){Gt=i,Mr=Qt=null,i=i.dependencies,i!==null&&i.firstContext!==null&&((i.lanes&a)!==0&&(Ii=!0),i.firstContext=null)}function Vr(i){var a=i._currentValue;if(Mr!==i)if(i={context:i,memoizedValue:a,next:null},Qt===null){if(Gt===null)throw Error(b(308));Qt=i,Gt.dependencies={lanes:0,firstContext:i}}else Qt=Qt.next=i;return a}var rn=null;function Mn(i){rn===null?rn=[i]:rn.push(i)}function ls(i,a,d,v){var I=a.interleaved;return I===null?(d.next=d,Mn(a)):(d.next=I.next,I.next=d),a.interleaved=d,ai(i,v)}function ai(i,a){i.lanes|=a;var d=i.alternate;for(d!==null&&(d.lanes|=a),d=i,i=i.return;i!==null;)i.childLanes|=a,d=i.alternate,d!==null&&(d.childLanes|=a),d=i,i=i.return;return d.tag===3?d.stateNode:null}var us=!1;function Ca(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Si(i,a){i=i.updateQueue,a.updateQueue===i&&(a.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function Oi(i,a){return{eventTime:i,lane:a,tag:0,payload:null,callback:null,next:null}}function zs(i,a,d){var v=i.updateQueue;if(v===null)return null;if(v=v.shared,(xr&2)!==0){var I=v.pending;return I===null?a.next=a:(a.next=I.next,I.next=a),v.pending=a,ai(i,d)}return I=v.interleaved,I===null?(a.next=a,Mn(v)):(a.next=I.next,I.next=a),v.interleaved=a,ai(i,d)}function Hn(i,a,d){if(a=a.updateQueue,a!==null&&(a=a.shared,(d&4194240)!==0)){var v=a.lanes;v&=i.pendingLanes,d|=v,a.lanes=d,ga(i,d)}}function ki(i,a){var d=i.updateQueue,v=i.alternate;if(v!==null&&(v=v.updateQueue,d===v)){var I=null,M=null;if(d=d.firstBaseUpdate,d!==null){do{var $={eventTime:d.eventTime,lane:d.lane,tag:d.tag,payload:d.payload,callback:d.callback,next:null};M===null?I=M=$:M=M.next=$,d=d.next}while(d!==null);M===null?I=M=a:M=M.next=a}else I=M=a;d={baseState:v.baseState,firstBaseUpdate:I,lastBaseUpdate:M,shared:v.shared,effects:v.effects},i.updateQueue=d;return}i=d.lastBaseUpdate,i===null?d.firstBaseUpdate=a:i.next=a,d.lastBaseUpdate=a}function cs(i,a,d,v){var I=i.updateQueue;us=!1;var M=I.firstBaseUpdate,$=I.lastBaseUpdate,oe=I.shared.pending;if(oe!==null){I.shared.pending=null;var pe=oe,Ce=pe.next;pe.next=null,$===null?M=Ce:$.next=Ce,$=pe;var Ze=i.alternate;Ze!==null&&(Ze=Ze.updateQueue,oe=Ze.lastBaseUpdate,oe!==$&&(oe===null?Ze.firstBaseUpdate=Ce:oe.next=Ce,Ze.lastBaseUpdate=pe))}if(M!==null){var We=I.baseState;$=0,Ze=Ce=pe=null,oe=M;do{var qe=oe.lane,ht=oe.eventTime;if((v&qe)===qe){Ze!==null&&(Ze=Ze.next={eventTime:ht,lane:0,tag:oe.tag,payload:oe.payload,callback:oe.callback,next:null});e:{var bt=i,Mt=oe;switch(qe=a,ht=d,Mt.tag){case 1:if(bt=Mt.payload,typeof bt=="function"){We=bt.call(ht,We,qe);break e}We=bt;break e;case 3:bt.flags=bt.flags&-65537|128;case 0:if(bt=Mt.payload,qe=typeof bt=="function"?bt.call(ht,We,qe):bt,qe==null)break e;We=ft({},We,qe);break e;case 2:us=!0}}oe.callback!==null&&oe.lane!==0&&(i.flags|=64,qe=I.effects,qe===null?I.effects=[oe]:qe.push(oe))}else ht={eventTime:ht,lane:qe,tag:oe.tag,payload:oe.payload,callback:oe.callback,next:null},Ze===null?(Ce=Ze=ht,pe=We):Ze=Ze.next=ht,$|=qe;if(oe=oe.next,oe===null){if(oe=I.shared.pending,oe===null)break;qe=oe,oe=qe.next,qe.next=null,I.lastBaseUpdate=qe,I.shared.pending=null}}while(!0);if(Ze===null&&(pe=We),I.baseState=pe,I.firstBaseUpdate=Ce,I.lastBaseUpdate=Ze,a=I.shared.interleaved,a!==null){I=a;do $|=I.lane,I=I.next;while(I!==a)}else M===null&&(I.shared.lanes=0);Cl|=$,i.lanes=$,i.memoizedState=We}}function Ni(i,a,d){if(i=a.effects,a.effects=null,i!==null)for(a=0;a<i.length;a++){var v=i[a],I=v.callback;if(I!==null){if(v.callback=null,v=d,typeof I!="function")throw Error(b(191,I));I.call(v)}}}var ln={},qr=Ea(ln),An=Ea(ln),nr=Ea(ln);function Ti(i){if(i===ln)throw Error(b(174));return i}function Ma(i,a){switch(jr(nr,a),jr(An,i),jr(qr,ln),i=a.nodeType,i){case 9:case 11:a=(a=a.documentElement)?a.namespaceURI:Oa(null,"");break;default:i=i===8?a.parentNode:a,a=i.namespaceURI||null,i=i.tagName,a=Oa(a,i)}Br(qr),jr(qr,a)}function hs(){Br(qr),Br(An),Br(nr)}function rc(i){Ti(nr.current);var a=Ti(qr.current),d=Oa(a,i.type);a!==d&&(jr(An,i),jr(qr,d))}function nc(i){An.current===i&&(Br(qr),Br(An))}var Hr=Ea(0);function ds(i){for(var a=i;a!==null;){if(a.tag===13){var d=a.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||d.data==="$?"||d.data==="$!"))return a}else if(a.tag===19&&a.memoizedProps.revealOrder!==void 0){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===i)break;for(;a.sibling===null;){if(a.return===null||a.return===i)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var du=[];function Ro(){for(var i=0;i<du.length;i++)du[i]._workInProgressVersionPrimary=null;du.length=0}var Aa=et.ReactCurrentDispatcher,Bo=et.ReactCurrentBatchConfig,Ds=0,zr=null,Jr=null,vn=null,ic=!1,pu=!1,sc=0,ld=0;function In(){throw Error(b(321))}function Fo(i,a){if(a===null)return!1;for(var d=0;d<a.length&&d<i.length;d++)if(!ni(i[d],a[d]))return!1;return!0}function ra(i,a,d,v,I,M){if(Ds=M,zr=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,Aa.current=i===null||i.memoizedState===null?dh:Ef,i=d(v,I),pu){M=0;do{if(pu=!1,sc=0,25<=M)throw Error(b(301));M+=1,vn=Jr=null,a.updateQueue=null,Aa.current=hp,i=d(v,I)}while(pu)}if(Aa.current=hh,a=Jr!==null&&Jr.next!==null,Ds=0,vn=Jr=zr=null,ic=!1,a)throw Error(b(300));return i}function ps(){var i=sc!==0;return sc=0,i}function Kn(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return vn===null?zr.memoizedState=vn=i:vn=vn.next=i,vn}function fs(){if(Jr===null){var i=zr.alternate;i=i!==null?i.memoizedState:null}else i=Jr.next;var a=vn===null?zr.memoizedState:vn.next;if(a!==null)vn=a,Jr=i;else{if(i===null)throw Error(b(310));Jr=i,i={memoizedState:Jr.memoizedState,baseState:Jr.baseState,baseQueue:Jr.baseQueue,queue:Jr.queue,next:null},vn===null?zr.memoizedState=vn=i:vn=vn.next=i}return vn}function na(i,a){return typeof a=="function"?a(i):a}function ud(i){var a=fs(),d=a.queue;if(d===null)throw Error(b(311));d.lastRenderedReducer=i;var v=Jr,I=v.baseQueue,M=d.pending;if(M!==null){if(I!==null){var $=I.next;I.next=M.next,M.next=$}v.baseQueue=I=M,d.pending=null}if(I!==null){M=I.next,v=v.baseState;var oe=$=null,pe=null,Ce=M;do{var Ze=Ce.lane;if((Ds&Ze)===Ze)pe!==null&&(pe=pe.next={lane:0,action:Ce.action,hasEagerState:Ce.hasEagerState,eagerState:Ce.eagerState,next:null}),v=Ce.hasEagerState?Ce.eagerState:i(v,Ce.action);else{var We={lane:Ze,action:Ce.action,hasEagerState:Ce.hasEagerState,eagerState:Ce.eagerState,next:null};pe===null?(oe=pe=We,$=v):pe=pe.next=We,zr.lanes|=Ze,Cl|=Ze}Ce=Ce.next}while(Ce!==null&&Ce!==M);pe===null?$=v:pe.next=oe,ni(v,a.memoizedState)||(Ii=!0),a.memoizedState=v,a.baseState=$,a.baseQueue=pe,d.lastRenderedState=v}if(i=d.interleaved,i!==null){I=i;do M=I.lane,zr.lanes|=M,Cl|=M,I=I.next;while(I!==i)}else I===null&&(d.lanes=0);return[a.memoizedState,d.dispatch]}function ah(i){var a=fs(),d=a.queue;if(d===null)throw Error(b(311));d.lastRenderedReducer=i;var v=d.dispatch,I=d.pending,M=a.memoizedState;if(I!==null){d.pending=null;var $=I=I.next;do M=i(M,$.action),$=$.next;while($!==I);ni(M,a.memoizedState)||(Ii=!0),a.memoizedState=M,a.baseQueue===null&&(a.baseState=M),d.lastRenderedState=M}return[M,v]}function un(){}function oh(i,a){var d=zr,v=fs(),I=a(),M=!ni(v.memoizedState,I);if(M&&(v.memoizedState=I,Ii=!0),v=v.queue,lc(No.bind(null,d,v,i),[i]),v.getSnapshot!==a||M||vn!==null&&vn.memoizedState.tag&1){if(d.flags|=2048,oc(9,Oo.bind(null,d,v,I,a),void 0,null),zn===null)throw Error(b(349));(Ds&30)!==0||cd(d,a,I)}return I}function cd(i,a,d){i.flags|=16384,i={getSnapshot:a,value:d},a=zr.updateQueue,a===null?(a={lastEffect:null,stores:null},zr.updateQueue=a,a.stores=[i]):(d=a.stores,d===null?a.stores=[i]:d.push(i))}function Oo(i,a,d,v){a.value=d,a.getSnapshot=v,ac(a)&&lh(i)}function No(i,a,d){return d(function(){ac(a)&&lh(i)})}function ac(i){var a=i.getSnapshot;i=i.value;try{var d=a();return!ni(i,d)}catch{return!0}}function lh(i){var a=ai(i,1);a!==null&&sa(a,i,1,-1)}function hd(i){var a=Kn();return typeof i=="function"&&(i=i()),a.memoizedState=a.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:na,lastRenderedState:i},a.queue=i,i=i.dispatch=mu.bind(null,zr,i),[a.memoizedState,i]}function oc(i,a,d,v){return i={tag:i,create:a,destroy:d,deps:v,next:null},a=zr.updateQueue,a===null?(a={lastEffect:null,stores:null},zr.updateQueue=a,a.lastEffect=i.next=i):(d=a.lastEffect,d===null?a.lastEffect=i.next=i:(v=d.next,d.next=i,i.next=v,a.lastEffect=i)),i}function dd(){return fs().memoizedState}function uh(i,a,d,v){var I=Kn();zr.flags|=i,I.memoizedState=oc(1|a,d,void 0,v===void 0?null:v)}function fu(i,a,d,v){var I=fs();v=v===void 0?null:v;var M=void 0;if(Jr!==null){var $=Jr.memoizedState;if(M=$.destroy,v!==null&&Fo(v,$.deps)){I.memoizedState=oc(a,d,M,v);return}}zr.flags|=i,I.memoizedState=oc(1|a,d,M,v)}function op(i,a){return uh(8390656,8,i,a)}function lc(i,a){return fu(2048,8,i,a)}function pd(i,a){return fu(4,2,i,a)}function fd(i,a){return fu(4,4,i,a)}function kl(i,a){if(typeof a=="function")return i=i(),a(i),function(){a(null)};if(a!=null)return i=i(),a.current=i,function(){a.current=null}}function lp(i,a,d){return d=d!=null?d.concat([i]):null,fu(4,4,kl.bind(null,a,i),d)}function Tl(){}function uc(i,a){var d=fs();a=a===void 0?null:a;var v=d.memoizedState;return v!==null&&a!==null&&Fo(a,v[1])?v[0]:(d.memoizedState=[i,a],i)}function cc(i,a){var d=fs();a=a===void 0?null:a;var v=d.memoizedState;return v!==null&&a!==null&&Fo(a,v[1])?v[0]:(i=i(),d.memoizedState=[i,a],i)}function md(i,a,d){return(Ds&21)===0?(i.baseState&&(i.baseState=!1,Ii=!0),i.memoizedState=d):(ni(d,a)||(d=Us(),zr.lanes|=d,Cl|=d,i.baseState=!0),a)}function up(i,a){var d=Sr;Sr=d!==0&&4>d?d:4,i(!0);var v=Bo.transition;Bo.transition={};try{i(!1),a()}finally{Sr=d,Bo.transition=v}}function cp(){return fs().memoizedState}function oi(i,a,d){var v=Zo(i);if(d={lane:v,action:d,hasEagerState:!1,eagerState:null,next:null},ch(i))gd(a,d);else if(d=ls(i,a,d,v),d!==null){var I=Ei();sa(d,i,v,I),gu(d,a,v)}}function mu(i,a,d){var v=Zo(i),I={lane:v,action:d,hasEagerState:!1,eagerState:null,next:null};if(ch(i))gd(a,I);else{var M=i.alternate;if(i.lanes===0&&(M===null||M.lanes===0)&&(M=a.lastRenderedReducer,M!==null))try{var $=a.lastRenderedState,oe=M($,d);if(I.hasEagerState=!0,I.eagerState=oe,ni(oe,$)){var pe=a.interleaved;pe===null?(I.next=I,Mn(a)):(I.next=pe.next,pe.next=I),a.interleaved=I;return}}catch{}finally{}d=ls(i,a,I,v),d!==null&&(I=Ei(),sa(d,i,v,I),gu(d,a,v))}}function ch(i){var a=i.alternate;return i===zr||a!==null&&a===zr}function gd(i,a){pu=ic=!0;var d=i.pending;d===null?a.next=a:(a.next=d.next,d.next=a),i.pending=a}function gu(i,a,d){if((d&4194240)!==0){var v=a.lanes;v&=i.pendingLanes,d|=v,a.lanes=d,ga(i,d)}}var hh={readContext:Vr,useCallback:In,useContext:In,useEffect:In,useImperativeHandle:In,useInsertionEffect:In,useLayoutEffect:In,useMemo:In,useReducer:In,useRef:In,useState:In,useDebugValue:In,useDeferredValue:In,useTransition:In,useMutableSource:In,useSyncExternalStore:In,useId:In,unstable_isNewReconciler:!1},dh={readContext:Vr,useCallback:function(i,a){return Kn().memoizedState=[i,a===void 0?null:a],i},useContext:Vr,useEffect:op,useImperativeHandle:function(i,a,d){return d=d!=null?d.concat([i]):null,uh(4194308,4,kl.bind(null,a,i),d)},useLayoutEffect:function(i,a){return uh(4194308,4,i,a)},useInsertionEffect:function(i,a){return uh(4,2,i,a)},useMemo:function(i,a){var d=Kn();return a=a===void 0?null:a,i=i(),d.memoizedState=[i,a],i},useReducer:function(i,a,d){var v=Kn();return a=d!==void 0?d(a):a,v.memoizedState=v.baseState=a,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:a},v.queue=i,i=i.dispatch=oi.bind(null,zr,i),[v.memoizedState,i]},useRef:function(i){var a=Kn();return i={current:i},a.memoizedState=i},useState:hd,useDebugValue:Tl,useDeferredValue:function(i){return Kn().memoizedState=i},useTransition:function(){var i=hd(!1),a=i[0];return i=up.bind(null,i[1]),Kn().memoizedState=i,[a,i]},useMutableSource:function(){},useSyncExternalStore:function(i,a,d){var v=zr,I=Kn();if(re){if(d===void 0)throw Error(b(407));d=d()}else{if(d=a(),zn===null)throw Error(b(349));(Ds&30)!==0||cd(v,a,d)}I.memoizedState=d;var M={value:d,getSnapshot:a};return I.queue=M,op(No.bind(null,v,M,i),[i]),v.flags|=2048,oc(9,Oo.bind(null,v,M,d,a),void 0,null),d},useId:function(){var i=Kn(),a=zn.identifierPrefix;if(re){var d=A,v=E;d=(v&~(1<<32-Er(v)-1)).toString(32)+d,a=":"+a+"R"+d,d=sc++,0<d&&(a+="H"+d.toString(32)),a+=":"}else d=ld++,a=":"+a+"r"+d.toString(32)+":";return i.memoizedState=a},unstable_isNewReconciler:!1},Ef={readContext:Vr,useCallback:uc,useContext:Vr,useEffect:lc,useImperativeHandle:lp,useInsertionEffect:pd,useLayoutEffect:fd,useMemo:cc,useReducer:ud,useRef:dd,useState:function(){return ud(na)},useDebugValue:Tl,useDeferredValue:function(i){var a=fs();return md(a,Jr.memoizedState,i)},useTransition:function(){var i=ud(na)[0],a=fs().memoizedState;return[i,a]},useMutableSource:un,useSyncExternalStore:oh,useId:cp,unstable_isNewReconciler:!1},hp={readContext:Vr,useCallback:uc,useContext:Vr,useEffect:lc,useImperativeHandle:lp,useInsertionEffect:pd,useLayoutEffect:fd,useMemo:cc,useReducer:ah,useRef:dd,useState:function(){return ah(na)},useDebugValue:Tl,useDeferredValue:function(i){var a=fs();return Jr===null?a.memoizedState=i:md(a,Jr.memoizedState,i)},useTransition:function(){var i=ah(na)[0],a=fs().memoizedState;return[i,a]},useMutableSource:un,useSyncExternalStore:oh,useId:cp,unstable_isNewReconciler:!1};function Ls(i,a){if(i&&i.defaultProps){a=ft({},a),i=i.defaultProps;for(var d in i)a[d]===void 0&&(a[d]=i[d]);return a}return a}function ph(i,a,d,v){a=i.memoizedState,d=d(v,a),d=d==null?a:ft({},a,d),i.memoizedState=d,i.lanes===0&&(i.updateQueue.baseState=d)}var fh={isMounted:function(i){return(i=i._reactInternals)?Wt(i)===i:!1},enqueueSetState:function(i,a,d){i=i._reactInternals;var v=Ei(),I=Zo(i),M=Oi(v,I);M.payload=a,d!=null&&(M.callback=d),a=zs(i,M,I),a!==null&&(sa(a,i,I,v),Hn(a,i,I))},enqueueReplaceState:function(i,a,d){i=i._reactInternals;var v=Ei(),I=Zo(i),M=Oi(v,I);M.tag=1,M.payload=a,d!=null&&(M.callback=d),a=zs(i,M,I),a!==null&&(sa(a,i,I,v),Hn(a,i,I))},enqueueForceUpdate:function(i,a){i=i._reactInternals;var d=Ei(),v=Zo(i),I=Oi(d,v);I.tag=2,a!=null&&(I.callback=a),a=zs(i,I,v),a!==null&&(sa(a,i,v,d),Hn(a,i,v))}};function mh(i,a,d,v,I,M,$){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(v,M,$):a.prototype&&a.prototype.isPureReactComponent?!Sa(d,v)||!Sa(I,M):!0}function yd(i,a,d){var v=!1,I=Pa,M=a.contextType;return typeof M=="object"&&M!==null?M=Vr(M):(I=Cn(a)?Fi:Cr.current,v=a.contextTypes,M=(v=v!=null)?ta(i,I):Pa),a=new a(d,M),i.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,a.updater=fh,i.stateNode=a,a._reactInternals=i,v&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=I,i.__reactInternalMemoizedMaskedChildContext=M),a}function gh(i,a,d,v){i=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(d,v),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(d,v),a.state!==i&&fh.enqueueReplaceState(a,a.state,null)}function Il(i,a,d,v){var I=i.stateNode;I.props=d,I.state=i.memoizedState,I.refs={},Ca(i);var M=a.contextType;typeof M=="object"&&M!==null?I.context=Vr(M):(M=Cn(a)?Fi:Cr.current,I.context=ta(i,M)),I.state=i.memoizedState,M=a.getDerivedStateFromProps,typeof M=="function"&&(ph(i,a,M,d),I.state=i.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof I.getSnapshotBeforeUpdate=="function"||typeof I.UNSAFE_componentWillMount!="function"&&typeof I.componentWillMount!="function"||(a=I.state,typeof I.componentWillMount=="function"&&I.componentWillMount(),typeof I.UNSAFE_componentWillMount=="function"&&I.UNSAFE_componentWillMount(),a!==I.state&&fh.enqueueReplaceState(I,I.state,null),cs(i,d,I,v),I.state=i.memoizedState),typeof I.componentDidMount=="function"&&(i.flags|=4194308)}function Fn(i,a){try{var d="",v=a;do d+=ir(v),v=v.return;while(v);var I=d}catch(M){I=`
Error generating stack: `+M.message+`
`+M.stack}return{value:i,source:a,stack:I,digest:null}}function yh(i,a,d){return{value:i,source:null,stack:d??null,digest:a??null}}function hc(i,a){try{console.error(a.value)}catch(d){setTimeout(function(){throw d})}}var Pf=typeof WeakMap=="function"?WeakMap:Map;function _d(i,a,d){d=Oi(-1,d),d.tag=3,d.payload={element:null};var v=a.value;return d.callback=function(){wc||(wc=!0,Ph=v),hc(i,a)},d}function dp(i,a,d){d=Oi(-1,d),d.tag=3;var v=i.type.getDerivedStateFromError;if(typeof v=="function"){var I=a.value;d.payload=function(){return v(I)},d.callback=function(){hc(i,a)}}var M=i.stateNode;return M!==null&&typeof M.componentDidCatch=="function"&&(d.callback=function(){hc(i,a),typeof v!="function"&&(pr===null?pr=new Set([this]):pr.add(this));var $=a.stack;this.componentDidCatch(a.value,{componentStack:$!==null?$:""})}),d}function pp(i,a,d){var v=i.pingCache;if(v===null){v=i.pingCache=new Pf;var I=new Set;v.set(a,I)}else I=v.get(a),I===void 0&&(I=new Set,v.set(a,I));I.has(d)||(I.add(d),i=Lf.bind(null,i,a,d),a.then(i,i))}function fp(i){do{var a;if((a=i.tag===13)&&(a=i.memoizedState,a=a!==null?a.dehydrated!==null:!0),a)return i;i=i.return}while(i!==null);return null}function mp(i,a,d,v,I){return(i.mode&1)===0?(i===a?i.flags|=65536:(i.flags|=128,d.flags|=131072,d.flags&=-52805,d.tag===1&&(d.alternate===null?d.tag=17:(a=Oi(-1,1),a.tag=2,zs(d,a,1))),d.lanes|=1),i):(i.flags|=65536,i.lanes=I,i)}var gp=et.ReactCurrentOwner,Ii=!1;function xn(i,a,d,v){a.child=i===null?Ot(a,null,d,v):st(a,i.child,d,v)}function yu(i,a,d,v,I){d=d.render;var M=a.ref;return _n(a,I),v=ra(i,a,d,v,M,I),d=ps(),i!==null&&!Ii?(a.updateQueue=i.updateQueue,a.flags&=-2053,i.lanes&=~I,ms(i,a,I)):(re&&d&&U(a),a.flags|=1,xn(i,a,v,I),a.child)}function yp(i,a,d,v,I){if(i===null){var M=d.type;return typeof M=="function"&&!Pc(M)&&M.defaultProps===void 0&&d.compare===null&&d.defaultProps===void 0?(a.tag=15,a.type=M,_p(i,a,M,v,I)):(i=Cc(d.type,null,v,a,a.mode,I),i.ref=a.ref,i.return=a,a.child=i)}if(M=i.child,(i.lanes&I)===0){var $=M.memoizedProps;if(d=d.compare,d=d!==null?d:Sa,d($,v)&&i.ref===a.ref)return ms(i,a,I)}return a.flags|=1,i=Go(M,v),i.ref=a.ref,i.return=a,a.child=i}function _p(i,a,d,v,I){if(i!==null){var M=i.memoizedProps;if(Sa(M,v)&&i.ref===a.ref)if(Ii=!1,a.pendingProps=v=M,(i.lanes&I)!==0)(i.flags&131072)!==0&&(Ii=!0);else return a.lanes=i.lanes,ms(i,a,I)}return vd(i,a,d,v,I)}function vp(i,a,d){var v=a.pendingProps,I=v.children,M=i!==null?i.memoizedState:null;if(v.mode==="hidden")if((a.mode&1)===0)a.memoizedState={baseLanes:0,cachePool:null,transitions:null},jr(xu,ci),ci|=d;else{if((d&1073741824)===0)return i=M!==null?M.baseLanes|d:d,a.lanes=a.childLanes=1073741824,a.memoizedState={baseLanes:i,cachePool:null,transitions:null},a.updateQueue=null,jr(xu,ci),ci|=i,null;a.memoizedState={baseLanes:0,cachePool:null,transitions:null},v=M!==null?M.baseLanes:d,jr(xu,ci),ci|=v}else M!==null?(v=M.baseLanes|d,a.memoizedState=null):v=d,jr(xu,ci),ci|=v;return xn(i,a,I,d),a.child}function xp(i,a){var d=a.ref;(i===null&&d!==null||i!==null&&i.ref!==d)&&(a.flags|=512,a.flags|=2097152)}function vd(i,a,d,v,I){var M=Cn(d)?Fi:Cr.current;return M=ta(a,M),_n(a,I),d=ra(i,a,d,v,M,I),v=ps(),i!==null&&!Ii?(a.updateQueue=i.updateQueue,a.flags&=-2053,i.lanes&=~I,ms(i,a,I)):(re&&v&&U(a),a.flags|=1,xn(i,a,d,I),a.child)}function wp(i,a,d,v,I){if(Cn(d)){var M=!0;wi(a)}else M=!1;if(_n(a,I),a.stateNode===null)fc(i,a),yd(a,d,v),Il(a,d,v,I),v=!0;else if(i===null){var $=a.stateNode,oe=a.memoizedProps;$.props=oe;var pe=$.context,Ce=d.contextType;typeof Ce=="object"&&Ce!==null?Ce=Vr(Ce):(Ce=Cn(d)?Fi:Cr.current,Ce=ta(a,Ce));var Ze=d.getDerivedStateFromProps,We=typeof Ze=="function"||typeof $.getSnapshotBeforeUpdate=="function";We||typeof $.UNSAFE_componentWillReceiveProps!="function"&&typeof $.componentWillReceiveProps!="function"||(oe!==v||pe!==Ce)&&gh(a,$,v,Ce),us=!1;var qe=a.memoizedState;$.state=qe,cs(a,v,$,I),pe=a.memoizedState,oe!==v||qe!==pe||ur.current||us?(typeof Ze=="function"&&(ph(a,d,Ze,v),pe=a.memoizedState),(oe=us||mh(a,d,oe,v,qe,pe,Ce))?(We||typeof $.UNSAFE_componentWillMount!="function"&&typeof $.componentWillMount!="function"||(typeof $.componentWillMount=="function"&&$.componentWillMount(),typeof $.UNSAFE_componentWillMount=="function"&&$.UNSAFE_componentWillMount()),typeof $.componentDidMount=="function"&&(a.flags|=4194308)):(typeof $.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=v,a.memoizedState=pe),$.props=v,$.state=pe,$.context=Ce,v=oe):(typeof $.componentDidMount=="function"&&(a.flags|=4194308),v=!1)}else{$=a.stateNode,Si(i,a),oe=a.memoizedProps,Ce=a.type===a.elementType?oe:Ls(a.type,oe),$.props=Ce,We=a.pendingProps,qe=$.context,pe=d.contextType,typeof pe=="object"&&pe!==null?pe=Vr(pe):(pe=Cn(d)?Fi:Cr.current,pe=ta(a,pe));var ht=d.getDerivedStateFromProps;(Ze=typeof ht=="function"||typeof $.getSnapshotBeforeUpdate=="function")||typeof $.UNSAFE_componentWillReceiveProps!="function"&&typeof $.componentWillReceiveProps!="function"||(oe!==We||qe!==pe)&&gh(a,$,v,pe),us=!1,qe=a.memoizedState,$.state=qe,cs(a,v,$,I);var bt=a.memoizedState;oe!==We||qe!==bt||ur.current||us?(typeof ht=="function"&&(ph(a,d,ht,v),bt=a.memoizedState),(Ce=us||mh(a,d,Ce,v,qe,bt,pe)||!1)?(Ze||typeof $.UNSAFE_componentWillUpdate!="function"&&typeof $.componentWillUpdate!="function"||(typeof $.componentWillUpdate=="function"&&$.componentWillUpdate(v,bt,pe),typeof $.UNSAFE_componentWillUpdate=="function"&&$.UNSAFE_componentWillUpdate(v,bt,pe)),typeof $.componentDidUpdate=="function"&&(a.flags|=4),typeof $.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof $.componentDidUpdate!="function"||oe===i.memoizedProps&&qe===i.memoizedState||(a.flags|=4),typeof $.getSnapshotBeforeUpdate!="function"||oe===i.memoizedProps&&qe===i.memoizedState||(a.flags|=1024),a.memoizedProps=v,a.memoizedState=bt),$.props=v,$.state=bt,$.context=pe,v=Ce):(typeof $.componentDidUpdate!="function"||oe===i.memoizedProps&&qe===i.memoizedState||(a.flags|=4),typeof $.getSnapshotBeforeUpdate!="function"||oe===i.memoizedProps&&qe===i.memoizedState||(a.flags|=1024),v=!1)}return xd(i,a,d,v,M,I)}function xd(i,a,d,v,I,M){xp(i,a);var $=(a.flags&128)!==0;if(!v&&!$)return I&&Do(a,d,!1),ms(i,a,M);v=a.stateNode,gp.current=a;var oe=$&&typeof d.getDerivedStateFromError!="function"?null:v.render();return a.flags|=1,i!==null&&$?(a.child=st(a,i.child,null,M),a.child=st(a,null,oe,M)):xn(i,a,oe,M),a.memoizedState=v.state,I&&Do(a,d,!0),a.child}function _h(i){var a=i.stateNode;a.pendingContext?Ao(i,a.pendingContext,a.pendingContext!==a.context):a.context&&Ao(i,a.context,!1),Ma(i,a.containerInfo)}function bp(i,a,d,v,I){return Qe(),ct(I),a.flags|=256,xn(i,a,d,v),a.child}var jo={dehydrated:null,treeContext:null,retryLane:0};function wd(i){return{baseLanes:i,cachePool:null,transitions:null}}function nn(i,a,d){var v=a.pendingProps,I=Hr.current,M=!1,$=(a.flags&128)!==0,oe;if((oe=$)||(oe=i!==null&&i.memoizedState===null?!1:(I&2)!==0),oe?(M=!0,a.flags&=-129):(i===null||i.memoizedState!==null)&&(I|=1),jr(Hr,I&1),i===null)return ye(a),i=a.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?((a.mode&1)===0?a.lanes=1:i.data==="$!"?a.lanes=8:a.lanes=1073741824,null):($=v.children,i=v.fallback,M?(v=a.mode,M=a.child,$={mode:"hidden",children:$},(v&1)===0&&M!==null?(M.childLanes=0,M.pendingProps=$):M=Ko($,v,0,null),i=Ho(i,v,d,null),M.return=a,i.return=a,M.sibling=i,a.child=M,a.child.memoizedState=wd(d),a.memoizedState=jo,i):_u(a,$));if(I=i.memoizedState,I!==null&&(oe=I.dehydrated,oe!==null))return vh(i,a,$,v,oe,I,d);if(M){M=v.fallback,$=a.mode,I=i.child,oe=I.sibling;var pe={mode:"hidden",children:v.children};return($&1)===0&&a.child!==I?(v=a.child,v.childLanes=0,v.pendingProps=pe,a.deletions=null):(v=Go(I,pe),v.subtreeFlags=I.subtreeFlags&14680064),oe!==null?M=Go(oe,M):(M=Ho(M,$,d,null),M.flags|=2),M.return=a,v.return=a,v.sibling=M,a.child=v,v=M,M=a.child,$=i.child.memoizedState,$=$===null?wd(d):{baseLanes:$.baseLanes|d,cachePool:null,transitions:$.transitions},M.memoizedState=$,M.childLanes=i.childLanes&~d,a.memoizedState=jo,v}return M=i.child,i=M.sibling,v=Go(M,{mode:"visible",children:v.children}),(a.mode&1)===0&&(v.lanes=d),v.return=a,v.sibling=null,i!==null&&(d=a.deletions,d===null?(a.deletions=[i],a.flags|=16):d.push(i)),a.child=v,a.memoizedState=null,v}function _u(i,a){return a=Ko({mode:"visible",children:a},i.mode,0,null),a.return=i,i.child=a}function dc(i,a,d,v){return v!==null&&ct(v),st(a,i.child,null,d),i=_u(a,a.pendingProps.children),i.flags|=2,a.memoizedState=null,i}function vh(i,a,d,v,I,M,$){if(d)return a.flags&256?(a.flags&=-257,v=yh(Error(b(422))),dc(i,a,$,v)):a.memoizedState!==null?(a.child=i.child,a.flags|=128,null):(M=v.fallback,I=a.mode,v=Ko({mode:"visible",children:v.children},I,0,null),M=Ho(M,I,$,null),M.flags|=2,v.return=a,M.return=a,v.sibling=M,a.child=v,(a.mode&1)!==0&&st(a,i.child,null,$),a.child.memoizedState=wd($),a.memoizedState=jo,M);if((a.mode&1)===0)return dc(i,a,$,null);if(I.data==="$!"){if(v=I.nextSibling&&I.nextSibling.dataset,v)var oe=v.dgst;return v=oe,M=Error(b(419)),v=yh(M,v,void 0),dc(i,a,$,v)}if(oe=($&i.childLanes)!==0,Ii||oe){if(v=zn,v!==null){switch($&-$){case 4:I=2;break;case 16:I=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:I=32;break;case 536870912:I=268435456;break;default:I=0}I=(I&(v.suspendedLanes|$))!==0?0:I,I!==0&&I!==M.retryLane&&(M.retryLane=I,ai(i,I),sa(v,i,I,-1))}return Ah(),v=yh(Error(b(421))),dc(i,a,$,v)}return I.data==="$?"?(a.flags|=128,a.child=i.child,a=Op.bind(null,i),I._reactRetry=a,null):(i=M.treeContext,J=ss(I.nextSibling),W=a,re=!0,se=null,i!==null&&(p[w++]=E,p[w++]=A,p[w++]=k,E=i.id,A=i.overflow,k=a),a=_u(a,v.children),a.flags|=4096,a)}function pc(i,a,d){i.lanes|=a;var v=i.alternate;v!==null&&(v.lanes|=a),Ar(i.return,a,d)}function El(i,a,d,v,I){var M=i.memoizedState;M===null?i.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:v,tail:d,tailMode:I}:(M.isBackwards=a,M.rendering=null,M.renderingStartTime=0,M.last=v,M.tail=d,M.tailMode=I)}function bd(i,a,d){var v=a.pendingProps,I=v.revealOrder,M=v.tail;if(xn(i,a,v.children,d),v=Hr.current,(v&2)!==0)v=v&1|2,a.flags|=128;else{if(i!==null&&(i.flags&128)!==0)e:for(i=a.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&pc(i,d,a);else if(i.tag===19)pc(i,d,a);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===a)break e;for(;i.sibling===null;){if(i.return===null||i.return===a)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}v&=1}if(jr(Hr,v),(a.mode&1)===0)a.memoizedState=null;else switch(I){case"forwards":for(d=a.child,I=null;d!==null;)i=d.alternate,i!==null&&ds(i)===null&&(I=d),d=d.sibling;d=I,d===null?(I=a.child,a.child=null):(I=d.sibling,d.sibling=null),El(a,!1,I,d,M);break;case"backwards":for(d=null,I=a.child,a.child=null;I!==null;){if(i=I.alternate,i!==null&&ds(i)===null){a.child=I;break}i=I.sibling,I.sibling=d,d=I,I=i}El(a,!0,d,null,M);break;case"together":El(a,!1,null,null,void 0);break;default:a.memoizedState=null}return a.child}function fc(i,a){(a.mode&1)===0&&i!==null&&(i.alternate=null,a.alternate=null,a.flags|=2)}function ms(i,a,d){if(i!==null&&(a.dependencies=i.dependencies),Cl|=a.lanes,(d&a.childLanes)===0)return null;if(i!==null&&a.child!==i.child)throw Error(b(153));if(a.child!==null){for(i=a.child,d=Go(i,i.pendingProps),a.child=d,d.return=a;i.sibling!==null;)i=i.sibling,d=d.sibling=Go(i,i.pendingProps),d.return=a;d.sibling=null}return a.child}function Sd(i,a,d){switch(a.tag){case 3:_h(a),Qe();break;case 5:rc(a);break;case 1:Cn(a.type)&&wi(a);break;case 4:Ma(a,a.stateNode.containerInfo);break;case 10:var v=a.type._context,I=a.memoizedProps.value;jr(Pr,v._currentValue),v._currentValue=I;break;case 13:if(v=a.memoizedState,v!==null)return v.dehydrated!==null?(jr(Hr,Hr.current&1),a.flags|=128,null):(d&a.child.childLanes)!==0?nn(i,a,d):(jr(Hr,Hr.current&1),i=ms(i,a,d),i!==null?i.sibling:null);jr(Hr,Hr.current&1);break;case 19:if(v=(d&a.childLanes)!==0,(i.flags&128)!==0){if(v)return bd(i,a,d);a.flags|=128}if(I=a.memoizedState,I!==null&&(I.rendering=null,I.tail=null,I.lastEffect=null),jr(Hr,Hr.current),v)break;return null;case 22:case 23:return a.lanes=0,vp(i,a,d)}return ms(i,a,d)}var xh,mc,wh,kd;xh=function(i,a){for(var d=a.child;d!==null;){if(d.tag===5||d.tag===6)i.appendChild(d.stateNode);else if(d.tag!==4&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===a)break;for(;d.sibling===null;){if(d.return===null||d.return===a)return;d=d.return}d.sibling.return=d.return,d=d.sibling}},mc=function(){},wh=function(i,a,d,v){var I=i.memoizedProps;if(I!==v){i=a.stateNode,Ti(qr.current);var M=null;switch(d){case"input":I=bs(i,I),v=bs(i,v),M=[];break;case"select":I=ft({},I,{value:void 0}),v=ft({},v,{value:void 0}),M=[];break;case"textarea":I=ks(i,I),v=ks(i,v),M=[];break;default:typeof I.onClick!="function"&&typeof v.onClick=="function"&&(i.onclick=si)}Ln(d,v);var $;d=null;for(Ce in I)if(!v.hasOwnProperty(Ce)&&I.hasOwnProperty(Ce)&&I[Ce]!=null)if(Ce==="style"){var oe=I[Ce];for($ in oe)oe.hasOwnProperty($)&&(d||(d={}),d[$]="")}else Ce!=="dangerouslySetInnerHTML"&&Ce!=="children"&&Ce!=="suppressContentEditableWarning"&&Ce!=="suppressHydrationWarning"&&Ce!=="autoFocus"&&(D.hasOwnProperty(Ce)?M||(M=[]):(M=M||[]).push(Ce,null));for(Ce in v){var pe=v[Ce];if(oe=I!=null?I[Ce]:void 0,v.hasOwnProperty(Ce)&&pe!==oe&&(pe!=null||oe!=null))if(Ce==="style")if(oe){for($ in oe)!oe.hasOwnProperty($)||pe&&pe.hasOwnProperty($)||(d||(d={}),d[$]="");for($ in pe)pe.hasOwnProperty($)&&oe[$]!==pe[$]&&(d||(d={}),d[$]=pe[$])}else d||(M||(M=[]),M.push(Ce,d)),d=pe;else Ce==="dangerouslySetInnerHTML"?(pe=pe?pe.__html:void 0,oe=oe?oe.__html:void 0,pe!=null&&oe!==pe&&(M=M||[]).push(Ce,pe)):Ce==="children"?typeof pe!="string"&&typeof pe!="number"||(M=M||[]).push(Ce,""+pe):Ce!=="suppressContentEditableWarning"&&Ce!=="suppressHydrationWarning"&&(D.hasOwnProperty(Ce)?(pe!=null&&Ce==="onScroll"&&Rr("scroll",i),M||oe===pe||(M=[])):(M=M||[]).push(Ce,pe))}d&&(M=M||[]).push("style",d);var Ce=M;(a.updateQueue=Ce)&&(a.flags|=4)}},kd=function(i,a,d,v){d!==v&&(a.flags|=4)};function vu(i,a){if(!re)switch(i.tailMode){case"hidden":a=i.tail;for(var d=null;a!==null;)a.alternate!==null&&(d=a),a=a.sibling;d===null?i.tail=null:d.sibling=null;break;case"collapsed":d=i.tail;for(var v=null;d!==null;)d.alternate!==null&&(v=d),d=d.sibling;v===null?a||i.tail===null?i.tail=null:i.tail.sibling=null:v.sibling=null}}function li(i){var a=i.alternate!==null&&i.alternate.child===i.child,d=0,v=0;if(a)for(var I=i.child;I!==null;)d|=I.lanes|I.childLanes,v|=I.subtreeFlags&14680064,v|=I.flags&14680064,I.return=i,I=I.sibling;else for(I=i.child;I!==null;)d|=I.lanes|I.childLanes,v|=I.subtreeFlags,v|=I.flags,I.return=i,I=I.sibling;return i.subtreeFlags|=v,i.childLanes=d,a}function Cf(i,a,d){var v=a.pendingProps;switch(G(a),a.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return li(a),null;case 1:return Cn(a.type)&&bl(),li(a),null;case 3:return v=a.stateNode,hs(),Br(ur),Br(Cr),Ro(),v.pendingContext&&(v.context=v.pendingContext,v.pendingContext=null),(i===null||i.child===null)&&(Fe(a)?a.flags|=4:i===null||i.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,se!==null&&(Pd(se),se=null))),mc(i,a),li(a),null;case 5:nc(a);var I=Ti(nr.current);if(d=a.type,i!==null&&a.stateNode!=null)wh(i,a,d,v,I),i.ref!==a.ref&&(a.flags|=512,a.flags|=2097152);else{if(!v){if(a.stateNode===null)throw Error(b(166));return li(a),null}if(i=Ti(qr.current),Fe(a)){v=a.stateNode,d=a.type;var M=a.memoizedProps;switch(v[Gn]=a,v[As]=M,i=(a.mode&1)!==0,d){case"dialog":Rr("cancel",v),Rr("close",v);break;case"iframe":case"object":case"embed":Rr("load",v);break;case"video":case"audio":for(I=0;I<Ia.length;I++)Rr(Ia[I],v);break;case"source":Rr("error",v);break;case"img":case"image":case"link":Rr("error",v),Rr("load",v);break;case"details":Rr("toggle",v);break;case"input":Ba(v,M),Rr("invalid",v);break;case"select":v._wrapperState={wasMultiple:!!M.multiple},Rr("invalid",v);break;case"textarea":Ts(v,M),Rr("invalid",v)}Ln(d,M),I=null;for(var $ in M)if(M.hasOwnProperty($)){var oe=M[$];$==="children"?typeof oe=="string"?v.textContent!==oe&&(M.suppressHydrationWarning!==!0&&Co(v.textContent,oe,i),I=["children",oe]):typeof oe=="number"&&v.textContent!==""+oe&&(M.suppressHydrationWarning!==!0&&Co(v.textContent,oe,i),I=["children",""+oe]):D.hasOwnProperty($)&&oe!=null&&$==="onScroll"&&Rr("scroll",v)}switch(d){case"input":fa(v),co(v,M,!0);break;case"textarea":fa(v),mi(v);break;case"select":case"option":break;default:typeof M.onClick=="function"&&(v.onclick=si)}v=I,a.updateQueue=v,v!==null&&(a.flags|=4)}else{$=I.nodeType===9?I:I.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=ho(d)),i==="http://www.w3.org/1999/xhtml"?d==="script"?(i=$.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof v.is=="string"?i=$.createElement(d,{is:v.is}):(i=$.createElement(d),d==="select"&&($=i,v.multiple?$.multiple=!0:v.size&&($.size=v.size))):i=$.createElementNS(i,d),i[Gn]=a,i[As]=v,xh(i,a,!1,!1),a.stateNode=i;e:{switch($=gi(d,v),d){case"dialog":Rr("cancel",i),Rr("close",i),I=v;break;case"iframe":case"object":case"embed":Rr("load",i),I=v;break;case"video":case"audio":for(I=0;I<Ia.length;I++)Rr(Ia[I],i);I=v;break;case"source":Rr("error",i),I=v;break;case"img":case"image":case"link":Rr("error",i),Rr("load",i),I=v;break;case"details":Rr("toggle",i),I=v;break;case"input":Ba(i,v),I=bs(i,v),Rr("invalid",i);break;case"option":I=v;break;case"select":i._wrapperState={wasMultiple:!!v.multiple},I=ft({},v,{value:void 0}),Rr("invalid",i);break;case"textarea":Ts(i,v),I=ks(i,v),Rr("invalid",i);break;default:I=v}Ln(d,I),oe=I;for(M in oe)if(oe.hasOwnProperty(M)){var pe=oe[M];M==="style"?Jt(i,pe):M==="dangerouslySetInnerHTML"?(pe=pe?pe.__html:void 0,pe!=null&&Ji(i,pe)):M==="children"?typeof pe=="string"?(d!=="textarea"||pe!=="")&&gn(i,pe):typeof pe=="number"&&gn(i,""+pe):M!=="suppressContentEditableWarning"&&M!=="suppressHydrationWarning"&&M!=="autoFocus"&&(D.hasOwnProperty(M)?pe!=null&&M==="onScroll"&&Rr("scroll",i):pe!=null&&$e(i,M,pe,$))}switch(d){case"input":fa(i),co(i,v,!1);break;case"textarea":fa(i),mi(i);break;case"option":v.value!=null&&i.setAttribute("value",""+lr(v.value));break;case"select":i.multiple=!!v.multiple,M=v.value,M!=null?Ss(i,!!v.multiple,M,!1):v.defaultValue!=null&&Ss(i,!!v.multiple,v.defaultValue,!0);break;default:typeof I.onClick=="function"&&(i.onclick=si)}switch(d){case"button":case"input":case"select":case"textarea":v=!!v.autoFocus;break e;case"img":v=!0;break e;default:v=!1}}v&&(a.flags|=4)}a.ref!==null&&(a.flags|=512,a.flags|=2097152)}return li(a),null;case 6:if(i&&a.stateNode!=null)kd(i,a,i.memoizedProps,v);else{if(typeof v!="string"&&a.stateNode===null)throw Error(b(166));if(d=Ti(nr.current),Ti(qr.current),Fe(a)){if(v=a.stateNode,d=a.memoizedProps,v[Gn]=a,(M=v.nodeValue!==d)&&(i=W,i!==null))switch(i.tag){case 3:Co(v.nodeValue,d,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&Co(v.nodeValue,d,(i.mode&1)!==0)}M&&(a.flags|=4)}else v=(d.nodeType===9?d:d.ownerDocument).createTextNode(v),v[Gn]=a,a.stateNode=v}return li(a),null;case 13:if(Br(Hr),v=a.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(re&&J!==null&&(a.mode&1)!==0&&(a.flags&128)===0)Ge(),Qe(),a.flags|=98560,M=!1;else if(M=Fe(a),v!==null&&v.dehydrated!==null){if(i===null){if(!M)throw Error(b(318));if(M=a.memoizedState,M=M!==null?M.dehydrated:null,!M)throw Error(b(317));M[Gn]=a}else Qe(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;li(a),M=!1}else se!==null&&(Pd(se),se=null),M=!0;if(!M)return a.flags&65536?a:null}return(a.flags&128)!==0?(a.lanes=d,a):(v=v!==null,v!==(i!==null&&i.memoizedState!==null)&&v&&(a.child.flags|=8192,(a.mode&1)!==0&&(i===null||(Hr.current&1)!==0?En===0&&(En=3):Ah())),a.updateQueue!==null&&(a.flags|=4),li(a),null);case 4:return hs(),mc(i,a),i===null&&Ys(a.stateNode.containerInfo),li(a),null;case 10:return bi(a.type._context),li(a),null;case 17:return Cn(a.type)&&bl(),li(a),null;case 19:if(Br(Hr),M=a.memoizedState,M===null)return li(a),null;if(v=(a.flags&128)!==0,$=M.rendering,$===null)if(v)vu(M,!1);else{if(En!==0||i!==null&&(i.flags&128)!==0)for(i=a.child;i!==null;){if($=ds(i),$!==null){for(a.flags|=128,vu(M,!1),v=$.updateQueue,v!==null&&(a.updateQueue=v,a.flags|=4),a.subtreeFlags=0,v=d,d=a.child;d!==null;)M=d,i=v,M.flags&=14680066,$=M.alternate,$===null?(M.childLanes=0,M.lanes=i,M.child=null,M.subtreeFlags=0,M.memoizedProps=null,M.memoizedState=null,M.updateQueue=null,M.dependencies=null,M.stateNode=null):(M.childLanes=$.childLanes,M.lanes=$.lanes,M.child=$.child,M.subtreeFlags=0,M.deletions=null,M.memoizedProps=$.memoizedProps,M.memoizedState=$.memoizedState,M.updateQueue=$.updateQueue,M.type=$.type,i=$.dependencies,M.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),d=d.sibling;return jr(Hr,Hr.current&1|2),a.child}i=i.sibling}M.tail!==null&&Ut()>Kr&&(a.flags|=128,v=!0,vu(M,!1),a.lanes=4194304)}else{if(!v)if(i=ds($),i!==null){if(a.flags|=128,v=!0,d=i.updateQueue,d!==null&&(a.updateQueue=d,a.flags|=4),vu(M,!0),M.tail===null&&M.tailMode==="hidden"&&!$.alternate&&!re)return li(a),null}else 2*Ut()-M.renderingStartTime>Kr&&d!==1073741824&&(a.flags|=128,v=!0,vu(M,!1),a.lanes=4194304);M.isBackwards?($.sibling=a.child,a.child=$):(d=M.last,d!==null?d.sibling=$:a.child=$,M.last=$)}return M.tail!==null?(a=M.tail,M.rendering=a,M.tail=a.sibling,M.renderingStartTime=Ut(),a.sibling=null,d=Hr.current,jr(Hr,v?d&1|2:d&1),a):(li(a),null);case 22:case 23:return kc(),v=a.memoizedState!==null,i!==null&&i.memoizedState!==null!==v&&(a.flags|=8192),v&&(a.mode&1)!==0?(ci&1073741824)!==0&&(li(a),a.subtreeFlags&6&&(a.flags|=8192)):li(a),null;case 24:return null;case 25:return null}throw Error(b(156,a.tag))}function Mf(i,a){switch(G(a),a.tag){case 1:return Cn(a.type)&&bl(),i=a.flags,i&65536?(a.flags=i&-65537|128,a):null;case 3:return hs(),Br(ur),Br(Cr),Ro(),i=a.flags,(i&65536)!==0&&(i&128)===0?(a.flags=i&-65537|128,a):null;case 5:return nc(a),null;case 13:if(Br(Hr),i=a.memoizedState,i!==null&&i.dehydrated!==null){if(a.alternate===null)throw Error(b(340));Qe()}return i=a.flags,i&65536?(a.flags=i&-65537|128,a):null;case 19:return Br(Hr),null;case 4:return hs(),null;case 10:return bi(a.type._context),null;case 22:case 23:return kc(),null;case 24:return null;default:return null}}var bh=!1,ui=!1,Vo=typeof WeakSet=="function"?WeakSet:Set,Tt=null;function Pl(i,a){var d=i.ref;if(d!==null)if(typeof d=="function")try{d(null)}catch(v){Qr(i,a,v)}else d.current=null}function Uo(i,a,d){try{d()}catch(v){Qr(i,a,v)}}var Sp=!1;function Af(i,a){if(Qs=qa,i=iu(),ka(i)){if("selectionStart"in i)var d={start:i.selectionStart,end:i.selectionEnd};else e:{d=(d=i.ownerDocument)&&d.defaultView||window;var v=d.getSelection&&d.getSelection();if(v&&v.rangeCount!==0){d=v.anchorNode;var I=v.anchorOffset,M=v.focusNode;v=v.focusOffset;try{d.nodeType,M.nodeType}catch{d=null;break e}var $=0,oe=-1,pe=-1,Ce=0,Ze=0,We=i,qe=null;t:for(;;){for(var ht;We!==d||I!==0&&We.nodeType!==3||(oe=$+I),We!==M||v!==0&&We.nodeType!==3||(pe=$+v),We.nodeType===3&&($+=We.nodeValue.length),(ht=We.firstChild)!==null;)qe=We,We=ht;for(;;){if(We===i)break t;if(qe===d&&++Ce===I&&(oe=$),qe===M&&++Ze===v&&(pe=$),(ht=We.nextSibling)!==null)break;We=qe,qe=We.parentNode}We=ht}d=oe===-1||pe===-1?null:{start:oe,end:pe}}else d=null}d=d||{start:0,end:0}}else d=null;for(Ju={focusedElem:i,selectionRange:d},qa=!1,Tt=a;Tt!==null;)if(a=Tt,i=a.child,(a.subtreeFlags&1028)!==0&&i!==null)i.return=a,Tt=i;else for(;Tt!==null;){a=Tt;try{var bt=a.alternate;if((a.flags&1024)!==0)switch(a.tag){case 0:case 11:case 15:break;case 1:if(bt!==null){var Mt=bt.memoizedProps,dn=bt.memoizedState,Se=a.stateNode,ge=Se.getSnapshotBeforeUpdate(a.elementType===a.type?Mt:Ls(a.type,Mt),dn);Se.__reactInternalSnapshotBeforeUpdate=ge}break;case 3:var Te=a.stateNode.containerInfo;Te.nodeType===1?Te.textContent="":Te.nodeType===9&&Te.documentElement&&Te.removeChild(Te.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(b(163))}}catch(it){Qr(a,a.return,it)}if(i=a.sibling,i!==null){i.return=a.return,Tt=i;break}Tt=a.return}return bt=Sp,Sp=!1,bt}function gc(i,a,d){var v=a.updateQueue;if(v=v!==null?v.lastEffect:null,v!==null){var I=v=v.next;do{if((I.tag&i)===i){var M=I.destroy;I.destroy=void 0,M!==void 0&&Uo(a,d,M)}I=I.next}while(I!==v)}}function yc(i,a){if(a=a.updateQueue,a=a!==null?a.lastEffect:null,a!==null){var d=a=a.next;do{if((d.tag&i)===i){var v=d.create;d.destroy=v()}d=d.next}while(d!==a)}}function Sh(i){var a=i.ref;if(a!==null){var d=i.stateNode;switch(i.tag){case 5:i=d;break;default:i=d}typeof a=="function"?a(i):a.current=i}}function kp(i){var a=i.alternate;a!==null&&(i.alternate=null,kp(a)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(a=i.stateNode,a!==null&&(delete a[Gn],delete a[As],delete a[or],delete a[ec],delete a[od])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function Tp(i){return i.tag===5||i.tag===3||i.tag===4}function Ip(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||Tp(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function Td(i,a,d){var v=i.tag;if(v===5||v===6)i=i.stateNode,a?d.nodeType===8?d.parentNode.insertBefore(i,a):d.insertBefore(i,a):(d.nodeType===8?(a=d.parentNode,a.insertBefore(i,d)):(a=d,a.appendChild(i)),d=d._reactRootContainer,d!=null||a.onclick!==null||(a.onclick=si));else if(v!==4&&(i=i.child,i!==null))for(Td(i,a,d),i=i.sibling;i!==null;)Td(i,a,d),i=i.sibling}function _c(i,a,d){var v=i.tag;if(v===5||v===6)i=i.stateNode,a?d.insertBefore(i,a):d.appendChild(i);else if(v!==4&&(i=i.child,i!==null))for(_c(i,a,d),i=i.sibling;i!==null;)_c(i,a,d),i=i.sibling}var wn=null,gs=!1;function $o(i,a,d){for(d=d.child;d!==null;)Ep(i,a,d),d=d.sibling}function Ep(i,a,d){if(qn&&typeof qn.onCommitFiberUnmount=="function")try{qn.onCommitFiberUnmount(Bn,d)}catch{}switch(d.tag){case 5:ui||Pl(d,a);case 6:var v=wn,I=gs;wn=null,$o(i,a,d),wn=v,gs=I,wn!==null&&(gs?(i=wn,d=d.stateNode,i.nodeType===8?i.parentNode.removeChild(d):i.removeChild(d)):wn.removeChild(d.stateNode));break;case 18:wn!==null&&(gs?(i=wn,d=d.stateNode,i.nodeType===8?mt(i.parentNode,d):i.nodeType===1&&mt(i,d),$s(i)):mt(wn,d.stateNode));break;case 4:v=wn,I=gs,wn=d.stateNode.containerInfo,gs=!0,$o(i,a,d),wn=v,gs=I;break;case 0:case 11:case 14:case 15:if(!ui&&(v=d.updateQueue,v!==null&&(v=v.lastEffect,v!==null))){I=v=v.next;do{var M=I,$=M.destroy;M=M.tag,$!==void 0&&((M&2)!==0||(M&4)!==0)&&Uo(d,a,$),I=I.next}while(I!==v)}$o(i,a,d);break;case 1:if(!ui&&(Pl(d,a),v=d.stateNode,typeof v.componentWillUnmount=="function"))try{v.props=d.memoizedProps,v.state=d.memoizedState,v.componentWillUnmount()}catch(oe){Qr(d,a,oe)}$o(i,a,d);break;case 21:$o(i,a,d);break;case 22:d.mode&1?(ui=(v=ui)||d.memoizedState!==null,$o(i,a,d),ui=v):$o(i,a,d);break;default:$o(i,a,d)}}function Id(i){var a=i.updateQueue;if(a!==null){i.updateQueue=null;var d=i.stateNode;d===null&&(d=i.stateNode=new Vo),a.forEach(function(v){var I=Np.bind(null,i,v);d.has(v)||(d.add(v),v.then(I,I))})}}function ia(i,a){var d=a.deletions;if(d!==null)for(var v=0;v<d.length;v++){var I=d[v];try{var M=i,$=a,oe=$;e:for(;oe!==null;){switch(oe.tag){case 5:wn=oe.stateNode,gs=!1;break e;case 3:wn=oe.stateNode.containerInfo,gs=!0;break e;case 4:wn=oe.stateNode.containerInfo,gs=!0;break e}oe=oe.return}if(wn===null)throw Error(b(160));Ep(M,$,I),wn=null,gs=!1;var pe=I.alternate;pe!==null&&(pe.return=null),I.return=null}catch(Ce){Qr(I,a,Ce)}}if(a.subtreeFlags&12854)for(a=a.child;a!==null;)Pp(a,i),a=a.sibling}function Pp(i,a){var d=i.alternate,v=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(ia(a,i),ji(i),v&4){try{gc(3,i,i.return),yc(3,i)}catch(Mt){Qr(i,i.return,Mt)}try{gc(5,i,i.return)}catch(Mt){Qr(i,i.return,Mt)}}break;case 1:ia(a,i),ji(i),v&512&&d!==null&&Pl(d,d.return);break;case 5:if(ia(a,i),ji(i),v&512&&d!==null&&Pl(d,d.return),i.flags&32){var I=i.stateNode;try{gn(I,"")}catch(Mt){Qr(i,i.return,Mt)}}if(v&4&&(I=i.stateNode,I!=null)){var M=i.memoizedProps,$=d!==null?d.memoizedProps:M,oe=i.type,pe=i.updateQueue;if(i.updateQueue=null,pe!==null)try{oe==="input"&&M.type==="radio"&&M.name!=null&&Ee(I,M),gi(oe,$);var Ce=gi(oe,M);for($=0;$<pe.length;$+=2){var Ze=pe[$],We=pe[$+1];Ze==="style"?Jt(I,We):Ze==="dangerouslySetInnerHTML"?Ji(I,We):Ze==="children"?gn(I,We):$e(I,Ze,We,Ce)}switch(oe){case"input":js(I,M);break;case"textarea":Fa(I,M);break;case"select":var qe=I._wrapperState.wasMultiple;I._wrapperState.wasMultiple=!!M.multiple;var ht=M.value;ht!=null?Ss(I,!!M.multiple,ht,!1):qe!==!!M.multiple&&(M.defaultValue!=null?Ss(I,!!M.multiple,M.defaultValue,!0):Ss(I,!!M.multiple,M.multiple?[]:"",!1))}I[As]=M}catch(Mt){Qr(i,i.return,Mt)}}break;case 6:if(ia(a,i),ji(i),v&4){if(i.stateNode===null)throw Error(b(162));I=i.stateNode,M=i.memoizedProps;try{I.nodeValue=M}catch(Mt){Qr(i,i.return,Mt)}}break;case 3:if(ia(a,i),ji(i),v&4&&d!==null&&d.memoizedState.isDehydrated)try{$s(a.containerInfo)}catch(Mt){Qr(i,i.return,Mt)}break;case 4:ia(a,i),ji(i);break;case 13:ia(a,i),ji(i),I=i.child,I.flags&8192&&(M=I.memoizedState!==null,I.stateNode.isHidden=M,!M||I.alternate!==null&&I.alternate.memoizedState!==null||(Ml=Ut())),v&4&&Id(i);break;case 22:if(Ze=d!==null&&d.memoizedState!==null,i.mode&1?(ui=(Ce=ui)||Ze,ia(a,i),ui=Ce):ia(a,i),ji(i),v&8192){if(Ce=i.memoizedState!==null,(i.stateNode.isHidden=Ce)&&!Ze&&(i.mode&1)!==0)for(Tt=i,Ze=i.child;Ze!==null;){for(We=Tt=Ze;Tt!==null;){switch(qe=Tt,ht=qe.child,qe.tag){case 0:case 11:case 14:case 15:gc(4,qe,qe.return);break;case 1:Pl(qe,qe.return);var bt=qe.stateNode;if(typeof bt.componentWillUnmount=="function"){v=qe,d=qe.return;try{a=v,bt.props=a.memoizedProps,bt.state=a.memoizedState,bt.componentWillUnmount()}catch(Mt){Qr(v,d,Mt)}}break;case 5:Pl(qe,qe.return);break;case 22:if(qe.memoizedState!==null){zp(We);continue}}ht!==null?(ht.return=qe,Tt=ht):zp(We)}Ze=Ze.sibling}e:for(Ze=null,We=i;;){if(We.tag===5){if(Ze===null){Ze=We;try{I=We.stateNode,Ce?(M=I.style,typeof M.setProperty=="function"?M.setProperty("display","none","important"):M.display="none"):(oe=We.stateNode,pe=We.memoizedProps.style,$=pe!=null&&pe.hasOwnProperty("display")?pe.display:null,oe.style.display=rt("display",$))}catch(Mt){Qr(i,i.return,Mt)}}}else if(We.tag===6){if(Ze===null)try{We.stateNode.nodeValue=Ce?"":We.memoizedProps}catch(Mt){Qr(i,i.return,Mt)}}else if((We.tag!==22&&We.tag!==23||We.memoizedState===null||We===i)&&We.child!==null){We.child.return=We,We=We.child;continue}if(We===i)break e;for(;We.sibling===null;){if(We.return===null||We.return===i)break e;Ze===We&&(Ze=null),We=We.return}Ze===We&&(Ze=null),We.sibling.return=We.return,We=We.sibling}}break;case 19:ia(a,i),ji(i),v&4&&Id(i);break;case 21:break;default:ia(a,i),ji(i)}}function ji(i){var a=i.flags;if(a&2){try{e:{for(var d=i.return;d!==null;){if(Tp(d)){var v=d;break e}d=d.return}throw Error(b(160))}switch(v.tag){case 5:var I=v.stateNode;v.flags&32&&(gn(I,""),v.flags&=-33);var M=Ip(i);_c(i,M,I);break;case 3:case 4:var $=v.stateNode.containerInfo,oe=Ip(i);Td(i,oe,$);break;default:throw Error(b(161))}}catch(pe){Qr(i,i.return,pe)}i.flags&=-3}a&4096&&(i.flags&=-4097)}function Cp(i,a,d){Tt=i,Mp(i)}function Mp(i,a,d){for(var v=(i.mode&1)!==0;Tt!==null;){var I=Tt,M=I.child;if(I.tag===22&&v){var $=I.memoizedState!==null||bh;if(!$){var oe=I.alternate,pe=oe!==null&&oe.memoizedState!==null||ui;oe=bh;var Ce=ui;if(bh=$,(ui=pe)&&!Ce)for(Tt=I;Tt!==null;)$=Tt,pe=$.child,$.tag===22&&$.memoizedState!==null?Dp(I):pe!==null?(pe.return=$,Tt=pe):Dp(I);for(;M!==null;)Tt=M,Mp(M),M=M.sibling;Tt=I,bh=oe,ui=Ce}Ap(i)}else(I.subtreeFlags&8772)!==0&&M!==null?(M.return=I,Tt=M):Ap(i)}}function Ap(i){for(;Tt!==null;){var a=Tt;if((a.flags&8772)!==0){var d=a.alternate;try{if((a.flags&8772)!==0)switch(a.tag){case 0:case 11:case 15:ui||yc(5,a);break;case 1:var v=a.stateNode;if(a.flags&4&&!ui)if(d===null)v.componentDidMount();else{var I=a.elementType===a.type?d.memoizedProps:Ls(a.type,d.memoizedProps);v.componentDidUpdate(I,d.memoizedState,v.__reactInternalSnapshotBeforeUpdate)}var M=a.updateQueue;M!==null&&Ni(a,M,v);break;case 3:var $=a.updateQueue;if($!==null){if(d=null,a.child!==null)switch(a.child.tag){case 5:d=a.child.stateNode;break;case 1:d=a.child.stateNode}Ni(a,$,d)}break;case 5:var oe=a.stateNode;if(d===null&&a.flags&4){d=oe;var pe=a.memoizedProps;switch(a.type){case"button":case"input":case"select":case"textarea":pe.autoFocus&&d.focus();break;case"img":pe.src&&(d.src=pe.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(a.memoizedState===null){var Ce=a.alternate;if(Ce!==null){var Ze=Ce.memoizedState;if(Ze!==null){var We=Ze.dehydrated;We!==null&&$s(We)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(b(163))}ui||a.flags&512&&Sh(a)}catch(qe){Qr(a,a.return,qe)}}if(a===i){Tt=null;break}if(d=a.sibling,d!==null){d.return=a.return,Tt=d;break}Tt=a.return}}function zp(i){for(;Tt!==null;){var a=Tt;if(a===i){Tt=null;break}var d=a.sibling;if(d!==null){d.return=a.return,Tt=d;break}Tt=a.return}}function Dp(i){for(;Tt!==null;){var a=Tt;try{switch(a.tag){case 0:case 11:case 15:var d=a.return;try{yc(4,a)}catch(pe){Qr(a,d,pe)}break;case 1:var v=a.stateNode;if(typeof v.componentDidMount=="function"){var I=a.return;try{v.componentDidMount()}catch(pe){Qr(a,I,pe)}}var M=a.return;try{Sh(a)}catch(pe){Qr(a,M,pe)}break;case 5:var $=a.return;try{Sh(a)}catch(pe){Qr(a,$,pe)}}}catch(pe){Qr(a,a.return,pe)}if(a===i){Tt=null;break}var oe=a.sibling;if(oe!==null){oe.return=a.return,Tt=oe;break}Tt=a.return}}var zf=Math.ceil,kh=et.ReactCurrentDispatcher,Th=et.ReactCurrentOwner,Vi=et.ReactCurrentBatchConfig,xr=0,zn=null,bn=null,Wn=0,ci=0,xu=Ea(0),En=0,vc=null,Cl=0,Ih=0,Eh=0,xc=null,Ui=null,Ml=0,Kr=1/0,za=null,wc=!1,Ph=null,pr=null,wu=!1,no=null,bc=0,ys=0,qo=null,Sc=-1,Ch=0;function Ei(){return(xr&6)!==0?Ut():Sc!==-1?Sc:Sc=Ut()}function Zo(i){return(i.mode&1)===0?1:(xr&2)!==0&&Wn!==0?Wn&-Wn:tt.transition!==null?(Ch===0&&(Ch=Us()),Ch):(i=Sr,i!==0||(i=window.event,i=i===void 0?16:va(i.type)),i)}function sa(i,a,d,v){if(50<ys)throw ys=0,qo=null,Error(b(185));Ua(i,d,v),((xr&2)===0||i!==zn)&&(i===zn&&((xr&2)===0&&(Ih|=d),En===4&&aa(i,Wn)),$i(i,v),d===1&&xr===0&&(a.mode&1)===0&&(Kr=Ut()+500,At&&f()))}function $i(i,a){var d=i.callbackNode;$l(i,a);var v=ti(i,i===zn?Wn:0);if(v===0)d!==null&&Sn(d),i.callbackNode=null,i.callbackPriority=0;else if(a=v&-v,i.callbackPriority!==a){if(d!=null&&Sn(d),a===1)i.tag===0?tc(Al.bind(null,i)):Sl(Al.bind(null,i)),Mo(function(){(xr&6)===0&&f()}),d=null;else{switch(nl(v)){case 1:d=tl;break;case 4:d=Qn;break;case 16:d=Rn;break;case 536870912:d=_i;break;default:d=Rn}d=Ad(d,Lp.bind(null,i))}i.callbackPriority=a,i.callbackNode=d}}function Lp(i,a){if(Sc=-1,Ch=0,(xr&6)!==0)throw Error(b(327));var d=i.callbackNode;if(la()&&i.callbackNode!==d)return null;var v=ti(i,i===zn?Wn:0);if(v===0)return null;if((v&30)!==0||(v&i.expiredLanes)!==0||a)a=Tc(i,v);else{a=v;var I=xr;xr|=2;var M=Bp();(zn!==i||Wn!==a)&&(za=null,Kr=Ut()+500,zl(i,a));do try{Cd();break}catch(oe){Rp(i,oe)}while(!0);Tn(),kh.current=M,xr=I,bn!==null?a=0:(zn=null,Wn=0,a=En)}if(a!==0){if(a===2&&(I=Vs(i),I!==0&&(v=I,a=Ed(i,I))),a===1)throw d=vc,zl(i,0),aa(i,v),$i(i,Ut()),d;if(a===6)aa(i,v);else{if(I=i.current.alternate,(v&30)===0&&!Df(I)&&(a=Tc(i,v),a===2&&(M=Vs(i),M!==0&&(v=M,a=Ed(i,M))),a===1))throw d=vc,zl(i,0),aa(i,v),$i(i,Ut()),d;switch(i.finishedWork=I,i.finishedLanes=v,a){case 0:case 1:throw Error(b(345));case 2:oa(i,Ui,za);break;case 3:if(aa(i,v),(v&130023424)===v&&(a=Ml+500-Ut(),10<a)){if(ti(i,0)!==0)break;if(I=i.suspendedLanes,(I&v)!==v){Ei(),i.pingedLanes|=i.suspendedLanes&I;break}i.timeoutHandle=uu(oa.bind(null,i,Ui,za),a);break}oa(i,Ui,za);break;case 4:if(aa(i,v),(v&4194240)===v)break;for(a=i.eventTimes,I=-1;0<v;){var $=31-Er(v);M=1<<$,$=a[$],$>I&&(I=$),v&=~M}if(v=I,v=Ut()-v,v=(120>v?120:480>v?480:1080>v?1080:1920>v?1920:3e3>v?3e3:4320>v?4320:1960*zf(v/1960))-v,10<v){i.timeoutHandle=uu(oa.bind(null,i,Ui,za),v);break}oa(i,Ui,za);break;case 5:oa(i,Ui,za);break;default:throw Error(b(329))}}}return $i(i,Ut()),i.callbackNode===d?Lp.bind(null,i):null}function Ed(i,a){var d=xc;return i.current.memoizedState.isDehydrated&&(zl(i,a).flags|=256),i=Tc(i,a),i!==2&&(a=Ui,Ui=d,a!==null&&Pd(a)),i}function Pd(i){Ui===null?Ui=i:Ui.push.apply(Ui,i)}function Df(i){for(var a=i;;){if(a.flags&16384){var d=a.updateQueue;if(d!==null&&(d=d.stores,d!==null))for(var v=0;v<d.length;v++){var I=d[v],M=I.getSnapshot;I=I.value;try{if(!ni(M(),I))return!1}catch{return!1}}}if(d=a.child,a.subtreeFlags&16384&&d!==null)d.return=a,a=d;else{if(a===i)break;for(;a.sibling===null;){if(a.return===null||a.return===i)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function aa(i,a){for(a&=~Eh,a&=~Ih,i.suspendedLanes|=a,i.pingedLanes&=~a,i=i.expirationTimes;0<a;){var d=31-Er(a),v=1<<d;i[d]=-1,a&=~v}}function Al(i){if((xr&6)!==0)throw Error(b(327));la();var a=ti(i,0);if((a&1)===0)return $i(i,Ut()),null;var d=Tc(i,a);if(i.tag!==0&&d===2){var v=Vs(i);v!==0&&(a=v,d=Ed(i,v))}if(d===1)throw d=vc,zl(i,0),aa(i,a),$i(i,Ut()),d;if(d===6)throw Error(b(345));return i.finishedWork=i.current.alternate,i.finishedLanes=a,oa(i,Ui,za),$i(i,Ut()),null}function Mh(i,a){var d=xr;xr|=1;try{return i(a)}finally{xr=d,xr===0&&(Kr=Ut()+500,At&&f())}}function io(i){no!==null&&no.tag===0&&(xr&6)===0&&la();var a=xr;xr|=1;var d=Vi.transition,v=Sr;try{if(Vi.transition=null,Sr=1,i)return i()}finally{Sr=v,Vi.transition=d,xr=a,(xr&6)===0&&f()}}function kc(){ci=xu.current,Br(xu)}function zl(i,a){i.finishedWork=null,i.finishedLanes=0;var d=i.timeoutHandle;if(d!==-1&&(i.timeoutHandle=-1,sh(d)),bn!==null)for(d=bn.return;d!==null;){var v=d;switch(G(v),v.tag){case 1:v=v.type.childContextTypes,v!=null&&bl();break;case 3:hs(),Br(ur),Br(Cr),Ro();break;case 5:nc(v);break;case 4:hs();break;case 13:Br(Hr);break;case 19:Br(Hr);break;case 10:bi(v.type._context);break;case 22:case 23:kc()}d=d.return}if(zn=i,bn=i=Go(i.current,null),Wn=ci=a,En=0,vc=null,Eh=Ih=Cl=0,Ui=xc=null,rn!==null){for(a=0;a<rn.length;a++)if(d=rn[a],v=d.interleaved,v!==null){d.interleaved=null;var I=v.next,M=d.pending;if(M!==null){var $=M.next;M.next=I,v.next=$}d.pending=v}rn=null}return i}function Rp(i,a){do{var d=bn;try{if(Tn(),Aa.current=hh,ic){for(var v=zr.memoizedState;v!==null;){var I=v.queue;I!==null&&(I.pending=null),v=v.next}ic=!1}if(Ds=0,vn=Jr=zr=null,pu=!1,sc=0,Th.current=null,d===null||d.return===null){En=1,vc=a,bn=null;break}e:{var M=i,$=d.return,oe=d,pe=a;if(a=Wn,oe.flags|=32768,pe!==null&&typeof pe=="object"&&typeof pe.then=="function"){var Ce=pe,Ze=oe,We=Ze.tag;if((Ze.mode&1)===0&&(We===0||We===11||We===15)){var qe=Ze.alternate;qe?(Ze.updateQueue=qe.updateQueue,Ze.memoizedState=qe.memoizedState,Ze.lanes=qe.lanes):(Ze.updateQueue=null,Ze.memoizedState=null)}var ht=fp($);if(ht!==null){ht.flags&=-257,mp(ht,$,oe,M,a),ht.mode&1&&pp(M,Ce,a),a=ht,pe=Ce;var bt=a.updateQueue;if(bt===null){var Mt=new Set;Mt.add(pe),a.updateQueue=Mt}else bt.add(pe);break e}else{if((a&1)===0){pp(M,Ce,a),Ah();break e}pe=Error(b(426))}}else if(re&&oe.mode&1){var dn=fp($);if(dn!==null){(dn.flags&65536)===0&&(dn.flags|=256),mp(dn,$,oe,M,a),ct(Fn(pe,oe));break e}}M=pe=Fn(pe,oe),En!==4&&(En=2),xc===null?xc=[M]:xc.push(M),M=$;do{switch(M.tag){case 3:M.flags|=65536,a&=-a,M.lanes|=a;var Se=_d(M,pe,a);ki(M,Se);break e;case 1:oe=pe;var ge=M.type,Te=M.stateNode;if((M.flags&128)===0&&(typeof ge.getDerivedStateFromError=="function"||Te!==null&&typeof Te.componentDidCatch=="function"&&(pr===null||!pr.has(Te)))){M.flags|=65536,a&=-a,M.lanes|=a;var it=dp(M,oe,a);ki(M,it);break e}}M=M.return}while(M!==null)}so(d)}catch(zt){a=zt,bn===d&&d!==null&&(bn=d=d.return);continue}break}while(!0)}function Bp(){var i=kh.current;return kh.current=hh,i===null?hh:i}function Ah(){(En===0||En===3||En===2)&&(En=4),zn===null||(Cl&268435455)===0&&(Ih&268435455)===0||aa(zn,Wn)}function Tc(i,a){var d=xr;xr|=2;var v=Bp();(zn!==i||Wn!==a)&&(za=null,zl(i,a));do try{Pi();break}catch(I){Rp(i,I)}while(!0);if(Tn(),xr=d,kh.current=v,bn!==null)throw Error(b(261));return zn=null,Wn=0,En}function Pi(){for(;bn!==null;)Md(bn)}function Cd(){for(;bn!==null&&!$n();)Md(bn)}function Md(i){var a=jp(i.alternate,i,ci);i.memoizedProps=i.pendingProps,a===null?so(i):bn=a,Th.current=null}function so(i){var a=i;do{var d=a.alternate;if(i=a.return,(a.flags&32768)===0){if(d=Cf(d,a,ci),d!==null){bn=d;return}}else{if(d=Mf(d,a),d!==null){d.flags&=32767,bn=d;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{En=6,bn=null;return}}if(a=a.sibling,a!==null){bn=a;return}bn=a=i}while(a!==null);En===0&&(En=5)}function oa(i,a,d){var v=Sr,I=Vi.transition;try{Vi.transition=null,Sr=1,Ic(i,a,d,v)}finally{Vi.transition=I,Sr=v}return null}function Ic(i,a,d,v){do la();while(no!==null);if((xr&6)!==0)throw Error(b(327));d=i.finishedWork;var I=i.finishedLanes;if(d===null)return null;if(i.finishedWork=null,i.finishedLanes=0,d===i.current)throw Error(b(177));i.callbackNode=null,i.callbackPriority=0;var M=d.lanes|d.childLanes;if(Du(i,M),i===zn&&(bn=zn=null,Wn=0),(d.subtreeFlags&2064)===0&&(d.flags&2064)===0||wu||(wu=!0,Ad(Rn,function(){return la(),null})),M=(d.flags&15990)!==0,(d.subtreeFlags&15990)!==0||M){M=Vi.transition,Vi.transition=null;var $=Sr;Sr=1;var oe=xr;xr|=4,Th.current=null,Af(i,d),Pp(d,i),pl(Ju),qa=!!Qs,Ju=Qs=null,i.current=d,Cp(d),po(),xr=oe,Sr=$,Vi.transition=M}else i.current=d;if(wu&&(wu=!1,no=i,bc=I),M=i.pendingLanes,M===0&&(pr=null),Na(d.stateNode),$i(i,Ut()),a!==null)for(v=i.onRecoverableError,d=0;d<a.length;d++)I=a[d],v(I.value,{componentStack:I.stack,digest:I.digest});if(wc)throw wc=!1,i=Ph,Ph=null,i;return(bc&1)!==0&&i.tag!==0&&la(),M=i.pendingLanes,(M&1)!==0?i===qo?ys++:(ys=0,qo=i):ys=0,f(),null}function la(){if(no!==null){var i=nl(bc),a=Vi.transition,d=Sr;try{if(Vi.transition=null,Sr=16>i?16:i,no===null)var v=!1;else{if(i=no,no=null,bc=0,(xr&6)!==0)throw Error(b(331));var I=xr;for(xr|=4,Tt=i.current;Tt!==null;){var M=Tt,$=M.child;if((Tt.flags&16)!==0){var oe=M.deletions;if(oe!==null){for(var pe=0;pe<oe.length;pe++){var Ce=oe[pe];for(Tt=Ce;Tt!==null;){var Ze=Tt;switch(Ze.tag){case 0:case 11:case 15:gc(8,Ze,M)}var We=Ze.child;if(We!==null)We.return=Ze,Tt=We;else for(;Tt!==null;){Ze=Tt;var qe=Ze.sibling,ht=Ze.return;if(kp(Ze),Ze===Ce){Tt=null;break}if(qe!==null){qe.return=ht,Tt=qe;break}Tt=ht}}}var bt=M.alternate;if(bt!==null){var Mt=bt.child;if(Mt!==null){bt.child=null;do{var dn=Mt.sibling;Mt.sibling=null,Mt=dn}while(Mt!==null)}}Tt=M}}if((M.subtreeFlags&2064)!==0&&$!==null)$.return=M,Tt=$;else e:for(;Tt!==null;){if(M=Tt,(M.flags&2048)!==0)switch(M.tag){case 0:case 11:case 15:gc(9,M,M.return)}var Se=M.sibling;if(Se!==null){Se.return=M.return,Tt=Se;break e}Tt=M.return}}var ge=i.current;for(Tt=ge;Tt!==null;){$=Tt;var Te=$.child;if(($.subtreeFlags&2064)!==0&&Te!==null)Te.return=$,Tt=Te;else e:for($=ge;Tt!==null;){if(oe=Tt,(oe.flags&2048)!==0)try{switch(oe.tag){case 0:case 11:case 15:yc(9,oe)}}catch(zt){Qr(oe,oe.return,zt)}if(oe===$){Tt=null;break e}var it=oe.sibling;if(it!==null){it.return=oe.return,Tt=it;break e}Tt=oe.return}}if(xr=I,f(),qn&&typeof qn.onPostCommitFiberRoot=="function")try{qn.onPostCommitFiberRoot(Bn,i)}catch{}v=!0}return v}finally{Sr=d,Vi.transition=a}}return!1}function Ec(i,a,d){a=Fn(d,a),a=_d(i,a,1),i=zs(i,a,1),a=Ei(),i!==null&&(Ua(i,1,a),$i(i,a))}function Qr(i,a,d){if(i.tag===3)Ec(i,i,d);else for(;a!==null;){if(a.tag===3){Ec(a,i,d);break}else if(a.tag===1){var v=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof v.componentDidCatch=="function"&&(pr===null||!pr.has(v))){i=Fn(d,i),i=dp(a,i,1),a=zs(a,i,1),i=Ei(),a!==null&&(Ua(a,1,i),$i(a,i));break}}a=a.return}}function Lf(i,a,d){var v=i.pingCache;v!==null&&v.delete(a),a=Ei(),i.pingedLanes|=i.suspendedLanes&d,zn===i&&(Wn&d)===d&&(En===4||En===3&&(Wn&130023424)===Wn&&500>Ut()-Ml?zl(i,0):Eh|=d),$i(i,a)}function Fp(i,a){a===0&&((i.mode&1)===0?a=1:(a=ei,ei<<=1,(ei&130023424)===0&&(ei=4194304)));var d=Ei();i=ai(i,a),i!==null&&(Ua(i,a,d),$i(i,d))}function Op(i){var a=i.memoizedState,d=0;a!==null&&(d=a.retryLane),Fp(i,d)}function Np(i,a){var d=0;switch(i.tag){case 13:var v=i.stateNode,I=i.memoizedState;I!==null&&(d=I.retryLane);break;case 19:v=i.stateNode;break;default:throw Error(b(314))}v!==null&&v.delete(a),Fp(i,d)}var jp;jp=function(i,a,d){if(i!==null)if(i.memoizedProps!==a.pendingProps||ur.current)Ii=!0;else{if((i.lanes&d)===0&&(a.flags&128)===0)return Ii=!1,Sd(i,a,d);Ii=(i.flags&131072)!==0}else Ii=!1,re&&(a.flags&1048576)!==0&&B(a,u,a.index);switch(a.lanes=0,a.tag){case 2:var v=a.type;fc(i,a),i=a.pendingProps;var I=ta(a,Cr.current);_n(a,d),I=ra(null,a,v,i,I,d);var M=ps();return a.flags|=1,typeof I=="object"&&I!==null&&typeof I.render=="function"&&I.$$typeof===void 0?(a.tag=1,a.memoizedState=null,a.updateQueue=null,Cn(v)?(M=!0,wi(a)):M=!1,a.memoizedState=I.state!==null&&I.state!==void 0?I.state:null,Ca(a),I.updater=fh,a.stateNode=I,I._reactInternals=a,Il(a,v,i,d),a=xd(null,a,v,!0,M,d)):(a.tag=0,re&&M&&U(a),xn(null,a,I,d),a=a.child),a;case 16:v=a.elementType;e:{switch(fc(i,a),i=a.pendingProps,I=v._init,v=I(v._payload),a.type=v,I=a.tag=Rf(v),i=Ls(v,i),I){case 0:a=vd(null,a,v,i,d);break e;case 1:a=wp(null,a,v,i,d);break e;case 11:a=yu(null,a,v,i,d);break e;case 14:a=yp(null,a,v,Ls(v.type,i),d);break e}throw Error(b(306,v,""))}return a;case 0:return v=a.type,I=a.pendingProps,I=a.elementType===v?I:Ls(v,I),vd(i,a,v,I,d);case 1:return v=a.type,I=a.pendingProps,I=a.elementType===v?I:Ls(v,I),wp(i,a,v,I,d);case 3:e:{if(_h(a),i===null)throw Error(b(387));v=a.pendingProps,M=a.memoizedState,I=M.element,Si(i,a),cs(a,v,null,d);var $=a.memoizedState;if(v=$.element,M.isDehydrated)if(M={element:v,isDehydrated:!1,cache:$.cache,pendingSuspenseBoundaries:$.pendingSuspenseBoundaries,transitions:$.transitions},a.updateQueue.baseState=M,a.memoizedState=M,a.flags&256){I=Fn(Error(b(423)),a),a=bp(i,a,v,d,I);break e}else if(v!==I){I=Fn(Error(b(424)),a),a=bp(i,a,v,d,I);break e}else for(J=ss(a.stateNode.containerInfo.firstChild),W=a,re=!0,se=null,d=Ot(a,null,v,d),a.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling;else{if(Qe(),v===I){a=ms(i,a,d);break e}xn(i,a,v,d)}a=a.child}return a;case 5:return rc(a),i===null&&ye(a),v=a.type,I=a.pendingProps,M=i!==null?i.memoizedProps:null,$=I.children,Qu(v,I)?$=null:M!==null&&Qu(v,M)&&(a.flags|=32),xp(i,a),xn(i,a,$,d),a.child;case 6:return i===null&&ye(a),null;case 13:return nn(i,a,d);case 4:return Ma(a,a.stateNode.containerInfo),v=a.pendingProps,i===null?a.child=st(a,null,v,d):xn(i,a,v,d),a.child;case 11:return v=a.type,I=a.pendingProps,I=a.elementType===v?I:Ls(v,I),yu(i,a,v,I,d);case 7:return xn(i,a,a.pendingProps,d),a.child;case 8:return xn(i,a,a.pendingProps.children,d),a.child;case 12:return xn(i,a,a.pendingProps.children,d),a.child;case 10:e:{if(v=a.type._context,I=a.pendingProps,M=a.memoizedProps,$=I.value,jr(Pr,v._currentValue),v._currentValue=$,M!==null)if(ni(M.value,$)){if(M.children===I.children&&!ur.current){a=ms(i,a,d);break e}}else for(M=a.child,M!==null&&(M.return=a);M!==null;){var oe=M.dependencies;if(oe!==null){$=M.child;for(var pe=oe.firstContext;pe!==null;){if(pe.context===v){if(M.tag===1){pe=Oi(-1,d&-d),pe.tag=2;var Ce=M.updateQueue;if(Ce!==null){Ce=Ce.shared;var Ze=Ce.pending;Ze===null?pe.next=pe:(pe.next=Ze.next,Ze.next=pe),Ce.pending=pe}}M.lanes|=d,pe=M.alternate,pe!==null&&(pe.lanes|=d),Ar(M.return,d,a),oe.lanes|=d;break}pe=pe.next}}else if(M.tag===10)$=M.type===a.type?null:M.child;else if(M.tag===18){if($=M.return,$===null)throw Error(b(341));$.lanes|=d,oe=$.alternate,oe!==null&&(oe.lanes|=d),Ar($,d,a),$=M.sibling}else $=M.child;if($!==null)$.return=M;else for($=M;$!==null;){if($===a){$=null;break}if(M=$.sibling,M!==null){M.return=$.return,$=M;break}$=$.return}M=$}xn(i,a,I.children,d),a=a.child}return a;case 9:return I=a.type,v=a.pendingProps.children,_n(a,d),I=Vr(I),v=v(I),a.flags|=1,xn(i,a,v,d),a.child;case 14:return v=a.type,I=Ls(v,a.pendingProps),I=Ls(v.type,I),yp(i,a,v,I,d);case 15:return _p(i,a,a.type,a.pendingProps,d);case 17:return v=a.type,I=a.pendingProps,I=a.elementType===v?I:Ls(v,I),fc(i,a),a.tag=1,Cn(v)?(i=!0,wi(a)):i=!1,_n(a,d),yd(a,v,I),Il(a,v,I,d),xd(null,a,v,!0,i,d);case 19:return bd(i,a,d);case 22:return vp(i,a,d)}throw Error(b(156,a.tag))};function Ad(i,a){return yn(i,a)}function Vp(i,a,d,v){this.tag=i,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=v,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function qi(i,a,d,v){return new Vp(i,a,d,v)}function Pc(i){return i=i.prototype,!(!i||!i.isReactComponent)}function Rf(i){if(typeof i=="function")return Pc(i)?1:0;if(i!=null){if(i=i.$$typeof,i===ar)return 11;if(i===$r)return 14}return 2}function Go(i,a){var d=i.alternate;return d===null?(d=qi(i.tag,a,i.key,i.mode),d.elementType=i.elementType,d.type=i.type,d.stateNode=i.stateNode,d.alternate=i,i.alternate=d):(d.pendingProps=a,d.type=i.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=i.flags&14680064,d.childLanes=i.childLanes,d.lanes=i.lanes,d.child=i.child,d.memoizedProps=i.memoizedProps,d.memoizedState=i.memoizedState,d.updateQueue=i.updateQueue,a=i.dependencies,d.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},d.sibling=i.sibling,d.index=i.index,d.ref=i.ref,d}function Cc(i,a,d,v,I,M){var $=2;if(v=i,typeof i=="function")Pc(i)&&($=1);else if(typeof i=="string")$=5;else e:switch(i){case je:return Ho(d.children,I,M,a);case ut:$=8,I|=8;break;case Ve:return i=qi(12,d,a,I|2),i.elementType=Ve,i.lanes=M,i;case Rt:return i=qi(13,d,a,I),i.elementType=Rt,i.lanes=M,i;case Bt:return i=qi(19,d,a,I),i.elementType=Bt,i.lanes=M,i;case Ht:return Ko(d,I,M,a);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case tr:$=10;break e;case vt:$=9;break e;case ar:$=11;break e;case $r:$=14;break e;case Or:$=16,v=null;break e}throw Error(b(130,i==null?i:typeof i,""))}return a=qi($,d,a,I),a.elementType=i,a.type=v,a.lanes=M,a}function Ho(i,a,d,v){return i=qi(7,i,v,a),i.lanes=d,i}function Ko(i,a,d,v){return i=qi(22,i,v,a),i.elementType=Ht,i.lanes=d,i.stateNode={isHidden:!1},i}function Rs(i,a,d){return i=qi(6,i,null,a),i.lanes=d,i}function Da(i,a,d){return a=qi(4,i.children!==null?i.children:[],i.key,a),a.lanes=d,a.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},a}function Up(i,a,d,v,I){this.tag=a,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=yr(0),this.expirationTimes=yr(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=yr(0),this.identifierPrefix=v,this.onRecoverableError=I,this.mutableSourceEagerHydrationData=null}function Mc(i,a,d,v,I,M,$,oe,pe){return i=new Up(i,a,d,oe,pe),a===1?(a=1,M===!0&&(a|=8)):a=0,M=qi(3,null,null,a),i.current=M,M.stateNode=i,M.memoizedState={element:v,isDehydrated:d,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ca(M),i}function Bf(i,a,d){var v=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:He,key:v==null?null:""+v,children:i,containerInfo:a,implementation:d}}function $p(i){if(!i)return Pa;i=i._reactInternals;e:{if(Wt(i)!==i||i.tag!==1)throw Error(b(170));var a=i;do{switch(a.tag){case 3:a=a.stateNode.context;break e;case 1:if(Cn(a.type)){a=a.stateNode.__reactInternalMemoizedMergedChildContext;break e}}a=a.return}while(a!==null);throw Error(b(171))}if(i.tag===1){var d=i.type;if(Cn(d))return zo(i,d,a)}return a}function Ac(i,a,d,v,I,M,$,oe,pe){return i=Mc(d,v,!0,i,I,M,$,oe,pe),i.context=$p(null),d=i.current,v=Ei(),I=Zo(d),M=Oi(v,I),M.callback=a??null,zs(d,M,I),i.current.lanes=I,Ua(i,I,v),$i(i,v),i}function bu(i,a,d,v){var I=a.current,M=Ei(),$=Zo(I);return d=$p(d),a.context===null?a.context=d:a.pendingContext=d,a=Oi(M,$),a.payload={element:i},v=v===void 0?null:v,v!==null&&(a.callback=v),i=zs(I,a,$),i!==null&&(sa(i,I,$,M),Hn(i,I,$)),$}function zh(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function Dh(i,a){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var d=i.retryLane;i.retryLane=d!==0&&d<a?d:a}}function zc(i,a){Dh(i,a),(i=i.alternate)&&Dh(i,a)}function Su(){return null}var zd=typeof reportError=="function"?reportError:function(i){console.error(i)};function Lh(i){this._internalRoot=i}ku.prototype.render=Lh.prototype.render=function(i){var a=this._internalRoot;if(a===null)throw Error(b(409));bu(i,a,null,null)},ku.prototype.unmount=Lh.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var a=i.containerInfo;io(function(){bu(null,i,null,null)}),a[as]=null}};function ku(i){this._internalRoot=i}ku.prototype.unstable_scheduleHydration=function(i){if(i){var a=Lu();i={blockedOn:null,target:i,priority:a};for(var d=0;d<ts.length&&a!==0&&a<ts[d].priority;d++);ts.splice(d,0,i),d===0&&Bu(i)}};function Rh(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function Dl(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function Dd(){}function Ff(i,a,d,v,I){if(I){if(typeof v=="function"){var M=v;v=function(){var Ce=zh($);M.call(Ce)}}var $=Ac(a,v,i,0,null,!1,!1,"",Dd);return i._reactRootContainer=$,i[as]=$.current,Ys(i.nodeType===8?i.parentNode:i),io(),$}for(;I=i.lastChild;)i.removeChild(I);if(typeof v=="function"){var oe=v;v=function(){var Ce=zh(pe);oe.call(Ce)}}var pe=Mc(i,0,!1,null,null,!1,!1,"",Dd);return i._reactRootContainer=pe,i[as]=pe.current,Ys(i.nodeType===8?i.parentNode:i),io(function(){bu(a,pe,d,v)}),pe}function Bh(i,a,d,v,I){var M=d._reactRootContainer;if(M){var $=M;if(typeof I=="function"){var oe=I;I=function(){var pe=zh($);oe.call(pe)}}bu(a,$,i,I)}else $=Ff(d,a,i,I,v);return zh($)}fo=function(i){switch(i.tag){case 3:var a=i.stateNode;if(a.current.memoizedState.isDehydrated){var d=Va(a.pendingLanes);d!==0&&(ga(a,d|1),$i(a,Ut()),(xr&6)===0&&(Kr=Ut()+500,f()))}break;case 13:io(function(){var v=ai(i,1);if(v!==null){var I=Ei();sa(v,i,1,I)}}),zc(i,1)}},mo=function(i){if(i.tag===13){var a=ai(i,134217728);if(a!==null){var d=Ei();sa(a,i,134217728,d)}zc(i,134217728)}},$a=function(i){if(i.tag===13){var a=Zo(i),d=ai(i,a);if(d!==null){var v=Ei();sa(d,i,a,v)}zc(i,a)}},Lu=function(){return Sr},qc=function(i,a){var d=Sr;try{return Sr=i,a()}finally{Sr=d}},Qi=function(i,a,d){switch(a){case"input":if(js(i,d),a=d.name,d.type==="radio"&&a!=null){for(d=i;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll("input[name="+JSON.stringify(""+a)+'][type="radio"]'),a=0;a<d.length;a++){var v=d[a];if(v!==i&&v.form===i.form){var I=xl(v);if(!I)throw Error(b(90));ws(v),js(v,I)}}}break;case"textarea":Fa(i,d);break;case"select":a=d.value,a!=null&&Ss(i,!!d.multiple,a,!1)}},H=Mh,te=io;var qp={usingClientEntryPoint:!1,Events:[vl,os,xl,j,N,Mh]},Dc={findFiberByHostInstance:ea,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Of={bundleType:Dc.bundleType,version:Dc.version,rendererPackageName:Dc.rendererPackageName,rendererConfig:Dc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:et.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=br(i),i===null?null:i.stateNode},findFiberByHostInstance:Dc.findFiberByHostInstance||Su,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Fh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Fh.isDisabled&&Fh.supportsFiber)try{Bn=Fh.inject(Of),qn=Fh}catch{}}return Fs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=qp,Fs.createPortal=function(i,a){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Rh(a))throw Error(b(200));return Bf(i,a,null,d)},Fs.createRoot=function(i,a){if(!Rh(i))throw Error(b(299));var d=!1,v="",I=zd;return a!=null&&(a.unstable_strictMode===!0&&(d=!0),a.identifierPrefix!==void 0&&(v=a.identifierPrefix),a.onRecoverableError!==void 0&&(I=a.onRecoverableError)),a=Mc(i,1,!1,null,null,d,!1,v,I),i[as]=a.current,Ys(i.nodeType===8?i.parentNode:i),new Lh(a)},Fs.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var a=i._reactInternals;if(a===void 0)throw typeof i.render=="function"?Error(b(188)):(i=Object.keys(i).join(","),Error(b(268,i)));return i=br(a),i=i===null?null:i.stateNode,i},Fs.flushSync=function(i){return io(i)},Fs.hydrate=function(i,a,d){if(!Dl(a))throw Error(b(200));return Bh(null,i,a,!0,d)},Fs.hydrateRoot=function(i,a,d){if(!Rh(i))throw Error(b(405));var v=d!=null&&d.hydratedSources||null,I=!1,M="",$=zd;if(d!=null&&(d.unstable_strictMode===!0&&(I=!0),d.identifierPrefix!==void 0&&(M=d.identifierPrefix),d.onRecoverableError!==void 0&&($=d.onRecoverableError)),a=Ac(a,null,i,1,d??null,I,!1,M,$),i[as]=a.current,Ys(i),v)for(i=0;i<v.length;i++)d=v[i],I=d._getVersion,I=I(d._source),a.mutableSourceEagerHydrationData==null?a.mutableSourceEagerHydrationData=[d,I]:a.mutableSourceEagerHydrationData.push(d,I);return new ku(a)},Fs.render=function(i,a,d){if(!Dl(a))throw Error(b(200));return Bh(null,i,a,!1,d)},Fs.unmountComponentAtNode=function(i){if(!Dl(i))throw Error(b(40));return i._reactRootContainer?(io(function(){Bh(null,null,i,!1,function(){i._reactRootContainer=null,i[as]=null})}),!0):!1},Fs.unstable_batchedUpdates=Mh,Fs.unstable_renderSubtreeIntoContainer=function(i,a,d,v){if(!Dl(d))throw Error(b(200));if(i==null||i._reactInternals===void 0)throw Error(b(38));return Bh(i,a,d,!1,v)},Fs.version="18.3.1-next-f1338f8080-20240426",Fs}var xg;function Jy(){if(xg)return Qf.exports;xg=1;function _(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(_)}catch(y){console.error(y)}}return _(),Qf.exports=Yy(),Qf.exports}var wg;function Qy(){if(wg)return Yp;wg=1;var _=Jy();return Yp.createRoot=_.createRoot,Yp.hydrateRoot=_.hydrateRoot,Yp}var e_=Qy();const t_=Om(e_),hn=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Vn=Object.keys,Xi=Array.isArray;function xs(_,y){return typeof y!="object"||Vn(y).forEach((function(b){_[b]=y[b]})),_}typeof Promise>"u"||hn.Promise||(hn.Promise=Promise);const Yd=Object.getPrototypeOf,r_={}.hasOwnProperty;function pa(_,y){return r_.call(_,y)}function Wh(_,y){typeof y=="function"&&(y=y(Yd(_))),(typeof Reflect>"u"?Vn:Reflect.ownKeys)(y).forEach((b=>{jl(_,b,y[b])}))}const qg=Object.defineProperty;function jl(_,y,b,C){qg(_,y,xs(b&&pa(b,"get")&&typeof b.get=="function"?{get:b.get,set:b.set,configurable:!0}:{value:b,configurable:!0,writable:!0},C))}function Gh(_){return{from:function(y){return _.prototype=Object.create(y.prototype),jl(_.prototype,"constructor",_),{extend:Wh.bind(null,_.prototype)}}}}const n_=Object.getOwnPropertyDescriptor;function jm(_,y){let b;return n_(_,y)||(b=Yd(_))&&jm(b,y)}const i_=[].slice;function yf(_,y,b){return i_.call(_,y,b)}function Zg(_,y){return y(_)}function Ud(_){if(!_)throw new Error("Assertion Failed")}function Gg(_){hn.setImmediate?setImmediate(_):setTimeout(_,0)}function Hg(_,y){return _.reduce(((b,C,D)=>{var F=y(C,D);return F&&(b[F[0]]=F[1]),b}),{})}function Vl(_,y){if(typeof y=="string"&&pa(_,y))return _[y];if(!y)return _;if(typeof y!="string"){for(var b=[],C=0,D=y.length;C<D;++C){var F=Vl(_,y[C]);b.push(F)}return b}var T=y.indexOf(".");if(T!==-1){var h=_[y.substr(0,T)];return h==null?void 0:Vl(h,y.substr(T+1))}}function uo(_,y,b){if(_&&y!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(_)))if(typeof y!="string"&&"length"in y){Ud(typeof b!="string"&&"length"in b);for(var C=0,D=y.length;C<D;++C)uo(_,y[C],b[C])}else{var F=y.indexOf(".");if(F!==-1){var T=y.substr(0,F),h=y.substr(F+1);if(h==="")b===void 0?Xi(_)&&!isNaN(parseInt(T))?_.splice(T,1):delete _[T]:_[T]=b;else{var X=_[T];X&&pa(_,T)||(X=_[T]={}),uo(X,h,b)}}else b===void 0?Xi(_)&&!isNaN(parseInt(y))?_.splice(y,1):delete _[y]:_[y]=b}}function Kg(_){var y={};for(var b in _)pa(_,b)&&(y[b]=_[b]);return y}const s_=[].concat;function Wg(_){return s_.apply([],_)}const Xg="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Wg([8,16,32,64].map((_=>["Int","Uint","Float"].map((y=>y+_+"Array")))))).filter((_=>hn[_])),a_=Xg.map((_=>hn[_]));Hg(Xg,(_=>[_,!0]));let Eu=null;function ip(_){Eu=typeof WeakMap<"u"&&new WeakMap;const y=hm(_);return Eu=null,y}function hm(_){if(!_||typeof _!="object")return _;let y=Eu&&Eu.get(_);if(y)return y;if(Xi(_)){y=[],Eu&&Eu.set(_,y);for(var b=0,C=_.length;b<C;++b)y.push(hm(_[b]))}else if(a_.indexOf(_.constructor)>=0)y=_;else{const F=Yd(_);for(var D in y=F===Object.prototype?{}:Object.create(F),Eu&&Eu.set(_,y),_)pa(_,D)&&(y[D]=hm(_[D]))}return y}const{toString:o_}={};function dm(_){return o_.call(_).slice(8,-1)}const pm=typeof Symbol<"u"?Symbol.iterator:"@@iterator",l_=typeof pm=="symbol"?function(_){var y;return _!=null&&(y=_[pm])&&y.apply(_)}:function(){return null},qh={};function Ol(_){var y,b,C,D;if(arguments.length===1){if(Xi(_))return _.slice();if(this===qh&&typeof _=="string")return[_];if(D=l_(_)){for(b=[];!(C=D.next()).done;)b.push(C.value);return b}if(_==null)return[_];if(typeof(y=_.length)=="number"){for(b=new Array(y);y--;)b[y]=_[y];return b}return[_]}for(y=arguments.length,b=new Array(y);y--;)b[y]=arguments[y];return b}const Vm=typeof Symbol<"u"?_=>_[Symbol.toStringTag]==="AsyncFunction":()=>!1;var el=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Yg(_,y){el=_,Jg=y}var Jg=()=>!0;const u_=!new Error("").stack;function $c(){if(u_)try{throw $c.arguments,new Error}catch(_){return _}return new Error}function fm(_,y){var b=_.stack;return b?(y=y||0,b.indexOf(_.name)===0&&(y+=(_.name+_.message).split(`
`).length),b.split(`
`).slice(y).filter(Jg).map((C=>`
`+C)).join("")):""}var Qg=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Um=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Qg),c_={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Hh(_,y){this._e=$c(),this.name=_,this.message=y}function ey(_,y){return _+". Errors: "+Object.keys(y).map((b=>y[b].toString())).filter(((b,C,D)=>D.indexOf(b)===C)).join(`
`)}function _f(_,y,b,C){this._e=$c(),this.failures=y,this.failedKeys=C,this.successCount=b,this.message=ey(_,y)}function Gd(_,y){this._e=$c(),this.name="BulkError",this.failures=Object.keys(y).map((b=>y[b])),this.failuresByPos=y,this.message=ey(_,y)}Gh(Hh).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+fm(this._e,2))}},toString:function(){return this.name+": "+this.message}}),Gh(_f).from(Hh),Gh(Gd).from(Hh);var $m=Um.reduce(((_,y)=>(_[y]=y+"Error",_)),{});const h_=Hh;var er=Um.reduce(((_,y)=>{var b=y+"Error";function C(D,F){this._e=$c(),this.name=b,D?typeof D=="string"?(this.message=`${D}${F?`
 `+F:""}`,this.inner=F||null):typeof D=="object"&&(this.message=`${D.name} ${D.message}`,this.inner=D):(this.message=c_[y]||b,this.inner=null)}return Gh(C).from(h_),_[y]=C,_}),{});er.Syntax=SyntaxError,er.Type=TypeError,er.Range=RangeError;var bg=Qg.reduce(((_,y)=>(_[y+"Error"]=er[y],_)),{}),uf=Um.reduce(((_,y)=>(["Syntax","Type","Range"].indexOf(y)===-1&&(_[y+"Error"]=er[y]),_)),{});function en(){}function Jd(_){return _}function d_(_,y){return _==null||_===Jd?y:function(b){return y(_(b))}}function Vc(_,y){return function(){_.apply(this,arguments),y.apply(this,arguments)}}function p_(_,y){return _===en?y:function(){var b=_.apply(this,arguments);b!==void 0&&(arguments[0]=b);var C=this.onsuccess,D=this.onerror;this.onsuccess=null,this.onerror=null;var F=y.apply(this,arguments);return C&&(this.onsuccess=this.onsuccess?Vc(C,this.onsuccess):C),D&&(this.onerror=this.onerror?Vc(D,this.onerror):D),F!==void 0?F:b}}function f_(_,y){return _===en?y:function(){_.apply(this,arguments);var b=this.onsuccess,C=this.onerror;this.onsuccess=this.onerror=null,y.apply(this,arguments),b&&(this.onsuccess=this.onsuccess?Vc(b,this.onsuccess):b),C&&(this.onerror=this.onerror?Vc(C,this.onerror):C)}}function m_(_,y){return _===en?y:function(b){var C=_.apply(this,arguments);xs(b,C);var D=this.onsuccess,F=this.onerror;this.onsuccess=null,this.onerror=null;var T=y.apply(this,arguments);return D&&(this.onsuccess=this.onsuccess?Vc(D,this.onsuccess):D),F&&(this.onerror=this.onerror?Vc(F,this.onerror):F),C===void 0?T===void 0?void 0:T:xs(C,T)}}function g_(_,y){return _===en?y:function(){return y.apply(this,arguments)!==!1&&_.apply(this,arguments)}}function qm(_,y){return _===en?y:function(){var b=_.apply(this,arguments);if(b&&typeof b.then=="function"){for(var C=this,D=arguments.length,F=new Array(D);D--;)F[D]=arguments[D];return b.then((function(){return y.apply(C,F)}))}return y.apply(this,arguments)}}uf.ModifyError=_f,uf.DexieError=Hh,uf.BulkError=Gd;var Qd={};const ty=100,[mm,vf,gm]=typeof Promise>"u"?[]:(()=>{let _=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[_,Yd(_),_];const y=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[y,Yd(y),_]})(),ry=vf&&vf.then,cf=mm&&mm.constructor,Zm=!!gm;var ym=!1,y_=gm?()=>{gm.then(Jp)}:hn.setImmediate?setImmediate.bind(null,Jp):hn.MutationObserver?()=>{var _=document.createElement("div");new MutationObserver((()=>{Jp(),_=null})).observe(_,{attributes:!0}),_.setAttribute("i","1")}:()=>{setTimeout(Jp,0)},Hd=function(_,y){$d.push([_,y]),xf&&(y_(),xf=!1)},_m=!0,xf=!0,Oc=[],hf=[],vm=null,xm=Jd,Kh={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Tg,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach((_=>{try{Tg(_[0],_[1])}catch{}}))}},qt=Kh,$d=[],Nc=0,df=[];function Et(_){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=en,this._lib=!1;var y=this._PSD=qt;if(el&&(this._stackHolder=$c(),this._prev=null,this._numPrev=0),typeof _!="function"){if(_!==Qd)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&bm(this,this._value))}this._state=null,this._value=null,++y.ref,iy(this,_)}const wm={get:function(){var _=qt,y=wf;function b(C,D){var F=!_.global&&(_!==qt||y!==wf);const T=F&&!Ul();var h=new Et(((X,ae)=>{Gm(this,new ny(bf(C,_,F,T),bf(D,_,F,T),X,ae,_))}));return el&&oy(h,this),h}return b.prototype=Qd,b},set:function(_){jl(this,"then",_&&_.prototype===Qd?wm:{get:function(){return _},set:wm.set})}};function ny(_,y,b,C,D){this.onFulfilled=typeof _=="function"?_:null,this.onRejected=typeof y=="function"?y:null,this.resolve=b,this.reject=C,this.psd=D}function iy(_,y){try{y((b=>{if(_._state===null){if(b===_)throw new TypeError("A promise cannot be resolved with itself.");var C=_._lib&&sp();b&&typeof b.then=="function"?iy(_,((D,F)=>{b instanceof Et?b._then(D,F):b.then(D,F)})):(_._state=!0,_._value=b,sy(_)),C&&ap()}}),bm.bind(null,_))}catch(b){bm(_,b)}}function bm(_,y){if(hf.push(y),_._state===null){var b=_._lib&&sp();y=xm(y),_._state=!1,_._value=y,el&&y!==null&&typeof y=="object"&&!y._promise&&(function(C,D,F){try{C.apply(null,F)}catch{}})((()=>{var C=jm(y,"stack");y._promise=_,jl(y,"stack",{get:()=>ym?C&&(C.get?C.get.apply(y):C.value):_.stack})})),(function(C){Oc.some((D=>D._value===C._value))||Oc.push(C)})(_),sy(_),b&&ap()}}function sy(_){var y=_._listeners;_._listeners=[];for(var b=0,C=y.length;b<C;++b)Gm(_,y[b]);var D=_._PSD;--D.ref||D.finalize(),Nc===0&&(++Nc,Hd((()=>{--Nc==0&&Hm()}),[]))}function Gm(_,y){if(_._state!==null){var b=_._state?y.onFulfilled:y.onRejected;if(b===null)return(_._state?y.resolve:y.reject)(_._value);++y.psd.ref,++Nc,Hd(__,[b,_,y])}else _._listeners.push(y)}function __(_,y,b){try{vm=y;var C,D=y._value;y._state?C=_(D):(hf.length&&(hf=[]),C=_(D),hf.indexOf(D)===-1&&(function(F){for(var T=Oc.length;T;)if(Oc[--T]._value===F._value)return void Oc.splice(T,1)})(y)),b.resolve(C)}catch(F){b.reject(F)}finally{vm=null,--Nc==0&&Hm(),--b.psd.ref||b.psd.finalize()}}function ay(_,y,b){if(y.length===b)return y;var C="";if(_._state===!1){var D,F,T=_._value;T!=null?(D=T.name||"Error",F=T.message||T,C=fm(T,0)):(D=T,F=""),y.push(D+(F?": "+F:"")+C)}return el&&((C=fm(_._stackHolder,2))&&y.indexOf(C)===-1&&y.push(C),_._prev&&ay(_._prev,y,b)),y}function oy(_,y){var b=y?y._numPrev+1:0;b<100&&(_._prev=y,_._numPrev=b)}function Jp(){sp()&&ap()}function sp(){var _=_m;return _m=!1,xf=!1,_}function ap(){var _,y,b;do for(;$d.length>0;)for(_=$d,$d=[],b=_.length,y=0;y<b;++y){var C=_[y];C[0].apply(null,C[1])}while($d.length>0);_m=!0,xf=!0}function Hm(){var _=Oc;Oc=[],_.forEach((C=>{C._PSD.onunhandled.call(null,C._value,C)}));for(var y=df.slice(0),b=y.length;b;)y[--b]()}function Qp(_){return new Et(Qd,!1,_)}function fn(_,y){var b=qt;return function(){var C=sp(),D=qt;try{return Mu(b,!0),_.apply(this,arguments)}catch(F){y&&y(F)}finally{Mu(D,!1),C&&ap()}}}Wh(Et.prototype,{then:wm,_then:function(_,y){Gm(this,new ny(null,null,_,y,qt))},catch:function(_){if(arguments.length===1)return this.then(null,_);var y=arguments[0],b=arguments[1];return typeof y=="function"?this.then(null,(C=>C instanceof y?b(C):Qp(C))):this.then(null,(C=>C&&C.name===y?b(C):Qp(C)))},finally:function(_){return this.then((y=>(_(),y)),(y=>(_(),Qp(y))))},stack:{get:function(){if(this._stack)return this._stack;try{ym=!0;var _=ay(this,[],20).join(`
From previous: `);return this._state!==null&&(this._stack=_),_}finally{ym=!1}}},timeout:function(_,y){return _<1/0?new Et(((b,C)=>{var D=setTimeout((()=>C(new er.Timeout(y))),_);this.then(b,C).finally(clearTimeout.bind(null,D))})):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&jl(Et.prototype,Symbol.toStringTag,"Dexie.Promise"),Kh.env=ly(),Wh(Et,{all:function(){var _=Ol.apply(null,arguments).map(ef);return new Et((function(y,b){_.length===0&&y([]);var C=_.length;_.forEach(((D,F)=>Et.resolve(D).then((T=>{_[F]=T,--C||y(_)}),b)))}))},resolve:_=>{if(_ instanceof Et)return _;if(_&&typeof _.then=="function")return new Et(((b,C)=>{_.then(b,C)}));var y=new Et(Qd,!0,_);return oy(y,vm),y},reject:Qp,race:function(){var _=Ol.apply(null,arguments).map(ef);return new Et(((y,b)=>{_.map((C=>Et.resolve(C).then(y,b)))}))},PSD:{get:()=>qt,set:_=>qt=_},totalEchoes:{get:()=>wf},newPSD:Cu,usePSD:Yh,scheduler:{get:()=>Hd,set:_=>{Hd=_}},rejectionMapper:{get:()=>xm,set:_=>{xm=_}},follow:(_,y)=>new Et(((b,C)=>Cu(((D,F)=>{var T=qt;T.unhandleds=[],T.onunhandled=F,T.finalize=Vc((function(){(function(h){function X(){h(),df.splice(df.indexOf(X),1)}df.push(X),++Nc,Hd((()=>{--Nc==0&&Hm()}),[])})((()=>{this.unhandleds.length===0?D():F(this.unhandleds[0])}))}),T.finalize),_()}),y,b,C)))}),cf&&(cf.allSettled&&jl(Et,"allSettled",(function(){const _=Ol.apply(null,arguments).map(ef);return new Et((y=>{_.length===0&&y([]);let b=_.length;const C=new Array(b);_.forEach(((D,F)=>Et.resolve(D).then((T=>C[F]={status:"fulfilled",value:T}),(T=>C[F]={status:"rejected",reason:T})).then((()=>--b||y(C)))))}))})),cf.any&&typeof AggregateError<"u"&&jl(Et,"any",(function(){const _=Ol.apply(null,arguments).map(ef);return new Et(((y,b)=>{_.length===0&&b(new AggregateError([]));let C=_.length;const D=new Array(C);_.forEach(((F,T)=>Et.resolve(F).then((h=>y(h)),(h=>{D[T]=h,--C||b(new AggregateError(D))}))))}))})));const Wi={awaits:0,echoes:0,id:0};var v_=0,pf=[],rm=0,wf=0,x_=0;function Cu(_,y,b,C){var D=qt,F=Object.create(D);F.parent=D,F.ref=0,F.global=!1,F.id=++x_;var T=Kh.env;F.env=Zm?{Promise:Et,PromiseProp:{value:Et,configurable:!0,writable:!0},all:Et.all,race:Et.race,allSettled:Et.allSettled,any:Et.any,resolve:Et.resolve,reject:Et.reject,nthen:Sg(T.nthen,F),gthen:Sg(T.gthen,F)}:{},y&&xs(F,y),++D.ref,F.finalize=function(){--this.parent.ref||this.parent.finalize()};var h=Yh(F,_,b,C);return F.ref===0&&F.finalize(),h}function Xh(){return Wi.id||(Wi.id=++v_),++Wi.awaits,Wi.echoes+=ty,Wi.id}function Ul(){return!!Wi.awaits&&(--Wi.awaits==0&&(Wi.id=0),Wi.echoes=Wi.awaits*ty,!0)}function ef(_){return Wi.echoes&&_&&_.constructor===cf?(Xh(),_.then((y=>(Ul(),y)),(y=>(Ul(),Yn(y))))):_}function w_(_){++wf,Wi.echoes&&--Wi.echoes!=0||(Wi.echoes=Wi.id=0),pf.push(qt),Mu(_,!0)}function b_(){var _=pf[pf.length-1];pf.pop(),Mu(_,!1)}function Mu(_,y){var b=qt;if((y?!Wi.echoes||rm++&&_===qt:!rm||--rm&&_===qt)||uy(y?w_.bind(null,_):b_),_!==qt&&(qt=_,b===Kh&&(Kh.env=ly()),Zm)){var C=Kh.env.Promise,D=_.env;vf.then=D.nthen,C.prototype.then=D.gthen,(b.global||_.global)&&(Object.defineProperty(hn,"Promise",D.PromiseProp),C.all=D.all,C.race=D.race,C.resolve=D.resolve,C.reject=D.reject,D.allSettled&&(C.allSettled=D.allSettled),D.any&&(C.any=D.any))}}function ly(){var _=hn.Promise;return Zm?{Promise:_,PromiseProp:Object.getOwnPropertyDescriptor(hn,"Promise"),all:_.all,race:_.race,allSettled:_.allSettled,any:_.any,resolve:_.resolve,reject:_.reject,nthen:vf.then,gthen:_.prototype.then}:{}}function Yh(_,y,b,C,D){var F=qt;try{return Mu(_,!0),y(b,C,D)}finally{Mu(F,!1)}}function uy(_){ry.call(mm,_)}function bf(_,y,b,C){return typeof _!="function"?_:function(){var D=qt;b&&Xh(),Mu(y,!0);try{return _.apply(this,arguments)}finally{Mu(D,!1),C&&uy(Ul)}}}function Sg(_,y){return function(b,C){return _.call(this,bf(b,y),bf(C,y))}}(""+ry).indexOf("[native code]")===-1&&(Xh=Ul=en);const kg="unhandledrejection";function Tg(_,y){var b;try{b=y.onuncatched(_)}catch{}if(b!==!1)try{var C,D={promise:y,reason:_};if(hn.document&&document.createEvent?((C=document.createEvent("Event")).initEvent(kg,!0,!0),xs(C,D)):hn.CustomEvent&&xs(C=new CustomEvent(kg,{detail:D}),D),C&&hn.dispatchEvent&&(dispatchEvent(C),!hn.PromiseRejectionEvent&&hn.onunhandledrejection))try{hn.onunhandledrejection(C)}catch{}el&&C&&!C.defaultPrevented&&console.warn(`Unhandled rejection: ${_.stack||_}`)}catch{}}var Yn=Et.reject;function Sm(_,y,b,C){if(_.idbdb&&(_._state.openComplete||qt.letThrough||_._vip)){var D=_._createTransaction(y,b,_._dbSchema);try{D.create(),_._state.PR1398_maxLoop=3}catch(F){return F.name===$m.InvalidState&&_.isOpen()&&--_._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),_._close(),_.open().then((()=>Sm(_,y,b,C)))):Yn(F)}return D._promise(y,((F,T)=>Cu((()=>(qt.trans=D,C(F,T,D)))))).then((F=>D._completion.then((()=>F))))}if(_._state.openComplete)return Yn(new er.DatabaseClosed(_._state.dbOpenError));if(!_._state.isBeingOpened){if(!_._options.autoOpen)return Yn(new er.DatabaseClosed);_.open().catch(en)}return _._state.dbReadyPromise.then((()=>Sm(_,y,b,C)))}const Ig="3.2.7",Fc="",km=-1/0,Bl="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",cy="String expected.",Kd=[],Tf=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),S_=Tf,k_=Tf,hy=_=>!/(dexie\.js|dexie\.min\.js)/.test(_),If="__dbnames",nm="readonly",im="readwrite";function Uc(_,y){return _?y?function(){return _.apply(this,arguments)&&y.apply(this,arguments)}:_:y}const dy={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function tf(_){return typeof _!="string"||/\./.test(_)?y=>y:y=>(y[_]===void 0&&_ in y&&delete(y=ip(y))[_],y)}class T_{_trans(y,b,C){const D=this._tx||qt.trans,F=this.name;function T(X,ae,Q){if(!Q.schema[F])throw new er.NotFound("Table "+F+" not part of transaction");return b(Q.idbtrans,Q)}const h=sp();try{return D&&D.db===this.db?D===qt.trans?D._promise(y,T,C):Cu((()=>D._promise(y,T,C)),{trans:D,transless:qt.transless||qt}):Sm(this.db,y,[this.name],T)}finally{h&&ap()}}get(y,b){return y&&y.constructor===Object?this.where(y).first(b):this._trans("readonly",(C=>this.core.get({trans:C,key:y}).then((D=>this.hook.reading.fire(D))))).then(b)}where(y){if(typeof y=="string")return new this.db.WhereClause(this,y);if(Xi(y))return new this.db.WhereClause(this,`[${y.join("+")}]`);const b=Vn(y);if(b.length===1)return this.where(b[0]).equals(y[b[0]]);const C=this.schema.indexes.concat(this.schema.primKey).filter((ae=>{if(ae.compound&&b.every((Q=>ae.keyPath.indexOf(Q)>=0))){for(let Q=0;Q<b.length;++Q)if(b.indexOf(ae.keyPath[Q])===-1)return!1;return!0}return!1})).sort(((ae,Q)=>ae.keyPath.length-Q.keyPath.length))[0];if(C&&this.db._maxKey!==Fc){const ae=C.keyPath.slice(0,b.length);return this.where(ae).equals(ae.map((Q=>y[Q])))}!C&&el&&console.warn(`The query ${JSON.stringify(y)} on ${this.name} would benefit of a compound index [${b.join("+")}]`);const{idxByName:D}=this.schema,F=this.db._deps.indexedDB;function T(ae,Q){try{return F.cmp(ae,Q)===0}catch{return!1}}const[h,X]=b.reduce((([ae,Q],Y)=>{const Z=D[Y],Ie=y[Y];return[ae||Z,ae||!Z?Uc(Q,Z&&Z.multi?Re=>{const Pe=Vl(Re,Y);return Xi(Pe)&&Pe.some((Le=>T(Ie,Le)))}:Re=>T(Ie,Vl(Re,Y))):Q]}),[null,null]);return h?this.where(h.name).equals(y[h.keyPath]).filter(X):C?this.filter(X):this.where(b).equals("")}filter(y){return this.toCollection().and(y)}count(y){return this.toCollection().count(y)}offset(y){return this.toCollection().offset(y)}limit(y){return this.toCollection().limit(y)}each(y){return this.toCollection().each(y)}toArray(y){return this.toCollection().toArray(y)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(y){return new this.db.Collection(new this.db.WhereClause(this,Xi(y)?`[${y.join("+")}]`:y))}reverse(){return this.toCollection().reverse()}mapToClass(y){this.schema.mappedClass=y;const b=C=>{if(!C)return C;const D=Object.create(y.prototype);for(var F in C)if(pa(C,F))try{D[F]=C[F]}catch{}return D};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=b,this.hook("reading",b),y}defineClass(){return this.mapToClass((function(y){xs(this,y)}))}add(y,b){const{auto:C,keyPath:D}=this.schema.primKey;let F=y;return D&&C&&(F=tf(D)(y)),this._trans("readwrite",(T=>this.core.mutate({trans:T,type:"add",keys:b!=null?[b]:null,values:[F]}))).then((T=>T.numFailures?Et.reject(T.failures[0]):T.lastResult)).then((T=>{if(D)try{uo(y,D,T)}catch{}return T}))}update(y,b){if(typeof y!="object"||Xi(y))return this.where(":id").equals(y).modify(b);{const C=Vl(y,this.schema.primKey.keyPath);if(C===void 0)return Yn(new er.InvalidArgument("Given object does not contain its primary key"));try{typeof b!="function"?Vn(b).forEach((D=>{uo(y,D,b[D])})):b(y,{value:y,primKey:C})}catch{}return this.where(":id").equals(C).modify(b)}}put(y,b){const{auto:C,keyPath:D}=this.schema.primKey;let F=y;return D&&C&&(F=tf(D)(y)),this._trans("readwrite",(T=>this.core.mutate({trans:T,type:"put",values:[F],keys:b!=null?[b]:null}))).then((T=>T.numFailures?Et.reject(T.failures[0]):T.lastResult)).then((T=>{if(D)try{uo(y,D,T)}catch{}return T}))}delete(y){return this._trans("readwrite",(b=>this.core.mutate({trans:b,type:"delete",keys:[y]}))).then((b=>b.numFailures?Et.reject(b.failures[0]):void 0))}clear(){return this._trans("readwrite",(y=>this.core.mutate({trans:y,type:"deleteRange",range:dy}))).then((y=>y.numFailures?Et.reject(y.failures[0]):void 0))}bulkGet(y){return this._trans("readonly",(b=>this.core.getMany({keys:y,trans:b}).then((C=>C.map((D=>this.hook.reading.fire(D)))))))}bulkAdd(y,b,C){const D=Array.isArray(b)?b:void 0,F=(C=C||(D?void 0:b))?C.allKeys:void 0;return this._trans("readwrite",(T=>{const{auto:h,keyPath:X}=this.schema.primKey;if(X&&D)throw new er.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(D&&D.length!==y.length)throw new er.InvalidArgument("Arguments objects and keys must have the same length");const ae=y.length;let Q=X&&h?y.map(tf(X)):y;return this.core.mutate({trans:T,type:"add",keys:D,values:Q,wantResults:F}).then((({numFailures:Y,results:Z,lastResult:Ie,failures:Re})=>{if(Y===0)return F?Z:Ie;throw new Gd(`${this.name}.bulkAdd(): ${Y} of ${ae} operations failed`,Re)}))}))}bulkPut(y,b,C){const D=Array.isArray(b)?b:void 0,F=(C=C||(D?void 0:b))?C.allKeys:void 0;return this._trans("readwrite",(T=>{const{auto:h,keyPath:X}=this.schema.primKey;if(X&&D)throw new er.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(D&&D.length!==y.length)throw new er.InvalidArgument("Arguments objects and keys must have the same length");const ae=y.length;let Q=X&&h?y.map(tf(X)):y;return this.core.mutate({trans:T,type:"put",keys:D,values:Q,wantResults:F}).then((({numFailures:Y,results:Z,lastResult:Ie,failures:Re})=>{if(Y===0)return F?Z:Ie;throw new Gd(`${this.name}.bulkPut(): ${Y} of ${ae} operations failed`,Re)}))}))}bulkDelete(y){const b=y.length;return this._trans("readwrite",(C=>this.core.mutate({trans:C,type:"delete",keys:y}))).then((({numFailures:C,lastResult:D,failures:F})=>{if(C===0)return D;throw new Gd(`${this.name}.bulkDelete(): ${C} of ${b} operations failed`,F)}))}}function Wd(_){var y={},b=function(T,h){if(h){for(var X=arguments.length,ae=new Array(X-1);--X;)ae[X-1]=arguments[X];return y[T].subscribe.apply(null,ae),_}if(typeof T=="string")return y[T]};b.addEventType=F;for(var C=1,D=arguments.length;C<D;++C)F(arguments[C]);return b;function F(T,h,X){if(typeof T!="object"){var ae;h||(h=g_),X||(X=en);var Q={subscribers:[],fire:X,subscribe:function(Y){Q.subscribers.indexOf(Y)===-1&&(Q.subscribers.push(Y),Q.fire=h(Q.fire,Y))},unsubscribe:function(Y){Q.subscribers=Q.subscribers.filter((function(Z){return Z!==Y})),Q.fire=Q.subscribers.reduce(h,X)}};return y[T]=b[T]=Q,Q}Vn(ae=T).forEach((function(Y){var Z=ae[Y];if(Xi(Z))F(Y,ae[Y][0],ae[Y][1]);else{if(Z!=="asap")throw new er.InvalidArgument("Invalid event config");var Ie=F(Y,Jd,(function(){for(var Re=arguments.length,Pe=new Array(Re);Re--;)Pe[Re]=arguments[Re];Ie.subscribers.forEach((function(Le){Gg((function(){Le.apply(null,Pe)}))}))}))}}))}}function Od(_,y){return Gh(y).from({prototype:_}),y}function Vh(_,y){return!(_.filter||_.algorithm||_.or)&&(y?_.justLimit:!_.replayFilter)}function sm(_,y){_.filter=Uc(_.filter,y)}function am(_,y,b){var C=_.replayFilter;_.replayFilter=C?()=>Uc(C(),y()):y,_.justLimit=b&&!C}function ff(_,y){if(_.isPrimKey)return y.primaryKey;const b=y.getIndexByKeyPath(_.index);if(!b)throw new er.Schema("KeyPath "+_.index+" on object store "+y.name+" is not indexed");return b}function Eg(_,y,b){const C=ff(_,y.schema);return y.openCursor({trans:b,values:!_.keysOnly,reverse:_.dir==="prev",unique:!!_.unique,query:{index:C,range:_.range}})}function rf(_,y,b,C){const D=_.replayFilter?Uc(_.filter,_.replayFilter()):_.filter;if(_.or){const F={},T=(h,X,ae)=>{if(!D||D(X,ae,(Z=>X.stop(Z)),(Z=>X.fail(Z)))){var Q=X.primaryKey,Y=""+Q;Y==="[object ArrayBuffer]"&&(Y=""+new Uint8Array(Q)),pa(F,Y)||(F[Y]=!0,y(h,X,ae))}};return Promise.all([_.or._iterate(T,b),Pg(Eg(_,C,b),_.algorithm,T,!_.keysOnly&&_.valueMapper)])}return Pg(Eg(_,C,b),Uc(_.algorithm,D),y,!_.keysOnly&&_.valueMapper)}function Pg(_,y,b,C){var D=fn(C?(F,T,h)=>b(C(F),T,h):b);return _.then((F=>{if(F)return F.start((()=>{var T=()=>F.continue();y&&!y(F,(h=>T=h),(h=>{F.stop(h),T=en}),(h=>{F.fail(h),T=en}))||D(F.value,F,(h=>T=h)),T()}))}))}function vs(_,y){try{const b=Cg(_),C=Cg(y);if(b!==C)return b==="Array"?1:C==="Array"?-1:b==="binary"?1:C==="binary"?-1:b==="string"?1:C==="string"?-1:b==="Date"?1:C!=="Date"?NaN:-1;switch(b){case"number":case"Date":case"string":return _>y?1:_<y?-1:0;case"binary":return(function(D,F){const T=D.length,h=F.length,X=T<h?T:h;for(let ae=0;ae<X;++ae)if(D[ae]!==F[ae])return D[ae]<F[ae]?-1:1;return T===h?0:T<h?-1:1})(Mg(_),Mg(y));case"Array":return(function(D,F){const T=D.length,h=F.length,X=T<h?T:h;for(let ae=0;ae<X;++ae){const Q=vs(D[ae],F[ae]);if(Q!==0)return Q}return T===h?0:T<h?-1:1})(_,y)}}catch{}return NaN}function Cg(_){const y=typeof _;if(y!=="object")return y;if(ArrayBuffer.isView(_))return"binary";const b=dm(_);return b==="ArrayBuffer"?"binary":b}function Mg(_){return _ instanceof Uint8Array?_:ArrayBuffer.isView(_)?new Uint8Array(_.buffer,_.byteOffset,_.byteLength):new Uint8Array(_)}class I_{_read(y,b){var C=this._ctx;return C.error?C.table._trans(null,Yn.bind(null,C.error)):C.table._trans("readonly",y).then(b)}_write(y){var b=this._ctx;return b.error?b.table._trans(null,Yn.bind(null,b.error)):b.table._trans("readwrite",y,"locked")}_addAlgorithm(y){var b=this._ctx;b.algorithm=Uc(b.algorithm,y)}_iterate(y,b){return rf(this._ctx,y,b,this._ctx.table.core)}clone(y){var b=Object.create(this.constructor.prototype),C=Object.create(this._ctx);return y&&xs(C,y),b._ctx=C,b}raw(){return this._ctx.valueMapper=null,this}each(y){var b=this._ctx;return this._read((C=>rf(b,y,C,b.table.core)))}count(y){return this._read((b=>{const C=this._ctx,D=C.table.core;if(Vh(C,!0))return D.count({trans:b,query:{index:ff(C,D.schema),range:C.range}}).then((T=>Math.min(T,C.limit)));var F=0;return rf(C,(()=>(++F,!1)),b,D).then((()=>F))})).then(y)}sortBy(y,b){const C=y.split(".").reverse(),D=C[0],F=C.length-1;function T(ae,Q){return Q?T(ae[C[Q]],Q-1):ae[D]}var h=this._ctx.dir==="next"?1:-1;function X(ae,Q){var Y=T(ae,F),Z=T(Q,F);return Y<Z?-h:Y>Z?h:0}return this.toArray((function(ae){return ae.sort(X)})).then(b)}toArray(y){return this._read((b=>{var C=this._ctx;if(C.dir==="next"&&Vh(C,!0)&&C.limit>0){const{valueMapper:D}=C,F=ff(C,C.table.core.schema);return C.table.core.query({trans:b,limit:C.limit,values:!0,query:{index:F,range:C.range}}).then((({result:T})=>D?T.map(D):T))}{const D=[];return rf(C,(F=>D.push(F)),b,C.table.core).then((()=>D))}}),y)}offset(y){var b=this._ctx;return y<=0||(b.offset+=y,Vh(b)?am(b,(()=>{var C=y;return(D,F)=>C===0||(C===1?(--C,!1):(F((()=>{D.advance(C),C=0})),!1))})):am(b,(()=>{var C=y;return()=>--C<0}))),this}limit(y){return this._ctx.limit=Math.min(this._ctx.limit,y),am(this._ctx,(()=>{var b=y;return function(C,D,F){return--b<=0&&D(F),b>=0}}),!0),this}until(y,b){return sm(this._ctx,(function(C,D,F){return!y(C.value)||(D(F),b)})),this}first(y){return this.limit(1).toArray((function(b){return b[0]})).then(y)}last(y){return this.reverse().first(y)}filter(y){var b,C;return sm(this._ctx,(function(D){return y(D.value)})),b=this._ctx,C=y,b.isMatch=Uc(b.isMatch,C),this}and(y){return this.filter(y)}or(y){return new this.db.WhereClause(this._ctx.table,y,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(y){var b=this._ctx;return b.keysOnly=!b.isMatch,this.each((function(C,D){y(D.key,D)}))}eachUniqueKey(y){return this._ctx.unique="unique",this.eachKey(y)}eachPrimaryKey(y){var b=this._ctx;return b.keysOnly=!b.isMatch,this.each((function(C,D){y(D.primaryKey,D)}))}keys(y){var b=this._ctx;b.keysOnly=!b.isMatch;var C=[];return this.each((function(D,F){C.push(F.key)})).then((function(){return C})).then(y)}primaryKeys(y){var b=this._ctx;if(b.dir==="next"&&Vh(b,!0)&&b.limit>0)return this._read((D=>{var F=ff(b,b.table.core.schema);return b.table.core.query({trans:D,values:!1,limit:b.limit,query:{index:F,range:b.range}})})).then((({result:D})=>D)).then(y);b.keysOnly=!b.isMatch;var C=[];return this.each((function(D,F){C.push(F.primaryKey)})).then((function(){return C})).then(y)}uniqueKeys(y){return this._ctx.unique="unique",this.keys(y)}firstKey(y){return this.limit(1).keys((function(b){return b[0]})).then(y)}lastKey(y){return this.reverse().firstKey(y)}distinct(){var y=this._ctx,b=y.index&&y.table.schema.idxByName[y.index];if(!b||!b.multi)return this;var C={};return sm(this._ctx,(function(D){var F=D.primaryKey.toString(),T=pa(C,F);return C[F]=!0,!T})),this}modify(y){var b=this._ctx;return this._write((C=>{var D;if(typeof y=="function")D=y;else{var F=Vn(y),T=F.length;D=function(Pe){for(var Le=!1,De=0;De<T;++De){var ze=F[De],$e=y[ze];Vl(Pe,ze)!==$e&&(uo(Pe,ze,$e),Le=!0)}return Le}}const h=b.table.core,{outbound:X,extractKey:ae}=h.schema.primaryKey,Q=this.db._options.modifyChunkSize||200,Y=[];let Z=0;const Ie=[],Re=(Pe,Le)=>{const{failures:De,numFailures:ze}=Le;Z+=Pe-ze;for(let $e of Vn(De))Y.push(De[$e])};return this.clone().primaryKeys().then((Pe=>{const Le=De=>{const ze=Math.min(Q,Pe.length-De);return h.getMany({trans:C,keys:Pe.slice(De,De+ze),cache:"immutable"}).then(($e=>{const et=[],Je=[],He=X?[]:null,je=[];for(let Ve=0;Ve<ze;++Ve){const tr=$e[Ve],vt={value:ip(tr),primKey:Pe[De+Ve]};D.call(vt,vt.value,vt)!==!1&&(vt.value==null?je.push(Pe[De+Ve]):X||vs(ae(tr),ae(vt.value))===0?(Je.push(vt.value),X&&He.push(Pe[De+Ve])):(je.push(Pe[De+Ve]),et.push(vt.value)))}const ut=Vh(b)&&b.limit===1/0&&(typeof y!="function"||y===om)&&{index:b.index,range:b.range};return Promise.resolve(et.length>0&&h.mutate({trans:C,type:"add",values:et}).then((Ve=>{for(let tr in Ve.failures)je.splice(parseInt(tr),1);Re(et.length,Ve)}))).then((()=>(Je.length>0||ut&&typeof y=="object")&&h.mutate({trans:C,type:"put",keys:He,values:Je,criteria:ut,changeSpec:typeof y!="function"&&y}).then((Ve=>Re(Je.length,Ve))))).then((()=>(je.length>0||ut&&y===om)&&h.mutate({trans:C,type:"delete",keys:je,criteria:ut}).then((Ve=>Re(je.length,Ve))))).then((()=>Pe.length>De+ze&&Le(De+Q)))}))};return Le(0).then((()=>{if(Y.length>0)throw new _f("Error modifying one or more objects",Y,Z,Ie);return Pe.length}))}))}))}delete(){var y=this._ctx,b=y.range;return Vh(y)&&(y.isPrimKey&&!k_||b.type===3)?this._write((C=>{const{primaryKey:D}=y.table.core.schema,F=b;return y.table.core.count({trans:C,query:{index:D,range:F}}).then((T=>y.table.core.mutate({trans:C,type:"deleteRange",range:F}).then((({failures:h,lastResult:X,results:ae,numFailures:Q})=>{if(Q)throw new _f("Could not delete some values",Object.keys(h).map((Y=>h[Y])),T-Q);return T-Q}))))})):this.modify(om)}}const om=(_,y)=>y.value=null;function E_(_,y){return _<y?-1:_===y?0:1}function P_(_,y){return _>y?-1:_===y?0:1}function da(_,y,b){var C=_ instanceof fy?new _.Collection(_):_;return C._ctx.error=b?new b(y):new TypeError(y),C}function Uh(_){return new _.Collection(_,(()=>py(""))).limit(0)}function C_(_,y,b,C,D,F){for(var T=Math.min(_.length,C.length),h=-1,X=0;X<T;++X){var ae=y[X];if(ae!==C[X])return D(_[X],b[X])<0?_.substr(0,X)+b[X]+b.substr(X+1):D(_[X],C[X])<0?_.substr(0,X)+C[X]+b.substr(X+1):h>=0?_.substr(0,h)+y[h]+b.substr(h+1):null;D(_[X],ae)<0&&(h=X)}return T<C.length&&F==="next"?_+b.substr(_.length):T<_.length&&F==="prev"?_.substr(0,b.length):h<0?null:_.substr(0,h)+C[h]+b.substr(h+1)}function nf(_,y,b,C){var D,F,T,h,X,ae,Q,Y=b.length;if(!b.every((Pe=>typeof Pe=="string")))return da(_,cy);function Z(Pe){D=(function(De){return De==="next"?ze=>ze.toUpperCase():ze=>ze.toLowerCase()})(Pe),F=(function(De){return De==="next"?ze=>ze.toLowerCase():ze=>ze.toUpperCase()})(Pe),T=Pe==="next"?E_:P_;var Le=b.map((function(De){return{lower:F(De),upper:D(De)}})).sort((function(De,ze){return T(De.lower,ze.lower)}));h=Le.map((function(De){return De.upper})),X=Le.map((function(De){return De.lower})),ae=Pe,Q=Pe==="next"?"":C}Z("next");var Ie=new _.Collection(_,(()=>Iu(h[0],X[Y-1]+C)));Ie._ondirectionchange=function(Pe){Z(Pe)};var Re=0;return Ie._addAlgorithm((function(Pe,Le,De){var ze=Pe.key;if(typeof ze!="string")return!1;var $e=F(ze);if(y($e,X,Re))return!0;for(var et=null,Je=Re;Je<Y;++Je){var He=C_(ze,$e,h[Je],X[Je],T,ae);He===null&&et===null?Re=Je+1:(et===null||T(et,He)>0)&&(et=He)}return Le(et!==null?function(){Pe.continue(et+Q)}:De),!1})),Ie}function Iu(_,y,b,C){return{type:2,lower:_,upper:y,lowerOpen:b,upperOpen:C}}function py(_){return{type:1,lower:_,upper:_}}class fy{get Collection(){return this._ctx.table.db.Collection}between(y,b,C,D){C=C!==!1,D=D===!0;try{return this._cmp(y,b)>0||this._cmp(y,b)===0&&(C||D)&&(!C||!D)?Uh(this):new this.Collection(this,(()=>Iu(y,b,!C,!D)))}catch{return da(this,Bl)}}equals(y){return y==null?da(this,Bl):new this.Collection(this,(()=>py(y)))}above(y){return y==null?da(this,Bl):new this.Collection(this,(()=>Iu(y,void 0,!0)))}aboveOrEqual(y){return y==null?da(this,Bl):new this.Collection(this,(()=>Iu(y,void 0,!1)))}below(y){return y==null?da(this,Bl):new this.Collection(this,(()=>Iu(void 0,y,!1,!0)))}belowOrEqual(y){return y==null?da(this,Bl):new this.Collection(this,(()=>Iu(void 0,y)))}startsWith(y){return typeof y!="string"?da(this,cy):this.between(y,y+Fc,!0,!0)}startsWithIgnoreCase(y){return y===""?this.startsWith(y):nf(this,((b,C)=>b.indexOf(C[0])===0),[y],Fc)}equalsIgnoreCase(y){return nf(this,((b,C)=>b===C[0]),[y],"")}anyOfIgnoreCase(){var y=Ol.apply(qh,arguments);return y.length===0?Uh(this):nf(this,((b,C)=>C.indexOf(b)!==-1),y,"")}startsWithAnyOfIgnoreCase(){var y=Ol.apply(qh,arguments);return y.length===0?Uh(this):nf(this,((b,C)=>C.some((D=>b.indexOf(D)===0))),y,Fc)}anyOf(){const y=Ol.apply(qh,arguments);let b=this._cmp;try{y.sort(b)}catch{return da(this,Bl)}if(y.length===0)return Uh(this);const C=new this.Collection(this,(()=>Iu(y[0],y[y.length-1])));C._ondirectionchange=F=>{b=F==="next"?this._ascending:this._descending,y.sort(b)};let D=0;return C._addAlgorithm(((F,T,h)=>{const X=F.key;for(;b(X,y[D])>0;)if(++D,D===y.length)return T(h),!1;return b(X,y[D])===0||(T((()=>{F.continue(y[D])})),!1)})),C}notEqual(y){return this.inAnyRange([[km,y],[y,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const y=Ol.apply(qh,arguments);if(y.length===0)return new this.Collection(this);try{y.sort(this._ascending)}catch{return da(this,Bl)}const b=y.reduce(((C,D)=>C?C.concat([[C[C.length-1][1],D]]):[[km,D]]),null);return b.push([y[y.length-1],this.db._maxKey]),this.inAnyRange(b,{includeLowers:!1,includeUppers:!1})}inAnyRange(y,b){const C=this._cmp,D=this._ascending,F=this._descending,T=this._min,h=this._max;if(y.length===0)return Uh(this);if(!y.every((ze=>ze[0]!==void 0&&ze[1]!==void 0&&D(ze[0],ze[1])<=0)))return da(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",er.InvalidArgument);const X=!b||b.includeLowers!==!1,ae=b&&b.includeUppers===!0;let Q,Y=D;function Z(ze,$e){return Y(ze[0],$e[0])}try{Q=y.reduce((function(ze,$e){let et=0,Je=ze.length;for(;et<Je;++et){const He=ze[et];if(C($e[0],He[1])<0&&C($e[1],He[0])>0){He[0]=T(He[0],$e[0]),He[1]=h(He[1],$e[1]);break}}return et===Je&&ze.push($e),ze}),[]),Q.sort(Z)}catch{return da(this,Bl)}let Ie=0;const Re=ae?ze=>D(ze,Q[Ie][1])>0:ze=>D(ze,Q[Ie][1])>=0,Pe=X?ze=>F(ze,Q[Ie][0])>0:ze=>F(ze,Q[Ie][0])>=0;let Le=Re;const De=new this.Collection(this,(()=>Iu(Q[0][0],Q[Q.length-1][1],!X,!ae)));return De._ondirectionchange=ze=>{ze==="next"?(Le=Re,Y=D):(Le=Pe,Y=F),Q.sort(Z)},De._addAlgorithm(((ze,$e,et)=>{for(var Je=ze.key;Le(Je);)if(++Ie,Ie===Q.length)return $e(et),!1;return!!(function(He){return!Re(He)&&!Pe(He)})(Je)||(this._cmp(Je,Q[Ie][1])===0||this._cmp(Je,Q[Ie][0])===0||$e((()=>{Y===D?ze.continue(Q[Ie][0]):ze.continue(Q[Ie][1])})),!1)})),De}startsWithAnyOf(){const y=Ol.apply(qh,arguments);return y.every((b=>typeof b=="string"))?y.length===0?Uh(this):this.inAnyRange(y.map((b=>[b,b+Fc]))):da(this,"startsWithAnyOf() only works with strings")}}function Qo(_){return fn((function(y){return ep(y),_(y.target.error),!1}))}function ep(_){_.stopPropagation&&_.stopPropagation(),_.preventDefault&&_.preventDefault()}const tp="storagemutated",Pu="x-storagemutated-1",Au=Wd(null,tp);class M_{_lock(){return Ud(!qt.global),++this._reculock,this._reculock!==1||qt.global||(qt.lockOwnerFor=this),this}_unlock(){if(Ud(!qt.global),--this._reculock==0)for(qt.global||(qt.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var y=this._blockedFuncs.shift();try{Yh(y[1],y[0])}catch{}}return this}_locked(){return this._reculock&&qt.lockOwnerFor!==this}create(y){if(!this.mode)return this;const b=this.db.idbdb,C=this.db._state.dbOpenError;if(Ud(!this.idbtrans),!y&&!b)switch(C&&C.name){case"DatabaseClosedError":throw new er.DatabaseClosed(C);case"MissingAPIError":throw new er.MissingAPI(C.message,C);default:throw new er.OpenFailed(C)}if(!this.active)throw new er.TransactionInactive;return Ud(this._completion._state===null),(y=this.idbtrans=y||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):b.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=fn((D=>{ep(D),this._reject(y.error)})),y.onabort=fn((D=>{ep(D),this.active&&this._reject(new er.Abort(y.error)),this.active=!1,this.on("abort").fire(D)})),y.oncomplete=fn((()=>{this.active=!1,this._resolve(),"mutatedParts"in y&&Au.storagemutated.fire(y.mutatedParts)})),this}_promise(y,b,C){if(y==="readwrite"&&this.mode!=="readwrite")return Yn(new er.ReadOnly("Transaction is readonly"));if(!this.active)return Yn(new er.TransactionInactive);if(this._locked())return new Et(((F,T)=>{this._blockedFuncs.push([()=>{this._promise(y,b,C).then(F,T)},qt])}));if(C)return Cu((()=>{var F=new Et(((T,h)=>{this._lock();const X=b(T,h,this);X&&X.then&&X.then(T,h)}));return F.finally((()=>this._unlock())),F._lib=!0,F}));var D=new Et(((F,T)=>{var h=b(F,T,this);h&&h.then&&h.then(F,T)}));return D._lib=!0,D}_root(){return this.parent?this.parent._root():this}waitFor(y){var b=this._root();const C=Et.resolve(y);if(b._waitingFor)b._waitingFor=b._waitingFor.then((()=>C));else{b._waitingFor=C,b._waitingQueue=[];var D=b.idbtrans.objectStore(b.storeNames[0]);(function T(){for(++b._spinCount;b._waitingQueue.length;)b._waitingQueue.shift()();b._waitingFor&&(D.get(-1/0).onsuccess=T)})()}var F=b._waitingFor;return new Et(((T,h)=>{C.then((X=>b._waitingQueue.push(fn(T.bind(null,X)))),(X=>b._waitingQueue.push(fn(h.bind(null,X))))).finally((()=>{b._waitingFor===F&&(b._waitingFor=null)}))}))}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new er.Abort))}table(y){const b=this._memoizedTables||(this._memoizedTables={});if(pa(b,y))return b[y];const C=this.schema[y];if(!C)throw new er.NotFound("Table "+y+" not part of transaction");const D=new this.db.Table(y,C,this);return D.core=this.db.core.table(y),b[y]=D,D}}function Tm(_,y,b,C,D,F,T){return{name:_,keyPath:y,unique:b,multi:C,auto:D,compound:F,src:(b&&!T?"&":"")+(C?"*":"")+(D?"++":"")+my(y)}}function my(_){return typeof _=="string"?_:_?"["+[].join.call(_,"+")+"]":""}function gy(_,y,b){return{name:_,primKey:y,indexes:b,mappedClass:null,idxByName:Hg(b,(C=>[C.name,C]))}}let rp=_=>{try{return _.only([[]]),rp=()=>[[]],[[]]}catch{return rp=()=>Fc,Fc}};function Im(_){return _==null?()=>{}:typeof _=="string"?(function(y){return y.split(".").length===1?C=>C[y]:C=>Vl(C,y)})(_):y=>Vl(y,_)}function Ag(_){return[].slice.call(_)}let A_=0;function Xd(_){return _==null?":id":typeof _=="string"?_:`[${_.join("+")}]`}function z_(_,y,b){function C(X){if(X.type===3)return null;if(X.type===4)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:ae,upper:Q,lowerOpen:Y,upperOpen:Z}=X;return ae===void 0?Q===void 0?null:y.upperBound(Q,!!Z):Q===void 0?y.lowerBound(ae,!!Y):y.bound(ae,Q,!!Y,!!Z)}const{schema:D,hasGetAll:F}=(function(X,ae){const Q=Ag(X.objectStoreNames);return{schema:{name:X.name,tables:Q.map((Y=>ae.objectStore(Y))).map((Y=>{const{keyPath:Z,autoIncrement:Ie}=Y,Re=Xi(Z),Pe=Z==null,Le={},De={name:Y.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:Pe,compound:Re,keyPath:Z,autoIncrement:Ie,unique:!0,extractKey:Im(Z)},indexes:Ag(Y.indexNames).map((ze=>Y.index(ze))).map((ze=>{const{name:$e,unique:et,multiEntry:Je,keyPath:He}=ze,je={name:$e,compound:Xi(He),keyPath:He,unique:et,multiEntry:Je,extractKey:Im(He)};return Le[Xd(He)]=je,je})),getIndexByKeyPath:ze=>Le[Xd(ze)]};return Le[":id"]=De.primaryKey,Z!=null&&(Le[Xd(Z)]=De.primaryKey),De}))},hasGetAll:Q.length>0&&"getAll"in ae.objectStore(Q[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}})(_,b),T=D.tables.map((X=>(function(ae){const Q=ae.name;return{name:Q,schema:ae,mutate:function({trans:Y,type:Z,keys:Ie,values:Re,range:Pe}){return new Promise(((Le,De)=>{Le=fn(Le);const ze=Y.objectStore(Q),$e=ze.keyPath==null,et=Z==="put"||Z==="add";if(!et&&Z!=="delete"&&Z!=="deleteRange")throw new Error("Invalid operation type: "+Z);const{length:Je}=Ie||Re||{length:1};if(Ie&&Re&&Ie.length!==Re.length)throw new Error("Given keys array must have same length as given values array.");if(Je===0)return Le({numFailures:0,failures:{},results:[],lastResult:void 0});let He;const je=[],ut=[];let Ve=0;const tr=ar=>{++Ve,ep(ar)};if(Z==="deleteRange"){if(Pe.type===4)return Le({numFailures:Ve,failures:ut,results:[],lastResult:void 0});Pe.type===3?je.push(He=ze.clear()):je.push(He=ze.delete(C(Pe)))}else{const[ar,Rt]=et?$e?[Re,Ie]:[Re,null]:[Ie,null];if(et)for(let Bt=0;Bt<Je;++Bt)je.push(He=Rt&&Rt[Bt]!==void 0?ze[Z](ar[Bt],Rt[Bt]):ze[Z](ar[Bt])),He.onerror=tr;else for(let Bt=0;Bt<Je;++Bt)je.push(He=ze[Z](ar[Bt])),He.onerror=tr}const vt=ar=>{const Rt=ar.target.result;je.forEach(((Bt,$r)=>Bt.error!=null&&(ut[$r]=Bt.error))),Le({numFailures:Ve,failures:ut,results:Z==="delete"?Ie:je.map((Bt=>Bt.result)),lastResult:Rt})};He.onerror=ar=>{tr(ar),vt(ar)},He.onsuccess=vt}))},getMany:({trans:Y,keys:Z})=>new Promise(((Ie,Re)=>{Ie=fn(Ie);const Pe=Y.objectStore(Q),Le=Z.length,De=new Array(Le);let ze,$e=0,et=0;const Je=je=>{const ut=je.target;De[ut._pos]=ut.result,++et===$e&&Ie(De)},He=Qo(Re);for(let je=0;je<Le;++je)Z[je]!=null&&(ze=Pe.get(Z[je]),ze._pos=je,ze.onsuccess=Je,ze.onerror=He,++$e);$e===0&&Ie(De)})),get:({trans:Y,key:Z})=>new Promise(((Ie,Re)=>{Ie=fn(Ie);const Pe=Y.objectStore(Q).get(Z);Pe.onsuccess=Le=>Ie(Le.target.result),Pe.onerror=Qo(Re)})),query:(function(Y){return Z=>new Promise(((Ie,Re)=>{Ie=fn(Ie);const{trans:Pe,values:Le,limit:De,query:ze}=Z,$e=De===1/0?void 0:De,{index:et,range:Je}=ze,He=Pe.objectStore(Q),je=et.isPrimaryKey?He:He.index(et.name),ut=C(Je);if(De===0)return Ie({result:[]});if(Y){const Ve=Le?je.getAll(ut,$e):je.getAllKeys(ut,$e);Ve.onsuccess=tr=>Ie({result:tr.target.result}),Ve.onerror=Qo(Re)}else{let Ve=0;const tr=Le||!("openKeyCursor"in je)?je.openCursor(ut):je.openKeyCursor(ut),vt=[];tr.onsuccess=ar=>{const Rt=tr.result;return Rt?(vt.push(Le?Rt.value:Rt.primaryKey),++Ve===De?Ie({result:vt}):void Rt.continue()):Ie({result:vt})},tr.onerror=Qo(Re)}}))})(F),openCursor:function({trans:Y,values:Z,query:Ie,reverse:Re,unique:Pe}){return new Promise(((Le,De)=>{Le=fn(Le);const{index:ze,range:$e}=Ie,et=Y.objectStore(Q),Je=ze.isPrimaryKey?et:et.index(ze.name),He=Re?Pe?"prevunique":"prev":Pe?"nextunique":"next",je=Z||!("openKeyCursor"in Je)?Je.openCursor(C($e),He):Je.openKeyCursor(C($e),He);je.onerror=Qo(De),je.onsuccess=fn((ut=>{const Ve=je.result;if(!Ve)return void Le(null);Ve.___id=++A_,Ve.done=!1;const tr=Ve.continue.bind(Ve);let vt=Ve.continuePrimaryKey;vt&&(vt=vt.bind(Ve));const ar=Ve.advance.bind(Ve),Rt=()=>{throw new Error("Cursor not stopped")};Ve.trans=Y,Ve.stop=Ve.continue=Ve.continuePrimaryKey=Ve.advance=()=>{throw new Error("Cursor not started")},Ve.fail=fn(De),Ve.next=function(){let Bt=1;return this.start((()=>Bt--?this.continue():this.stop())).then((()=>this))},Ve.start=Bt=>{const $r=new Promise(((Ht,lt)=>{Ht=fn(Ht),je.onerror=Qo(lt),Ve.fail=lt,Ve.stop=Pt=>{Ve.stop=Ve.continue=Ve.continuePrimaryKey=Ve.advance=Rt,Ht(Pt)}})),Or=()=>{if(je.result)try{Bt()}catch(Ht){Ve.fail(Ht)}else Ve.done=!0,Ve.start=()=>{throw new Error("Cursor behind last entry")},Ve.stop()};return je.onsuccess=fn((Ht=>{je.onsuccess=Or,Or()})),Ve.continue=tr,Ve.continuePrimaryKey=vt,Ve.advance=ar,Or(),$r},Le(Ve)}),De)}))},count({query:Y,trans:Z}){const{index:Ie,range:Re}=Y;return new Promise(((Pe,Le)=>{const De=Z.objectStore(Q),ze=Ie.isPrimaryKey?De:De.index(Ie.name),$e=C(Re),et=$e?ze.count($e):ze.count();et.onsuccess=fn((Je=>Pe(Je.target.result))),et.onerror=Qo(Le)}))}}})(X))),h={};return T.forEach((X=>h[X.name]=X)),{stack:"dbcore",transaction:_.transaction.bind(_),table(X){if(!h[X])throw new Error(`Table '${X}' not found`);return h[X]},MIN_KEY:-1/0,MAX_KEY:rp(y),schema:D}}function Em({_novip:_},y){const b=y.db,C=(function(D,F,{IDBKeyRange:T,indexedDB:h},X){return{dbcore:(function(Q,Y){return Y.reduce(((Z,{create:Ie})=>({...Z,...Ie(Z)})),Q)})(z_(F,T,X),D.dbcore)}})(_._middlewares,b,_._deps,y);_.core=C.dbcore,_.tables.forEach((D=>{const F=D.name;_.core.schema.tables.some((T=>T.name===F))&&(D.core=_.core.table(F),_[F]instanceof _.Table&&(_[F].core=D.core))}))}function Sf({_novip:_},y,b,C){b.forEach((D=>{const F=C[D];y.forEach((T=>{const h=jm(T,D);(!h||"value"in h&&h.value===void 0)&&(T===_.Transaction.prototype||T instanceof _.Transaction?jl(T,D,{get(){return this.table(D)},set(X){qg(this,D,{value:X,writable:!0,configurable:!0,enumerable:!0})}}):T[D]=new _.Table(D,F))}))}))}function Pm({_novip:_},y){y.forEach((b=>{for(let C in b)b[C]instanceof _.Table&&delete b[C]}))}function D_(_,y){return _._cfg.version-y._cfg.version}function L_(_,y,b,C){const D=_._dbSchema,F=_._createTransaction("readwrite",_._storeNames,D);F.create(b),F._completion.catch(C);const T=F._reject.bind(F),h=qt.transless||qt;Cu((()=>{qt.trans=F,qt.transless=h,y===0?(Vn(D).forEach((X=>{lm(b,X,D[X].primKey,D[X].indexes)})),Em(_,b),Et.follow((()=>_.on.populate.fire(F))).catch(T)):(function({_novip:X},ae,Q,Y){const Z=[],Ie=X._versions;let Re=X._dbSchema=Mm(X,X.idbdb,Y),Pe=!1;const Le=Ie.filter((ze=>ze._cfg.version>=ae));function De(){return Z.length?Et.resolve(Z.shift()(Q.idbtrans)).then(De):Et.resolve()}return Le.forEach((ze=>{Z.push((()=>{const $e=Re,et=ze._cfg.dbschema;Am(X,$e,Y),Am(X,et,Y),Re=X._dbSchema=et;const Je=yy($e,et);Je.add.forEach((je=>{lm(Y,je[0],je[1].primKey,je[1].indexes)})),Je.change.forEach((je=>{if(je.recreate)throw new er.Upgrade("Not yet support for changing primary key");{const ut=Y.objectStore(je.name);je.add.forEach((Ve=>Cm(ut,Ve))),je.change.forEach((Ve=>{ut.deleteIndex(Ve.name),Cm(ut,Ve)})),je.del.forEach((Ve=>ut.deleteIndex(Ve)))}}));const He=ze._cfg.contentUpgrade;if(He&&ze._cfg.version>ae){Em(X,Y),Q._memoizedTables={},Pe=!0;let je=Kg(et);Je.del.forEach((vt=>{je[vt]=$e[vt]})),Pm(X,[X.Transaction.prototype]),Sf(X,[X.Transaction.prototype],Vn(je),je),Q.schema=je;const ut=Vm(He);let Ve;ut&&Xh();const tr=Et.follow((()=>{if(Ve=He(Q),Ve&&ut){var vt=Ul.bind(null,null);Ve.then(vt,vt)}}));return Ve&&typeof Ve.then=="function"?Et.resolve(Ve):tr.then((()=>Ve))}})),Z.push(($e=>{(!Pe||!S_)&&(function(et,Je){[].slice.call(Je.db.objectStoreNames).forEach((He=>et[He]==null&&Je.db.deleteObjectStore(He)))})(ze._cfg.dbschema,$e),Pm(X,[X.Transaction.prototype]),Sf(X,[X.Transaction.prototype],X._storeNames,X._dbSchema),Q.schema=X._dbSchema}))})),De().then((()=>{var ze,$e;$e=Y,Vn(ze=Re).forEach((et=>{$e.db.objectStoreNames.contains(et)||lm($e,et,ze[et].primKey,ze[et].indexes)}))}))})(_,y,F,b).catch(T)}))}function yy(_,y){const b={del:[],add:[],change:[]};let C;for(C in _)y[C]||b.del.push(C);for(C in y){const D=_[C],F=y[C];if(D){const T={name:C,def:F,recreate:!1,del:[],add:[],change:[]};if(""+(D.primKey.keyPath||"")!=""+(F.primKey.keyPath||"")||D.primKey.auto!==F.primKey.auto&&!Tf)T.recreate=!0,b.change.push(T);else{const h=D.idxByName,X=F.idxByName;let ae;for(ae in h)X[ae]||T.del.push(ae);for(ae in X){const Q=h[ae],Y=X[ae];Q?Q.src!==Y.src&&T.change.push(Y):T.add.push(Y)}(T.del.length>0||T.add.length>0||T.change.length>0)&&b.change.push(T)}}else b.add.push([C,F])}return b}function lm(_,y,b,C){const D=_.db.createObjectStore(y,b.keyPath?{keyPath:b.keyPath,autoIncrement:b.auto}:{autoIncrement:b.auto});return C.forEach((F=>Cm(D,F))),D}function Cm(_,y){_.createIndex(y.name,y.keyPath,{unique:y.unique,multiEntry:y.multi})}function Mm(_,y,b){const C={};return yf(y.objectStoreNames,0).forEach((D=>{const F=b.objectStore(D);let T=F.keyPath;const h=Tm(my(T),T||"",!1,!1,!!F.autoIncrement,T&&typeof T!="string",!0),X=[];for(let Q=0;Q<F.indexNames.length;++Q){const Y=F.index(F.indexNames[Q]);T=Y.keyPath;var ae=Tm(Y.name,T,!!Y.unique,!!Y.multiEntry,!1,T&&typeof T!="string",!1);X.push(ae)}C[D]=gy(D,h,X)})),C}function Am({_novip:_},y,b){const C=b.db.objectStoreNames;for(let D=0;D<C.length;++D){const F=C[D],T=b.objectStore(F);_._hasGetAll="getAll"in T;for(let h=0;h<T.indexNames.length;++h){const X=T.indexNames[h],ae=T.index(X).keyPath,Q=typeof ae=="string"?ae:"["+yf(ae).join("+")+"]";if(y[F]){const Y=y[F].idxByName[Q];Y&&(Y.name=X,delete y[F].idxByName[Q],y[F].idxByName[X]=Y)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&hn.WorkerGlobalScope&&hn instanceof hn.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(_._hasGetAll=!1)}class R_{_parseStoresSpec(y,b){Vn(y).forEach((C=>{if(y[C]!==null){var D=y[C].split(",").map(((T,h)=>{const X=(T=T.trim()).replace(/([&*]|\+\+)/g,""),ae=/^\[/.test(X)?X.match(/^\[(.*)\]$/)[1].split("+"):X;return Tm(X,ae||null,/\&/.test(T),/\*/.test(T),/\+\+/.test(T),Xi(ae),h===0)})),F=D.shift();if(F.multi)throw new er.Schema("Primary key cannot be multi-valued");D.forEach((T=>{if(T.auto)throw new er.Schema("Only primary key can be marked as autoIncrement (++)");if(!T.keyPath)throw new er.Schema("Index must have a name and cannot be an empty string")})),b[C]=gy(C,F,D)}}))}stores(y){const b=this.db;this._cfg.storesSource=this._cfg.storesSource?xs(this._cfg.storesSource,y):y;const C=b._versions,D={};let F={};return C.forEach((T=>{xs(D,T._cfg.storesSource),F=T._cfg.dbschema={},T._parseStoresSpec(D,F)})),b._dbSchema=F,Pm(b,[b._allTables,b,b.Transaction.prototype]),Sf(b,[b._allTables,b,b.Transaction.prototype,this._cfg.tables],Vn(F),F),b._storeNames=Vn(F),this}upgrade(y){return this._cfg.contentUpgrade=qm(this._cfg.contentUpgrade||en,y),this}}function Km(_,y){let b=_._dbNamesDB;return b||(b=_._dbNamesDB=new jc(If,{addons:[],indexedDB:_,IDBKeyRange:y}),b.version(1).stores({dbnames:"name"})),b.table("dbnames")}function Wm(_){return _&&typeof _.databases=="function"}function zm(_){return Cu((function(){return qt.letThrough=!0,_()}))}function B_(){var _;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise((function(y){var b=function(){return indexedDB.databases().finally(y)};_=setInterval(b,100),b()})).finally((function(){return clearInterval(_)})):Promise.resolve()}function F_(_){const y=_._state,{indexedDB:b}=_._deps;if(y.isBeingOpened||_.idbdb)return y.dbReadyPromise.then((()=>y.dbOpenError?Yn(y.dbOpenError):_));el&&(y.openCanceller._stackHolder=$c()),y.isBeingOpened=!0,y.dbOpenError=null,y.openComplete=!1;const C=y.openCanceller;function D(){if(y.openCanceller!==C)throw new er.DatabaseClosed("db.open() was cancelled")}let F=y.dbReadyResolve,T=null,h=!1;const X=()=>new Et(((ae,Q)=>{if(D(),!b)throw new er.MissingAPI;const Y=_.name,Z=y.autoSchema?b.open(Y):b.open(Y,Math.round(10*_.verno));if(!Z)throw new er.MissingAPI;Z.onerror=Qo(Q),Z.onblocked=fn(_._fireOnBlocked),Z.onupgradeneeded=fn((Ie=>{if(T=Z.transaction,y.autoSchema&&!_._options.allowEmptyDB){Z.onerror=ep,T.abort(),Z.result.close();const Pe=b.deleteDatabase(Y);Pe.onsuccess=Pe.onerror=fn((()=>{Q(new er.NoSuchDatabase(`Database ${Y} doesnt exist`))}))}else{T.onerror=Qo(Q);var Re=Ie.oldVersion>Math.pow(2,62)?0:Ie.oldVersion;h=Re<1,_._novip.idbdb=Z.result,L_(_,Re/10,T,Q)}}),Q),Z.onsuccess=fn((()=>{T=null;const Ie=_._novip.idbdb=Z.result,Re=yf(Ie.objectStoreNames);if(Re.length>0)try{const Le=Ie.transaction((Pe=Re).length===1?Pe[0]:Pe,"readonly");y.autoSchema?(function({_novip:De},ze,$e){De.verno=ze.version/10;const et=De._dbSchema=Mm(0,ze,$e);De._storeNames=yf(ze.objectStoreNames,0),Sf(De,[De._allTables],Vn(et),et)})(_,Ie,Le):(Am(_,_._dbSchema,Le),(function(De,ze){const $e=yy(Mm(0,De.idbdb,ze),De._dbSchema);return!($e.add.length||$e.change.some((et=>et.add.length||et.change.length)))})(_,Le)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),Em(_,Le)}catch{}var Pe;Kd.push(_),Ie.onversionchange=fn((Le=>{y.vcFired=!0,_.on("versionchange").fire(Le)})),Ie.onclose=fn((Le=>{_.on("close").fire(Le)})),h&&(function({indexedDB:Le,IDBKeyRange:De},ze){!Wm(Le)&&ze!==If&&Km(Le,De).put({name:ze}).catch(en)})(_._deps,Y),ae()}),Q)})).catch((ae=>ae&&ae.name==="UnknownError"&&y.PR1398_maxLoop>0?(y.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),X()):Et.reject(ae)));return Et.race([C,(typeof navigator>"u"?Et.resolve():B_()).then(X)]).then((()=>(D(),y.onReadyBeingFired=[],Et.resolve(zm((()=>_.on.ready.fire(_.vip)))).then((function ae(){if(y.onReadyBeingFired.length>0){let Q=y.onReadyBeingFired.reduce(qm,en);return y.onReadyBeingFired=[],Et.resolve(zm((()=>Q(_.vip)))).then(ae)}}))))).finally((()=>{y.onReadyBeingFired=null,y.isBeingOpened=!1})).then((()=>_)).catch((ae=>{y.dbOpenError=ae;try{T&&T.abort()}catch{}return C===y.openCanceller&&_._close(),Yn(ae)})).finally((()=>{y.openComplete=!0,F()}))}function Dm(_){var y=F=>_.next(F),b=D(y),C=D((F=>_.throw(F)));function D(F){return T=>{var h=F(T),X=h.value;return h.done?X:X&&typeof X.then=="function"?X.then(b,C):Xi(X)?Promise.all(X).then(b,C):b(X)}}return D(y)()}function O_(_,y,b){var C=arguments.length;if(C<2)throw new er.InvalidArgument("Too few arguments");for(var D=new Array(C-1);--C;)D[C-1]=arguments[C];return b=D.pop(),[_,Wg(D),b]}function _y(_,y,b,C,D){return Et.resolve().then((()=>{const F=qt.transless||qt,T=_._createTransaction(y,b,_._dbSchema,C),h={trans:T,transless:F};if(C)T.idbtrans=C.idbtrans;else try{T.create(),_._state.PR1398_maxLoop=3}catch(Y){return Y.name===$m.InvalidState&&_.isOpen()&&--_._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),_._close(),_.open().then((()=>_y(_,y,b,null,D)))):Yn(Y)}const X=Vm(D);let ae;X&&Xh();const Q=Et.follow((()=>{if(ae=D.call(T,T),ae)if(X){var Y=Ul.bind(null,null);ae.then(Y,Y)}else typeof ae.next=="function"&&typeof ae.throw=="function"&&(ae=Dm(ae))}),h);return(ae&&typeof ae.then=="function"?Et.resolve(ae).then((Y=>T.active?Y:Yn(new er.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn")))):Q.then((()=>ae))).then((Y=>(C&&T._resolve(),T._completion.then((()=>Y))))).catch((Y=>(T._reject(Y),Yn(Y))))}))}function sf(_,y,b){const C=Xi(_)?_.slice():[_];for(let D=0;D<b;++D)C.push(y);return C}const N_={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(_){return{..._,table(y){const b=_.table(y),{schema:C}=b,D={},F=[];function T(Q,Y,Z){const Ie=Xd(Q),Re=D[Ie]=D[Ie]||[],Pe=Q==null?0:typeof Q=="string"?1:Q.length,Le=Y>0,De={...Z,isVirtual:Le,keyTail:Y,keyLength:Pe,extractKey:Im(Q),unique:!Le&&Z.unique};return Re.push(De),De.isPrimaryKey||F.push(De),Pe>1&&T(Pe===2?Q[0]:Q.slice(0,Pe-1),Y+1,Z),Re.sort(((ze,$e)=>ze.keyTail-$e.keyTail)),De}const h=T(C.primaryKey.keyPath,0,C.primaryKey);D[":id"]=[h];for(const Q of C.indexes)T(Q.keyPath,0,Q);function X(Q){const Y=Q.query.index;return Y.isVirtual?{...Q,query:{index:Y,range:(Z=Q.query.range,Ie=Y.keyTail,{type:Z.type===1?2:Z.type,lower:sf(Z.lower,Z.lowerOpen?_.MAX_KEY:_.MIN_KEY,Ie),lowerOpen:!0,upper:sf(Z.upper,Z.upperOpen?_.MIN_KEY:_.MAX_KEY,Ie),upperOpen:!0})}}:Q;var Z,Ie}return{...b,schema:{...C,primaryKey:h,indexes:F,getIndexByKeyPath:function(Q){const Y=D[Xd(Q)];return Y&&Y[0]}},count:Q=>b.count(X(Q)),query:Q=>b.query(X(Q)),openCursor(Q){const{keyTail:Y,isVirtual:Z,keyLength:Ie}=Q.query.index;return Z?b.openCursor(X(Q)).then((Re=>Re&&(function(Pe){return Object.create(Pe,{continue:{value:function(De){De!=null?Pe.continue(sf(De,Q.reverse?_.MAX_KEY:_.MIN_KEY,Y)):Q.unique?Pe.continue(Pe.key.slice(0,Ie).concat(Q.reverse?_.MIN_KEY:_.MAX_KEY,Y)):Pe.continue()}},continuePrimaryKey:{value(De,ze){Pe.continuePrimaryKey(sf(De,_.MAX_KEY,Y),ze)}},primaryKey:{get:()=>Pe.primaryKey},key:{get(){const De=Pe.key;return Ie===1?De[0]:De.slice(0,Ie)}},value:{get:()=>Pe.value}})})(Re))):b.openCursor(Q)}}}}}};function Xm(_,y,b,C){return b=b||{},C=C||"",Vn(_).forEach((D=>{if(pa(y,D)){var F=_[D],T=y[D];if(typeof F=="object"&&typeof T=="object"&&F&&T){const h=dm(F);h!==dm(T)?b[C+D]=y[D]:h==="Object"?Xm(F,T,b,C+D+"."):F!==T&&(b[C+D]=y[D])}else F!==T&&(b[C+D]=y[D])}else b[C+D]=void 0})),Vn(y).forEach((D=>{pa(_,D)||(b[C+D]=y[D])})),b}const j_={stack:"dbcore",name:"HooksMiddleware",level:2,create:_=>({..._,table(y){const b=_.table(y),{primaryKey:C}=b.schema;return{...b,mutate(F){const T=qt.trans,{deleting:h,creating:X,updating:ae}=T.table(y).hook;switch(F.type){case"add":if(X.fire===en)break;return T._promise("readwrite",(()=>Q(F)),!0);case"put":if(X.fire===en&&ae.fire===en)break;return T._promise("readwrite",(()=>Q(F)),!0);case"delete":if(h.fire===en)break;return T._promise("readwrite",(()=>Q(F)),!0);case"deleteRange":if(h.fire===en)break;return T._promise("readwrite",(()=>(function(Z){return Y(Z.trans,Z.range,1e4)})(F)),!0)}return b.mutate(F);function Q(Z){const Ie=qt.trans,Re=Z.keys||(function(Pe,Le){return Le.type==="delete"?Le.keys:Le.keys||Le.values.map(Pe.extractKey)})(C,Z);if(!Re)throw new Error("Keys missing");return(Z=Z.type==="add"||Z.type==="put"?{...Z,keys:Re}:{...Z}).type!=="delete"&&(Z.values=[...Z.values]),Z.keys&&(Z.keys=[...Z.keys]),(function(Pe,Le,De){return Le.type==="add"?Promise.resolve([]):Pe.getMany({trans:Le.trans,keys:De,cache:"immutable"})})(b,Z,Re).then((Pe=>{const Le=Re.map(((De,ze)=>{const $e=Pe[ze],et={onerror:null,onsuccess:null};if(Z.type==="delete")h.fire.call(et,De,$e,Ie);else if(Z.type==="add"||$e===void 0){const Je=X.fire.call(et,De,Z.values[ze],Ie);De==null&&Je!=null&&(De=Je,Z.keys[ze]=De,C.outbound||uo(Z.values[ze],C.keyPath,De))}else{const Je=Xm($e,Z.values[ze]),He=ae.fire.call(et,Je,De,$e,Ie);if(He){const je=Z.values[ze];Object.keys(He).forEach((ut=>{pa(je,ut)?je[ut]=He[ut]:uo(je,ut,He[ut])}))}}return et}));return b.mutate(Z).then((({failures:De,results:ze,numFailures:$e,lastResult:et})=>{for(let Je=0;Je<Re.length;++Je){const He=ze?ze[Je]:Re[Je],je=Le[Je];He==null?je.onerror&&je.onerror(De[Je]):je.onsuccess&&je.onsuccess(Z.type==="put"&&Pe[Je]?Z.values[Je]:He)}return{failures:De,results:ze,numFailures:$e,lastResult:et}})).catch((De=>(Le.forEach((ze=>ze.onerror&&ze.onerror(De))),Promise.reject(De))))}))}function Y(Z,Ie,Re){return b.query({trans:Z,values:!1,query:{index:C,range:Ie},limit:Re}).then((({result:Pe})=>Q({type:"delete",keys:Pe,trans:Z}).then((Le=>Le.numFailures>0?Promise.reject(Le.failures[0]):Pe.length<Re?{failures:[],numFailures:0,lastResult:void 0}:Y(Z,{...Ie,lower:Pe[Pe.length-1],lowerOpen:!0},Re)))))}}}}})};function vy(_,y,b){try{if(!y||y.keys.length<_.length)return null;const C=[];for(let D=0,F=0;D<y.keys.length&&F<_.length;++D)vs(y.keys[D],_[F])===0&&(C.push(b?ip(y.values[D]):y.values[D]),++F);return C.length===_.length?C:null}catch{return null}}const V_={stack:"dbcore",level:-1,create:_=>({table:y=>{const b=_.table(y);return{...b,getMany:C=>{if(!C.cache)return b.getMany(C);const D=vy(C.keys,C.trans._cache,C.cache==="clone");return D?Et.resolve(D):b.getMany(C).then((F=>(C.trans._cache={keys:C.keys,values:C.cache==="clone"?ip(F):F},F)))},mutate:C=>(C.type!=="add"&&(C.trans._cache=null),b.mutate(C))}}})};function Ym(_){return!("from"in _)}const Fl=function(_,y){if(!this){const b=new Fl;return _&&"d"in _&&xs(b,_),b}xs(this,arguments.length?{d:1,from:_,to:arguments.length>1?y:_}:{d:0})};function np(_,y,b){const C=vs(y,b);if(isNaN(C))return;if(C>0)throw RangeError();if(Ym(_))return xs(_,{from:y,to:b,d:1});const D=_.l,F=_.r;if(vs(b,_.from)<0)return D?np(D,y,b):_.l={from:y,to:b,d:1,l:null,r:null},zg(_);if(vs(y,_.to)>0)return F?np(F,y,b):_.r={from:y,to:b,d:1,l:null,r:null},zg(_);vs(y,_.from)<0&&(_.from=y,_.l=null,_.d=F?F.d+1:1),vs(b,_.to)>0&&(_.to=b,_.r=null,_.d=_.l?_.l.d+1:1);const T=!_.r;D&&!_.l&&kf(_,D),F&&T&&kf(_,F)}function kf(_,y){Ym(y)||(function b(C,{from:D,to:F,l:T,r:h}){np(C,D,F),T&&b(C,T),h&&b(C,h)})(_,y)}function U_(_,y){const b=Lm(y);let C=b.next();if(C.done)return!1;let D=C.value;const F=Lm(_);let T=F.next(D.from),h=T.value;for(;!C.done&&!T.done;){if(vs(h.from,D.to)<=0&&vs(h.to,D.from)>=0)return!0;vs(D.from,h.from)<0?D=(C=b.next(h.from)).value:h=(T=F.next(D.from)).value}return!1}function Lm(_){let y=Ym(_)?null:{s:0,n:_};return{next(b){const C=arguments.length>0;for(;y;)switch(y.s){case 0:if(y.s=1,C)for(;y.n.l&&vs(b,y.n.from)<0;)y={up:y,n:y.n.l,s:1};else for(;y.n.l;)y={up:y,n:y.n.l,s:1};case 1:if(y.s=2,!C||vs(b,y.n.to)<=0)return{value:y.n,done:!1};case 2:if(y.n.r){y.s=3,y={up:y,n:y.n.r,s:0};continue}case 3:y=y.up}return{done:!0}}}}function zg(_){var y,b;const C=(((y=_.r)===null||y===void 0?void 0:y.d)||0)-(((b=_.l)===null||b===void 0?void 0:b.d)||0),D=C>1?"r":C<-1?"l":"";if(D){const F=D==="r"?"l":"r",T={..._},h=_[D];_.from=h.from,_.to=h.to,_[D]=h[D],T[D]=h[F],_[F]=T,T.d=Dg(T)}_.d=Dg(_)}function Dg({r:_,l:y}){return(_?y?Math.max(_.d,y.d):_.d:y?y.d:0)+1}Wh(Fl.prototype,{add(_){return kf(this,_),this},addKey(_){return np(this,_,_),this},addKeys(_){return _.forEach((y=>np(this,y,y))),this},[pm](){return Lm(this)}});const $_={stack:"dbcore",level:0,create:_=>{const y=_.schema.name,b=new Fl(_.MIN_KEY,_.MAX_KEY);return{..._,table:C=>{const D=_.table(C),{schema:F}=D,{primaryKey:T}=F,{extractKey:h,outbound:X}=T,ae={...D,mutate:Z=>{const Ie=Z.trans,Re=Ie.mutatedParts||(Ie.mutatedParts={}),Pe=He=>{const je=`idb://${y}/${C}/${He}`;return Re[je]||(Re[je]=new Fl)},Le=Pe(""),De=Pe(":dels"),{type:ze}=Z;let[$e,et]=Z.type==="deleteRange"?[Z.range]:Z.type==="delete"?[Z.keys]:Z.values.length<50?[[],Z.values]:[];const Je=Z.trans._cache;return D.mutate(Z).then((He=>{if(Xi($e)){ze!=="delete"&&($e=He.results),Le.addKeys($e);const je=vy($e,Je);je||ze==="add"||De.addKeys($e),(je||et)&&(function(ut,Ve,tr,vt){function ar(Rt){const Bt=ut(Rt.name||"");function $r(Ht){return Ht!=null?Rt.extractKey(Ht):null}const Or=Ht=>Rt.multiEntry&&Xi(Ht)?Ht.forEach((lt=>Bt.addKey(lt))):Bt.addKey(Ht);(tr||vt).forEach(((Ht,lt)=>{const Pt=tr&&$r(tr[lt]),ft=vt&&$r(vt[lt]);vs(Pt,ft)!==0&&(Pt!=null&&Or(Pt),ft!=null&&Or(ft))}))}Ve.indexes.forEach(ar)})(Pe,F,je,et)}else if($e){const je={from:$e.lower,to:$e.upper};De.add(je),Le.add(je)}else Le.add(b),De.add(b),F.indexes.forEach((je=>Pe(je.name).add(b)));return He}))}},Q=({query:{index:Z,range:Ie}})=>{var Re,Pe;return[Z,new Fl((Re=Ie.lower)!==null&&Re!==void 0?Re:_.MIN_KEY,(Pe=Ie.upper)!==null&&Pe!==void 0?Pe:_.MAX_KEY)]},Y={get:Z=>[T,new Fl(Z.key)],getMany:Z=>[T,new Fl().addKeys(Z.keys)],count:Q,query:Q,openCursor:Q};return Vn(Y).forEach((Z=>{ae[Z]=function(Ie){const{subscr:Re}=qt;if(Re){const Pe=et=>{const Je=`idb://${y}/${C}/${et}`;return Re[Je]||(Re[Je]=new Fl)},Le=Pe(""),De=Pe(":dels"),[ze,$e]=Y[Z](Ie);if(Pe(ze.name||"").add($e),!ze.isPrimaryKey){if(Z!=="count"){const et=Z==="query"&&X&&Ie.values&&D.query({...Ie,values:!1});return D[Z].apply(this,arguments).then((Je=>{if(Z==="query"){if(X&&Ie.values)return et.then((({result:je})=>(Le.addKeys(je),Je)));const He=Ie.values?Je.result.map(h):Je.result;Ie.values?Le.addKeys(He):De.addKeys(He)}else if(Z==="openCursor"){const He=Je,je=Ie.values;return He&&Object.create(He,{key:{get:()=>(De.addKey(He.primaryKey),He.key)},primaryKey:{get(){const ut=He.primaryKey;return De.addKey(ut),ut}},value:{get:()=>(je&&Le.addKey(He.primaryKey),He.value)}})}return Je}))}De.add(b)}}return D[Z].apply(this,arguments)}})),ae}}}};class jc{constructor(y,b){this._middlewares={},this.verno=0;const C=jc.dependencies;this._options=b={addons:jc.addons,autoOpen:!0,indexedDB:C.indexedDB,IDBKeyRange:C.IDBKeyRange,...b},this._deps={indexedDB:b.indexedDB,IDBKeyRange:b.IDBKeyRange};const{addons:D}=b;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const F={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:en,dbReadyPromise:null,cancelOpen:en,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var T;F.dbReadyPromise=new Et((h=>{F.dbReadyResolve=h})),F.openCanceller=new Et(((h,X)=>{F.cancelOpen=X})),this._state=F,this.name=y,this.on=Wd(this,"populate","blocked","versionchange","close",{ready:[qm,en]}),this.on.ready.subscribe=Zg(this.on.ready.subscribe,(h=>(X,ae)=>{jc.vip((()=>{const Q=this._state;if(Q.openComplete)Q.dbOpenError||Et.resolve().then(X),ae&&h(X);else if(Q.onReadyBeingFired)Q.onReadyBeingFired.push(X),ae&&h(X);else{h(X);const Y=this;ae||h((function Z(){Y.on.ready.unsubscribe(X),Y.on.ready.unsubscribe(Z)}))}}))})),this.Collection=(T=this,Od(I_.prototype,(function(h,X){this.db=T;let ae=dy,Q=null;if(X)try{ae=X()}catch(Re){Q=Re}const Y=h._ctx,Z=Y.table,Ie=Z.hook.reading.fire;this._ctx={table:Z,index:Y.index,isPrimKey:!Y.index||Z.schema.primKey.keyPath&&Y.index===Z.schema.primKey.name,range:ae,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:Q,or:Y.or,valueMapper:Ie!==Jd?Ie:null}}))),this.Table=(function(h){return Od(T_.prototype,(function(X,ae,Q){this.db=h,this._tx=Q,this.name=X,this.schema=ae,this.hook=h._allTables[X]?h._allTables[X].hook:Wd(null,{creating:[p_,en],reading:[d_,Jd],updating:[m_,en],deleting:[f_,en]})}))})(this),this.Transaction=(function(h){return Od(M_.prototype,(function(X,ae,Q,Y,Z){this.db=h,this.mode=X,this.storeNames=ae,this.schema=Q,this.chromeTransactionDurability=Y,this.idbtrans=null,this.on=Wd(this,"complete","error","abort"),this.parent=Z||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Et(((Ie,Re)=>{this._resolve=Ie,this._reject=Re})),this._completion.then((()=>{this.active=!1,this.on.complete.fire()}),(Ie=>{var Re=this.active;return this.active=!1,this.on.error.fire(Ie),this.parent?this.parent._reject(Ie):Re&&this.idbtrans&&this.idbtrans.abort(),Yn(Ie)}))}))})(this),this.Version=(function(h){return Od(R_.prototype,(function(X){this.db=h,this._cfg={version:X,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}}))})(this),this.WhereClause=(function(h){return Od(fy.prototype,(function(X,ae,Q){this.db=h,this._ctx={table:X,index:ae===":id"?null:ae,or:Q};const Y=h._deps.indexedDB;if(!Y)throw new er.MissingAPI;this._cmp=this._ascending=Y.cmp.bind(Y),this._descending=(Z,Ie)=>Y.cmp(Ie,Z),this._max=(Z,Ie)=>Y.cmp(Z,Ie)>0?Z:Ie,this._min=(Z,Ie)=>Y.cmp(Z,Ie)<0?Z:Ie,this._IDBKeyRange=h._deps.IDBKeyRange}))})(this),this.on("versionchange",(h=>{h.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()})),this.on("blocked",(h=>{!h.newVersion||h.newVersion<h.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${h.oldVersion/10}`)})),this._maxKey=rp(b.IDBKeyRange),this._createTransaction=(h,X,ae,Q)=>new this.Transaction(h,X,ae,this._options.chromeTransactionDurability,Q),this._fireOnBlocked=h=>{this.on("blocked").fire(h),Kd.filter((X=>X.name===this.name&&X!==this&&!X._state.vcFired)).map((X=>X.on("versionchange").fire(h)))},this.use(N_),this.use(j_),this.use($_),this.use(V_),this.vip=Object.create(this,{_vip:{value:!0}}),D.forEach((h=>h(this)))}version(y){if(isNaN(y)||y<.1)throw new er.Type("Given version is not a positive number");if(y=Math.round(10*y)/10,this.idbdb||this._state.isBeingOpened)throw new er.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,y);const b=this._versions;var C=b.filter((D=>D._cfg.version===y))[0];return C||(C=new this.Version(y),b.push(C),b.sort(D_),C.stores({}),this._state.autoSchema=!1,C)}_whenReady(y){return this.idbdb&&(this._state.openComplete||qt.letThrough||this._vip)?y():new Et(((b,C)=>{if(this._state.openComplete)return C(new er.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void C(new er.DatabaseClosed);this.open().catch(en)}this._state.dbReadyPromise.then(b,C)})).then(y)}use({stack:y,create:b,level:C,name:D}){D&&this.unuse({stack:y,name:D});const F=this._middlewares[y]||(this._middlewares[y]=[]);return F.push({stack:y,create:b,level:C??10,name:D}),F.sort(((T,h)=>T.level-h.level)),this}unuse({stack:y,name:b,create:C}){return y&&this._middlewares[y]&&(this._middlewares[y]=this._middlewares[y].filter((D=>C?D.create!==C:!!b&&D.name!==b))),this}open(){return F_(this)}_close(){const y=this._state,b=Kd.indexOf(this);if(b>=0&&Kd.splice(b,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}y.dbReadyPromise=new Et((C=>{y.dbReadyResolve=C})),y.openCanceller=new Et(((C,D)=>{y.cancelOpen=D}))}close(){this._close();const y=this._state;this._options.autoOpen=!1,y.dbOpenError=new er.DatabaseClosed,y.isBeingOpened&&y.cancelOpen(y.dbOpenError)}delete(){const y=arguments.length>0,b=this._state;return new Et(((C,D)=>{const F=()=>{this.close();var T=this._deps.indexedDB.deleteDatabase(this.name);T.onsuccess=fn((()=>{(function({indexedDB:h,IDBKeyRange:X},ae){!Wm(h)&&ae!==If&&Km(h,X).delete(ae).catch(en)})(this._deps,this.name),C()})),T.onerror=Qo(D),T.onblocked=this._fireOnBlocked};if(y)throw new er.InvalidArgument("Arguments not allowed in db.delete()");b.isBeingOpened?b.dbReadyPromise.then(F):F()}))}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){const y=this._state.dbOpenError;return y&&y.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return Vn(this._allTables).map((y=>this._allTables[y]))}transaction(){const y=O_.apply(this,arguments);return this._transaction.apply(this,y)}_transaction(y,b,C){let D=qt.trans;D&&D.db===this&&y.indexOf("!")===-1||(D=null);const F=y.indexOf("?")!==-1;let T,h;y=y.replace("!","").replace("?","");try{if(h=b.map((ae=>{var Q=ae instanceof this.Table?ae.name:ae;if(typeof Q!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return Q})),y=="r"||y===nm)T=nm;else{if(y!="rw"&&y!=im)throw new er.InvalidArgument("Invalid transaction mode: "+y);T=im}if(D){if(D.mode===nm&&T===im){if(!F)throw new er.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");D=null}D&&h.forEach((ae=>{if(D&&D.storeNames.indexOf(ae)===-1){if(!F)throw new er.SubTransaction("Table "+ae+" not included in parent transaction.");D=null}})),F&&D&&!D.active&&(D=null)}}catch(ae){return D?D._promise(null,((Q,Y)=>{Y(ae)})):Yn(ae)}const X=_y.bind(null,this,T,h,D,C);return D?D._promise(T,X,"lock"):qt.trans?Yh(qt.transless,(()=>this._whenReady(X))):this._whenReady(X)}table(y){if(!pa(this._allTables,y))throw new er.InvalidTable(`Table ${y} does not exist`);return this._allTables[y]}}const q_=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable";class Z_{constructor(y){this._subscribe=y}subscribe(y,b,C){return this._subscribe(y&&typeof y!="function"?y:{next:y,error:b,complete:C})}[q_](){return this}}function xy(_,y){return Vn(y).forEach((b=>{kf(_[b]||(_[b]=new Fl),y[b])})),_}function G_(_){let y,b=!1;const C=new Z_((D=>{const F=Vm(_);let T=!1,h={},X={};const ae={get closed(){return T},unsubscribe:()=>{T=!0,Au.storagemutated.unsubscribe(Ie)}};D.start&&D.start(ae);let Q=!1,Y=!1;function Z(){return Vn(X).some((Pe=>h[Pe]&&U_(h[Pe],X[Pe])))}const Ie=Pe=>{xy(h,Pe),Z()&&Re()},Re=()=>{if(Q||T)return;h={};const Pe={},Le=(function(De){F&&Xh();const ze=()=>Cu(_,{subscr:De,trans:null}),$e=qt.trans?Yh(qt.transless,ze):ze();return F&&$e.then(Ul,Ul),$e})(Pe);Y||(Au(tp,Ie),Y=!0),Q=!0,Promise.resolve(Le).then((De=>{b=!0,y=De,Q=!1,T||(Z()?Re():(h={},X=Pe,D.next&&D.next(De)))}),(De=>{Q=!1,b=!1,D.error&&D.error(De),ae.unsubscribe()}))};return Re(),ae}));return C.hasValue=()=>b,C.getValue=()=>y,C}let Rm;try{Rm={indexedDB:hn.indexedDB||hn.mozIndexedDB||hn.webkitIndexedDB||hn.msIndexedDB,IDBKeyRange:hn.IDBKeyRange||hn.webkitIDBKeyRange}}catch{Rm={indexedDB:null,IDBKeyRange:null}}const Bc=jc;function mf(_){let y=Nl;try{Nl=!0,Au.storagemutated.fire(_)}finally{Nl=y}}Wh(Bc,{...uf,delete:_=>new Bc(_,{addons:[]}).delete(),exists:_=>new Bc(_,{addons:[]}).open().then((y=>(y.close(),!0))).catch("NoSuchDatabaseError",(()=>!1)),getDatabaseNames(_){try{return(function({indexedDB:y,IDBKeyRange:b}){return Wm(y)?Promise.resolve(y.databases()).then((C=>C.map((D=>D.name)).filter((D=>D!==If)))):Km(y,b).toCollection().primaryKeys()})(Bc.dependencies).then(_)}catch{return Yn(new er.MissingAPI)}},defineClass:()=>function(_){xs(this,_)},ignoreTransaction:_=>qt.trans?Yh(qt.transless,_):_(),vip:zm,async:function(_){return function(){try{var y=Dm(_.apply(this,arguments));return y&&typeof y.then=="function"?y:Et.resolve(y)}catch(b){return Yn(b)}}},spawn:function(_,y,b){try{var C=Dm(_.apply(b,y||[]));return C&&typeof C.then=="function"?C:Et.resolve(C)}catch(D){return Yn(D)}},currentTransaction:{get:()=>qt.trans||null},waitFor:function(_,y){const b=Et.resolve(typeof _=="function"?Bc.ignoreTransaction(_):_).timeout(y||6e4);return qt.trans?qt.trans.waitFor(b):b},Promise:Et,debug:{get:()=>el,set:_=>{Yg(_,_==="dexie"?()=>!0:hy)}},derive:Gh,extend:xs,props:Wh,override:Zg,Events:Wd,on:Au,liveQuery:G_,extendObservabilitySet:xy,getByKeyPath:Vl,setByKeyPath:uo,delByKeyPath:function(_,y){typeof y=="string"?uo(_,y,void 0):"length"in y&&[].map.call(y,(function(b){uo(_,b,void 0)}))},shallowClone:Kg,deepClone:ip,getObjectDiff:Xm,cmp:vs,asap:Gg,minKey:km,addons:[],connections:Kd,errnames:$m,dependencies:Rm,semVer:Ig,version:Ig.split(".").map((_=>parseInt(_))).reduce(((_,y,b)=>_+y/Math.pow(10,2*b)))}),Bc.maxKey=rp(Bc.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Au(tp,(_=>{if(!Nl){let y;Tf?(y=document.createEvent("CustomEvent"),y.initCustomEvent(Pu,!0,!0,_)):y=new CustomEvent(Pu,{detail:_}),Nl=!0,dispatchEvent(y),Nl=!1}})),addEventListener(Pu,(({detail:_})=>{Nl||mf(_)})));let Nl=!1;if(typeof BroadcastChannel<"u"){const _=new BroadcastChannel(Pu);typeof _.unref=="function"&&_.unref(),Au(tp,(y=>{Nl||_.postMessage(y)})),_.onmessage=y=>{y.data&&mf(y.data)}}else if(typeof self<"u"&&typeof navigator<"u"){Au(tp,(y=>{try{Nl||(typeof localStorage<"u"&&localStorage.setItem(Pu,JSON.stringify({trig:Math.random(),changedParts:y})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach((b=>b.postMessage({type:Pu,changedParts:y}))))}catch{}})),typeof addEventListener<"u"&&addEventListener("storage",(y=>{if(y.key===Pu){const b=JSON.parse(y.newValue);b&&mf(b.changedParts)}}));const _=self.document&&navigator.serviceWorker;_&&_.addEventListener("message",(function({data:y}){y&&y.type===Pu&&mf(y.changedParts)}))}Et.rejectionMapper=function(_,y){if(!_||_ instanceof Hh||_ instanceof TypeError||_ instanceof SyntaxError||!_.name||!bg[_.name])return _;var b=new bg[_.name](y||_.message,_);return"stack"in _&&jl(b,"stack",{get:function(){return this.inner.stack}}),b},Yg(el,hy);class H_ extends jc{constructor(){super("boater_map_db");Jo(this,"meta");Jo(this,"restriction_areas");Jo(this,"traffic_signs");this.version(1).stores({meta:"key",restriction_areas:"id, bbox",traffic_signs:"id, vlmtyyppi"})}}const Ns=new H_,wy=async _=>{const y=await Ns.meta.get(_);return y==null?void 0:y.value},by=async(_,y)=>{await Ns.meta.put({key:_,value:y})},Lg=async _=>await wy(`${_}_lastUpdated`),Rg=async(_,y)=>{await by(`${_}_lastUpdated`,y)},K_="/finland-boater-map/data/rajoitusalue_a.gpkg",W_="/finland-boater-map/data/vesiliikennemerkit.gpkg";class Bg{constructor(y){Jo(this,"worker",null);Jo(this,"onStatusChange");this.onStatusChange=y}updateStatus(y){this.onStatusChange({isUpdating:!1,progress:0,message:"",...y})}async updateData(){this.updateStatus({isUpdating:!0,progress:0,message:"Aloitetaan pivitys..."});try{this.updateStatus({progress:10,message:"Ladataan rajoitusalueet..."});const y=this.fetchFile(K_,"rajoitus");this.updateStatus({progress:30,message:"Ladataan liikennemerkit..."});const b=this.fetchFile(W_,"vesiliikenne"),[C,D]=await Promise.all([y,b]);if(console.log("Fetched buffers:",{rajoitus:C==null?void 0:C.byteLength,vesiliikenne:D==null?void 0:D.byteLength}),!C||!D){this.updateStatus({isUpdating:!1,progress:100,message:"Data jo ajan tasalla!"}),setTimeout(()=>{this.updateStatus({progress:0,message:""})},3e3);return}this.updateStatus({progress:50,message:"Ksitelln rajoitusalueet..."}),console.log("Parsing restriction areas...");const F=await this.parseInWorker(C,"rajoitus");console.log("Parsed restriction areas:",F.length),this.updateStatus({progress:70,message:"Ksitelln liikennemerkit..."});const T=await this.parseInWorker(D,"vesiliikenne");console.log("Parsed traffic signs:",T.length),this.updateStatus({progress:85,message:"Tallennetaan tietokantaan..."}),await this.storeData(F,T),console.log("Data stored successfully");const h=new Date().toISOString();await Rg("rajoitus",h),await Rg("vesiliikenne",h),this.updateStatus({isUpdating:!1,progress:100,message:"Pivitys valmis!"}),setTimeout(()=>{this.updateStatus({progress:0,message:""})},3e3)}catch(y){console.error("Update failed:",y),this.updateStatus({isUpdating:!1,progress:0,message:"",error:y instanceof Error?y.message:"Pivitys eponnistui"})}}async fetchFile(y,b){const C=await wy(`${b}_etag`),D={};C&&(D["If-None-Match"]=C);const F=await fetch(y,{headers:D});if(F.status===304)return console.log("Data not modified, using cached version"),null;if(!F.ok)throw new Error(`HTTP error! status: ${F.status}`);const T=F.headers.get("ETag");return T&&await by(`${b}_etag`,T),await F.arrayBuffer()}async parseInWorker(y,b){return new Promise((C,D)=>{this.worker||(this.worker=new Worker(new URL("/finland-boater-map/assets/gpkgParser.worker-C_W_u9UO.js",import.meta.url),{type:"module"}));const F=T=>{var h,X;T.data.type==="result"?((h=this.worker)==null||h.removeEventListener("message",F),C(T.data.data)):T.data.type==="error"&&((X=this.worker)==null||X.removeEventListener("message",F),D(new Error(T.data.error)))};this.worker.addEventListener("message",F),this.worker.postMessage({type:"parse",dataType:b,arrayBuffer:y})})}async storeData(y,b){await Ns.transaction("rw",[Ns.restriction_areas,Ns.traffic_signs],async()=>{await Ns.restriction_areas.clear(),await Ns.traffic_signs.clear(),await Ns.restriction_areas.bulkAdd(y),await Ns.traffic_signs.bulkAdd(b)})}cleanup(){this.worker&&(this.worker.terminate(),this.worker=null)}}function X_(_,y,b,C,D){Sy(_,y,b||0,C||_.length-1,D||Y_)}function Sy(_,y,b,C,D){for(;C>b;){if(C-b>600){var F=C-b+1,T=y-b+1,h=Math.log(F),X=.5*Math.exp(2*h/3),ae=.5*Math.sqrt(h*X*(F-X)/F)*(T-F/2<0?-1:1),Q=Math.max(b,Math.floor(y-T*X/F+ae)),Y=Math.min(C,Math.floor(y+(F-T)*X/F+ae));Sy(_,y,Q,Y,D)}var Z=_[y],Ie=b,Re=C;for(Nd(_,b,y),D(_[C],Z)>0&&Nd(_,b,C);Ie<Re;){for(Nd(_,Ie,Re),Ie++,Re--;D(_[Ie],Z)<0;)Ie++;for(;D(_[Re],Z)>0;)Re--}D(_[b],Z)===0?Nd(_,b,Re):(Re++,Nd(_,Re,C)),Re<=y&&(b=Re+1),y<=Re&&(C=Re-1)}}function Nd(_,y,b){var C=_[y];_[y]=_[b],_[b]=C}function Y_(_,y){return _<y?-1:_>y?1:0}class Fg{constructor(y=9){this._maxEntries=Math.max(4,y),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(y){let b=this.data;const C=[];if(!of(y,b))return C;const D=this.toBBox,F=[];for(;b;){for(let T=0;T<b.children.length;T++){const h=b.children[T],X=b.leaf?D(h):h;of(y,X)&&(b.leaf?C.push(h):cm(y,X)?this._all(h,C):F.push(h))}b=F.pop()}return C}collides(y){let b=this.data;if(!of(y,b))return!1;const C=[];for(;b;){for(let D=0;D<b.children.length;D++){const F=b.children[D],T=b.leaf?this.toBBox(F):F;if(of(y,T)){if(b.leaf||cm(y,T))return!0;C.push(F)}}b=C.pop()}return!1}load(y){if(!(y&&y.length))return this;if(y.length<this._minEntries){for(let C=0;C<y.length;C++)this.insert(y[C]);return this}let b=this._build(y.slice(),0,y.length-1,0);if(!this.data.children.length)this.data=b;else if(this.data.height===b.height)this._splitRoot(this.data,b);else{if(this.data.height<b.height){const C=this.data;this.data=b,b=C}this._insert(b,this.data.height-b.height-1,!0)}return this}insert(y){return y&&this._insert(y,this.data.height-1),this}clear(){return this.data=Zh([]),this}remove(y,b){if(!y)return this;let C=this.data;const D=this.toBBox(y),F=[],T=[];let h,X,ae;for(;C||F.length;){if(C||(C=F.pop(),X=F[F.length-1],h=T.pop(),ae=!0),C.leaf){const Q=J_(y,C.children,b);if(Q!==-1)return C.children.splice(Q,1),F.push(C),this._condense(F),this}!ae&&!C.leaf&&cm(C,D)?(F.push(C),T.push(h),h=0,X=C,C=C.children[0]):X?(h++,C=X.children[h],ae=!1):C=null}return this}toBBox(y){return y}compareMinX(y,b){return y.minX-b.minX}compareMinY(y,b){return y.minY-b.minY}toJSON(){return this.data}fromJSON(y){return this.data=y,this}_all(y,b){const C=[];for(;y;)y.leaf?b.push(...y.children):C.push(...y.children),y=C.pop();return b}_build(y,b,C,D){const F=C-b+1;let T=this._maxEntries,h;if(F<=T)return h=Zh(y.slice(b,C+1)),$h(h,this.toBBox),h;D||(D=Math.ceil(Math.log(F)/Math.log(T)),T=Math.ceil(F/Math.pow(T,D-1))),h=Zh([]),h.leaf=!1,h.height=D;const X=Math.ceil(F/T),ae=X*Math.ceil(Math.sqrt(T));Og(y,b,C,ae,this.compareMinX);for(let Q=b;Q<=C;Q+=ae){const Y=Math.min(Q+ae-1,C);Og(y,Q,Y,X,this.compareMinY);for(let Z=Q;Z<=Y;Z+=X){const Ie=Math.min(Z+X-1,Y);h.children.push(this._build(y,Z,Ie,D-1))}}return $h(h,this.toBBox),h}_chooseSubtree(y,b,C,D){for(;D.push(b),!(b.leaf||D.length-1===C);){let F=1/0,T=1/0,h;for(let X=0;X<b.children.length;X++){const ae=b.children[X],Q=um(ae),Y=tv(y,ae)-Q;Y<T?(T=Y,F=Q<F?Q:F,h=ae):Y===T&&Q<F&&(F=Q,h=ae)}b=h||b.children[0]}return b}_insert(y,b,C){const D=C?y:this.toBBox(y),F=[],T=this._chooseSubtree(D,this.data,b,F);for(T.children.push(y),Zd(T,D);b>=0&&F[b].children.length>this._maxEntries;)this._split(F,b),b--;this._adjustParentBBoxes(D,F,b)}_split(y,b){const C=y[b],D=C.children.length,F=this._minEntries;this._chooseSplitAxis(C,F,D);const T=this._chooseSplitIndex(C,F,D),h=Zh(C.children.splice(T,C.children.length-T));h.height=C.height,h.leaf=C.leaf,$h(C,this.toBBox),$h(h,this.toBBox),b?y[b-1].children.push(h):this._splitRoot(C,h)}_splitRoot(y,b){this.data=Zh([y,b]),this.data.height=y.height+1,this.data.leaf=!1,$h(this.data,this.toBBox)}_chooseSplitIndex(y,b,C){let D,F=1/0,T=1/0;for(let h=b;h<=C-b;h++){const X=qd(y,0,h,this.toBBox),ae=qd(y,h,C,this.toBBox),Q=rv(X,ae),Y=um(X)+um(ae);Q<F?(F=Q,D=h,T=Y<T?Y:T):Q===F&&Y<T&&(T=Y,D=h)}return D||C-b}_chooseSplitAxis(y,b,C){const D=y.leaf?this.compareMinX:Q_,F=y.leaf?this.compareMinY:ev,T=this._allDistMargin(y,b,C,D),h=this._allDistMargin(y,b,C,F);T<h&&y.children.sort(D)}_allDistMargin(y,b,C,D){y.children.sort(D);const F=this.toBBox,T=qd(y,0,b,F),h=qd(y,C-b,C,F);let X=af(T)+af(h);for(let ae=b;ae<C-b;ae++){const Q=y.children[ae];Zd(T,y.leaf?F(Q):Q),X+=af(T)}for(let ae=C-b-1;ae>=b;ae--){const Q=y.children[ae];Zd(h,y.leaf?F(Q):Q),X+=af(h)}return X}_adjustParentBBoxes(y,b,C){for(let D=C;D>=0;D--)Zd(b[D],y)}_condense(y){for(let b=y.length-1,C;b>=0;b--)y[b].children.length===0?b>0?(C=y[b-1].children,C.splice(C.indexOf(y[b]),1)):this.clear():$h(y[b],this.toBBox)}}function J_(_,y,b){if(!b)return y.indexOf(_);for(let C=0;C<y.length;C++)if(b(_,y[C]))return C;return-1}function $h(_,y){qd(_,0,_.children.length,y,_)}function qd(_,y,b,C,D){D||(D=Zh(null)),D.minX=1/0,D.minY=1/0,D.maxX=-1/0,D.maxY=-1/0;for(let F=y;F<b;F++){const T=_.children[F];Zd(D,_.leaf?C(T):T)}return D}function Zd(_,y){return _.minX=Math.min(_.minX,y.minX),_.minY=Math.min(_.minY,y.minY),_.maxX=Math.max(_.maxX,y.maxX),_.maxY=Math.max(_.maxY,y.maxY),_}function Q_(_,y){return _.minX-y.minX}function ev(_,y){return _.minY-y.minY}function um(_){return(_.maxX-_.minX)*(_.maxY-_.minY)}function af(_){return _.maxX-_.minX+(_.maxY-_.minY)}function tv(_,y){return(Math.max(y.maxX,_.maxX)-Math.min(y.minX,_.minX))*(Math.max(y.maxY,_.maxY)-Math.min(y.minY,_.minY))}function rv(_,y){const b=Math.max(_.minX,y.minX),C=Math.max(_.minY,y.minY),D=Math.min(_.maxX,y.maxX),F=Math.min(_.maxY,y.maxY);return Math.max(0,D-b)*Math.max(0,F-C)}function cm(_,y){return _.minX<=y.minX&&_.minY<=y.minY&&y.maxX<=_.maxX&&y.maxY<=_.maxY}function of(_,y){return y.minX<=_.maxX&&y.minY<=_.maxY&&y.maxX>=_.minX&&y.maxY>=_.minY}function Zh(_){return{children:_,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Og(_,y,b,C,D){const F=[y,b];for(;F.length;){if(b=F.pop(),y=F.pop(),b-y<=C)continue;const T=y+Math.ceil((b-y)/C/2)*C;X_(_,T,y,b,D),F.push(y,T,T,b)}}class nv{constructor(){Jo(this,"areaIndex");Jo(this,"signIndex");Jo(this,"areaMap");Jo(this,"signMap");this.areaIndex=new Fg,this.signIndex=new Fg,this.areaMap=new Map,this.signMap=new Map}buildAreaIndex(y){this.areaMap.clear();const b=[];for(const C of y)this.areaMap.set(C.id,C),b.push({minX:C.bbox[0],minY:C.bbox[1],maxX:C.bbox[2],maxY:C.bbox[3],id:C.id});this.areaIndex.clear(),this.areaIndex.load(b)}buildSignIndex(y){this.signMap.clear();const b=[];for(const C of y){this.signMap.set(C.id,C);const[D,F]=C.geometry.coordinates;b.push({minX:D,minY:F,maxX:D,maxY:F,id:C.id})}this.signIndex.clear(),this.signIndex.load(b)}getCandidateAreas(y,b,C=.01){return this.areaIndex.search({minX:y-C,minY:b-C,maxX:y+C,maxY:b+C}).map(F=>this.areaMap.get(F.id)).filter(F=>F!=null)}getNearbySignsInRadius(y,b,C){const D=C/111e3,F=C/55e3;return this.signIndex.search({minX:y-F,minY:b-D,maxX:y+F,maxY:b+D}).map(h=>this.signMap.get(h.id)).filter(h=>h!=null)}getAllAreas(){return Array.from(this.areaMap.values())}getAllSigns(){return Array.from(this.signMap.values())}}const jd=new nv;var Os=63710088e-1,iv={centimeters:Os*100,centimetres:Os*100,degrees:Os/111325,feet:Os*3.28084,inches:Os*39.37,kilometers:Os/1e3,kilometres:Os/1e3,meters:Os,metres:Os,miles:Os/1609.344,millimeters:Os*1e3,millimetres:Os*1e3,nauticalmiles:Os/1852,radians:1,yards:Os*1.0936};function sv(_,y,b){b===void 0&&(b={});var C={type:"Feature"};return(b.id===0||b.id)&&(C.id=b.id),b.bbox&&(C.bbox=b.bbox),C.properties={},C.geometry=_,C}function Bm(_,y,b){if(b===void 0&&(b={}),!_)throw new Error("coordinates is required");if(!Array.isArray(_))throw new Error("coordinates must be an Array");if(_.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ng(_[0])||!Ng(_[1]))throw new Error("coordinates must contain numbers");var C={type:"Point",coordinates:_};return sv(C,y,b)}function av(_,y){y===void 0&&(y="kilometers");var b=iv[y];if(!b)throw new Error(y+" units is invalid");return _*b}function lf(_){var y=_%360;return y*Math.PI/180}function Ng(_){return!isNaN(_)&&_!==null&&!Array.isArray(_)}function Fm(_){if(!_)throw new Error("coord is required");if(!Array.isArray(_)){if(_.type==="Feature"&&_.geometry!==null&&_.geometry.type==="Point")return _.geometry.coordinates;if(_.type==="Point")return _.coordinates}if(Array.isArray(_)&&_.length>=2&&!Array.isArray(_[0])&&!Array.isArray(_[1]))return _;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function ov(_){return _.type==="Feature"?_.geometry:_}function lv(_,y,b){if(b===void 0&&(b={}),!_)throw new Error("point is required");if(!y)throw new Error("polygon is required");var C=Fm(_),D=ov(y),F=D.type,T=y.bbox,h=D.coordinates;if(T&&uv(C,T)===!1)return!1;F==="Polygon"&&(h=[h]);for(var X=!1,ae=0;ae<h.length&&!X;ae++)if(jg(C,h[ae][0],b.ignoreBoundary)){for(var Q=!1,Y=1;Y<h[ae].length&&!Q;)jg(C,h[ae][Y],!b.ignoreBoundary)&&(Q=!0),Y++;Q||(X=!0)}return X}function jg(_,y,b){var C=!1;y[0][0]===y[y.length-1][0]&&y[0][1]===y[y.length-1][1]&&(y=y.slice(0,y.length-1));for(var D=0,F=y.length-1;D<y.length;F=D++){var T=y[D][0],h=y[D][1],X=y[F][0],ae=y[F][1],Q=_[1]*(T-X)+h*(X-_[0])+ae*(_[0]-T)===0&&(T-_[0])*(X-_[0])<=0&&(h-_[1])*(ae-_[1])<=0;if(Q)return!b;var Y=h>_[1]!=ae>_[1]&&_[0]<(X-T)*(_[1]-h)/(ae-h)+T;Y&&(C=!C)}return C}function uv(_,y){return y[0]<=_[0]&&y[1]<=_[1]&&y[2]>=_[0]&&y[3]>=_[1]}function cv(_,y,b,C=new Date){const D=Bm([y.lng,y.lat]),F=lv(D,_.geometry);if(console.log(`Checking restriction ${_.id}: inside=${F}`),!F)return console.log("   Not inside polygon"),!1;if(console.log("   Inside polygon"),_.alkuPvm){const T=new Date(_.alkuPvm);if(C<T)return console.log(`   Too early (starts ${_.alkuPvm})`),!1}if(_.loppuPvm){const T=new Date(_.loppuPvm);if(C>T)return console.log(`   Expired (ended ${_.loppuPvm})`),!1}return!b.ammattiliikenne&&_.poikkeus&&_.poikkeus.toLowerCase().includes("huvi")?(console.log("   Filtered by ammattiliikenne"),!1):!b.vesiskootteri&&_.rajoitustyyppi&&_.rajoitustyyppi.toLowerCase().includes("vesiskootterilla")?(console.log("   Filtered by vesiskootteri"),!1):(console.log("   APPLICABLE!"),!0)}function hv(_,y,b){console.log(" getApplicableRestrictions called with",_.length,"candidates"),console.log("Sample candidate:",_[0]),console.log("Position:",y),console.log("Filters:",b);const C=new Date,D=[];for(const T of _)cv(T,y,b,C)&&D.push({...T});const F=D.filter(T=>T.suuruusKmh!=null);if(F.length>0){const T=F.reduce((h,X)=>X.suuruusKmh<h.suuruusKmh?X:h);T.isPrimary=!0}return D.sort((T,h)=>T.isPrimary&&!h.isPrimary?-1:!T.isPrimary&&h.isPrimary?1:T.suuruusKmh!=null&&h.suuruusKmh!=null?T.suuruusKmh-h.suuruusKmh:T.suuruusKmh!=null?-1:h.suuruusKmh!=null?1:T.rajoitustyyppi.localeCompare(h.rajoitustyyppi,"fi")),D}function Vg(_){return _.suuruusKmh!=null?`Nopeusrajoitus ${_.suuruusKmh} km/h`:_.rajoitustyyppi||"Rajoitus"}function dv(_,y,b){b===void 0&&(b={});var C=Fm(_),D=Fm(y),F=lf(D[1]-C[1]),T=lf(D[0]-C[0]),h=lf(C[1]),X=lf(D[1]),ae=Math.pow(Math.sin(F/2),2)+Math.pow(Math.sin(T/2),2)*Math.cos(h)*Math.cos(X);return av(2*Math.atan2(Math.sqrt(ae),Math.sqrt(1-ae)),b.units)}function pv(_,y,b){const C=Bm([y.lng,y.lat]),D=[];for(const F of _){if(b.selectedVlmtyyppi.size>0&&!b.selectedVlmtyyppi.has(F.vlmtyyppi))continue;const T=Bm(F.geometry.coordinates),h=dv(C,T,{units:"meters"});h<=b.nearbyRadius&&D.push({...F,distance:Math.round(h),iconUrl:fv(F.iconKey)})}return D.sort((F,T)=>F.distance-T.distance),D}function fv(_){return`/icons/${_}.png`}function Ug(_){return _.nimiFi||_.nimiSv||`Merkki ${_.vlmlajityyppi}`}function mv(_){return _<1e3?`${_} m`:`${(_/1e3).toFixed(1)} km`}function gv(_){const y=new Set;return _.forEach(b=>y.add(b.vlmtyyppi)),Array.from(y).sort((b,C)=>b-C)}var gf={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */var yv=gf.exports,$g;function _v(){return $g||($g=1,(function(_,y){(function(b,C){_.exports=C()})(yv,(function(){var b={},C={};function D(T,h,X){if(C[T]=X,T==="index"){var ae="var sharedModule = {}; ("+C.shared+")(sharedModule); ("+C.worker+")(sharedModule);",Q={};return C.shared(Q),C.index(b,Q),typeof window<"u"&&b.setWorkerUrl(window.URL.createObjectURL(new Blob([ae],{type:"text/javascript"}))),b}}D("shared",["exports"],(function(T){function h(r,t,n,o){return new(n||(n=Promise))((function(c,m){function g(P){try{S(o.next(P))}catch(z){m(z)}}function x(P){try{S(o.throw(P))}catch(z){m(z)}}function S(P){var z;P.done?c(P.value):(z=P.value,z instanceof n?z:new n((function(L){L(z)}))).then(g,x)}S((o=o.apply(r,t||[])).next())}))}function X(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}typeof SuppressedError=="function"&&SuppressedError;var ae=Q;function Q(r,t){this.x=r,this.y=t}Q.prototype={clone:function(){return new Q(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,t){return this.clone()._rotateAround(r,t)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var t=r.x-this.x,n=r.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,t){return Math.atan2(this.x*t-this.y*r,this.x*r+this.y*t)},_matMult:function(r){var t=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=t,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var t=Math.cos(r),n=Math.sin(r),o=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=o,this},_rotateAround:function(r,t){var n=Math.cos(r),o=Math.sin(r),c=t.y+o*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-o*(this.y-t.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Q.convert=function(r){return r instanceof Q?r:Array.isArray(r)?new Q(r[0],r[1]):r};var Y=X(ae),Z=Ie;function Ie(r,t,n,o){this.cx=3*r,this.bx=3*(n-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(o-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=t,this.p2x=n,this.p2y=o}Ie.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,t){if(t===void 0&&(t=1e-6),r<0)return 0;if(r>1)return 1;for(var n=r,o=0;o<8;o++){var c=this.sampleCurveX(n)-r;if(Math.abs(c)<t)return n;var m=this.sampleCurveDerivativeX(n);if(Math.abs(m)<1e-6)break;n-=c/m}var g=0,x=1;for(n=r,o=0;o<20&&(c=this.sampleCurveX(n),!(Math.abs(c-r)<t));o++)r>c?g=n:x=n,n=.5*(x-g)+g;return n},solve:function(r,t){return this.sampleCurveY(this.solveCurveX(r,t))}};var Re=X(Z);let Pe,Le;function De(){return Pe==null&&(Pe=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Pe}function ze(){if(Le==null&&(Le=!1,De())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let o=0;o<25;o++){const c=4*o;t.fillStyle=`rgb(${c},${c+1},${c+2})`,t.fillRect(o%5,Math.floor(o/5),1,1)}const n=t.getImageData(0,0,5,5).data;for(let o=0;o<100;o++)if(o%4!=3&&n[o]!==o){Le=!0;break}}}return Le||!1}function $e(r,t,n,o){const c=new Re(r,t,n,o);return m=>c.solve(m)}const et=$e(.25,.1,.25,1);function Je(r,t,n){return Math.min(n,Math.max(t,r))}function He(r,t,n){const o=n-t,c=((r-t)%o+o)%o+t;return c===t?n:c}function je(r,...t){for(const n of t)for(const o in n)r[o]=n[o];return r}let ut=1;function Ve(r,t,n){const o={};for(const c in r)o[c]=t.call(this,r[c],c,r);return o}function tr(r,t,n){const o={};for(const c in r)t.call(this,r[c],c,r)&&(o[c]=r[c]);return o}function vt(r){return Array.isArray(r)?r.map(vt):typeof r=="object"&&r?Ve(r,vt):r}const ar={};function Rt(r){ar[r]||(typeof console<"u"&&console.warn(r),ar[r]=!0)}function Bt(r,t,n){return(n.y-r.y)*(t.x-r.x)>(t.y-r.y)*(n.x-r.x)}function $r(r){return typeof WorkerGlobalScope<"u"&&r!==void 0&&r instanceof WorkerGlobalScope}let Or=null;function Ht(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}const lt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Pt(r,t,n,o,c){return h(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const m=new VideoFrame(r,{timestamp:0});try{const g=m==null?void 0:m.format;if(!g||!g.startsWith("BGR")&&!g.startsWith("RGB"))throw new Error(`Unrecognized format ${g}`);const x=g.startsWith("BGR"),S=new Uint8ClampedArray(o*c*4);if(yield m.copyTo(S,(function(P,z,L,O,V){const q=4*Math.max(-z,0),K=(Math.max(0,L)-L)*O*4+q,ne=4*O,le=Math.max(0,z),we=Math.max(0,L);return{rect:{x:le,y:we,width:Math.min(P.width,z+O)-le,height:Math.min(P.height,L+V)-we},layout:[{offset:K,stride:ne}]}})(r,t,n,o,c)),x)for(let P=0;P<S.length;P+=4){const z=S[P];S[P]=S[P+2],S[P+2]=z}return S}finally{m.close()}}))}let ft,xe;const Ne="AbortError";function Xt(){return new Error(Ne)}const Yt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function ir(r){return Yt.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))]}const hr="global-dispatcher";class cr extends Error{constructor(t,n,o,c){super(`AJAXError: ${n} (${t}): ${o}`),this.status=t,this.statusText=n,this.url=o,this.body=c}}const lr=()=>$r(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Ir=function(r,t){if(/:\/\//.test(r.url)&&!/^https?:|^file:/.test(r.url)){const o=ir(r.url);if(o)return o(r,t);if($r(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,targetMapId:hr},t)}if(!(/^file:/.test(n=r.url)||/^file:/.test(lr())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(o,c){return h(this,void 0,void 0,(function*(){const m=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:lr(),signal:c.signal});o.type!=="json"||m.headers.has("Accept")||m.headers.set("Accept","application/json");const g=yield fetch(m);if(!g.ok){const P=yield g.blob();throw new cr(g.status,g.statusText,o.url,P)}let x;x=o.type==="arrayBuffer"||o.type==="image"?g.arrayBuffer():o.type==="json"?g.json():g.text();const S=yield x;if(c.signal.aborted)throw Xt();return{data:S,cacheControl:g.headers.get("Cache-Control"),expires:g.headers.get("Expires")}}))})(r,t);if($r(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,mustQueue:!0,targetMapId:hr},t)}var n;return(function(o,c){return new Promise(((m,g)=>{var x;const S=new XMLHttpRequest;S.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(S.responseType="arraybuffer");for(const P in o.headers)S.setRequestHeader(P,o.headers[P]);o.type==="json"&&(S.responseType="text",!((x=o.headers)===null||x===void 0)&&x.Accept||S.setRequestHeader("Accept","application/json")),S.withCredentials=o.credentials==="include",S.onerror=()=>{g(new Error(S.statusText))},S.onload=()=>{if(!c.signal.aborted)if((S.status>=200&&S.status<300||S.status===0)&&S.response!==null){let P=S.response;if(o.type==="json")try{P=JSON.parse(S.response)}catch(z){return void g(z)}m({data:P,cacheControl:S.getResponseHeader("Cache-Control"),expires:S.getResponseHeader("Expires")})}else{const P=new Blob([S.response],{type:S.getResponseHeader("Content-Type")});g(new cr(S.status,S.statusText,o.url,P))}},c.signal.addEventListener("abort",(()=>{S.abort(),g(Xt())})),S.send(o.body)}))})(r,t)};function mn(r){if(!r||r.indexOf("://")<=0||r.indexOf("data:image/")===0||r.indexOf("blob:")===0)return!0;const t=new URL(r),n=window.location;return t.protocol===n.protocol&&t.host===n.host}function fa(r,t,n){n[r]&&n[r].indexOf(t)!==-1||(n[r]=n[r]||[],n[r].push(t))}function ws(r,t,n){if(n&&n[r]){const o=n[r].indexOf(t);o!==-1&&n[r].splice(o,1)}}class Yi{constructor(t,n={}){je(this,n),this.type=t}}class bs extends Yi{constructor(t,n={}){super("error",je({error:t},n))}}class Ba{on(t,n){return this._listeners=this._listeners||{},fa(t,n,this._listeners),this}off(t,n){return ws(t,n,this._listeners),ws(t,n,this._oneTimeListeners),this}once(t,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},fa(t,n,this._oneTimeListeners),this):new Promise((o=>this.once(t,o)))}fire(t,n){typeof t=="string"&&(t=new Yi(t,n||{}));const o=t.type;if(this.listens(o)){t.target=this;const c=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const x of c)x.call(this,t);const m=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const x of m)ws(o,x,this._oneTimeListeners),x.call(this,t);const g=this._eventedParent;g&&(je(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(t))}else t instanceof bs&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,n){return this._eventedParent=t,this._eventedParentData=n,this}}var Ee={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const js=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function co(r,t){const n={};for(const o in r)o!=="ref"&&(n[o]=r[o]);return js.forEach((o=>{o in t&&(n[o]=t[o])})),n}function fr(r,t){if(Array.isArray(r)){if(!Array.isArray(t)||r.length!==t.length)return!1;for(let n=0;n<r.length;n++)if(!fr(r[n],t[n]))return!1;return!0}if(typeof r=="object"&&r!==null&&t!==null){if(typeof t!="object"||Object.keys(r).length!==Object.keys(t).length)return!1;for(const n in r)if(!fr(r[n],t[n]))return!1;return!0}return r===t}function Dr(r,t){r.push(t)}function Ss(r,t,n){Dr(n,{command:"addSource",args:[r,t[r]]})}function ks(r,t,n){Dr(t,{command:"removeSource",args:[r]}),n[r]=!0}function Ts(r,t,n,o){ks(r,n,o),Ss(r,t,n)}function Fa(r,t,n){let o;for(o in r[n])if(Object.prototype.hasOwnProperty.call(r[n],o)&&o!=="data"&&!fr(r[n][o],t[n][o]))return!1;for(o in t[n])if(Object.prototype.hasOwnProperty.call(t[n],o)&&o!=="data"&&!fr(r[n][o],t[n][o]))return!1;return!0}function mi(r,t,n,o,c,m){r=r||{},t=t||{};for(const g in r)Object.prototype.hasOwnProperty.call(r,g)&&(fr(r[g],t[g])||n.push({command:m,args:[o,g,t[g],c]}));for(const g in t)Object.prototype.hasOwnProperty.call(t,g)&&!Object.prototype.hasOwnProperty.call(r,g)&&(fr(r[g],t[g])||n.push({command:m,args:[o,g,t[g],c]}))}function ho(r){return r.id}function Oa(r,t){return r[t.id]=t,r}class Ke{constructor(t,n,o,c){this.message=(t?`${t}: `:"")+o,c&&(this.identifier=c),n!=null&&n.__line__&&(this.line=n.__line__)}}function Ji(r,...t){for(const n of t)for(const o in n)r[o]=n[o];return r}class gn extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}class Jn{constructor(t,n=[]){this.parent=t,this.bindings={};for(const[o,c]of n)this.bindings[o]=c}concat(t){return new Jn(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const ma={kind:"null"},rt={kind:"number"},Jt={kind:"string"},Ft={kind:"boolean"},Ln={kind:"color"},gi={kind:"object"},Vt={kind:"value"},Ai={kind:"collator"},Qi={kind:"formatted"},yi={kind:"padding"},Un={kind:"resolvedImage"},ie={kind:"variableAnchorOffsetCollection"};function j(r,t){return{kind:"array",itemType:r,N:t}}function N(r){if(r.kind==="array"){const t=N(r.itemType);return typeof r.N=="number"?`array<${t}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${t}>`}return r.kind}const H=[ma,rt,Jt,Ft,Ln,Qi,gi,j(Vt),yi,Un,ie];function te(r,t){if(t.kind==="error")return null;if(r.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!te(r.itemType,t.itemType))&&(typeof r.N!="number"||r.N===t.N))return null}else{if(r.kind===t.kind)return null;if(r.kind==="value"){for(const n of H)if(!te(n,t))return null}}return`Expected ${N(r)} but found ${N(t)} instead.`}function he(r,t){return t.some((n=>n.kind===r.kind))}function me(r,t){return t.some((n=>n==="null"?r===null:n==="array"?Array.isArray(r):n==="object"?r&&!Array.isArray(r)&&typeof r=="object":n===typeof r))}function ve(r,t){return r.kind==="array"&&t.kind==="array"?r.itemType.kind===t.itemType.kind&&typeof r.N=="number":r.kind===t.kind}const ue=.96422,Me=.82521,Oe=4/29,ke=6/29,Ye=3*ke*ke,wt=ke*ke*ke,Ct=Math.PI/180,mr=180/Math.PI;function Zt(r){return(r%=360)<0&&(r+=360),r}function gr([r,t,n,o]){let c,m;const g=sn((.2225045*(r=Wt(r))+.7168786*(t=Wt(t))+.0606169*(n=Wt(n)))/1);r===t&&t===n?c=m=g:(c=sn((.4360747*r+.3850649*t+.1430804*n)/ue),m=sn((.0139322*r+.0971045*t+.7141733*n)/Me));const x=116*g-16;return[x<0?0:x,500*(c-g),200*(g-m),o]}function Wt(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function sn(r){return r>wt?Math.pow(r,1/3):r/Ye+Oe}function Gr([r,t,n,o]){let c=(r+16)/116,m=isNaN(t)?c:c+t/500,g=isNaN(n)?c:c-n/200;return c=1*br(c),m=ue*br(m),g=Me*br(g),[rr(3.1338561*m-1.6168667*c-.4906146*g),rr(-.9787684*m+1.9161415*c+.033454*g),rr(.0719453*m-.2289914*c+1.4052427*g),o]}function rr(r){return(r=r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055)<0?0:r>1?1:r}function br(r){return r>ke?r*r*r:Ye*(r-Oe)}function Nr(r){return parseInt(r.padEnd(2,r),16)/255}function yn(r,t){return Sn(t?r/100:r,0,1)}function Sn(r,t,n){return Math.min(Math.max(t,r),n)}function $n(r){return!r.some(Number.isNaN)}const po={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Ut{constructor(t,n,o,c=1,m=!0){this.r=t,this.g=n,this.b=o,this.a=c,m||(this.r*=c,this.g*=c,this.b*=c,c||this.overwriteGetter("rgb",[t,n,o,c]))}static parse(t){if(t instanceof Ut)return t;if(typeof t!="string")return;const n=(function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const c=po[o];if(c){const[g,x,S]=c;return[g/255,x/255,S/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const g=o.length<6?1:2;let x=1;return[Nr(o.slice(x,x+=g)),Nr(o.slice(x,x+=g)),Nr(o.slice(x,x+=g)),Nr(o.slice(x,x+g)||"ff")]}if(o.startsWith("rgb")){const g=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[x,S,P,z,L,O,V,q,K,ne,le,we]=g,de=[z||" ",V||" ",ne].join("");if(de==="  "||de==="  /"||de===",,"||de===",,,"){const _e=[P,O,K].join(""),Ae=_e==="%%%"?100:_e===""?255:0;if(Ae){const Ue=[Sn(+S/Ae,0,1),Sn(+L/Ae,0,1),Sn(+q/Ae,0,1),le?yn(+le,we):1];if($n(Ue))return Ue}}return}}const m=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(m){const[g,x,S,P,z,L,O,V,q]=m,K=[S||" ",z||" ",O].join("");if(K==="  "||K==="  /"||K===",,"||K===",,,"){const ne=[+x,Sn(+P,0,100),Sn(+L,0,100),V?yn(+V,q):1];if($n(ne))return(function([le,we,de,_e]){function Ae(Ue){const pt=(Ue+le/30)%12,Lt=we*Math.min(de,1-de);return de-Lt*Math.max(-1,Math.min(pt-3,9-pt,1))}return le=Zt(le),we/=100,de/=100,[Ae(0),Ae(8),Ae(4),_e]})(ne)}}})(t);return n?new Ut(...n,!1):void 0}get rgb(){const{r:t,g:n,b:o,a:c}=this,m=c||1/0;return this.overwriteGetter("rgb",[t/m,n/m,o/m,c])}get hcl(){return this.overwriteGetter("hcl",(function(t){const[n,o,c,m]=gr(t),g=Math.sqrt(o*o+c*c);return[Math.round(1e4*g)?Zt(Math.atan2(c,o)*mr):NaN,g,n,m]})(this.rgb))}get lab(){return this.overwriteGetter("lab",gr(this.rgb))}overwriteGetter(t,n){return Object.defineProperty(this,t,{value:n}),n}toString(){const[t,n,o,c]=this.rgb;return`rgba(${[t,n,o].map((m=>Math.round(255*m))).join(",")},${c})`}}Ut.black=new Ut(0,0,0,1),Ut.white=new Ut(1,1,1,1),Ut.transparent=new Ut(0,0,0,0),Ut.red=new Ut(1,0,0,1);class zu{constructor(t,n,o){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class tl{constructor(t,n,o,c,m){this.text=t,this.image=n,this.scale=o,this.fontStack=c,this.textColor=m}}class Qn{constructor(t){this.sections=t}static fromString(t){return new Qn([new tl(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((t=>t.text.length!==0||t.image&&t.image.name.length!==0))}static factory(t){return t instanceof Qn?t:Qn.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map((t=>t.text)).join("")}}class Rn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Rn)return t;if(typeof t=="number")return new Rn([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const n of t)if(typeof n!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new Rn(t)}}toString(){return JSON.stringify(this.values)}}const Jh=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class _i{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof _i)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let n=0;n<t.length;n+=2){const o=t[n],c=t[n+1];if(typeof o!="string"||!Jh.has(o)||!Array.isArray(c)||c.length!==2||typeof c[0]!="number"||typeof c[1]!="number")return}return new _i(t)}}toString(){return JSON.stringify(this.values)}}class Bn{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Bn({name:t,available:!1}):null}}function qn(r,t,n,o){return typeof r=="number"&&r>=0&&r<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof n=="number"&&n>=0&&n<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[r,t,n,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[r,t,n,o]:[r,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Na(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof Ut||r instanceof zu||r instanceof Qn||r instanceof Rn||r instanceof _i||r instanceof Bn)return!0;if(Array.isArray(r)){for(const t of r)if(!Na(t))return!1;return!0}if(typeof r=="object"){for(const t in r)if(!Na(r[t]))return!1;return!0}return!1}function Er(r){if(r===null)return ma;if(typeof r=="string")return Jt;if(typeof r=="boolean")return Ft;if(typeof r=="number")return rt;if(r instanceof Ut)return Ln;if(r instanceof zu)return Ai;if(r instanceof Qn)return Qi;if(r instanceof Rn)return yi;if(r instanceof _i)return ie;if(r instanceof Bn)return Un;if(Array.isArray(r)){const t=r.length;let n;for(const o of r){const c=Er(o);if(n){if(n===c)continue;n=Vt;break}n=c}return j(n||Vt,t)}return gi}function rl(r){const t=typeof r;return r===null?"":t==="string"||t==="number"||t==="boolean"?String(r):r instanceof Ut||r instanceof Qn||r instanceof Rn||r instanceof _i||r instanceof Bn?r.toString():JSON.stringify(r)}class es{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(t.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Na(t[1]))return n.error("invalid value");const o=t[1];let c=Er(o);const m=n.expectedType;return c.kind!=="array"||c.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(c=m),new es(c,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class an{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const ja={string:Jt,number:rt,boolean:Ft,object:gi};class ei{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let o,c=1;const m=t[0];if(m==="array"){let x,S;if(t.length>2){const P=t[1];if(typeof P!="string"||!(P in ja)||P==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);x=ja[P],c++}else x=Vt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);S=t[2],c++}o=j(x,S)}else{if(!ja[m])throw new Error(`Types doesn't contain name = ${m}`);o=ja[m]}const g=[];for(;c<t.length;c++){const x=n.parse(t[c],c,Vt);if(!x)return null;g.push(x)}return new ei(o,g)}evaluate(t){for(let n=0;n<this.args.length;n++){const o=this.args[n].evaluate(t);if(!te(this.type,Er(o)))return o;if(n===this.args.length-1)throw new an(`Expected value to be of type ${N(this.type)}, but found ${N(Er(o))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const Va={"to-boolean":Ft,"to-color":Ln,"to-number":rt,"to-string":Jt};class ti{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const o=t[0];if(!Va[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&t.length!==2)return n.error("Expected one argument.");const c=Va[o],m=[];for(let g=1;g<t.length;g++){const x=n.parse(t[g],g,Vt);if(!x)return null;m.push(x)}return new ti(c,m)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let n,o;for(const c of this.args){if(n=c.evaluate(t),o=null,n instanceof Ut)return n;if(typeof n=="string"){const m=t.parseColor(n);if(m)return m}else if(Array.isArray(n)&&(o=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:qn(n[0],n[1],n[2],n[3]),!o))return new Ut(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new an(o||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const o of this.args){n=o.evaluate(t);const c=Rn.parse(n);if(c)return c}throw new an(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const o of this.args){n=o.evaluate(t);const c=_i.parse(n);if(c)return c}throw new an(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const o of this.args){if(n=o.evaluate(t),n===null)return 0;const c=Number(n);if(!isNaN(c))return c}throw new an(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return Qn.fromString(rl(this.args[0].evaluate(t)));case"resolvedImage":return Bn.fromString(rl(this.args[0].evaluate(t)));default:return rl(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const Qh=["Unknown","Point","LineString","Polygon"];class $l{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Qh[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let n=this._parseColorCache[t];return n||(n=this._parseColorCache[t]=Ut.parse(t)),n}}class Vs{constructor(t,n,o=[],c,m=new Jn,g=[]){this.registry=t,this.path=o,this.key=o.map((x=>`[${x}]`)).join(""),this.scope=m,this.errors=g,this.expectedType=c,this._isConstant=n}parse(t,n,o,c,m={}){return n?this.concat(n,o,c)._parse(t,m):this._parse(t,m)}_parse(t,n){function o(c,m,g){return g==="assert"?new ei(m,[c]):g==="coerce"?new ti(m,[c]):c}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=t[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[c];if(m){let g=m.parse(t,this);if(!g)return null;if(this.expectedType){const x=this.expectedType,S=g.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||S.kind!=="value")if(x.kind!=="color"&&x.kind!=="formatted"&&x.kind!=="resolvedImage"||S.kind!=="value"&&S.kind!=="string")if(x.kind!=="padding"||S.kind!=="value"&&S.kind!=="number"&&S.kind!=="array")if(x.kind!=="variableAnchorOffsetCollection"||S.kind!=="value"&&S.kind!=="array"){if(this.checkSubtype(x,S))return null}else g=o(g,x,n.typeAnnotation||"coerce");else g=o(g,x,n.typeAnnotation||"coerce");else g=o(g,x,n.typeAnnotation||"coerce");else g=o(g,x,n.typeAnnotation||"assert")}if(!(g instanceof es)&&g.type.kind!=="resolvedImage"&&this._isConstant(g)){const x=new $l;try{g=new es(g.type,g.evaluate(x))}catch(S){return this.error(S.message),null}}return g}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,n,o){const c=typeof t=="number"?this.path.concat(t):this.path,m=o?this.scope.concat(o):this.scope;return new Vs(this.registry,this._isConstant,c,n||null,m,this.errors)}error(t,...n){const o=`${this.key}${n.map((c=>`[${c}]`)).join("")}`;this.errors.push(new gn(o,t))}checkSubtype(t,n){const o=te(t,n);return o&&this.error(o),o}}class Us{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const o=[];for(let m=1;m<t.length-1;m+=2){const g=t[m];if(typeof g!="string")return n.error(`Expected string, but found ${typeof g} instead.`,m);if(/[^a-zA-Z0-9_]/.test(g))return n.error("Variable names must contain only alphanumeric characters or '_'.",m);const x=n.parse(t[m+1],m+1);if(!x)return null;o.push([g,x])}const c=n.parse(t[t.length-1],t.length-1,n.expectedType,o);return c?new Us(o,c):null}outputDefined(){return this.result.outputDefined()}}class yr{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(t.length!==2||typeof t[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const o=t[1];return n.scope.has(o)?new yr(o,n.scope.get(o)):n.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Ua{constructor(t,n,o){this.type=t,this.index=n,this.input=o}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,rt),c=n.parse(t[2],2,j(n.expectedType||Vt));return o&&c?new Ua(c.type.itemType,o,c):null}evaluate(t){const n=this.index.evaluate(t),o=this.input.evaluate(t);if(n<0)throw new an(`Array index out of bounds: ${n} < 0.`);if(n>=o.length)throw new an(`Array index out of bounds: ${n} > ${o.length-1}.`);if(n!==Math.floor(n))throw new an(`Array index must be an integer, but found ${n} instead.`);return o[n]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Du{constructor(t,n){this.type=Ft,this.needle=t,this.haystack=n}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,Vt),c=n.parse(t[2],2,Vt);return o&&c?he(o.type,[Ft,Jt,rt,ma,Vt])?new Du(o,c):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${N(o.type)} instead`):null}evaluate(t){const n=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!o)return!1;if(!me(n,["boolean","string","number","null"]))throw new an(`Expected first argument to be of type boolean, string, number or null, but found ${N(Er(n))} instead.`);if(!me(o,["string","array"]))throw new an(`Expected second argument to be of type array or string, but found ${N(Er(o))} instead.`);return o.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class ga{constructor(t,n,o){this.type=rt,this.needle=t,this.haystack=n,this.fromIndex=o}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,Vt),c=n.parse(t[2],2,Vt);if(!o||!c)return null;if(!he(o.type,[Ft,Jt,rt,ma,Vt]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${N(o.type)} instead`);if(t.length===4){const m=n.parse(t[3],3,rt);return m?new ga(o,c,m):null}return new ga(o,c)}evaluate(t){const n=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!me(n,["boolean","string","number","null"]))throw new an(`Expected first argument to be of type boolean, string, number or null, but found ${N(Er(n))} instead.`);let c;if(this.fromIndex&&(c=this.fromIndex.evaluate(t)),me(o,["string"])){const m=o.indexOf(n,c);return m===-1?-1:[...o.slice(0,m)].length}if(me(o,["array"]))return o.indexOf(n,c);throw new an(`Expected second argument to be of type array or string, but found ${N(Er(o))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Sr{constructor(t,n,o,c,m,g){this.inputType=t,this.type=n,this.input=o,this.cases=c,this.outputs=m,this.otherwise=g}static parse(t,n){if(t.length<5)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return n.error("Expected an even number of arguments.");let o,c;n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);const m={},g=[];for(let P=2;P<t.length-1;P+=2){let z=t[P];const L=t[P+1];Array.isArray(z)||(z=[z]);const O=n.concat(P);if(z.length===0)return O.error("Expected at least one branch label.");for(const q of z){if(typeof q!="number"&&typeof q!="string")return O.error("Branch labels must be numbers or strings.");if(typeof q=="number"&&Math.abs(q)>Number.MAX_SAFE_INTEGER)return O.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof q=="number"&&Math.floor(q)!==q)return O.error("Numeric branch labels must be integer values.");if(o){if(O.checkSubtype(o,Er(q)))return null}else o=Er(q);if(m[String(q)]!==void 0)return O.error("Branch labels must be unique.");m[String(q)]=g.length}const V=n.parse(L,P,c);if(!V)return null;c=c||V.type,g.push(V)}const x=n.parse(t[1],1,Vt);if(!x)return null;const S=n.parse(t[t.length-1],t.length-1,c);return S?x.type.kind!=="value"&&n.concat(1).checkSubtype(o,x.type)?null:new Sr(o,c,x,m,g,S):null}evaluate(t){const n=this.input.evaluate(t);return(Er(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}}class nl{constructor(t,n,o){this.type=t,this.branches=n,this.otherwise=o}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return n.error("Expected an odd number of arguments.");let o;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);const c=[];for(let g=1;g<t.length-1;g+=2){const x=n.parse(t[g],g,Ft);if(!x)return null;const S=n.parse(t[g+1],g+1,o);if(!S)return null;c.push([x,S]),o=o||S.type}const m=n.parse(t[t.length-1],t.length-1,o);if(!m)return null;if(!o)throw new Error("Can't infer output type");return new nl(o,c,m)}evaluate(t){for(const[n,o]of this.branches)if(n.evaluate(t))return o.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[n,o]of this.branches)t(n),t(o);t(this.otherwise)}outputDefined(){return this.branches.every((([t,n])=>n.outputDefined()))&&this.otherwise.outputDefined()}}class fo{constructor(t,n,o,c){this.type=t,this.input=n,this.beginIndex=o,this.endIndex=c}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,Vt),c=n.parse(t[2],2,rt);if(!o||!c)return null;if(!he(o.type,[j(Vt),Jt,Vt]))return n.error(`Expected first argument to be of type array or string, but found ${N(o.type)} instead`);if(t.length===4){const m=n.parse(t[3],3,rt);return m?new fo(o.type,o,c,m):null}return new fo(o.type,o,c)}evaluate(t){const n=this.input.evaluate(t),o=this.beginIndex.evaluate(t);let c;if(this.endIndex&&(c=this.endIndex.evaluate(t)),me(n,["string"]))return[...n].slice(o,c).join("");if(me(n,["array"]))return n.slice(o,c);throw new an(`Expected first argument to be of type array or string, but found ${N(Er(n))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function mo(r,t){const n=r.length-1;let o,c,m=0,g=n,x=0;for(;m<=g;)if(x=Math.floor((m+g)/2),o=r[x],c=r[x+1],o<=t){if(x===n||t<c)return x;m=x+1}else{if(!(o>t))throw new an("Input is not a number.");g=x-1}return 0}class $a{constructor(t,n,o){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(const[c,m]of o)this.labels.push(c),this.outputs.push(m)}static parse(t,n){if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");const o=n.parse(t[1],1,rt);if(!o)return null;const c=[];let m=null;n.expectedType&&n.expectedType.kind!=="value"&&(m=n.expectedType);for(let g=1;g<t.length;g+=2){const x=g===1?-1/0:t[g],S=t[g+1],P=g,z=g+1;if(typeof x!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(c.length&&c[c.length-1][0]>=x)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);const L=n.parse(S,z,m);if(!L)return null;m=m||L.type,c.push([x,L])}return new $a(m,o,c)}evaluate(t){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(t);const c=this.input.evaluate(t);if(c<=n[0])return o[0].evaluate(t);const m=n.length;return c>=n[m-1]?o[m-1].evaluate(t):o[mo(n,c)].evaluate(t)}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function Lu(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var qc=ql;function ql(r,t,n,o){this.cx=3*r,this.bx=3*(n-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(o-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=t,this.p2x=n,this.p2y=o}ql.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,t){if(t===void 0&&(t=1e-6),r<0)return 0;if(r>1)return 1;for(var n=r,o=0;o<8;o++){var c=this.sampleCurveX(n)-r;if(Math.abs(c)<t)return n;var m=this.sampleCurveDerivativeX(n);if(Math.abs(m)<1e-6)break;n-=c/m}var g=0,x=1;for(n=r,o=0;o<20&&(c=this.sampleCurveX(n),!(Math.abs(c-r)<t));o++)r>c?g=n:x=n,n=.5*(x-g)+g;return n},solve:function(r,t){return this.sampleCurveY(this.solveCurveX(r,t))}};var Zl=Lu(qc);function ri(r,t,n){return r+n*(t-r)}function zi(r,t,n){return r.map(((o,c)=>ri(o,t[c],n)))}const on={number:ri,color:function(r,t,n,o="rgb"){switch(o){case"rgb":{const[c,m,g,x]=zi(r.rgb,t.rgb,n);return new Ut(c,m,g,x,!1)}case"hcl":{const[c,m,g,x]=r.hcl,[S,P,z,L]=t.hcl;let O,V;if(isNaN(c)||isNaN(S))isNaN(c)?isNaN(S)?O=NaN:(O=S,g!==1&&g!==0||(V=P)):(O=c,z!==1&&z!==0||(V=m));else{let we=S-c;S>c&&we>180?we-=360:S<c&&c-S>180&&(we+=360),O=c+n*we}const[q,K,ne,le]=(function([we,de,_e,Ae]){return we=isNaN(we)?0:we*Ct,Gr([_e,Math.cos(we)*de,Math.sin(we)*de,Ae])})([O,V??ri(m,P,n),ri(g,z,n),ri(x,L,n)]);return new Ut(q,K,ne,le,!1)}case"lab":{const[c,m,g,x]=Gr(zi(r.lab,t.lab,n));return new Ut(c,m,g,x,!1)}}},array:zi,padding:function(r,t,n){return new Rn(zi(r.values,t.values,n))},variableAnchorOffsetCollection:function(r,t,n){const o=r.values,c=t.values;if(o.length!==c.length)throw new an(`Cannot interpolate values of different length. from: ${r.toString()}, to: ${t.toString()}`);const m=[];for(let g=0;g<o.length;g+=2){if(o[g]!==c[g])throw new an(`Cannot interpolate values containing mismatched anchors. from[${g}]: ${o[g]}, to[${g}]: ${c[g]}`);m.push(o[g]);const[x,S]=o[g+1],[P,z]=c[g+1];m.push([ri(x,P,n),ri(S,z,n)])}return new _i(m)}};class kn{constructor(t,n,o,c,m){this.type=t,this.operator=n,this.interpolation=o,this.input=c,this.labels=[],this.outputs=[];for(const[g,x]of m)this.labels.push(g),this.outputs.push(x)}static interpolationFactor(t,n,o,c){let m=0;if(t.name==="exponential")m=ya(n,t.base,o,c);else if(t.name==="linear")m=ya(n,1,o,c);else if(t.name==="cubic-bezier"){const g=t.controlPoints;m=new Zl(g[0],g[1],g[2],g[3]).solve(ya(n,1,o,c))}return m}static parse(t,n){let[o,c,m,...g]=t;if(!Array.isArray(c)||c.length===0)return n.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const P=c[1];if(typeof P!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:P}}else{if(c[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const P=c.slice(1);if(P.length!==4||P.some((z=>typeof z!="number"||z<0||z>1)))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:P}}}if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(m=n.parse(m,2,rt),!m)return null;const x=[];let S=null;o==="interpolate-hcl"||o==="interpolate-lab"?S=Ln:n.expectedType&&n.expectedType.kind!=="value"&&(S=n.expectedType);for(let P=0;P<g.length;P+=2){const z=g[P],L=g[P+1],O=P+3,V=P+4;if(typeof z!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(x.length&&x[x.length-1][0]>=z)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',O);const q=n.parse(L,V,S);if(!q)return null;S=S||q.type,x.push([z,q])}return ve(S,rt)||ve(S,Ln)||ve(S,yi)||ve(S,ie)||ve(S,j(rt))?new kn(S,o,c,m,x):n.error(`Type ${N(S)} is not interpolatable.`)}evaluate(t){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(t);const c=this.input.evaluate(t);if(c<=n[0])return o[0].evaluate(t);const m=n.length;if(c>=n[m-1])return o[m-1].evaluate(t);const g=mo(n,c),x=kn.interpolationFactor(this.interpolation,c,n[g],n[g+1]),S=o[g].evaluate(t),P=o[g+1].evaluate(t);switch(this.operator){case"interpolate":return on[this.type.kind](S,P,x);case"interpolate-hcl":return on.color(S,P,x,"hcl");case"interpolate-lab":return on.color(S,P,x,"lab")}}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function ya(r,t,n,o){const c=o-n,m=r-n;return c===0?0:t===1?m/c:(Math.pow(t,m)-1)/(Math.pow(t,c)-1)}class ts{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expectected at least one argument.");let o=null;const c=n.expectedType;c&&c.kind!=="value"&&(o=c);const m=[];for(const x of t.slice(1)){const S=n.parse(x,1+m.length,o,void 0,{typeAnnotation:"omit"});if(!S)return null;o=o||S.type,m.push(S)}if(!o)throw new Error("No output type");const g=c&&m.some((x=>te(c,x.type)));return new ts(g?Vt:o,m)}evaluate(t){let n,o=null,c=0;for(const m of this.args)if(c++,o=m.evaluate(t),o&&o instanceof Bn&&!o.available&&(n||(n=o.name),o=null,c===this.args.length&&(o=n)),o!==null)break;return o}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}function Gl(r,t){return r==="=="||r==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Ru(r,t,n,o){return o.compare(t,n)===0}function Is(r,t,n){const o=r!=="=="&&r!=="!=";return class ky{constructor(m,g,x){this.type=Ft,this.lhs=m,this.rhs=g,this.collator=x,this.hasUntypedArgument=m.type.kind==="value"||g.type.kind==="value"}static parse(m,g){if(m.length!==3&&m.length!==4)return g.error("Expected two or three arguments.");const x=m[0];let S=g.parse(m[1],1,Vt);if(!S)return null;if(!Gl(x,S.type))return g.concat(1).error(`"${x}" comparisons are not supported for type '${N(S.type)}'.`);let P=g.parse(m[2],2,Vt);if(!P)return null;if(!Gl(x,P.type))return g.concat(2).error(`"${x}" comparisons are not supported for type '${N(P.type)}'.`);if(S.type.kind!==P.type.kind&&S.type.kind!=="value"&&P.type.kind!=="value")return g.error(`Cannot compare types '${N(S.type)}' and '${N(P.type)}'.`);o&&(S.type.kind==="value"&&P.type.kind!=="value"?S=new ei(P.type,[S]):S.type.kind!=="value"&&P.type.kind==="value"&&(P=new ei(S.type,[P])));let z=null;if(m.length===4){if(S.type.kind!=="string"&&P.type.kind!=="string"&&S.type.kind!=="value"&&P.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(z=g.parse(m[3],3,Ai),!z)return null}return new ky(S,P,z)}evaluate(m){const g=this.lhs.evaluate(m),x=this.rhs.evaluate(m);if(o&&this.hasUntypedArgument){const S=Er(g),P=Er(x);if(S.kind!==P.kind||S.kind!=="string"&&S.kind!=="number")throw new an(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${S.kind}, ${P.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const S=Er(g),P=Er(x);if(S.kind!=="string"||P.kind!=="string")return t(m,g,x)}return this.collator?n(m,g,x,this.collator.evaluate(m)):t(m,g,x)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}}}const ed=Is("==",(function(r,t,n){return t===n}),Ru),Bu=Is("!=",(function(r,t,n){return t!==n}),(function(r,t,n,o){return!Ru(0,t,n,o)})),il=Is("<",(function(r,t,n){return t<n}),(function(r,t,n,o){return o.compare(t,n)<0})),Zc=Is(">",(function(r,t,n){return t>n}),(function(r,t,n,o){return o.compare(t,n)>0})),td=Is("<=",(function(r,t,n){return t<=n}),(function(r,t,n,o){return o.compare(t,n)<=0})),go=Is(">=",(function(r,t,n){return t>=n}),(function(r,t,n,o){return o.compare(t,n)>=0}));class $s{constructor(t,n,o){this.type=Ai,this.locale=o,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(t.length!==2)return n.error("Expected one argument.");const o=t[1];if(typeof o!="object"||Array.isArray(o))return n.error("Collator options argument must be an object.");const c=n.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Ft);if(!c)return null;const m=n.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Ft);if(!m)return null;let g=null;return o.locale&&(g=n.parse(o.locale,1,Jt),!g)?null:new $s(c,m,g)}evaluate(t){return new zu(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class _a{constructor(t,n,o,c,m){this.type=Jt,this.number=t,this.locale=n,this.currency=o,this.minFractionDigits=c,this.maxFractionDigits=m}static parse(t,n){if(t.length!==3)return n.error("Expected two arguments.");const o=n.parse(t[1],1,rt);if(!o)return null;const c=t[2];if(typeof c!="object"||Array.isArray(c))return n.error("NumberFormat options argument must be an object.");let m=null;if(c.locale&&(m=n.parse(c.locale,1,Jt),!m))return null;let g=null;if(c.currency&&(g=n.parse(c.currency,1,Jt),!g))return null;let x=null;if(c["min-fraction-digits"]&&(x=n.parse(c["min-fraction-digits"],1,rt),!x))return null;let S=null;return c["max-fraction-digits"]&&(S=n.parse(c["max-fraction-digits"],1,rt),!S)?null:new _a(o,m,g,x,S)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class qa{constructor(t){this.type=Qi,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const o=t[1];if(!Array.isArray(o)&&typeof o=="object")return n.error("First argument must be an image or text section.");const c=[];let m=!1;for(let g=1;g<=t.length-1;++g){const x=t[g];if(m&&typeof x=="object"&&!Array.isArray(x)){m=!1;let S=null;if(x["font-scale"]&&(S=n.parse(x["font-scale"],1,rt),!S))return null;let P=null;if(x["text-font"]&&(P=n.parse(x["text-font"],1,j(Jt)),!P))return null;let z=null;if(x["text-color"]&&(z=n.parse(x["text-color"],1,Ln),!z))return null;const L=c[c.length-1];L.scale=S,L.font=P,L.textColor=z}else{const S=n.parse(t[g],1,Vt);if(!S)return null;const P=S.type.kind;if(P!=="string"&&P!=="value"&&P!=="null"&&P!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,c.push({content:S,scale:null,font:null,textColor:null})}}return new qa(c)}evaluate(t){return new Qn(this.sections.map((n=>{const o=n.content.evaluate(t);return Er(o)===Un?new tl("",o,null,null,null):new tl(rl(o),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null)})))}eachChild(t){for(const n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor)}outputDefined(){return!1}}class Fu{constructor(t){this.type=Un,this.input=t}static parse(t,n){if(t.length!==2)return n.error("Expected two arguments.");const o=n.parse(t[1],1,Jt);return o?new Fu(o):n.error("No image name provided.")}evaluate(t){const n=this.input.evaluate(t),o=Bn.fromString(n);return o&&t.availableImages&&(o.available=t.availableImages.indexOf(n)>-1),o}eachChild(t){t(this.input)}outputDefined(){return!1}}class Ou{constructor(t){this.type=rt,this.input=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=n.parse(t[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${N(o.type)} instead.`):new Ou(o):null}evaluate(t){const n=this.input.evaluate(t);if(typeof n=="string")return[...n].length;if(Array.isArray(n))return n.length;throw new an(`Expected value to be of type string or array, but found ${N(Er(n))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const Di=8192;function Hl(r,t){const n=(180+r[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,c=Math.pow(2,t.z);return[Math.round(n*c*Di),Math.round(o*c*Di)]}function sl(r,t){const n=Math.pow(2,t.z);return[(c=(r[0]/Di+t.x)/n,360*c-180),(o=(r[1]/Di+t.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,c}function va(r,t){r[0]=Math.min(r[0],t[0]),r[1]=Math.min(r[1],t[1]),r[2]=Math.max(r[2],t[0]),r[3]=Math.max(r[3],t[1])}function Zn(r,t){return!(r[0]<=t[0]||r[2]>=t[2]||r[1]<=t[1]||r[3]>=t[3])}function _r(r,t,n){const o=r[0]-t[0],c=r[1]-t[1],m=r[0]-n[0],g=r[1]-n[1];return o*g-m*c==0&&o*m<=0&&c*g<=0}function Za(r,t,n,o){return(c=[o[0]-n[0],o[1]-n[1]])[0]*(m=[t[0]-r[0],t[1]-r[1]])[1]-c[1]*m[0]!=0&&!(!Ga(r,t,n,o)||!Ga(n,o,r,t));var c,m}function Gc(r,t,n){for(const o of n)for(let c=0;c<o.length-1;++c)if(Za(r,t,o[c],o[c+1]))return!0;return!1}function qs(r,t,n=!1){let o=!1;for(const x of t)for(let S=0;S<x.length-1;S++){if(_r(r,x[S],x[S+1]))return n;(m=x[S])[1]>(c=r)[1]!=(g=x[S+1])[1]>c[1]&&c[0]<(g[0]-m[0])*(c[1]-m[1])/(g[1]-m[1])+m[0]&&(o=!o)}var c,m,g;return o}function Kl(r,t){for(const n of t)if(qs(r,n))return!0;return!1}function Nu(r,t){for(const n of r)if(!qs(n,t))return!1;for(let n=0;n<r.length-1;++n)if(Gc(r[n],r[n+1],t))return!1;return!0}function vi(r,t){for(const n of t)if(Nu(r,n))return!0;return!1}function Ga(r,t,n,o){const c=o[0]-n[0],m=o[1]-n[1],g=(r[0]-n[0])*m-c*(r[1]-n[1]),x=(t[0]-n[0])*m-c*(t[1]-n[1]);return g>0&&x<0||g<0&&x>0}function al(r,t,n){const o=[];for(let c=0;c<r.length;c++){const m=[];for(let g=0;g<r[c].length;g++){const x=Hl(r[c][g],n);va(t,x),m.push(x)}o.push(m)}return o}function yo(r,t,n){const o=[];for(let c=0;c<r.length;c++){const m=al(r[c],t,n);o.push(m)}return o}function Hc(r,t,n,o){if(r[0]<n[0]||r[0]>n[2]){const c=.5*o;let m=r[0]-n[0]>c?-o:n[0]-r[0]>c?o:0;m===0&&(m=r[0]-n[2]>c?-o:n[2]-r[0]>c?o:0),r[0]+=m}va(t,r)}function Wl(r,t,n,o){const c=Math.pow(2,o.z)*Di,m=[o.x*Di,o.y*Di],g=[];for(const x of r)for(const S of x){const P=[S.x+m[0],S.y+m[1]];Hc(P,t,n,c),g.push(P)}return g}function Xl(r,t,n,o){const c=Math.pow(2,o.z)*Di,m=[o.x*Di,o.y*Di],g=[];for(const S of r){const P=[];for(const z of S){const L=[z.x+m[0],z.y+m[1]];va(t,L),P.push(L)}g.push(P)}if(t[2]-t[0]<=c/2){(x=t)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const S of g)for(const P of S)Hc(P,t,n,c)}var x;return g}class rs{constructor(t,n){this.type=Ft,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Na(t[1])){const o=t[1];if(o.type==="FeatureCollection"){const c=[];for(const m of o.features){const{type:g,coordinates:x}=m.geometry;g==="Polygon"&&c.push(x),g==="MultiPolygon"&&c.push(...x)}if(c.length)return new rs(o,{type:"MultiPolygon",coordinates:c})}else if(o.type==="Feature"){const c=o.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new rs(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new rs(o,o)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(n,o){const c=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(o.type==="Polygon"){const x=al(o.coordinates,m,g),S=Wl(n.geometry(),c,m,g);if(!Zn(c,m))return!1;for(const P of S)if(!qs(P,x))return!1}if(o.type==="MultiPolygon"){const x=yo(o.coordinates,m,g),S=Wl(n.geometry(),c,m,g);if(!Zn(c,m))return!1;for(const P of S)if(!Kl(P,x))return!1}return!0})(t,this.geometries);if(t.geometryType()==="LineString")return(function(n,o){const c=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(o.type==="Polygon"){const x=al(o.coordinates,m,g),S=Xl(n.geometry(),c,m,g);if(!Zn(c,m))return!1;for(const P of S)if(!Nu(P,x))return!1}if(o.type==="MultiPolygon"){const x=yo(o.coordinates,m,g),S=Xl(n.geometry(),c,m,g);if(!Zn(c,m))return!1;for(const P of S)if(!vi(P,x))return!1}return!0})(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let ol=class{constructor(r=[],t=((n,o)=>n<o?-1:n>o?1:0)){if(this.data=r,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:t,compare:n}=this,o=t[r];for(;r>0;){const c=r-1>>1,m=t[c];if(n(o,m)>=0)break;t[r]=m,r=c}t[r]=o}_down(r){const{data:t,compare:n}=this,o=this.length>>1,c=t[r];for(;r<o;){let m=1+(r<<1);const g=m+1;if(g<this.length&&n(t[g],t[m])<0&&(m=g),n(t[m],c)>=0)break;t[r]=t[m],r=m}t[r]=c}};function Kc(r,t,n,o,c){Wc(r,t,n,o||r.length-1,c||rd)}function Wc(r,t,n,o,c){for(;o>n;){if(o-n>600){var m=o-n+1,g=t-n+1,x=Math.log(m),S=.5*Math.exp(2*x/3),P=.5*Math.sqrt(x*S*(m-S)/m)*(g-m/2<0?-1:1);Wc(r,t,Math.max(n,Math.floor(t-g*S/m+P)),Math.min(o,Math.floor(t+(m-g)*S/m+P)),c)}var z=r[t],L=n,O=o;for(ll(r,n,t),c(r[o],z)>0&&ll(r,n,o);L<O;){for(ll(r,L,O),L++,O--;c(r[L],z)<0;)L++;for(;c(r[O],z)>0;)O--}c(r[n],z)===0?ll(r,n,O):ll(r,++O,o),O<=t&&(n=O+1),t<=O&&(o=O-1)}}function ll(r,t,n){var o=r[t];r[t]=r[n],r[n]=o}function rd(r,t){return r<t?-1:r>t?1:0}function _o(r,t){if(r.length<=1)return[r];const n=[];let o,c;for(const m of r){const g=id(m);g!==0&&(m.area=Math.abs(g),c===void 0&&(c=g<0),c===g<0?(o&&n.push(o),o=[m]):o.push(m))}if(o&&n.push(o),t>1)for(let m=0;m<n.length;m++)n[m].length<=t||(Kc(n[m],t,1,n[m].length-1,nd),n[m]=n[m].slice(0,t));return n}function nd(r,t){return t.area-r.area}function id(r){let t=0;for(let n,o,c=0,m=r.length,g=m-1;c<m;g=c++)n=r[c],o=r[g],t+=(o.x-n.x)*(n.y+o.y);return t}const Xc=1/298.257223563,Yc=Xc*(2-Xc),Jc=Math.PI/180;class Yl{constructor(t){const n=6378.137*Jc*1e3,o=Math.cos(t*Jc),c=1/(1-Yc*(1-o*o)),m=Math.sqrt(c);this.kx=n*m*o,this.ky=n*m*c*(1-Yc)}distance(t,n){const o=this.wrap(t[0]-n[0])*this.kx,c=(t[1]-n[1])*this.ky;return Math.sqrt(o*o+c*c)}pointOnLine(t,n){let o,c,m,g,x=1/0;for(let S=0;S<t.length-1;S++){let P=t[S][0],z=t[S][1],L=this.wrap(t[S+1][0]-P)*this.kx,O=(t[S+1][1]-z)*this.ky,V=0;L===0&&O===0||(V=(this.wrap(n[0]-P)*this.kx*L+(n[1]-z)*this.ky*O)/(L*L+O*O),V>1?(P=t[S+1][0],z=t[S+1][1]):V>0&&(P+=L/this.kx*V,z+=O/this.ky*V)),L=this.wrap(n[0]-P)*this.kx,O=(n[1]-z)*this.ky;const q=L*L+O*O;q<x&&(x=q,o=P,c=z,m=S,g=V)}return{point:[o,c],index:m,t:Math.max(0,Math.min(1,g))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Qc(r,t){return t[0]-r[0]}function Jl(r){return r[1]-r[0]+1}function Zs(r,t){return r[1]>=r[0]&&r[1]<t}function ju(r,t){if(r[0]>r[1])return[null,null];const n=Jl(r);if(t){if(n===2)return[r,null];const c=Math.floor(n/2);return[[r[0],r[0]+c],[r[0]+c,r[1]]]}if(n===1)return[r,null];const o=Math.floor(n/2)-1;return[[r[0],r[0]+o],[r[0]+o+1,r[1]]]}function ul(r,t){if(!Zs(t,r.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let o=t[0];o<=t[1];++o)va(n,r[o]);return n}function Vu(r){const t=[1/0,1/0,-1/0,-1/0];for(const n of r)for(const o of n)va(t,o);return t}function Ql(r){return r[0]!==-1/0&&r[1]!==-1/0&&r[2]!==1/0&&r[3]!==1/0}function Uu(r,t,n){if(!Ql(r)||!Ql(t))return NaN;let o=0,c=0;return r[2]<t[0]&&(o=t[0]-r[2]),r[0]>t[2]&&(o=r[0]-t[2]),r[1]>t[3]&&(c=r[1]-t[3]),r[3]<t[1]&&(c=t[1]-r[3]),n.distance([0,0],[o,c])}function xa(r,t,n){const o=n.pointOnLine(t,r);return n.distance(r,o.point)}function $u(r,t,n,o,c){const m=Math.min(xa(r,[n,o],c),xa(t,[n,o],c)),g=Math.min(xa(n,[r,t],c),xa(o,[r,t],c));return Math.min(m,g)}function sd(r,t,n,o,c){if(!Zs(t,r.length)||!Zs(o,n.length))return 1/0;let m=1/0;for(let g=t[0];g<t[1];++g){const x=r[g],S=r[g+1];for(let P=o[0];P<o[1];++P){const z=n[P],L=n[P+1];if(Za(x,S,z,L))return 0;m=Math.min(m,$u(x,S,z,L,c))}}return m}function tn(r,t,n,o,c){if(!Zs(t,r.length)||!Zs(o,n.length))return NaN;let m=1/0;for(let g=t[0];g<=t[1];++g)for(let x=o[0];x<=o[1];++x)if(m=Math.min(m,c.distance(r[g],n[x])),m===0)return m;return m}function ad(r,t,n){if(qs(r,t,!0))return 0;let o=1/0;for(const c of t){const m=c[0],g=c[c.length-1];if(m!==g&&(o=Math.min(o,xa(r,[g,m],n)),o===0))return o;const x=n.pointOnLine(c,r);if(o=Math.min(o,n.distance(r,x.point)),o===0)return o}return o}function sr(r,t,n,o){if(!Zs(t,r.length))return NaN;for(let m=t[0];m<=t[1];++m)if(qs(r[m],n,!0))return 0;let c=1/0;for(let m=t[0];m<t[1];++m){const g=r[m],x=r[m+1];for(const S of n)for(let P=0,z=S.length,L=z-1;P<z;L=P++){const O=S[L],V=S[P];if(Za(g,x,O,V))return 0;c=Math.min(c,$u(g,x,O,V,o))}}return c}function eu(r,t){for(const n of r)for(const o of n)if(qs(o,t,!0))return!0;return!1}function Lr(r,t,n,o=1/0){const c=Vu(r),m=Vu(t);if(o!==1/0&&Uu(c,m,n)>=o)return o;if(Zn(c,m)){if(eu(r,t))return 0}else if(eu(t,r))return 0;let g=1/0;for(const x of r)for(let S=0,P=x.length,z=P-1;S<P;z=S++){const L=x[z],O=x[S];for(const V of t)for(let q=0,K=V.length,ne=K-1;q<K;ne=q++){const le=V[ne],we=V[q];if(Za(L,O,le,we))return 0;g=Math.min(g,$u(L,O,le,we,n))}}return g}function kr(r,t,n,o,c,m){if(!m)return;const g=Uu(ul(o,m),c,n);g<t&&r.push([g,m,[0,0]])}function ns(r,t,n,o,c,m,g){if(!m||!g)return;const x=Uu(ul(o,m),ul(c,g),n);x<t&&r.push([x,m,g])}function cl(r,t,n,o,c=1/0){let m=Math.min(o.distance(r[0],n[0][0]),c);if(m===0)return m;const g=new ol([[0,[0,r.length-1],[0,0]]],Qc),x=Vu(n);for(;g.length>0;){const S=g.pop();if(S[0]>=m)continue;const P=S[1],z=t?50:100;if(Jl(P)<=z){if(!Zs(P,r.length))return NaN;if(t){const L=sr(r,P,n,o);if(isNaN(L)||L===0)return L;m=Math.min(m,L)}else for(let L=P[0];L<=P[1];++L){const O=ad(r[L],n,o);if(m=Math.min(m,O),m===0)return 0}}else{const L=ju(P,t);kr(g,m,o,r,x,L[0]),kr(g,m,o,r,x,L[1])}}return m}function vo(r,t,n,o,c,m=1/0){let g=Math.min(m,c.distance(r[0],n[0]));if(g===0)return g;const x=new ol([[0,[0,r.length-1],[0,n.length-1]]],Qc);for(;x.length>0;){const S=x.pop();if(S[0]>=g)continue;const P=S[1],z=S[2],L=t?50:100,O=o?50:100;if(Jl(P)<=L&&Jl(z)<=O){if(!Zs(P,r.length)&&Zs(z,n.length))return NaN;let V;if(t&&o)V=sd(r,P,n,z,c),g=Math.min(g,V);else if(t&&!o){const q=r.slice(P[0],P[1]+1);for(let K=z[0];K<=z[1];++K)if(V=xa(n[K],q,c),g=Math.min(g,V),g===0)return g}else if(!t&&o){const q=n.slice(z[0],z[1]+1);for(let K=P[0];K<=P[1];++K)if(V=xa(r[K],q,c),g=Math.min(g,V),g===0)return g}else V=tn(r,P,n,z,c),g=Math.min(g,V)}else{const V=ju(P,t),q=ju(z,o);ns(x,g,c,r,n,V[0],q[0]),ns(x,g,c,r,n,V[0],q[1]),ns(x,g,c,r,n,V[1],q[0]),ns(x,g,c,r,n,V[1],q[1])}}return g}function tu(r){return r.type==="MultiPolygon"?r.coordinates.map((t=>({type:"Polygon",coordinates:t}))):r.type==="MultiLineString"?r.coordinates.map((t=>({type:"LineString",coordinates:t}))):r.type==="MultiPoint"?r.coordinates.map((t=>({type:"Point",coordinates:t}))):[r]}class wa{constructor(t,n){this.type=rt,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Na(t[1])){const o=t[1];if(o.type==="FeatureCollection")return new wa(o,o.features.map((c=>tu(c.geometry))).flat());if(o.type==="Feature")return new wa(o,tu(o.geometry));if("type"in o&&"coordinates"in o)return new wa(o,tu(o))}return n.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(n,o){const c=n.geometry(),m=c.flat().map((S=>sl([S.x,S.y],n.canonical)));if(c.length===0)return NaN;const g=new Yl(m[0][1]);let x=1/0;for(const S of o){switch(S.type){case"Point":x=Math.min(x,vo(m,!1,[S.coordinates],!1,g,x));break;case"LineString":x=Math.min(x,vo(m,!1,S.coordinates,!0,g,x));break;case"Polygon":x=Math.min(x,cl(m,!1,S.coordinates,g,x))}if(x===0)return x}return x})(t,this.geometries);if(t.geometryType()==="LineString")return(function(n,o){const c=n.geometry(),m=c.flat().map((S=>sl([S.x,S.y],n.canonical)));if(c.length===0)return NaN;const g=new Yl(m[0][1]);let x=1/0;for(const S of o){switch(S.type){case"Point":x=Math.min(x,vo(m,!0,[S.coordinates],!1,g,x));break;case"LineString":x=Math.min(x,vo(m,!0,S.coordinates,!0,g,x));break;case"Polygon":x=Math.min(x,cl(m,!0,S.coordinates,g,x))}if(x===0)return x}return x})(t,this.geometries);if(t.geometryType()==="Polygon")return(function(n,o){const c=n.geometry();if(c.length===0||c[0].length===0)return NaN;const m=_o(c,0).map((S=>S.map((P=>P.map((z=>sl([z.x,z.y],n.canonical))))))),g=new Yl(m[0][0][0][1]);let x=1/0;for(const S of o)for(const P of m){switch(S.type){case"Point":x=Math.min(x,cl([S.coordinates],!1,P,g,x));break;case"LineString":x=Math.min(x,cl(S.coordinates,!0,P,g,x));break;case"Polygon":x=Math.min(x,Lr(P,S.coordinates,g,x))}if(x===0)return x}return x})(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Ha={"==":ed,"!=":Bu,">":Zc,"<":il,">=":go,"<=":td,array:ei,at:Ua,boolean:ei,case:nl,coalesce:ts,collator:$s,format:qa,image:Fu,in:Du,"index-of":ga,interpolate:kn,"interpolate-hcl":kn,"interpolate-lab":kn,length:Ou,let:Us,literal:es,match:Sr,number:ei,"number-format":_a,object:ei,slice:fo,step:$a,string:ei,"to-boolean":ti,"to-color":ti,"to-number":ti,"to-string":ti,var:yr,within:rs,distance:wa};class xi{constructor(t,n,o,c){this.name=t,this.type=n,this._evaluate=o,this.args=c}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,n){const o=t[0],c=xi.definitions[o];if(!c)return n.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(c)?c[0]:c.type,g=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,x=g.filter((([P])=>!Array.isArray(P)||P.length===t.length-1));let S=null;for(const[P,z]of x){S=new Vs(n.registry,xo,n.path,null,n.scope);const L=[];let O=!1;for(let V=1;V<t.length;V++){const q=t[V],K=Array.isArray(P)?P[V-1]:P.type,ne=S.parse(q,1+L.length,K);if(!ne){O=!0;break}L.push(ne)}if(!O)if(Array.isArray(P)&&P.length!==L.length)S.error(`Expected ${P.length} arguments, but found ${L.length} instead.`);else{for(let V=0;V<L.length;V++){const q=Array.isArray(P)?P[V]:P.type,K=L[V];S.concat(V+1).checkSubtype(q,K.type)}if(S.errors.length===0)return new xi(o,m,z,L)}}if(x.length===1)n.errors.push(...S.errors);else{const P=(x.length?x:g).map((([L])=>{return O=L,Array.isArray(O)?`(${O.map(N).join(", ")})`:`(${N(O.type)}...)`;var O})).join(" | "),z=[];for(let L=1;L<t.length;L++){const O=n.parse(t[L],1+z.length);if(!O)return null;z.push(N(O.type))}n.error(`Expected arguments of type ${P}, but found (${z.join(", ")}) instead.`)}return null}static register(t,n){xi.definitions=n;for(const o in n)t[o]=xi}}function ba(r,[t,n,o,c]){t=t.evaluate(r),n=n.evaluate(r),o=o.evaluate(r);const m=c?c.evaluate(r):1,g=qn(t,n,o,m);if(g)throw new an(g);return new Ut(t/255,n/255,o/255,m,!1)}function qu(r,t){return r in t}function Zu(r,t){const n=t[r];return n===void 0?null:n}function Ka(r){return{type:r}}function xo(r){if(r instanceof yr)return xo(r.boundExpression);if(r instanceof xi&&r.name==="error"||r instanceof $s||r instanceof rs||r instanceof wa)return!1;const t=r instanceof ti||r instanceof ei;let n=!0;return r.eachChild((o=>{n=t?n&&xo(o):n&&o instanceof es})),!!n&&wo(r)&&Gs(r,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function wo(r){if(r instanceof xi&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof rs||r instanceof wa)return!1;let t=!0;return r.eachChild((n=>{t&&!wo(n)&&(t=!1)})),t}function Es(r){if(r instanceof xi&&r.name==="feature-state")return!1;let t=!0;return r.eachChild((n=>{t&&!Es(n)&&(t=!1)})),t}function Gs(r,t){if(r instanceof xi&&t.indexOf(r.name)>=0)return!1;let n=!0;return r.eachChild((o=>{n&&!Gs(o,t)&&(n=!1)})),n}function ru(r){return{result:"success",value:r}}function Hs(r){return{result:"error",value:r}}function bo(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function Gu(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function hl(r){return!!r.expression&&r.expression.interpolated}function dr(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function dl(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function eh(r){return r}function Hu(r,t){const n=t.type==="color",o=r.stops&&typeof r.stops[0][0]=="object",c=o||!(o||r.property!==void 0),m=r.type||(hl(t)?"exponential":"interval");if(n||t.type==="padding"){const z=n?Ut.parse:Rn.parse;(r=Ji({},r)).stops&&(r.stops=r.stops.map((L=>[L[0],z(L[1])]))),r.default=z(r.default?r.default:t.default)}if(r.colorSpace&&(g=r.colorSpace)!=="rgb"&&g!=="hcl"&&g!=="lab")throw new Error(`Unknown color space: "${r.colorSpace}"`);var g;let x,S,P;if(m==="exponential")x=rh;else if(m==="interval")x=nu;else if(m==="categorical"){x=th,S=Object.create(null);for(const z of r.stops)S[z[0]]=z[1];P=typeof r.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);x=nh}if(o){const z={},L=[];for(let q=0;q<r.stops.length;q++){const K=r.stops[q],ne=K[0].zoom;z[ne]===void 0&&(z[ne]={zoom:ne,type:r.type,property:r.property,default:r.default,stops:[]},L.push(ne)),z[ne].stops.push([K[0].value,K[1]])}const O=[];for(const q of L)O.push([z[q].zoom,Hu(z[q],t)]);const V={name:"linear"};return{kind:"composite",interpolationType:V,interpolationFactor:kn.interpolationFactor.bind(void 0,V),zoomStops:O.map((q=>q[0])),evaluate:({zoom:q},K)=>rh({stops:O,base:r.base},t,q).evaluate(q,K)}}if(c){const z=m==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:z,interpolationFactor:kn.interpolationFactor.bind(void 0,z),zoomStops:r.stops.map((L=>L[0])),evaluate:({zoom:L})=>x(r,t,L,S,P)}}return{kind:"source",evaluate(z,L){const O=L&&L.properties?L.properties[r.property]:void 0;return O===void 0?So(r.default,t.default):x(r,t,O,S,P)}}}function So(r,t,n){return r!==void 0?r:t!==void 0?t:n!==void 0?n:void 0}function th(r,t,n,o,c){return So(typeof n===c?o[n]:void 0,r.default,t.default)}function nu(r,t,n){if(dr(n)!=="number")return So(r.default,t.default);const o=r.stops.length;if(o===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[o-1][0])return r.stops[o-1][1];const c=mo(r.stops.map((m=>m[0])),n);return r.stops[c][1]}function rh(r,t,n){const o=r.base!==void 0?r.base:1;if(dr(n)!=="number")return So(r.default,t.default);const c=r.stops.length;if(c===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[c-1][0])return r.stops[c-1][1];const m=mo(r.stops.map((z=>z[0])),n),g=(function(z,L,O,V){const q=V-O,K=z-O;return q===0?0:L===1?K/q:(Math.pow(L,K)-1)/(Math.pow(L,q)-1)})(n,o,r.stops[m][0],r.stops[m+1][0]),x=r.stops[m][1],S=r.stops[m+1][1],P=on[t.type]||eh;return typeof x.evaluate=="function"?{evaluate(...z){const L=x.evaluate.apply(void 0,z),O=S.evaluate.apply(void 0,z);if(L!==void 0&&O!==void 0)return P(L,O,g,r.colorSpace)}}:P(x,S,g,r.colorSpace)}function nh(r,t,n){switch(t.type){case"color":n=Ut.parse(n);break;case"formatted":n=Qn.fromString(n.toString());break;case"resolvedImage":n=Bn.fromString(n.toString());break;case"padding":n=Rn.parse(n);break;default:dr(n)===t.type||t.type==="enum"&&t.values[n]||(n=void 0)}return So(n,r.default,t.default)}xi.register(Ha,{error:[{kind:"error"},[Jt],(r,[t])=>{throw new an(t.evaluate(r))}],typeof:[Jt,[Vt],(r,[t])=>N(Er(t.evaluate(r)))],"to-rgba":[j(rt,4),[Ln],(r,[t])=>{const[n,o,c,m]=t.evaluate(r).rgb;return[255*n,255*o,255*c,m]}],rgb:[Ln,[rt,rt,rt],ba],rgba:[Ln,[rt,rt,rt,rt],ba],has:{type:Ft,overloads:[[[Jt],(r,[t])=>qu(t.evaluate(r),r.properties())],[[Jt,gi],(r,[t,n])=>qu(t.evaluate(r),n.evaluate(r))]]},get:{type:Vt,overloads:[[[Jt],(r,[t])=>Zu(t.evaluate(r),r.properties())],[[Jt,gi],(r,[t,n])=>Zu(t.evaluate(r),n.evaluate(r))]]},"feature-state":[Vt,[Jt],(r,[t])=>Zu(t.evaluate(r),r.featureState||{})],properties:[gi,[],r=>r.properties()],"geometry-type":[Jt,[],r=>r.geometryType()],id:[Vt,[],r=>r.id()],zoom:[rt,[],r=>r.globals.zoom],"heatmap-density":[rt,[],r=>r.globals.heatmapDensity||0],"line-progress":[rt,[],r=>r.globals.lineProgress||0],accumulated:[Vt,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[rt,Ka(rt),(r,t)=>{let n=0;for(const o of t)n+=o.evaluate(r);return n}],"*":[rt,Ka(rt),(r,t)=>{let n=1;for(const o of t)n*=o.evaluate(r);return n}],"-":{type:rt,overloads:[[[rt,rt],(r,[t,n])=>t.evaluate(r)-n.evaluate(r)],[[rt],(r,[t])=>-t.evaluate(r)]]},"/":[rt,[rt,rt],(r,[t,n])=>t.evaluate(r)/n.evaluate(r)],"%":[rt,[rt,rt],(r,[t,n])=>t.evaluate(r)%n.evaluate(r)],ln2:[rt,[],()=>Math.LN2],pi:[rt,[],()=>Math.PI],e:[rt,[],()=>Math.E],"^":[rt,[rt,rt],(r,[t,n])=>Math.pow(t.evaluate(r),n.evaluate(r))],sqrt:[rt,[rt],(r,[t])=>Math.sqrt(t.evaluate(r))],log10:[rt,[rt],(r,[t])=>Math.log(t.evaluate(r))/Math.LN10],ln:[rt,[rt],(r,[t])=>Math.log(t.evaluate(r))],log2:[rt,[rt],(r,[t])=>Math.log(t.evaluate(r))/Math.LN2],sin:[rt,[rt],(r,[t])=>Math.sin(t.evaluate(r))],cos:[rt,[rt],(r,[t])=>Math.cos(t.evaluate(r))],tan:[rt,[rt],(r,[t])=>Math.tan(t.evaluate(r))],asin:[rt,[rt],(r,[t])=>Math.asin(t.evaluate(r))],acos:[rt,[rt],(r,[t])=>Math.acos(t.evaluate(r))],atan:[rt,[rt],(r,[t])=>Math.atan(t.evaluate(r))],min:[rt,Ka(rt),(r,t)=>Math.min(...t.map((n=>n.evaluate(r))))],max:[rt,Ka(rt),(r,t)=>Math.max(...t.map((n=>n.evaluate(r))))],abs:[rt,[rt],(r,[t])=>Math.abs(t.evaluate(r))],round:[rt,[rt],(r,[t])=>{const n=t.evaluate(r);return n<0?-Math.round(-n):Math.round(n)}],floor:[rt,[rt],(r,[t])=>Math.floor(t.evaluate(r))],ceil:[rt,[rt],(r,[t])=>Math.ceil(t.evaluate(r))],"filter-==":[Ft,[Jt,Vt],(r,[t,n])=>r.properties()[t.value]===n.value],"filter-id-==":[Ft,[Vt],(r,[t])=>r.id()===t.value],"filter-type-==":[Ft,[Jt],(r,[t])=>r.geometryType()===t.value],"filter-<":[Ft,[Jt,Vt],(r,[t,n])=>{const o=r.properties()[t.value],c=n.value;return typeof o==typeof c&&o<c}],"filter-id-<":[Ft,[Vt],(r,[t])=>{const n=r.id(),o=t.value;return typeof n==typeof o&&n<o}],"filter->":[Ft,[Jt,Vt],(r,[t,n])=>{const o=r.properties()[t.value],c=n.value;return typeof o==typeof c&&o>c}],"filter-id->":[Ft,[Vt],(r,[t])=>{const n=r.id(),o=t.value;return typeof n==typeof o&&n>o}],"filter-<=":[Ft,[Jt,Vt],(r,[t,n])=>{const o=r.properties()[t.value],c=n.value;return typeof o==typeof c&&o<=c}],"filter-id-<=":[Ft,[Vt],(r,[t])=>{const n=r.id(),o=t.value;return typeof n==typeof o&&n<=o}],"filter->=":[Ft,[Jt,Vt],(r,[t,n])=>{const o=r.properties()[t.value],c=n.value;return typeof o==typeof c&&o>=c}],"filter-id->=":[Ft,[Vt],(r,[t])=>{const n=r.id(),o=t.value;return typeof n==typeof o&&n>=o}],"filter-has":[Ft,[Vt],(r,[t])=>t.value in r.properties()],"filter-has-id":[Ft,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[Ft,[j(Jt)],(r,[t])=>t.value.indexOf(r.geometryType())>=0],"filter-id-in":[Ft,[j(Vt)],(r,[t])=>t.value.indexOf(r.id())>=0],"filter-in-small":[Ft,[Jt,j(Vt)],(r,[t,n])=>n.value.indexOf(r.properties()[t.value])>=0],"filter-in-large":[Ft,[Jt,j(Vt)],(r,[t,n])=>(function(o,c,m,g){for(;m<=g;){const x=m+g>>1;if(c[x]===o)return!0;c[x]>o?g=x-1:m=x+1}return!1})(r.properties()[t.value],n.value,0,n.value.length-1)],all:{type:Ft,overloads:[[[Ft,Ft],(r,[t,n])=>t.evaluate(r)&&n.evaluate(r)],[Ka(Ft),(r,t)=>{for(const n of t)if(!n.evaluate(r))return!1;return!0}]]},any:{type:Ft,overloads:[[[Ft,Ft],(r,[t,n])=>t.evaluate(r)||n.evaluate(r)],[Ka(Ft),(r,t)=>{for(const n of t)if(n.evaluate(r))return!0;return!1}]]},"!":[Ft,[Ft],(r,[t])=>!t.evaluate(r)],"is-supported-script":[Ft,[Jt],(r,[t])=>{const n=r.globals&&r.globals.isSupportedScript;return!n||n(t.evaluate(r))}],upcase:[Jt,[Jt],(r,[t])=>t.evaluate(r).toUpperCase()],downcase:[Jt,[Jt],(r,[t])=>t.evaluate(r).toLowerCase()],concat:[Jt,Ka(Vt),(r,t)=>t.map((n=>rl(n.evaluate(r)))).join("")],"resolved-locale":[Jt,[Ai],(r,[t])=>t.evaluate(r).resolvedLocale()]});class ni{constructor(t,n){var o;this.expression=t,this._warningHistory={},this._evaluator=new $l,this._defaultValue=n?(o=n).type==="color"&&dl(o.default)?new Ut(0,0,0,0):o.type==="color"?Ut.parse(o.default)||null:o.type==="padding"?Rn.parse(o.default)||null:o.type==="variableAnchorOffsetCollection"?_i.parse(o.default)||null:o.default===void 0?null:o.default:null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(t,n,o,c,m,g){return this._evaluator.globals=t,this._evaluator.feature=n,this._evaluator.featureState=o,this._evaluator.canonical=c,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g,this.expression.evaluate(this._evaluator)}evaluate(t,n,o,c,m,g){this._evaluator.globals=t,this._evaluator.feature=n||null,this._evaluator.featureState=o||null,this._evaluator.canonical=c,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g||null;try{const x=this.expression.evaluate(this._evaluator);if(x==null||typeof x=="number"&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new an(`Expected value to be one of ${Object.keys(this._enumValues).map((S=>JSON.stringify(S))).join(", ")}, but found ${JSON.stringify(x)} instead.`);return x}catch(x){return this._warningHistory[x.message]||(this._warningHistory[x.message]=!0,typeof console<"u"&&console.warn(x.message)),this._defaultValue}}}function Sa(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in Ha}function Wa(r,t){const n=new Vs(Ha,xo,[],t?(function(c){const m={color:Ln,string:Jt,number:rt,enum:Jt,boolean:Ft,formatted:Qi,padding:yi,resolvedImage:Un,variableAnchorOffsetCollection:ie};return c.type==="array"?j(m[c.value]||Vt,c.length):m[c.type]})(t):void 0),o=n.parse(r,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?ru(new ni(o,t)):Hs(n.errors)}class Xa{constructor(t,n){this.kind=t,this._styleExpression=n,this.isStateDependent=t!=="constant"&&!Es(n.expression)}evaluateWithoutErrorHandling(t,n,o,c,m,g){return this._styleExpression.evaluateWithoutErrorHandling(t,n,o,c,m,g)}evaluate(t,n,o,c,m,g){return this._styleExpression.evaluate(t,n,o,c,m,g)}}class Ya{constructor(t,n,o,c){this.kind=t,this.zoomStops=o,this._styleExpression=n,this.isStateDependent=t!=="camera"&&!Es(n.expression),this.interpolationType=c}evaluateWithoutErrorHandling(t,n,o,c,m,g){return this._styleExpression.evaluateWithoutErrorHandling(t,n,o,c,m,g)}evaluate(t,n,o,c,m,g){return this._styleExpression.evaluate(t,n,o,c,m,g)}interpolationFactor(t,n,o){return this.interpolationType?kn.interpolationFactor(this.interpolationType,t,n,o):0}}function iu(r,t){const n=Wa(r,t);if(n.result==="error")return n;const o=n.value.expression,c=wo(o);if(!c&&!bo(t))return Hs([new gn("","data expressions not supported")]);const m=Gs(o,["zoom"]);if(!m&&!Gu(t))return Hs([new gn("","zoom expressions not supported")]);const g=pl(o);return g||m?g instanceof gn?Hs([g]):g instanceof kn&&!hl(t)?Hs([new gn("",'"interpolate" expressions cannot be used with this property')]):ru(g?new Ya(c?"camera":"composite",n.value,g.labels,g instanceof kn?g.interpolation:void 0):new Xa(c?"constant":"source",n.value)):Hs([new gn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ka{constructor(t,n){this._parameters=t,this._specification=n,Ji(this,Hu(this._parameters,this._specification))}static deserialize(t){return new ka(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function pl(r){let t=null;if(r instanceof Us)t=pl(r.result);else if(r instanceof ts){for(const n of r.args)if(t=pl(n),t)break}else(r instanceof $a||r instanceof kn)&&r.input instanceof xi&&r.input.name==="zoom"&&(t=r);return t instanceof gn||r.eachChild((n=>{const o=pl(n);o instanceof gn?t=o:!t&&o?t=new gn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&o&&t!==o&&(t=new gn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}function su(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const t of r.slice(1))if(!su(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const Ks={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function fl(r){if(r==null)return{filter:()=>!0,needGeometry:!1};su(r)||(r=gl(r));const t=Wa(r,Ks);if(t.result==="error")throw new Error(t.value.map((n=>`${n.key}: ${n.message}`)).join(", "));return{filter:(n,o,c)=>t.value.evaluate(n,o,{},c),needGeometry:au(r)}}function ml(r,t){return r<t?-1:r>t?1:0}function au(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let t=1;t<r.length;t++)if(au(r[t]))return!0;return!1}function gl(r){if(!r)return!0;const t=r[0];return r.length<=1?t!=="any":t==="=="?ko(r[1],r[2],"=="):t==="!="?Pn(ko(r[1],r[2],"==")):t==="<"||t===">"||t==="<="||t===">="?ko(r[1],r[2],t):t==="any"?(n=r.slice(1),["any"].concat(n.map(gl))):t==="all"?["all"].concat(r.slice(1).map(gl)):t==="none"?["all"].concat(r.slice(1).map(gl).map(Pn)):t==="in"?Ps(r[1],r.slice(2)):t==="!in"?Pn(Ps(r[1],r.slice(2))):t==="has"?Ja(r[1]):t!=="!has"||Pn(Ja(r[1]));var n}function ko(r,t,n){switch(r){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,r,t]}}function Ps(r,t){if(t.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((n=>typeof n!=typeof t[0]))?["filter-in-large",r,["literal",t.sort(ml)]]:["filter-in-small",r,["literal",t]]}}function Ja(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function Pn(r){return["!",r]}function Cs(r){const t=typeof r;if(t==="number"||t==="boolean"||t==="string"||r==null)return JSON.stringify(r);if(Array.isArray(r)){let c="[";for(const m of r)c+=`${Cs(m)},`;return`${c}]`}const n=Object.keys(r).sort();let o="{";for(let c=0;c<n.length;c++)o+=`${JSON.stringify(n[c])}:${Cs(r[n[c]])},`;return`${o}}`}function Ku(r){let t="";for(const n of js)t+=`/${Cs(r[n])}`;return t}function Wu(r){const t=r.value;return t?[new Ke(r.key,t,"constants have been deprecated as of v8")]:[]}function Yr(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Li(r){if(Array.isArray(r))return r.map(Li);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const t={};for(const n in r)t[n]=Li(r[n]);return t}return Yr(r)}function ii(r){const t=r.key,n=r.value,o=r.valueSpec||{},c=r.objectElementValidators||{},m=r.style,g=r.styleSpec,x=r.validateSpec;let S=[];const P=dr(n);if(P!=="object")return[new Ke(t,n,`object expected, ${P} found`)];for(const z in n){const L=z.split(".")[0],O=o[L]||o["*"];let V;if(c[L])V=c[L];else if(o[L])V=x;else if(c["*"])V=c["*"];else{if(!o["*"]){S.push(new Ke(t,n[z],`unknown property "${z}"`));continue}V=x}S=S.concat(V({key:(t&&`${t}.`)+z,value:n[z],valueSpec:O,style:m,styleSpec:g,object:n,objectKey:z,validateSpec:x},n))}for(const z in o)c[z]||o[z].required&&o[z].default===void 0&&n[z]===void 0&&S.push(new Ke(t,n,`missing required property "${z}"`));return S}function To(r){const t=r.value,n=r.valueSpec,o=r.style,c=r.styleSpec,m=r.key,g=r.arrayElementValidator||r.validateSpec;if(dr(t)!=="array")return[new Ke(m,t,`array expected, ${dr(t)} found`)];if(n.length&&t.length!==n.length)return[new Ke(m,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new Ke(m,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let x={type:n.value,values:n.values};c.$version<7&&(x.function=n.function),dr(n.value)==="object"&&(x=n.value);let S=[];for(let P=0;P<t.length;P++)S=S.concat(g({array:t,arrayIndex:P,value:t[P],valueSpec:x,validateSpec:r.validateSpec,style:o,styleSpec:c,key:`${m}[${P}]`}));return S}function Ms(r){const t=r.key,n=r.value,o=r.valueSpec;let c=dr(n);return c==="number"&&n!=n&&(c="NaN"),c!=="number"?[new Ke(t,n,`number expected, ${c} found`)]:"minimum"in o&&n<o.minimum?[new Ke(t,n,`${n} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&n>o.maximum?[new Ke(t,n,`${n} is greater than the maximum value ${o.maximum}`)]:[]}function Io(r){const t=r.valueSpec,n=Yr(r.value.type);let o,c,m,g={};const x=n!=="categorical"&&r.value.property===void 0,S=!x,P=dr(r.value.stops)==="array"&&dr(r.value.stops[0])==="array"&&dr(r.value.stops[0][0])==="object",z=ii({key:r.key,value:r.value,valueSpec:r.styleSpec.function,validateSpec:r.validateSpec,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(V){if(n==="identity")return[new Ke(V.key,V.value,'identity function may not have a "stops" property')];let q=[];const K=V.value;return q=q.concat(To({key:V.key,value:K,valueSpec:V.valueSpec,validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec,arrayElementValidator:L})),dr(K)==="array"&&K.length===0&&q.push(new Ke(V.key,K,"array must have at least one stop")),q},default:function(V){return V.validateSpec({key:V.key,value:V.value,valueSpec:t,validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec})}}});return n==="identity"&&x&&z.push(new Ke(r.key,r.value,'missing required property "property"')),n==="identity"||r.value.stops||z.push(new Ke(r.key,r.value,'missing required property "stops"')),n==="exponential"&&r.valueSpec.expression&&!hl(r.valueSpec)&&z.push(new Ke(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(S&&!bo(r.valueSpec)?z.push(new Ke(r.key,r.value,"property functions not supported")):x&&!Gu(r.valueSpec)&&z.push(new Ke(r.key,r.value,"zoom functions not supported"))),n!=="categorical"&&!P||r.value.property!==void 0||z.push(new Ke(r.key,r.value,'"property" property is required')),z;function L(V){let q=[];const K=V.value,ne=V.key;if(dr(K)!=="array")return[new Ke(ne,K,`array expected, ${dr(K)} found`)];if(K.length!==2)return[new Ke(ne,K,`array length 2 expected, length ${K.length} found`)];if(P){if(dr(K[0])!=="object")return[new Ke(ne,K,`object expected, ${dr(K[0])} found`)];if(K[0].zoom===void 0)return[new Ke(ne,K,"object stop key must have zoom")];if(K[0].value===void 0)return[new Ke(ne,K,"object stop key must have value")];if(m&&m>Yr(K[0].zoom))return[new Ke(ne,K[0].zoom,"stop zoom values must appear in ascending order")];Yr(K[0].zoom)!==m&&(m=Yr(K[0].zoom),c=void 0,g={}),q=q.concat(ii({key:`${ne}[0]`,value:K[0],valueSpec:{zoom:{}},validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec,objectElementValidators:{zoom:Ms,value:O}}))}else q=q.concat(O({key:`${ne}[0]`,value:K[0],validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec},K));return Sa(Li(K[1]))?q.concat([new Ke(`${ne}[1]`,K[1],"expressions are not allowed in function stops.")]):q.concat(V.validateSpec({key:`${ne}[1]`,value:K[1],valueSpec:t,validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec}))}function O(V,q){const K=dr(V.value),ne=Yr(V.value),le=V.value!==null?V.value:q;if(o){if(K!==o)return[new Ke(V.key,le,`${K} stop domain type must match previous stop domain type ${o}`)]}else o=K;if(K!=="number"&&K!=="string"&&K!=="boolean")return[new Ke(V.key,le,"stop domain value must be a number, string, or boolean")];if(K!=="number"&&n!=="categorical"){let we=`number expected, ${K} found`;return bo(t)&&n===void 0&&(we+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ke(V.key,le,we)]}return n!=="categorical"||K!=="number"||isFinite(ne)&&Math.floor(ne)===ne?n!=="categorical"&&K==="number"&&c!==void 0&&ne<c?[new Ke(V.key,le,"stop domain values must appear in ascending order")]:(c=ne,n==="categorical"&&ne in g?[new Ke(V.key,le,"stop domain values must be unique")]:(g[ne]=!0,[])):[new Ke(V.key,le,`integer expected, found ${ne}`)]}}function Ta(r){const t=(r.expressionContext==="property"?iu:Wa)(Li(r.value),r.valueSpec);if(t.result==="error")return t.value.map((o=>new Ke(`${r.key}${o.key}`,r.value,o.message)));const n=t.value.expression||t.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!n.outputDefined())return[new Ke(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!Es(n))return[new Ke(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!Es(n))return[new Ke(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!Gs(n,["zoom","feature-state"]))return[new Ke(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!wo(n))return[new Ke(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ws(r){const t=r.key,n=r.value,o=r.valueSpec,c=[];return Array.isArray(o.values)?o.values.indexOf(Yr(n))===-1&&c.push(new Ke(t,n,`expected one of [${o.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(o.values).indexOf(Yr(n))===-1&&c.push(new Ke(t,n,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(n)} found`)),c}function Xu(r){return su(Li(r.value))?Ta(Ji({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ia(r)}function Ia(r){const t=r.value,n=r.key;if(dr(t)!=="array")return[new Ke(n,t,`array expected, ${dr(t)} found`)];const o=r.styleSpec;let c,m=[];if(t.length<1)return[new Ke(n,t,"filter array must have at least 1 element")];switch(m=m.concat(Ws({key:`${n}[0]`,value:t[0],valueSpec:o.filter_operator,style:r.style,styleSpec:r.styleSpec})),Yr(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Yr(t[1])==="$type"&&m.push(new Ke(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&m.push(new Ke(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(c=dr(t[1]),c!=="string"&&m.push(new Ke(`${n}[1]`,t[1],`string expected, ${c} found`)));for(let g=2;g<t.length;g++)c=dr(t[g]),Yr(t[1])==="$type"?m=m.concat(Ws({key:`${n}[${g}]`,value:t[g],valueSpec:o.geometry_type,style:r.style,styleSpec:r.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&m.push(new Ke(`${n}[${g}]`,t[g],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let g=1;g<t.length;g++)m=m.concat(Ia({key:`${n}[${g}]`,value:t[g],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":c=dr(t[1]),t.length!==2?m.push(new Ke(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):c!=="string"&&m.push(new Ke(`${n}[1]`,t[1],`string expected, ${c} found`))}return m}function Yu(r,t){const n=r.key,o=r.validateSpec,c=r.style,m=r.styleSpec,g=r.value,x=r.objectKey,S=m[`${t}_${r.layerType}`];if(!S)return[];const P=x.match(/^(.*)-transition$/);if(t==="paint"&&P&&S[P[1]]&&S[P[1]].transition)return o({key:n,value:g,valueSpec:m.transition,style:c,styleSpec:m});const z=r.valueSpec||S[x];if(!z)return[new Ke(n,g,`unknown property "${x}"`)];let L;if(dr(g)==="string"&&bo(z)&&!z.tokens&&(L=/^{([^}]+)}$/.exec(g)))return[new Ke(n,g,`"${x}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(L[1])} }\`.`)];const O=[];return r.layerType==="symbol"&&(x==="text-field"&&c&&!c.glyphs&&O.push(new Ke(n,g,'use of "text-field" requires a style "glyphs" property')),x==="text-font"&&dl(Li(g))&&Yr(g.type)==="identity"&&O.push(new Ke(n,g,'"text-font" does not support identity functions'))),O.concat(o({key:r.key,value:g,valueSpec:z,style:c,styleSpec:m,expressionContext:"property",propertyType:t,propertyKey:x}))}function yl(r){return Yu(r,"paint")}function ou(r){return Yu(r,"layout")}function Rr(r){let t=[];const n=r.value,o=r.key,c=r.style,m=r.styleSpec;n.type||n.ref||t.push(new Ke(o,n,'either "type" or "ref" is required'));let g=Yr(n.type);const x=Yr(n.ref);if(n.id){const S=Yr(n.id);for(let P=0;P<r.arrayIndex;P++){const z=c.layers[P];Yr(z.id)===S&&t.push(new Ke(o,n.id,`duplicate layer id "${n.id}", previously used at line ${z.id.__line__}`))}}if("ref"in n){let S;["type","source","source-layer","filter","layout"].forEach((P=>{P in n&&t.push(new Ke(o,n[P],`"${P}" is prohibited for ref layers`))})),c.layers.forEach((P=>{Yr(P.id)===x&&(S=P)})),S?S.ref?t.push(new Ke(o,n.ref,"ref cannot reference another ref layer")):g=Yr(S.type):t.push(new Ke(o,n.ref,`ref layer "${x}" not found`))}else if(g!=="background")if(n.source){const S=c.sources&&c.sources[n.source],P=S&&Yr(S.type);S?P==="vector"&&g==="raster"?t.push(new Ke(o,n.source,`layer "${n.id}" requires a raster source`)):P!=="raster-dem"&&g==="hillshade"?t.push(new Ke(o,n.source,`layer "${n.id}" requires a raster-dem source`)):P==="raster"&&g!=="raster"?t.push(new Ke(o,n.source,`layer "${n.id}" requires a vector source`)):P!=="vector"||n["source-layer"]?P==="raster-dem"&&g!=="hillshade"?t.push(new Ke(o,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):g!=="line"||!n.paint||!n.paint["line-gradient"]||P==="geojson"&&S.lineMetrics||t.push(new Ke(o,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Ke(o,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new Ke(o,n.source,`source "${n.source}" not found`))}else t.push(new Ke(o,n,'missing required property "source"'));return t=t.concat(ii({key:o,value:n,valueSpec:m.layer,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,objectElementValidators:{"*":()=>[],type:()=>r.validateSpec({key:`${o}.type`,value:n.type,valueSpec:m.layer.type,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,object:n,objectKey:"type"}),filter:Xu,layout:S=>ii({layer:n,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":P=>ou(Ji({layerType:g},P))}}),paint:S=>ii({layer:n,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":P=>yl(Ji({layerType:g},P))}})}})),t}function Xs(r){const t=r.value,n=r.key,o=dr(t);return o!=="string"?[new Ke(n,t,`string expected, ${o} found`)]:[]}const Qa={promoteId:function({key:r,value:t}){if(dr(t)==="string")return Xs({key:r,value:t});{const n=[];for(const o in t)n.push(...Xs({key:`${r}.${o}`,value:t[o]}));return n}}};function Ys(r){const t=r.value,n=r.key,o=r.styleSpec,c=r.style,m=r.validateSpec;if(!t.type)return[new Ke(n,t,'"type" is required')];const g=Yr(t.type);let x;switch(g){case"vector":case"raster":return x=ii({key:n,value:t,valueSpec:o[`source_${g.replace("-","_")}`],style:r.style,styleSpec:o,objectElementValidators:Qa,validateSpec:m}),x;case"raster-dem":return x=(function(S){var P;const z=(P=S.sourceName)!==null&&P!==void 0?P:"",L=S.value,O=S.styleSpec,V=O.source_raster_dem,q=S.style;let K=[];const ne=dr(L);if(L===void 0)return K;if(ne!=="object")return K.push(new Ke("source_raster_dem",L,`object expected, ${ne} found`)),K;const le=Yr(L.encoding)==="custom",we=["redFactor","greenFactor","blueFactor","baseShift"],de=S.value.encoding?`"${S.value.encoding}"`:"Default";for(const _e in L)!le&&we.includes(_e)?K.push(new Ke(_e,L[_e],`In "${z}": "${_e}" is only valid when "encoding" is set to "custom". ${de} encoding found`)):V[_e]?K=K.concat(S.validateSpec({key:_e,value:L[_e],valueSpec:V[_e],validateSpec:S.validateSpec,style:q,styleSpec:O})):K.push(new Ke(_e,L[_e],`unknown property "${_e}"`));return K})({sourceName:n,value:t,style:r.style,styleSpec:o,validateSpec:m}),x;case"geojson":if(x=ii({key:n,value:t,valueSpec:o.source_geojson,style:c,styleSpec:o,validateSpec:m,objectElementValidators:Qa}),t.cluster)for(const S in t.clusterProperties){const[P,z]=t.clusterProperties[S],L=typeof P=="string"?[P,["accumulated"],["get",S]]:P;x.push(...Ta({key:`${n}.${S}.map`,value:z,expressionContext:"cluster-map"})),x.push(...Ta({key:`${n}.${S}.reduce`,value:L,expressionContext:"cluster-reduce"}))}return x;case"video":return ii({key:n,value:t,valueSpec:o.source_video,style:c,validateSpec:m,styleSpec:o});case"image":return ii({key:n,value:t,valueSpec:o.source_image,style:c,validateSpec:m,styleSpec:o});case"canvas":return[new Ke(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ws({key:`${n}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function lu(r){const t=r.value,n=r.styleSpec,o=n.light,c=r.style;let m=[];const g=dr(t);if(t===void 0)return m;if(g!=="object")return m=m.concat([new Ke("light",t,`object expected, ${g} found`)]),m;for(const x in t){const S=x.match(/^(.*)-transition$/);m=m.concat(S&&o[S[1]]&&o[S[1]].transition?r.validateSpec({key:x,value:t[x],valueSpec:n.transition,validateSpec:r.validateSpec,style:c,styleSpec:n}):o[x]?r.validateSpec({key:x,value:t[x],valueSpec:o[x],validateSpec:r.validateSpec,style:c,styleSpec:n}):[new Ke(x,t[x],`unknown property "${x}"`)])}return m}function _l(r){const t=r.value,n=r.styleSpec,o=n.sky,c=r.style,m=dr(t);if(t===void 0)return[];if(m!=="object")return[new Ke("sky",t,`object expected, ${m} found`)];let g=[];for(const x in t)g=g.concat(o[x]?r.validateSpec({key:x,value:t[x],valueSpec:o[x],style:c,styleSpec:n}):[new Ke(x,t[x],`unknown property "${x}"`)]);return g}function eo(r){const t=r.value,n=r.styleSpec,o=n.terrain,c=r.style;let m=[];const g=dr(t);if(t===void 0)return m;if(g!=="object")return m=m.concat([new Ke("terrain",t,`object expected, ${g} found`)]),m;for(const x in t)m=m.concat(o[x]?r.validateSpec({key:x,value:t[x],valueSpec:o[x],validateSpec:r.validateSpec,style:c,styleSpec:n}):[new Ke(x,t[x],`unknown property "${x}"`)]);return m}function Eo(r){let t=[];const n=r.value,o=r.key;if(Array.isArray(n)){const c=[],m=[];for(const g in n)n[g].id&&c.includes(n[g].id)&&t.push(new Ke(o,n,`all the sprites' ids must be unique, but ${n[g].id} is duplicated`)),c.push(n[g].id),n[g].url&&m.includes(n[g].url)&&t.push(new Ke(o,n,`all the sprites' URLs must be unique, but ${n[g].url} is duplicated`)),m.push(n[g].url),t=t.concat(ii({key:`${o}[${g}]`,value:n[g],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:r.validateSpec}));return t}return Xs({key:o,value:n})}const Js={"*":()=>[],array:To,boolean:function(r){const t=r.value,n=r.key,o=dr(t);return o!=="boolean"?[new Ke(n,t,`boolean expected, ${o} found`)]:[]},number:Ms,color:function(r){const t=r.key,n=r.value,o=dr(n);return o!=="string"?[new Ke(t,n,`color expected, ${o} found`)]:Ut.parse(String(n))?[]:[new Ke(t,n,`color expected, "${n}" found`)]},constants:Wu,enum:Ws,filter:Xu,function:Io,layer:Rr,object:ii,source:Ys,light:lu,sky:_l,terrain:eo,projection:function(r){const t=r.value,n=r.styleSpec,o=n.projection,c=r.style,m=dr(t);if(t===void 0)return[];if(m!=="object")return[new Ke("projection",t,`object expected, ${m} found`)];let g=[];for(const x in t)g=g.concat(o[x]?r.validateSpec({key:x,value:t[x],valueSpec:o[x],style:c,styleSpec:n}):[new Ke(x,t[x],`unknown property "${x}"`)]);return g},string:Xs,formatted:function(r){return Xs(r).length===0?[]:Ta(r)},resolvedImage:function(r){return Xs(r).length===0?[]:Ta(r)},padding:function(r){const t=r.key,n=r.value;if(dr(n)==="array"){if(n.length<1||n.length>4)return[new Ke(t,n,`padding requires 1 to 4 values; ${n.length} values found`)];const o={type:"number"};let c=[];for(let m=0;m<n.length;m++)c=c.concat(r.validateSpec({key:`${t}[${m}]`,value:n[m],validateSpec:r.validateSpec,valueSpec:o}));return c}return Ms({key:t,value:n,valueSpec:{}})},variableAnchorOffsetCollection:function(r){const t=r.key,n=r.value,o=dr(n),c=r.styleSpec;if(o!=="array"||n.length<1||n.length%2!=0)return[new Ke(t,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let m=[];for(let g=0;g<n.length;g+=2)m=m.concat(Ws({key:`${t}[${g}]`,value:n[g],valueSpec:c.layout_symbol["text-anchor"]})),m=m.concat(To({key:`${t}[${g+1}]`,value:n[g+1],valueSpec:{length:2,value:"number"},validateSpec:r.validateSpec,style:r.style,styleSpec:c}));return m},sprite:Eo};function Po(r){const t=r.value,n=r.valueSpec,o=r.styleSpec;return r.validateSpec=Po,n.expression&&dl(Yr(t))?Io(r):n.expression&&Sa(Li(t))?Ta(r):n.type&&Js[n.type]?Js[n.type](r):ii(Ji({},r,{valueSpec:n.type?o[n.type]:n}))}function ih(r){const t=r.value,n=r.key,o=Xs(r);return o.length||(t.indexOf("{fontstack}")===-1&&o.push(new Ke(n,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&o.push(new Ke(n,t,'"glyphs" url must include a "{range}" token'))),o}function Ri(r,t=Ee){let n=[];return n=n.concat(Po({key:"",value:r,valueSpec:t.$root,styleSpec:t,style:r,validateSpec:Po,objectElementValidators:{glyphs:ih,"*":()=>[]}})),r.constants&&(n=n.concat(Wu({key:"constants",value:r.constants}))),Co(n)}function is(r){return function(t){return r({...t,validateSpec:Po})}}function Co(r){return[].concat(r).sort(((t,n)=>t.line-n.line))}function si(r){return function(...t){return Co(r.apply(this,t))}}Ri.source=si(is(Ys)),Ri.sprite=si(is(Eo)),Ri.glyphs=si(is(ih)),Ri.light=si(is(lu)),Ri.sky=si(is(_l)),Ri.terrain=si(is(eo)),Ri.layer=si(is(Rr)),Ri.filter=si(is(Xu)),Ri.paintProperty=si(is(yl)),Ri.layoutProperty=si(is(ou));const Qs=Ri,Ju=Qs.light,Qu=Qs.sky,uu=Qs.paintProperty,sh=Qs.layoutProperty;function cu(r,t){let n=!1;if(t&&t.length)for(const o of t)r.fire(new bs(new Error(o.message))),n=!0;return n}class Mo{constructor(t,n,o){const c=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const g=new Int32Array(this.arrayBuffer);t=g[0],this.d=(n=g[1])+2*(o=g[2]);for(let S=0;S<this.d*this.d;S++){const P=g[3+S],z=g[3+S+1];c.push(P===z?null:g.subarray(P,z))}const x=g[3+c.length+1];this.keys=g.subarray(g[3+c.length],x),this.bboxes=g.subarray(x),this.insert=this._insertReadonly}else{this.d=n+2*o;for(let g=0;g<this.d*this.d;g++)c.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=t,this.padding=o,this.scale=n/t,this.uid=0;const m=o/n*t;this.min=-m,this.max=t+m}insert(t,n,o,c,m){this._forEachCell(n,o,c,m,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(c),this.bboxes.push(m)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,n,o,c,m,g){this.cells[m].push(g)}query(t,n,o,c,m){const g=this.min,x=this.max;if(t<=g&&n<=g&&x<=o&&x<=c&&!m)return Array.prototype.slice.call(this.keys);{const S=[];return this._forEachCell(t,n,o,c,this._queryCell,S,{},m),S}}_queryCell(t,n,o,c,m,g,x,S){const P=this.cells[m];if(P!==null){const z=this.keys,L=this.bboxes;for(let O=0;O<P.length;O++){const V=P[O];if(x[V]===void 0){const q=4*V;(S?S(L[q+0],L[q+1],L[q+2],L[q+3]):t<=L[q+2]&&n<=L[q+3]&&o>=L[q+0]&&c>=L[q+1])?(x[V]=!0,g.push(z[V])):x[V]=!1}}}}_forEachCell(t,n,o,c,m,g,x,S){const P=this._convertToCellCoord(t),z=this._convertToCellCoord(n),L=this._convertToCellCoord(o),O=this._convertToCellCoord(c);for(let V=P;V<=L;V++)for(let q=z;q<=O;q++){const K=this.d*q+V;if((!S||S(this._convertFromCellCoord(V),this._convertFromCellCoord(q),this._convertFromCellCoord(V+1),this._convertFromCellCoord(q+1)))&&m.call(this,t,n,o,c,K,g,x,S))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,n=3+this.cells.length+1+1;let o=0;for(let g=0;g<this.cells.length;g++)o+=this.cells[g].length;const c=new Int32Array(n+o+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;let m=n;for(let g=0;g<t.length;g++){const x=t[g];c[3+g]=m,c.set(x,m),m+=x.length}return c[3+t.length]=m,c.set(this.keys,m),m+=this.keys.length,c[3+t.length+1]=m,c.set(this.bboxes,m),m+=this.bboxes.length,c.buffer}static serialize(t,n){const o=t.toArrayBuffer();return n&&n.push(o),{buffer:o}}static deserialize(t){return new Mo(t.buffer)}}const Bi={};function mt(r,t,n={}){if(Bi[r])throw new Error(`${r} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:r,writeable:!1}),Bi[r]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}mt("Object",Object),mt("TransferableGridIndex",Mo),mt("Color",Ut),mt("Error",Error),mt("AJAXError",cr),mt("ResolvedImage",Bn),mt("StylePropertyFunction",ka),mt("StyleExpression",ni,{omit:["_evaluator"]}),mt("ZoomDependentExpression",Ya),mt("ZoomConstantExpression",Xa),mt("CompoundExpression",xi,{omit:["_evaluate"]});for(const r in Ha)Ha[r]._classRegistryKey||mt(`Expression_${r}`,Ha[r]);function ss(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function hu(r){return r.$name||r.constructor._classRegistryKey}function to(r){return!(function(t){if(t===null||typeof t!="object")return!1;const n=hu(t);return!(!n||n==="Object")})(r)&&(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||r instanceof Error||ss(r)||Ht(r)||ArrayBuffer.isView(r)||r instanceof ImageData)}function Gn(r,t){if(to(r))return(ss(r)||Ht(r))&&t&&t.push(r),ArrayBuffer.isView(r)&&t&&t.push(r.buffer),r instanceof ImageData&&t&&t.push(r.data.buffer),r;if(Array.isArray(r)){const m=[];for(const g of r)m.push(Gn(g,t));return m}if(typeof r!="object")throw new Error("can't serialize object of type "+typeof r);const n=hu(r);if(!n)throw new Error(`can't serialize object of unregistered class ${r.constructor.name}`);if(!Bi[n])throw new Error(`${n} is not registered.`);const{klass:o}=Bi[n],c=o.serialize?o.serialize(r,t):{};if(o.serialize){if(t&&c===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const m in r){if(!r.hasOwnProperty(m)||Bi[n].omit.indexOf(m)>=0)continue;const g=r[m];c[m]=Bi[n].shallow.indexOf(m)>=0?g:Gn(g,t)}r instanceof Error&&(c.message=r.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(c.$name=n),c}function As(r){if(to(r))return r;if(Array.isArray(r))return r.map(As);if(typeof r!="object")throw new Error("can't deserialize object of type "+typeof r);const t=hu(r)||"Object";if(!Bi[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:n}=Bi[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(r);const o=Object.create(n.prototype);for(const c of Object.keys(r)){if(c==="$name")continue;const m=r[c];o[c]=Bi[t].shallow.indexOf(c)>=0?m:As(m)}return o}class as{constructor(){this.first=!0}update(t,n){const o=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=n),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=o,!0))}}const or={"Latin-1 Supplement":r=>r>=128&&r<=255,"Hangul Jamo":r=>r>=4352&&r<=4607,Khmer:r=>r>=6016&&r<=6143,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Katakana:r=>r>=12448&&r<=12543,Kanbun:r=>r>=12688&&r<=12703,"CJK Strokes":r=>r>=12736&&r<=12783,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"Private Use Area":r=>r>=57344&&r<=63743,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519};function ec(r){for(const t of r)if(wl(t.charCodeAt(0)))return!0;return!1}function od(r){for(const t of r)if(!os(t.charCodeAt(0)))return!1;return!0}function ea(r){const t=r.map((n=>{try{return new RegExp(`\\p{sc=${n}}`,"u").source}catch{return null}})).filter((n=>n));return new RegExp(t.join("|"),"u")}const vl=ea(["Arab","Dupl","Mong","Ougr","Syrc"]);function os(r){return!vl.test(String.fromCodePoint(r))}const xl=ea(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function wl(r){return!(r!==746&&r!==747&&(r<4352||!(or["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||or["CJK Compatibility"](r)||or["CJK Strokes"](r)||!(!or["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||or["Enclosed CJK Letters and Months"](r)||or["Ideographic Description Characters"](r)||or.Kanbun(r)||or.Katakana(r)&&r!==12540||!(!or["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!or["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||or["Vertical Forms"](r)||or["Yijing Hexagram Symbols"](r)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(r))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(r))||xl.test(String.fromCodePoint(r)))))}function ro(r){return!(wl(r)||(function(t){return!!(or["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||or["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||or["Letterlike Symbols"](t)||or["Number Forms"](t)||or["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||or["Control Pictures"](t)&&t!==9251||or["Optical Character Recognition"](t)||or["Enclosed Alphanumerics"](t)||or["Geometric Shapes"](t)||or["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||or["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||or["CJK Symbols and Punctuation"](t)||or.Katakana(t)||or["Private Use Area"](t)||or["CJK Compatibility Forms"](t)||or["Small Form Variants"](t)||or["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)})(r))}const Ea=ea(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Br(r){return Ea.test(String.fromCodePoint(r))}function jr(r,t){return!(!t&&Br(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||or.Khmer(r))}function Pa(r){for(const t of r)if(Br(t.charCodeAt(0)))return!0;return!1}const Cr=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(r){this.pluginStatus=r.pluginStatus,this.pluginURL=r.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(r){this.applyArabicShaping=r.applyArabicShaping,this.processBidirectionalText=r.processBidirectionalText,this.processStyledBidirectionalText=r.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class ur{constructor(t,n){this.zoom=t,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new as,this.transition={})}isSupportedScript(t){return(function(n,o){for(const c of n)if(!jr(c.charCodeAt(0),o))return!1;return!0})(t,Cr.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,n=t-Math.floor(t),o=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*n}}}class Fi{constructor(t,n){this.property=t,this.value=n,this.expression=(function(o,c){if(dl(o))return new ka(o,c);if(Sa(o)){const m=iu(o,c);if(m.result==="error")throw new Error(m.value.map((g=>`${g.key}: ${g.message}`)).join(", "));return m.value}{let m=o;return c.type==="color"&&typeof o=="string"?m=Ut.parse(o):c.type!=="padding"||typeof o!="number"&&!Array.isArray(o)?c.type==="variableAnchorOffsetCollection"&&Array.isArray(o)&&(m=_i.parse(o)):m=Rn.parse(o),{kind:"constant",evaluate:()=>m}}})(n===void 0?t.specification.default:n,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,n,o){return this.property.possiblyEvaluate(this,t,n,o)}}class ta{constructor(t){this.property=t,this.value=new Fi(t,void 0)}transitioned(t,n){return new bl(this.property,this.value,n,je({},t.transition,this.transition),t.now)}untransitioned(){return new bl(this.property,this.value,null,{},0)}}class Cn{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return vt(this._values[t].value.value)}setValue(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new ta(this._values[t].property)),this._values[t].value=new Fi(this._values[t].property,n===null?void 0:vt(n))}getTransition(t){return vt(this._values[t].transition)}setTransition(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new ta(this._values[t].property)),this._values[t].transition=vt(n)||void 0}serialize(){const t={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(t[n]=o);const c=this.getTransition(n);c!==void 0&&(t[`${n}-transition`]=c)}return t}transitioned(t,n){const o=new Ao(this._properties);for(const c of Object.keys(this._values))o._values[c]=this._values[c].transitioned(t,n._values[c]);return o}untransitioned(){const t=new Ao(this._properties);for(const n of Object.keys(this._values))t._values[n]=this._values[n].untransitioned();return t}}class bl{constructor(t,n,o,c,m){this.property=t,this.value=n,this.begin=m+c.delay||0,this.end=this.begin+c.duration||0,t.specification.transition&&(c.delay||c.duration)&&(this.prior=o)}possiblyEvaluate(t,n,o){const c=t.now||0,m=this.value.possiblyEvaluate(t,n,o),g=this.prior;if(g){if(c>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(c<this.begin)return g.possiblyEvaluate(t,n,o);{const x=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(t,n,o),m,(function(S){if(S<=0)return 0;if(S>=1)return 1;const P=S*S,z=P*S;return 4*(S<.5?z:3*(S-P)+z-.75)})(x))}}return m}}class Ao{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,n,o){const c=new Do(this._properties);for(const m of Object.keys(this._values))c._values[m]=this._values[m].possiblyEvaluate(t,n,o);return c}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class zo{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return vt(this._values[t].value)}setValue(t,n){this._values[t]=new Fi(this._values[t].property,n===null?void 0:vt(n))}serialize(){const t={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(t[n]=o)}return t}possiblyEvaluate(t,n,o){const c=new Do(this._properties);for(const m of Object.keys(this._values))c._values[m]=this._values[m].possiblyEvaluate(t,n,o);return c}}class wi{constructor(t,n,o){this.property=t,this.value=n,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,n,o,c){return this.property.evaluate(this.value,this.parameters,t,n,o,c)}}class Do{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class gt{constructor(t){this.specification=t}possiblyEvaluate(t,n){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(n)}interpolate(t,n,o){const c=on[this.specification.type];return c?c(t,n,o):t}}class At{constructor(t,n){this.specification=t,this.overrides=n}possiblyEvaluate(t,n,o,c){return new wi(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(n,null,{},o,c)}:t.expression,n)}interpolate(t,n,o){if(t.value.kind!=="constant"||n.value.kind!=="constant")return t;if(t.value.value===void 0||n.value.value===void 0)return new wi(this,{kind:"constant",value:void 0},t.parameters);const c=on[this.specification.type];if(c){const m=c(t.value.value,n.value.value,o);return new wi(this,{kind:"constant",value:m},t.parameters)}return t}evaluate(t,n,o,c,m,g){return t.kind==="constant"?t.value:t.evaluate(n,o,c,m,g)}}class Lo extends At{possiblyEvaluate(t,n,o,c){if(t.value===void 0)return new wi(this,{kind:"constant",value:void 0},n);if(t.expression.kind==="constant"){const m=t.expression.evaluate(n,null,{},o,c),g=t.property.specification.type==="resolvedImage"&&typeof m!="string"?m.name:m,x=this._calculate(g,g,g,n);return new wi(this,{kind:"constant",value:x},n)}if(t.expression.kind==="camera"){const m=this._calculate(t.expression.evaluate({zoom:n.zoom-1}),t.expression.evaluate({zoom:n.zoom}),t.expression.evaluate({zoom:n.zoom+1}),n);return new wi(this,{kind:"constant",value:m},n)}return new wi(this,t.expression,n)}evaluate(t,n,o,c,m,g){if(t.kind==="source"){const x=t.evaluate(n,o,c,m,g);return this._calculate(x,x,x,n)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(n.zoom)-1},o,c),t.evaluate({zoom:Math.floor(n.zoom)},o,c),t.evaluate({zoom:Math.floor(n.zoom)+1},o,c),n):t.value}_calculate(t,n,o,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:o,to:n}}interpolate(t){return t}}class Sl{constructor(t){this.specification=t}possiblyEvaluate(t,n,o,c){if(t.value!==void 0){if(t.expression.kind==="constant"){const m=t.expression.evaluate(n,null,{},o,c);return this._calculate(m,m,m,n)}return this._calculate(t.expression.evaluate(new ur(Math.floor(n.zoom-1),n)),t.expression.evaluate(new ur(Math.floor(n.zoom),n)),t.expression.evaluate(new ur(Math.floor(n.zoom+1),n)),n)}}_calculate(t,n,o,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:o,to:n}}interpolate(t){return t}}class tc{constructor(t){this.specification=t}possiblyEvaluate(t,n,o,c){return!!t.expression.evaluate(n,null,{},o,c)}interpolate(){return!1}}class f{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in t){const o=t[n];o.specification.overridable&&this.overridableProperties.push(n);const c=this.defaultPropertyValues[n]=new Fi(o,void 0),m=this.defaultTransitionablePropertyValues[n]=new ta(o);this.defaultTransitioningPropertyValues[n]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=c.possiblyEvaluate({})}}}mt("DataDrivenProperty",At),mt("DataConstantProperty",gt),mt("CrossFadedDataDrivenProperty",Lo),mt("CrossFadedProperty",Sl),mt("ColorRampProperty",tc);const e="-transition";class s extends Ba{constructor(t,n){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),n.layout&&(this._unevaluatedLayout=new zo(n.layout)),n.paint)){this._transitionablePaint=new Cn(n.paint);for(const o in t.paint)this.setPaintProperty(o,t.paint[o],{validate:!1});for(const o in t.layout)this.setLayoutProperty(o,t.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Do(n.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,n,o={}){n!=null&&this._validate(sh,`layers.${this.id}.layout.${t}`,t,n,o)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,n):this.visibility=n)}getPaintProperty(t){return t.endsWith(e)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,n,o={}){if(n!=null&&this._validate(uu,`layers.${this.id}.paint.${t}`,t,n,o))return!1;if(t.endsWith(e))return this._transitionablePaint.setTransition(t.slice(0,-11),n||void 0),!1;{const c=this._transitionablePaint._values[t],m=c.property.specification["property-type"]==="cross-faded-data-driven",g=c.value.isDataDriven(),x=c.value;this._transitionablePaint.setValue(t,n),this._handleSpecialPaintPropertyUpdate(t);const S=this._transitionablePaint._values[t].value;return S.isDataDriven()||g||m||this._handleOverridablePaintPropertyUpdate(t,x,S)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,n,o){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,n){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,n)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),tr(t,((n,o)=>!(n===void 0||o==="layout"&&!Object.keys(n).length||o==="paint"&&!Object.keys(n).length)))}_validate(t,n,o,c,m={}){return(!m||m.validate!==!1)&&cu(this,t.call(Qs,{key:n,layerType:this.type,objectKey:o,value:c,styleSpec:Ee,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const n=this.paint.get(t);if(n instanceof wi&&bo(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}const l={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class u{constructor(t,n){this._structArray=t,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class p{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,n){return t._trim(),n&&(t.isTransferred=!0,n.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const n=Object.create(this.prototype);return n.arrayBuffer=t.arrayBuffer,n.length=t.length,n.capacity=t.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function w(r,t=1){let n=0,o=0;return{members:r.map((c=>{const m=l[c.type].BYTES_PER_ELEMENT,g=n=k(n,Math.max(t,m)),x=c.components||1;return o=Math.max(o,m),n+=m*x,{name:c.name,type:c.type,components:x,offset:g}})),size:k(n,Math.max(o,t)),alignment:t}}function k(r,t){return Math.ceil(r/t)*t}class E extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const c=2*t;return this.int16[c+0]=n,this.int16[c+1]=o,t}}E.prototype.bytesPerElement=4,mt("StructArrayLayout2i4",E);class A extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,o)}emplace(t,n,o,c){const m=3*t;return this.int16[m+0]=n,this.int16[m+1]=o,this.int16[m+2]=c,t}}A.prototype.bytesPerElement=6,mt("StructArrayLayout3i6",A);class R extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,c){const m=this.length;return this.resize(m+1),this.emplace(m,t,n,o,c)}emplace(t,n,o,c,m){const g=4*t;return this.int16[g+0]=n,this.int16[g+1]=o,this.int16[g+2]=c,this.int16[g+3]=m,t}}R.prototype.bytesPerElement=8,mt("StructArrayLayout4i8",R);class B extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g){const x=this.length;return this.resize(x+1),this.emplace(x,t,n,o,c,m,g)}emplace(t,n,o,c,m,g,x){const S=6*t;return this.int16[S+0]=n,this.int16[S+1]=o,this.int16[S+2]=c,this.int16[S+3]=m,this.int16[S+4]=g,this.int16[S+5]=x,t}}B.prototype.bytesPerElement=12,mt("StructArrayLayout2i4i12",B);class U extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g){const x=this.length;return this.resize(x+1),this.emplace(x,t,n,o,c,m,g)}emplace(t,n,o,c,m,g,x){const S=4*t,P=8*t;return this.int16[S+0]=n,this.int16[S+1]=o,this.uint8[P+4]=c,this.uint8[P+5]=m,this.uint8[P+6]=g,this.uint8[P+7]=x,t}}U.prototype.bytesPerElement=8,mt("StructArrayLayout2i4ub8",U);class G extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const c=2*t;return this.float32[c+0]=n,this.float32[c+1]=o,t}}G.prototype.bytesPerElement=8,mt("StructArrayLayout2f8",G);class W extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g,x,S,P,z){const L=this.length;return this.resize(L+1),this.emplace(L,t,n,o,c,m,g,x,S,P,z)}emplace(t,n,o,c,m,g,x,S,P,z,L){const O=10*t;return this.uint16[O+0]=n,this.uint16[O+1]=o,this.uint16[O+2]=c,this.uint16[O+3]=m,this.uint16[O+4]=g,this.uint16[O+5]=x,this.uint16[O+6]=S,this.uint16[O+7]=P,this.uint16[O+8]=z,this.uint16[O+9]=L,t}}W.prototype.bytesPerElement=20,mt("StructArrayLayout10ui20",W);class J extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g,x,S,P,z,L,O){const V=this.length;return this.resize(V+1),this.emplace(V,t,n,o,c,m,g,x,S,P,z,L,O)}emplace(t,n,o,c,m,g,x,S,P,z,L,O,V){const q=12*t;return this.int16[q+0]=n,this.int16[q+1]=o,this.int16[q+2]=c,this.int16[q+3]=m,this.uint16[q+4]=g,this.uint16[q+5]=x,this.uint16[q+6]=S,this.uint16[q+7]=P,this.int16[q+8]=z,this.int16[q+9]=L,this.int16[q+10]=O,this.int16[q+11]=V,t}}J.prototype.bytesPerElement=24,mt("StructArrayLayout4i4ui4i24",J);class re extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,o)}emplace(t,n,o,c){const m=3*t;return this.float32[m+0]=n,this.float32[m+1]=o,this.float32[m+2]=c,t}}re.prototype.bytesPerElement=12,mt("StructArrayLayout3f12",re);class se extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint32[1*t+0]=n,t}}se.prototype.bytesPerElement=4,mt("StructArrayLayout1ul4",se);class ce extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g,x,S,P){const z=this.length;return this.resize(z+1),this.emplace(z,t,n,o,c,m,g,x,S,P)}emplace(t,n,o,c,m,g,x,S,P,z){const L=10*t,O=5*t;return this.int16[L+0]=n,this.int16[L+1]=o,this.int16[L+2]=c,this.int16[L+3]=m,this.int16[L+4]=g,this.int16[L+5]=x,this.uint32[O+3]=S,this.uint16[L+8]=P,this.uint16[L+9]=z,t}}ce.prototype.bytesPerElement=20,mt("StructArrayLayout6i1ul2ui20",ce);class ee extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g){const x=this.length;return this.resize(x+1),this.emplace(x,t,n,o,c,m,g)}emplace(t,n,o,c,m,g,x){const S=6*t;return this.int16[S+0]=n,this.int16[S+1]=o,this.int16[S+2]=c,this.int16[S+3]=m,this.int16[S+4]=g,this.int16[S+5]=x,t}}ee.prototype.bytesPerElement=12,mt("StructArrayLayout2i2i2i12",ee);class fe extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m){const g=this.length;return this.resize(g+1),this.emplace(g,t,n,o,c,m)}emplace(t,n,o,c,m,g){const x=4*t,S=8*t;return this.float32[x+0]=n,this.float32[x+1]=o,this.float32[x+2]=c,this.int16[S+6]=m,this.int16[S+7]=g,t}}fe.prototype.bytesPerElement=16,mt("StructArrayLayout2f1f2i16",fe);class ye extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g){const x=this.length;return this.resize(x+1),this.emplace(x,t,n,o,c,m,g)}emplace(t,n,o,c,m,g,x){const S=16*t,P=4*t,z=8*t;return this.uint8[S+0]=n,this.uint8[S+1]=o,this.float32[P+1]=c,this.float32[P+2]=m,this.int16[z+6]=g,this.int16[z+7]=x,t}}ye.prototype.bytesPerElement=16,mt("StructArrayLayout2ub2f2i16",ye);class be extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,o)}emplace(t,n,o,c){const m=3*t;return this.uint16[m+0]=n,this.uint16[m+1]=o,this.uint16[m+2]=c,t}}be.prototype.bytesPerElement=6,mt("StructArrayLayout3ui6",be);class Fe extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g,x,S,P,z,L,O,V,q,K,ne,le){const we=this.length;return this.resize(we+1),this.emplace(we,t,n,o,c,m,g,x,S,P,z,L,O,V,q,K,ne,le)}emplace(t,n,o,c,m,g,x,S,P,z,L,O,V,q,K,ne,le,we){const de=24*t,_e=12*t,Ae=48*t;return this.int16[de+0]=n,this.int16[de+1]=o,this.uint16[de+2]=c,this.uint16[de+3]=m,this.uint32[_e+2]=g,this.uint32[_e+3]=x,this.uint32[_e+4]=S,this.uint16[de+10]=P,this.uint16[de+11]=z,this.uint16[de+12]=L,this.float32[_e+7]=O,this.float32[_e+8]=V,this.uint8[Ae+36]=q,this.uint8[Ae+37]=K,this.uint8[Ae+38]=ne,this.uint32[_e+10]=le,this.int16[de+22]=we,t}}Fe.prototype.bytesPerElement=48,mt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Fe);class Ge extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g,x,S,P,z,L,O,V,q,K,ne,le,we,de,_e,Ae,Ue,pt,Lt,dt,ot,kt,xt){const yt=this.length;return this.resize(yt+1),this.emplace(yt,t,n,o,c,m,g,x,S,P,z,L,O,V,q,K,ne,le,we,de,_e,Ae,Ue,pt,Lt,dt,ot,kt,xt)}emplace(t,n,o,c,m,g,x,S,P,z,L,O,V,q,K,ne,le,we,de,_e,Ae,Ue,pt,Lt,dt,ot,kt,xt,yt){const Be=32*t,It=16*t;return this.int16[Be+0]=n,this.int16[Be+1]=o,this.int16[Be+2]=c,this.int16[Be+3]=m,this.int16[Be+4]=g,this.int16[Be+5]=x,this.int16[Be+6]=S,this.int16[Be+7]=P,this.uint16[Be+8]=z,this.uint16[Be+9]=L,this.uint16[Be+10]=O,this.uint16[Be+11]=V,this.uint16[Be+12]=q,this.uint16[Be+13]=K,this.uint16[Be+14]=ne,this.uint16[Be+15]=le,this.uint16[Be+16]=we,this.uint16[Be+17]=de,this.uint16[Be+18]=_e,this.uint16[Be+19]=Ae,this.uint16[Be+20]=Ue,this.uint16[Be+21]=pt,this.uint16[Be+22]=Lt,this.uint32[It+12]=dt,this.float32[It+13]=ot,this.float32[It+14]=kt,this.uint16[Be+30]=xt,this.uint16[Be+31]=yt,t}}Ge.prototype.bytesPerElement=64,mt("StructArrayLayout8i15ui1ul2f2ui64",Ge);class Qe extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.float32[1*t+0]=n,t}}Qe.prototype.bytesPerElement=4,mt("StructArrayLayout1f4",Qe);class ct extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,o)}emplace(t,n,o,c){const m=3*t;return this.uint16[6*t+0]=n,this.float32[m+1]=o,this.float32[m+2]=c,t}}ct.prototype.bytesPerElement=12,mt("StructArrayLayout1ui2f12",ct);class tt extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,o)}emplace(t,n,o,c){const m=4*t;return this.uint32[2*t+0]=n,this.uint16[m+2]=o,this.uint16[m+3]=c,t}}tt.prototype.bytesPerElement=8,mt("StructArrayLayout1ul2ui8",tt);class Xe extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const c=2*t;return this.uint16[c+0]=n,this.uint16[c+1]=o,t}}Xe.prototype.bytesPerElement=4,mt("StructArrayLayout2ui4",Xe);class _t extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint16[1*t+0]=n,t}}_t.prototype.bytesPerElement=2,mt("StructArrayLayout1ui2",_t);class Nt extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,c){const m=this.length;return this.resize(m+1),this.emplace(m,t,n,o,c)}emplace(t,n,o,c,m){const g=4*t;return this.float32[g+0]=n,this.float32[g+1]=o,this.float32[g+2]=c,this.float32[g+3]=m,t}}Nt.prototype.bytesPerElement=16,mt("StructArrayLayout4f16",Nt);class nt extends u{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Y(this.anchorPointX,this.anchorPointY)}}nt.prototype.size=20;class st extends ce{get(t){return new nt(this,t)}}mt("CollisionBoxArray",st);class Ot extends u{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Ot.prototype.size=48;class Pr extends Fe{get(t){return new Ot(this,t)}}mt("PlacedSymbolArray",Pr);class Gt extends u{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Gt.prototype.size=64;class Qt extends Ge{get(t){return new Gt(this,t)}}mt("SymbolInstanceArray",Qt);class Mr extends Qe{getoffsetX(t){return this.float32[1*t+0]}}mt("GlyphOffsetArray",Mr);class Tn extends A{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}mt("SymbolLineVertexArray",Tn);class bi extends u{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}bi.prototype.size=12;class Ar extends ct{get(t){return new bi(this,t)}}mt("TextAnchorOffsetArray",Ar);class _n extends u{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}_n.prototype.size=8;class Vr extends tt{get(t){return new _n(this,t)}}mt("FeatureIndexArray",Vr);class rn extends E{}class Mn extends E{}class ls extends E{}class ai extends B{}class us extends U{}class Ca extends G{}class Si extends W{}class Oi extends J{}class zs extends re{}class Hn extends se{}class ki extends ee{}class cs extends ye{}class Ni extends be{}class ln extends Xe{}const qr=w([{name:"a_pos",components:2,type:"Int16"}],4),{members:An}=qr;class nr{constructor(t=[]){this.segments=t}prepareSegment(t,n,o,c){let m=this.segments[this.segments.length-1];return t>nr.MAX_VERTEX_ARRAY_LENGTH&&Rt(`Max vertices per segment is ${nr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!m||m.vertexLength+t>nr.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==c)&&(m={vertexOffset:n.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0},c!==void 0&&(m.sortKey=c),this.segments.push(m)),m}get(){return this.segments}destroy(){for(const t of this.segments)for(const n in t.vaos)t.vaos[n].destroy()}static simpleSegment(t,n,o,c){return new nr([{vertexOffset:t,primitiveOffset:n,vertexLength:o,primitiveLength:c,vaos:{},sortKey:0}])}}function Ti(r,t){return 256*(r=Je(Math.floor(r),0,255))+Je(Math.floor(t),0,255)}nr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,mt("SegmentVector",nr);const Ma=w([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var hs={exports:{}},rc={exports:{}};rc.exports=function(r,t){var n,o,c,m,g,x,S,P;for(o=r.length-(n=3&r.length),c=t,g=3432918353,x=461845907,P=0;P<o;)S=255&r.charCodeAt(P)|(255&r.charCodeAt(++P))<<8|(255&r.charCodeAt(++P))<<16|(255&r.charCodeAt(++P))<<24,++P,c=27492+(65535&(m=5*(65535&(c=(c^=S=(65535&(S=(S=(65535&S)*g+(((S>>>16)*g&65535)<<16)&4294967295)<<15|S>>>17))*x+(((S>>>16)*x&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(S=0,n){case 3:S^=(255&r.charCodeAt(P+2))<<16;case 2:S^=(255&r.charCodeAt(P+1))<<8;case 1:c^=S=(65535&(S=(S=(65535&(S^=255&r.charCodeAt(P)))*g+(((S>>>16)*g&65535)<<16)&4294967295)<<15|S>>>17))*x+(((S>>>16)*x&65535)<<16)&4294967295}return c^=r.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0};var nc=rc.exports,Hr={exports:{}};Hr.exports=function(r,t){for(var n,o=r.length,c=t^o,m=0;o>=4;)n=1540483477*(65535&(n=255&r.charCodeAt(m)|(255&r.charCodeAt(++m))<<8|(255&r.charCodeAt(++m))<<16|(255&r.charCodeAt(++m))<<24))+((1540483477*(n>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),o-=4,++m;switch(o){case 3:c^=(255&r.charCodeAt(m+2))<<16;case 2:c^=(255&r.charCodeAt(m+1))<<8;case 1:c=1540483477*(65535&(c^=255&r.charCodeAt(m)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0};var ds=nc,du=Hr.exports;hs.exports=ds,hs.exports.murmur3=ds,hs.exports.murmur2=du;var Ro=X(hs.exports);class Aa{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,n,o,c){this.ids.push(Bo(t)),this.positions.push(n,o,c)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=Bo(t);let o=0,c=this.ids.length-1;for(;o<c;){const g=o+c>>1;this.ids[g]>=n?c=g:o=g+1}const m=[];for(;this.ids[o]===n;)m.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return m}static serialize(t,n){const o=new Float64Array(t.ids),c=new Uint32Array(t.positions);return Ds(o,c,0,o.length-1),n&&n.push(o.buffer,c.buffer),{ids:o,positions:c}}static deserialize(t){const n=new Aa;return n.ids=t.ids,n.positions=t.positions,n.indexed=!0,n}}function Bo(r){const t=+r;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Ro(String(r))}function Ds(r,t,n,o){for(;n<o;){const c=r[n+o>>1];let m=n-1,g=o+1;for(;;){do m++;while(r[m]<c);do g--;while(r[g]>c);if(m>=g)break;zr(r,m,g),zr(t,3*m,3*g),zr(t,3*m+1,3*g+1),zr(t,3*m+2,3*g+2)}g-n<o-g?(Ds(r,t,n,g),n=g+1):(Ds(r,t,g+1,o),o=g)}}function zr(r,t,n){const o=r[t];r[t]=r[n],r[n]=o}mt("FeaturePositionMap",Aa);class Jr{constructor(t,n){this.gl=t.gl,this.location=n}}class vn extends Jr{constructor(t,n){super(t,n),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class ic extends Jr{constructor(t,n){super(t,n),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class pu extends Jr{constructor(t,n){super(t,n),this.current=Ut.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const sc=new Float32Array(16);function ld(r){return[Ti(255*r.r,255*r.g),Ti(255*r.b,255*r.a)]}class In{constructor(t,n,o){this.value=t,this.uniformNames=n.map((c=>`u_${c}`)),this.type=o}setUniform(t,n,o){t.set(o.constantOr(this.value))}getBinding(t,n,o){return this.type==="color"?new pu(t,n):new vn(t,n)}}class Fo{constructor(t,n){this.uniformNames=n.map((o=>`u_${o}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=t.tlbr}setUniform(t,n,o,c){const m=c==="u_pattern_to"?this.patternTo:c==="u_pattern_from"?this.patternFrom:c==="u_pixel_ratio_to"?this.pixelRatioTo:c==="u_pixel_ratio_from"?this.pixelRatioFrom:null;m&&t.set(m)}getBinding(t,n,o){return o.substr(0,9)==="u_pattern"?new ic(t,n):new vn(t,n)}}class ra{constructor(t,n,o,c){this.expression=t,this.type=o,this.maxValue=0,this.paintVertexAttributes=n.map((m=>({name:`a_${m}`,type:"Float32",components:o==="color"?2:1,offset:0}))),this.paintVertexArray=new c}populatePaintArray(t,n,o,c,m){const g=this.paintVertexArray.length,x=this.expression.evaluate(new ur(0),n,{},c,[],m);this.paintVertexArray.resize(t),this._setPaintValue(g,t,x)}updatePaintArray(t,n,o,c){const m=this.expression.evaluate({zoom:0},o,c);this._setPaintValue(t,n,m)}_setPaintValue(t,n,o){if(this.type==="color"){const c=ld(o);for(let m=t;m<n;m++)this.paintVertexArray.emplace(m,c[0],c[1])}else{for(let c=t;c<n;c++)this.paintVertexArray.emplace(c,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ps{constructor(t,n,o,c,m,g){this.expression=t,this.uniformNames=n.map((x=>`u_${x}_t`)),this.type=o,this.useIntegerZoom=c,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=n.map((x=>({name:`a_${x}`,type:"Float32",components:o==="color"?4:2,offset:0}))),this.paintVertexArray=new g}populatePaintArray(t,n,o,c,m){const g=this.expression.evaluate(new ur(this.zoom),n,{},c,[],m),x=this.expression.evaluate(new ur(this.zoom+1),n,{},c,[],m),S=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(S,t,g,x)}updatePaintArray(t,n,o,c){const m=this.expression.evaluate({zoom:this.zoom},o,c),g=this.expression.evaluate({zoom:this.zoom+1},o,c);this._setPaintValue(t,n,m,g)}_setPaintValue(t,n,o,c){if(this.type==="color"){const m=ld(o),g=ld(c);for(let x=t;x<n;x++)this.paintVertexArray.emplace(x,m[0],m[1],g[0],g[1])}else{for(let m=t;m<n;m++)this.paintVertexArray.emplace(m,o,c);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(c))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,n){const o=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,c=Je(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);t.set(c)}getBinding(t,n,o){return new vn(t,n)}}class Kn{constructor(t,n,o,c,m,g){this.expression=t,this.type=n,this.useIntegerZoom=o,this.zoom=c,this.layerId=g,this.zoomInPaintVertexArray=new m,this.zoomOutPaintVertexArray=new m}populatePaintArray(t,n,o){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(c,t,n.patterns&&n.patterns[this.layerId],o)}updatePaintArray(t,n,o,c,m){this._setPaintValues(t,n,o.patterns&&o.patterns[this.layerId],m)}_setPaintValues(t,n,o,c){if(!c||!o)return;const{min:m,mid:g,max:x}=o,S=c[m],P=c[g],z=c[x];if(S&&P&&z)for(let L=t;L<n;L++)this.zoomInPaintVertexArray.emplace(L,P.tl[0],P.tl[1],P.br[0],P.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],P.pixelRatio,S.pixelRatio),this.zoomOutPaintVertexArray.emplace(L,P.tl[0],P.tl[1],P.br[0],P.br[1],z.tl[0],z.tl[1],z.br[0],z.br[1],P.pixelRatio,z.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Ma.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Ma.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class fs{constructor(t,n,o){this.binders={},this._buffers=[];const c=[];for(const m in t.paint._values){if(!o(m))continue;const g=t.paint.get(m);if(!(g instanceof wi&&bo(g.property.specification)))continue;const x=ud(m,t.type),S=g.value,P=g.property.specification.type,z=g.property.useIntegerZoom,L=g.property.specification["property-type"],O=L==="cross-faded"||L==="cross-faded-data-driven";if(S.kind==="constant")this.binders[m]=O?new Fo(S.value,x):new In(S.value,x,P),c.push(`/u_${m}`);else if(S.kind==="source"||O){const V=ah(m,P,"source");this.binders[m]=O?new Kn(S,P,z,n,V,t.id):new ra(S,x,P,V),c.push(`/a_${m}`)}else{const V=ah(m,P,"composite");this.binders[m]=new ps(S,x,P,z,n,V),c.push(`/z_${m}`)}}this.cacheKey=c.sort().join("")}getMaxValue(t){const n=this.binders[t];return n instanceof ra||n instanceof ps?n.maxValue:0}populatePaintArrays(t,n,o,c,m){for(const g in this.binders){const x=this.binders[g];(x instanceof ra||x instanceof ps||x instanceof Kn)&&x.populatePaintArray(t,n,o,c,m)}}setConstantPatternPositions(t,n){for(const o in this.binders){const c=this.binders[o];c instanceof Fo&&c.setConstantPatternPositions(t,n)}}updatePaintArrays(t,n,o,c,m){let g=!1;for(const x in t){const S=n.getPositions(x);for(const P of S){const z=o.feature(P.index);for(const L in this.binders){const O=this.binders[L];if((O instanceof ra||O instanceof ps||O instanceof Kn)&&O.expression.isStateDependent===!0){const V=c.paint.get(L);O.expression=V.value,O.updatePaintArray(P.start,P.end,z,t[x],m),g=!0}}}}return g}defines(){const t=[];for(const n in this.binders){const o=this.binders[n];(o instanceof In||o instanceof Fo)&&t.push(...o.uniformNames.map((c=>`#define HAS_UNIFORM_${c}`)))}return t}getBinderAttributes(){const t=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof ra||o instanceof ps)for(let c=0;c<o.paintVertexAttributes.length;c++)t.push(o.paintVertexAttributes[c].name);else if(o instanceof Kn)for(let c=0;c<Ma.members.length;c++)t.push(Ma.members[c].name)}return t}getBinderUniforms(){const t=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof In||o instanceof Fo||o instanceof ps)for(const c of o.uniformNames)t.push(c)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,n){const o=[];for(const c in this.binders){const m=this.binders[c];if(m instanceof In||m instanceof Fo||m instanceof ps){for(const g of m.uniformNames)if(n[g]){const x=m.getBinding(t,n[g],g);o.push({name:g,property:c,binding:x})}}}return o}setUniforms(t,n,o,c){for(const{name:m,property:g,binding:x}of n)this.binders[g].setUniform(x,c,o.get(g),m)}updatePaintBuffers(t){this._buffers=[];for(const n in this.binders){const o=this.binders[n];if(t&&o instanceof Kn){const c=t.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(o instanceof ra||o instanceof ps)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(t){for(const n in this.binders){const o=this.binders[n];(o instanceof ra||o instanceof ps||o instanceof Kn)&&o.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const n=this.binders[t];(n instanceof ra||n instanceof ps||n instanceof Kn)&&n.destroy()}}}class na{constructor(t,n,o=(()=>!0)){this.programConfigurations={};for(const c of t)this.programConfigurations[c.id]=new fs(c,n,o);this.needsUpload=!1,this._featureMap=new Aa,this._bufferOffset=0}populatePaintArrays(t,n,o,c,m,g){for(const x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(t,n,c,m,g);n.id!==void 0&&this._featureMap.add(n.id,o,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,n,o,c){for(const m of o)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(t,this._featureMap,n,m,c)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function ud(r,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[r]||[r.replace(`${t}-`,"").replace(/-/g,"_")]}function ah(r,t,n){const o={color:{source:G,composite:Nt},number:{source:Qe,composite:G}},c=(function(m){return{"line-pattern":{source:Si,composite:Si},"fill-pattern":{source:Si,composite:Si},"fill-extrusion-pattern":{source:Si,composite:Si}}[m]})(r);return c&&c[n]||o[t][n]}mt("ConstantBinder",In),mt("CrossFadedConstantBinder",Fo),mt("SourceExpressionBinder",ra),mt("CrossFadedCompositeBinder",Kn),mt("CompositeExpressionBinder",ps),mt("ProgramConfiguration",fs,{omit:["_buffers"]}),mt("ProgramConfigurationSet",na);const un=8192,oh=Math.pow(2,14)-1,cd=-oh-1;function Oo(r){const t=un/r.extent,n=r.loadGeometry();for(let o=0;o<n.length;o++){const c=n[o];for(let m=0;m<c.length;m++){const g=c[m],x=Math.round(g.x*t),S=Math.round(g.y*t);g.x=Je(x,cd,oh),g.y=Je(S,cd,oh),(x<g.x||x>g.x+1||S<g.y||S>g.y+1)&&Rt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function No(r,t){return{type:r.type,id:r.id,properties:r.properties,geometry:t?Oo(r):[]}}function ac(r,t,n,o,c){r.emplaceBack(2*t+(o+1)/2,2*n+(c+1)/2)}class lh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Mn,this.indexArray=new Ni,this.segments=new nr,this.programConfigurations=new na(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(t,n,o){const c=this.layers[0],m=[];let g=null,x=!1;c.type==="circle"&&(g=c.layout.get("circle-sort-key"),x=!g.isConstant());for(const{feature:S,id:P,index:z,sourceLayerIndex:L}of t){const O=this.layers[0]._featureFilter.needGeometry,V=No(S,O);if(!this.layers[0]._featureFilter.filter(new ur(this.zoom),V,o))continue;const q=x?g.evaluate(V,{},o):void 0,K={id:P,properties:S.properties,type:S.type,sourceLayerIndex:L,index:z,geometry:O?V.geometry:Oo(S),patterns:{},sortKey:q};m.push(K)}x&&m.sort(((S,P)=>S.sortKey-P.sortKey));for(const S of m){const{geometry:P,index:z,sourceLayerIndex:L}=S,O=t[z].feature;this.addFeature(S,P,z,o),n.featureIndex.insert(O,P,z,L,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,An),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,n,o,c){for(const m of n)for(const g of m){const x=g.x,S=g.y;if(x<0||x>=un||S<0||S>=un)continue;const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),z=P.vertexLength;ac(this.layoutVertexArray,x,S,-1,-1),ac(this.layoutVertexArray,x,S,1,-1),ac(this.layoutVertexArray,x,S,1,1),ac(this.layoutVertexArray,x,S,-1,1),this.indexArray.emplaceBack(z,z+1,z+2),this.indexArray.emplaceBack(z,z+3,z+2),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{},c)}}function hd(r,t){for(let n=0;n<r.length;n++)if(kl(t,r[n]))return!0;for(let n=0;n<t.length;n++)if(kl(r,t[n]))return!0;return!!fu(r,t)}function oc(r,t,n){return!!kl(r,t)||!!lc(t,r,n)}function dd(r,t){if(r.length===1)return fd(t,r[0]);for(let n=0;n<t.length;n++){const o=t[n];for(let c=0;c<o.length;c++)if(kl(r,o[c]))return!0}for(let n=0;n<r.length;n++)if(fd(t,r[n]))return!0;for(let n=0;n<t.length;n++)if(fu(r,t[n]))return!0;return!1}function uh(r,t,n){if(r.length>1){if(fu(r,t))return!0;for(let o=0;o<t.length;o++)if(lc(t[o],r,n))return!0}for(let o=0;o<r.length;o++)if(lc(r[o],t,n))return!0;return!1}function fu(r,t){if(r.length===0||t.length===0)return!1;for(let n=0;n<r.length-1;n++){const o=r[n],c=r[n+1];for(let m=0;m<t.length-1;m++)if(op(o,c,t[m],t[m+1]))return!0}return!1}function op(r,t,n,o){return Bt(r,n,o)!==Bt(t,n,o)&&Bt(r,t,n)!==Bt(r,t,o)}function lc(r,t,n){const o=n*n;if(t.length===1)return r.distSqr(t[0])<o;for(let c=1;c<t.length;c++)if(pd(r,t[c-1],t[c])<o)return!0;return!1}function pd(r,t,n){const o=t.distSqr(n);if(o===0)return r.distSqr(t);const c=((r.x-t.x)*(n.x-t.x)+(r.y-t.y)*(n.y-t.y))/o;return r.distSqr(c<0?t:c>1?n:n.sub(t)._mult(c)._add(t))}function fd(r,t){let n,o,c,m=!1;for(let g=0;g<r.length;g++){n=r[g];for(let x=0,S=n.length-1;x<n.length;S=x++)o=n[x],c=n[S],o.y>t.y!=c.y>t.y&&t.x<(c.x-o.x)*(t.y-o.y)/(c.y-o.y)+o.x&&(m=!m)}return m}function kl(r,t){let n=!1;for(let o=0,c=r.length-1;o<r.length;c=o++){const m=r[o],g=r[c];m.y>t.y!=g.y>t.y&&t.x<(g.x-m.x)*(t.y-m.y)/(g.y-m.y)+m.x&&(n=!n)}return n}function lp(r,t,n){const o=n[0],c=n[2];if(r.x<o.x&&t.x<o.x||r.x>c.x&&t.x>c.x||r.y<o.y&&t.y<o.y||r.y>c.y&&t.y>c.y)return!1;const m=Bt(r,t,n[0]);return m!==Bt(r,t,n[1])||m!==Bt(r,t,n[2])||m!==Bt(r,t,n[3])}function Tl(r,t,n){const o=t.paint.get(r).value;return o.kind==="constant"?o.value:n.programConfigurations.get(t.id).getMaxValue(r)}function uc(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function cc(r,t,n,o,c){if(!t[0]&&!t[1])return r;const m=Y.convert(t)._mult(c);n==="viewport"&&m._rotate(-o);const g=[];for(let x=0;x<r.length;x++)g.push(r[x].sub(m));return g}let md,up;mt("CircleBucket",lh,{omit:["layers"]});var cp={get paint(){return up=up||new f({"circle-radius":new At(Ee.paint_circle["circle-radius"]),"circle-color":new At(Ee.paint_circle["circle-color"]),"circle-blur":new At(Ee.paint_circle["circle-blur"]),"circle-opacity":new At(Ee.paint_circle["circle-opacity"]),"circle-translate":new gt(Ee.paint_circle["circle-translate"]),"circle-translate-anchor":new gt(Ee.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new gt(Ee.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new gt(Ee.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new At(Ee.paint_circle["circle-stroke-width"]),"circle-stroke-color":new At(Ee.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new At(Ee.paint_circle["circle-stroke-opacity"])})},get layout(){return md=md||new f({"circle-sort-key":new At(Ee.layout_circle["circle-sort-key"])})}},oi=1e-6,mu=typeof Float32Array<"u"?Float32Array:Array;function ch(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function gd(r,t,n){var o=t[0],c=t[1],m=t[2],g=t[3],x=t[4],S=t[5],P=t[6],z=t[7],L=t[8],O=t[9],V=t[10],q=t[11],K=t[12],ne=t[13],le=t[14],we=t[15],de=n[0],_e=n[1],Ae=n[2],Ue=n[3];return r[0]=de*o+_e*x+Ae*L+Ue*K,r[1]=de*c+_e*S+Ae*O+Ue*ne,r[2]=de*m+_e*P+Ae*V+Ue*le,r[3]=de*g+_e*z+Ae*q+Ue*we,r[4]=(de=n[4])*o+(_e=n[5])*x+(Ae=n[6])*L+(Ue=n[7])*K,r[5]=de*c+_e*S+Ae*O+Ue*ne,r[6]=de*m+_e*P+Ae*V+Ue*le,r[7]=de*g+_e*z+Ae*q+Ue*we,r[8]=(de=n[8])*o+(_e=n[9])*x+(Ae=n[10])*L+(Ue=n[11])*K,r[9]=de*c+_e*S+Ae*O+Ue*ne,r[10]=de*m+_e*P+Ae*V+Ue*le,r[11]=de*g+_e*z+Ae*q+Ue*we,r[12]=(de=n[12])*o+(_e=n[13])*x+(Ae=n[14])*L+(Ue=n[15])*K,r[13]=de*c+_e*S+Ae*O+Ue*ne,r[14]=de*m+_e*P+Ae*V+Ue*le,r[15]=de*g+_e*z+Ae*q+Ue*we,r}Math.hypot||(Math.hypot=function(){for(var r=0,t=arguments.length;t--;)r+=arguments[t]*arguments[t];return Math.sqrt(r)});var gu,hh=gd;function dh(r,t,n){var o=t[0],c=t[1],m=t[2],g=t[3];return r[0]=n[0]*o+n[4]*c+n[8]*m+n[12]*g,r[1]=n[1]*o+n[5]*c+n[9]*m+n[13]*g,r[2]=n[2]*o+n[6]*c+n[10]*m+n[14]*g,r[3]=n[3]*o+n[7]*c+n[11]*m+n[15]*g,r}gu=new mu(4),mu!=Float32Array&&(gu[0]=0,gu[1]=0,gu[2]=0,gu[3]=0);class Ef extends s{constructor(t){super(t,cp)}createBucket(t){return new lh(t)}queryRadius(t){const n=t;return Tl("circle-radius",this,n)+Tl("circle-stroke-width",this,n)+uc(this.paint.get("circle-translate"))}queryIntersectsFeature(t,n,o,c,m,g,x,S){const P=cc(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,x),z=this.paint.get("circle-radius").evaluate(n,o)+this.paint.get("circle-stroke-width").evaluate(n,o),L=this.paint.get("circle-pitch-alignment")==="map",O=L?P:(function(q,K){return q.map((ne=>hp(ne,K)))})(P,S),V=L?z*x:z;for(const q of c)for(const K of q){const ne=L?K:hp(K,S);let le=V;const we=dh([],[K.x,K.y,0,1],S);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?le*=we[3]/g.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(le*=g.cameraToCenterDistance/we[3]),oc(O,ne,le))return!0}return!1}}function hp(r,t){const n=dh([],[r.x,r.y,0,1],t);return new Y(n[0]/n[3],n[1]/n[3])}class Ls extends lh{}let ph;mt("HeatmapBucket",Ls,{omit:["layers"]});var fh={get paint(){return ph=ph||new f({"heatmap-radius":new At(Ee.paint_heatmap["heatmap-radius"]),"heatmap-weight":new At(Ee.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new gt(Ee.paint_heatmap["heatmap-intensity"]),"heatmap-color":new tc(Ee.paint_heatmap["heatmap-color"]),"heatmap-opacity":new gt(Ee.paint_heatmap["heatmap-opacity"])})}};function mh(r,{width:t,height:n},o,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==t*n*o)throw new RangeError(`mismatched image size. expected: ${c.length} but got: ${t*n*o}`)}else c=new Uint8Array(t*n*o);return r.width=t,r.height=n,r.data=c,r}function yd(r,{width:t,height:n},o){if(t===r.width&&n===r.height)return;const c=mh({},{width:t,height:n},o);gh(r,c,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,t),height:Math.min(r.height,n)},o),r.width=t,r.height=n,r.data=c.data}function gh(r,t,n,o,c,m){if(c.width===0||c.height===0)return t;if(c.width>r.width||c.height>r.height||n.x>r.width-c.width||n.y>r.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>t.width||c.height>t.height||o.x>t.width-c.width||o.y>t.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const g=r.data,x=t.data;if(g===x)throw new Error("srcData equals dstData, so image is already copied");for(let S=0;S<c.height;S++){const P=((n.y+S)*r.width+n.x)*m,z=((o.y+S)*t.width+o.x)*m;for(let L=0;L<c.width*m;L++)x[z+L]=g[P+L]}return t}class Il{constructor(t,n){mh(this,t,1,n)}resize(t){yd(this,t,1)}clone(){return new Il({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,o,c,m){gh(t,n,o,c,m,1)}}class Fn{constructor(t,n){mh(this,t,4,n)}resize(t){yd(this,t,4)}replace(t,n){n?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Fn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,o,c,m){gh(t,n,o,c,m,4)}}function yh(r){const t={},n=r.resolution||256,o=r.clips?r.clips.length:1,c=r.image||new Fn({width:n,height:o});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const m=(g,x,S)=>{t[r.evaluationKey]=S;const P=r.expression.evaluate(t);c.data[g+x+0]=Math.floor(255*P.r/P.a),c.data[g+x+1]=Math.floor(255*P.g/P.a),c.data[g+x+2]=Math.floor(255*P.b/P.a),c.data[g+x+3]=Math.floor(255*P.a)};if(r.clips)for(let g=0,x=0;g<o;++g,x+=4*n)for(let S=0,P=0;S<n;S++,P+=4){const z=S/(n-1),{start:L,end:O}=r.clips[g];m(x,P,L*(1-z)+O*z)}else for(let g=0,x=0;g<n;g++,x+=4)m(0,x,g/(n-1));return c}mt("AlphaImage",Il),mt("RGBAImage",Fn);const hc="big-fb";class Pf extends s{createBucket(t){return new Ls(t)}constructor(t){super(t,fh),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=yh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(hc)&&this.heatmapFbos.delete(hc)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let _d;var dp={get paint(){return _d=_d||new f({"hillshade-illumination-direction":new gt(Ee.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new gt(Ee.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new gt(Ee.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new gt(Ee.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new gt(Ee.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new gt(Ee.paint_hillshade["hillshade-accent-color"])})}};class pp extends s{constructor(t){super(t,dp)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const fp=w([{name:"a_pos",components:2,type:"Int16"}],4),{members:mp}=fp;function gp(r,t,n=2){const o=t&&t.length,c=o?t[0]*n:r.length;let m=Ii(r,0,c,n,!0);const g=[];if(!m||m.next===m.prev)return g;let x,S,P;if(o&&(m=(function(z,L,O,V){const q=[];for(let K=0,ne=L.length;K<ne;K++){const le=Ii(z,L[K]*V,K<ne-1?L[K+1]*V:z.length,V,!1);le===le.next&&(le.steiner=!0),q.push(bp(le))}q.sort(vd);for(let K=0;K<q.length;K++)O=wp(q[K],O);return O})(r,t,m,n)),r.length>80*n){x=1/0,S=1/0;let z=-1/0,L=-1/0;for(let O=n;O<c;O+=n){const V=r[O],q=r[O+1];V<x&&(x=V),q<S&&(S=q),V>z&&(z=V),q>L&&(L=q)}P=Math.max(z-x,L-S),P=P!==0?32767/P:0}return yu(m,g,n,x,S,P,0),g}function Ii(r,t,n,o,c){let m;if(c===(function(g,x,S,P){let z=0;for(let L=x,O=S-P;L<S;L+=P)z+=(g[O]-g[L])*(g[L+1]+g[O+1]),O=L;return z})(r,t,n,o)>0)for(let g=t;g<n;g+=o)m=fc(g/o|0,r[g],r[g+1],m);else for(let g=n-o;g>=t;g-=o)m=fc(g/o|0,r[g],r[g+1],m);return m&&_u(m,m.next)&&(ms(m),m=m.next),m}function xn(r,t){if(!r)return r;t||(t=r);let n,o=r;do if(n=!1,o.steiner||!_u(o,o.next)&&nn(o.prev,o,o.next)!==0)o=o.next;else{if(ms(o),o=t=o.prev,o===o.next)break;n=!0}while(n||o!==t);return t}function yu(r,t,n,o,c,m,g){if(!r)return;!g&&m&&(function(S,P,z,L){let O=S;do O.z===0&&(O.z=_h(O.x,O.y,P,z,L)),O.prevZ=O.prev,O.nextZ=O.next,O=O.next;while(O!==S);O.prevZ.nextZ=null,O.prevZ=null,(function(V){let q,K=1;do{let ne,le=V;V=null;let we=null;for(q=0;le;){q++;let de=le,_e=0;for(let Ue=0;Ue<K&&(_e++,de=de.nextZ,de);Ue++);let Ae=K;for(;_e>0||Ae>0&&de;)_e!==0&&(Ae===0||!de||le.z<=de.z)?(ne=le,le=le.nextZ,_e--):(ne=de,de=de.nextZ,Ae--),we?we.nextZ=ne:V=ne,ne.prevZ=we,we=ne;le=de}we.nextZ=null,K*=2}while(q>1)})(O)})(r,o,c,m);let x=r;for(;r.prev!==r.next;){const S=r.prev,P=r.next;if(m?_p(r,o,c,m):yp(r))t.push(S.i,r.i,P.i),ms(r),r=P.next,x=P.next;else if((r=P)===x){g?g===1?yu(r=vp(xn(r),t),t,n,o,c,m,2):g===2&&xp(r,t,n,o,c,m):yu(xn(r),t,n,o,c,m,1);break}}}function yp(r){const t=r.prev,n=r,o=r.next;if(nn(t,n,o)>=0)return!1;const c=t.x,m=n.x,g=o.x,x=t.y,S=n.y,P=o.y,z=c<m?c<g?c:g:m<g?m:g,L=x<S?x<P?x:P:S<P?S:P,O=c>m?c>g?c:g:m>g?m:g,V=x>S?x>P?x:P:S>P?S:P;let q=o.next;for(;q!==t;){if(q.x>=z&&q.x<=O&&q.y>=L&&q.y<=V&&jo(c,x,m,S,g,P,q.x,q.y)&&nn(q.prev,q,q.next)>=0)return!1;q=q.next}return!0}function _p(r,t,n,o){const c=r.prev,m=r,g=r.next;if(nn(c,m,g)>=0)return!1;const x=c.x,S=m.x,P=g.x,z=c.y,L=m.y,O=g.y,V=x<S?x<P?x:P:S<P?S:P,q=z<L?z<O?z:O:L<O?L:O,K=x>S?x>P?x:P:S>P?S:P,ne=z>L?z>O?z:O:L>O?L:O,le=_h(V,q,t,n,o),we=_h(K,ne,t,n,o);let de=r.prevZ,_e=r.nextZ;for(;de&&de.z>=le&&_e&&_e.z<=we;){if(de.x>=V&&de.x<=K&&de.y>=q&&de.y<=ne&&de!==c&&de!==g&&jo(x,z,S,L,P,O,de.x,de.y)&&nn(de.prev,de,de.next)>=0||(de=de.prevZ,_e.x>=V&&_e.x<=K&&_e.y>=q&&_e.y<=ne&&_e!==c&&_e!==g&&jo(x,z,S,L,P,O,_e.x,_e.y)&&nn(_e.prev,_e,_e.next)>=0))return!1;_e=_e.nextZ}for(;de&&de.z>=le;){if(de.x>=V&&de.x<=K&&de.y>=q&&de.y<=ne&&de!==c&&de!==g&&jo(x,z,S,L,P,O,de.x,de.y)&&nn(de.prev,de,de.next)>=0)return!1;de=de.prevZ}for(;_e&&_e.z<=we;){if(_e.x>=V&&_e.x<=K&&_e.y>=q&&_e.y<=ne&&_e!==c&&_e!==g&&jo(x,z,S,L,P,O,_e.x,_e.y)&&nn(_e.prev,_e,_e.next)>=0)return!1;_e=_e.nextZ}return!0}function vp(r,t){let n=r;do{const o=n.prev,c=n.next.next;!_u(o,c)&&dc(o,n,n.next,c)&&El(o,c)&&El(c,o)&&(t.push(o.i,n.i,c.i),ms(n),ms(n.next),n=r=c),n=n.next}while(n!==r);return xn(n)}function xp(r,t,n,o,c,m){let g=r;do{let x=g.next.next;for(;x!==g.prev;){if(g.i!==x.i&&wd(g,x)){let S=bd(g,x);return g=xn(g,g.next),S=xn(S,S.next),yu(g,t,n,o,c,m,0),void yu(S,t,n,o,c,m,0)}x=x.next}g=g.next}while(g!==r)}function vd(r,t){return r.x-t.x}function wp(r,t){const n=(function(c,m){let g=m;const x=c.x,S=c.y;let P,z=-1/0;do{if(S<=g.y&&S>=g.next.y&&g.next.y!==g.y){const K=g.x+(S-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(K<=x&&K>z&&(z=K,P=g.x<g.next.x?g:g.next,K===x))return P}g=g.next}while(g!==m);if(!P)return null;const L=P,O=P.x,V=P.y;let q=1/0;g=P;do{if(x>=g.x&&g.x>=O&&x!==g.x&&jo(S<V?x:z,S,O,V,S<V?z:x,S,g.x,g.y)){const K=Math.abs(S-g.y)/(x-g.x);El(g,c)&&(K<q||K===q&&(g.x>P.x||g.x===P.x&&xd(P,g)))&&(P=g,q=K)}g=g.next}while(g!==L);return P})(r,t);if(!n)return t;const o=bd(n,r);return xn(o,o.next),xn(n,n.next)}function xd(r,t){return nn(r.prev,r,t.prev)<0&&nn(t.next,r,r.next)<0}function _h(r,t,n,o,c){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-n)*c|0)|r<<8))|r<<4))|r<<2))|r<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-o)*c|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function bp(r){let t=r,n=r;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==r);return n}function jo(r,t,n,o,c,m,g,x){return(c-g)*(t-x)>=(r-g)*(m-x)&&(r-g)*(o-x)>=(n-g)*(t-x)&&(n-g)*(m-x)>=(c-g)*(o-x)}function wd(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!(function(n,o){let c=n;do{if(c.i!==n.i&&c.next.i!==n.i&&c.i!==o.i&&c.next.i!==o.i&&dc(c,c.next,n,o))return!0;c=c.next}while(c!==n);return!1})(r,t)&&(El(r,t)&&El(t,r)&&(function(n,o){let c=n,m=!1;const g=(n.x+o.x)/2,x=(n.y+o.y)/2;do c.y>x!=c.next.y>x&&c.next.y!==c.y&&g<(c.next.x-c.x)*(x-c.y)/(c.next.y-c.y)+c.x&&(m=!m),c=c.next;while(c!==n);return m})(r,t)&&(nn(r.prev,r,t.prev)||nn(r,t.prev,t))||_u(r,t)&&nn(r.prev,r,r.next)>0&&nn(t.prev,t,t.next)>0)}function nn(r,t,n){return(t.y-r.y)*(n.x-t.x)-(t.x-r.x)*(n.y-t.y)}function _u(r,t){return r.x===t.x&&r.y===t.y}function dc(r,t,n,o){const c=pc(nn(r,t,n)),m=pc(nn(r,t,o)),g=pc(nn(n,o,r)),x=pc(nn(n,o,t));return c!==m&&g!==x||!(c!==0||!vh(r,n,t))||!(m!==0||!vh(r,o,t))||!(g!==0||!vh(n,r,o))||!(x!==0||!vh(n,t,o))}function vh(r,t,n){return t.x<=Math.max(r.x,n.x)&&t.x>=Math.min(r.x,n.x)&&t.y<=Math.max(r.y,n.y)&&t.y>=Math.min(r.y,n.y)}function pc(r){return r>0?1:r<0?-1:0}function El(r,t){return nn(r.prev,r,r.next)<0?nn(r,t,r.next)>=0&&nn(r,r.prev,t)>=0:nn(r,t,r.prev)<0||nn(r,r.next,t)<0}function bd(r,t){const n=Sd(r.i,r.x,r.y),o=Sd(t.i,t.x,t.y),c=r.next,m=t.prev;return r.next=t,t.prev=r,n.next=c,c.prev=n,o.next=n,n.prev=o,m.next=o,o.prev=m,o}function fc(r,t,n,o){const c=Sd(r,t,n);return o?(c.next=o.next,c.prev=o,o.next.prev=c,o.next=c):(c.prev=c,c.next=c),c}function ms(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Sd(r,t,n){return{i:r,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function xh(r,t,n){const o=n.patternDependencies;let c=!1;for(const m of t){const g=m.paint.get(`${r}-pattern`);g.isConstant()||(c=!0);const x=g.constantOr(null);x&&(c=!0,o[x.to]=!0,o[x.from]=!0)}return c}function mc(r,t,n,o,c){const m=c.patternDependencies;for(const g of t){const x=g.paint.get(`${r}-pattern`).value;if(x.kind!=="constant"){let S=x.evaluate({zoom:o-1},n,{},c.availableImages),P=x.evaluate({zoom:o},n,{},c.availableImages),z=x.evaluate({zoom:o+1},n,{},c.availableImages);S=S&&S.name?S.name:S,P=P&&P.name?P.name:P,z=z&&z.name?z.name:z,m[S]=!0,m[P]=!0,m[z]=!0,n.patterns[g.id]={min:S,mid:P,max:z}}}return n}class wh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ls,this.indexArray=new Ni,this.indexArray2=new ln,this.programConfigurations=new na(t.layers,t.zoom),this.segments=new nr,this.segments2=new nr,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(t,n,o){this.hasPattern=xh("fill",this.layers,n);const c=this.layers[0].layout.get("fill-sort-key"),m=!c.isConstant(),g=[];for(const{feature:x,id:S,index:P,sourceLayerIndex:z}of t){const L=this.layers[0]._featureFilter.needGeometry,O=No(x,L);if(!this.layers[0]._featureFilter.filter(new ur(this.zoom),O,o))continue;const V=m?c.evaluate(O,{},o,n.availableImages):void 0,q={id:S,properties:x.properties,type:x.type,sourceLayerIndex:z,index:P,geometry:L?O.geometry:Oo(x),patterns:{},sortKey:V};g.push(q)}m&&g.sort(((x,S)=>x.sortKey-S.sortKey));for(const x of g){const{geometry:S,index:P,sourceLayerIndex:z}=x;if(this.hasPattern){const L=mc("fill",this.layers,x,this.zoom,n);this.patternFeatures.push(L)}else this.addFeature(x,S,P,o,{});n.featureIndex.insert(t[P].feature,S,P,z,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}addFeatures(t,n,o){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,n,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,mp),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,n,o,c,m){for(const g of _o(n,500)){let x=0;for(const V of g)x+=V.length;const S=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray),P=S.vertexLength,z=[],L=[];for(const V of g){if(V.length===0)continue;V!==g[0]&&L.push(z.length/2);const q=this.segments2.prepareSegment(V.length,this.layoutVertexArray,this.indexArray2),K=q.vertexLength;this.layoutVertexArray.emplaceBack(V[0].x,V[0].y),this.indexArray2.emplaceBack(K+V.length-1,K),z.push(V[0].x),z.push(V[0].y);for(let ne=1;ne<V.length;ne++)this.layoutVertexArray.emplaceBack(V[ne].x,V[ne].y),this.indexArray2.emplaceBack(K+ne-1,K+ne),z.push(V[ne].x),z.push(V[ne].y);q.vertexLength+=V.length,q.primitiveLength+=V.length}const O=gp(z,L);for(let V=0;V<O.length;V+=3)this.indexArray.emplaceBack(P+O[V],P+O[V+1],P+O[V+2]);S.vertexLength+=x,S.primitiveLength+=O.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,m,c)}}let kd,vu;mt("FillBucket",wh,{omit:["layers","patternFeatures"]});var li={get paint(){return vu=vu||new f({"fill-antialias":new gt(Ee.paint_fill["fill-antialias"]),"fill-opacity":new At(Ee.paint_fill["fill-opacity"]),"fill-color":new At(Ee.paint_fill["fill-color"]),"fill-outline-color":new At(Ee.paint_fill["fill-outline-color"]),"fill-translate":new gt(Ee.paint_fill["fill-translate"]),"fill-translate-anchor":new gt(Ee.paint_fill["fill-translate-anchor"]),"fill-pattern":new Lo(Ee.paint_fill["fill-pattern"])})},get layout(){return kd=kd||new f({"fill-sort-key":new At(Ee.layout_fill["fill-sort-key"])})}};class Cf extends s{constructor(t){super(t,li)}recalculate(t,n){super.recalculate(t,n);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new wh(t)}queryRadius(){return uc(this.paint.get("fill-translate"))}queryIntersectsFeature(t,n,o,c,m,g,x){return dd(cc(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,x),c)}isTileClipped(){return!0}}const Mf=w([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),bh=w([{name:"a_centroid",components:2,type:"Int16"}],4),{members:ui}=Mf;var Vo={},Tt=ae,Pl=Uo;function Uo(r,t,n,o,c){this.properties={},this.extent=n,this.type=0,this._pbf=r,this._geometry=-1,this._keys=o,this._values=c,r.readFields(Sp,this,t)}function Sp(r,t,n){r==1?t.id=n.readVarint():r==2?(function(o,c){for(var m=o.readVarint()+o.pos;o.pos<m;){var g=c._keys[o.readVarint()],x=c._values[o.readVarint()];c.properties[g]=x}})(n,t):r==3?t.type=n.readVarint():r==4&&(t._geometry=n.pos)}function Af(r){for(var t,n,o=0,c=0,m=r.length,g=m-1;c<m;g=c++)o+=((n=r[g]).x-(t=r[c]).x)*(t.y+n.y);return o}Uo.types=["Unknown","Point","LineString","Polygon"],Uo.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var t,n=r.readVarint()+r.pos,o=1,c=0,m=0,g=0,x=[];r.pos<n;){if(c<=0){var S=r.readVarint();o=7&S,c=S>>3}if(c--,o===1||o===2)m+=r.readSVarint(),g+=r.readSVarint(),o===1&&(t&&x.push(t),t=[]),t.push(new Tt(m,g));else{if(o!==7)throw new Error("unknown command "+o);t&&t.push(t[0].clone())}}return t&&x.push(t),x},Uo.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var t=r.readVarint()+r.pos,n=1,o=0,c=0,m=0,g=1/0,x=-1/0,S=1/0,P=-1/0;r.pos<t;){if(o<=0){var z=r.readVarint();n=7&z,o=z>>3}if(o--,n===1||n===2)(c+=r.readSVarint())<g&&(g=c),c>x&&(x=c),(m+=r.readSVarint())<S&&(S=m),m>P&&(P=m);else if(n!==7)throw new Error("unknown command "+n)}return[g,S,x,P]},Uo.prototype.toGeoJSON=function(r,t,n){var o,c,m=this.extent*Math.pow(2,n),g=this.extent*r,x=this.extent*t,S=this.loadGeometry(),P=Uo.types[this.type];function z(V){for(var q=0;q<V.length;q++){var K=V[q];V[q]=[360*(K.x+g)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(K.y+x)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var L=[];for(o=0;o<S.length;o++)L[o]=S[o][0];z(S=L);break;case 2:for(o=0;o<S.length;o++)z(S[o]);break;case 3:for(S=(function(V){var q=V.length;if(q<=1)return[V];for(var K,ne,le=[],we=0;we<q;we++){var de=Af(V[we]);de!==0&&(ne===void 0&&(ne=de<0),ne===de<0?(K&&le.push(K),K=[V[we]]):K.push(V[we]))}return K&&le.push(K),le})(S),o=0;o<S.length;o++)for(c=0;c<S[o].length;c++)z(S[o][c])}S.length===1?S=S[0]:P="Multi"+P;var O={type:"Feature",geometry:{type:P,coordinates:S},properties:this.properties};return"id"in this&&(O.id=this.id),O};var gc=Pl,yc=Sh;function Sh(r,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(kp,this,t),this.length=this._features.length}function kp(r,t,n){r===15?t.version=n.readVarint():r===1?t.name=n.readString():r===5?t.extent=n.readVarint():r===2?t._features.push(n.pos):r===3?t._keys.push(n.readString()):r===4&&t._values.push((function(o){for(var c=null,m=o.readVarint()+o.pos;o.pos<m;){var g=o.readVarint()>>3;c=g===1?o.readString():g===2?o.readFloat():g===3?o.readDouble():g===4?o.readVarint64():g===5?o.readVarint():g===6?o.readSVarint():g===7?o.readBoolean():null}return c})(n))}Sh.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var t=this._pbf.readVarint()+this._pbf.pos;return new gc(this._pbf,t,this.extent,this._keys,this._values)};var Tp=yc;function Ip(r,t,n){if(r===3){var o=new Tp(n,n.readVarint()+n.pos);o.length&&(t[o.name]=o)}}Vo.VectorTile=function(r,t){this.layers=r.readFields(Ip,{},t)},Vo.VectorTileFeature=Pl,Vo.VectorTileLayer=yc;const Td=Vo.VectorTileFeature.types,_c=Math.pow(2,13);function wn(r,t,n,o,c,m,g,x){r.emplaceBack(t,n,2*Math.floor(o*_c)+g,c*_c*2,m*_c*2,Math.round(x))}class gs{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ai,this.centroidVertexArray=new rn,this.indexArray=new Ni,this.programConfigurations=new na(t.layers,t.zoom),this.segments=new nr,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(t,n,o){this.features=[],this.hasPattern=xh("fill-extrusion",this.layers,n);for(const{feature:c,id:m,index:g,sourceLayerIndex:x}of t){const S=this.layers[0]._featureFilter.needGeometry,P=No(c,S);if(!this.layers[0]._featureFilter.filter(new ur(this.zoom),P,o))continue;const z={id:m,sourceLayerIndex:x,index:g,geometry:S?P.geometry:Oo(c),properties:c.properties,type:c.type,patterns:{}};this.hasPattern?this.features.push(mc("fill-extrusion",this.layers,z,this.zoom,n)):this.addFeature(z,z.geometry,g,o,{}),n.featureIndex.insert(c,z.geometry,g,x,this.index,!0)}}addFeatures(t,n,o){for(const c of this.features){const{geometry:m}=c;this.addFeature(c,m,c.index,n,o)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ui),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,bh.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,n,o,c,m){for(const g of _o(n,500)){const x={x:0,y:0,vertexCount:0};let S=0;for(const q of g)S+=q.length;let P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const q of g){if(q.length===0||Ep(q))continue;let K=0;for(let ne=0;ne<q.length;ne++){const le=q[ne];if(ne>=1){const we=q[ne-1];if(!$o(le,we)){P.vertexLength+4>nr.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const de=le.sub(we)._perp()._unit(),_e=we.dist(le);K+_e>32768&&(K=0),wn(this.layoutVertexArray,le.x,le.y,de.x,de.y,0,0,K),wn(this.layoutVertexArray,le.x,le.y,de.x,de.y,0,1,K),x.x+=2*le.x,x.y+=2*le.y,x.vertexCount+=2,K+=_e,wn(this.layoutVertexArray,we.x,we.y,de.x,de.y,0,0,K),wn(this.layoutVertexArray,we.x,we.y,de.x,de.y,0,1,K),x.x+=2*we.x,x.y+=2*we.y,x.vertexCount+=2;const Ae=P.vertexLength;this.indexArray.emplaceBack(Ae,Ae+2,Ae+1),this.indexArray.emplaceBack(Ae+1,Ae+2,Ae+3),P.vertexLength+=4,P.primitiveLength+=2}}}}if(P.vertexLength+S>nr.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(S,this.layoutVertexArray,this.indexArray)),Td[t.type]!=="Polygon")continue;const z=[],L=[],O=P.vertexLength;for(const q of g)if(q.length!==0){q!==g[0]&&L.push(z.length/2);for(let K=0;K<q.length;K++){const ne=q[K];wn(this.layoutVertexArray,ne.x,ne.y,0,0,1,1,0),x.x+=ne.x,x.y+=ne.y,x.vertexCount+=1,z.push(ne.x),z.push(ne.y)}}const V=gp(z,L);for(let q=0;q<V.length;q+=3)this.indexArray.emplaceBack(O+V[q],O+V[q+2],O+V[q+1]);P.primitiveLength+=V.length/3,P.vertexLength+=S;for(let q=0;q<x.vertexCount;q++){const K=Math.floor(x.x/x.vertexCount),ne=Math.floor(x.y/x.vertexCount);this.centroidVertexArray.emplaceBack(K,ne)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,m,c)}}function $o(r,t){return r.x===t.x&&(r.x<0||r.x>un)||r.y===t.y&&(r.y<0||r.y>un)}function Ep(r){return r.every((t=>t.x<0))||r.every((t=>t.x>un))||r.every((t=>t.y<0))||r.every((t=>t.y>un))}let Id;mt("FillExtrusionBucket",gs,{omit:["layers","features"]});var ia={get paint(){return Id=Id||new f({"fill-extrusion-opacity":new gt(Ee["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new At(Ee["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new gt(Ee["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new gt(Ee["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Lo(Ee["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new At(Ee["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new At(Ee["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new gt(Ee["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Pp extends s{constructor(t){super(t,ia)}createBucket(t){return new gs(t)}queryRadius(){return uc(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,n,o,c,m,g,x,S){const P=cc(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,x),z=this.paint.get("fill-extrusion-height").evaluate(n,o),L=this.paint.get("fill-extrusion-base").evaluate(n,o),O=(function(q,K,ne,le){const we=[];for(const de of q){const _e=[de.x,de.y,0,1];dh(_e,_e,K),we.push(new Y(_e[0]/_e[3],_e[1]/_e[3]))}return we})(P,S),V=(function(q,K,ne,le){const we=[],de=[],_e=le[8]*K,Ae=le[9]*K,Ue=le[10]*K,pt=le[11]*K,Lt=le[8]*ne,dt=le[9]*ne,ot=le[10]*ne,kt=le[11]*ne;for(const xt of q){const yt=[],Be=[];for(const It of xt){const St=It.x,$t=It.y,Ur=le[0]*St+le[4]*$t+le[12],Fr=le[1]*St+le[5]*$t+le[13],On=le[2]*St+le[6]*$t+le[14],La=le[3]*St+le[7]*$t+le[15],di=On+Ue,Nn=La+pt,Zi=Ur+Lt,Gi=Fr+dt,Hi=On+ot,pn=La+kt,jn=new Y((Ur+_e)/Nn,(Fr+Ae)/Nn);jn.z=di/Nn,yt.push(jn);const Ci=new Y(Zi/pn,Gi/pn);Ci.z=Hi/pn,Be.push(Ci)}we.push(yt),de.push(Be)}return[we,de]})(c,L,z,S);return(function(q,K,ne){let le=1/0;dd(ne,K)&&(le=Cp(ne,K[0]));for(let we=0;we<K.length;we++){const de=K[we],_e=q[we];for(let Ae=0;Ae<de.length-1;Ae++){const Ue=de[Ae],pt=[Ue,de[Ae+1],_e[Ae+1],_e[Ae],Ue];hd(ne,pt)&&(le=Math.min(le,Cp(ne,pt)))}}return le!==1/0&&le})(V[0],V[1],O)}}function ji(r,t){return r.x*t.x+r.y*t.y}function Cp(r,t){if(r.length===1){let n=0;const o=t[n++];let c;for(;!c||o.equals(c);)if(c=t[n++],!c)return 1/0;for(;n<t.length;n++){const m=t[n],g=r[0],x=c.sub(o),S=m.sub(o),P=g.sub(o),z=ji(x,x),L=ji(x,S),O=ji(S,S),V=ji(P,x),q=ji(P,S),K=z*O-L*L,ne=(O*V-L*q)/K,le=(z*q-L*V)/K,we=o.z*(1-ne-le)+c.z*ne+m.z*le;if(isFinite(we))return we}return 1/0}{let n=1/0;for(const o of t)n=Math.min(n,o.z);return n}}const Mp=w([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Ap}=Mp,zp=w([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Dp}=zp,zf=Vo.VectorTileFeature.types,kh=Math.cos(Math.PI/180*37.5),Th=Math.pow(2,14)/.5;class Vi{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((n=>{this.gradients[n.id]={}})),this.layoutVertexArray=new us,this.layoutVertexArray2=new Ca,this.indexArray=new Ni,this.programConfigurations=new na(t.layers,t.zoom),this.segments=new nr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(t,n,o){this.hasPattern=xh("line",this.layers,n);const c=this.layers[0].layout.get("line-sort-key"),m=!c.isConstant(),g=[];for(const{feature:x,id:S,index:P,sourceLayerIndex:z}of t){const L=this.layers[0]._featureFilter.needGeometry,O=No(x,L);if(!this.layers[0]._featureFilter.filter(new ur(this.zoom),O,o))continue;const V=m?c.evaluate(O,{},o):void 0,q={id:S,properties:x.properties,type:x.type,sourceLayerIndex:z,index:P,geometry:L?O.geometry:Oo(x),patterns:{},sortKey:V};g.push(q)}m&&g.sort(((x,S)=>x.sortKey-S.sortKey));for(const x of g){const{geometry:S,index:P,sourceLayerIndex:z}=x;if(this.hasPattern){const L=mc("line",this.layers,x,this.zoom,n);this.patternFeatures.push(L)}else this.addFeature(x,S,P,o,{});n.featureIndex.insert(t[P].feature,S,P,z,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}addFeatures(t,n,o){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,n,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Dp)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ap),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,n,o,c,m){const g=this.layers[0].layout,x=g.get("line-join").evaluate(t,{}),S=g.get("line-cap"),P=g.get("line-miter-limit"),z=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const L of n)this.addLine(L,t,x,S,P,z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,m,c)}addLine(t,n,o,c,m,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let le=0;le<t.length-1;le++)this.totalDistance+=t[le].dist(t[le+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x=zf[n.type]==="Polygon";let S=t.length;for(;S>=2&&t[S-1].equals(t[S-2]);)S--;let P=0;for(;P<S-1&&t[P].equals(t[P+1]);)P++;if(S<(x?3:2))return;o==="bevel"&&(m=1.05);const z=this.overscaling<=16?15*un/(512*this.overscaling):0,L=this.segments.prepareSegment(10*S,this.layoutVertexArray,this.indexArray);let O,V,q,K,ne;this.e1=this.e2=-1,x&&(O=t[S-2],ne=t[P].sub(O)._unit()._perp());for(let le=P;le<S;le++){if(q=le===S-1?x?t[P+1]:void 0:t[le+1],q&&t[le].equals(q))continue;ne&&(K=ne),O&&(V=O),O=t[le],ne=q?q.sub(O)._unit()._perp():K,K=K||ne;let we=K.add(ne);we.x===0&&we.y===0||we._unit();const de=K.x*ne.x+K.y*ne.y,_e=we.x*ne.x+we.y*ne.y,Ae=_e!==0?1/_e:1/0,Ue=2*Math.sqrt(2-2*_e),pt=_e<kh&&V&&q,Lt=K.x*ne.y-K.y*ne.x>0;if(pt&&le>P){const kt=O.dist(V);if(kt>2*z){const xt=O.sub(O.sub(V)._mult(z/kt)._round());this.updateDistance(V,xt),this.addCurrentVertex(xt,K,0,0,L),V=xt}}const dt=V&&q;let ot=dt?o:x?"butt":c;if(dt&&ot==="round"&&(Ae<g?ot="miter":Ae<=2&&(ot="fakeround")),ot==="miter"&&Ae>m&&(ot="bevel"),ot==="bevel"&&(Ae>2&&(ot="flipbevel"),Ae<m&&(ot="miter")),V&&this.updateDistance(V,O),ot==="miter")we._mult(Ae),this.addCurrentVertex(O,we,0,0,L);else if(ot==="flipbevel"){if(Ae>100)we=ne.mult(-1);else{const kt=Ae*K.add(ne).mag()/K.sub(ne).mag();we._perp()._mult(kt*(Lt?-1:1))}this.addCurrentVertex(O,we,0,0,L),this.addCurrentVertex(O,we.mult(-1),0,0,L)}else if(ot==="bevel"||ot==="fakeround"){const kt=-Math.sqrt(Ae*Ae-1),xt=Lt?kt:0,yt=Lt?0:kt;if(V&&this.addCurrentVertex(O,K,xt,yt,L),ot==="fakeround"){const Be=Math.round(180*Ue/Math.PI/20);for(let It=1;It<Be;It++){let St=It/Be;if(St!==.5){const Ur=St-.5;St+=St*Ur*(St-1)*((1.0904+de*(de*(3.55645-1.43519*de)-3.2452))*Ur*Ur+(.848013+de*(.215638*de-1.06021)))}const $t=ne.sub(K)._mult(St)._add(K)._unit()._mult(Lt?-1:1);this.addHalfVertex(O,$t.x,$t.y,!1,Lt,0,L)}}q&&this.addCurrentVertex(O,ne,-xt,-yt,L)}else if(ot==="butt")this.addCurrentVertex(O,we,0,0,L);else if(ot==="square"){const kt=V?1:-1;this.addCurrentVertex(O,we,kt,kt,L)}else ot==="round"&&(V&&(this.addCurrentVertex(O,K,0,0,L),this.addCurrentVertex(O,K,1,1,L,!0)),q&&(this.addCurrentVertex(O,ne,-1,-1,L,!0),this.addCurrentVertex(O,ne,0,0,L)));if(pt&&le<S-1){const kt=O.dist(q);if(kt>2*z){const xt=O.add(q.sub(O)._mult(z/kt)._round());this.updateDistance(O,xt),this.addCurrentVertex(xt,ne,0,0,L),O=xt}}}}addCurrentVertex(t,n,o,c,m,g=!1){const x=n.y*c-n.x,S=-n.y-n.x*c;this.addHalfVertex(t,n.x+n.y*o,n.y-n.x*o,g,!1,o,m),this.addHalfVertex(t,x,S,g,!0,-c,m),this.distance>Th/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,n,o,c,m,g))}addHalfVertex({x:t,y:n},o,c,m,g,x,S){const P=.5*(this.lineClips?this.scaledDistance*(Th-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(m?1:0),(n<<1)+(g?1:0),Math.round(63*o)+128,Math.round(63*c)+128,1+(x===0?0:x<0?-1:1)|(63&P)<<2,P>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const z=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,z),S.primitiveLength++),g?this.e2=z:this.e1=z}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,n){this.distance+=t.dist(n),this.updateScaledDistance()}}let xr,zn;mt("LineBucket",Vi,{omit:["layers","patternFeatures"]});var bn={get paint(){return zn=zn||new f({"line-opacity":new At(Ee.paint_line["line-opacity"]),"line-color":new At(Ee.paint_line["line-color"]),"line-translate":new gt(Ee.paint_line["line-translate"]),"line-translate-anchor":new gt(Ee.paint_line["line-translate-anchor"]),"line-width":new At(Ee.paint_line["line-width"]),"line-gap-width":new At(Ee.paint_line["line-gap-width"]),"line-offset":new At(Ee.paint_line["line-offset"]),"line-blur":new At(Ee.paint_line["line-blur"]),"line-dasharray":new Sl(Ee.paint_line["line-dasharray"]),"line-pattern":new Lo(Ee.paint_line["line-pattern"]),"line-gradient":new tc(Ee.paint_line["line-gradient"])})},get layout(){return xr=xr||new f({"line-cap":new gt(Ee.layout_line["line-cap"]),"line-join":new At(Ee.layout_line["line-join"]),"line-miter-limit":new gt(Ee.layout_line["line-miter-limit"]),"line-round-limit":new gt(Ee.layout_line["line-round-limit"]),"line-sort-key":new At(Ee.layout_line["line-sort-key"])})}};class Wn extends At{possiblyEvaluate(t,n){return n=new ur(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(t,n)}evaluate(t,n,o,c){return n=je({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(t,n,o,c)}}let ci;class xu extends s{constructor(t){super(t,bn),this.gradientVersion=0,ci||(ci=new Wn(bn.paint.properties["line-width"].specification),ci.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!(function(o){return o._styleExpression!==void 0})(n)&&n._styleExpression.expression instanceof $a,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,n){super.recalculate(t,n),this.paint._values["line-floorwidth"]=ci.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Vi(t)}queryRadius(t){const n=t,o=En(Tl("line-width",this,n),Tl("line-gap-width",this,n)),c=Tl("line-offset",this,n);return o/2+Math.abs(c)+uc(this.paint.get("line-translate"))}queryIntersectsFeature(t,n,o,c,m,g,x){const S=cc(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,x),P=x/2*En(this.paint.get("line-width").evaluate(n,o),this.paint.get("line-gap-width").evaluate(n,o)),z=this.paint.get("line-offset").evaluate(n,o);return z&&(c=(function(L,O){const V=[];for(let q=0;q<L.length;q++){const K=L[q],ne=[];for(let le=0;le<K.length;le++){const we=K[le-1],de=K[le],_e=K[le+1],Ae=le===0?new Y(0,0):de.sub(we)._unit()._perp(),Ue=le===K.length-1?new Y(0,0):_e.sub(de)._unit()._perp(),pt=Ae._add(Ue)._unit(),Lt=pt.x*Ue.x+pt.y*Ue.y;Lt!==0&&pt._mult(1/Lt),ne.push(pt._mult(O)._add(de))}V.push(ne)}return V})(c,z*x)),(function(L,O,V){for(let q=0;q<O.length;q++){const K=O[q];if(L.length>=3){for(let ne=0;ne<K.length;ne++)if(kl(L,K[ne]))return!0}if(uh(L,K,V))return!0}return!1})(S,c,P)}isTileClipped(){return!0}}function En(r,t){return t>0?t+2*r:r}const vc=w([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Cl=w([{name:"a_projected_pos",components:3,type:"Float32"}],4);w([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Ih=w([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);w([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Eh=w([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),xc=w([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Ui(r,t,n){return r.sections.forEach((o=>{o.text=(function(c,m,g){const x=m.layout.get("text-transform").evaluate(g,{});return x==="uppercase"?c=c.toLocaleUpperCase():x==="lowercase"&&(c=c.toLocaleLowerCase()),Cr.applyArabicShaping&&(c=Cr.applyArabicShaping(c)),c})(o.text,t,n)})),r}w([{name:"triangle",components:3,type:"Uint16"}]),w([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),w([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),w([{type:"Float32",name:"offsetX"}]),w([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),w([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Ml={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Kr=24,za=pr,wc=function(r,t,n,o,c){var m,g,x=8*c-o-1,S=(1<<x)-1,P=S>>1,z=-7,L=c-1,O=-1,V=r[t+L];for(L+=O,m=V&(1<<-z)-1,V>>=-z,z+=x;z>0;m=256*m+r[t+L],L+=O,z-=8);for(g=m&(1<<-z)-1,m>>=-z,z+=o;z>0;g=256*g+r[t+L],L+=O,z-=8);if(m===0)m=1-P;else{if(m===S)return g?NaN:1/0*(V?-1:1);g+=Math.pow(2,o),m-=P}return(V?-1:1)*g*Math.pow(2,m-o)},Ph=function(r,t,n,o,c,m){var g,x,S,P=8*m-c-1,z=(1<<P)-1,L=z>>1,O=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,V=0,q=1,K=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(x=isNaN(t)?1:0,g=z):(g=Math.floor(Math.log(t)/Math.LN2),t*(S=Math.pow(2,-g))<1&&(g--,S*=2),(t+=g+L>=1?O/S:O*Math.pow(2,1-L))*S>=2&&(g++,S/=2),g+L>=z?(x=0,g=z):g+L>=1?(x=(t*S-1)*Math.pow(2,c),g+=L):(x=t*Math.pow(2,L-1)*Math.pow(2,c),g=0));c>=8;r[n+V]=255&x,V+=q,x/=256,c-=8);for(g=g<<c|x,P+=c;P>0;r[n+V]=255&g,V+=q,g/=256,P-=8);r[n+V-q]|=128*K};function pr(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}pr.Varint=0,pr.Fixed64=1,pr.Bytes=2,pr.Fixed32=5;var wu=4294967296,no=1/wu,bc=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function ys(r){return r.type===pr.Bytes?r.readVarint()+r.pos:r.pos+1}function qo(r,t,n){return n?4294967296*t+(r>>>0):4294967296*(t>>>0)+(r>>>0)}function Sc(r,t,n){var o=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(o);for(var c=n.pos-1;c>=r;c--)n.buf[c+o]=n.buf[c]}function Ch(r,t){for(var n=0;n<r.length;n++)t.writeVarint(r[n])}function Ei(r,t){for(var n=0;n<r.length;n++)t.writeSVarint(r[n])}function Zo(r,t){for(var n=0;n<r.length;n++)t.writeFloat(r[n])}function sa(r,t){for(var n=0;n<r.length;n++)t.writeDouble(r[n])}function $i(r,t){for(var n=0;n<r.length;n++)t.writeBoolean(r[n])}function Lp(r,t){for(var n=0;n<r.length;n++)t.writeFixed32(r[n])}function Ed(r,t){for(var n=0;n<r.length;n++)t.writeSFixed32(r[n])}function Pd(r,t){for(var n=0;n<r.length;n++)t.writeFixed64(r[n])}function Df(r,t){for(var n=0;n<r.length;n++)t.writeSFixed64(r[n])}function aa(r,t){return(r[t]|r[t+1]<<8|r[t+2]<<16)+16777216*r[t+3]}function Al(r,t,n){r[n]=t,r[n+1]=t>>>8,r[n+2]=t>>>16,r[n+3]=t>>>24}function Mh(r,t){return(r[t]|r[t+1]<<8|r[t+2]<<16)+(r[t+3]<<24)}pr.prototype={destroy:function(){this.buf=null},readFields:function(r,t,n){for(n=n||this.length;this.pos<n;){var o=this.readVarint(),c=o>>3,m=this.pos;this.type=7&o,r(c,t,this),this.pos===m&&this.skip(o)}return t},readMessage:function(r,t){return this.readFields(r,t,this.readVarint()+this.pos)},readFixed32:function(){var r=aa(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=Mh(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=aa(this.buf,this.pos)+aa(this.buf,this.pos+4)*wu;return this.pos+=8,r},readSFixed64:function(){var r=aa(this.buf,this.pos)+Mh(this.buf,this.pos+4)*wu;return this.pos+=8,r},readFloat:function(){var r=wc(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=wc(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var t,n,o=this.buf;return t=127&(n=o[this.pos++]),n<128?t:(t|=(127&(n=o[this.pos++]))<<7,n<128?t:(t|=(127&(n=o[this.pos++]))<<14,n<128?t:(t|=(127&(n=o[this.pos++]))<<21,n<128?t:(function(c,m,g){var x,S,P=g.buf;if(x=(112&(S=P[g.pos++]))>>4,S<128||(x|=(127&(S=P[g.pos++]))<<3,S<128)||(x|=(127&(S=P[g.pos++]))<<10,S<128)||(x|=(127&(S=P[g.pos++]))<<17,S<128)||(x|=(127&(S=P[g.pos++]))<<24,S<128)||(x|=(1&(S=P[g.pos++]))<<31,S<128))return qo(c,x,m);throw new Error("Expected varint not more than 10 bytes")})(t|=(15&(n=o[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var r=this.readVarint()+this.pos,t=this.pos;return this.pos=r,r-t>=12&&bc?(function(n,o,c){return bc.decode(n.subarray(o,c))})(this.buf,t,r):(function(n,o,c){for(var m="",g=o;g<c;){var x,S,P,z=n[g],L=null,O=z>239?4:z>223?3:z>191?2:1;if(g+O>c)break;O===1?z<128&&(L=z):O===2?(192&(x=n[g+1]))==128&&(L=(31&z)<<6|63&x)<=127&&(L=null):O===3?(S=n[g+2],(192&(x=n[g+1]))==128&&(192&S)==128&&((L=(15&z)<<12|(63&x)<<6|63&S)<=2047||L>=55296&&L<=57343)&&(L=null)):O===4&&(S=n[g+2],P=n[g+3],(192&(x=n[g+1]))==128&&(192&S)==128&&(192&P)==128&&((L=(15&z)<<18|(63&x)<<12|(63&S)<<6|63&P)<=65535||L>=1114112)&&(L=null)),L===null?(L=65533,O=1):L>65535&&(L-=65536,m+=String.fromCharCode(L>>>10&1023|55296),L=56320|1023&L),m+=String.fromCharCode(L),g+=O}return m})(this.buf,t,r)},readBytes:function(){var r=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,r);return this.pos=r,t},readPackedVarint:function(r,t){if(this.type!==pr.Bytes)return r.push(this.readVarint(t));var n=ys(this);for(r=r||[];this.pos<n;)r.push(this.readVarint(t));return r},readPackedSVarint:function(r){if(this.type!==pr.Bytes)return r.push(this.readSVarint());var t=ys(this);for(r=r||[];this.pos<t;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==pr.Bytes)return r.push(this.readBoolean());var t=ys(this);for(r=r||[];this.pos<t;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==pr.Bytes)return r.push(this.readFloat());var t=ys(this);for(r=r||[];this.pos<t;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==pr.Bytes)return r.push(this.readDouble());var t=ys(this);for(r=r||[];this.pos<t;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==pr.Bytes)return r.push(this.readFixed32());var t=ys(this);for(r=r||[];this.pos<t;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==pr.Bytes)return r.push(this.readSFixed32());var t=ys(this);for(r=r||[];this.pos<t;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==pr.Bytes)return r.push(this.readFixed64());var t=ys(this);for(r=r||[];this.pos<t;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==pr.Bytes)return r.push(this.readSFixed64());var t=ys(this);for(r=r||[];this.pos<t;)r.push(this.readSFixed64());return r},skip:function(r){var t=7&r;if(t===pr.Varint)for(;this.buf[this.pos++]>127;);else if(t===pr.Bytes)this.pos=this.readVarint()+this.pos;else if(t===pr.Fixed32)this.pos+=4;else{if(t!==pr.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(r,t){this.writeVarint(r<<3|t)},realloc:function(r){for(var t=this.length||16;t<this.pos+r;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),Al(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),Al(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),Al(this.buf,-1&r,this.pos),Al(this.buf,Math.floor(r*no),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),Al(this.buf,-1&r,this.pos),Al(this.buf,Math.floor(r*no),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?(function(t,n){var o,c;if(t>=0?(o=t%4294967296|0,c=t/4294967296|0):(c=~(-t/4294967296),4294967295^(o=~(-t%4294967296))?o=o+1|0:(o=0,c=c+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),(function(m,g,x){x.buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,x.buf[x.pos]=127&(m>>>=7)})(o,0,n),(function(m,g){var x=(7&m)<<4;g.buf[g.pos++]|=x|((m>>>=3)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m)))))})(c,n)})(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(!!r)},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var t=this.pos;this.pos=(function(o,c,m){for(var g,x,S=0;S<c.length;S++){if((g=c.charCodeAt(S))>55295&&g<57344){if(!x){g>56319||S+1===c.length?(o[m++]=239,o[m++]=191,o[m++]=189):x=g;continue}if(g<56320){o[m++]=239,o[m++]=191,o[m++]=189,x=g;continue}g=x-55296<<10|g-56320|65536,x=null}else x&&(o[m++]=239,o[m++]=191,o[m++]=189,x=null);g<128?o[m++]=g:(g<2048?o[m++]=g>>6|192:(g<65536?o[m++]=g>>12|224:(o[m++]=g>>18|240,o[m++]=g>>12&63|128),o[m++]=g>>6&63|128),o[m++]=63&g|128)}return m})(this.buf,r,this.pos);var n=this.pos-t;n>=128&&Sc(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(r){this.realloc(4),Ph(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),Ph(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var t=r.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=r[n]},writeRawMessage:function(r,t){this.pos++;var n=this.pos;r(t,this);var o=this.pos-n;o>=128&&Sc(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o},writeMessage:function(r,t,n){this.writeTag(r,pr.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(r,t){t.length&&this.writeMessage(r,Ch,t)},writePackedSVarint:function(r,t){t.length&&this.writeMessage(r,Ei,t)},writePackedBoolean:function(r,t){t.length&&this.writeMessage(r,$i,t)},writePackedFloat:function(r,t){t.length&&this.writeMessage(r,Zo,t)},writePackedDouble:function(r,t){t.length&&this.writeMessage(r,sa,t)},writePackedFixed32:function(r,t){t.length&&this.writeMessage(r,Lp,t)},writePackedSFixed32:function(r,t){t.length&&this.writeMessage(r,Ed,t)},writePackedFixed64:function(r,t){t.length&&this.writeMessage(r,Pd,t)},writePackedSFixed64:function(r,t){t.length&&this.writeMessage(r,Df,t)},writeBytesField:function(r,t){this.writeTag(r,pr.Bytes),this.writeBytes(t)},writeFixed32Field:function(r,t){this.writeTag(r,pr.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(r,t){this.writeTag(r,pr.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(r,t){this.writeTag(r,pr.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(r,t){this.writeTag(r,pr.Fixed64),this.writeSFixed64(t)},writeVarintField:function(r,t){this.writeTag(r,pr.Varint),this.writeVarint(t)},writeSVarintField:function(r,t){this.writeTag(r,pr.Varint),this.writeSVarint(t)},writeStringField:function(r,t){this.writeTag(r,pr.Bytes),this.writeString(t)},writeFloatField:function(r,t){this.writeTag(r,pr.Fixed32),this.writeFloat(t)},writeDoubleField:function(r,t){this.writeTag(r,pr.Fixed64),this.writeDouble(t)},writeBooleanField:function(r,t){this.writeVarintField(r,!!t)}};var io=X(za);const kc=3;function zl(r,t,n){r===1&&n.readMessage(Rp,t)}function Rp(r,t,n){if(r===3){const{id:o,bitmap:c,width:m,height:g,left:x,top:S,advance:P}=n.readMessage(Bp,{});t.push({id:o,bitmap:new Il({width:m+2*kc,height:g+2*kc},c),metrics:{width:m,height:g,left:x,top:S,advance:P}})}}function Bp(r,t,n){r===1?t.id=n.readVarint():r===2?t.bitmap=n.readBytes():r===3?t.width=n.readVarint():r===4?t.height=n.readVarint():r===5?t.left=n.readSVarint():r===6?t.top=n.readSVarint():r===7&&(t.advance=n.readVarint())}const Ah=kc;function Tc(r){let t=0,n=0;for(const g of r)t+=g.w*g.h,n=Math.max(n,g.w);r.sort(((g,x)=>x.h-g.h));const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let c=0,m=0;for(const g of r)for(let x=o.length-1;x>=0;x--){const S=o[x];if(!(g.w>S.w||g.h>S.h)){if(g.x=S.x,g.y=S.y,m=Math.max(m,g.y+g.h),c=Math.max(c,g.x+g.w),g.w===S.w&&g.h===S.h){const P=o.pop();x<o.length&&(o[x]=P)}else g.h===S.h?(S.x+=g.w,S.w-=g.w):g.w===S.w?(S.y+=g.h,S.h-=g.h):(o.push({x:S.x+g.w,y:S.y,w:S.w-g.w,h:g.h}),S.y+=g.h,S.h-=g.h);break}}return{w:c,h:m,fill:t/(c*m)||0}}const Pi=1;class Cd{constructor(t,{pixelRatio:n,version:o,stretchX:c,stretchY:m,content:g,textFitWidth:x,textFitHeight:S}){this.paddedRect=t,this.pixelRatio=n,this.stretchX=c,this.stretchY=m,this.content=g,this.version=o,this.textFitWidth=x,this.textFitHeight=S}get tl(){return[this.paddedRect.x+Pi,this.paddedRect.y+Pi]}get br(){return[this.paddedRect.x+this.paddedRect.w-Pi,this.paddedRect.y+this.paddedRect.h-Pi]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Pi)/this.pixelRatio,(this.paddedRect.h-2*Pi)/this.pixelRatio]}}class Md{constructor(t,n){const o={},c={};this.haveRenderCallbacks=[];const m=[];this.addImages(t,o,m),this.addImages(n,c,m);const{w:g,h:x}=Tc(m),S=new Fn({width:g||1,height:x||1});for(const P in t){const z=t[P],L=o[P].paddedRect;Fn.copy(z.data,S,{x:0,y:0},{x:L.x+Pi,y:L.y+Pi},z.data)}for(const P in n){const z=n[P],L=c[P].paddedRect,O=L.x+Pi,V=L.y+Pi,q=z.data.width,K=z.data.height;Fn.copy(z.data,S,{x:0,y:0},{x:O,y:V},z.data),Fn.copy(z.data,S,{x:0,y:K-1},{x:O,y:V-1},{width:q,height:1}),Fn.copy(z.data,S,{x:0,y:0},{x:O,y:V+K},{width:q,height:1}),Fn.copy(z.data,S,{x:q-1,y:0},{x:O-1,y:V},{width:1,height:K}),Fn.copy(z.data,S,{x:0,y:0},{x:O+q,y:V},{width:1,height:K})}this.image=S,this.iconPositions=o,this.patternPositions=c}addImages(t,n,o){for(const c in t){const m=t[c],g={x:0,y:0,w:m.data.width+2*Pi,h:m.data.height+2*Pi};o.push(g),n[c]=new Cd(g,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(t,n){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in t.updatedImages)this.patchUpdatedImage(this.iconPositions[o],t.getImage(o),n),this.patchUpdatedImage(this.patternPositions[o],t.getImage(o),n)}patchUpdatedImage(t,n,o){if(!t||!n||t.version===n.version)return;t.version=n.version;const[c,m]=t.tl;o.update(n.data,void 0,{x:c,y:m})}}var so;mt("ImagePosition",Cd),mt("ImageAtlas",Md),T.ah=void 0,(so=T.ah||(T.ah={}))[so.none=0]="none",so[so.horizontal=1]="horizontal",so[so.vertical=2]="vertical",so[so.horizontalOnly=3]="horizontalOnly";const oa=-17;class Ic{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,n){const o=new Ic;return o.scale=t||1,o.fontStack=n,o}static forImage(t){const n=new Ic;return n.imageName=t,n}}class la{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,n){const o=new la;for(let c=0;c<t.sections.length;c++){const m=t.sections[c];m.image?o.addImageSection(m):o.addTextSection(m,n)}return o}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=(function(t){let n="";for(let o=0;o<t.length;o++){const c=t.charCodeAt(o+1)||null,m=t.charCodeAt(o-1)||null;n+=c&&ro(c)&&!Ml[t[o+1]]||m&&ro(m)&&!Ml[t[o-1]]||!Ml[t[o]]?t[o]:Ml[t[o]]}return n})(this.text)}trim(){let t=0;for(let o=0;o<this.text.length&&Qr[this.text.charCodeAt(o)];o++)t++;let n=this.text.length;for(let o=this.text.length-1;o>=0&&o>=t&&Qr[this.text.charCodeAt(o)];o--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)}substring(t,n){const o=new la;return o.text=this.text.substring(t,n),o.sectionIndex=this.sectionIndex.slice(t,n),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,n)=>Math.max(t,this.sections[n].scale)),0)}addTextSection(t,n){this.text+=t.text,this.sections.push(Ic.forText(t.scale,t.fontStack||n));const o=this.sections.length-1;for(let c=0;c<t.text.length;++c)this.sectionIndex.push(o)}addImageSection(t){const n=t.image?t.image.name:"";if(n.length===0)return void Rt("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(Ic.forImage(n)),this.sectionIndex.push(this.sections.length-1)):Rt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ec(r,t,n,o,c,m,g,x,S,P,z,L,O,V,q){const K=la.fromFeature(r,c);let ne;L===T.ah.vertical&&K.verticalizePunctuation();const{processBidirectionalText:le,processStyledBidirectionalText:we}=Cr;if(le&&K.sections.length===1){ne=[];const Ae=le(K.toString(),qi(K,P,m,t,o,V));for(const Ue of Ae){const pt=new la;pt.text=Ue,pt.sections=K.sections;for(let Lt=0;Lt<Ue.length;Lt++)pt.sectionIndex.push(0);ne.push(pt)}}else if(we){ne=[];const Ae=we(K.text,K.sectionIndex,qi(K,P,m,t,o,V));for(const Ue of Ae){const pt=new la;pt.text=Ue[0],pt.sectionIndex=Ue[1],pt.sections=K.sections,ne.push(pt)}}else ne=(function(Ae,Ue){const pt=[],Lt=Ae.text;let dt=0;for(const ot of Ue)pt.push(Ae.substring(dt,ot)),dt=ot;return dt<Lt.length&&pt.push(Ae.substring(dt,Lt.length)),pt})(K,qi(K,P,m,t,o,V));const de=[],_e={positionedLines:de,text:K.toString(),top:z[1],bottom:z[1],left:z[0],right:z[0],writingMode:L,iconsInText:!1,verticalizable:!1};return(function(Ae,Ue,pt,Lt,dt,ot,kt,xt,yt,Be,It,St){let $t=0,Ur=oa,Fr=0,On=0;const La=xt==="right"?1:xt==="left"?0:.5;let di=0;for(const pn of dt){pn.trim();const jn=pn.getMaxScale(),Ci=(jn-1)*Kr,pi={positionedGlyphs:[],lineOffset:0};Ae.positionedLines[di]=pi;const Ki=pi.positionedGlyphs;let fi=0;if(!pn.length()){Ur+=ot,++di;continue}for(let _s=0;_s<pn.length();_s++){const wr=pn.getSection(_s),Zr=pn.getSectionIndex(_s),Wr=pn.getCharCode(_s);let Bs=0,cn=null,jh=null,Wo=null,Xo=Kr;const Ra=!(yt===T.ah.horizontal||!It&&!wl(Wr)||It&&(Qr[Wr]||(Nn=Wr,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(Nn)))));if(wr.imageName){const ca=Lt[wr.imageName];if(!ca)continue;Wo=wr.imageName,Ae.iconsInText=Ae.iconsInText||!0,jh=ca.paddedRect;const Xn=ca.displaySize;wr.scale=wr.scale*Kr/St,cn={width:Xn[0],height:Xn[1],left:Pi,top:-Ah,advance:Ra?Xn[1]:Xn[0]},Bs=Ci+(Kr-Xn[1]*wr.scale),Xo=cn.advance;const Ll=Ra?Xn[0]*wr.scale-Kr*jn:Xn[1]*wr.scale-Kr*jn;Ll>0&&Ll>fi&&(fi=Ll)}else{const ca=pt[wr.fontStack],Xn=ca&&ca[Wr];if(Xn&&Xn.rect)jh=Xn.rect,cn=Xn.metrics;else{const Ll=Ue[wr.fontStack],Bd=Ll&&Ll[Wr];if(!Bd)continue;cn=Bd.metrics}Bs=(jn-wr.scale)*Kr}Ra?(Ae.verticalizable=!0,Ki.push({glyph:Wr,imageName:Wo,x:$t,y:Ur+Bs,vertical:Ra,scale:wr.scale,fontStack:wr.fontStack,sectionIndex:Zr,metrics:cn,rect:jh}),$t+=Xo*wr.scale+Be):(Ki.push({glyph:Wr,imageName:Wo,x:$t,y:Ur+Bs,vertical:Ra,scale:wr.scale,fontStack:wr.fontStack,sectionIndex:Zr,metrics:cn,rect:jh}),$t+=cn.advance*wr.scale+Be)}Ki.length!==0&&(Fr=Math.max($t-Be,Fr),Rf(Ki,0,Ki.length-1,La,fi)),$t=0;const ua=ot*jn+fi;pi.lineOffset=Math.max(fi,Ci),Ur+=ua,On=Math.max(ua,On),++di}var Nn;const Zi=Ur-oa,{horizontalAlign:Gi,verticalAlign:Hi}=Pc(kt);(function(pn,jn,Ci,pi,Ki,fi,ua,_s,wr){const Zr=(jn-Ci)*Ki;let Wr=0;Wr=fi!==ua?-_s*pi-oa:(-pi*wr+.5)*ua;for(const Bs of pn)for(const cn of Bs.positionedGlyphs)cn.x+=Zr,cn.y+=Wr})(Ae.positionedLines,La,Gi,Hi,Fr,On,ot,Zi,dt.length),Ae.top+=-Hi*Zi,Ae.bottom=Ae.top+Zi,Ae.left+=-Gi*Fr,Ae.right=Ae.left+Fr})(_e,t,n,o,ne,g,x,S,L,P,O,q),!(function(Ae){for(const Ue of Ae)if(Ue.positionedGlyphs.length!==0)return!1;return!0})(de)&&_e}const Qr={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Lf={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Fp={40:!0};function Op(r,t,n,o,c,m){if(t.imageName){const g=o[t.imageName];return g?g.displaySize[0]*t.scale*Kr/m+c:0}{const g=n[t.fontStack],x=g&&g[r];return x?x.metrics.advance*t.scale+c:0}}function Np(r,t,n,o){const c=Math.pow(r-t,2);return o?r<t?c/2:2*c:c+Math.abs(n)*n}function jp(r,t,n){let o=0;return r===10&&(o-=1e4),n&&(o+=150),r!==40&&r!==65288||(o+=50),t!==41&&t!==65289||(o+=50),o}function Ad(r,t,n,o,c,m){let g=null,x=Np(t,n,c,m);for(const S of o){const P=Np(t-S.x,n,c,m)+S.badness;P<=x&&(g=S,x=P)}return{index:r,x:t,priorBreak:g,badness:x}}function Vp(r){return r?Vp(r.priorBreak).concat(r.index):[]}function qi(r,t,n,o,c,m){if(!r)return[];const g=[],x=(function(L,O,V,q,K,ne){let le=0;for(let we=0;we<L.length();we++){const de=L.getSection(we);le+=Op(L.getCharCode(we),de,q,K,O,ne)}return le/Math.max(1,Math.ceil(le/V))})(r,t,n,o,c,m),S=r.text.indexOf("")>=0;let P=0;for(let L=0;L<r.length();L++){const O=r.getSection(L),V=r.getCharCode(L);if(Qr[V]||(P+=Op(V,O,o,c,t,m)),L<r.length()-1){const q=!((z=V)<11904)&&(!!or["CJK Compatibility Forms"](z)||!!or["CJK Compatibility"](z)||!!or["CJK Strokes"](z)||!!or["CJK Symbols and Punctuation"](z)||!!or["Enclosed CJK Letters and Months"](z)||!!or["Halfwidth and Fullwidth Forms"](z)||!!or["Ideographic Description Characters"](z)||!!or["Vertical Forms"](z)||xl.test(String.fromCodePoint(z)));(Lf[V]||q||O.imageName||L!==r.length()-2&&Fp[r.getCharCode(L+1)])&&g.push(Ad(L+1,P,x,g,jp(V,r.getCharCode(L+1),q&&S),!1))}}var z;return Vp(Ad(r.length(),P,x,g,0,!0))}function Pc(r){let t=.5,n=.5;switch(r){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function Rf(r,t,n,o,c){if(!o&&!c)return;const m=r[n],g=(r[n].x+m.metrics.advance*m.scale)*o;for(let x=t;x<=n;x++)r[x].x-=g,r[x].y+=c}function Go(r,t,n){const{horizontalAlign:o,verticalAlign:c}=Pc(n),m=t[0]-r.displaySize[0]*o,g=t[1]-r.displaySize[1]*c;return{image:r,top:g,bottom:g+r.displaySize[1],left:m,right:m+r.displaySize[0]}}function Cc(r){var t,n;let o=r.left,c=r.top,m=r.right-o,g=r.bottom-c;const x=(t=r.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",S=(n=r.image.textFitHeight)!==null&&n!==void 0?n:"stretchOrShrink",P=(r.image.content[2]-r.image.content[0])/(r.image.content[3]-r.image.content[1]);if(S==="proportional"){if(x==="stretchOnly"&&m/g<P||x==="proportional"){const z=Math.ceil(g*P);o*=z/m,m=z}}else if(x==="proportional"&&S==="stretchOnly"&&P!==0&&m/g>P){const z=Math.ceil(m/P);c*=z/g,g=z}return{x1:o,y1:c,x2:o+m,y2:c+g}}function Ho(r,t,n,o,c,m){const g=r.image;let x;if(g.content){const ne=g.content,le=g.pixelRatio||1;x=[ne[0]/le,ne[1]/le,g.displaySize[0]-ne[2]/le,g.displaySize[1]-ne[3]/le]}const S=t.left*m,P=t.right*m;let z,L,O,V;n==="width"||n==="both"?(V=c[0]+S-o[3],L=c[0]+P+o[1]):(V=c[0]+(S+P-g.displaySize[0])/2,L=V+g.displaySize[0]);const q=t.top*m,K=t.bottom*m;return n==="height"||n==="both"?(z=c[1]+q-o[0],O=c[1]+K+o[2]):(z=c[1]+(q+K-g.displaySize[1])/2,O=z+g.displaySize[1]),{image:g,top:z,right:L,bottom:O,left:V,collisionPadding:x}}const Ko=255,Rs=128,Da=Ko*Rs;function Up(r,t){const{expression:n}=t;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new ur(r+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:c}=n;let m=0;for(;m<o.length&&o[m]<=r;)m++;m=Math.max(0,m-1);let g=m;for(;g<o.length&&o[g]<r+1;)g++;g=Math.min(o.length-1,g);const x=o[m],S=o[g];return n.kind==="composite"?{kind:"composite",minZoom:x,maxZoom:S,interpolationType:c}:{kind:"camera",minZoom:x,maxZoom:S,minSize:n.evaluate(new ur(x)),maxSize:n.evaluate(new ur(S)),interpolationType:c}}}function Mc(r,t,n){let o="never";const c=r.get(t);return c?o=c:r.get(n)&&(o="always"),o}const Bf=Vo.VectorTileFeature.types,$p=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ac(r,t,n,o,c,m,g,x,S,P,z,L,O){const V=x?Math.min(Da,Math.round(x[0])):0,q=x?Math.min(Da,Math.round(x[1])):0;r.emplaceBack(t,n,Math.round(32*o),Math.round(32*c),m,g,(V<<1)+(S?1:0),q,16*P,16*z,256*L,256*O)}function bu(r,t,n){r.emplaceBack(t.x,t.y,n),r.emplaceBack(t.x,t.y,n),r.emplaceBack(t.x,t.y,n),r.emplaceBack(t.x,t.y,n)}function zh(r){for(const t of r.sections)if(Pa(t.text))return!0;return!1}class Dh{constructor(t){this.layoutVertexArray=new Oi,this.indexArray=new Ni,this.programConfigurations=t,this.segments=new nr,this.dynamicLayoutVertexArray=new zs,this.opacityVertexArray=new Hn,this.hasVisibleVertices=!1,this.placedSymbolArray=new Pr}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,n,o,c){this.isEmpty()||(o&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,vc.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Cl.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,$p,!0),this.opacityVertexBuffer.itemSize=1),(o||c)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}mt("SymbolBuffers",Dh);class zc{constructor(t,n,o){this.layoutVertexArray=new t,this.layoutAttributes=n,this.indexArray=new o,this.segments=new nr,this.collisionVertexArray=new cs}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Ih.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}mt("CollisionBuffers",zc);class Su{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((g=>g.id)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ch([]),this.placementViewportMatrix=ch([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Up(this.zoom,n["text-size"]),this.iconSizeData=Up(this.zoom,n["icon-size"]);const o=this.layers[0].layout,c=o.get("symbol-sort-key"),m=o.get("symbol-z-order");this.canOverlap=Mc(o,"text-overlap","text-allow-overlap")!=="never"||Mc(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&!c.isConstant(),this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map((g=>T.ah[g]))),this.stateDependentLayerIds=this.layers.filter((g=>g.isStateDependent())).map((g=>g.id)),this.sourceID=t.sourceID}createArrays(){this.text=new Dh(new na(this.layers,this.zoom,(t=>/^text/.test(t)))),this.icon=new Dh(new na(this.layers,this.zoom,(t=>/^icon/.test(t)))),this.glyphOffsetArray=new Mr,this.lineVertexArray=new Tn,this.symbolInstances=new Qt,this.textAnchorOffsets=new Ar}calculateGlyphDependencies(t,n,o,c,m){for(let g=0;g<t.length;g++)if(n[t.charCodeAt(g)]=!0,(o||c)&&m){const x=Ml[t.charAt(g)];x&&(n[x.charCodeAt(0)]=!0)}}populate(t,n,o){const c=this.layers[0],m=c.layout,g=m.get("text-font"),x=m.get("text-field"),S=m.get("icon-image"),P=(x.value.kind!=="constant"||x.value.value instanceof Qn&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),z=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,L=m.get("symbol-sort-key");if(this.features=[],!P&&!z)return;const O=n.iconDependencies,V=n.glyphDependencies,q=n.availableImages,K=new ur(this.zoom);for(const{feature:ne,id:le,index:we,sourceLayerIndex:de}of t){const _e=c._featureFilter.needGeometry,Ae=No(ne,_e);if(!c._featureFilter.filter(K,Ae,o))continue;let Ue,pt;if(_e||(Ae.geometry=Oo(ne)),P){const dt=c.getValueAndResolveTokens("text-field",Ae,o,q),ot=Qn.factory(dt),kt=this.hasRTLText=this.hasRTLText||zh(ot);(!kt||Cr.getRTLTextPluginStatus()==="unavailable"||kt&&Cr.isParsed())&&(Ue=Ui(ot,c,Ae))}if(z){const dt=c.getValueAndResolveTokens("icon-image",Ae,o,q);pt=dt instanceof Bn?dt:Bn.fromString(dt)}if(!Ue&&!pt)continue;const Lt=this.sortFeaturesByKey?L.evaluate(Ae,{},o):void 0;if(this.features.push({id:le,text:Ue,icon:pt,index:we,sourceLayerIndex:de,geometry:Ae.geometry,properties:ne.properties,type:Bf[ne.type],sortKey:Lt}),pt&&(O[pt.name]=!0),Ue){const dt=g.evaluate(Ae,{},o).join(","),ot=m.get("text-rotation-alignment")!=="viewport"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(T.ah.vertical)>=0;for(const kt of Ue.sections)if(kt.image)O[kt.image.name]=!0;else{const xt=ec(Ue.toString()),yt=kt.fontStack||dt,Be=V[yt]=V[yt]||{};this.calculateGlyphDependencies(kt.text,Be,ot,this.allowVerticalPlacement,xt)}}}m.get("symbol-placement")==="line"&&(this.features=(function(ne){const le={},we={},de=[];let _e=0;function Ae(dt){de.push(ne[dt]),_e++}function Ue(dt,ot,kt){const xt=we[dt];return delete we[dt],we[ot]=xt,de[xt].geometry[0].pop(),de[xt].geometry[0]=de[xt].geometry[0].concat(kt[0]),xt}function pt(dt,ot,kt){const xt=le[ot];return delete le[ot],le[dt]=xt,de[xt].geometry[0].shift(),de[xt].geometry[0]=kt[0].concat(de[xt].geometry[0]),xt}function Lt(dt,ot,kt){const xt=kt?ot[0][ot[0].length-1]:ot[0][0];return`${dt}:${xt.x}:${xt.y}`}for(let dt=0;dt<ne.length;dt++){const ot=ne[dt],kt=ot.geometry,xt=ot.text?ot.text.toString():null;if(!xt){Ae(dt);continue}const yt=Lt(xt,kt),Be=Lt(xt,kt,!0);if(yt in we&&Be in le&&we[yt]!==le[Be]){const It=pt(yt,Be,kt),St=Ue(yt,Be,de[It].geometry);delete le[yt],delete we[Be],we[Lt(xt,de[St].geometry,!0)]=St,de[It].geometry=null}else yt in we?Ue(yt,Be,kt):Be in le?pt(yt,Be,kt):(Ae(dt),le[yt]=_e-1,we[Be]=_e-1)}return de.filter((dt=>dt.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((ne,le)=>ne.sortKey-le.sortKey))}update(t,n,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,n,this.layers,o),this.icon.programConfigurations.updatePaintArrays(t,n,this.layers,o))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,n){const o=this.lineVertexArray.length;if(t.segment!==void 0){let c=t.dist(n[t.segment+1]),m=t.dist(n[t.segment]);const g={};for(let x=t.segment+1;x<n.length;x++)g[x]={x:n[x].x,y:n[x].y,tileUnitDistanceFromAnchor:c},x<n.length-1&&(c+=n[x+1].dist(n[x]));for(let x=t.segment||0;x>=0;x--)g[x]={x:n[x].x,y:n[x].y,tileUnitDistanceFromAnchor:m},x>0&&(m+=n[x-1].dist(n[x]));for(let x=0;x<n.length;x++){const S=g[x];this.lineVertexArray.emplaceBack(S.x,S.y,S.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(t,n,o,c,m,g,x,S,P,z,L,O){const V=t.indexArray,q=t.layoutVertexArray,K=t.segments.prepareSegment(4*n.length,q,V,this.canOverlap?g.sortKey:void 0),ne=this.glyphOffsetArray.length,le=K.vertexLength,we=this.allowVerticalPlacement&&x===T.ah.vertical?Math.PI/2:0,de=g.text&&g.text.sections;for(let _e=0;_e<n.length;_e++){const{tl:Ae,tr:Ue,bl:pt,br:Lt,tex:dt,pixelOffsetTL:ot,pixelOffsetBR:kt,minFontScaleX:xt,minFontScaleY:yt,glyphOffset:Be,isSDF:It,sectionIndex:St}=n[_e],$t=K.vertexLength,Ur=Be[1];Ac(q,S.x,S.y,Ae.x,Ur+Ae.y,dt.x,dt.y,o,It,ot.x,ot.y,xt,yt),Ac(q,S.x,S.y,Ue.x,Ur+Ue.y,dt.x+dt.w,dt.y,o,It,kt.x,ot.y,xt,yt),Ac(q,S.x,S.y,pt.x,Ur+pt.y,dt.x,dt.y+dt.h,o,It,ot.x,kt.y,xt,yt),Ac(q,S.x,S.y,Lt.x,Ur+Lt.y,dt.x+dt.w,dt.y+dt.h,o,It,kt.x,kt.y,xt,yt),bu(t.dynamicLayoutVertexArray,S,we),V.emplaceBack($t,$t+1,$t+2),V.emplaceBack($t+1,$t+2,$t+3),K.vertexLength+=4,K.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Be[0]),_e!==n.length-1&&St===n[_e+1].sectionIndex||t.programConfigurations.populatePaintArrays(q.length,g,g.index,{},O,de&&de[St])}t.placedSymbolArray.emplaceBack(S.x,S.y,ne,this.glyphOffsetArray.length-ne,le,P,z,S.segment,o?o[0]:0,o?o[1]:0,c[0],c[1],x,0,!1,0,L)}_addCollisionDebugVertex(t,n,o,c,m,g){return n.emplaceBack(0,0),t.emplaceBack(o.x,o.y,c,m,Math.round(g.x),Math.round(g.y))}addCollisionDebugVertices(t,n,o,c,m,g,x){const S=m.segments.prepareSegment(4,m.layoutVertexArray,m.indexArray),P=S.vertexLength,z=m.layoutVertexArray,L=m.collisionVertexArray,O=x.anchorX,V=x.anchorY;this._addCollisionDebugVertex(z,L,g,O,V,new Y(t,n)),this._addCollisionDebugVertex(z,L,g,O,V,new Y(o,n)),this._addCollisionDebugVertex(z,L,g,O,V,new Y(o,c)),this._addCollisionDebugVertex(z,L,g,O,V,new Y(t,c)),S.vertexLength+=4;const q=m.indexArray;q.emplaceBack(P,P+1),q.emplaceBack(P+1,P+2),q.emplaceBack(P+2,P+3),q.emplaceBack(P+3,P),S.primitiveLength+=4}addDebugCollisionBoxes(t,n,o,c){for(let m=t;m<n;m++){const g=this.collisionBoxArray.get(m);this.addCollisionDebugVertices(g.x1,g.y1,g.x2,g.y2,c?this.textCollisionBox:this.iconCollisionBox,g.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new zc(ki,Eh.members,ln),this.iconCollisionBox=new zc(ki,Eh.members,ln);for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(t,n,o,c,m,g,x,S,P){const z={};for(let L=n;L<o;L++){const O=t.get(L);z.textBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},z.textFeatureIndex=O.featureIndex;break}for(let L=c;L<m;L++){const O=t.get(L);z.verticalTextBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},z.verticalTextFeatureIndex=O.featureIndex;break}for(let L=g;L<x;L++){const O=t.get(L);z.iconBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},z.iconFeatureIndex=O.featureIndex;break}for(let L=S;L<P;L++){const O=t.get(L);z.verticalIconBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},z.verticalIconFeatureIndex=O.featureIndex;break}return z}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,n){const o=t.placedSymbolArray.get(n),c=o.vertexStartIndex+4*o.numGlyphs;for(let m=o.vertexStartIndex;m<c;m+=4)t.indexArray.emplaceBack(m,m+1,m+2),t.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(t),o=Math.cos(t),c=[],m=[],g=[];for(let x=0;x<this.symbolInstances.length;++x){g.push(x);const S=this.symbolInstances.get(x);c.push(0|Math.round(n*S.anchorX+o*S.anchorY)),m.push(S.featureIndex)}return g.sort(((x,S)=>c[x]-c[S]||m[S]-m[x])),g}addToSortKeyRanges(t,n){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===n?o.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const o=this.symbolInstances.get(n);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach(((c,m,g)=>{c>=0&&g.indexOf(c)===m&&this.addIndicesForPlacedSymbol(this.text,c)})),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let zd,Lh;mt("SymbolBucket",Su,{omit:["layers","collisionBoxArray","features","compareText"]}),Su.MAX_GLYPHS=65535,Su.addDynamicAttributes=bu;var ku={get paint(){return Lh=Lh||new f({"icon-opacity":new At(Ee.paint_symbol["icon-opacity"]),"icon-color":new At(Ee.paint_symbol["icon-color"]),"icon-halo-color":new At(Ee.paint_symbol["icon-halo-color"]),"icon-halo-width":new At(Ee.paint_symbol["icon-halo-width"]),"icon-halo-blur":new At(Ee.paint_symbol["icon-halo-blur"]),"icon-translate":new gt(Ee.paint_symbol["icon-translate"]),"icon-translate-anchor":new gt(Ee.paint_symbol["icon-translate-anchor"]),"text-opacity":new At(Ee.paint_symbol["text-opacity"]),"text-color":new At(Ee.paint_symbol["text-color"],{runtimeType:Ln,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new At(Ee.paint_symbol["text-halo-color"]),"text-halo-width":new At(Ee.paint_symbol["text-halo-width"]),"text-halo-blur":new At(Ee.paint_symbol["text-halo-blur"]),"text-translate":new gt(Ee.paint_symbol["text-translate"]),"text-translate-anchor":new gt(Ee.paint_symbol["text-translate-anchor"])})},get layout(){return zd=zd||new f({"symbol-placement":new gt(Ee.layout_symbol["symbol-placement"]),"symbol-spacing":new gt(Ee.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new gt(Ee.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new At(Ee.layout_symbol["symbol-sort-key"]),"symbol-z-order":new gt(Ee.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new gt(Ee.layout_symbol["icon-allow-overlap"]),"icon-overlap":new gt(Ee.layout_symbol["icon-overlap"]),"icon-ignore-placement":new gt(Ee.layout_symbol["icon-ignore-placement"]),"icon-optional":new gt(Ee.layout_symbol["icon-optional"]),"icon-rotation-alignment":new gt(Ee.layout_symbol["icon-rotation-alignment"]),"icon-size":new At(Ee.layout_symbol["icon-size"]),"icon-text-fit":new gt(Ee.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new gt(Ee.layout_symbol["icon-text-fit-padding"]),"icon-image":new At(Ee.layout_symbol["icon-image"]),"icon-rotate":new At(Ee.layout_symbol["icon-rotate"]),"icon-padding":new At(Ee.layout_symbol["icon-padding"]),"icon-keep-upright":new gt(Ee.layout_symbol["icon-keep-upright"]),"icon-offset":new At(Ee.layout_symbol["icon-offset"]),"icon-anchor":new At(Ee.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new gt(Ee.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new gt(Ee.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new gt(Ee.layout_symbol["text-rotation-alignment"]),"text-field":new At(Ee.layout_symbol["text-field"]),"text-font":new At(Ee.layout_symbol["text-font"]),"text-size":new At(Ee.layout_symbol["text-size"]),"text-max-width":new At(Ee.layout_symbol["text-max-width"]),"text-line-height":new gt(Ee.layout_symbol["text-line-height"]),"text-letter-spacing":new At(Ee.layout_symbol["text-letter-spacing"]),"text-justify":new At(Ee.layout_symbol["text-justify"]),"text-radial-offset":new At(Ee.layout_symbol["text-radial-offset"]),"text-variable-anchor":new gt(Ee.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new At(Ee.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new At(Ee.layout_symbol["text-anchor"]),"text-max-angle":new gt(Ee.layout_symbol["text-max-angle"]),"text-writing-mode":new gt(Ee.layout_symbol["text-writing-mode"]),"text-rotate":new At(Ee.layout_symbol["text-rotate"]),"text-padding":new gt(Ee.layout_symbol["text-padding"]),"text-keep-upright":new gt(Ee.layout_symbol["text-keep-upright"]),"text-transform":new At(Ee.layout_symbol["text-transform"]),"text-offset":new At(Ee.layout_symbol["text-offset"]),"text-allow-overlap":new gt(Ee.layout_symbol["text-allow-overlap"]),"text-overlap":new gt(Ee.layout_symbol["text-overlap"]),"text-ignore-placement":new gt(Ee.layout_symbol["text-ignore-placement"]),"text-optional":new gt(Ee.layout_symbol["text-optional"])})}};class Rh{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:ma,this.defaultValue=t}evaluate(t){if(t.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(t.formattedSection))return n.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}mt("FormatSectionOverride",Rh,{omit:["defaultValue"]});class Dl extends s{constructor(t){super(t,ku)}recalculate(t,n){if(super.recalculate(t,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const c=[];for(const m of o)c.indexOf(m)<0&&c.push(m);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,n,o,c){const m=this.layout.get(t).evaluate(n,{},o,c),g=this._unevaluatedLayout._values[t];return g.isDataDriven()||Sa(g.value)||!m?m:(function(x,S){return S.replace(/{([^{}]+)}/g,((P,z)=>x&&z in x?String(x[z]):""))})(n.properties,m)}createBucket(t){return new Su(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of ku.paint.overridableProperties){if(!Dl.hasPaintOverride(this.layout,t))continue;const n=this.paint.get(t),o=new Rh(n),c=new ni(o,n.property.specification);let m=null;m=n.value.kind==="constant"||n.value.kind==="source"?new Xa("source",c):new Ya("composite",c,n.value.zoomStops),this.paint._values[t]=new wi(n.property,m,n.parameters)}}_handleOverridablePaintPropertyUpdate(t,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven())&&Dl.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,n){const o=t.get("text-field"),c=ku.paint.properties[n];let m=!1;const g=x=>{for(const S of x)if(c.overrides&&c.overrides.hasOverride(S))return void(m=!0)};if(o.value.kind==="constant"&&o.value.value instanceof Qn)g(o.value.value.sections);else if(o.value.kind==="source"){const x=P=>{m||(P instanceof es&&Er(P.value)===Qi?g(P.value.sections):P instanceof qa?g(P.sections):P.eachChild(x))},S=o.value;S._styleExpression&&x(S._styleExpression.expression)}return m}}let Dd;var Ff={get paint(){return Dd=Dd||new f({"background-color":new gt(Ee.paint_background["background-color"]),"background-pattern":new Sl(Ee.paint_background["background-pattern"]),"background-opacity":new gt(Ee.paint_background["background-opacity"])})}};class Bh extends s{constructor(t){super(t,Ff)}}let qp;var Dc={get paint(){return qp=qp||new f({"raster-opacity":new gt(Ee.paint_raster["raster-opacity"]),"raster-hue-rotate":new gt(Ee.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new gt(Ee.paint_raster["raster-brightness-min"]),"raster-brightness-max":new gt(Ee.paint_raster["raster-brightness-max"]),"raster-saturation":new gt(Ee.paint_raster["raster-saturation"]),"raster-contrast":new gt(Ee.paint_raster["raster-contrast"]),"raster-resampling":new gt(Ee.paint_raster["raster-resampling"]),"raster-fade-duration":new gt(Ee.paint_raster["raster-fade-duration"])})}};class Of extends s{constructor(t){super(t,Dc)}}class Fh extends s{constructor(t){super(t,{}),this.onAdd=n=>{this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)},this.onRemove=n=>{this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class i{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const a=63710088e-1;class d{constructor(t,n){if(isNaN(t)||isNaN(n))throw new Error(`Invalid LngLat object: (${t}, ${n})`);if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new d(He(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const n=Math.PI/180,o=this.lat*n,c=t.lat*n,m=Math.sin(o)*Math.sin(c)+Math.cos(o)*Math.cos(c)*Math.cos((t.lng-this.lng)*n);return a*Math.acos(Math.min(m,1))}static convert(t){if(t instanceof d)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new d(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new d(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const v=2*Math.PI*a;function I(r){return v*Math.cos(r*Math.PI/180)}function M(r){return(180+r)/360}function $(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function oe(r,t){return r/I(t)}function pe(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}class Ce{constructor(t,n,o=0){this.x=+t,this.y=+n,this.z=+o}static fromLngLat(t,n=0){const o=d.convert(t);return new Ce(M(o.lng),$(o.lat),oe(n,o.lat))}toLngLat(){return new d(360*this.x-180,pe(this.y))}toAltitude(){return this.z*I(pe(this.y))}meterInMercatorCoordinateUnits(){return 1/v*(t=pe(this.y),1/Math.cos(t*Math.PI/180));var t}}function Ze(r,t,n){var o=2*Math.PI*6378137/256/Math.pow(2,n);return[r*o-2*Math.PI*6378137/2,t*o-2*Math.PI*6378137/2]}class We{constructor(t,n,o){if(!(function(c,m,g){return!(c<0||c>25||g<0||g>=Math.pow(2,c)||m<0||m>=Math.pow(2,c))})(t,n,o))throw new Error(`x=${n}, y=${o}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=n,this.y=o,this.key=bt(0,t,t,n,o)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,n,o){const c=(g=this.y,x=this.z,S=Ze(256*(m=this.x),256*(g=Math.pow(2,x)-g-1),x),P=Ze(256*(m+1),256*(g+1),x),S[0]+","+S[1]+","+P[0]+","+P[1]);var m,g,x,S,P;const z=(function(L,O,V){let q,K="";for(let ne=L;ne>0;ne--)q=1<<ne-1,K+=(O&q?1:0)+(V&q?2:0);return K})(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,z).replace(/{bbox-epsg-3857}/g,c)}isChildOf(t){const n=this.z-t.z;return n>0&&t.x===this.x>>n&&t.y===this.y>>n}getTilePoint(t){const n=Math.pow(2,this.z);return new Y((t.x*n-this.x)*un,(t.y*n-this.y)*un)}toString(){return`${this.z}/${this.x}/${this.y}`}}class qe{constructor(t,n){this.wrap=t,this.canonical=n,this.key=bt(t,n.z,n.z,n.x,n.y)}}class ht{constructor(t,n,o,c,m){if(t<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${o}`);this.overscaledZ=t,this.wrap=n,this.canonical=new We(o,+c,+m),this.key=bt(n,t,o,c,m)}clone(){return new ht(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-t;return t>this.canonical.z?new ht(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ht(t,this.wrap,t,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(t,n){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-t;return t>this.canonical.z?bt(this.wrap*+n,t,this.canonical.z,this.canonical.x,this.canonical.y):bt(this.wrap*+n,t,t,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const n=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>n&&t.canonical.y===this.canonical.y>>n}children(t){if(this.overscaledZ>=t)return[new ht(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,o=2*this.canonical.x,c=2*this.canonical.y;return[new ht(n,this.wrap,n,o,c),new ht(n,this.wrap,n,o+1,c),new ht(n,this.wrap,n,o,c+1),new ht(n,this.wrap,n,o+1,c+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new ht(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new ht(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new qe(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Ce(t.x-this.wrap,t.y))}}function bt(r,t,n,o,c){(r*=2)<0&&(r=-1*r-1);const m=1<<n;return(m*m*r+m*c+o).toString(36)+n.toString(36)+t.toString(36)}mt("CanonicalTileID",We),mt("OverscaledTileID",ht,{omit:["posMatrix"]});class Mt{constructor(t,n,o,c=1,m=1,g=1,x=0){if(this.uid=t,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void Rt(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const S=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=c,this.greenFactor=m,this.blueFactor=g,this.baseShift=x;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let P=0;P<S;P++)this.data[this._idx(-1,P)]=this.data[this._idx(0,P)],this.data[this._idx(S,P)]=this.data[this._idx(S-1,P)],this.data[this._idx(P,-1)]=this.data[this._idx(P,0)],this.data[this._idx(P,S)]=this.data[this._idx(P,S-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(S,-1)]=this.data[this._idx(S-1,0)],this.data[this._idx(-1,S)]=this.data[this._idx(0,S-1)],this.data[this._idx(S,S)]=this.data[this._idx(S-1,S-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let P=0;P<S;P++)for(let z=0;z<S;z++){const L=this.get(P,z);L>this.max&&(this.max=L),L<this.min&&(this.min=L)}}get(t,n){const o=new Uint8Array(this.data.buffer),c=4*this._idx(t,n);return this.unpack(o[c],o[c+1],o[c+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,n){if(t<-1||t>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(t+1)}unpack(t,n,o){return t*this.redFactor+n*this.greenFactor+o*this.blueFactor-this.baseShift}getPixels(){return new Fn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,n,o){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let c=n*this.dim,m=n*this.dim+this.dim,g=o*this.dim,x=o*this.dim+this.dim;switch(n){case-1:c=m-1;break;case 1:m=c+1}switch(o){case-1:g=x-1;break;case 1:x=g+1}const S=-n*this.dim,P=-o*this.dim;for(let z=g;z<x;z++)for(let L=c;L<m;L++)this.data[this._idx(L,z)]=t.data[this._idx(L+S,z+P)]}}mt("DEMData",Mt);class dn{constructor(t){this._stringToNumber={},this._numberToString=[];for(let n=0;n<t.length;n++){const o=t[n];this._stringToNumber[o]=n,this._numberToString[n]=o}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class Se{constructor(t,n,o,c,m){this.type="Feature",this._vectorTileFeature=t,t._z=n,t._x=o,t._y=c,this.properties=t.properties,this.id=m}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(t[n]=this[n]);return t}}class ge{constructor(t,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Mo(un,16,0),this.grid3D=new Mo(un,16,0),this.featureIndexArray=new Vr,this.promoteId=n}insert(t,n,o,c,m,g){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,c,m);const S=g?this.grid3D:this.grid;for(let P=0;P<n.length;P++){const z=n[P],L=[1/0,1/0,-1/0,-1/0];for(let O=0;O<z.length;O++){const V=z[O];L[0]=Math.min(L[0],V.x),L[1]=Math.min(L[1],V.y),L[2]=Math.max(L[2],V.x),L[3]=Math.max(L[3],V.y)}L[0]<un&&L[1]<un&&L[2]>=0&&L[3]>=0&&S.insert(x,L[0],L[1],L[2],L[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Vo.VectorTile(new io(this.rawTileData)).layers,this.sourceLayerCoder=new dn(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,n,o,c){this.loadVTLayers();const m=t.params||{},g=un/t.tileSize/t.scale,x=fl(m.filter),S=t.queryGeometry,P=t.queryPadding*g,z=it(S),L=this.grid.query(z.minX-P,z.minY-P,z.maxX+P,z.maxY+P),O=it(t.cameraQueryGeometry),V=this.grid3D.query(O.minX-P,O.minY-P,O.maxX+P,O.maxY+P,((ne,le,we,de)=>(function(_e,Ae,Ue,pt,Lt){for(const ot of _e)if(Ae<=ot.x&&Ue<=ot.y&&pt>=ot.x&&Lt>=ot.y)return!0;const dt=[new Y(Ae,Ue),new Y(Ae,Lt),new Y(pt,Lt),new Y(pt,Ue)];if(_e.length>2){for(const ot of dt)if(kl(_e,ot))return!0}for(let ot=0;ot<_e.length-1;ot++)if(lp(_e[ot],_e[ot+1],dt))return!0;return!1})(t.cameraQueryGeometry,ne-P,le-P,we+P,de+P)));for(const ne of V)L.push(ne);L.sort(zt);const q={};let K;for(let ne=0;ne<L.length;ne++){const le=L[ne];if(le===K)continue;K=le;const we=this.featureIndexArray.get(le);let de=null;this.loadMatchingFeature(q,we.bucketIndex,we.sourceLayerIndex,we.featureIndex,x,m.layers,m.availableImages,n,o,c,((_e,Ae,Ue)=>(de||(de=Oo(_e)),Ae.queryIntersectsFeature(S,_e,Ue,de,this.z,t.transform,g,t.pixelPosMatrix))))}return q}loadMatchingFeature(t,n,o,c,m,g,x,S,P,z,L){const O=this.bucketLayerIDs[n];if(g&&!(function(ne,le){for(let we=0;we<ne.length;we++)if(le.indexOf(ne[we])>=0)return!0;return!1})(g,O))return;const V=this.sourceLayerCoder.decode(o),q=this.vtLayers[V].feature(c);if(m.needGeometry){const ne=No(q,!0);if(!m.filter(new ur(this.tileID.overscaledZ),ne,this.tileID.canonical))return}else if(!m.filter(new ur(this.tileID.overscaledZ),q))return;const K=this.getId(q,V);for(let ne=0;ne<O.length;ne++){const le=O[ne];if(g&&g.indexOf(le)<0)continue;const we=S[le];if(!we)continue;let de={};K&&z&&(de=z.getState(we.sourceLayer||"_geojsonTileLayer",K));const _e=je({},P[le]);_e.paint=Te(_e.paint,we.paint,q,de,x),_e.layout=Te(_e.layout,we.layout,q,de,x);const Ae=!L||L(q,we,de);if(!Ae)continue;const Ue=new Se(q,this.z,this.x,this.y,K);Ue.layer=_e;let pt=t[le];pt===void 0&&(pt=t[le]=[]),pt.push({featureIndex:c,feature:Ue,intersectionZ:Ae})}}lookupSymbolFeatures(t,n,o,c,m,g,x,S){const P={};this.loadVTLayers();const z=fl(m);for(const L of t)this.loadMatchingFeature(P,o,c,L,z,g,x,S,n);return P}hasLayer(t){for(const n of this.bucketLayerIDs)for(const o of n)if(t===o)return!0;return!1}getId(t,n){let o=t.id;return this.promoteId&&(o=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof o=="boolean"&&(o=Number(o))),o}}function Te(r,t,n,o,c){return Ve(r,((m,g)=>{const x=t instanceof Do?t.get(g):null;return x&&x.evaluate?x.evaluate(n,o,c):x}))}function it(r){let t=1/0,n=1/0,o=-1/0,c=-1/0;for(const m of r)t=Math.min(t,m.x),n=Math.min(n,m.y),o=Math.max(o,m.x),c=Math.max(c,m.y);return{minX:t,minY:n,maxX:o,maxY:c}}function zt(r,t){return t-r}function jt(r,t,n,o,c){const m=[];for(let g=0;g<r.length;g++){const x=r[g];let S;for(let P=0;P<x.length-1;P++){let z=x[P],L=x[P+1];z.x<t&&L.x<t||(z.x<t?z=new Y(t,z.y+(t-z.x)/(L.x-z.x)*(L.y-z.y))._round():L.x<t&&(L=new Y(t,z.y+(t-z.x)/(L.x-z.x)*(L.y-z.y))._round()),z.y<n&&L.y<n||(z.y<n?z=new Y(z.x+(n-z.y)/(L.y-z.y)*(L.x-z.x),n)._round():L.y<n&&(L=new Y(z.x+(n-z.y)/(L.y-z.y)*(L.x-z.x),n)._round()),z.x>=o&&L.x>=o||(z.x>=o?z=new Y(o,z.y+(o-z.x)/(L.x-z.x)*(L.y-z.y))._round():L.x>=o&&(L=new Y(o,z.y+(o-z.x)/(L.x-z.x)*(L.y-z.y))._round()),z.y>=c&&L.y>=c||(z.y>=c?z=new Y(z.x+(c-z.y)/(L.y-z.y)*(L.x-z.x),c)._round():L.y>=c&&(L=new Y(z.x+(c-z.y)/(L.y-z.y)*(L.x-z.x),c)._round()),S&&z.equals(S[S.length-1])||(S=[z],m.push(S)),S.push(L)))))}}return m}mt("FeatureIndex",ge,{omit:["rawTileData","sourceLayerCoder"]});class Dt extends Y{constructor(t,n,o,c){super(t,n),this.angle=o,c!==void 0&&(this.segment=c)}clone(){return new Dt(this.x,this.y,this.angle,this.segment)}}function Kt(r,t,n,o,c){if(t.segment===void 0||n===0)return!0;let m=t,g=t.segment+1,x=0;for(;x>-n/2;){if(g--,g<0)return!1;x-=r[g].dist(m),m=r[g]}x+=r[g].dist(r[g+1]),g++;const S=[];let P=0;for(;x<n/2;){const z=r[g],L=r[g+1];if(!L)return!1;let O=r[g-1].angleTo(z)-z.angleTo(L);for(O=Math.abs((O+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:x,angleDelta:O}),P+=O;x-S[0].distance>o;)P-=S.shift().angleDelta;if(P>c)return!1;g++,x+=z.dist(L)}return!0}function Dn(r){let t=0;for(let n=0;n<r.length-1;n++)t+=r[n].dist(r[n+1]);return t}function Tr(r,t,n){return r?.6*t*n:0}function ao(r,t){return Math.max(r?r.right-r.left:0,t?t.right-t.left:0)}function Nf(r,t,n,o,c,m){const g=Tr(n,c,m),x=ao(n,o)*m;let S=0;const P=Dn(r)/2;for(let z=0;z<r.length-1;z++){const L=r[z],O=r[z+1],V=L.dist(O);if(S+V>P){const q=(P-S)/V,K=on.number(L.x,O.x,q),ne=on.number(L.y,O.y,q),le=new Dt(K,ne,O.angleTo(L),z);return le._round(),!g||Kt(r,le,x,g,t)?le:void 0}S+=V}}function Ty(r,t,n,o,c,m,g,x,S){const P=Tr(o,m,g),z=ao(o,c),L=z*g,O=r[0].x===0||r[0].x===S||r[0].y===0||r[0].y===S;return t-L<t/4&&(t=L+t/4),Jm(r,O?t/2*x%t:(z/2+2*m)*g*x%t,t,P,n,L,O,!1,S)}function Jm(r,t,n,o,c,m,g,x,S){const P=m/2,z=Dn(r);let L=0,O=t-n,V=[];for(let q=0;q<r.length-1;q++){const K=r[q],ne=r[q+1],le=K.dist(ne),we=ne.angleTo(K);for(;O+n<L+le;){O+=n;const de=(O-L)/le,_e=on.number(K.x,ne.x,de),Ae=on.number(K.y,ne.y,de);if(_e>=0&&_e<S&&Ae>=0&&Ae<S&&O-P>=0&&O+P<=z){const Ue=new Dt(_e,Ae,we,q);Ue._round(),o&&!Kt(r,Ue,m,o,c)||V.push(Ue)}}L+=le}return x||V.length||g||(V=Jm(r,L/2,n,o,c,m,g,!0,S)),V}mt("Anchor",Dt);const Oh=Pi;function Qm(r,t,n,o){const c=[],m=r.image,g=m.pixelRatio,x=m.paddedRect.w-2*Oh,S=m.paddedRect.h-2*Oh;let P={x1:r.left,y1:r.top,x2:r.right,y2:r.bottom};const z=m.stretchX||[[0,x]],L=m.stretchY||[[0,S]],O=(Be,It)=>Be+It[1]-It[0],V=z.reduce(O,0),q=L.reduce(O,0),K=x-V,ne=S-q;let le=0,we=V,de=0,_e=q,Ae=0,Ue=K,pt=0,Lt=ne;if(m.content&&o){const Be=m.content,It=Be[2]-Be[0],St=Be[3]-Be[1];(m.textFitWidth||m.textFitHeight)&&(P=Cc(r)),le=Zp(z,0,Be[0]),de=Zp(L,0,Be[1]),we=Zp(z,Be[0],Be[2]),_e=Zp(L,Be[1],Be[3]),Ae=Be[0]-le,pt=Be[1]-de,Ue=It-we,Lt=St-_e}const dt=P.x1,ot=P.y1,kt=P.x2-dt,xt=P.y2-ot,yt=(Be,It,St,$t)=>{const Ur=Gp(Be.stretch-le,we,kt,dt),Fr=Hp(Be.fixed-Ae,Ue,Be.stretch,V),On=Gp(It.stretch-de,_e,xt,ot),La=Hp(It.fixed-pt,Lt,It.stretch,q),di=Gp(St.stretch-le,we,kt,dt),Nn=Hp(St.fixed-Ae,Ue,St.stretch,V),Zi=Gp($t.stretch-de,_e,xt,ot),Gi=Hp($t.fixed-pt,Lt,$t.stretch,q),Hi=new Y(Ur,On),pn=new Y(di,On),jn=new Y(di,Zi),Ci=new Y(Ur,Zi),pi=new Y(Fr/g,La/g),Ki=new Y(Nn/g,Gi/g),fi=t*Math.PI/180;if(fi){const wr=Math.sin(fi),Zr=Math.cos(fi),Wr=[Zr,-wr,wr,Zr];Hi._matMult(Wr),pn._matMult(Wr),Ci._matMult(Wr),jn._matMult(Wr)}const ua=Be.stretch+Be.fixed,_s=It.stretch+It.fixed;return{tl:Hi,tr:pn,bl:Ci,br:jn,tex:{x:m.paddedRect.x+Oh+ua,y:m.paddedRect.y+Oh+_s,w:St.stretch+St.fixed-ua,h:$t.stretch+$t.fixed-_s},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:pi,pixelOffsetBR:Ki,minFontScaleX:Ue/g/kt,minFontScaleY:Lt/g/xt,isSDF:n}};if(o&&(m.stretchX||m.stretchY)){const Be=eg(z,K,V),It=eg(L,ne,q);for(let St=0;St<Be.length-1;St++){const $t=Be[St],Ur=Be[St+1];for(let Fr=0;Fr<It.length-1;Fr++)c.push(yt($t,It[Fr],Ur,It[Fr+1]))}}else c.push(yt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:S+1}));return c}function Zp(r,t,n){let o=0;for(const c of r)o+=Math.max(t,Math.min(n,c[1]))-Math.max(t,Math.min(n,c[0]));return o}function eg(r,t,n){const o=[{fixed:-Oh,stretch:0}];for(const[c,m]of r){const g=o[o.length-1];o.push({fixed:c-g.stretch,stretch:g.stretch}),o.push({fixed:c-g.stretch,stretch:g.stretch+(m-c)})}return o.push({fixed:t+Oh,stretch:n}),o}function Gp(r,t,n,o){return r/t*n+o}function Hp(r,t,n,o){return r-t*n/o}class Kp{constructor(t,n,o,c,m,g,x,S,P,z){var L;if(this.boxStartIndex=t.length,P){let O=g.top,V=g.bottom;const q=g.collisionPadding;q&&(O-=q[1],V+=q[3]);let K=V-O;K>0&&(K=Math.max(10,K),this.circleDiameter=K)}else{const O=!((L=g.image)===null||L===void 0)&&L.content&&(g.image.textFitWidth||g.image.textFitHeight)?Cc(g):{x1:g.left,y1:g.top,x2:g.right,y2:g.bottom};O.y1=O.y1*x-S[0],O.y2=O.y2*x+S[2],O.x1=O.x1*x-S[3],O.x2=O.x2*x+S[1];const V=g.collisionPadding;if(V&&(O.x1-=V[0]*x,O.y1-=V[1]*x,O.x2+=V[2]*x,O.y2+=V[3]*x),z){const q=new Y(O.x1,O.y1),K=new Y(O.x2,O.y1),ne=new Y(O.x1,O.y2),le=new Y(O.x2,O.y2),we=z*Math.PI/180;q._rotate(we),K._rotate(we),ne._rotate(we),le._rotate(we),O.x1=Math.min(q.x,K.x,ne.x,le.x),O.x2=Math.max(q.x,K.x,ne.x,le.x),O.y1=Math.min(q.y,K.y,ne.y,le.y),O.y2=Math.max(q.y,K.y,ne.y,le.y)}t.emplaceBack(n.x,n.y,O.x1,O.y1,O.x2,O.y2,o,c,m)}this.boxEndIndex=t.length}}class Iy{constructor(t=[],n=((o,c)=>o<c?-1:o>c?1:0)){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:o}=this,c=n[t];for(;t>0;){const m=t-1>>1,g=n[m];if(o(c,g)>=0)break;n[t]=g,t=m}n[t]=c}_down(t){const{data:n,compare:o}=this,c=this.length>>1,m=n[t];for(;t<c;){let g=1+(t<<1);const x=g+1;if(x<this.length&&o(n[x],n[g])<0&&(g=x),o(n[g],m)>=0)break;n[t]=n[g],t=g}n[t]=m}}function Ey(r,t=1,n=!1){let o=1/0,c=1/0,m=-1/0,g=-1/0;const x=r[0];for(let V=0;V<x.length;V++){const q=x[V];(!V||q.x<o)&&(o=q.x),(!V||q.y<c)&&(c=q.y),(!V||q.x>m)&&(m=q.x),(!V||q.y>g)&&(g=q.y)}const S=Math.min(m-o,g-c);let P=S/2;const z=new Iy([],Py);if(S===0)return new Y(o,c);for(let V=o;V<m;V+=S)for(let q=c;q<g;q+=S)z.push(new Nh(V+P,q+P,P,r));let L=(function(V){let q=0,K=0,ne=0;const le=V[0];for(let we=0,de=le.length,_e=de-1;we<de;_e=we++){const Ae=le[we],Ue=le[_e],pt=Ae.x*Ue.y-Ue.x*Ae.y;K+=(Ae.x+Ue.x)*pt,ne+=(Ae.y+Ue.y)*pt,q+=3*pt}return new Nh(K/q,ne/q,0,V)})(r),O=z.length;for(;z.length;){const V=z.pop();(V.d>L.d||!L.d)&&(L=V,n&&console.log("found best %d after %d probes",Math.round(1e4*V.d)/1e4,O)),V.max-L.d<=t||(P=V.h/2,z.push(new Nh(V.p.x-P,V.p.y-P,P,r)),z.push(new Nh(V.p.x+P,V.p.y-P,P,r)),z.push(new Nh(V.p.x-P,V.p.y+P,P,r)),z.push(new Nh(V.p.x+P,V.p.y+P,P,r)),O+=4)}return n&&(console.log(`num probes: ${O}`),console.log(`best distance: ${L.d}`)),L.p}function Py(r,t){return t.max-r.max}function Nh(r,t,n,o){this.p=new Y(r,t),this.h=n,this.d=(function(c,m){let g=!1,x=1/0;for(let S=0;S<m.length;S++){const P=m[S];for(let z=0,L=P.length,O=L-1;z<L;O=z++){const V=P[z],q=P[O];V.y>c.y!=q.y>c.y&&c.x<(q.x-V.x)*(c.y-V.y)/(q.y-V.y)+V.x&&(g=!g),x=Math.min(x,pd(c,V,q))}}return(g?1:-1)*Math.sqrt(x)})(this.p,o),this.max=this.d+this.h*Math.SQRT2}var hi;T.aq=void 0,(hi=T.aq||(T.aq={}))[hi.center=1]="center",hi[hi.left=2]="left",hi[hi.right=3]="right",hi[hi.top=4]="top",hi[hi.bottom=5]="bottom",hi[hi["top-left"]=6]="top-left",hi[hi["top-right"]=7]="top-right",hi[hi["bottom-left"]=8]="bottom-left",hi[hi["bottom-right"]=9]="bottom-right";const Tu=7,jf=Number.POSITIVE_INFINITY;function tg(r,t){return t[1]!==jf?(function(n,o,c){let m=0,g=0;switch(o=Math.abs(o),c=Math.abs(c),n){case"top-right":case"top-left":case"top":g=c-Tu;break;case"bottom-right":case"bottom-left":case"bottom":g=-c+Tu}switch(n){case"top-right":case"bottom-right":case"right":m=-o;break;case"top-left":case"bottom-left":case"left":m=o}return[m,g]})(r,t[0],t[1]):(function(n,o){let c=0,m=0;o<0&&(o=0);const g=o/Math.SQRT2;switch(n){case"top-right":case"top-left":m=g-Tu;break;case"bottom-right":case"bottom-left":m=-g+Tu;break;case"bottom":m=-o+Tu;break;case"top":m=o-Tu}switch(n){case"top-right":case"bottom-right":c=-g;break;case"top-left":case"bottom-left":c=g;break;case"left":c=o;break;case"right":c=-o}return[c,m]})(r,t[0])}function rg(r,t,n){var o;const c=r.layout,m=(o=c.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(t,{},n);if(m){const x=m.values,S=[];for(let P=0;P<x.length;P+=2){const z=S[P]=x[P],L=x[P+1].map((O=>O*Kr));z.startsWith("top")?L[1]-=Tu:z.startsWith("bottom")&&(L[1]+=Tu),S[P+1]=L}return new _i(S)}const g=c.get("text-variable-anchor");if(g){let x;x=r._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[c.get("text-radial-offset").evaluate(t,{},n)*Kr,jf]:c.get("text-offset").evaluate(t,{},n).map((P=>P*Kr));const S=[];for(const P of g)S.push(P,tg(P,x));return new _i(S)}return null}function Vf(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Cy(r,t,n,o,c,m,g,x,S,P,z){let L=m.textMaxSize.evaluate(t,{});L===void 0&&(L=g);const O=r.layers[0].layout,V=O.get("icon-offset").evaluate(t,{},z),q=ig(n.horizontal),K=g/24,ne=r.tilePixelRatio*K,le=r.tilePixelRatio*L/24,we=r.tilePixelRatio*x,de=r.tilePixelRatio*O.get("symbol-spacing"),_e=O.get("text-padding")*r.tilePixelRatio,Ae=(function(Be,It,St,$t=1){const Ur=Be.get("icon-padding").evaluate(It,{},St),Fr=Ur&&Ur.values;return[Fr[0]*$t,Fr[1]*$t,Fr[2]*$t,Fr[3]*$t]})(O,t,z,r.tilePixelRatio),Ue=O.get("text-max-angle")/180*Math.PI,pt=O.get("text-rotation-alignment")!=="viewport"&&O.get("symbol-placement")!=="point",Lt=O.get("icon-rotation-alignment")==="map"&&O.get("symbol-placement")!=="point",dt=O.get("symbol-placement"),ot=de/2,kt=O.get("icon-text-fit");let xt;o&&kt!=="none"&&(r.allowVerticalPlacement&&n.vertical&&(xt=Ho(o,n.vertical,kt,O.get("icon-text-fit-padding"),V,K)),q&&(o=Ho(o,q,kt,O.get("icon-text-fit-padding"),V,K)));const yt=(Be,It)=>{It.x<0||It.x>=un||It.y<0||It.y>=un||(function(St,$t,Ur,Fr,On,La,di,Nn,Zi,Gi,Hi,pn,jn,Ci,pi,Ki,fi,ua,_s,wr,Zr,Wr,Bs,cn,jh){const Wo=St.addToLineVertexArray($t,Ur);let Xo,Ra,ca,Xn,Ll=0,Bd=0,lg=0,ug=0,Wf=-1,Xf=-1;const Rl={};let cg=Ro("");if(St.allowVerticalPlacement&&Fr.vertical){const Mi=Nn.layout.get("text-rotate").evaluate(Zr,{},cn)+90;ca=new Kp(Zi,$t,Gi,Hi,pn,Fr.vertical,jn,Ci,pi,Mi),di&&(Xn=new Kp(Zi,$t,Gi,Hi,pn,di,fi,ua,pi,Mi))}if(On){const Mi=Nn.layout.get("icon-rotate").evaluate(Zr,{}),ha=Nn.layout.get("icon-text-fit")!=="none",Lc=Qm(On,Mi,Bs,ha),lo=di?Qm(di,Mi,Bs,ha):void 0;Ra=new Kp(Zi,$t,Gi,Hi,pn,On,fi,ua,!1,Mi),Ll=4*Lc.length;const Rc=St.iconSizeData;let Yo=null;Rc.kind==="source"?(Yo=[Rs*Nn.layout.get("icon-size").evaluate(Zr,{})],Yo[0]>Da&&Rt(`${St.layerIds[0]}: Value for "icon-size" is >= ${Ko}. Reduce your "icon-size".`)):Rc.kind==="composite"&&(Yo=[Rs*Wr.compositeIconSizes[0].evaluate(Zr,{},cn),Rs*Wr.compositeIconSizes[1].evaluate(Zr,{},cn)],(Yo[0]>Da||Yo[1]>Da)&&Rt(`${St.layerIds[0]}: Value for "icon-size" is >= ${Ko}. Reduce your "icon-size".`)),St.addSymbols(St.icon,Lc,Yo,wr,_s,Zr,T.ah.none,$t,Wo.lineStartIndex,Wo.lineLength,-1,cn),Wf=St.icon.placedSymbolArray.length-1,lo&&(Bd=4*lo.length,St.addSymbols(St.icon,lo,Yo,wr,_s,Zr,T.ah.vertical,$t,Wo.lineStartIndex,Wo.lineLength,-1,cn),Xf=St.icon.placedSymbolArray.length-1)}const hg=Object.keys(Fr.horizontal);for(const Mi of hg){const ha=Fr.horizontal[Mi];if(!Xo){cg=Ro(ha.text);const lo=Nn.layout.get("text-rotate").evaluate(Zr,{},cn);Xo=new Kp(Zi,$t,Gi,Hi,pn,ha,jn,Ci,pi,lo)}const Lc=ha.positionedLines.length===1;if(lg+=ng(St,$t,ha,La,Nn,pi,Zr,Ki,Wo,Fr.vertical?T.ah.horizontal:T.ah.horizontalOnly,Lc?hg:[Mi],Rl,Wf,Wr,cn),Lc)break}Fr.vertical&&(ug+=ng(St,$t,Fr.vertical,La,Nn,pi,Zr,Ki,Wo,T.ah.vertical,["vertical"],Rl,Xf,Wr,cn));const zy=Xo?Xo.boxStartIndex:St.collisionBoxArray.length,Dy=Xo?Xo.boxEndIndex:St.collisionBoxArray.length,Ly=ca?ca.boxStartIndex:St.collisionBoxArray.length,Ry=ca?ca.boxEndIndex:St.collisionBoxArray.length,By=Ra?Ra.boxStartIndex:St.collisionBoxArray.length,Fy=Ra?Ra.boxEndIndex:St.collisionBoxArray.length,Oy=Xn?Xn.boxStartIndex:St.collisionBoxArray.length,Ny=Xn?Xn.boxEndIndex:St.collisionBoxArray.length;let oo=-1;const Xp=(Mi,ha)=>Mi&&Mi.circleDiameter?Math.max(Mi.circleDiameter,ha):ha;oo=Xp(Xo,oo),oo=Xp(ca,oo),oo=Xp(Ra,oo),oo=Xp(Xn,oo);const dg=oo>-1?1:0;dg&&(oo*=jh/Kr),St.glyphOffsetArray.length>=Su.MAX_GLYPHS&&Rt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Zr.sortKey!==void 0&&St.addToSortKeyRanges(St.symbolInstances.length,Zr.sortKey);const jy=rg(Nn,Zr,cn),[Vy,Uy]=(function(Mi,ha){const Lc=Mi.length,lo=ha==null?void 0:ha.values;if((lo==null?void 0:lo.length)>0)for(let Rc=0;Rc<lo.length;Rc+=2){const Yo=lo[Rc+1];Mi.emplaceBack(T.aq[lo[Rc]],Yo[0],Yo[1])}return[Lc,Mi.length]})(St.textAnchorOffsets,jy);St.symbolInstances.emplaceBack($t.x,$t.y,Rl.right>=0?Rl.right:-1,Rl.center>=0?Rl.center:-1,Rl.left>=0?Rl.left:-1,Rl.vertical||-1,Wf,Xf,cg,zy,Dy,Ly,Ry,By,Fy,Oy,Ny,Gi,lg,ug,Ll,Bd,dg,0,jn,oo,Vy,Uy)})(r,It,Be,n,o,c,xt,r.layers[0],r.collisionBoxArray,t.index,t.sourceLayerIndex,r.index,ne,[_e,_e,_e,_e],pt,S,we,Ae,Lt,V,t,m,P,z,g)};if(dt==="line")for(const Be of jt(t.geometry,0,0,un,un)){const It=Ty(Be,de,Ue,n.vertical||q,o,24,le,r.overscaling,un);for(const St of It)q&&My(r,q.text,ot,St)||yt(Be,St)}else if(dt==="line-center"){for(const Be of t.geometry)if(Be.length>1){const It=Nf(Be,Ue,n.vertical||q,o,24,le);It&&yt(Be,It)}}else if(t.type==="Polygon")for(const Be of _o(t.geometry,0)){const It=Ey(Be,16);yt(Be[0],new Dt(It.x,It.y,0))}else if(t.type==="LineString")for(const Be of t.geometry)yt(Be,new Dt(Be[0].x,Be[0].y,0));else if(t.type==="Point")for(const Be of t.geometry)for(const It of Be)yt([It],new Dt(It.x,It.y,0))}function ng(r,t,n,o,c,m,g,x,S,P,z,L,O,V,q){const K=(function(we,de,_e,Ae,Ue,pt,Lt,dt){const ot=Ae.layout.get("text-rotate").evaluate(pt,{})*Math.PI/180,kt=[];for(const xt of de.positionedLines)for(const yt of xt.positionedGlyphs){if(!yt.rect)continue;const Be=yt.rect||{};let It=Ah+1,St=!0,$t=1,Ur=0;const Fr=(Ue||dt)&&yt.vertical,On=yt.metrics.advance*yt.scale/2;if(dt&&de.verticalizable&&(Ur=xt.lineOffset/2-(yt.imageName?-(Kr-yt.metrics.width*yt.scale)/2:(yt.scale-1)*Kr)),yt.imageName){const wr=Lt[yt.imageName];St=wr.sdf,$t=wr.pixelRatio,It=Pi/$t}const La=Ue?[yt.x+On,yt.y]:[0,0];let di=Ue?[0,0]:[yt.x+On+_e[0],yt.y+_e[1]-Ur],Nn=[0,0];Fr&&(Nn=di,di=[0,0]);const Zi=yt.metrics.isDoubleResolution?2:1,Gi=(yt.metrics.left-It)*yt.scale-On+di[0],Hi=(-yt.metrics.top-It)*yt.scale+di[1],pn=Gi+Be.w/Zi*yt.scale/$t,jn=Hi+Be.h/Zi*yt.scale/$t,Ci=new Y(Gi,Hi),pi=new Y(pn,Hi),Ki=new Y(Gi,jn),fi=new Y(pn,jn);if(Fr){const wr=new Y(-On,On-oa),Zr=-Math.PI/2,Wr=Kr/2-On,Bs=new Y(5-oa-Wr,-(yt.imageName?Wr:0)),cn=new Y(...Nn);Ci._rotateAround(Zr,wr)._add(Bs)._add(cn),pi._rotateAround(Zr,wr)._add(Bs)._add(cn),Ki._rotateAround(Zr,wr)._add(Bs)._add(cn),fi._rotateAround(Zr,wr)._add(Bs)._add(cn)}if(ot){const wr=Math.sin(ot),Zr=Math.cos(ot),Wr=[Zr,-wr,wr,Zr];Ci._matMult(Wr),pi._matMult(Wr),Ki._matMult(Wr),fi._matMult(Wr)}const ua=new Y(0,0),_s=new Y(0,0);kt.push({tl:Ci,tr:pi,bl:Ki,br:fi,tex:Be,writingMode:de.writingMode,glyphOffset:La,sectionIndex:yt.sectionIndex,isSDF:St,pixelOffsetTL:ua,pixelOffsetBR:_s,minFontScaleX:0,minFontScaleY:0})}return kt})(0,n,x,c,m,g,o,r.allowVerticalPlacement),ne=r.textSizeData;let le=null;ne.kind==="source"?(le=[Rs*c.layout.get("text-size").evaluate(g,{})],le[0]>Da&&Rt(`${r.layerIds[0]}: Value for "text-size" is >= ${Ko}. Reduce your "text-size".`)):ne.kind==="composite"&&(le=[Rs*V.compositeTextSizes[0].evaluate(g,{},q),Rs*V.compositeTextSizes[1].evaluate(g,{},q)],(le[0]>Da||le[1]>Da)&&Rt(`${r.layerIds[0]}: Value for "text-size" is >= ${Ko}. Reduce your "text-size".`)),r.addSymbols(r.text,K,le,x,m,g,P,t,S.lineStartIndex,S.lineLength,O,q);for(const we of z)L[we]=r.text.placedSymbolArray.length-1;return 4*K.length}function ig(r){for(const t in r)return r[t];return null}function My(r,t,n,o){const c=r.compareText;if(t in c){const m=c[t];for(let g=m.length-1;g>=0;g--)if(o.dist(m[g])<n)return!0}else c[t]=[];return c[t].push(o),!1}const sg=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Uf{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,o]=new Uint8Array(t,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const c=o>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);const m=sg[15&o];if(!m)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(t,2,1),[x]=new Uint32Array(t,4,1);return new Uf(x,g,m,t)}constructor(t,n=64,o=Float64Array,c){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=o,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const m=sg.indexOf(this.ArrayType),g=2*t*this.ArrayType.BYTES_PER_ELEMENT,x=t*this.IndexArrayType.BYTES_PER_ELEMENT,S=(8-x%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${o}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+x+S,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+g+x+S),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+x+S,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t)}add(t,n){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=t,this.coords[this._pos++]=n,o}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return $f(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,n,o,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:g,nodeSize:x}=this,S=[0,m.length-1,0],P=[];for(;S.length;){const z=S.pop()||0,L=S.pop()||0,O=S.pop()||0;if(L-O<=x){for(let ne=O;ne<=L;ne++){const le=g[2*ne],we=g[2*ne+1];le>=t&&le<=o&&we>=n&&we<=c&&P.push(m[ne])}continue}const V=O+L>>1,q=g[2*V],K=g[2*V+1];q>=t&&q<=o&&K>=n&&K<=c&&P.push(m[V]),(z===0?t<=q:n<=K)&&(S.push(O),S.push(V-1),S.push(1-z)),(z===0?o>=q:c>=K)&&(S.push(V+1),S.push(L),S.push(1-z))}return P}within(t,n,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:m,nodeSize:g}=this,x=[0,c.length-1,0],S=[],P=o*o;for(;x.length;){const z=x.pop()||0,L=x.pop()||0,O=x.pop()||0;if(L-O<=g){for(let ne=O;ne<=L;ne++)og(m[2*ne],m[2*ne+1],t,n)<=P&&S.push(c[ne]);continue}const V=O+L>>1,q=m[2*V],K=m[2*V+1];og(q,K,t,n)<=P&&S.push(c[V]),(z===0?t-o<=q:n-o<=K)&&(x.push(O),x.push(V-1),x.push(1-z)),(z===0?t+o>=q:n+o>=K)&&(x.push(V+1),x.push(L),x.push(1-z))}return S}}function $f(r,t,n,o,c,m){if(c-o<=n)return;const g=o+c>>1;ag(r,t,g,o,c,m),$f(r,t,n,o,g-1,1-m),$f(r,t,n,g+1,c,1-m)}function ag(r,t,n,o,c,m){for(;c>o;){if(c-o>600){const P=c-o+1,z=n-o+1,L=Math.log(P),O=.5*Math.exp(2*L/3),V=.5*Math.sqrt(L*O*(P-O)/P)*(z-P/2<0?-1:1);ag(r,t,n,Math.max(o,Math.floor(n-z*O/P+V)),Math.min(c,Math.floor(n+(P-z)*O/P+V)),m)}const g=t[2*n+m];let x=o,S=c;for(Ld(r,t,o,n),t[2*c+m]>g&&Ld(r,t,o,c);x<S;){for(Ld(r,t,x,S),x++,S--;t[2*x+m]<g;)x++;for(;t[2*S+m]>g;)S--}t[2*o+m]===g?Ld(r,t,o,S):(S++,Ld(r,t,S,c)),S<=n&&(o=S+1),n<=S&&(c=S-1)}}function Ld(r,t,n,o){qf(r,n,o),qf(t,2*n,2*o),qf(t,2*n+1,2*o+1)}function qf(r,t,n){const o=r[t];r[t]=r[n],r[n]=o}function og(r,t,n,o){const c=r-n,m=t-o;return c*c+m*m}var Zf;T.bg=void 0,(Zf=T.bg||(T.bg={})).create="create",Zf.load="load",Zf.fullLoad="fullLoad";let Wp=null,Rd=[];const Gf=1e3/60,Hf="loadTime",Kf="fullLoadTime",Ay={mark(r){performance.mark(r)},frame(r){const t=r;Wp!=null&&Rd.push(t-Wp),Wp=t},clearMetrics(){Wp=null,Rd=[],performance.clearMeasures(Hf),performance.clearMeasures(Kf);for(const r in T.bg)performance.clearMarks(T.bg[r])},getPerformanceMetrics(){performance.measure(Hf,T.bg.create,T.bg.load),performance.measure(Kf,T.bg.create,T.bg.fullLoad);const r=performance.getEntriesByName(Hf)[0].duration,t=performance.getEntriesByName(Kf)[0].duration,n=Rd.length,o=1/(Rd.reduce(((m,g)=>m+g),0)/n/1e3),c=Rd.filter((m=>m>Gf)).reduce(((m,g)=>m+(g-Gf)/Gf),0);return{loadTime:r,fullLoadTime:t,fps:o,percentDroppedFrames:c/(n+c)*100,totalFrames:n}}};T.$=class extends R{},T.A=mu,T.B=Qu,T.C=function(r){if(Or==null){const t=r.navigator?r.navigator.userAgent:null;Or=!!r.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Or},T.D=gt,T.E=Ba,T.F=class{constructor(r,t){this.target=r,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new i((()=>this.process())),this.subscription=(function(n,o,c,m){return n.addEventListener(o,c,!1),{unsubscribe:()=>{n.removeEventListener(o,c,!1)}}})(this.target,"message",(n=>this.receive(n))),this.globalScope=$r(self)?r:window}registerMessageHandler(r,t){this.messageHandlers[r]=t}sendAsync(r,t){return new Promise(((n,o)=>{const c=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[c]={resolve:n,reject:o},t&&t.signal.addEventListener("abort",(()=>{delete this.resolveRejects[c];const x={id:c,type:"<cancel>",origin:location.origin,targetMapId:r.targetMapId,sourceMapId:this.mapId};this.target.postMessage(x)}),{once:!0});const m=[],g=Object.assign(Object.assign({},r),{id:c,sourceMapId:this.mapId,origin:location.origin,data:Gn(r.data,m)});this.target.postMessage(g,{transfer:m})}))}receive(r){const t=r.data,n=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[n];const o=this.abortControllers[n];return delete this.abortControllers[n],void(o&&o.abort())}if($r(self)||t.mustQueue)return this.tasks[n]=t,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,t)}}process(){if(this.taskQueue.length===0)return;const r=this.taskQueue.shift(),t=this.tasks[r];delete this.tasks[r],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(r,t)}processTask(r,t){return h(this,void 0,void 0,(function*(){if(t.type==="<response>"){const c=this.resolveRejects[r];return delete this.resolveRejects[r],c?void(t.error?c.reject(As(t.error)):c.resolve(As(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(r,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=As(t.data),o=new AbortController;this.abortControllers[r]=o;try{const c=yield this.messageHandlers[t.type](t.sourceMapId,n,o);this.completeTask(r,null,c)}catch(c){this.completeTask(r,c)}}))}completeTask(r,t,n){const o=[];delete this.abortControllers[r];const c={id:r,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?Gn(t):null,data:Gn(n,o)};this.target.postMessage(c,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},T.G=hr,T.H=function(){var r=new mu(16);return mu!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},T.I=Cd,T.J=function(r,t,n){var o,c,m,g,x,S,P,z,L,O,V,q,K=n[0],ne=n[1],le=n[2];return t===r?(r[12]=t[0]*K+t[4]*ne+t[8]*le+t[12],r[13]=t[1]*K+t[5]*ne+t[9]*le+t[13],r[14]=t[2]*K+t[6]*ne+t[10]*le+t[14],r[15]=t[3]*K+t[7]*ne+t[11]*le+t[15]):(c=t[1],m=t[2],g=t[3],x=t[4],S=t[5],P=t[6],z=t[7],L=t[8],O=t[9],V=t[10],q=t[11],r[0]=o=t[0],r[1]=c,r[2]=m,r[3]=g,r[4]=x,r[5]=S,r[6]=P,r[7]=z,r[8]=L,r[9]=O,r[10]=V,r[11]=q,r[12]=o*K+x*ne+L*le+t[12],r[13]=c*K+S*ne+O*le+t[13],r[14]=m*K+P*ne+V*le+t[14],r[15]=g*K+z*ne+q*le+t[15]),r},T.K=function(r,t,n){var o=n[0],c=n[1],m=n[2];return r[0]=t[0]*o,r[1]=t[1]*o,r[2]=t[2]*o,r[3]=t[3]*o,r[4]=t[4]*c,r[5]=t[5]*c,r[6]=t[6]*c,r[7]=t[7]*c,r[8]=t[8]*m,r[9]=t[9]*m,r[10]=t[10]*m,r[11]=t[11]*m,r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},T.L=gd,T.M=function(r,t){const n={};for(let o=0;o<t.length;o++){const c=t[o];c in r&&(n[c]=r[c])}return n},T.N=d,T.O=M,T.P=Y,T.Q=$,T.R=Fn,T.S=ht,T.T=Cn,T.U=De,T.V=ze,T.W=Pt,T.X=un,T.Y=w,T.Z=Ce,T._=h,T.a=Yt,T.a$=function(r,t){var n=r[0],o=r[1],c=r[2],m=r[3],g=r[4],x=r[5],S=r[6],P=r[7],z=r[8],L=r[9],O=r[10],V=r[11],q=r[12],K=r[13],ne=r[14],le=r[15],we=t[0],de=t[1],_e=t[2],Ae=t[3],Ue=t[4],pt=t[5],Lt=t[6],dt=t[7],ot=t[8],kt=t[9],xt=t[10],yt=t[11],Be=t[12],It=t[13],St=t[14],$t=t[15];return Math.abs(n-we)<=oi*Math.max(1,Math.abs(n),Math.abs(we))&&Math.abs(o-de)<=oi*Math.max(1,Math.abs(o),Math.abs(de))&&Math.abs(c-_e)<=oi*Math.max(1,Math.abs(c),Math.abs(_e))&&Math.abs(m-Ae)<=oi*Math.max(1,Math.abs(m),Math.abs(Ae))&&Math.abs(g-Ue)<=oi*Math.max(1,Math.abs(g),Math.abs(Ue))&&Math.abs(x-pt)<=oi*Math.max(1,Math.abs(x),Math.abs(pt))&&Math.abs(S-Lt)<=oi*Math.max(1,Math.abs(S),Math.abs(Lt))&&Math.abs(P-dt)<=oi*Math.max(1,Math.abs(P),Math.abs(dt))&&Math.abs(z-ot)<=oi*Math.max(1,Math.abs(z),Math.abs(ot))&&Math.abs(L-kt)<=oi*Math.max(1,Math.abs(L),Math.abs(kt))&&Math.abs(O-xt)<=oi*Math.max(1,Math.abs(O),Math.abs(xt))&&Math.abs(V-yt)<=oi*Math.max(1,Math.abs(V),Math.abs(yt))&&Math.abs(q-Be)<=oi*Math.max(1,Math.abs(q),Math.abs(Be))&&Math.abs(K-It)<=oi*Math.max(1,Math.abs(K),Math.abs(It))&&Math.abs(ne-St)<=oi*Math.max(1,Math.abs(ne),Math.abs(St))&&Math.abs(le-$t)<=oi*Math.max(1,Math.abs(le),Math.abs($t))},T.a0=nr,T.a1=We,T.a2=Ke,T.a3=r=>{const t=window.document.createElement("video");return t.muted=!0,new Promise((n=>{t.onloadstart=()=>{n(t)};for(const o of r){const c=window.document.createElement("source");mn(o)||(t.crossOrigin="Anonymous"),c.src=o,t.appendChild(c)}}))},T.a4=function(){return ut++},T.a5=st,T.a6=Su,T.a7=fl,T.a8=No,T.a9=Se,T.aA=function(r){if(r.type==="custom")return new Fh(r);switch(r.type){case"background":return new Bh(r);case"circle":return new Ef(r);case"fill":return new Cf(r);case"fill-extrusion":return new Pp(r);case"heatmap":return new Pf(r);case"hillshade":return new pp(r);case"line":return new xu(r);case"raster":return new Of(r);case"symbol":return new Dl(r)}},T.aB=vt,T.aC=function(r,t){if(!r)return[{command:"setStyle",args:[t]}];let n=[];try{if(!fr(r.version,t.version))return[{command:"setStyle",args:[t]}];fr(r.center,t.center)||n.push({command:"setCenter",args:[t.center]}),fr(r.zoom,t.zoom)||n.push({command:"setZoom",args:[t.zoom]}),fr(r.bearing,t.bearing)||n.push({command:"setBearing",args:[t.bearing]}),fr(r.pitch,t.pitch)||n.push({command:"setPitch",args:[t.pitch]}),fr(r.sprite,t.sprite)||n.push({command:"setSprite",args:[t.sprite]}),fr(r.glyphs,t.glyphs)||n.push({command:"setGlyphs",args:[t.glyphs]}),fr(r.transition,t.transition)||n.push({command:"setTransition",args:[t.transition]}),fr(r.light,t.light)||n.push({command:"setLight",args:[t.light]}),fr(r.terrain,t.terrain)||n.push({command:"setTerrain",args:[t.terrain]}),fr(r.sky,t.sky)||n.push({command:"setSky",args:[t.sky]}),fr(r.projection,t.projection)||n.push({command:"setProjection",args:[t.projection]});const o={},c=[];(function(g,x,S,P){let z;for(z in x=x||{},g=g||{})Object.prototype.hasOwnProperty.call(g,z)&&(Object.prototype.hasOwnProperty.call(x,z)||ks(z,S,P));for(z in x)Object.prototype.hasOwnProperty.call(x,z)&&(Object.prototype.hasOwnProperty.call(g,z)?fr(g[z],x[z])||(g[z].type==="geojson"&&x[z].type==="geojson"&&Fa(g,x,z)?Dr(S,{command:"setGeoJSONSourceData",args:[z,x[z].data]}):Ts(z,x,S,P)):Ss(z,x,S))})(r.sources,t.sources,c,o);const m=[];r.layers&&r.layers.forEach((g=>{"source"in g&&o[g.source]?n.push({command:"removeLayer",args:[g.id]}):m.push(g)})),n=n.concat(c),(function(g,x,S){x=x||[];const P=(g=g||[]).map(ho),z=x.map(ho),L=g.reduce(Oa,{}),O=x.reduce(Oa,{}),V=P.slice(),q=Object.create(null);let K,ne,le,we,de;for(let _e=0,Ae=0;_e<P.length;_e++)K=P[_e],Object.prototype.hasOwnProperty.call(O,K)?Ae++:(Dr(S,{command:"removeLayer",args:[K]}),V.splice(V.indexOf(K,Ae),1));for(let _e=0,Ae=0;_e<z.length;_e++)K=z[z.length-1-_e],V[V.length-1-_e]!==K&&(Object.prototype.hasOwnProperty.call(L,K)?(Dr(S,{command:"removeLayer",args:[K]}),V.splice(V.lastIndexOf(K,V.length-Ae),1)):Ae++,we=V[V.length-_e],Dr(S,{command:"addLayer",args:[O[K],we]}),V.splice(V.length-_e,0,K),q[K]=!0);for(let _e=0;_e<z.length;_e++)if(K=z[_e],ne=L[K],le=O[K],!q[K]&&!fr(ne,le))if(fr(ne.source,le.source)&&fr(ne["source-layer"],le["source-layer"])&&fr(ne.type,le.type)){for(de in mi(ne.layout,le.layout,S,K,null,"setLayoutProperty"),mi(ne.paint,le.paint,S,K,null,"setPaintProperty"),fr(ne.filter,le.filter)||Dr(S,{command:"setFilter",args:[K,le.filter]}),fr(ne.minzoom,le.minzoom)&&fr(ne.maxzoom,le.maxzoom)||Dr(S,{command:"setLayerZoomRange",args:[K,le.minzoom,le.maxzoom]}),ne)Object.prototype.hasOwnProperty.call(ne,de)&&de!=="layout"&&de!=="paint"&&de!=="filter"&&de!=="metadata"&&de!=="minzoom"&&de!=="maxzoom"&&(de.indexOf("paint.")===0?mi(ne[de],le[de],S,K,de.slice(6),"setPaintProperty"):fr(ne[de],le[de])||Dr(S,{command:"setLayerProperty",args:[K,de,le[de]]}));for(de in le)Object.prototype.hasOwnProperty.call(le,de)&&!Object.prototype.hasOwnProperty.call(ne,de)&&de!=="layout"&&de!=="paint"&&de!=="filter"&&de!=="metadata"&&de!=="minzoom"&&de!=="maxzoom"&&(de.indexOf("paint.")===0?mi(ne[de],le[de],S,K,de.slice(6),"setPaintProperty"):fr(ne[de],le[de])||Dr(S,{command:"setLayerProperty",args:[K,de,le[de]]}))}else Dr(S,{command:"removeLayer",args:[K]}),we=V[V.lastIndexOf(K)+1],Dr(S,{command:"addLayer",args:[le,we]})})(m,t.layers,n)}catch(o){console.warn("Unable to compute style diff:",o),n=[{command:"setStyle",args:[t]}]}return n},T.aD=function(r){const t=[],n=r.id;return n===void 0&&t.push({message:`layers.${n}: missing required property "id"`}),r.render===void 0&&t.push({message:`layers.${n}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},T.aE=function r(t,n){if(Array.isArray(t)){if(!Array.isArray(n)||t.length!==n.length)return!1;for(let o=0;o<t.length;o++)if(!r(t[o],n[o]))return!1;return!0}if(typeof t=="object"&&t!==null&&n!==null){if(typeof n!="object"||Object.keys(t).length!==Object.keys(n).length)return!1;for(const o in t)if(!r(t[o],n[o]))return!1;return!0}return t===n},T.aF=Ve,T.aG=tr,T.aH=class extends Jr{constructor(r,t){super(r,t),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},T.aI=vn,T.aJ=class extends Jr{constructor(r,t){super(r,t),this.current=sc}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let t=1;t<16;t++)if(r[t]!==this.current[t]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},T.aK=ic,T.aL=pu,T.aM=Ut,T.aN=class extends Jr{constructor(r,t){super(r,t),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},T.aO=class extends Jr{constructor(r,t){super(r,t),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},T.aP=function(r,t,n,o,c,m,g){var x=1/(t-n),S=1/(o-c),P=1/(m-g);return r[0]=-2*x,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*S,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*P,r[11]=0,r[12]=(t+n)*x,r[13]=(c+o)*S,r[14]=(g+m)*P,r[15]=1,r},T.aQ=hh,T.aR=class extends fe{},T.aS=xc,T.aT=class extends be{},T.aU=hc,T.aV=function(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))},T.aW=yh,T.aX=rn,T.aY=Ni,T.aZ=class extends _t{},T.a_=function(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]&&r[4]===t[4]&&r[5]===t[5]&&r[6]===t[6]&&r[7]===t[7]&&r[8]===t[8]&&r[9]===t[9]&&r[10]===t[10]&&r[11]===t[11]&&r[12]===t[12]&&r[13]===t[13]&&r[14]===t[14]&&r[15]===t[15]},T.aa=function(r){const t={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((n,o,c,m)=>{const g=c||m;return t[o]=!g||g.toLowerCase(),""})),t["max-age"]){const n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t},T.ab=function(r,t){const n=[];for(const o in r)o in t||n.push(o);return n},T.ac=Je,T.ad=function(r,t,n){var o=Math.sin(n),c=Math.cos(n),m=t[0],g=t[1],x=t[2],S=t[3],P=t[4],z=t[5],L=t[6],O=t[7];return t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=m*c+P*o,r[1]=g*c+z*o,r[2]=x*c+L*o,r[3]=S*c+O*o,r[4]=P*c-m*o,r[5]=z*c-g*o,r[6]=L*c-x*o,r[7]=O*c-S*o,r},T.ae=function(r){var t=new mu(16);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t},T.af=dh,T.ag=function(r,t){let n=0,o=0;if(r.kind==="constant")o=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:c,minZoom:m,maxZoom:g}=r,x=c?Je(kn.interpolationFactor(c,t,m,g),0,1):0;r.kind==="camera"?o=on.number(r.minSize,r.maxSize,x):n=x}return{uSizeT:n,uSize:o}},T.ai=function(r,{uSize:t,uSizeT:n},{lowerSize:o,upperSize:c}){return r.kind==="source"?o/Rs:r.kind==="composite"?on.number(o/Rs,c/Rs,n):t},T.aj=bu,T.ak=function(r,t,n,o){const c=t.y-r.y,m=t.x-r.x,g=o.y-n.y,x=o.x-n.x,S=g*m-x*c;if(S===0)return null;const P=(x*(r.y-n.y)-g*(r.x-n.x))/S;return new Y(r.x+P*m,r.y+P*c)},T.al=jt,T.am=hd,T.an=ch,T.ao=function(r){let t=1/0,n=1/0,o=-1/0,c=-1/0;for(const m of r)t=Math.min(t,m.x),n=Math.min(n,m.y),o=Math.max(o,m.x),c=Math.max(c,m.y);return[t,n,o,c]},T.ap=Kr,T.ar=Mc,T.as=function(r,t){var n=t[0],o=t[1],c=t[2],m=t[3],g=t[4],x=t[5],S=t[6],P=t[7],z=t[8],L=t[9],O=t[10],V=t[11],q=t[12],K=t[13],ne=t[14],le=t[15],we=n*x-o*g,de=n*S-c*g,_e=n*P-m*g,Ae=o*S-c*x,Ue=o*P-m*x,pt=c*P-m*S,Lt=z*K-L*q,dt=z*ne-O*q,ot=z*le-V*q,kt=L*ne-O*K,xt=L*le-V*K,yt=O*le-V*ne,Be=we*yt-de*xt+_e*kt+Ae*ot-Ue*dt+pt*Lt;return Be?(r[0]=(x*yt-S*xt+P*kt)*(Be=1/Be),r[1]=(c*xt-o*yt-m*kt)*Be,r[2]=(K*pt-ne*Ue+le*Ae)*Be,r[3]=(O*Ue-L*pt-V*Ae)*Be,r[4]=(S*ot-g*yt-P*dt)*Be,r[5]=(n*yt-c*ot+m*dt)*Be,r[6]=(ne*_e-q*pt-le*de)*Be,r[7]=(z*pt-O*_e+V*de)*Be,r[8]=(g*xt-x*ot+P*Lt)*Be,r[9]=(o*ot-n*xt-m*Lt)*Be,r[10]=(q*Ue-K*_e+le*we)*Be,r[11]=(L*_e-z*Ue-V*we)*Be,r[12]=(x*dt-g*kt-S*Lt)*Be,r[13]=(n*kt-o*dt+c*Lt)*Be,r[14]=(K*de-q*Ae-ne*we)*Be,r[15]=(z*Ae-L*de+O*we)*Be,r):null},T.at=Vf,T.au=Pc,T.av=Uf,T.aw=function(){const r={},t=Ee.$version;for(const n in Ee.$root){const o=Ee.$root[n];if(o.required){let c=null;c=n==="version"?t:o.type==="array"?[]:{},c!=null&&(r[n]=c)}}return r},T.ax=as,T.ay=lr,T.az=function(r){r=r.slice();const t=Object.create(null);for(let n=0;n<r.length;n++)t[r[n].id]=r[n];for(let n=0;n<r.length;n++)"ref"in r[n]&&(r[n]=co(r[n],t[r[n].ref]));return r},T.b=Ht,T.b0=function(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},T.b1=function(r,t,n){return r[0]=t[0]*n[0],r[1]=t[1]*n[1],r[2]=t[2]*n[2],r[3]=t[3]*n[3],r},T.b2=function(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]*t[3]},T.b3=He,T.b4=qe,T.b5=oe,T.b6=function(r,t,n,o,c){var m,g=1/Math.tan(t/2);return r[0]=g/n,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=g,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,c!=null&&c!==1/0?(r[10]=(c+o)*(m=1/(o-c)),r[14]=2*c*o*m):(r[10]=-1,r[14]=-2*o),r},T.b7=function(r,t,n){var o=Math.sin(n),c=Math.cos(n),m=t[4],g=t[5],x=t[6],S=t[7],P=t[8],z=t[9],L=t[10],O=t[11];return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[4]=m*c+P*o,r[5]=g*c+z*o,r[6]=x*c+L*o,r[7]=S*c+O*o,r[8]=P*c-m*o,r[9]=z*c-g*o,r[10]=L*c-x*o,r[11]=O*c-S*o,r},T.b8=$e,T.b9=et,T.bA=za,T.bB=function(r){return r.message===Ne},T.bC=Wa,T.bD=Cr,T.ba=function(r){return r*Math.PI/180},T.bb=function(r,t){const{x:n,y:o}=Ce.fromLngLat(t);return!(r<0||r>25||o<0||o>=1||n<0||n>=1)},T.bc=function(r,t){return r[0]=t[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=t[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=t[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},T.bd=class extends A{},T.be=a,T.bf=Ay,T.bh=cr,T.bi=function(r,t){Yt.REGISTERED_PROTOCOLS[r]=t},T.bj=function(r){delete Yt.REGISTERED_PROTOCOLS[r]},T.bk=function(r,t){const n={};for(let c=0;c<r.length;c++){const m=t&&t[r[c].id]||Ku(r[c]);t&&(t[r[c].id]=m);let g=n[m];g||(g=n[m]=[]),g.push(r[c])}const o=[];for(const c in n)o.push(n[c]);return o},T.bl=mt,T.bm=dn,T.bn=ge,T.bo=Md,T.bp=function(r){r.bucket.createArrays(),r.bucket.tilePixelRatio=un/(512*r.bucket.overscaling),r.bucket.compareText={},r.bucket.iconsNeedLinear=!1;const t=r.bucket.layers[0],n=t.layout,o=t._unevaluatedLayout._values,c={layoutIconSize:o["icon-size"].possiblyEvaluate(new ur(r.bucket.zoom+1),r.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new ur(r.bucket.zoom+1),r.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new ur(18))};if(r.bucket.textSizeData.kind==="composite"){const{minZoom:P,maxZoom:z}=r.bucket.textSizeData;c.compositeTextSizes=[o["text-size"].possiblyEvaluate(new ur(P),r.canonical),o["text-size"].possiblyEvaluate(new ur(z),r.canonical)]}if(r.bucket.iconSizeData.kind==="composite"){const{minZoom:P,maxZoom:z}=r.bucket.iconSizeData;c.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new ur(P),r.canonical),o["icon-size"].possiblyEvaluate(new ur(z),r.canonical)]}const m=n.get("text-line-height")*Kr,g=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",x=n.get("text-keep-upright"),S=n.get("text-size");for(const P of r.bucket.features){const z=n.get("text-font").evaluate(P,{},r.canonical).join(","),L=S.evaluate(P,{},r.canonical),O=c.layoutTextSize.evaluate(P,{},r.canonical),V=c.layoutIconSize.evaluate(P,{},r.canonical),q={horizontal:{},vertical:void 0},K=P.text;let ne,le=[0,0];if(K){const _e=K.toString(),Ae=n.get("text-letter-spacing").evaluate(P,{},r.canonical)*Kr,Ue=od(_e)?Ae:0,pt=n.get("text-anchor").evaluate(P,{},r.canonical),Lt=rg(t,P,r.canonical);if(!Lt){const xt=n.get("text-radial-offset").evaluate(P,{},r.canonical);le=xt?tg(pt,[xt*Kr,jf]):n.get("text-offset").evaluate(P,{},r.canonical).map((yt=>yt*Kr))}let dt=g?"center":n.get("text-justify").evaluate(P,{},r.canonical);const ot=n.get("symbol-placement")==="point"?n.get("text-max-width").evaluate(P,{},r.canonical)*Kr:1/0,kt=()=>{r.bucket.allowVerticalPlacement&&ec(_e)&&(q.vertical=Ec(K,r.glyphMap,r.glyphPositions,r.imagePositions,z,ot,m,pt,"left",Ue,le,T.ah.vertical,!0,O,L))};if(!g&&Lt){const xt=new Set;if(dt==="auto")for(let Be=0;Be<Lt.values.length;Be+=2)xt.add(Vf(Lt.values[Be]));else xt.add(dt);let yt=!1;for(const Be of xt)if(!q.horizontal[Be])if(yt)q.horizontal[Be]=q.horizontal[0];else{const It=Ec(K,r.glyphMap,r.glyphPositions,r.imagePositions,z,ot,m,"center",Be,Ue,le,T.ah.horizontal,!1,O,L);It&&(q.horizontal[Be]=It,yt=It.positionedLines.length===1)}kt()}else{dt==="auto"&&(dt=Vf(pt));const xt=Ec(K,r.glyphMap,r.glyphPositions,r.imagePositions,z,ot,m,pt,dt,Ue,le,T.ah.horizontal,!1,O,L);xt&&(q.horizontal[dt]=xt),kt(),ec(_e)&&g&&x&&(q.vertical=Ec(K,r.glyphMap,r.glyphPositions,r.imagePositions,z,ot,m,pt,dt,Ue,le,T.ah.vertical,!1,O,L))}}let we=!1;if(P.icon&&P.icon.name){const _e=r.imageMap[P.icon.name];_e&&(ne=Go(r.imagePositions[P.icon.name],n.get("icon-offset").evaluate(P,{},r.canonical),n.get("icon-anchor").evaluate(P,{},r.canonical)),we=!!_e.sdf,r.bucket.sdfIcons===void 0?r.bucket.sdfIcons=we:r.bucket.sdfIcons!==we&&Rt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(_e.pixelRatio!==r.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(r.bucket.iconsNeedLinear=!0))}const de=ig(q.horizontal)||q.vertical;r.bucket.iconsInText=!!de&&de.iconsInText,(de||ne)&&Cy(r.bucket,P,q,ne,r.imageMap,c,O,V,le,we,r.canonical)}r.showCollisionBoxes&&r.bucket.generateCollisionDebugBuffers()},T.bq=Vi,T.br=wh,T.bs=gs,T.bt=Vo,T.bu=io,T.bv=class{constructor(r){this._marks={start:[r.url,"start"].join("#"),end:[r.url,"end"].join("#"),measure:r.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let r=performance.getEntriesByName(this._marks.measure);return r.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),r=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),r}},T.bw=function(r,t,n,o,c){return h(this,void 0,void 0,(function*(){if(ze())try{return yield Pt(r,t,n,o,c)}catch{}return(function(m,g,x,S,P){const z=m.width,L=m.height;ft&&xe||(ft=new OffscreenCanvas(z,L),xe=ft.getContext("2d",{willReadFrequently:!0})),ft.width=z,ft.height=L,xe.drawImage(m,0,0,z,L);const O=xe.getImageData(g,x,S,P);return xe.clearRect(0,0,z,L),O.data})(r,t,n,o,c)}))},T.bx=Mt,T.by=X,T.bz=ae,T.c=Xt,T.d=r=>h(void 0,void 0,void 0,(function*(){if(r.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(r)],{type:"image/png"});try{return createImageBitmap(t)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),T.e=je,T.f=r=>new Promise(((t,n)=>{const o=new Image;o.onload=()=>{t(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame((()=>{o.src=lt}))},o.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const c=new Blob([new Uint8Array(r)],{type:"image/png"});o.src=r.byteLength?URL.createObjectURL(c):lt})),T.g=ir,T.h=(r,t)=>Ir(je(r,{type:"json"}),t),T.i=$r,T.j=bs,T.k=Yi,T.l=(r,t)=>Ir(je(r,{type:"arrayBuffer"}),t),T.m=Ir,T.n=function(r){return new io(r).readFields(zl,[])},T.o=Il,T.p=Tc,T.q=f,T.r=Ju,T.s=mn,T.t=cu,T.u=Qs,T.v=Ee,T.w=Rt,T.x=function([r,t,n]){return t+=90,t*=Math.PI/180,n*=Math.PI/180,{x:r*Math.cos(t)*Math.sin(n),y:r*Math.sin(t)*Math.sin(n),z:r*Math.cos(n)}},T.y=on,T.z=ur})),D("worker",["./shared"],(function(T){class h{constructor(j){this.keyCache={},j&&this.replace(j)}replace(j){this._layerConfigs={},this._layers={},this.update(j,[])}update(j,N){for(const te of j){this._layerConfigs[te.id]=te;const he=this._layers[te.id]=T.aA(te);he._featureFilter=T.a7(he.filter),this.keyCache[te.id]&&delete this.keyCache[te.id]}for(const te of N)delete this.keyCache[te],delete this._layerConfigs[te],delete this._layers[te];this.familiesBySource={};const H=T.bk(Object.values(this._layerConfigs),this.keyCache);for(const te of H){const he=te.map((ke=>this._layers[ke.id])),me=he[0];if(me.visibility==="none")continue;const ve=me.source||"";let ue=this.familiesBySource[ve];ue||(ue=this.familiesBySource[ve]={});const Me=me.sourceLayer||"_geojsonTileLayer";let Oe=ue[Me];Oe||(Oe=ue[Me]=[]),Oe.push(he)}}}class X{constructor(j){const N={},H=[];for(const ve in j){const ue=j[ve],Me=N[ve]={};for(const Oe in ue){const ke=ue[+Oe];if(!ke||ke.bitmap.width===0||ke.bitmap.height===0)continue;const Ye={x:0,y:0,w:ke.bitmap.width+2,h:ke.bitmap.height+2};H.push(Ye),Me[Oe]={rect:Ye,metrics:ke.metrics}}}const{w:te,h:he}=T.p(H),me=new T.o({width:te||1,height:he||1});for(const ve in j){const ue=j[ve];for(const Me in ue){const Oe=ue[+Me];if(!Oe||Oe.bitmap.width===0||Oe.bitmap.height===0)continue;const ke=N[ve][Me].rect;T.o.copy(Oe.bitmap,me,{x:0,y:0},{x:ke.x+1,y:ke.y+1},Oe.bitmap)}}this.image=me,this.positions=N}}T.bl("GlyphAtlas",X);class ae{constructor(j){this.tileID=new T.S(j.tileID.overscaledZ,j.tileID.wrap,j.tileID.canonical.z,j.tileID.canonical.x,j.tileID.canonical.y),this.uid=j.uid,this.zoom=j.zoom,this.pixelRatio=j.pixelRatio,this.tileSize=j.tileSize,this.source=j.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=j.showCollisionBoxes,this.collectResourceTiming=!!j.collectResourceTiming,this.returnDependencies=!!j.returnDependencies,this.promoteId=j.promoteId,this.inFlightDependencies=[]}parse(j,N,H,te){return T._(this,void 0,void 0,(function*(){this.status="parsing",this.data=j,this.collisionBoxArray=new T.a5;const he=new T.bm(Object.keys(j.layers).sort()),me=new T.bn(this.tileID,this.promoteId);me.bucketLayerIDs=[];const ve={},ue={featureIndex:me,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:H},Me=N.familiesBySource[this.source];for(const rr in Me){const br=j.layers[rr];if(!br)continue;br.version===1&&T.w(`Vector tile source "${this.source}" layer "${rr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Nr=he.encode(rr),yn=[];for(let Sn=0;Sn<br.length;Sn++){const $n=br.feature(Sn),po=me.getId($n,rr);yn.push({feature:$n,id:po,index:Sn,sourceLayerIndex:Nr})}for(const Sn of Me[rr]){const $n=Sn[0];$n.source!==this.source&&T.w(`layer.source = ${$n.source} does not equal this.source = ${this.source}`),$n.minzoom&&this.zoom<Math.floor($n.minzoom)||$n.maxzoom&&this.zoom>=$n.maxzoom||$n.visibility!=="none"&&(Q(Sn,this.zoom,H),(ve[$n.id]=$n.createBucket({index:me.bucketLayerIDs.length,layers:Sn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Nr,sourceID:this.source})).populate(yn,ue,this.tileID.canonical),me.bucketLayerIDs.push(Sn.map((po=>po.id))))}}const Oe=T.aF(ue.glyphDependencies,(rr=>Object.keys(rr).map(Number)));this.inFlightDependencies.forEach((rr=>rr==null?void 0:rr.abort())),this.inFlightDependencies=[];let ke=Promise.resolve({});if(Object.keys(Oe).length){const rr=new AbortController;this.inFlightDependencies.push(rr),ke=te.sendAsync({type:"GG",data:{stacks:Oe,source:this.source,tileID:this.tileID,type:"glyphs"}},rr)}const Ye=Object.keys(ue.iconDependencies);let wt=Promise.resolve({});if(Ye.length){const rr=new AbortController;this.inFlightDependencies.push(rr),wt=te.sendAsync({type:"GI",data:{icons:Ye,source:this.source,tileID:this.tileID,type:"icons"}},rr)}const Ct=Object.keys(ue.patternDependencies);let mr=Promise.resolve({});if(Ct.length){const rr=new AbortController;this.inFlightDependencies.push(rr),mr=te.sendAsync({type:"GI",data:{icons:Ct,source:this.source,tileID:this.tileID,type:"patterns"}},rr)}const[Zt,gr,Wt]=yield Promise.all([ke,wt,mr]),sn=new X(Zt),Gr=new T.bo(gr,Wt);for(const rr in ve){const br=ve[rr];br instanceof T.a6?(Q(br.layers,this.zoom,H),T.bp({bucket:br,glyphMap:Zt,glyphPositions:sn.positions,imageMap:gr,imagePositions:Gr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):br.hasPattern&&(br instanceof T.bq||br instanceof T.br||br instanceof T.bs)&&(Q(br.layers,this.zoom,H),br.addFeatures(ue,this.tileID.canonical,Gr.patternPositions))}return this.status="done",{buckets:Object.values(ve).filter((rr=>!rr.isEmpty())),featureIndex:me,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:sn.image,imageAtlas:Gr,glyphMap:this.returnDependencies?Zt:null,iconMap:this.returnDependencies?gr:null,glyphPositions:this.returnDependencies?sn.positions:null}}))}}function Q(ie,j,N){const H=new T.z(j);for(const te of ie)te.recalculate(H,N)}class Y{constructor(j,N,H){this.actor=j,this.layerIndex=N,this.availableImages=H,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(j,N){return T._(this,void 0,void 0,(function*(){const H=yield T.l(j.request,N);try{return{vectorTile:new T.bt.VectorTile(new T.bu(H.data)),rawData:H.data,cacheControl:H.cacheControl,expires:H.expires}}catch(te){const he=new Uint8Array(H.data);let me=`Unable to parse the tile at ${j.request.url}, `;throw me+=he[0]===31&&he[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${te.message}`,new Error(me)}}))}loadTile(j){return T._(this,void 0,void 0,(function*(){const N=j.uid,H=!!(j&&j.request&&j.request.collectResourceTiming)&&new T.bv(j.request),te=new ae(j);this.loading[N]=te;const he=new AbortController;te.abort=he;try{const me=yield this.loadVectorTile(j,he);if(delete this.loading[N],!me)return null;const ve=me.rawData,ue={};me.expires&&(ue.expires=me.expires),me.cacheControl&&(ue.cacheControl=me.cacheControl);const Me={};if(H){const ke=H.finish();ke&&(Me.resourceTiming=JSON.parse(JSON.stringify(ke)))}te.vectorTile=me.vectorTile;const Oe=te.parse(me.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[N]=te,this.fetching[N]={rawTileData:ve,cacheControl:ue,resourceTiming:Me};try{const ke=yield Oe;return T.e({rawTileData:ve.slice(0)},ke,ue,Me)}finally{delete this.fetching[N]}}catch(me){throw delete this.loading[N],te.status="done",this.loaded[N]=te,me}}))}reloadTile(j){return T._(this,void 0,void 0,(function*(){const N=j.uid;if(!this.loaded||!this.loaded[N])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const H=this.loaded[N];if(H.showCollisionBoxes=j.showCollisionBoxes,H.status==="parsing"){const te=yield H.parse(H.vectorTile,this.layerIndex,this.availableImages,this.actor);let he;if(this.fetching[N]){const{rawTileData:me,cacheControl:ve,resourceTiming:ue}=this.fetching[N];delete this.fetching[N],he=T.e({rawTileData:me.slice(0)},te,ve,ue)}else he=te;return he}if(H.status==="done"&&H.vectorTile)return H.parse(H.vectorTile,this.layerIndex,this.availableImages,this.actor)}))}abortTile(j){return T._(this,void 0,void 0,(function*(){const N=this.loading,H=j.uid;N&&N[H]&&N[H].abort&&(N[H].abort.abort(),delete N[H])}))}removeTile(j){return T._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[j.uid]&&delete this.loaded[j.uid]}))}}class Z{constructor(){this.loaded={}}loadTile(j){return T._(this,void 0,void 0,(function*(){const{uid:N,encoding:H,rawImageData:te,redFactor:he,greenFactor:me,blueFactor:ve,baseShift:ue}=j,Me=te.width+2,Oe=te.height+2,ke=T.b(te)?new T.R({width:Me,height:Oe},yield T.bw(te,-1,-1,Me,Oe)):te,Ye=new T.bx(N,ke,H,he,me,ve,ue);return this.loaded=this.loaded||{},this.loaded[N]=Ye,Ye}))}removeTile(j){const N=this.loaded,H=j.uid;N&&N[H]&&delete N[H]}}function Ie(ie,j){if(ie.length!==0){Re(ie[0],j);for(var N=1;N<ie.length;N++)Re(ie[N],!j)}}function Re(ie,j){for(var N=0,H=0,te=0,he=ie.length,me=he-1;te<he;me=te++){var ve=(ie[te][0]-ie[me][0])*(ie[me][1]+ie[te][1]),ue=N+ve;H+=Math.abs(N)>=Math.abs(ve)?N-ue+ve:ve-ue+N,N=ue}N+H>=0!=!!j&&ie.reverse()}var Pe=T.by((function ie(j,N){var H,te=j&&j.type;if(te==="FeatureCollection")for(H=0;H<j.features.length;H++)ie(j.features[H],N);else if(te==="GeometryCollection")for(H=0;H<j.geometries.length;H++)ie(j.geometries[H],N);else if(te==="Feature")ie(j.geometry,N);else if(te==="Polygon")Ie(j.coordinates,N);else if(te==="MultiPolygon")for(H=0;H<j.coordinates.length;H++)Ie(j.coordinates[H],N);return j}));const Le=T.bt.VectorTileFeature.prototype.toGeoJSON;var De={exports:{}},ze=T.bz,$e=T.bt.VectorTileFeature,et=Je;function Je(ie,j){this.options=j||{},this.features=ie,this.length=ie.length}function He(ie,j){this.id=typeof ie.id=="number"?ie.id:void 0,this.type=ie.type,this.rawGeometry=ie.type===1?[ie.geometry]:ie.geometry,this.properties=ie.tags,this.extent=j||4096}Je.prototype.feature=function(ie){return new He(this.features[ie],this.options.extent)},He.prototype.loadGeometry=function(){var ie=this.rawGeometry;this.geometry=[];for(var j=0;j<ie.length;j++){for(var N=ie[j],H=[],te=0;te<N.length;te++)H.push(new ze(N[te][0],N[te][1]));this.geometry.push(H)}return this.geometry},He.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ie=this.geometry,j=1/0,N=-1/0,H=1/0,te=-1/0,he=0;he<ie.length;he++)for(var me=ie[he],ve=0;ve<me.length;ve++){var ue=me[ve];j=Math.min(j,ue.x),N=Math.max(N,ue.x),H=Math.min(H,ue.y),te=Math.max(te,ue.y)}return[j,H,N,te]},He.prototype.toGeoJSON=$e.prototype.toGeoJSON;var je=T.bA,ut=et;function Ve(ie){var j=new je;return(function(N,H){for(var te in N.layers)H.writeMessage(3,tr,N.layers[te])})(ie,j),j.finish()}function tr(ie,j){var N;j.writeVarintField(15,ie.version||1),j.writeStringField(1,ie.name||""),j.writeVarintField(5,ie.extent||4096);var H={keys:[],values:[],keycache:{},valuecache:{}};for(N=0;N<ie.length;N++)H.feature=ie.feature(N),j.writeMessage(2,vt,H);var te=H.keys;for(N=0;N<te.length;N++)j.writeStringField(3,te[N]);var he=H.values;for(N=0;N<he.length;N++)j.writeMessage(4,Or,he[N])}function vt(ie,j){var N=ie.feature;N.id!==void 0&&j.writeVarintField(1,N.id),j.writeMessage(2,ar,ie),j.writeVarintField(3,N.type),j.writeMessage(4,$r,N)}function ar(ie,j){var N=ie.feature,H=ie.keys,te=ie.values,he=ie.keycache,me=ie.valuecache;for(var ve in N.properties){var ue=N.properties[ve],Me=he[ve];if(ue!==null){Me===void 0&&(H.push(ve),he[ve]=Me=H.length-1),j.writeVarint(Me);var Oe=typeof ue;Oe!=="string"&&Oe!=="boolean"&&Oe!=="number"&&(ue=JSON.stringify(ue));var ke=Oe+":"+ue,Ye=me[ke];Ye===void 0&&(te.push(ue),me[ke]=Ye=te.length-1),j.writeVarint(Ye)}}}function Rt(ie,j){return(j<<3)+(7&ie)}function Bt(ie){return ie<<1^ie>>31}function $r(ie,j){for(var N=ie.loadGeometry(),H=ie.type,te=0,he=0,me=N.length,ve=0;ve<me;ve++){var ue=N[ve],Me=1;H===1&&(Me=ue.length),j.writeVarint(Rt(1,Me));for(var Oe=H===3?ue.length-1:ue.length,ke=0;ke<Oe;ke++){ke===1&&H!==1&&j.writeVarint(Rt(2,Oe-1));var Ye=ue[ke].x-te,wt=ue[ke].y-he;j.writeVarint(Bt(Ye)),j.writeVarint(Bt(wt)),te+=Ye,he+=wt}H===3&&j.writeVarint(Rt(7,1))}}function Or(ie,j){var N=typeof ie;N==="string"?j.writeStringField(1,ie):N==="boolean"?j.writeBooleanField(7,ie):N==="number"&&(ie%1!=0?j.writeDoubleField(3,ie):ie<0?j.writeSVarintField(6,ie):j.writeVarintField(5,ie))}De.exports=Ve,De.exports.fromVectorTileJs=Ve,De.exports.fromGeojsonVt=function(ie,j){j=j||{};var N={};for(var H in ie)N[H]=new ut(ie[H].features,j),N[H].name=H,N[H].version=j.version,N[H].extent=j.extent;return Ve({layers:N})},De.exports.GeoJSONWrapper=ut;var Ht=T.by(De.exports);const lt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ie=>ie},Pt=Math.fround||(ft=new Float32Array(1),ie=>(ft[0]=+ie,ft[0]));var ft;const xe=3,Ne=5,Xt=6;class Yt{constructor(j){this.options=Object.assign(Object.create(lt),j),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(j){const{log:N,minZoom:H,maxZoom:te}=this.options;N&&console.time("total time");const he=`prepare ${j.length} points`;N&&console.time(he),this.points=j;const me=[];for(let ue=0;ue<j.length;ue++){const Me=j[ue];if(!Me.geometry)continue;const[Oe,ke]=Me.geometry.coordinates,Ye=Pt(cr(Oe)),wt=Pt(lr(ke));me.push(Ye,wt,1/0,ue,-1,1),this.options.reduce&&me.push(0)}let ve=this.trees[te+1]=this._createTree(me);N&&console.timeEnd(he);for(let ue=te;ue>=H;ue--){const Me=+Date.now();ve=this.trees[ue]=this._createTree(this._cluster(ve,ue)),N&&console.log("z%d: %d clusters in %dms",ue,ve.numItems,+Date.now()-Me)}return N&&console.timeEnd("total time"),this}getClusters(j,N){let H=((j[0]+180)%360+360)%360-180;const te=Math.max(-90,Math.min(90,j[1]));let he=j[2]===180?180:((j[2]+180)%360+360)%360-180;const me=Math.max(-90,Math.min(90,j[3]));if(j[2]-j[0]>=360)H=-180,he=180;else if(H>he){const ke=this.getClusters([H,te,180,me],N),Ye=this.getClusters([-180,te,he,me],N);return ke.concat(Ye)}const ve=this.trees[this._limitZoom(N)],ue=ve.range(cr(H),lr(me),cr(he),lr(te)),Me=ve.data,Oe=[];for(const ke of ue){const Ye=this.stride*ke;Oe.push(Me[Ye+Ne]>1?ir(Me,Ye,this.clusterProps):this.points[Me[Ye+xe]])}return Oe}getChildren(j){const N=this._getOriginId(j),H=this._getOriginZoom(j),te="No cluster with the specified id.",he=this.trees[H];if(!he)throw new Error(te);const me=he.data;if(N*this.stride>=me.length)throw new Error(te);const ve=this.options.radius/(this.options.extent*Math.pow(2,H-1)),ue=he.within(me[N*this.stride],me[N*this.stride+1],ve),Me=[];for(const Oe of ue){const ke=Oe*this.stride;me[ke+4]===j&&Me.push(me[ke+Ne]>1?ir(me,ke,this.clusterProps):this.points[me[ke+xe]])}if(Me.length===0)throw new Error(te);return Me}getLeaves(j,N,H){const te=[];return this._appendLeaves(te,j,N=N||10,H=H||0,0),te}getTile(j,N,H){const te=this.trees[this._limitZoom(j)],he=Math.pow(2,j),{extent:me,radius:ve}=this.options,ue=ve/me,Me=(H-ue)/he,Oe=(H+1+ue)/he,ke={features:[]};return this._addTileFeatures(te.range((N-ue)/he,Me,(N+1+ue)/he,Oe),te.data,N,H,he,ke),N===0&&this._addTileFeatures(te.range(1-ue/he,Me,1,Oe),te.data,he,H,he,ke),N===he-1&&this._addTileFeatures(te.range(0,Me,ue/he,Oe),te.data,-1,H,he,ke),ke.features.length?ke:null}getClusterExpansionZoom(j){let N=this._getOriginZoom(j)-1;for(;N<=this.options.maxZoom;){const H=this.getChildren(j);if(N++,H.length!==1)break;j=H[0].properties.cluster_id}return N}_appendLeaves(j,N,H,te,he){const me=this.getChildren(N);for(const ve of me){const ue=ve.properties;if(ue&&ue.cluster?he+ue.point_count<=te?he+=ue.point_count:he=this._appendLeaves(j,ue.cluster_id,H,te,he):he<te?he++:j.push(ve),j.length===H)break}return he}_createTree(j){const N=new T.av(j.length/this.stride|0,this.options.nodeSize,Float32Array);for(let H=0;H<j.length;H+=this.stride)N.add(j[H],j[H+1]);return N.finish(),N.data=j,N}_addTileFeatures(j,N,H,te,he,me){for(const ve of j){const ue=ve*this.stride,Me=N[ue+Ne]>1;let Oe,ke,Ye;if(Me)Oe=hr(N,ue,this.clusterProps),ke=N[ue],Ye=N[ue+1];else{const mr=this.points[N[ue+xe]];Oe=mr.properties;const[Zt,gr]=mr.geometry.coordinates;ke=cr(Zt),Ye=lr(gr)}const wt={type:1,geometry:[[Math.round(this.options.extent*(ke*he-H)),Math.round(this.options.extent*(Ye*he-te))]],tags:Oe};let Ct;Ct=Me||this.options.generateId?N[ue+xe]:this.points[N[ue+xe]].id,Ct!==void 0&&(wt.id=Ct),me.features.push(wt)}}_limitZoom(j){return Math.max(this.options.minZoom,Math.min(Math.floor(+j),this.options.maxZoom+1))}_cluster(j,N){const{radius:H,extent:te,reduce:he,minPoints:me}=this.options,ve=H/(te*Math.pow(2,N)),ue=j.data,Me=[],Oe=this.stride;for(let ke=0;ke<ue.length;ke+=Oe){if(ue[ke+2]<=N)continue;ue[ke+2]=N;const Ye=ue[ke],wt=ue[ke+1],Ct=j.within(ue[ke],ue[ke+1],ve),mr=ue[ke+Ne];let Zt=mr;for(const gr of Ct){const Wt=gr*Oe;ue[Wt+2]>N&&(Zt+=ue[Wt+Ne])}if(Zt>mr&&Zt>=me){let gr,Wt=Ye*mr,sn=wt*mr,Gr=-1;const rr=((ke/Oe|0)<<5)+(N+1)+this.points.length;for(const br of Ct){const Nr=br*Oe;if(ue[Nr+2]<=N)continue;ue[Nr+2]=N;const yn=ue[Nr+Ne];Wt+=ue[Nr]*yn,sn+=ue[Nr+1]*yn,ue[Nr+4]=rr,he&&(gr||(gr=this._map(ue,ke,!0),Gr=this.clusterProps.length,this.clusterProps.push(gr)),he(gr,this._map(ue,Nr)))}ue[ke+4]=rr,Me.push(Wt/Zt,sn/Zt,1/0,rr,-1,Zt),he&&Me.push(Gr)}else{for(let gr=0;gr<Oe;gr++)Me.push(ue[ke+gr]);if(Zt>1)for(const gr of Ct){const Wt=gr*Oe;if(!(ue[Wt+2]<=N)){ue[Wt+2]=N;for(let sn=0;sn<Oe;sn++)Me.push(ue[Wt+sn])}}}}return Me}_getOriginId(j){return j-this.points.length>>5}_getOriginZoom(j){return(j-this.points.length)%32}_map(j,N,H){if(j[N+Ne]>1){const me=this.clusterProps[j[N+Xt]];return H?Object.assign({},me):me}const te=this.points[j[N+xe]].properties,he=this.options.map(te);return H&&he===te?Object.assign({},he):he}}function ir(ie,j,N){return{type:"Feature",id:ie[j+xe],properties:hr(ie,j,N),geometry:{type:"Point",coordinates:[(H=ie[j],360*(H-.5)),Ir(ie[j+1])]}};var H}function hr(ie,j,N){const H=ie[j+Ne],te=H>=1e4?`${Math.round(H/1e3)}k`:H>=1e3?Math.round(H/100)/10+"k":H,he=ie[j+Xt],me=he===-1?{}:Object.assign({},N[he]);return Object.assign(me,{cluster:!0,cluster_id:ie[j+xe],point_count:H,point_count_abbreviated:te})}function cr(ie){return ie/360+.5}function lr(ie){const j=Math.sin(ie*Math.PI/180),N=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return N<0?0:N>1?1:N}function Ir(ie){const j=(180-360*ie)*Math.PI/180;return 360*Math.atan(Math.exp(j))/Math.PI-90}function mn(ie,j,N,H){let te=H;const he=j+(N-j>>1);let me,ve=N-j;const ue=ie[j],Me=ie[j+1],Oe=ie[N],ke=ie[N+1];for(let Ye=j+3;Ye<N;Ye+=3){const wt=fa(ie[Ye],ie[Ye+1],ue,Me,Oe,ke);if(wt>te)me=Ye,te=wt;else if(wt===te){const Ct=Math.abs(Ye-he);Ct<ve&&(me=Ye,ve=Ct)}}te>H&&(me-j>3&&mn(ie,j,me,H),ie[me+2]=te,N-me>3&&mn(ie,me,N,H))}function fa(ie,j,N,H,te,he){let me=te-N,ve=he-H;if(me!==0||ve!==0){const ue=((ie-N)*me+(j-H)*ve)/(me*me+ve*ve);ue>1?(N=te,H=he):ue>0&&(N+=me*ue,H+=ve*ue)}return me=ie-N,ve=j-H,me*me+ve*ve}function ws(ie,j,N,H){const te={id:ie??null,type:j,geometry:N,tags:H,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(j==="Point"||j==="MultiPoint"||j==="LineString")Yi(te,N);else if(j==="Polygon")Yi(te,N[0]);else if(j==="MultiLineString")for(const he of N)Yi(te,he);else if(j==="MultiPolygon")for(const he of N)Yi(te,he[0]);return te}function Yi(ie,j){for(let N=0;N<j.length;N+=3)ie.minX=Math.min(ie.minX,j[N]),ie.minY=Math.min(ie.minY,j[N+1]),ie.maxX=Math.max(ie.maxX,j[N]),ie.maxY=Math.max(ie.maxY,j[N+1])}function bs(ie,j,N,H){if(!j.geometry)return;const te=j.geometry.coordinates;if(te&&te.length===0)return;const he=j.geometry.type,me=Math.pow(N.tolerance/((1<<N.maxZoom)*N.extent),2);let ve=[],ue=j.id;if(N.promoteId?ue=j.properties[N.promoteId]:N.generateId&&(ue=H||0),he==="Point")Ba(te,ve);else if(he==="MultiPoint")for(const Me of te)Ba(Me,ve);else if(he==="LineString")Ee(te,ve,me,!1);else if(he==="MultiLineString"){if(N.lineMetrics){for(const Me of te)ve=[],Ee(Me,ve,me,!1),ie.push(ws(ue,"LineString",ve,j.properties));return}js(te,ve,me,!1)}else if(he==="Polygon")js(te,ve,me,!0);else{if(he!=="MultiPolygon"){if(he==="GeometryCollection"){for(const Me of j.geometry.geometries)bs(ie,{id:ue,geometry:Me,properties:j.properties},N,H);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Me of te){const Oe=[];js(Me,Oe,me,!0),ve.push(Oe)}}ie.push(ws(ue,he,ve,j.properties))}function Ba(ie,j){j.push(co(ie[0]),fr(ie[1]),0)}function Ee(ie,j,N,H){let te,he,me=0;for(let ue=0;ue<ie.length;ue++){const Me=co(ie[ue][0]),Oe=fr(ie[ue][1]);j.push(Me,Oe,0),ue>0&&(me+=H?(te*Oe-Me*he)/2:Math.sqrt(Math.pow(Me-te,2)+Math.pow(Oe-he,2))),te=Me,he=Oe}const ve=j.length-3;j[2]=1,mn(j,0,ve,N),j[ve+2]=1,j.size=Math.abs(me),j.start=0,j.end=j.size}function js(ie,j,N,H){for(let te=0;te<ie.length;te++){const he=[];Ee(ie[te],he,N,H),j.push(he)}}function co(ie){return ie/360+.5}function fr(ie){const j=Math.sin(ie*Math.PI/180),N=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return N<0?0:N>1?1:N}function Dr(ie,j,N,H,te,he,me,ve){if(H/=j,he>=(N/=j)&&me<H)return ie;if(me<N||he>=H)return null;const ue=[];for(const Me of ie){const Oe=Me.geometry;let ke=Me.type;const Ye=te===0?Me.minX:Me.minY,wt=te===0?Me.maxX:Me.maxY;if(Ye>=N&&wt<H){ue.push(Me);continue}if(wt<N||Ye>=H)continue;let Ct=[];if(ke==="Point"||ke==="MultiPoint")Ss(Oe,Ct,N,H,te);else if(ke==="LineString")ks(Oe,Ct,N,H,te,!1,ve.lineMetrics);else if(ke==="MultiLineString")Fa(Oe,Ct,N,H,te,!1);else if(ke==="Polygon")Fa(Oe,Ct,N,H,te,!0);else if(ke==="MultiPolygon")for(const mr of Oe){const Zt=[];Fa(mr,Zt,N,H,te,!0),Zt.length&&Ct.push(Zt)}if(Ct.length){if(ve.lineMetrics&&ke==="LineString"){for(const mr of Ct)ue.push(ws(Me.id,ke,mr,Me.tags));continue}ke!=="LineString"&&ke!=="MultiLineString"||(Ct.length===1?(ke="LineString",Ct=Ct[0]):ke="MultiLineString"),ke!=="Point"&&ke!=="MultiPoint"||(ke=Ct.length===3?"Point":"MultiPoint"),ue.push(ws(Me.id,ke,Ct,Me.tags))}}return ue.length?ue:null}function Ss(ie,j,N,H,te){for(let he=0;he<ie.length;he+=3){const me=ie[he+te];me>=N&&me<=H&&mi(j,ie[he],ie[he+1],ie[he+2])}}function ks(ie,j,N,H,te,he,me){let ve=Ts(ie);const ue=te===0?ho:Oa;let Me,Oe,ke=ie.start;for(let Zt=0;Zt<ie.length-3;Zt+=3){const gr=ie[Zt],Wt=ie[Zt+1],sn=ie[Zt+2],Gr=ie[Zt+3],rr=ie[Zt+4],br=te===0?gr:Wt,Nr=te===0?Gr:rr;let yn=!1;me&&(Me=Math.sqrt(Math.pow(gr-Gr,2)+Math.pow(Wt-rr,2))),br<N?Nr>N&&(Oe=ue(ve,gr,Wt,Gr,rr,N),me&&(ve.start=ke+Me*Oe)):br>H?Nr<H&&(Oe=ue(ve,gr,Wt,Gr,rr,H),me&&(ve.start=ke+Me*Oe)):mi(ve,gr,Wt,sn),Nr<N&&br>=N&&(Oe=ue(ve,gr,Wt,Gr,rr,N),yn=!0),Nr>H&&br<=H&&(Oe=ue(ve,gr,Wt,Gr,rr,H),yn=!0),!he&&yn&&(me&&(ve.end=ke+Me*Oe),j.push(ve),ve=Ts(ie)),me&&(ke+=Me)}let Ye=ie.length-3;const wt=ie[Ye],Ct=ie[Ye+1],mr=te===0?wt:Ct;mr>=N&&mr<=H&&mi(ve,wt,Ct,ie[Ye+2]),Ye=ve.length-3,he&&Ye>=3&&(ve[Ye]!==ve[0]||ve[Ye+1]!==ve[1])&&mi(ve,ve[0],ve[1],ve[2]),ve.length&&j.push(ve)}function Ts(ie){const j=[];return j.size=ie.size,j.start=ie.start,j.end=ie.end,j}function Fa(ie,j,N,H,te,he){for(const me of ie)ks(me,j,N,H,te,he,!1)}function mi(ie,j,N,H){ie.push(j,N,H)}function ho(ie,j,N,H,te,he){const me=(he-j)/(H-j);return mi(ie,he,N+(te-N)*me,1),me}function Oa(ie,j,N,H,te,he){const me=(he-N)/(te-N);return mi(ie,j+(H-j)*me,he,1),me}function Ke(ie,j){const N=[];for(let H=0;H<ie.length;H++){const te=ie[H],he=te.type;let me;if(he==="Point"||he==="MultiPoint"||he==="LineString")me=Ji(te.geometry,j);else if(he==="MultiLineString"||he==="Polygon"){me=[];for(const ve of te.geometry)me.push(Ji(ve,j))}else if(he==="MultiPolygon"){me=[];for(const ve of te.geometry){const ue=[];for(const Me of ve)ue.push(Ji(Me,j));me.push(ue)}}N.push(ws(te.id,he,me,te.tags))}return N}function Ji(ie,j){const N=[];N.size=ie.size,ie.start!==void 0&&(N.start=ie.start,N.end=ie.end);for(let H=0;H<ie.length;H+=3)N.push(ie[H]+j,ie[H+1],ie[H+2]);return N}function gn(ie,j){if(ie.transformed)return ie;const N=1<<ie.z,H=ie.x,te=ie.y;for(const he of ie.features){const me=he.geometry,ve=he.type;if(he.geometry=[],ve===1)for(let ue=0;ue<me.length;ue+=2)he.geometry.push(Jn(me[ue],me[ue+1],j,N,H,te));else for(let ue=0;ue<me.length;ue++){const Me=[];for(let Oe=0;Oe<me[ue].length;Oe+=2)Me.push(Jn(me[ue][Oe],me[ue][Oe+1],j,N,H,te));he.geometry.push(Me)}}return ie.transformed=!0,ie}function Jn(ie,j,N,H,te,he){return[Math.round(N*(ie*H-te)),Math.round(N*(j*H-he))]}function ma(ie,j,N,H,te){const he=j===te.maxZoom?0:te.tolerance/((1<<j)*te.extent),me={features:[],numPoints:0,numSimplified:0,numFeatures:ie.length,source:null,x:N,y:H,z:j,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ve of ie)rt(me,ve,he,te);return me}function rt(ie,j,N,H){const te=j.geometry,he=j.type,me=[];if(ie.minX=Math.min(ie.minX,j.minX),ie.minY=Math.min(ie.minY,j.minY),ie.maxX=Math.max(ie.maxX,j.maxX),ie.maxY=Math.max(ie.maxY,j.maxY),he==="Point"||he==="MultiPoint")for(let ve=0;ve<te.length;ve+=3)me.push(te[ve],te[ve+1]),ie.numPoints++,ie.numSimplified++;else if(he==="LineString")Jt(me,te,ie,N,!1,!1);else if(he==="MultiLineString"||he==="Polygon")for(let ve=0;ve<te.length;ve++)Jt(me,te[ve],ie,N,he==="Polygon",ve===0);else if(he==="MultiPolygon")for(let ve=0;ve<te.length;ve++){const ue=te[ve];for(let Me=0;Me<ue.length;Me++)Jt(me,ue[Me],ie,N,!0,Me===0)}if(me.length){let ve=j.tags||null;if(he==="LineString"&&H.lineMetrics){ve={};for(const Me in j.tags)ve[Me]=j.tags[Me];ve.mapbox_clip_start=te.start/te.size,ve.mapbox_clip_end=te.end/te.size}const ue={geometry:me,type:he==="Polygon"||he==="MultiPolygon"?3:he==="LineString"||he==="MultiLineString"?2:1,tags:ve};j.id!==null&&(ue.id=j.id),ie.features.push(ue)}}function Jt(ie,j,N,H,te,he){const me=H*H;if(H>0&&j.size<(te?me:H))return void(N.numPoints+=j.length/3);const ve=[];for(let ue=0;ue<j.length;ue+=3)(H===0||j[ue+2]>me)&&(N.numSimplified++,ve.push(j[ue],j[ue+1])),N.numPoints++;te&&(function(ue,Me){let Oe=0;for(let ke=0,Ye=ue.length,wt=Ye-2;ke<Ye;wt=ke,ke+=2)Oe+=(ue[ke]-ue[wt])*(ue[ke+1]+ue[wt+1]);if(Oe>0===Me)for(let ke=0,Ye=ue.length;ke<Ye/2;ke+=2){const wt=ue[ke],Ct=ue[ke+1];ue[ke]=ue[Ye-2-ke],ue[ke+1]=ue[Ye-1-ke],ue[Ye-2-ke]=wt,ue[Ye-1-ke]=Ct}})(ve,he),ie.push(ve)}const Ft={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ln{constructor(j,N){const H=(N=this.options=(function(he,me){for(const ve in me)he[ve]=me[ve];return he})(Object.create(Ft),N)).debug;if(H&&console.time("preprocess data"),N.maxZoom<0||N.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(N.promoteId&&N.generateId)throw new Error("promoteId and generateId cannot be used together.");let te=(function(he,me){const ve=[];if(he.type==="FeatureCollection")for(let ue=0;ue<he.features.length;ue++)bs(ve,he.features[ue],me,ue);else bs(ve,he.type==="Feature"?he:{geometry:he},me);return ve})(j,N);this.tiles={},this.tileCoords=[],H&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",N.indexMaxZoom,N.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),te=(function(he,me){const ve=me.buffer/me.extent;let ue=he;const Me=Dr(he,1,-1-ve,ve,0,-1,2,me),Oe=Dr(he,1,1-ve,2+ve,0,-1,2,me);return(Me||Oe)&&(ue=Dr(he,1,-ve,1+ve,0,-1,2,me)||[],Me&&(ue=Ke(Me,1).concat(ue)),Oe&&(ue=ue.concat(Ke(Oe,-1)))),ue})(te,N),te.length&&this.splitTile(te,0,0,0),H&&(te.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(j,N,H,te,he,me,ve){const ue=[j,N,H,te],Me=this.options,Oe=Me.debug;for(;ue.length;){te=ue.pop(),H=ue.pop(),N=ue.pop(),j=ue.pop();const ke=1<<N,Ye=gi(N,H,te);let wt=this.tiles[Ye];if(!wt&&(Oe>1&&console.time("creation"),wt=this.tiles[Ye]=ma(j,N,H,te,Me),this.tileCoords.push({z:N,x:H,y:te}),Oe)){Oe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",N,H,te,wt.numFeatures,wt.numPoints,wt.numSimplified),console.timeEnd("creation"));const yn=`z${N}`;this.stats[yn]=(this.stats[yn]||0)+1,this.total++}if(wt.source=j,he==null){if(N===Me.indexMaxZoom||wt.numPoints<=Me.indexMaxPoints)continue}else{if(N===Me.maxZoom||N===he)continue;if(he!=null){const yn=he-N;if(H!==me>>yn||te!==ve>>yn)continue}}if(wt.source=null,j.length===0)continue;Oe>1&&console.time("clipping");const Ct=.5*Me.buffer/Me.extent,mr=.5-Ct,Zt=.5+Ct,gr=1+Ct;let Wt=null,sn=null,Gr=null,rr=null,br=Dr(j,ke,H-Ct,H+Zt,0,wt.minX,wt.maxX,Me),Nr=Dr(j,ke,H+mr,H+gr,0,wt.minX,wt.maxX,Me);j=null,br&&(Wt=Dr(br,ke,te-Ct,te+Zt,1,wt.minY,wt.maxY,Me),sn=Dr(br,ke,te+mr,te+gr,1,wt.minY,wt.maxY,Me),br=null),Nr&&(Gr=Dr(Nr,ke,te-Ct,te+Zt,1,wt.minY,wt.maxY,Me),rr=Dr(Nr,ke,te+mr,te+gr,1,wt.minY,wt.maxY,Me),Nr=null),Oe>1&&console.timeEnd("clipping"),ue.push(Wt||[],N+1,2*H,2*te),ue.push(sn||[],N+1,2*H,2*te+1),ue.push(Gr||[],N+1,2*H+1,2*te),ue.push(rr||[],N+1,2*H+1,2*te+1)}}getTile(j,N,H){j=+j,N=+N,H=+H;const te=this.options,{extent:he,debug:me}=te;if(j<0||j>24)return null;const ve=1<<j,ue=gi(j,N=N+ve&ve-1,H);if(this.tiles[ue])return gn(this.tiles[ue],he);me>1&&console.log("drilling down to z%d-%d-%d",j,N,H);let Me,Oe=j,ke=N,Ye=H;for(;!Me&&Oe>0;)Oe--,ke>>=1,Ye>>=1,Me=this.tiles[gi(Oe,ke,Ye)];return Me&&Me.source?(me>1&&(console.log("found parent tile z%d-%d-%d",Oe,ke,Ye),console.time("drilling down")),this.splitTile(Me.source,Oe,ke,Ye,j,N,H),me>1&&console.timeEnd("drilling down"),this.tiles[ue]?gn(this.tiles[ue],he):null):null}}function gi(ie,j,N){return 32*((1<<ie)*N+j)+ie}function Vt(ie,j){return j?ie.properties[j]:ie.id}function Ai(ie,j){if(ie==null)return!0;if(ie.type==="Feature")return Vt(ie,j)!=null;if(ie.type==="FeatureCollection"){const N=new Set;for(const H of ie.features){const te=Vt(H,j);if(te==null||N.has(te))return!1;N.add(te)}return!0}return!1}function Qi(ie,j){const N=new Map;if(ie!=null)if(ie.type==="Feature")N.set(Vt(ie,j),ie);else for(const H of ie.features)N.set(Vt(H,j),H);return N}class yi extends Y{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(j,N){return T._(this,void 0,void 0,(function*(){const H=j.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const te=this._geoJSONIndex.getTile(H.z,H.x,H.y);if(!te)return null;const he=new class{constructor(ve){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=T.X,this.length=ve.length,this._features=ve}feature(ve){return new class{constructor(ue){this._feature=ue,this.extent=T.X,this.type=ue.type,this.properties=ue.tags,"id"in ue&&!isNaN(ue.id)&&(this.id=parseInt(ue.id,10))}loadGeometry(){if(this._feature.type===1){const ue=[];for(const Me of this._feature.geometry)ue.push([new T.P(Me[0],Me[1])]);return ue}{const ue=[];for(const Me of this._feature.geometry){const Oe=[];for(const ke of Me)Oe.push(new T.P(ke[0],ke[1]));ue.push(Oe)}return ue}}toGeoJSON(ue,Me,Oe){return Le.call(this,ue,Me,Oe)}}(this._features[ve])}}(te.features);let me=Ht(he);return me.byteOffset===0&&me.byteLength===me.buffer.byteLength||(me=new Uint8Array(me)),{vectorTile:he,rawData:me.buffer}}))}loadData(j){return T._(this,void 0,void 0,(function*(){var N;(N=this._pendingRequest)===null||N===void 0||N.abort();const H=!!(j&&j.request&&j.request.collectResourceTiming)&&new T.bv(j.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(j,this._pendingRequest),this._geoJSONIndex=j.cluster?new Yt((function({superclusterOptions:me,clusterProperties:ve}){if(!ve||!me)return me;const ue={},Me={},Oe={accumulated:null,zoom:0},ke={properties:null},Ye=Object.keys(ve);for(const wt of Ye){const[Ct,mr]=ve[wt],Zt=T.bC(mr),gr=T.bC(typeof Ct=="string"?[Ct,["accumulated"],["get",wt]]:Ct);ue[wt]=Zt.value,Me[wt]=gr.value}return me.map=wt=>{ke.properties=wt;const Ct={};for(const mr of Ye)Ct[mr]=ue[mr].evaluate(Oe,ke);return Ct},me.reduce=(wt,Ct)=>{ke.properties=Ct;for(const mr of Ye)Oe.accumulated=wt[mr],wt[mr]=Me[mr].evaluate(Oe,ke)},me})(j)).load((yield this._pendingData).features):(te=yield this._pendingData,new Ln(te,j.geojsonVtOptions)),this.loaded={};const he={};if(H){const me=H.finish();me&&(he.resourceTiming={},he.resourceTiming[j.source]=JSON.parse(JSON.stringify(me)))}return he}catch(he){if(delete this._pendingRequest,T.bB(he))return{abandoned:!0};throw he}var te}))}getData(){return T._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(j){const N=this.loaded;return N&&N[j.uid]?super.reloadTile(j):this.loadTile(j)}loadAndProcessGeoJSON(j,N){return T._(this,void 0,void 0,(function*(){let H=yield this.loadGeoJSON(j,N);if(delete this._pendingRequest,typeof H!="object")throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`);if(Pe(H,!0),j.filter){const te=T.bC(j.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(te.result==="error")throw new Error(te.value.map((me=>`${me.key}: ${me.message}`)).join(", "));H={type:"FeatureCollection",features:H.features.filter((me=>te.value.evaluate({zoom:0},me)))}}return H}))}loadGeoJSON(j,N){return T._(this,void 0,void 0,(function*(){const{promoteId:H}=j;if(j.request){const te=yield T.h(j.request,N);return this._dataUpdateable=Ai(te.data,H)?Qi(te.data,H):void 0,te.data}if(typeof j.data=="string")try{const te=JSON.parse(j.data);return this._dataUpdateable=Ai(te,H)?Qi(te,H):void 0,te}catch{throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`)}if(!j.dataDiff)throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${j.source}`);return(function(te,he,me){var ve,ue,Me,Oe;if(he.removeAll&&te.clear(),he.remove)for(const ke of he.remove)te.delete(ke);if(he.add)for(const ke of he.add){const Ye=Vt(ke,me);Ye!=null&&te.set(Ye,ke)}if(he.update)for(const ke of he.update){let Ye=te.get(ke.id);if(Ye==null)continue;const wt=!ke.removeAllProperties&&(((ve=ke.removeProperties)===null||ve===void 0?void 0:ve.length)>0||((ue=ke.addOrUpdateProperties)===null||ue===void 0?void 0:ue.length)>0);if((ke.newGeometry||ke.removeAllProperties||wt)&&(Ye=Object.assign({},Ye),te.set(ke.id,Ye),wt&&(Ye.properties=Object.assign({},Ye.properties))),ke.newGeometry&&(Ye.geometry=ke.newGeometry),ke.removeAllProperties)Ye.properties={};else if(((Me=ke.removeProperties)===null||Me===void 0?void 0:Me.length)>0)for(const Ct of ke.removeProperties)Object.prototype.hasOwnProperty.call(Ye.properties,Ct)&&delete Ye.properties[Ct];if(((Oe=ke.addOrUpdateProperties)===null||Oe===void 0?void 0:Oe.length)>0)for(const{key:Ct,value:mr}of ke.addOrUpdateProperties)Ye.properties[Ct]=mr}})(this._dataUpdateable,j.dataDiff,H),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(j){return T._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(j){return this._geoJSONIndex.getClusterExpansionZoom(j.clusterId)}getClusterChildren(j){return this._geoJSONIndex.getChildren(j.clusterId)}getClusterLeaves(j){return this._geoJSONIndex.getLeaves(j.clusterId,j.limit,j.offset)}}class Un{constructor(j){this.self=j,this.actor=new T.F(j),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(N,H)=>{if(this.externalWorkerSourceTypes[N])throw new Error(`Worker source with name "${N}" already registered.`);this.externalWorkerSourceTypes[N]=H},this.self.addProtocol=T.bi,this.self.removeProtocol=T.bj,this.self.registerRTLTextPlugin=N=>{if(T.bD.isParsed())throw new Error("RTL text plugin already registered.");T.bD.setMethods(N)},this.actor.registerMessageHandler("LDT",((N,H)=>this._getDEMWorkerSource(N,H.source).loadTile(H))),this.actor.registerMessageHandler("RDT",((N,H)=>T._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(N,H.source).removeTile(H)})))),this.actor.registerMessageHandler("GCEZ",((N,H)=>T._(this,void 0,void 0,(function*(){return this._getWorkerSource(N,H.type,H.source).getClusterExpansionZoom(H)})))),this.actor.registerMessageHandler("GCC",((N,H)=>T._(this,void 0,void 0,(function*(){return this._getWorkerSource(N,H.type,H.source).getClusterChildren(H)})))),this.actor.registerMessageHandler("GCL",((N,H)=>T._(this,void 0,void 0,(function*(){return this._getWorkerSource(N,H.type,H.source).getClusterLeaves(H)})))),this.actor.registerMessageHandler("LD",((N,H)=>this._getWorkerSource(N,H.type,H.source).loadData(H))),this.actor.registerMessageHandler("GD",((N,H)=>this._getWorkerSource(N,H.type,H.source).getData())),this.actor.registerMessageHandler("LT",((N,H)=>this._getWorkerSource(N,H.type,H.source).loadTile(H))),this.actor.registerMessageHandler("RT",((N,H)=>this._getWorkerSource(N,H.type,H.source).reloadTile(H))),this.actor.registerMessageHandler("AT",((N,H)=>this._getWorkerSource(N,H.type,H.source).abortTile(H))),this.actor.registerMessageHandler("RMT",((N,H)=>this._getWorkerSource(N,H.type,H.source).removeTile(H))),this.actor.registerMessageHandler("RS",((N,H)=>T._(this,void 0,void 0,(function*(){if(!this.workerSources[N]||!this.workerSources[N][H.type]||!this.workerSources[N][H.type][H.source])return;const te=this.workerSources[N][H.type][H.source];delete this.workerSources[N][H.type][H.source],te.removeSource!==void 0&&te.removeSource(H)})))),this.actor.registerMessageHandler("RM",(N=>T._(this,void 0,void 0,(function*(){delete this.layerIndexes[N],delete this.availableImages[N],delete this.workerSources[N],delete this.demWorkerSources[N]})))),this.actor.registerMessageHandler("SR",((N,H)=>T._(this,void 0,void 0,(function*(){this.referrer=H})))),this.actor.registerMessageHandler("SRPS",((N,H)=>this._syncRTLPluginState(N,H))),this.actor.registerMessageHandler("IS",((N,H)=>T._(this,void 0,void 0,(function*(){this.self.importScripts(H)})))),this.actor.registerMessageHandler("SI",((N,H)=>this._setImages(N,H))),this.actor.registerMessageHandler("UL",((N,H)=>T._(this,void 0,void 0,(function*(){this._getLayerIndex(N).update(H.layers,H.removedIds)})))),this.actor.registerMessageHandler("SL",((N,H)=>T._(this,void 0,void 0,(function*(){this._getLayerIndex(N).replace(H)}))))}_setImages(j,N){return T._(this,void 0,void 0,(function*(){this.availableImages[j]=N;for(const H in this.workerSources[j]){const te=this.workerSources[j][H];for(const he in te)te[he].availableImages=N}}))}_syncRTLPluginState(j,N){return T._(this,void 0,void 0,(function*(){if(T.bD.isParsed())return T.bD.getState();if(N.pluginStatus!=="loading")return T.bD.setState(N),N;const H=N.pluginURL;if(this.self.importScripts(H),T.bD.isParsed()){const te={pluginStatus:"loaded",pluginURL:H};return T.bD.setState(te),te}throw T.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${H}`)}))}_getAvailableImages(j){let N=this.availableImages[j];return N||(N=[]),N}_getLayerIndex(j){let N=this.layerIndexes[j];return N||(N=this.layerIndexes[j]=new h),N}_getWorkerSource(j,N,H){if(this.workerSources[j]||(this.workerSources[j]={}),this.workerSources[j][N]||(this.workerSources[j][N]={}),!this.workerSources[j][N][H]){const te={sendAsync:(he,me)=>(he.targetMapId=j,this.actor.sendAsync(he,me))};switch(N){case"vector":this.workerSources[j][N][H]=new Y(te,this._getLayerIndex(j),this._getAvailableImages(j));break;case"geojson":this.workerSources[j][N][H]=new yi(te,this._getLayerIndex(j),this._getAvailableImages(j));break;default:this.workerSources[j][N][H]=new this.externalWorkerSourceTypes[N](te,this._getLayerIndex(j),this._getAvailableImages(j))}}return this.workerSources[j][N][H]}_getDEMWorkerSource(j,N){return this.demWorkerSources[j]||(this.demWorkerSources[j]={}),this.demWorkerSources[j][N]||(this.demWorkerSources[j][N]=new Z),this.demWorkerSources[j][N]}}return T.i(self)&&(self.worker=new Un(self)),Un})),D("index",["exports","./shared"],(function(T,h){var X="4.7.1";let ae,Q;const Y={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:f=>new Promise(((e,s)=>{const l=requestAnimationFrame(e);f.signal.addEventListener("abort",(()=>{cancelAnimationFrame(l),s(h.c())}))})),getImageData(f,e=0){return this.getImageCanvasContext(f).getImageData(-e,-e,f.width+2*e,f.height+2*e)},getImageCanvasContext(f){const e=window.document.createElement("canvas"),s=e.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return e.width=f.width,e.height=f.height,s.drawImage(f,0,0,f.width,f.height),s},resolveURL:f=>(ae||(ae=document.createElement("a")),ae.href=f,ae.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Q==null&&(Q=matchMedia("(prefers-reduced-motion: reduce)")),Q.matches)}};class Z{static testProp(e){if(!Z.docStyle)return e[0];for(let s=0;s<e.length;s++)if(e[s]in Z.docStyle)return e[s];return e[0]}static create(e,s,l){const u=window.document.createElement(e);return s!==void 0&&(u.className=s),l&&l.appendChild(u),u}static createNS(e,s){return window.document.createElementNS(e,s)}static disableDrag(){Z.docStyle&&Z.selectProp&&(Z.userSelect=Z.docStyle[Z.selectProp],Z.docStyle[Z.selectProp]="none")}static enableDrag(){Z.docStyle&&Z.selectProp&&(Z.docStyle[Z.selectProp]=Z.userSelect)}static setTransform(e,s){e.style[Z.transformProp]=s}static addEventListener(e,s,l,u={}){e.addEventListener(s,l,"passive"in u?u:u.capture)}static removeEventListener(e,s,l,u={}){e.removeEventListener(s,l,"passive"in u?u:u.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",Z.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Z.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",Z.suppressClickInternal,!0)}),0)}static getScale(e){const s=e.getBoundingClientRect();return{x:s.width/e.offsetWidth||1,y:s.height/e.offsetHeight||1,boundingClientRect:s}}static getPoint(e,s,l){const u=s.boundingClientRect;return new h.P((l.clientX-u.left)/s.x-e.clientLeft,(l.clientY-u.top)/s.y-e.clientTop)}static mousePos(e,s){const l=Z.getScale(e);return Z.getPoint(e,l,s)}static touchPos(e,s){const l=[],u=Z.getScale(e);for(let p=0;p<s.length;p++)l.push(Z.getPoint(e,u,s[p]));return l}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}Z.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,Z.selectProp=Z.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),Z.transformProp=Z.testProp(["transform","WebkitTransform"]);const Ie={supported:!1,testSupport:function(f){!Le&&Pe&&(De?ze(f):Re=f)}};let Re,Pe,Le=!1,De=!1;function ze(f){const e=f.createTexture();f.bindTexture(f.TEXTURE_2D,e);try{if(f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,Pe),f.isContextLost())return;Ie.supported=!0}catch{}f.deleteTexture(e),Le=!0}var $e;typeof document<"u"&&(Pe=document.createElement("img"),Pe.onload=()=>{Re&&ze(Re),Re=null,De=!0},Pe.onerror=()=>{Le=!0,Re=null},Pe.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(f){let e,s,l,u;f.resetRequestQueue=()=>{e=[],s=0,l=0,u={}},f.addThrottleControl=E=>{const A=l++;return u[A]=E,A},f.removeThrottleControl=E=>{delete u[E],w()},f.getImage=(E,A,R=!0)=>new Promise(((B,U)=>{Ie.supported&&(E.headers||(E.headers={}),E.headers.accept="image/webp,*/*"),h.e(E,{type:"image"}),e.push({abortController:A,requestParameters:E,supportImageRefresh:R,state:"queued",onError:G=>{U(G)},onSuccess:G=>{B(G)}}),w()}));const p=E=>h._(this,void 0,void 0,(function*(){E.state="running";const{requestParameters:A,supportImageRefresh:R,onError:B,onSuccess:U,abortController:G}=E,W=R===!1&&!h.i(self)&&!h.g(A.url)&&(!A.headers||Object.keys(A.headers).reduce(((se,ce)=>se&&ce==="accept"),!0));s++;const J=W?k(A,G):h.m(A,G);try{const se=yield J;delete E.abortController,E.state="completed",se.data instanceof HTMLImageElement||h.b(se.data)?U(se):se.data&&U({data:yield(re=se.data,typeof createImageBitmap=="function"?h.d(re):h.f(re)),cacheControl:se.cacheControl,expires:se.expires})}catch(se){delete E.abortController,B(se)}finally{s--,w()}var re})),w=()=>{const E=(()=>{for(const A of Object.keys(u))if(u[A]())return!0;return!1})()?h.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:h.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let A=s;A<E&&e.length>0;A++){const R=e.shift();R.abortController.signal.aborted?A--:p(R)}},k=(E,A)=>new Promise(((R,B)=>{const U=new Image,G=E.url,W=E.credentials;W&&W==="include"?U.crossOrigin="use-credentials":(W&&W==="same-origin"||!h.s(G))&&(U.crossOrigin="anonymous"),A.signal.addEventListener("abort",(()=>{U.src="",B(h.c())})),U.fetchPriority="high",U.onload=()=>{U.onerror=U.onload=null,R({data:U})},U.onerror=()=>{U.onerror=U.onload=null,A.signal.aborted||B(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},U.src=G}))})($e||($e={})),$e.resetRequestQueue();class et{constructor(e){this._transformRequestFn=e}transformRequest(e,s){return this._transformRequestFn&&this._transformRequestFn(e,s)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function Je(f){var e=new h.A(3);return e[0]=f[0],e[1]=f[1],e[2]=f[2],e}var He,je=function(f,e,s){return f[0]=e[0]-s[0],f[1]=e[1]-s[1],f[2]=e[2]-s[2],f};He=new h.A(3),h.A!=Float32Array&&(He[0]=0,He[1]=0,He[2]=0);var ut=function(f){var e=f[0],s=f[1];return e*e+s*s};function Ve(f){const e=[];if(typeof f=="string")e.push({id:"default",url:f});else if(f&&f.length>0){const s=[];for(const{id:l,url:u}of f){const p=`${l}${u}`;s.indexOf(p)===-1&&(s.push(p),e.push({id:l,url:u}))}}return e}function tr(f,e,s){const l=f.split("?");return l[0]+=`${e}${s}`,l.join("?")}(function(){var f=new h.A(2);h.A!=Float32Array&&(f[0]=0,f[1]=0)})();class vt{constructor(e,s,l,u){this.context=e,this.format=l,this.texture=e.gl.createTexture(),this.update(s,u)}update(e,s,l){const{width:u,height:p}=e,w=!(this.size&&this.size[0]===u&&this.size[1]===p||l),{context:k}=this,{gl:E}=k;if(this.useMipmap=!!(s&&s.useMipmap),E.bindTexture(E.TEXTURE_2D,this.texture),k.pixelStoreUnpackFlipY.set(!1),k.pixelStoreUnpack.set(1),k.pixelStoreUnpackPremultiplyAlpha.set(this.format===E.RGBA&&(!s||s.premultiply!==!1)),w)this.size=[u,p],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||h.b(e)?E.texImage2D(E.TEXTURE_2D,0,this.format,this.format,E.UNSIGNED_BYTE,e):E.texImage2D(E.TEXTURE_2D,0,this.format,u,p,0,this.format,E.UNSIGNED_BYTE,e.data);else{const{x:A,y:R}=l||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||h.b(e)?E.texSubImage2D(E.TEXTURE_2D,0,A,R,E.RGBA,E.UNSIGNED_BYTE,e):E.texSubImage2D(E.TEXTURE_2D,0,A,R,u,p,E.RGBA,E.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&E.generateMipmap(E.TEXTURE_2D)}bind(e,s,l){const{context:u}=this,{gl:p}=u;p.bindTexture(p.TEXTURE_2D,this.texture),l!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=p.LINEAR),e!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,l||e),this.filter=e),s!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,s),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function ar(f){const{userImage:e}=f;return!!(e&&e.render&&e.render())&&(f.data.replace(new Uint8Array(e.data.buffer)),!0)}class Rt extends h.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new h.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:s,promiseResolve:l}of this.requestors)l(this._getImagesForIds(s));this.requestors=[]}}getImage(e){const s=this.images[e];if(s&&!s.data&&s.spriteData){const l=s.spriteData;s.data=new h.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),s.spriteData=null}return s}addImage(e,s){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,s)&&(this.images[e]=s)}_validate(e,s){let l=!0;const u=s.data||s.spriteData;return this._validateStretch(s.stretchX,u&&u.width)||(this.fire(new h.j(new Error(`Image "${e}" has invalid "stretchX" value`))),l=!1),this._validateStretch(s.stretchY,u&&u.height)||(this.fire(new h.j(new Error(`Image "${e}" has invalid "stretchY" value`))),l=!1),this._validateContent(s.content,s)||(this.fire(new h.j(new Error(`Image "${e}" has invalid "content" value`))),l=!1),l}_validateStretch(e,s){if(!e)return!0;let l=0;for(const u of e){if(u[0]<l||u[1]<u[0]||s<u[1])return!1;l=u[1]}return!0}_validateContent(e,s){if(!e)return!0;if(e.length!==4)return!1;const l=s.spriteData,u=l&&l.width||s.data.width,p=l&&l.height||s.data.height;return!(e[0]<0||u<e[0]||e[1]<0||p<e[1]||e[2]<0||u<e[2]||e[3]<0||p<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,s,l=!0){const u=this.getImage(e);if(l&&(u.data.width!==s.data.width||u.data.height!==s.data.height))throw new Error(`size mismatch between old image (${u.data.width}x${u.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=u.version+1,this.images[e]=s,this.updatedImages[e]=!0}removeImage(e){const s=this.images[e];delete this.images[e],delete this.patterns[e],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise(((s,l)=>{let u=!0;if(!this.isLoaded())for(const p of e)this.images[p]||(u=!1);this.isLoaded()||u?s(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:s})}))}_getImagesForIds(e){const s={};for(const l of e){let u=this.getImage(l);u||(this.fire(new h.k("styleimagemissing",{id:l})),u=this.getImage(l)),u?s[l]={data:u.data.clone(),pixelRatio:u.pixelRatio,sdf:u.sdf,version:u.version,stretchX:u.stretchX,stretchY:u.stretchY,content:u.content,textFitWidth:u.textFitWidth,textFitHeight:u.textFitHeight,hasRenderCallback:!!(u.userImage&&u.userImage.render)}:h.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return s}getPixelSize(){const{width:e,height:s}=this.atlasImage;return{width:e,height:s}}getPattern(e){const s=this.patterns[e],l=this.getImage(e);if(!l)return null;if(s&&s.position.version===l.version)return s.position;if(s)s.position.version=l.version;else{const u={w:l.data.width+2,h:l.data.height+2,x:0,y:0},p=new h.I(u,l);this.patterns[e]={bin:u,position:p}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const s=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new vt(e,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const p in this.patterns)e.push(this.patterns[p].bin);const{w:s,h:l}=h.p(e),u=this.atlasImage;u.resize({width:s||1,height:l||1});for(const p in this.patterns){const{bin:w}=this.patterns[p],k=w.x+1,E=w.y+1,A=this.getImage(p).data,R=A.width,B=A.height;h.R.copy(A,u,{x:0,y:0},{x:k,y:E},{width:R,height:B}),h.R.copy(A,u,{x:0,y:B-1},{x:k,y:E-1},{width:R,height:1}),h.R.copy(A,u,{x:0,y:0},{x:k,y:E+B},{width:R,height:1}),h.R.copy(A,u,{x:R-1,y:0},{x:k-1,y:E},{width:1,height:B}),h.R.copy(A,u,{x:0,y:0},{x:k+R,y:E},{width:1,height:B})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const s of e){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const l=this.getImage(s);l||h.w(`Image with ID: "${s}" was not found`),ar(l)&&this.updateImage(s,l)}}}const Bt=1e20;function $r(f,e,s,l,u,p,w,k,E){for(let A=e;A<e+l;A++)Or(f,s*p+A,p,u,w,k,E);for(let A=s;A<s+u;A++)Or(f,A*p+e,1,l,w,k,E)}function Or(f,e,s,l,u,p,w){p[0]=0,w[0]=-Bt,w[1]=Bt,u[0]=f[e];for(let k=1,E=0,A=0;k<l;k++){u[k]=f[e+k*s];const R=k*k;do{const B=p[E];A=(u[k]-u[B]+R-B*B)/(k-B)/2}while(A<=w[E]&&--E>-1);E++,p[E]=k,w[E]=A,w[E+1]=Bt}for(let k=0,E=0;k<l;k++){for(;w[E+1]<k;)E++;const A=p[E],R=k-A;f[e+k*s]=u[A]+R*R}}class Ht{constructor(e,s){this.requestManager=e,this.localIdeographFontFamily=s,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return h._(this,void 0,void 0,(function*(){const s=[];for(const p in e)for(const w of e[p])s.push(this._getAndCacheGlyphsPromise(p,w));const l=yield Promise.all(s),u={};for(const{stack:p,id:w,glyph:k}of l)u[p]||(u[p]={}),u[p][w]=k&&{id:k.id,bitmap:k.bitmap.clone(),metrics:k.metrics};return u}))}_getAndCacheGlyphsPromise(e,s){return h._(this,void 0,void 0,(function*(){let l=this.entries[e];l||(l=this.entries[e]={glyphs:{},requests:{},ranges:{}});let u=l.glyphs[s];if(u!==void 0)return{stack:e,id:s,glyph:u};if(u=this._tinySDF(l,e,s),u)return l.glyphs[s]=u,{stack:e,id:s,glyph:u};const p=Math.floor(s/256);if(256*p>65535)throw new Error("glyphs > 65535 not supported");if(l.ranges[p])return{stack:e,id:s,glyph:u};if(!this.url)throw new Error("glyphsUrl is not set");if(!l.requests[p]){const k=Ht.loadGlyphRange(e,p,this.url,this.requestManager);l.requests[p]=k}const w=yield l.requests[p];for(const k in w)this._doesCharSupportLocalGlyph(+k)||(l.glyphs[+k]=w[+k]);return l.ranges[p]=!0,{stack:e,id:s,glyph:w[s]||null}}))}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))}_tinySDF(e,s,l){const u=this.localIdeographFontFamily;if(!u||!this._doesCharSupportLocalGlyph(l))return;let p=e.tinySDF;if(!p){let k="400";/bold/i.test(s)?k="900":/medium/i.test(s)?k="500":/light/i.test(s)&&(k="200"),p=e.tinySDF=new Ht.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:u,fontWeight:k})}const w=p.draw(String.fromCharCode(l));return{id:l,bitmap:new h.o({width:w.width||60,height:w.height||60},w.data),metrics:{width:w.glyphWidth/2||24,height:w.glyphHeight/2||24,left:w.glyphLeft/2+.5||0,top:w.glyphTop/2-27.5||-8,advance:w.glyphAdvance/2||24,isDoubleResolution:!0}}}}Ht.loadGlyphRange=function(f,e,s,l){return h._(this,void 0,void 0,(function*(){const u=256*e,p=u+255,w=l.transformRequest(s.replace("{fontstack}",f).replace("{range}",`${u}-${p}`),"Glyphs"),k=yield h.l(w,new AbortController);if(!k||!k.data)throw new Error(`Could not load glyph range. range: ${e}, ${u}-${p}`);const E={};for(const A of h.n(k.data))E[A.id]=A;return E}))},Ht.TinySDF=class{constructor({fontSize:f=24,buffer:e=3,radius:s=8,cutoff:l=.25,fontFamily:u="sans-serif",fontWeight:p="normal",fontStyle:w="normal"}={}){this.buffer=e,this.cutoff=l,this.radius=s;const k=this.size=f+4*e,E=this._createCanvas(k),A=this.ctx=E.getContext("2d",{willReadFrequently:!0});A.font=`${w} ${p} ${f}px ${u}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(k*k),this.gridInner=new Float64Array(k*k),this.f=new Float64Array(k),this.z=new Float64Array(k+1),this.v=new Uint16Array(k)}_createCanvas(f){const e=document.createElement("canvas");return e.width=e.height=f,e}draw(f){const{width:e,actualBoundingBoxAscent:s,actualBoundingBoxDescent:l,actualBoundingBoxLeft:u,actualBoundingBoxRight:p}=this.ctx.measureText(f),w=Math.ceil(s),k=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-u))),E=Math.min(this.size-this.buffer,w+Math.ceil(l)),A=k+2*this.buffer,R=E+2*this.buffer,B=Math.max(A*R,0),U=new Uint8ClampedArray(B),G={data:U,width:A,height:R,glyphWidth:k,glyphHeight:E,glyphTop:w,glyphLeft:0,glyphAdvance:e};if(k===0||E===0)return G;const{ctx:W,buffer:J,gridInner:re,gridOuter:se}=this;W.clearRect(J,J,k,E),W.fillText(f,J,J+w);const ce=W.getImageData(J,J,k,E);se.fill(Bt,0,B),re.fill(0,0,B);for(let ee=0;ee<E;ee++)for(let fe=0;fe<k;fe++){const ye=ce.data[4*(ee*k+fe)+3]/255;if(ye===0)continue;const be=(ee+J)*A+fe+J;if(ye===1)se[be]=0,re[be]=Bt;else{const Fe=.5-ye;se[be]=Fe>0?Fe*Fe:0,re[be]=Fe<0?Fe*Fe:0}}$r(se,0,0,A,R,A,this.f,this.v,this.z),$r(re,J,J,k,E,A,this.f,this.v,this.z);for(let ee=0;ee<B;ee++){const fe=Math.sqrt(se[ee])-Math.sqrt(re[ee]);U[ee]=Math.round(255-255*(fe/this.radius+this.cutoff))}return G}};class lt{constructor(){this.specification=h.v.light.position}possiblyEvaluate(e,s){return h.x(e.expression.evaluate(s))}interpolate(e,s,l){return{x:h.y.number(e.x,s.x,l),y:h.y.number(e.y,s.y,l),z:h.y.number(e.z,s.z,l)}}}let Pt;class ft extends h.E{constructor(e){super(),Pt=Pt||new h.q({anchor:new h.D(h.v.light.anchor),position:new lt,color:new h.D(h.v.light.color),intensity:new h.D(h.v.light.intensity)}),this._transitionable=new h.T(Pt),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,s={}){if(!this._validate(h.r,e,s))for(const l in e){const u=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),u):this._transitionable.setValue(l,u)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,s,l){return(!l||l.validate!==!1)&&h.t(this,e.call(h.u,{value:s,style:{glyphs:!0,sprite:!0},styleSpec:h.v}))}}const xe=new h.q({"sky-color":new h.D(h.v.sky["sky-color"]),"horizon-color":new h.D(h.v.sky["horizon-color"]),"fog-color":new h.D(h.v.sky["fog-color"]),"fog-ground-blend":new h.D(h.v.sky["fog-ground-blend"]),"horizon-fog-blend":new h.D(h.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new h.D(h.v.sky["sky-horizon-blend"]),"atmosphere-blend":new h.D(h.v.sky["atmosphere-blend"])});class Ne extends h.E{constructor(e){super(),this._transitionable=new h.T(xe),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new h.z(0))}setSky(e,s={}){if(!this._validate(h.B,e,s)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const l in e){const u=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),u):this._transitionable.setValue(l,u)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,s,l={}){return(l==null?void 0:l.validate)!==!1&&h.t(this,e.call(h.u,h.e({value:s,style:{glyphs:!0,sprite:!0},styleSpec:h.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class Xt{constructor(e,s){this.width=e,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,s){const l=e.join(",")+String(s);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(e,s)),this.dashEntry[l]}getDashRanges(e,s,l){const u=[];let p=e.length%2==1?-e[e.length-1]*l:0,w=e[0]*l,k=!0;u.push({left:p,right:w,isDash:k,zeroLength:e[0]===0});let E=e[0];for(let A=1;A<e.length;A++){k=!k;const R=e[A];p=E*l,E+=R,w=E*l,u.push({left:p,right:w,isDash:k,zeroLength:R===0})}return u}addRoundDash(e,s,l){const u=s/2;for(let p=-l;p<=l;p++){const w=this.width*(this.nextRow+l+p);let k=0,E=e[k];for(let A=0;A<this.width;A++){A/E.right>1&&(E=e[++k]);const R=Math.abs(A-E.left),B=Math.abs(A-E.right),U=Math.min(R,B);let G;const W=p/l*(u+1);if(E.isDash){const J=u-Math.abs(W);G=Math.sqrt(U*U+J*J)}else G=u-Math.sqrt(U*U+W*W);this.data[w+A]=Math.max(0,Math.min(255,G+128))}}}addRegularDash(e){for(let k=e.length-1;k>=0;--k){const E=e[k],A=e[k+1];E.zeroLength?e.splice(k,1):A&&A.isDash===E.isDash&&(A.left=E.left,e.splice(k,1))}const s=e[0],l=e[e.length-1];s.isDash===l.isDash&&(s.left=l.left-this.width,l.right=s.right+this.width);const u=this.width*this.nextRow;let p=0,w=e[p];for(let k=0;k<this.width;k++){k/w.right>1&&(w=e[++p]);const E=Math.abs(k-w.left),A=Math.abs(k-w.right),R=Math.min(E,A);this.data[u+k]=Math.max(0,Math.min(255,(w.isDash?R:-R)+128))}}addDash(e,s){const l=s?7:0,u=2*l+1;if(this.nextRow+u>this.height)return h.w("LineAtlas out of space"),null;let p=0;for(let k=0;k<e.length;k++)p+=e[k];if(p!==0){const k=this.width/p,E=this.getDashRanges(e,this.width,k);s?this.addRoundDash(E,k,l):this.addRegularDash(E)}const w={y:(this.nextRow+l+.5)/this.height,height:2*l/this.height,width:p};return this.nextRow+=u,this.dirty=!0,w}bind(e){const s=e.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}const Yt="maplibre_preloaded_worker_pool";class ir{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<ir.workerCount;)this.workers.push(new Worker(h.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach((s=>{s.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Yt]}numActive(){return Object.keys(this.active).length}}const hr=Math.floor(Y.hardwareConcurrency/2);let cr,lr;function Ir(){return cr||(cr=new ir),cr}ir.workerCount=h.C(globalThis)?Math.max(Math.min(hr,3),1):1;class mn{constructor(e,s){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=s;const l=this.workerPool.acquire(s);for(let u=0;u<l.length;u++){const p=new h.F(l[u],s);p.name=`Worker ${u}`,this.actors.push(p)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,s){const l=[];for(const u of this.actors)l.push(u.sendAsync({type:e,data:s}));return Promise.all(l)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach((s=>{s.remove()})),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,s){for(const l of this.actors)l.registerMessageHandler(e,s)}}function fa(){return lr||(lr=new mn(Ir(),h.G),lr.registerMessageHandler("GR",((f,e,s)=>h.m(e,s)))),lr}function ws(f,e){const s=h.H();return h.J(s,s,[1,1,0]),h.K(s,s,[.5*f.width,.5*f.height,1]),h.L(s,s,f.calculatePosMatrix(e.toUnwrapped()))}function Yi(f,e,s,l,u,p){const w=(function(B,U,G){if(B)for(const W of B){const J=U[W];if(J&&J.source===G&&J.type==="fill-extrusion")return!0}else for(const W in U){const J=U[W];if(J.source===G&&J.type==="fill-extrusion")return!0}return!1})(u&&u.layers,e,f.id),k=p.maxPitchScaleFactor(),E=f.tilesIn(l,k,w);E.sort(bs);const A=[];for(const B of E)A.push({wrappedTileID:B.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(e,s,f._state,B.queryGeometry,B.cameraQueryGeometry,B.scale,u,p,k,ws(f.transform,B.tileID))});const R=(function(B){const U={},G={};for(const W of B){const J=W.queryResults,re=W.wrappedTileID,se=G[re]=G[re]||{};for(const ce in J){const ee=J[ce],fe=se[ce]=se[ce]||{},ye=U[ce]=U[ce]||[];for(const be of ee)fe[be.featureIndex]||(fe[be.featureIndex]=!0,ye.push(be))}}return U})(A);for(const B in R)R[B].forEach((U=>{const G=U.feature,W=f.getFeatureState(G.layer["source-layer"],G.id);G.source=G.layer.source,G.layer["source-layer"]&&(G.sourceLayer=G.layer["source-layer"]),G.state=W}));return R}function bs(f,e){const s=f.tileID,l=e.tileID;return s.overscaledZ-l.overscaledZ||s.canonical.y-l.canonical.y||s.wrap-l.wrap||s.canonical.x-l.canonical.x}function Ba(f,e,s){return h._(this,void 0,void 0,(function*(){let l=f;if(f.url?l=(yield h.h(e.transformRequest(f.url,"Source"),s)).data:yield Y.frameAsync(s),!l)return null;const u=h.M(h.e(l,f),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in l&&l.vector_layers&&(u.vectorLayerIds=l.vector_layers.map((p=>p.id))),u}))}class Ee{constructor(e,s){e&&(s?this.setSouthWest(e).setNorthEast(s):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof h.N?new h.N(e.lng,e.lat):h.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof h.N?new h.N(e.lng,e.lat):h.N.convert(e),this}extend(e){const s=this._sw,l=this._ne;let u,p;if(e instanceof h.N)u=e,p=e;else{if(!(e instanceof Ee))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Ee.convert(e)):this.extend(h.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(h.N.convert(e)):this;if(u=e._sw,p=e._ne,!u||!p)return this}return s||l?(s.lng=Math.min(u.lng,s.lng),s.lat=Math.min(u.lat,s.lat),l.lng=Math.max(p.lng,l.lng),l.lat=Math.max(p.lat,l.lat)):(this._sw=new h.N(u.lng,u.lat),this._ne=new h.N(p.lng,p.lat)),this}getCenter(){return new h.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new h.N(this.getWest(),this.getNorth())}getSouthEast(){return new h.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:s,lat:l}=h.N.convert(e);let u=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&u}static convert(e){return e instanceof Ee?e:e&&new Ee(e)}static fromLngLat(e,s=0){const l=360*s/40075017,u=l/Math.cos(Math.PI/180*e.lat);return new Ee(new h.N(e.lng-u,e.lat-l),new h.N(e.lng+u,e.lat+l))}adjustAntiMeridian(){const e=new h.N(this._sw.lng,this._sw.lat),s=new h.N(this._ne.lng,this._ne.lat);return new Ee(e,e.lng>s.lng?new h.N(s.lng+360,s.lat):s)}}class js{constructor(e,s,l){this.bounds=Ee.convert(this.validateBounds(e)),this.minzoom=s||0,this.maxzoom=l||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const s=Math.pow(2,e.z),l=Math.floor(h.O(this.bounds.getWest())*s),u=Math.floor(h.Q(this.bounds.getNorth())*s),p=Math.ceil(h.O(this.bounds.getEast())*s),w=Math.ceil(h.Q(this.bounds.getSouth())*s);return e.x>=l&&e.x<p&&e.y>=u&&e.y<w}}class co extends h.E{constructor(e,s,l,u){if(super(),this.id=e,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,h.e(this,h.M(s,["url","scheme","tileSize","promoteId"])),this._options=h.e({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(u)}load(){return h._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new h.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Ba(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(h.e(this,e),e.bounds&&(this.tileBounds=new js(e.bounds,this.minzoom,this.maxzoom)),this.fire(new h.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new h.j(e))}}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return h.e({},this._options)}loadTile(e){return h._(this,void 0,void 0,(function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(s,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};l.request.collectResourceTiming=this._collectResourceTiming;let u="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise(((p,w)=>{e.reloadPromise={resolve:p,reject:w}}))}else e.actor=this.dispatcher.getActor(),u="LT";e.abortController=new AbortController;try{const p=yield e.actor.sendAsync({type:u,data:l},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,p)}catch(p){if(delete e.abortController,e.aborted)return;if(p&&p.status!==404)throw p;this._afterTileLoadWorkerResponse(e,null)}}))}_afterTileLoadWorkerResponse(e,s){if(s&&s.resourceTiming&&(e.resourceTiming=s.resourceTiming),s&&this.map._refreshExpiredTiles&&e.setExpiryData(s),e.loadVectorData(s,this.map.painter),e.reloadPromise){const l=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(l.resolve).catch(l.reject)}}abortTile(e){return h._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}unloadTile(e){return h._(this,void 0,void 0,(function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class fr extends h.E{constructor(e,s,l,u){super(),this.id=e,this.dispatcher=l,this.setEventedParent(u),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=h.e({type:"raster"},s),h.e(this,h.M(s,["url","scheme","tileSize"]))}load(){return h._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new h.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Ba(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(h.e(this,e),e.bounds&&(this.tileBounds=new js(e.bounds,this.minzoom,this.maxzoom)),this.fire(new h.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new h.j(e))}}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}serialize(){return h.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return h._(this,void 0,void 0,(function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const l=yield $e.getImage(this.map._requestManager.transformRequest(s,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(l&&l.data){this.map._refreshExpiredTiles&&l.cacheControl&&l.expires&&e.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const u=this.map.painter.context,p=u.gl,w=l.data;e.texture=this.map.painter.getTileTexture(w.width),e.texture?e.texture.update(w,{useMipmap:!0}):(e.texture=new vt(u,w,p.RGBA,{useMipmap:!0}),e.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE,p.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(l){if(delete e.abortController,e.aborted)e.state="unloaded";else if(l)throw e.state="errored",l}}))}abortTile(e){return h._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)}))}unloadTile(e){return h._(this,void 0,void 0,(function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)}))}hasTransition(){return!1}}class Dr extends fr{constructor(e,s,l,u){super(e,s,l,u),this.type="raster-dem",this.maxzoom=22,this._options=h.e({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox",this.redFactor=s.redFactor,this.greenFactor=s.greenFactor,this.blueFactor=s.blueFactor,this.baseShift=s.baseShift}loadTile(e){return h._(this,void 0,void 0,(function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(s,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const u=yield $e.getImage(l,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(u&&u.data){const p=u.data;this.map._refreshExpiredTiles&&u.cacheControl&&u.expires&&e.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const w=h.b(p)&&h.U()?p:yield this.readImageNow(p),k={type:this.type,uid:e.uid,source:this.id,rawImageData:w,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const E=yield e.actor.sendAsync({type:"LDT",data:k});e.dem=E,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(u){if(delete e.abortController,e.aborted)e.state="unloaded";else if(u)throw e.state="errored",u}}))}readImageNow(e){return h._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&h.V()){const s=e.width+2,l=e.height+2;try{return new h.R({width:s,height:l},yield h.W(e,-1,-1,s,l))}catch{}}return Y.getImageData(e,1)}))}_getNeighboringTiles(e){const s=e.canonical,l=Math.pow(2,s.z),u=(s.x-1+l)%l,p=s.x===0?e.wrap-1:e.wrap,w=(s.x+1+l)%l,k=s.x+1===l?e.wrap+1:e.wrap,E={};return E[new h.S(e.overscaledZ,p,s.z,u,s.y).key]={backfilled:!1},E[new h.S(e.overscaledZ,k,s.z,w,s.y).key]={backfilled:!1},s.y>0&&(E[new h.S(e.overscaledZ,p,s.z,u,s.y-1).key]={backfilled:!1},E[new h.S(e.overscaledZ,e.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},E[new h.S(e.overscaledZ,k,s.z,w,s.y-1).key]={backfilled:!1}),s.y+1<l&&(E[new h.S(e.overscaledZ,p,s.z,u,s.y+1).key]={backfilled:!1},E[new h.S(e.overscaledZ,e.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},E[new h.S(e.overscaledZ,k,s.z,w,s.y+1).key]={backfilled:!1}),E}unloadTile(e){return h._(this,void 0,void 0,(function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))}))}}class Ss extends h.E{constructor(e,s,l,u){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=l.getActor(),this.setEventedParent(u),this._data=s.data,this._options=h.e({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const p=h.X/this.tileSize;s.clusterMaxZoom!==void 0&&this.maxzoom<=s.clusterMaxZoom&&h.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${s.clusterMaxZoom}".`),this.workerOptions=h.e({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*p,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*p,extent:h.X,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:h.X,radius:(s.clusterRadius||50)*p,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return h._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return h._(this,void 0,void 0,(function*(){const e=h.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})}))}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,s,l){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:s,offset:l}})}_updateWorkerData(e){return h._(this,void 0,void 0,(function*(){const s=h.e({type:this.type},this.workerOptions);e?s.dataDiff=e:typeof this._data=="string"?(s.request=this.map._requestManager.transformRequest(Y.resolveURL(this._data),"Source"),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new h.k("dataloading",{dataType:"source"}));try{const l=yield this.actor.sendAsync({type:"LD",data:s});if(this._pendingLoads--,this._removed||l.abandoned)return void this.fire(new h.k("dataabort",{dataType:"source"}));let u=null;l.resourceTiming&&l.resourceTiming[this.id]&&(u=l.resourceTiming[this.id].slice(0));const p={dataType:"source"};this._collectResourceTiming&&u&&u.length>0&&h.e(p,{resourceTiming:u}),this.fire(new h.k("data",Object.assign(Object.assign({},p),{sourceDataType:"metadata"}))),this.fire(new h.k("data",Object.assign(Object.assign({},p),{sourceDataType:"content"})))}catch(l){if(this._pendingLoads--,this._removed)return void this.fire(new h.k("dataabort",{dataType:"source"}));this.fire(new h.j(l))}}))}loaded(){return this._pendingLoads===0}loadTile(e){return h._(this,void 0,void 0,(function*(){const s=e.actor?"RT":"LT";e.actor=this.actor;const l={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;const u=yield this.actor.sendAsync({type:s,data:l},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(u,this.map.painter,s==="RT")}))}abortTile(e){return h._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0}))}unloadTile(e){return h._(this,void 0,void 0,(function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return h.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var ks=h.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ts extends h.E{constructor(e,s,l,u){super(),this.id=e,this.dispatcher=l,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(u),this.options=s}load(e){return h._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new h.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const s=yield $e.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,s&&s.data&&(this.image=s.data,e&&(this.coordinates=e),this._finishLoading())}catch(s){this._request=null,this._loaded=!0,this.fire(new h.j(s))}}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new h.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const s=e.map(h.Z.fromLngLat);this.tileID=(function(u){let p=1/0,w=1/0,k=-1/0,E=-1/0;for(const U of u)p=Math.min(p,U.x),w=Math.min(w,U.y),k=Math.max(k,U.x),E=Math.max(E,U.y);const A=Math.max(k-p,E-w),R=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),B=Math.pow(2,R);return new h.a1(R,Math.floor((p+k)/2*B),Math.floor((w+E)/2*B))})(s),this.minzoom=this.maxzoom=this.tileID.z;const l=s.map((u=>this.tileID.getTilePoint(u)._round()));return this._boundsArray=new h.$,this._boundsArray.emplaceBack(l[0].x,l[0].y,0,0),this._boundsArray.emplaceBack(l[1].x,l[1].y,h.X,0),this._boundsArray.emplaceBack(l[3].x,l[3].y,0,h.X),this._boundsArray.emplaceBack(l[2].x,l[2].y,h.X,h.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new h.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,s=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,ks.members)),this.boundsSegments||(this.boundsSegments=h.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new vt(e,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let l=!1;for(const u in this.tiles){const p=this.tiles[u];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture,l=!0)}l&&this.fire(new h.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return h._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Fa extends Ts{constructor(e,s,l,u){super(e,s,l,u),this.roundZoom=!0,this.type="video",this.options=s}load(){return h._(this,void 0,void 0,(function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const s of e.urls)this.urls.push(this.map._requestManager.transformRequest(s,"Source").url);try{const s=yield h.a3(this.urls);if(this._loaded=!0,!s)return;this.video=s,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(s){this.fire(new h.j(s))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const s=this.video.seekable;e<s.start(0)||e>s.end(0)?this.fire(new h.j(new h.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,s=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,ks.members)),this.boundsSegments||(this.boundsSegments=h.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new vt(e,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let l=!1;for(const u in this.tiles){const p=this.tiles[u];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture,l=!0)}l&&this.fire(new h.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class mi extends Ts{constructor(e,s,l,u){super(e,s,l,u),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some((p=>!Array.isArray(p)||p.length!==2||p.some((w=>typeof w!="number"))))||this.fire(new h.j(new h.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new h.j(new h.a2(`sources.${e}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new h.j(new h.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new h.j(new h.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new h.j(new h.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){return h._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new h.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context,l=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,ks.members)),this.boundsSegments||(this.boundsSegments=h.a0.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new vt(s,this.canvas,l.RGBA,{premultiply:!0});let u=!1;for(const p in this.tiles){const w=this.tiles[p];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,u=!0)}u&&this.fire(new h.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const ho={},Oa=f=>{switch(f){case"geojson":return Ss;case"image":return Ts;case"raster":return fr;case"raster-dem":return Dr;case"vector":return co;case"video":return Fa;case"canvas":return mi}return ho[f]},Ke="RTLPluginLoaded";class Ji extends h.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=fa()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch((s=>{throw this.status="error",s}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return h._(this,arguments,void 0,(function*(s,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=Y.resolveURL(s),!this.url)throw new Error(`requested url ${s} is invalid`);if(this.status==="unavailable"){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return h._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new h.k(Ke))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let gn=null;function Jn(){return gn||(gn=new Ji),gn}class ma{constructor(e,s){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=h.a4(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const s=e+this.timeAdded;s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,s,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=(function(u,p){const w={};if(!p)return w;for(const k of u){const E=k.layerIds.map((A=>p.getLayer(A))).filter(Boolean);if(E.length!==0){k.layers=E,k.stateDependentLayerIds&&(k.stateDependentLayers=k.stateDependentLayerIds.map((A=>E.filter((R=>R.id===A))[0])));for(const A of E)w[A.id]=k}}return w})(e.buckets,s.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const p=this.buckets[u];if(p instanceof h.a6){if(this.hasSymbolBuckets=!0,!l)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const p=this.buckets[u];if(p instanceof h.a6&&p.hasRTLText){this.hasRTLText=!0,Jn().lazyLoad();break}}this.queryPadding=0;for(const u in this.buckets){const p=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(u).queryRadius(p))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new h.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const l in this.buckets){const u=this.buckets[l];u.uploadPending()&&u.upload(e)}const s=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new vt(e,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new vt(e,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,s,l,u,p,w,k,E,A,R){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:u,cameraQueryGeometry:p,scale:w,tileSize:this.tileSize,pixelPosMatrix:R,transform:E,params:k,queryPadding:this.queryPadding*A},e,s,l):{}}querySourceFeatures(e,s){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const u=l.loadVTLayers(),p=s&&s.sourceLayer?s.sourceLayer:"",w=u._geojsonTileLayer||u[p];if(!w)return;const k=h.a7(s&&s.filter),{z:E,x:A,y:R}=this.tileID.canonical,B={z:E,x:A,y:R};for(let U=0;U<w.length;U++){const G=w.feature(U);if(k.needGeometry){const re=h.a8(G,!0);if(!k.filter(new h.z(this.tileID.overscaledZ),re,this.tileID.canonical))continue}else if(!k.filter(new h.z(this.tileID.overscaledZ),G))continue;const W=l.getId(G,p),J=new h.a9(G,E,A,R,W);J.tile=B,e.push(J)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const s=this.expirationTime;if(e.cacheControl){const l=h.aa(e.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const l=Date.now();let u=!1;if(this.expirationTime>l)u=!1;else if(s)if(this.expirationTime<s)u=!0;else{const p=this.expirationTime-s;p?this.expirationTime=l+Math.max(p,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const u in this.buckets){if(!s.style.hasLayer(u))continue;const p=this.buckets[u],w=p.layers[0].sourceLayer||"_geojsonTileLayer",k=l[w],E=e[w];if(!k||!E||Object.keys(E).length===0)continue;p.update(E,k,this.imageAtlas&&this.imageAtlas.patternPositions||{});const A=s&&s.style&&s.style.getLayer(u);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(p)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Y.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Y.now()+e}setDependencies(e,s){const l={};for(const u of s)l[u]=!0;this.dependencies[e]=l}hasDependency(e,s){for(const l of e){const u=this.dependencies[l];if(u){for(const p of s)if(u[p])return!0}}return!1}}class rt{constructor(e,s){this.max=e,this.onRemove=s,this.reset()}reset(){for(const e in this.data)for(const s of this.data[e])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(e,s,l){const u=e.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const p={value:s,timeout:void 0};if(l!==void 0&&(p.timeout=setTimeout((()=>{this.remove(e,p)}),l)),this.data[u].push(p),this.order.push(u),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const s=this.data[e].shift();return s.timeout&&clearTimeout(s.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),s.value}getByKey(e){const s=this.data[e];return s?s[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,s){if(!this.has(e))return this;const l=e.wrapped().key,u=s===void 0?0:this.data[l].indexOf(s),p=this.data[l][u];return this.data[l].splice(u,1),p.timeout&&clearTimeout(p.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(p.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(e){const s=[];for(const l in this.data)for(const u of this.data[l])e(u.value)||s.push(u);for(const l of s)this.remove(l.value.tileID,l)}}class Jt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,s,l){const u=String(s);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},h.e(this.stateChanges[e][u],l),this.deletedStates[e]===null){this.deletedStates[e]={};for(const p in this.state[e])p!==u&&(this.deletedStates[e][p]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][u]===null){this.deletedStates[e][u]={};for(const p in this.state[e][u])l[p]||(this.deletedStates[e][u][p]=null)}else for(const p in l)this.deletedStates[e]&&this.deletedStates[e][u]&&this.deletedStates[e][u][p]===null&&delete this.deletedStates[e][u][p]}removeFeatureState(e,s,l){if(this.deletedStates[e]===null)return;const u=String(s);if(this.deletedStates[e]=this.deletedStates[e]||{},l&&s!==void 0)this.deletedStates[e][u]!==null&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][l]=null);else if(s!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][u])for(l in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][l]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,s){const l=String(s),u=h.e({},(this.state[e]||{})[l],(this.stateChanges[e]||{})[l]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const p=this.deletedStates[e][s];if(p===null)return{};for(const w in p)delete u[w]}return u}initializeTileState(e,s){e.setFeatureState(this.state,s)}coalesceChanges(e,s){const l={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const p={};for(const w in this.stateChanges[u])this.state[u][w]||(this.state[u][w]={}),h.e(this.state[u][w],this.stateChanges[u][w]),p[w]=this.state[u][w];l[u]=p}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const p={};if(this.deletedStates[u]===null)for(const w in this.state[u])p[w]={},this.state[u][w]={};else for(const w in this.deletedStates[u]){if(this.deletedStates[u][w]===null)this.state[u][w]={};else for(const k of Object.keys(this.deletedStates[u][w]))delete this.state[u][w][k];p[w]=this.state[u][w]}l[u]=l[u]||{},h.e(l[u],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const u in e)e[u].setFeatureState(l,s)}}class Ft extends h.E{constructor(e,s,l){super(),this.id=e,this.dispatcher=l,this.on("data",(u=>this._dataHandler(u))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((u,p,w,k)=>{const E=new(Oa(p.type))(u,p,w,k);if(E.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${E.id}`);return E})(e,s,l,this),this._tiles={},this._cache=new rt(0,(u=>this._unloadTile(u))),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Jt,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const s=this._tiles[e];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,s,l){return h._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,s,l)}catch(u){e.state="errored",u.status!==404?this._source.fire(new h.j(u,{tile:e})):this.update(this.transform,this.terrain)}}))}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new h.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const l=this._tiles[s];l.upload(e),l.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((e=>e.tileID)).sort(Ln).map((e=>e.key))}getRenderableIds(e){const s=[];for(const l in this._tiles)this._isIdRenderable(l,e)&&s.push(this._tiles[l]);return e?s.sort(((l,u)=>{const p=l.tileID,w=u.tileID,k=new h.P(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),E=new h.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-w.overscaledZ||E.y-k.y||E.x-k.x})).map((l=>l.tileID.key)):s.map((l=>l.tileID)).sort(Ln).map((l=>l.key))}hasRenderableParent(e){const s=this.findLoadedParent(e,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(e,s){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(s||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,s){return h._(this,void 0,void 0,(function*(){const l=this._tiles[e];l&&(l.state!=="loading"&&(l.state=s),yield this._loadTile(l,e,s))}))}_tileLoaded(e,s,l){e.timeAdded=Y.now(),l==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(s,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new h.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const s=this.getRenderableIds();for(let u=0;u<s.length;u++){const p=s[u];if(e.neighboringTiles&&e.neighboringTiles[p]){const w=this.getTileByID(p);l(e,w),l(w,e)}}function l(u,p){u.needsHillshadePrepare=!0,u.needsTerrainPrepare=!0;let w=p.tileID.canonical.x-u.tileID.canonical.x;const k=p.tileID.canonical.y-u.tileID.canonical.y,E=Math.pow(2,u.tileID.canonical.z),A=p.tileID.key;w===0&&k===0||Math.abs(k)>1||(Math.abs(w)>1&&(Math.abs(w+E)===1?w+=E:Math.abs(w-E)===1&&(w-=E)),p.dem&&u.dem&&(u.dem.backfillBorder(p.dem,w,k),u.neighboringTiles&&u.neighboringTiles[A]&&(u.neighboringTiles[A].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,s,l,u){for(const p in this._tiles){let w=this._tiles[p];if(u[p]||!w.hasData()||w.tileID.overscaledZ<=s||w.tileID.overscaledZ>l)continue;let k=w.tileID;for(;w&&w.tileID.overscaledZ>s+1;){const A=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[A.key],w&&w.hasData()&&(k=A)}let E=k;for(;E.overscaledZ>s;)if(E=E.scaledTo(E.overscaledZ-1),e[E.key]){u[k.key]=k;break}}}findLoadedParent(e,s){if(e.key in this._loadedParentTiles){const l=this._loadedParentTiles[e.key];return l&&l.tileID.overscaledZ>=s?l:null}for(let l=e.overscaledZ-1;l>=s;l--){const u=e.scaledTo(l),p=this._getLoadedTile(u);if(p)return p}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const s=this._tiles[e.key];return s&&s.hasData()?s:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const s=Math.ceil(e.width/this._source.tileSize)+1,l=Math.ceil(e.height/this._source.tileSize)+1,u=Math.floor(s*l*(this._maxTileCacheZoomLevels===null?h.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),p=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,u):u;this._cache.setMaxSize(p)}handleWrapJump(e){const s=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,s){const l={};for(const u in this._tiles){const p=this._tiles[u];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+s),l[p.tileID.key]=p}this._tiles=l;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(u,this._tiles[u])}}_updateCoveredAndRetainedTiles(e,s,l,u,p,w){const k={},E={},A=Object.keys(e),R=Y.now();for(const B of A){const U=e[B],G=this._tiles[B];if(!G||G.fadeEndTime!==0&&G.fadeEndTime<=R)continue;const W=this.findLoadedParent(U,s),J=this.findLoadedSibling(U),re=W||J||null;re&&(this._addTile(re.tileID),k[re.tileID.key]=re.tileID),E[B]=U}this._retainLoadedChildren(E,u,l,e);for(const B in k)e[B]||(this._coveredTiles[B]=!0,e[B]=k[B]);if(w){const B={},U={};for(const G of p)this._tiles[G.key].hasData()?B[G.key]=G:U[G.key]=G;for(const G in U){const W=U[G].children(this._source.maxzoom);this._tiles[W[0].key]&&this._tiles[W[1].key]&&this._tiles[W[2].key]&&this._tiles[W[3].key]&&(B[W[0].key]=e[W[0].key]=W[0],B[W[1].key]=e[W[1].key]=W[1],B[W[2].key]=e[W[2].key]=W[2],B[W[3].key]=e[W[3].key]=W[3],delete U[G])}for(const G in U){const W=U[G],J=this.findLoadedParent(W,this._source.minzoom),re=this.findLoadedSibling(W),se=J||re||null;if(se){B[se.tileID.key]=e[se.tileID.key]=se.tileID;for(const ce in B)B[ce].isChildOf(se.tileID)&&delete B[ce]}}for(const G in this._tiles)B[G]||(this._coveredTiles[G]=!0)}}update(e,s){if(!this._sourceLoaded||this._paused)return;let l;this.transform=e,this.terrain=s,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((R=>new h.S(R.canonical.z,R.wrap,R.canonical.z,R.canonical.x,R.canonical.y))):(l=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s}),this._source.hasTile&&(l=l.filter((R=>this._source.hasTile(R))))):l=[];const u=e.coveringZoomLevel(this._source),p=Math.max(u-Ft.maxOverzooming,this._source.minzoom),w=Math.max(u+Ft.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const R={};for(const B of l)if(B.canonical.z>this._source.minzoom){const U=B.scaledTo(B.canonical.z-1);R[U.key]=U;const G=B.scaledTo(Math.max(this._source.minzoom,Math.min(B.canonical.z,5)));R[G.key]=G}l=l.concat(Object.values(R))}const k=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,k&&this.fire(new h.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const E=this._updateRetainedTiles(l,u);gi(this._source.type)&&this._updateCoveredAndRetainedTiles(E,p,w,u,l,s);for(const R in E)this._tiles[R].clearFadeHold();const A=h.ab(this._tiles,E);for(const R of A){const B=this._tiles[R];B.hasSymbolBuckets&&!B.holdingForFade()?B.setHoldDuration(this.map._fadeDuration):B.hasSymbolBuckets&&!B.symbolFadeFinished()||this._removeTile(R)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,s){var l;const u={},p={},w=Math.max(s-Ft.maxOverzooming,this._source.minzoom),k=Math.max(s+Ft.maxUnderzooming,this._source.minzoom),E={};for(const A of e){const R=this._addTile(A);u[A.key]=A,R.hasData()||s<this._source.maxzoom&&(E[A.key]=A)}this._retainLoadedChildren(E,s,k,u);for(const A of e){let R=this._tiles[A.key];if(R.hasData())continue;if(s+1>this._source.maxzoom){const U=A.children(this._source.maxzoom)[0],G=this.getTile(U);if(G&&G.hasData()){u[U.key]=U;continue}}else{const U=A.children(this._source.maxzoom);if(u[U[0].key]&&u[U[1].key]&&u[U[2].key]&&u[U[3].key])continue}let B=R.wasRequested();for(let U=A.overscaledZ-1;U>=w;--U){const G=A.scaledTo(U);if(p[G.key])break;if(p[G.key]=!0,R=this.getTile(G),!R&&B&&(R=this._addTile(G)),R){const W=R.hasData();if((W||!(!((l=this.map)===null||l===void 0)&&l.cancelPendingTileRequestsWhileZooming)||B)&&(u[G.key]=G),B=R.wasRequested(),W)break}}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const s=[];let l,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){l=this._loadedParentTiles[u.key];break}s.push(u.key);const p=u.scaledTo(u.overscaledZ-1);if(l=this._getLoadedTile(p),l)break;u=p}for(const p of s)this._loadedParentTiles[p]=l}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const s=this._tiles[e].tileID,l=this._getLoadedTile(s);this._loadedSiblingTiles[s.key]=l}}_addTile(e){let s=this._tiles[e.key];if(s)return s;s=this._cache.getAndRemove(e),s&&(this._setTileReloadTimer(e.key,s),s.tileID=e,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,s)));const l=s;return s||(s=new ma(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(s,e.key,s.state)),s.uses++,this._tiles[e.key]=s,l||this._source.fire(new h.k("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(e,s){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const l=s.getExpiryTimeout();l&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),l))}_removeTile(e){const s=this._tiles[e];s&&(s.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}_dataHandler(e){const s=e.sourceDataType;e.dataType==="source"&&s==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&s==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,s,l){const u=[],p=this.transform;if(!p)return u;const w=l?p.getCameraQueryGeometry(e):e,k=e.map((W=>p.pointCoordinate(W,this.terrain))),E=w.map((W=>p.pointCoordinate(W,this.terrain))),A=this.getIds();let R=1/0,B=1/0,U=-1/0,G=-1/0;for(const W of E)R=Math.min(R,W.x),B=Math.min(B,W.y),U=Math.max(U,W.x),G=Math.max(G,W.y);for(let W=0;W<A.length;W++){const J=this._tiles[A[W]];if(J.holdingForFade())continue;const re=J.tileID,se=Math.pow(2,p.zoom-J.tileID.overscaledZ),ce=s*J.queryPadding*h.X/J.tileSize/se,ee=[re.getTilePoint(new h.Z(R,B)),re.getTilePoint(new h.Z(U,G))];if(ee[0].x-ce<h.X&&ee[0].y-ce<h.X&&ee[1].x+ce>=0&&ee[1].y+ce>=0){const fe=k.map((be=>re.getTilePoint(be))),ye=E.map((be=>re.getTilePoint(be)));u.push({tile:J,tileID:re,queryGeometry:fe,cameraQueryGeometry:ye,scale:se})}}return u}getVisibleCoordinates(e){const s=this.getRenderableIds(e).map((l=>this._tiles[l].tileID));for(const l of s)l.posMatrix=this.transform.calculatePosMatrix(l.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(gi(this._source.type)){const e=Y.now();for(const s in this._tiles)if(this._tiles[s].fadeEndTime>=e)return!0}return!1}setFeatureState(e,s,l){this._state.updateState(e=e||"_geojsonTileLayer",s,l)}removeFeatureState(e,s,l){this._state.removeFeatureState(e=e||"_geojsonTileLayer",s,l)}getFeatureState(e,s){return this._state.getState(e=e||"_geojsonTileLayer",s)}setDependencies(e,s,l){const u=this._tiles[e];u&&u.setDependencies(s,l)}reloadTilesForDependencies(e,s){for(const l in this._tiles)this._tiles[l].hasDependency(e,s)&&this._reloadTile(l,"reloading");this._cache.filter((l=>!l.hasDependency(e,s)))}}function Ln(f,e){const s=Math.abs(2*f.wrap)-+(f.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return f.overscaledZ-e.overscaledZ||l-s||e.canonical.y-f.canonical.y||e.canonical.x-f.canonical.x}function gi(f){return f==="raster"||f==="image"||f==="video"}Ft.maxOverzooming=10,Ft.maxUnderzooming=3;class Vt{constructor(e,s){this.reset(e,s)}reset(e,s){this.points=e||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=h.ac(e,0,1);let s=1,l=this._distances[s];const u=e*this.paddedLength+this.padding;for(;l<u&&s<this._distances.length;)l=this._distances[++s];const p=s-1,w=this._distances[p],k=l-w,E=k>0?(u-w)/k:0;return this.points[p].mult(1-E).add(this.points[s].mult(E))}}function Ai(f,e){let s=!0;return f==="always"||f!=="never"&&e!=="never"||(s=!1),s}class Qi{constructor(e,s,l){const u=this.boxCells=[],p=this.circleCells=[];this.xCellCount=Math.ceil(e/l),this.yCellCount=Math.ceil(s/l);for(let w=0;w<this.xCellCount*this.yCellCount;w++)u.push([]),p.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=s,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,s,l,u,p){this._forEachCell(s,l,u,p,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(u),this.bboxes.push(p)}insertCircle(e,s,l,u){this._forEachCell(s-u,l-u,s+u,l+u,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(s),this.circles.push(l),this.circles.push(u)}_insertBoxCell(e,s,l,u,p,w){this.boxCells[p].push(w)}_insertCircleCell(e,s,l,u,p,w){this.circleCells[p].push(w)}_query(e,s,l,u,p,w,k){if(l<0||e>this.width||u<0||s>this.height)return[];const E=[];if(e<=0&&s<=0&&this.width<=l&&this.height<=u){if(p)return[{key:null,x1:e,y1:s,x2:l,y2:u}];for(let A=0;A<this.boxKeys.length;A++)E.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const R=this.circles[3*A],B=this.circles[3*A+1],U=this.circles[3*A+2];E.push({key:this.circleKeys[A],x1:R-U,y1:B-U,x2:R+U,y2:B+U})}}else this._forEachCell(e,s,l,u,this._queryCell,E,{hitTest:p,overlapMode:w,seenUids:{box:{},circle:{}}},k);return E}query(e,s,l,u){return this._query(e,s,l,u,!1,null)}hitTest(e,s,l,u,p,w){return this._query(e,s,l,u,!0,p,w).length>0}hitTestCircle(e,s,l,u,p){const w=e-l,k=e+l,E=s-l,A=s+l;if(k<0||w>this.width||A<0||E>this.height)return!1;const R=[];return this._forEachCell(w,E,k,A,this._queryCellCircle,R,{hitTest:!0,overlapMode:u,circle:{x:e,y:s,radius:l},seenUids:{box:{},circle:{}}},p),R.length>0}_queryCell(e,s,l,u,p,w,k,E){const{seenUids:A,hitTest:R,overlapMode:B}=k,U=this.boxCells[p];if(U!==null){const W=this.bboxes;for(const J of U)if(!A.box[J]){A.box[J]=!0;const re=4*J,se=this.boxKeys[J];if(e<=W[re+2]&&s<=W[re+3]&&l>=W[re+0]&&u>=W[re+1]&&(!E||E(se))&&(!R||!Ai(B,se.overlapMode))&&(w.push({key:se,x1:W[re],y1:W[re+1],x2:W[re+2],y2:W[re+3]}),R))return!0}}const G=this.circleCells[p];if(G!==null){const W=this.circles;for(const J of G)if(!A.circle[J]){A.circle[J]=!0;const re=3*J,se=this.circleKeys[J];if(this._circleAndRectCollide(W[re],W[re+1],W[re+2],e,s,l,u)&&(!E||E(se))&&(!R||!Ai(B,se.overlapMode))){const ce=W[re],ee=W[re+1],fe=W[re+2];if(w.push({key:se,x1:ce-fe,y1:ee-fe,x2:ce+fe,y2:ee+fe}),R)return!0}}}return!1}_queryCellCircle(e,s,l,u,p,w,k,E){const{circle:A,seenUids:R,overlapMode:B}=k,U=this.boxCells[p];if(U!==null){const W=this.bboxes;for(const J of U)if(!R.box[J]){R.box[J]=!0;const re=4*J,se=this.boxKeys[J];if(this._circleAndRectCollide(A.x,A.y,A.radius,W[re+0],W[re+1],W[re+2],W[re+3])&&(!E||E(se))&&!Ai(B,se.overlapMode))return w.push(!0),!0}}const G=this.circleCells[p];if(G!==null){const W=this.circles;for(const J of G)if(!R.circle[J]){R.circle[J]=!0;const re=3*J,se=this.circleKeys[J];if(this._circlesCollide(W[re],W[re+1],W[re+2],A.x,A.y,A.radius)&&(!E||E(se))&&!Ai(B,se.overlapMode))return w.push(!0),!0}}}_forEachCell(e,s,l,u,p,w,k,E){const A=this._convertToXCellCoord(e),R=this._convertToYCellCoord(s),B=this._convertToXCellCoord(l),U=this._convertToYCellCoord(u);for(let G=A;G<=B;G++)for(let W=R;W<=U;W++)if(p.call(this,e,s,l,u,this.xCellCount*W+G,w,k,E))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,s,l,u,p,w){const k=u-e,E=p-s,A=l+w;return A*A>k*k+E*E}_circleAndRectCollide(e,s,l,u,p,w,k){const E=(w-u)/2,A=Math.abs(e-(u+E));if(A>E+l)return!1;const R=(k-p)/2,B=Math.abs(s-(p+R));if(B>R+l)return!1;if(A<=E||B<=R)return!0;const U=A-E,G=B-R;return U*U+G*G<=l*l}}function yi(f,e,s,l,u){const p=h.H();return e?(h.K(p,p,[1/u,1/u,1]),s||h.ad(p,p,l.angle)):h.L(p,l.labelPlaneMatrix,f),p}function Un(f,e,s,l,u){if(e){const p=h.ae(f);return h.K(p,p,[u,u,1]),s||h.ad(p,p,-l.angle),p}return l.glCoordMatrix}function ie(f,e,s,l){let u;l?(u=[f,e,l(f,e),1],h.af(u,u,s)):(u=[f,e,0,1],mr(u,u,s));const p=u[3];return{point:new h.P(u[0]/p,u[1]/p),signedDistanceFromCamera:p,isOccluded:!1}}function j(f,e){return .5+f/e*.5}function N(f,e){return f.x>=-e[0]&&f.x<=e[0]&&f.y>=-e[1]&&f.y<=e[1]}function H(f,e,s,l,u,p,w,k,E,A,R,B,U,G,W){const J=l?f.textSizeData:f.iconSizeData,re=h.ag(J,s.transform.zoom),se=[256/s.width*2+1,256/s.height*2+1],ce=l?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;ce.clear();const ee=f.lineVertexArray,fe=l?f.text.placedSymbolArray:f.icon.placedSymbolArray,ye=s.transform.width/s.transform.height;let be=!1;for(let Fe=0;Fe<fe.length;Fe++){const Ge=fe.get(Fe);if(Ge.hidden||Ge.writingMode===h.ah.vertical&&!be){Ct(Ge.numGlyphs,ce);continue}be=!1;const Qe=ie(Ge.anchorX,Ge.anchorY,e,W);if(!N(Qe.point,se)){Ct(Ge.numGlyphs,ce);continue}const ct=j(s.transform.cameraToCenterDistance,Qe.signedDistanceFromCamera),tt=h.ai(J,re,Ge),Xe=w?tt/ct:tt*ct,_t={getElevation:W,labelPlaneMatrix:u,lineVertexArray:ee,pitchWithMap:w,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:A,tileAnchorPoint:new h.P(Ge.anchorX,Ge.anchorY),unwrappedTileID:R,width:B,height:U,translation:G},Nt=me(_t,Ge,Xe,!1,k,e,p,f.glyphOffsetArray,ce,ye,E);be=Nt.useVertical,(Nt.notEnoughRoom||be||Nt.needsFlipping&&me(_t,Ge,Xe,!0,k,e,p,f.glyphOffsetArray,ce,ye,E).notEnoughRoom)&&Ct(Ge.numGlyphs,ce)}l?f.text.dynamicLayoutVertexBuffer.updateData(ce):f.icon.dynamicLayoutVertexBuffer.updateData(ce)}function te(f,e,s,l,u,p,w,k){const E=p.glyphStartIndex+p.numGlyphs,A=p.lineStartIndex,R=p.lineStartIndex+p.lineLength,B=e.getoffsetX(p.glyphStartIndex),U=e.getoffsetX(E-1),G=Ye(f*B,s,l,u,p.segment,A,R,k,w);if(!G)return null;const W=Ye(f*U,s,l,u,p.segment,A,R,k,w);return W?k.projectionCache.anyProjectionOccluded?null:{first:G,last:W}:null}function he(f,e,s,l){return f===h.ah.horizontal&&Math.abs(s.y-e.y)>Math.abs(s.x-e.x)*l?{useVertical:!0}:(f===h.ah.vertical?e.y<s.y:e.x>s.x)?{needsFlipping:!0}:null}function me(f,e,s,l,u,p,w,k,E,A,R){const B=s/24,U=e.lineOffsetX*B,G=e.lineOffsetY*B;let W;if(e.numGlyphs>1){const J=e.glyphStartIndex+e.numGlyphs,re=e.lineStartIndex,se=e.lineStartIndex+e.lineLength,ce=te(B,k,U,G,l,e,R,f);if(!ce)return{notEnoughRoom:!0};const ee=ie(ce.first.point.x,ce.first.point.y,w,f.getElevation).point,fe=ie(ce.last.point.x,ce.last.point.y,w,f.getElevation).point;if(u&&!l){const ye=he(e.writingMode,ee,fe,A);if(ye)return ye}W=[ce.first];for(let ye=e.glyphStartIndex+1;ye<J-1;ye++)W.push(Ye(B*k.getoffsetX(ye),U,G,l,e.segment,re,se,f,R));W.push(ce.last)}else{if(u&&!l){const re=ie(f.tileAnchorPoint.x,f.tileAnchorPoint.y,p,f.getElevation).point,se=e.lineStartIndex+e.segment+1,ce=new h.P(f.lineVertexArray.getx(se),f.lineVertexArray.gety(se)),ee=ie(ce.x,ce.y,p,f.getElevation),fe=ee.signedDistanceFromCamera>0?ee.point:(function(be,Fe,Ge,Qe,ct,tt){return ve(be,Fe,Ge,1,ct,tt)})(f.tileAnchorPoint,ce,re,0,p,f),ye=he(e.writingMode,re,fe,A);if(ye)return ye}const J=Ye(B*k.getoffsetX(e.glyphStartIndex),U,G,l,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,f,R);if(!J||f.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};W=[J]}for(const J of W)h.aj(E,J.point,J.angle);return{}}function ve(f,e,s,l,u,p){const w=f.add(f.sub(e)._unit()),k=u!==void 0?ie(w.x,w.y,u,p.getElevation).point:Me(w.x,w.y,p).point,E=s.sub(k);return s.add(E._mult(l/E.mag()))}function ue(f,e,s){const l=e.projectionCache;if(l.projections[f])return l.projections[f];const u=new h.P(e.lineVertexArray.getx(f),e.lineVertexArray.gety(f)),p=Me(u.x,u.y,e);if(p.signedDistanceFromCamera>0)return l.projections[f]=p.point,l.anyProjectionOccluded=l.anyProjectionOccluded||p.isOccluded,p.point;const w=f-s.direction;return(function(k,E,A,R,B){return ve(k,E,A,R,void 0,B)})(s.distanceFromAnchor===0?e.tileAnchorPoint:new h.P(e.lineVertexArray.getx(w),e.lineVertexArray.gety(w)),u,s.previousVertex,s.absOffsetX-s.distanceFromAnchor+1,e)}function Me(f,e,s){const l=f+s.translation[0],u=e+s.translation[1];let p;return!s.pitchWithMap&&s.projection.useSpecialProjectionForSymbols?(p=s.projection.projectTileCoordinates(l,u,s.unwrappedTileID,s.getElevation),p.point.x=(.5*p.point.x+.5)*s.width,p.point.y=(.5*-p.point.y+.5)*s.height):(p=ie(l,u,s.labelPlaneMatrix,s.getElevation),p.isOccluded=!1),p}function Oe(f,e,s){return f._unit()._perp()._mult(e*s)}function ke(f,e,s,l,u,p,w,k,E){if(k.projectionCache.offsets[f])return k.projectionCache.offsets[f];const A=s.add(e);if(f+E.direction<l||f+E.direction>=u)return k.projectionCache.offsets[f]=A,A;const R=ue(f+E.direction,k,E),B=Oe(R.sub(s),w,E.direction),U=s.add(B),G=R.add(B);return k.projectionCache.offsets[f]=h.ak(p,A,U,G)||A,k.projectionCache.offsets[f]}function Ye(f,e,s,l,u,p,w,k,E){const A=l?f-e:f+e;let R=A>0?1:-1,B=0;l&&(R*=-1,B=Math.PI),R<0&&(B+=Math.PI);let U,G=R>0?p+u:p+u+1;k.projectionCache.cachedAnchorPoint?U=k.projectionCache.cachedAnchorPoint:(U=Me(k.tileAnchorPoint.x,k.tileAnchorPoint.y,k).point,k.projectionCache.cachedAnchorPoint=U);let W,J,re=U,se=U,ce=0,ee=0;const fe=Math.abs(A),ye=[];let be;for(;ce+ee<=fe;){if(G+=R,G<p||G>=w)return null;ce+=ee,se=re,J=W;const Qe={absOffsetX:fe,direction:R,distanceFromAnchor:ce,previousVertex:se};if(re=ue(G,k,Qe),s===0)ye.push(se),be=re.sub(se);else{let ct;const tt=re.sub(se);ct=tt.mag()===0?Oe(ue(G+R,k,Qe).sub(re),s,R):Oe(tt,s,R),J||(J=se.add(ct)),W=ke(G,ct,re,p,w,J,s,k,Qe),ye.push(J),be=W.sub(J)}ee=be.mag()}const Fe=be._mult((fe-ce)/ee)._add(J||se),Ge=B+Math.atan2(re.y-se.y,re.x-se.x);return ye.push(Fe),{point:Fe,angle:E?Ge:0,path:ye}}const wt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ct(f,e){for(let s=0;s<f;s++){const l=e.length;e.resize(l+4),e.float32.set(wt,3*l)}}function mr(f,e,s){const l=e[0],u=e[1];return f[0]=s[0]*l+s[4]*u+s[12],f[1]=s[1]*l+s[5]*u+s[13],f[3]=s[3]*l+s[7]*u+s[15],f}const Zt=100;class gr{constructor(e,s,l=new Qi(e.width+200,e.height+200,25),u=new Qi(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=s,this.grid=l,this.ignoredGrid=u,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Zt,this.screenBottomBoundary=e.height+Zt,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,s,l,u,p,w,k,E,A,R,B){const U=e.anchorPointX+E[0],G=e.anchorPointY+E[1],W=this.projectAndGetPerspectiveRatio(u,U,G,p,R),J=l*W.perspectiveRatio;let re;if(w||k)re=this._projectCollisionBox(e,J,u,p,w,k,E,W,R,B);else{const ye=W.point.x+(B?B.x*J:0),be=W.point.y+(B?B.y*J:0);re={allPointsOccluded:!1,box:[ye+e.x1*J,be+e.y1*J,ye+e.x2*J,be+e.y2*J]}}const[se,ce,ee,fe]=re.box;return this.mapProjection.useSpecialProjectionForSymbols&&(w?re.allPointsOccluded:this.mapProjection.isOccluded(U,G,p))||W.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(se,ce,ee,fe)||s!=="always"&&this.grid.hitTest(se,ce,ee,fe,s,A)?{box:[se,ce,ee,fe],placeable:!1,offscreen:!1}:{box:[se,ce,ee,fe],placeable:!0,offscreen:this.isOffscreen(se,ce,ee,fe)}}placeCollisionCircles(e,s,l,u,p,w,k,E,A,R,B,U,G,W,J,re){const se=[],ce=new h.P(s.anchorX,s.anchorY),ee=this.getPerspectiveRatio(w,ce.x,ce.y,k,re),fe=(B?p/ee:p*ee)/h.ap,ye={getElevation:re,labelPlaneMatrix:E,lineVertexArray:l,pitchWithMap:B,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:ce,unwrappedTileID:k,width:this.transform.width,height:this.transform.height,translation:J},be=te(fe,u,s.lineOffsetX*fe,s.lineOffsetY*fe,!1,s,!1,ye);let Fe=!1,Ge=!1,Qe=!0;if(be){const ct=.5*G*ee+W,tt=new h.P(-100,-100),Xe=new h.P(this.screenRightBoundary,this.screenBottomBoundary),_t=new Vt,Nt=be.first,nt=be.last;let st=[];for(let Gt=Nt.path.length-1;Gt>=1;Gt--)st.push(Nt.path[Gt]);for(let Gt=1;Gt<nt.path.length;Gt++)st.push(nt.path[Gt]);const Ot=2.5*ct;if(A){const Gt=this.projectPathToScreenSpace(st,ye,A);st=Gt.some((Qt=>Qt.signedDistanceFromCamera<=0))?[]:Gt.map((Qt=>Qt.point))}let Pr=[];if(st.length>0){const Gt=st[0].clone(),Qt=st[0].clone();for(let Mr=1;Mr<st.length;Mr++)Gt.x=Math.min(Gt.x,st[Mr].x),Gt.y=Math.min(Gt.y,st[Mr].y),Qt.x=Math.max(Qt.x,st[Mr].x),Qt.y=Math.max(Qt.y,st[Mr].y);Pr=Gt.x>=tt.x&&Qt.x<=Xe.x&&Gt.y>=tt.y&&Qt.y<=Xe.y?[st]:Qt.x<tt.x||Gt.x>Xe.x||Qt.y<tt.y||Gt.y>Xe.y?[]:h.al([st],tt.x,tt.y,Xe.x,Xe.y)}for(const Gt of Pr){_t.reset(Gt,.25*ct);let Qt=0;Qt=_t.length<=.5*ct?1:Math.ceil(_t.paddedLength/Ot)+1;for(let Mr=0;Mr<Qt;Mr++){const Tn=Mr/Math.max(Qt-1,1),bi=_t.lerp(Tn),Ar=bi.x+Zt,_n=bi.y+Zt;se.push(Ar,_n,ct,0);const Vr=Ar-ct,rn=_n-ct,Mn=Ar+ct,ls=_n+ct;if(Qe=Qe&&this.isOffscreen(Vr,rn,Mn,ls),Ge=Ge||this.isInsideGrid(Vr,rn,Mn,ls),e!=="always"&&this.grid.hitTestCircle(Ar,_n,ct,e,U)&&(Fe=!0,!R))return{circles:[],offscreen:!1,collisionDetected:Fe}}}}return{circles:!R&&Fe||!Ge||ee<this.perspectiveRatioCutoff?[]:se,offscreen:Qe,collisionDetected:Fe}}projectPathToScreenSpace(e,s,l){return e.map((u=>ie(u.x,u.y,l,s.getElevation)))}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let l=1/0,u=1/0,p=-1/0,w=-1/0;for(const R of e){const B=new h.P(R.x+Zt,R.y+Zt);l=Math.min(l,B.x),u=Math.min(u,B.y),p=Math.max(p,B.x),w=Math.max(w,B.y),s.push(B)}const k=this.grid.query(l,u,p,w).concat(this.ignoredGrid.query(l,u,p,w)),E={},A={};for(const R of k){const B=R.key;if(E[B.bucketInstanceId]===void 0&&(E[B.bucketInstanceId]={}),E[B.bucketInstanceId][B.featureIndex])continue;const U=[new h.P(R.x1,R.y1),new h.P(R.x2,R.y1),new h.P(R.x2,R.y2),new h.P(R.x1,R.y2)];h.am(s,U)&&(E[B.bucketInstanceId][B.featureIndex]=!0,A[B.bucketInstanceId]===void 0&&(A[B.bucketInstanceId]=[]),A[B.bucketInstanceId].push(B.featureIndex))}return A}insertCollisionBox(e,s,l,u,p,w){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:p,collisionGroupID:w,overlapMode:s},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,s,l,u,p,w){const k=l?this.ignoredGrid:this.grid,E={bucketInstanceId:u,featureIndex:p,collisionGroupID:w,overlapMode:s};for(let A=0;A<e.length;A+=4)k.insertCircle(E,e[A],e[A+1],e[A+2])}projectAndGetPerspectiveRatio(e,s,l,u,p){let w;p?(w=[s,l,p(s,l),1],h.af(w,w,e)):(w=[s,l,0,1],mr(w,w,e));const k=w[3];return{point:new h.P((w[0]/k+1)/2*this.transform.width+Zt,(-w[1]/k+1)/2*this.transform.height+Zt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/k*.5,isOccluded:!1,signedDistanceFromCamera:k}}getPerspectiveRatio(e,s,l,u,p){const w=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(s,l,u,p):ie(s,l,e,p);return .5+this.transform.cameraToCenterDistance/w.signedDistanceFromCamera*.5}isOffscreen(e,s,l,u){return l<Zt||e>=this.screenRightBoundary||u<Zt||s>this.screenBottomBoundary}isInsideGrid(e,s,l,u){return l>=0&&e<this.gridRightBoundary&&u>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const e=h.an([]);return h.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,s,l,u,p,w,k,E,A,R){let B=new h.P(1,0),U=new h.P(0,1);const G=new h.P(e.anchorPointX+k[0],e.anchorPointY+k[1]);if(w&&!p){const Qe=this.projectAndGetPerspectiveRatio(l,G.x+1,G.y,u,A).point.sub(E.point).unit(),ct=Math.atan(Qe.y/Qe.x)+(Qe.x<0?Math.PI:0),tt=Math.sin(ct),Xe=Math.cos(ct);B=new h.P(Xe,tt),U=new h.P(-tt,Xe)}else if(!w&&p){const Qe=-this.transform.angle,ct=Math.sin(Qe),tt=Math.cos(Qe);B=new h.P(tt,ct),U=new h.P(-ct,tt)}let W=E.point,J=s;if(p){W=G;const Qe=this.transform.zoom-Math.floor(this.transform.zoom);J=Math.pow(2,-Qe),J*=this.mapProjection.getPitchedTextCorrection(this.transform,G,u),R||(J*=h.ac(.5+E.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}R&&(W=W.add(B.mult(R.x*J)).add(U.mult(R.y*J)));const re=e.x1*J,se=e.x2*J,ce=(re+se)/2,ee=e.y1*J,fe=e.y2*J,ye=(ee+fe)/2,be=[{offsetX:re,offsetY:ee},{offsetX:ce,offsetY:ee},{offsetX:se,offsetY:ee},{offsetX:se,offsetY:ye},{offsetX:se,offsetY:fe},{offsetX:ce,offsetY:fe},{offsetX:re,offsetY:fe},{offsetX:re,offsetY:ye}];let Fe=[];for(const{offsetX:Qe,offsetY:ct}of be)Fe.push(new h.P(W.x+B.x*Qe+U.x*ct,W.y+B.y*Qe+U.y*ct));let Ge=!1;if(p){const Qe=Fe.map((ct=>this.projectAndGetPerspectiveRatio(l,ct.x,ct.y,u,A)));Ge=Qe.some((ct=>!ct.isOccluded)),Fe=Qe.map((ct=>ct.point))}else Ge=!0;return{box:h.ao(Fe),allPointsOccluded:!Ge}}}function Wt(f,e,s){return e*(h.X/(f.tileSize*Math.pow(2,s-f.tileID.overscaledZ)))}class sn{constructor(e,s,l,u){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?s:-s))):u&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class Gr{constructor(e,s,l,u,p){this.text=new sn(e?e.text:null,s,l,p),this.icon=new sn(e?e.icon:null,s,u,p)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class rr{constructor(e,s,l){this.text=e,this.icon=s,this.skipFade=l}}class br{constructor(){this.invProjMatrix=h.H(),this.viewportMatrix=h.H(),this.circles=[]}}class Nr{constructor(e,s,l,u,p){this.bucketInstanceId=e,this.featureIndex=s,this.sourceLayerIndex=l,this.bucketIndex=u,this.tileID=p}}class yn{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const s=++this.maxGroupID;this.collisionGroups[e]={ID:s,predicate:l=>l.collisionGroupID===s}}return this.collisionGroups[e]}}function Sn(f,e,s,l,u){const{horizontalAlign:p,verticalAlign:w}=h.au(f);return new h.P(-(p-.5)*e+l[0]*u,-(w-.5)*s+l[1]*u)}class $n{constructor(e,s,l,u,p,w){this.transform=e.clone(),this.terrain=l,this.collisionIndex=new gr(this.transform,s),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new yn(p),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=w,w&&(w.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const s=this.terrain;return s?(l,u)=>s.getElevation(e,l,u):null}getBucketParts(e,s,l,u){const p=l.getBucket(s),w=l.latestFeatureIndex;if(!p||!w||s.id!==p.layerIds[0])return;const k=l.collisionBoxArray,E=p.layers[0].layout,A=p.layers[0].paint,R=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),B=l.tileSize/h.X,U=l.tileID.toUnwrapped(),G=this.transform.calculatePosMatrix(U),W=E.get("text-pitch-alignment")==="map",J=E.get("text-rotation-alignment")==="map",re=Wt(l,1,this.transform.zoom),se=this.collisionIndex.mapProjection.translatePosition(this.transform,l,A.get("text-translate"),A.get("text-translate-anchor")),ce=this.collisionIndex.mapProjection.translatePosition(this.transform,l,A.get("icon-translate"),A.get("icon-translate-anchor")),ee=yi(G,W,J,this.transform,re);let fe=null;if(W){const be=Un(G,W,J,this.transform,re);fe=h.L([],this.transform.labelPlaneMatrix,be)}this.retainedQueryData[p.bucketInstanceId]=new Nr(p.bucketInstanceId,w,p.sourceLayerIndex,p.index,l.tileID);const ye={bucket:p,layout:E,translationText:se,translationIcon:ce,posMatrix:G,unwrappedTileID:U,textLabelPlaneMatrix:ee,labelToScreenMatrix:fe,scale:R,textPixelRatio:B,holdingForFade:l.holdingForFade(),collisionBoxArray:k,partiallyEvaluatedTextSize:h.ag(p.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(p.sourceID)};if(u)for(const be of p.sortKeyRanges){const{sortKey:Fe,symbolInstanceStart:Ge,symbolInstanceEnd:Qe}=be;e.push({sortKey:Fe,symbolInstanceStart:Ge,symbolInstanceEnd:Qe,parameters:ye})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:p.symbolInstances.length,parameters:ye})}attemptAnchorPlacement(e,s,l,u,p,w,k,E,A,R,B,U,G,W,J,re,se,ce,ee){const fe=h.aq[e.textAnchor],ye=[e.textOffset0,e.textOffset1],be=Sn(fe,l,u,ye,p),Fe=this.collisionIndex.placeCollisionBox(s,U,E,A,R,k,w,re,B.predicate,ee,be);if((!ce||this.collisionIndex.placeCollisionBox(ce,U,E,A,R,k,w,se,B.predicate,ee,be).placeable)&&Fe.placeable){let Ge;if(this.prevPlacement&&this.prevPlacement.variableOffsets[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID].text&&(Ge=this.prevPlacement.variableOffsets[G.crossTileID].anchor),G.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[G.crossTileID]={textOffset:ye,width:l,height:u,anchor:fe,textBoxScale:p,prevAnchor:Ge},this.markUsedJustification(W,fe,G,J),W.allowVerticalPlacement&&(this.markUsedOrientation(W,J,G),this.placedOrientations[G.crossTileID]=J),{shift:be,placedGlyphBoxes:Fe}}}placeLayerBucketPart(e,s,l){const{bucket:u,layout:p,translationText:w,translationIcon:k,posMatrix:E,unwrappedTileID:A,textLabelPlaneMatrix:R,labelToScreenMatrix:B,textPixelRatio:U,holdingForFade:G,collisionBoxArray:W,partiallyEvaluatedTextSize:J,collisionGroup:re}=e.parameters,se=p.get("text-optional"),ce=p.get("icon-optional"),ee=h.ar(p,"text-overlap","text-allow-overlap"),fe=ee==="always",ye=h.ar(p,"icon-overlap","icon-allow-overlap"),be=ye==="always",Fe=p.get("text-rotation-alignment")==="map",Ge=p.get("text-pitch-alignment")==="map",Qe=p.get("icon-text-fit")!=="none",ct=p.get("symbol-z-order")==="viewport-y",tt=fe&&(be||!u.hasIconData()||ce),Xe=be&&(fe||!u.hasTextData()||se);!u.collisionArrays&&W&&u.deserializeCollisionBoxes(W);const _t=this._getTerrainElevationFunc(this.retainedQueryData[u.bucketInstanceId].tileID),Nt=(nt,st,Ot)=>{var Pr,Gt;if(s[nt.crossTileID])return;if(G)return void(this.placements[nt.crossTileID]=new rr(!1,!1,!1));let Qt=!1,Mr=!1,Tn=!0,bi=null,Ar={box:null,placeable:!1,offscreen:null},_n={placeable:!1},Vr=null,rn=null,Mn=null,ls=0,ai=0,us=0;st.textFeatureIndex?ls=st.textFeatureIndex:nt.useRuntimeCollisionCircles&&(ls=nt.featureIndex),st.verticalTextFeatureIndex&&(ai=st.verticalTextFeatureIndex);const Ca=st.textBox;if(Ca){const Hn=ln=>{let qr=h.ah.horizontal;if(u.allowVerticalPlacement&&!ln&&this.prevPlacement){const An=this.prevPlacement.placedOrientations[nt.crossTileID];An&&(this.placedOrientations[nt.crossTileID]=An,qr=An,this.markUsedOrientation(u,qr,nt))}return qr},ki=(ln,qr)=>{if(u.allowVerticalPlacement&&nt.numVerticalGlyphVertices>0&&st.verticalTextBox){for(const An of u.writingModes)if(An===h.ah.vertical?(Ar=qr(),_n=Ar):Ar=ln(),Ar&&Ar.placeable)break}else Ar=ln()},cs=nt.textAnchorOffsetStartIndex,Ni=nt.textAnchorOffsetEndIndex;if(Ni===cs){const ln=(qr,An)=>{const nr=this.collisionIndex.placeCollisionBox(qr,ee,U,E,A,Ge,Fe,w,re.predicate,_t);return nr&&nr.placeable&&(this.markUsedOrientation(u,An,nt),this.placedOrientations[nt.crossTileID]=An),nr};ki((()=>ln(Ca,h.ah.horizontal)),(()=>{const qr=st.verticalTextBox;return u.allowVerticalPlacement&&nt.numVerticalGlyphVertices>0&&qr?ln(qr,h.ah.vertical):{box:null,offscreen:null}})),Hn(Ar&&Ar.placeable)}else{let ln=h.aq[(Gt=(Pr=this.prevPlacement)===null||Pr===void 0?void 0:Pr.variableOffsets[nt.crossTileID])===null||Gt===void 0?void 0:Gt.anchor];const qr=(nr,Ti,Ma)=>{const hs=nr.x2-nr.x1,rc=nr.y2-nr.y1,nc=nt.textBoxScale,Hr=Qe&&ye==="never"?Ti:null;let ds=null,du=ee==="never"?1:2,Ro="never";ln&&du++;for(let Aa=0;Aa<du;Aa++){for(let Bo=cs;Bo<Ni;Bo++){const Ds=u.textAnchorOffsets.get(Bo);if(ln&&Ds.textAnchor!==ln)continue;const zr=this.attemptAnchorPlacement(Ds,nr,hs,rc,nc,Fe,Ge,U,E,A,re,Ro,nt,u,Ma,w,k,Hr,_t);if(zr&&(ds=zr.placedGlyphBoxes,ds&&ds.placeable))return Qt=!0,bi=zr.shift,ds}ln?ln=null:Ro=ee}return l&&!ds&&(ds={box:this.collisionIndex.placeCollisionBox(Ca,"always",U,E,A,Ge,Fe,w,re.predicate,_t,new h.P(0,0)).box,offscreen:!1,placeable:!1}),ds};ki((()=>qr(Ca,st.iconBox,h.ah.horizontal)),(()=>{const nr=st.verticalTextBox;return u.allowVerticalPlacement&&(!Ar||!Ar.placeable)&&nt.numVerticalGlyphVertices>0&&nr?qr(nr,st.verticalIconBox,h.ah.vertical):{box:null,occluded:!0,offscreen:null}})),Ar&&(Qt=Ar.placeable,Tn=Ar.offscreen);const An=Hn(Ar&&Ar.placeable);if(!Qt&&this.prevPlacement){const nr=this.prevPlacement.variableOffsets[nt.crossTileID];nr&&(this.variableOffsets[nt.crossTileID]=nr,this.markUsedJustification(u,nr.anchor,nt,An))}}}if(Vr=Ar,Qt=Vr&&Vr.placeable,Tn=Vr&&Vr.offscreen,nt.useRuntimeCollisionCircles){const Hn=u.text.placedSymbolArray.get(nt.centerJustifiedTextSymbolIndex),ki=h.ai(u.textSizeData,J,Hn),cs=p.get("text-padding");rn=this.collisionIndex.placeCollisionCircles(ee,Hn,u.lineVertexArray,u.glyphOffsetArray,ki,E,A,R,B,l,Ge,re.predicate,nt.collisionCircleDiameter,cs,w,_t),rn.circles.length&&rn.collisionDetected&&!l&&h.w("Collisions detected, but collision boxes are not shown"),Qt=fe||rn.circles.length>0&&!rn.collisionDetected,Tn=Tn&&rn.offscreen}if(st.iconFeatureIndex&&(us=st.iconFeatureIndex),st.iconBox){const Hn=ki=>this.collisionIndex.placeCollisionBox(ki,ye,U,E,A,Ge,Fe,k,re.predicate,_t,Qe&&bi?bi:void 0);_n&&_n.placeable&&st.verticalIconBox?(Mn=Hn(st.verticalIconBox),Mr=Mn.placeable):(Mn=Hn(st.iconBox),Mr=Mn.placeable),Tn=Tn&&Mn.offscreen}const Si=se||nt.numHorizontalGlyphVertices===0&&nt.numVerticalGlyphVertices===0,Oi=ce||nt.numIconVertices===0;Si||Oi?Oi?Si||(Mr=Mr&&Qt):Qt=Mr&&Qt:Mr=Qt=Mr&&Qt;const zs=Mr&&Mn.placeable;if(Qt&&Vr.placeable&&this.collisionIndex.insertCollisionBox(Vr.box,ee,p.get("text-ignore-placement"),u.bucketInstanceId,_n&&_n.placeable&&ai?ai:ls,re.ID),zs&&this.collisionIndex.insertCollisionBox(Mn.box,ye,p.get("icon-ignore-placement"),u.bucketInstanceId,us,re.ID),rn&&Qt&&this.collisionIndex.insertCollisionCircles(rn.circles,ee,p.get("text-ignore-placement"),u.bucketInstanceId,ls,re.ID),l&&this.storeCollisionData(u.bucketInstanceId,Ot,st,Vr,Mn,rn),nt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(u.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[nt.crossTileID]=new rr(Qt||tt,Mr||Xe,Tn||u.justReloaded),s[nt.crossTileID]=!0};if(ct){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const nt=u.getSortedSymbolIndexes(this.transform.angle);for(let st=nt.length-1;st>=0;--st){const Ot=nt[st];Nt(u.symbolInstances.get(Ot),u.collisionArrays[Ot],Ot)}}else for(let nt=e.symbolInstanceStart;nt<e.symbolInstanceEnd;nt++)Nt(u.symbolInstances.get(nt),u.collisionArrays[nt],nt);if(l&&u.bucketInstanceId in this.collisionCircleArrays){const nt=this.collisionCircleArrays[u.bucketInstanceId];h.as(nt.invProjMatrix,E),nt.viewportMatrix=this.collisionIndex.getViewportMatrix()}u.justReloaded=!1}storeCollisionData(e,s,l,u,p,w){if(l.textBox||l.iconBox){let k,E;this.collisionBoxArrays.has(e)?k=this.collisionBoxArrays.get(e):(k=new Map,this.collisionBoxArrays.set(e,k)),k.has(s)?E=k.get(s):(E={text:null,icon:null},k.set(s,E)),l.textBox&&(E.text=u.box),l.iconBox&&(E.icon=p.box)}if(w){let k=this.collisionCircleArrays[e];k===void 0&&(k=this.collisionCircleArrays[e]=new br);for(let E=0;E<w.circles.length;E+=4)k.circles.push(w.circles[E+0]),k.circles.push(w.circles[E+1]),k.circles.push(w.circles[E+2]),k.circles.push(w.collisionDetected?1:0)}}markUsedJustification(e,s,l,u){let p;p=u===h.ah.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[h.at(s)];const w=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const k of w)k>=0&&(e.text.placedSymbolArray.get(k).crossTileID=p>=0&&k!==p?0:l.crossTileID)}markUsedOrientation(e,s,l){const u=s===h.ah.horizontal||s===h.ah.horizontalOnly?s:0,p=s===h.ah.vertical?s:0,w=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const k of w)e.text.placedSymbolArray.get(k).placedOrientation=u;l.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=p)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let l=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const u=s?s.symbolFadeChange(e):1,p=s?s.opacities:{},w=s?s.variableOffsets:{},k=s?s.placedOrientations:{};for(const E in this.placements){const A=this.placements[E],R=p[E];R?(this.opacities[E]=new Gr(R,u,A.text,A.icon),l=l||A.text!==R.text.placed||A.icon!==R.icon.placed):(this.opacities[E]=new Gr(null,u,A.text,A.icon,A.skipFade),l=l||A.text||A.icon)}for(const E in p){const A=p[E];if(!this.opacities[E]){const R=new Gr(A,u,!1,!1);R.isHidden()||(this.opacities[E]=R,l=l||A.text.placed||A.icon.placed)}}for(const E in w)this.variableOffsets[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.variableOffsets[E]=w[E]);for(const E in k)this.placedOrientations[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.placedOrientations[E]=k[E]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:e)}updateLayerOpacities(e,s){const l={};for(const u of s){const p=u.getBucket(e);p&&u.latestFeatureIndex&&e.id===p.layerIds[0]&&this.updateBucketOpacities(p,u.tileID,l,u.collisionBoxArray)}}updateBucketOpacities(e,s,l,u){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const p=e.layers[0],w=p.layout,k=new Gr(null,0,!1,!1,!0),E=w.get("text-allow-overlap"),A=w.get("icon-allow-overlap"),R=p._unevaluatedLayout.hasValue("text-variable-anchor")||p._unevaluatedLayout.hasValue("text-variable-anchor-offset"),B=w.get("text-rotation-alignment")==="map",U=w.get("text-pitch-alignment")==="map",G=w.get("icon-text-fit")!=="none",W=new Gr(null,0,E&&(A||!e.hasIconData()||w.get("icon-optional")),A&&(E||!e.hasTextData()||w.get("text-optional")),!0);!e.collisionArrays&&u&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(u);const J=(se,ce,ee)=>{for(let fe=0;fe<ce/4;fe++)se.opacityVertexArray.emplaceBack(ee);se.hasVisibleVertices=se.hasVisibleVertices||ee!==qn},re=this.collisionBoxArrays.get(e.bucketInstanceId);for(let se=0;se<e.symbolInstances.length;se++){const ce=e.symbolInstances.get(se),{numHorizontalGlyphVertices:ee,numVerticalGlyphVertices:fe,crossTileID:ye}=ce;let be=this.opacities[ye];l[ye]?be=k:be||(be=W,this.opacities[ye]=be),l[ye]=!0;const Fe=ce.numIconVertices>0,Ge=this.placedOrientations[ce.crossTileID],Qe=Ge===h.ah.vertical,ct=Ge===h.ah.horizontal||Ge===h.ah.horizontalOnly;if(ee>0||fe>0){const Xe=Bn(be.text);J(e.text,ee,Qe?qn:Xe),J(e.text,fe,ct?qn:Xe);const _t=be.text.isHidden();[ce.rightJustifiedTextSymbolIndex,ce.centerJustifiedTextSymbolIndex,ce.leftJustifiedTextSymbolIndex].forEach((st=>{st>=0&&(e.text.placedSymbolArray.get(st).hidden=_t||Qe?1:0)})),ce.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(ce.verticalPlacedTextSymbolIndex).hidden=_t||ct?1:0);const Nt=this.variableOffsets[ce.crossTileID];Nt&&this.markUsedJustification(e,Nt.anchor,ce,Ge);const nt=this.placedOrientations[ce.crossTileID];nt&&(this.markUsedJustification(e,"left",ce,nt),this.markUsedOrientation(e,nt,ce))}if(Fe){const Xe=Bn(be.icon),_t=!(G&&ce.verticalPlacedIconSymbolIndex&&Qe);ce.placedIconSymbolIndex>=0&&(J(e.icon,ce.numIconVertices,_t?Xe:qn),e.icon.placedSymbolArray.get(ce.placedIconSymbolIndex).hidden=be.icon.isHidden()),ce.verticalPlacedIconSymbolIndex>=0&&(J(e.icon,ce.numVerticalIconVertices,_t?qn:Xe),e.icon.placedSymbolArray.get(ce.verticalPlacedIconSymbolIndex).hidden=be.icon.isHidden())}const tt=re&&re.has(se)?re.get(se):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Xe=e.collisionArrays[se];if(Xe){let _t=new h.P(0,0);if(Xe.textBox||Xe.verticalTextBox){let Nt=!0;if(R){const nt=this.variableOffsets[ye];nt?(_t=Sn(nt.anchor,nt.width,nt.height,nt.textOffset,nt.textBoxScale),B&&_t._rotate(U?this.transform.angle:-this.transform.angle)):Nt=!1}if(Xe.textBox||Xe.verticalTextBox){let nt;Xe.textBox&&(nt=Qe),Xe.verticalTextBox&&(nt=ct),po(e.textCollisionBox.collisionVertexArray,be.text.placed,!Nt||nt,tt.text,_t.x,_t.y)}}if(Xe.iconBox||Xe.verticalIconBox){const Nt=!!(!ct&&Xe.verticalIconBox);let nt;Xe.iconBox&&(nt=Nt),Xe.verticalIconBox&&(nt=!Nt),po(e.iconCollisionBox.collisionVertexArray,be.icon.placed,nt,tt.icon,G?_t.x:0,G?_t.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const se=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=se.invProjMatrix,e.placementViewportMatrix=se.viewportMatrix,e.collisionCircleArray=se.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,s){const l=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*l>e}setStale(){this.stale=!0}}function po(f,e,s,l,u,p){l&&l.length!==0||(l=[0,0,0,0]);const w=l[0]-Zt,k=l[1]-Zt,E=l[2]-Zt,A=l[3]-Zt;f.emplaceBack(e?1:0,s?1:0,u||0,p||0,w,k),f.emplaceBack(e?1:0,s?1:0,u||0,p||0,E,k),f.emplaceBack(e?1:0,s?1:0,u||0,p||0,E,A),f.emplaceBack(e?1:0,s?1:0,u||0,p||0,w,A)}const Ut=Math.pow(2,25),zu=Math.pow(2,24),tl=Math.pow(2,17),Qn=Math.pow(2,16),Rn=Math.pow(2,9),Jh=Math.pow(2,8),_i=Math.pow(2,1);function Bn(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const e=f.placed?1:0,s=Math.floor(127*f.opacity);return s*Ut+e*zu+s*tl+e*Qn+s*Rn+e*Jh+s*_i+e}const qn=0;function Na(){return{isOccluded:(f,e,s)=>!1,getPitchedTextCorrection:(f,e,s)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(f,e,s,l){throw new Error("Not implemented.")},translatePosition:(f,e,s,l)=>(function(u,p,w,k,E=!1){if(!w[0]&&!w[1])return[0,0];const A=E?k==="map"?u.angle:0:k==="viewport"?-u.angle:0;if(A){const R=Math.sin(A),B=Math.cos(A);w=[w[0]*B-w[1]*R,w[0]*R+w[1]*B]}return[E?w[0]:Wt(p,w[0],u.zoom),E?w[1]:Wt(p,w[1],u.zoom)]})(f,e,s,l),getCircleRadiusCorrection:f=>1}}class Er{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,s,l,u,p){const w=this._bucketParts;for(;this._currentTileIndex<e.length;)if(s.getBucketParts(w,u,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,p())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort(((k,E)=>k.sortKey-E.sortKey)));this._currentPartIndex<w.length;)if(s.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,p())return!0;return!1}}class rl{constructor(e,s,l,u,p,w,k,E){this.placement=new $n(e,Na(),s,w,k,E),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(e,s,l){const u=Y.now(),p=()=>!this._forceFullPlacement&&Y.now()-u>2;for(;this._currentPlacementIndex>=0;){const w=s[e[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if(w.type==="symbol"&&(!w.minzoom||w.minzoom<=k)&&(!w.maxzoom||w.maxzoom>k)){if(this._inProgressLayer||(this._inProgressLayer=new Er(w)),this._inProgressLayer.continuePlacement(l[w.source],this.placement,this._showCollisionBoxes,w,p))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const es=512/h.X/2;class an{constructor(e,s,l){this.tileID=e,this.bucketInstanceId=l,this._symbolsByKey={};const u=new Map;for(let p=0;p<s.length;p++){const w=s.get(p),k=w.key,E=u.get(k);E?E.push(w):u.set(k,[w])}for(const[p,w]of u){const k={positions:w.map((E=>({x:Math.floor(E.anchorX*es),y:Math.floor(E.anchorY*es)}))),crossTileIDs:w.map((E=>E.crossTileID))};if(k.positions.length>128){const E=new h.av(k.positions.length,16,Uint16Array);for(const{x:A,y:R}of k.positions)E.add(A,R);E.finish(),delete k.positions,k.index=E}this._symbolsByKey[p]=k}}getScaledCoordinates(e,s){const{x:l,y:u,z:p}=this.tileID.canonical,{x:w,y:k,z:E}=s.canonical,A=es/Math.pow(2,E-p),R=(k*h.X+e.anchorY)*A,B=u*h.X*es;return{x:Math.floor((w*h.X+e.anchorX)*A-l*h.X*es),y:Math.floor(R-B)}}findMatches(e,s,l){const u=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let p=0;p<e.length;p++){const w=e.get(p);if(w.crossTileID)continue;const k=this._symbolsByKey[w.key];if(!k)continue;const E=this.getScaledCoordinates(w,s);if(k.index){const A=k.index.range(E.x-u,E.y-u,E.x+u,E.y+u).sort();for(const R of A){const B=k.crossTileIDs[R];if(!l[B]){l[B]=!0,w.crossTileID=B;break}}}else if(k.positions)for(let A=0;A<k.positions.length;A++){const R=k.positions[A],B=k.crossTileIDs[A];if(Math.abs(R.x-E.x)<=u&&Math.abs(R.y-E.y)<=u&&!l[B]){l[B]=!0,w.crossTileID=B;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:e})=>e))}}class ja{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ei{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const s=Math.round((e-this.lng)/360);if(s!==0)for(const l in this.indexes){const u=this.indexes[l],p={};for(const w in u){const k=u[w];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+s),p[k.tileID.key]=k}this.indexes[l]=p}this.lng=e}addBucket(e,s,l){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let p=0;p<s.symbolInstances.length;p++)s.symbolInstances.get(p).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const u=this.usedCrossTileIDs[e.overscaledZ];for(const p in this.indexes){const w=this.indexes[p];if(Number(p)>e.overscaledZ)for(const k in w){const E=w[k];E.tileID.isChildOf(e)&&E.findMatches(s.symbolInstances,e,u)}else{const k=w[e.scaledTo(Number(p)).key];k&&k.findMatches(s.symbolInstances,e,u)}}for(let p=0;p<s.symbolInstances.length;p++){const w=s.symbolInstances.get(p);w.crossTileID||(w.crossTileID=l.generate(),u[w.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new an(e,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(e,s){for(const l of s.getCrossTileIDsLists())for(const u of l)delete this.usedCrossTileIDs[e][u]}removeStaleBuckets(e){let s=!1;for(const l in this.indexes){const u=this.indexes[l];for(const p in u)e[u[p].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,u[p]),delete u[p],s=!0)}return s}}class Va{constructor(){this.layerIndexes={},this.crossTileIDs=new ja,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,s,l){let u=this.layerIndexes[e.id];u===void 0&&(u=this.layerIndexes[e.id]=new ei);let p=!1;const w={};u.handleWrapJump(l);for(const k of s){const E=k.getBucket(e);E&&e.id===E.layerIds[0]&&(E.bucketInstanceId||(E.bucketInstanceId=++this.maxBucketInstanceId),u.addBucket(k.tileID,E,this.crossTileIDs)&&(p=!0),w[E.bucketInstanceId]=!0)}return u.removeStaleBuckets(w)&&(p=!0),p}pruneUnusedLayers(e){const s={};e.forEach((l=>{s[l]=!0}));for(const l in this.layerIndexes)s[l]||delete this.layerIndexes[l]}}const ti=(f,e)=>h.t(f,e&&e.filter((s=>s.identifier!=="source.canvas"))),Qh=h.aw();class $l extends h.E{constructor(e,s={}){super(),this._rtlPluginLoaded=()=>{for(const l in this.sourceCaches){const u=this.sourceCaches[l].getSource().type;u!=="vector"&&u!=="geojson"||this.sourceCaches[l].reload()}},this.map=e,this.dispatcher=new mn(Ir(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",((l,u)=>this.getGlyphs(l,u))),this.dispatcher.registerMessageHandler("GI",((l,u)=>this.getImages(l,u))),this.imageManager=new Rt,this.imageManager.setEventedParent(this),this.glyphManager=new Ht(e._requestManager,s.localIdeographFontFamily),this.lineAtlas=new Xt(256,512),this.crossTileSymbolIndex=new Va,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new h.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",h.ay()),Jn().on(Ke,this._rtlPluginLoaded),this.on("data",(l=>{if(l.dataType!=="source"||l.sourceDataType!=="metadata")return;const u=this.sourceCaches[l.sourceId];if(!u)return;const p=u.getSource();if(p&&p.vectorLayerIds)for(const w in this._layers){const k=this._layers[w];k.source===p.id&&this._validateLayer(k)}}))}loadURL(e,s={},l){this.fire(new h.k("dataloading",{dataType:"style"})),s.validate=typeof s.validate!="boolean"||s.validate;const u=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const p=this._loadStyleRequest;h.h(u,this._loadStyleRequest).then((w=>{this._loadStyleRequest=null,this._load(w.data,s,l)})).catch((w=>{this._loadStyleRequest=null,w&&!p.signal.aborted&&this.fire(new h.j(w))}))}loadJSON(e,s={},l){this.fire(new h.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,Y.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,s.validate=s.validate!==!1,this._load(e,s,l)})).catch((()=>{}))}loadEmpty(){this.fire(new h.k("dataloading",{dataType:"style"})),this._load(Qh,{validate:!1})}_load(e,s,l){var u;const p=s.transformStyle?s.transformStyle(l,e):e;if(!s.validate||!ti(this,h.u(p))){this._loaded=!0,this.stylesheet=p;for(const w in p.sources)this.addSource(w,p.sources[w],{validate:!1});p.sprite?this._loadSprite(p.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(p.glyphs),this._createLayers(),this.light=new ft(this.stylesheet.light),this.sky=new Ne(this.stylesheet.sky),this.map.setTerrain((u=this.stylesheet.terrain)!==null&&u!==void 0?u:null),this.fire(new h.k("data",{dataType:"style"})),this.fire(new h.k("style.load"))}}_createLayers(){const e=h.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map((s=>s.id)),this._layers={},this._serializedLayers=null;for(const s of e){const l=h.aA(s);l.setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=l}}_loadSprite(e,s=!1,l=void 0){let u;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(p,w,k,E){return h._(this,void 0,void 0,(function*(){const A=Ve(p),R=k>1?"@2x":"",B={},U={};for(const{id:G,url:W}of A){const J=w.transformRequest(tr(W,R,".json"),"SpriteJSON");B[G]=h.h(J,E);const re=w.transformRequest(tr(W,R,".png"),"SpriteImage");U[G]=$e.getImage(re,E)}return yield Promise.all([...Object.values(B),...Object.values(U)]),(function(G,W){return h._(this,void 0,void 0,(function*(){const J={};for(const re in G){J[re]={};const se=Y.getImageCanvasContext((yield W[re]).data),ce=(yield G[re]).data;for(const ee in ce){const{width:fe,height:ye,x:be,y:Fe,sdf:Ge,pixelRatio:Qe,stretchX:ct,stretchY:tt,content:Xe,textFitWidth:_t,textFitHeight:Nt}=ce[ee];J[re][ee]={data:null,pixelRatio:Qe,sdf:Ge,stretchX:ct,stretchY:tt,content:Xe,textFitWidth:_t,textFitHeight:Nt,spriteData:{width:fe,height:ye,x:be,y:Fe,context:se}}}}return J}))})(B,U)}))})(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((p=>{if(this._spriteRequest=null,p)for(const w in p){this._spritesImagesIds[w]=[];const k=this._spritesImagesIds[w]?this._spritesImagesIds[w].filter((E=>!(E in p))):[];for(const E of k)this.imageManager.removeImage(E),this._changedImages[E]=!0;for(const E in p[w]){const A=w==="default"?E:`${w}:${E}`;this._spritesImagesIds[w].push(A),A in this.imageManager.images?this.imageManager.updateImage(A,p[w][E],!1):this.imageManager.addImage(A,p[w][E]),s&&(this._changedImages[A]=!0)}}})).catch((p=>{this._spriteRequest=null,u=p,this.fire(new h.j(u))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),s&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.k("data",{dataType:"style"})),l&&l(u)}))}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.k("data",{dataType:"style"}))}_validateLayer(e){const s=this.sourceCaches[e.source];if(!s)return;const l=e.sourceLayer;if(!l)return;const u=s.getSource();(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(l)===-1)&&this.fire(new h.j(new Error(`Source layer "${l}" does not exist on source "${u.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,s=!1){const l=this._serializedAllLayers();if(!e||e.length===0)return Object.values(s?h.aB(l):l);const u=[];for(const p of e)if(l[p]){const w=s?h.aB(l[p]):l[p];u.push(w)}return u}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const s=Object.keys(this._layers);for(const l of s){const u=this._layers[l];u.type!=="custom"&&(e[l]=u.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const s=this._changed;if(s){const u=Object.keys(this._updatedLayers),p=Object.keys(this._removedLayers);(u.length||p.length)&&this._updateWorkerLayers(u,p);for(const w in this._updatedSources){const k=this._updatedSources[w];if(k==="reload")this._reloadSource(w);else{if(k!=="clear")throw new Error(`Invalid action ${k}`);this._clearSource(w)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const w in this._updatedPaintProps)this._layers[w].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const l={};for(const u in this.sourceCaches){const p=this.sourceCaches[u];l[u]=p.used,p.used=!1}for(const u of this._order){const p=this._layers[u];p.recalculate(e,this._availableImages),!p.isHidden(e.zoom)&&p.source&&(this.sourceCaches[p.source].used=!0)}for(const u in l){const p=this.sourceCaches[u];!!l[u]!=!!p.used&&p.fire(new h.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:u}))}this.light.recalculate(e),this.sky.recalculate(e),this.z=e.zoom,s&&this.fire(new h.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,s){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,s={}){var l;this._checkLoaded();const u=this.serialize();if(e=s.transformStyle?s.transformStyle(u,e):e,((l=s.validate)===null||l===void 0||l)&&ti(this,h.u(e)))return!1;(e=h.aB(e)).layers=h.az(e.layers);const p=h.aC(u,e),w=this._getOperationsToPerform(p);if(w.unimplemented.length>0)throw new Error(`Unimplemented: ${w.unimplemented.join(", ")}.`);if(w.operations.length===0)return!1;for(const k of w.operations)k();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const s=[],l=[];for(const u of e)switch(u.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":s.push((()=>this.addLayer.apply(this,u.args)));break;case"removeLayer":s.push((()=>this.removeLayer.apply(this,u.args)));break;case"setPaintProperty":s.push((()=>this.setPaintProperty.apply(this,u.args)));break;case"setLayoutProperty":s.push((()=>this.setLayoutProperty.apply(this,u.args)));break;case"setFilter":s.push((()=>this.setFilter.apply(this,u.args)));break;case"addSource":s.push((()=>this.addSource.apply(this,u.args)));break;case"removeSource":s.push((()=>this.removeSource.apply(this,u.args)));break;case"setLayerZoomRange":s.push((()=>this.setLayerZoomRange.apply(this,u.args)));break;case"setLight":s.push((()=>this.setLight.apply(this,u.args)));break;case"setGeoJSONSourceData":s.push((()=>this.setGeoJSONSourceData.apply(this,u.args)));break;case"setGlyphs":s.push((()=>this.setGlyphs.apply(this,u.args)));break;case"setSprite":s.push((()=>this.setSprite.apply(this,u.args)));break;case"setSky":s.push((()=>this.setSky.apply(this,u.args)));break;case"setTerrain":s.push((()=>this.map.setTerrain.apply(this,u.args)));break;case"setTransition":s.push((()=>{}));break;default:l.push(u.command)}return{operations:s,unimplemented:l}}addImage(e,s){if(this.getImage(e))return this.fire(new h.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,s),this._afterImageUpdated(e)}updateImage(e,s){this.imageManager.updateImage(e,s)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new h.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,s,l={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(h.u.source,`sources.${e}`,s,null,l))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const u=this.sourceCaches[e]=new Ft(e,s,this.dispatcher);u.style=this,u.setEventedParent(this,(()=>({isSourceLoaded:u.loaded(),source:u.serialize(),sourceId:e}))),u.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===e)return this.fire(new h.j(new Error(`Source "${e}" cannot be removed while layer "${l}" is using it.`)));const s=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],s.fire(new h.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,s){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const l=this.sourceCaches[e].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(s),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,s,l={}){this._checkLoaded();const u=e.id;if(this.getLayer(u))return void this.fire(new h.j(new Error(`Layer "${u}" already exists on this map.`)));let p;if(e.type==="custom"){if(ti(this,h.aD(e)))return;p=h.aA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(u,e.source),e=h.aB(e),e=h.e(e,{source:u})),this._validate(h.u.layer,`layers.${u}`,e,{arrayIndex:-1},l))return;p=h.aA(e),this._validateLayer(p),p.setEventedParent(this,{layer:{id:u}})}const w=s?this._order.indexOf(s):this._order.length;if(s&&w===-1)this.fire(new h.j(new Error(`Cannot add layer "${u}" before non-existing layer "${s}".`)));else{if(this._order.splice(w,0,u),this._layerOrderChanged=!0,this._layers[u]=p,this._removedLayers[u]&&p.source&&p.type!=="custom"){const k=this._removedLayers[u];delete this._removedLayers[u],k.type!==p.type?this._updatedSources[p.source]="clear":(this._updatedSources[p.source]="reload",this.sourceCaches[p.source].pause())}this._updateLayer(p),p.onAdd&&p.onAdd(this.map)}}moveLayer(e,s){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new h.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===s)return;const l=this._order.indexOf(e);this._order.splice(l,1);const u=s?this._order.indexOf(s):this._order.length;s&&u===-1?this.fire(new h.j(new Error(`Cannot move layer "${e}" before non-existing layer "${s}".`))):(this._order.splice(u,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const s=this._layers[e];if(!s)return void this.fire(new h.j(new Error(`Cannot remove non-existing layer "${e}".`)));s.setEventedParent(null);const l=this._order.indexOf(e);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=s,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],s.onRemove&&s.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,s,l){this._checkLoaded();const u=this.getLayer(e);u?u.minzoom===s&&u.maxzoom===l||(s!=null&&(u.minzoom=s),l!=null&&(u.maxzoom=l),this._updateLayer(u)):this.fire(new h.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,s,l={}){this._checkLoaded();const u=this.getLayer(e);if(u){if(!h.aE(u.filter,s))return s==null?(u.filter=void 0,void this._updateLayer(u)):void(this._validate(h.u.filter,`layers.${u.id}.filter`,s,null,l)||(u.filter=h.aB(s),this._updateLayer(u)))}else this.fire(new h.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return h.aB(this.getLayer(e).filter)}setLayoutProperty(e,s,l,u={}){this._checkLoaded();const p=this.getLayer(e);p?h.aE(p.getLayoutProperty(s),l)||(p.setLayoutProperty(s,l,u),this._updateLayer(p)):this.fire(new h.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,s){const l=this.getLayer(e);if(l)return l.getLayoutProperty(s);this.fire(new h.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,s,l,u={}){this._checkLoaded();const p=this.getLayer(e);p?h.aE(p.getPaintProperty(s),l)||(p.setPaintProperty(s,l,u)&&this._updateLayer(p),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new h.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,s){return this.getLayer(e).getPaintProperty(s)}setFeatureState(e,s){this._checkLoaded();const l=e.source,u=e.sourceLayer,p=this.sourceCaches[l];if(p===void 0)return void this.fire(new h.j(new Error(`The source '${l}' does not exist in the map's style.`)));const w=p.getSource().type;w==="geojson"&&u?this.fire(new h.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):w!=="vector"||u?(e.id===void 0&&this.fire(new h.j(new Error("The feature id parameter must be provided."))),p.setFeatureState(u,e.id,s)):this.fire(new h.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,s){this._checkLoaded();const l=e.source,u=this.sourceCaches[l];if(u===void 0)return void this.fire(new h.j(new Error(`The source '${l}' does not exist in the map's style.`)));const p=u.getSource().type,w=p==="vector"?e.sourceLayer:void 0;p!=="vector"||w?s&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new h.j(new Error("A feature id is required to remove its specific state property."))):u.removeFeatureState(w,e.id,s):this.fire(new h.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const s=e.source,l=e.sourceLayer,u=this.sourceCaches[s];if(u!==void 0)return u.getSource().type!=="vector"||l?(e.id===void 0&&this.fire(new h.j(new Error("The feature id parameter must be provided."))),u.getFeatureState(l,e.id)):void this.fire(new h.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new h.j(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return h.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=h.aF(this.sourceCaches,(p=>p.serialize())),s=this._serializeByIds(this._order,!0),l=this.map.getTerrain()||void 0,u=this.stylesheet;return h.aG({version:u.version,name:u.name,metadata:u.metadata,light:u.light,sky:u.sky,center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch,sprite:u.sprite,glyphs:u.glyphs,transition:u.transition,sources:e,layers:s,terrain:l},(p=>p!==void 0))}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const s=w=>this._layers[w].type==="fill-extrusion",l={},u=[];for(let w=this._order.length-1;w>=0;w--){const k=this._order[w];if(s(k)){l[k]=w;for(const E of e){const A=E[k];if(A)for(const R of A)u.push(R)}}}u.sort(((w,k)=>k.intersectionZ-w.intersectionZ));const p=[];for(let w=this._order.length-1;w>=0;w--){const k=this._order[w];if(s(k))for(let E=u.length-1;E>=0;E--){const A=u[E].feature;if(l[A.layer.id]<w)break;p.push(A),u.pop()}else for(const E of e){const A=E[k];if(A)for(const R of A)p.push(R.feature)}}return p}queryRenderedFeatures(e,s,l){s&&s.filter&&this._validate(h.u.filter,"queryRenderedFeatures.filter",s.filter,null,s);const u={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new h.j(new Error("parameters.layers must be an Array."))),[];for(const k of s.layers){const E=this._layers[k];if(!E)return this.fire(new h.j(new Error(`The layer '${k}' does not exist in the map's style and cannot be queried for features.`))),[];u[E.source]=!0}}const p=[];s.availableImages=this._availableImages;const w=this._serializedAllLayers();for(const k in this.sourceCaches)s.layers&&!u[k]||p.push(Yi(this.sourceCaches[k],this._layers,w,e,s,l));return this.placement&&p.push((function(k,E,A,R,B,U,G){const W={},J=U.queryRenderedSymbols(R),re=[];for(const se of Object.keys(J).map(Number))re.push(G[se]);re.sort(bs);for(const se of re){const ce=se.featureIndex.lookupSymbolFeatures(J[se.bucketInstanceId],E,se.bucketIndex,se.sourceLayerIndex,B.filter,B.layers,B.availableImages,k);for(const ee in ce){const fe=W[ee]=W[ee]||[],ye=ce[ee];ye.sort(((be,Fe)=>{const Ge=se.featureSortOrder;if(Ge){const Qe=Ge.indexOf(be.featureIndex);return Ge.indexOf(Fe.featureIndex)-Qe}return Fe.featureIndex-be.featureIndex}));for(const be of ye)fe.push(be)}}for(const se in W)W[se].forEach((ce=>{const ee=ce.feature,fe=A[k[se].source].getFeatureState(ee.layer["source-layer"],ee.id);ee.source=ee.layer.source,ee.layer["source-layer"]&&(ee.sourceLayer=ee.layer["source-layer"]),ee.state=fe}));return W})(this._layers,w,this.sourceCaches,e,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(p)}querySourceFeatures(e,s){s&&s.filter&&this._validate(h.u.filter,"querySourceFeatures.filter",s.filter,null,s);const l=this.sourceCaches[e];return l?(function(u,p){const w=u.getRenderableIds().map((A=>u.getTileByID(A))),k=[],E={};for(let A=0;A<w.length;A++){const R=w[A],B=R.tileID.canonical.key;E[B]||(E[B]=!0,R.querySourceFeatures(k,p))}return k})(l,s):[]}getLight(){return this.light.getLight()}setLight(e,s={}){this._checkLoaded();const l=this.light.getLight();let u=!1;for(const w in e)if(!h.aE(e[w],l[w])){u=!0;break}if(!u)return;const p={now:Y.now(),transition:h.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,s),this.light.updateTransitions(p)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,s={}){const l=this.getSky();let u=!1;if(!e&&!l)return;if(e&&!l)u=!0;else if(!e&&l)u=!0;else for(const w in e)if(!h.aE(e[w],l[w])){u=!0;break}if(!u)return;const p={now:Y.now(),transition:h.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,s),this.sky.updateTransitions(p)}_validate(e,s,l,u,p={}){return(!p||p.validate!==!1)&&ti(this,e.call(h.u,h.e({key:s,style:this.serialize(),value:l,styleSpec:h.v},u)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Jn().off(Ke,this._rtlPluginLoaded);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.sourceCaches){const l=this.sourceCaches[s];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const s in this.sourceCaches)this.sourceCaches[s].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,s,l,u,p=!1){let w=!1,k=!1;const E={};for(const A of this._order){const R=this._layers[A];if(R.type!=="symbol")continue;if(!E[R.source]){const U=this.sourceCaches[R.source];E[R.source]=U.getRenderableIds(!0).map((G=>U.getTileByID(G))).sort(((G,W)=>W.tileID.overscaledZ-G.tileID.overscaledZ||(G.tileID.isLessThan(W.tileID)?-1:1)))}const B=this.crossTileSymbolIndex.addLayer(R,E[R.source],e.center.lng);w=w||B}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((p=p||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(Y.now(),e.zoom))&&(this.pauseablePlacement=new rl(e,this.map.terrain,this._order,p,s,l,u,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,E),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(Y.now()),k=!0),w&&this.pauseablePlacement.placement.setStale()),k||w)for(const A of this._order){const R=this._layers[A];R.type==="symbol"&&this.placement.updateLayerOpacities(R,E[R.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(Y.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,s){return h._(this,void 0,void 0,(function*(){const l=yield this.imageManager.getImages(s.icons);this._updateTilesForChangedImages();const u=this.sourceCaches[s.source];return u&&u.setDependencies(s.tileID.key,s.type,s.icons),l}))}getGlyphs(e,s){return h._(this,void 0,void 0,(function*(){const l=yield this.glyphManager.getGlyphs(s.stacks),u=this.sourceCaches[s.source];return u&&u.setDependencies(s.tileID.key,s.type,[""]),l}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,s={}){this._checkLoaded(),e&&this._validate(h.u.glyphs,"glyphs",e,null,s)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,s,l={},u){this._checkLoaded();const p=[{id:e,url:s}],w=[...Ve(this.stylesheet.sprite),...p];this._validate(h.u.sprite,"sprite",w,null,l)||(this.stylesheet.sprite=w,this._loadSprite(p,!0,u))}removeSprite(e){this._checkLoaded();const s=Ve(this.stylesheet.sprite);if(s.find((l=>l.id===e))){if(this._spritesImagesIds[e])for(const l of this._spritesImagesIds[e])this.imageManager.removeImage(l),this._changedImages[l]=!0;s.splice(s.findIndex((l=>l.id===e)),1),this.stylesheet.sprite=s.length>0?s:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.k("data",{dataType:"style"}))}else this.fire(new h.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return Ve(this.stylesheet.sprite)}setSprite(e,s={},l){this._checkLoaded(),e&&this._validate(h.u.sprite,"sprite",e,null,s)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,l):(this._unloadSprite(),l&&l(null)))}}var Vs=h.Y([{name:"a_pos",type:"Int16",components:2}]);const Us={prelude:yr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:yr(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:yr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:yr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:yr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:yr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:yr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:yr("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:yr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:yr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:yr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:yr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:yr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:yr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:yr(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:yr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:yr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:yr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:yr(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:yr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:yr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:yr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:yr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:yr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:yr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:yr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:yr("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:yr("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:yr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:yr("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function yr(f,e){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=e.match(/attribute ([\w]+) ([\w]+)/g),u=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),p=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=p?p.concat(u):u,k={};return{fragmentSource:f=f.replace(s,((E,A,R,B,U)=>(k[U]=!0,A==="define"?`
#ifndef HAS_UNIFORM_u_${U}
varying ${R} ${B} ${U};
#else
uniform ${R} ${B} u_${U};
#endif
`:`
#ifdef HAS_UNIFORM_u_${U}
    ${R} ${B} ${U} = u_${U};
#endif
`))),vertexSource:e=e.replace(s,((E,A,R,B,U)=>{const G=B==="float"?"vec2":"vec4",W=U.match(/color/)?"color":G;return k[U]?A==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
attribute ${R} ${G} a_${U};
varying ${R} ${B} ${U};
#else
uniform ${R} ${B} u_${U};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = a_${U};
#else
    ${R} ${B} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = unpack_mix_${W}(a_${U}, u_${U}_t);
#else
    ${R} ${B} ${U} = u_${U};
#endif
`:A==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
attribute ${R} ${G} a_${U};
#else
uniform ${R} ${B} u_${U};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${R} ${B} ${U} = a_${U};
#else
    ${R} ${B} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    ${R} ${B} ${U} = unpack_mix_${W}(a_${U}, u_${U}_t);
#else
    ${R} ${B} ${U} = u_${U};
#endif
`})),staticAttributes:l,staticUniforms:w}}class Ua{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,s,l,u,p,w,k,E,A){this.context=e;let R=this.boundPaintVertexBuffers.length!==u.length;for(let B=0;!R&&B<u.length;B++)this.boundPaintVertexBuffers[B]!==u[B]&&(R=!0);!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==l||R||this.boundIndexBuffer!==p||this.boundVertexOffset!==w||this.boundDynamicVertexBuffer!==k||this.boundDynamicVertexBuffer2!==E||this.boundDynamicVertexBuffer3!==A?this.freshBind(s,l,u,p,w,k,E,A):(e.bindVertexArray.set(this.vao),k&&k.bind(),p&&p.dynamicDraw&&p.bind(),E&&E.bind(),A&&A.bind())}freshBind(e,s,l,u,p,w,k,E){const A=e.numAttributes,R=this.context,B=R.gl;this.vao&&this.destroy(),this.vao=R.createVertexArray(),R.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=u,this.boundVertexOffset=p,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=k,this.boundDynamicVertexBuffer3=E,s.enableAttributes(B,e);for(const U of l)U.enableAttributes(B,e);w&&w.enableAttributes(B,e),k&&k.enableAttributes(B,e),E&&E.enableAttributes(B,e),s.bind(),s.setVertexAttribPointers(B,e,p);for(const U of l)U.bind(),U.setVertexAttribPointers(B,e,p);w&&(w.bind(),w.setVertexAttribPointers(B,e,p)),u&&u.bind(),k&&(k.bind(),k.setVertexAttribPointers(B,e,p)),E&&(E.bind(),E.setVertexAttribPointers(B,e,p)),R.currentNumAttributes=A}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Du=(f,e,s,l,u)=>({u_matrix:f,u_texture:0,u_ele_delta:e,u_fog_matrix:s,u_fog_color:l?l.properties.get("fog-color"):h.aM.white,u_fog_ground_blend:l?l.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:l?l.calculateFogBlendOpacity(u):0,u_horizon_color:l?l.properties.get("horizon-color"):h.aM.white,u_horizon_fog_blend:l?l.properties.get("horizon-fog-blend"):1});function ga(f){const e=[];for(let s=0;s<f.length;s++){if(f[s]===null)continue;const l=f[s].split(" ");e.push(l.pop())}return e}class Sr{constructor(e,s,l,u,p,w){const k=e.gl;this.program=k.createProgram();const E=ga(s.staticAttributes),A=l?l.getBinderAttributes():[],R=E.concat(A),B=Us.prelude.staticUniforms?ga(Us.prelude.staticUniforms):[],U=s.staticUniforms?ga(s.staticUniforms):[],G=l?l.getBinderUniforms():[],W=B.concat(U).concat(G),J=[];for(const be of W)J.indexOf(be)<0&&J.push(be);const re=l?l.defines():[];p&&re.push("#define OVERDRAW_INSPECTOR;"),w&&re.push("#define TERRAIN3D;");const se=re.concat(Us.prelude.fragmentSource,s.fragmentSource).join(`
`),ce=re.concat(Us.prelude.vertexSource,s.vertexSource).join(`
`),ee=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);if(k.shaderSource(ee,se),k.compileShader(ee),!k.getShaderParameter(ee,k.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${k.getShaderInfoLog(ee)}`);k.attachShader(this.program,ee);const fe=k.createShader(k.VERTEX_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);if(k.shaderSource(fe,ce),k.compileShader(fe),!k.getShaderParameter(fe,k.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${k.getShaderInfoLog(fe)}`);k.attachShader(this.program,fe),this.attributes={};const ye={};this.numAttributes=R.length;for(let be=0;be<this.numAttributes;be++)R[be]&&(k.bindAttribLocation(this.program,be,R[be]),this.attributes[R[be]]=be);if(k.linkProgram(this.program),!k.getProgramParameter(this.program,k.LINK_STATUS))throw new Error(`Program failed to link: ${k.getProgramInfoLog(this.program)}`);k.deleteShader(fe),k.deleteShader(ee);for(let be=0;be<J.length;be++){const Fe=J[be];if(Fe&&!ye[Fe]){const Ge=k.getUniformLocation(this.program,Fe);Ge&&(ye[Fe]=Ge)}}this.fixedUniforms=u(e,ye),this.terrainUniforms=((be,Fe)=>({u_depth:new h.aH(be,Fe.u_depth),u_terrain:new h.aH(be,Fe.u_terrain),u_terrain_dim:new h.aI(be,Fe.u_terrain_dim),u_terrain_matrix:new h.aJ(be,Fe.u_terrain_matrix),u_terrain_unpack:new h.aK(be,Fe.u_terrain_unpack),u_terrain_exaggeration:new h.aI(be,Fe.u_terrain_exaggeration)}))(e,ye),this.binderUniforms=l?l.getUniforms(e,ye):[]}draw(e,s,l,u,p,w,k,E,A,R,B,U,G,W,J,re,se,ce){const ee=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(l),e.setStencilMode(u),e.setColorMode(p),e.setCullFace(w),E){e.activeTexture.set(ee.TEXTURE2),ee.bindTexture(ee.TEXTURE_2D,E.depthTexture),e.activeTexture.set(ee.TEXTURE3),ee.bindTexture(ee.TEXTURE_2D,E.texture);for(const ye in this.terrainUniforms)this.terrainUniforms[ye].set(E[ye])}for(const ye in this.fixedUniforms)this.fixedUniforms[ye].set(k[ye]);J&&J.setUniforms(e,this.binderUniforms,G,{zoom:W});let fe=0;switch(s){case ee.LINES:fe=2;break;case ee.TRIANGLES:fe=3;break;case ee.LINE_STRIP:fe=1}for(const ye of U.get()){const be=ye.vaos||(ye.vaos={});(be[A]||(be[A]=new Ua)).bind(e,this,R,J?J.getPaintVertexBuffers():[],B,ye.vertexOffset,re,se,ce),ee.drawElements(s,ye.primitiveLength*fe,ee.UNSIGNED_SHORT,ye.primitiveOffset*fe*2)}}}function nl(f,e,s){const l=1/Wt(s,1,e.transform.tileZoom),u=Math.pow(2,s.tileID.overscaledZ),p=s.tileSize*Math.pow(2,e.transform.tileZoom)/u,w=p*(s.tileID.canonical.x+s.tileID.wrap*u),k=p*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[l,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[w>>16,k>>16],u_pixel_coord_lower:[65535&w,65535&k]}}const fo=(f,e,s,l)=>{const u=e.style.light,p=u.properties.get("position"),w=[p.x,p.y,p.z],k=(function(){var A=new h.A(9);return h.A!=Float32Array&&(A[1]=0,A[2]=0,A[3]=0,A[5]=0,A[6]=0,A[7]=0),A[0]=1,A[4]=1,A[8]=1,A})();u.properties.get("anchor")==="viewport"&&(function(A,R){var B=Math.sin(R),U=Math.cos(R);A[0]=U,A[1]=B,A[2]=0,A[3]=-B,A[4]=U,A[5]=0,A[6]=0,A[7]=0,A[8]=1})(k,-e.transform.angle),(function(A,R,B){var U=R[0],G=R[1],W=R[2];A[0]=U*B[0]+G*B[3]+W*B[6],A[1]=U*B[1]+G*B[4]+W*B[7],A[2]=U*B[2]+G*B[5]+W*B[8]})(w,w,k);const E=u.properties.get("color");return{u_matrix:f,u_lightpos:w,u_lightintensity:u.properties.get("intensity"),u_lightcolor:[E.r,E.g,E.b],u_vertical_gradient:+s,u_opacity:l}},mo=(f,e,s,l,u,p,w)=>h.e(fo(f,e,s,l),nl(p,e,w),{u_height_factor:-Math.pow(2,u.overscaledZ)/w.tileSize/8}),$a=f=>({u_matrix:f}),Lu=(f,e,s,l)=>h.e($a(f),nl(s,e,l)),qc=(f,e)=>({u_matrix:f,u_world:e}),ql=(f,e,s,l,u)=>h.e(Lu(f,e,s,l),{u_world:u}),Zl=(f,e,s,l)=>{const u=f.transform;let p,w;if(l.paint.get("circle-pitch-alignment")==="map"){const k=Wt(s,1,u.zoom);p=!0,w=[k,k]}else p=!1,w=u.pixelsToGLUnits;return{u_camera_to_center_distance:u.cameraToCenterDistance,u_scale_with_map:+(l.paint.get("circle-pitch-scale")==="map"),u_matrix:f.translatePosMatrix(e.posMatrix,s,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_pitch_with_map:+p,u_device_pixel_ratio:f.pixelRatio,u_extrude_scale:w}},ri=(f,e,s)=>({u_matrix:f,u_inv_matrix:e,u_camera_to_center_distance:s.cameraToCenterDistance,u_viewport_size:[s.width,s.height]}),zi=(f,e,s=1)=>({u_matrix:f,u_color:e,u_overlay:0,u_overlay_scale:s}),on=f=>({u_matrix:f}),kn=(f,e,s,l)=>({u_matrix:f,u_extrude_scale:Wt(e,1,s),u_intensity:l}),ya=(f,e,s,l)=>{const u=h.H();h.aP(u,0,f.width,f.height,0,0,1);const p=f.context.gl;return{u_matrix:u,u_world:[p.drawingBufferWidth,p.drawingBufferHeight],u_image:s,u_color_ramp:l,u_opacity:e.paint.get("heatmap-opacity")}};function ts(f,e){const s=Math.pow(2,e.canonical.z),l=e.canonical.y;return[new h.Z(0,l/s).toLngLat().lat,new h.Z(0,(l+1)/s).toLngLat().lat]}const Gl=(f,e,s,l)=>{const u=f.transform;return{u_matrix:il(f,e,s,l),u_ratio:1/Wt(e,1,u.zoom),u_device_pixel_ratio:f.pixelRatio,u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]]}},Ru=(f,e,s,l,u)=>h.e(Gl(f,e,s,u),{u_image:0,u_image_height:l}),Is=(f,e,s,l,u)=>{const p=f.transform,w=Bu(e,p);return{u_matrix:il(f,e,s,u),u_texsize:e.imageAtlasTexture.size,u_ratio:1/Wt(e,1,p.zoom),u_device_pixel_ratio:f.pixelRatio,u_image:0,u_scale:[w,l.fromScale,l.toScale],u_fade:l.t,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},ed=(f,e,s,l,u,p)=>{const w=f.lineAtlas,k=Bu(e,f.transform),E=s.layout.get("line-cap")==="round",A=w.getDash(l.from,E),R=w.getDash(l.to,E),B=A.width*u.fromScale,U=R.width*u.toScale;return h.e(Gl(f,e,s,p),{u_patternscale_a:[k/B,-A.height/2],u_patternscale_b:[k/U,-R.height/2],u_sdfgamma:w.width/(256*Math.min(B,U)*f.pixelRatio)/2,u_image:0,u_tex_y_a:A.y,u_tex_y_b:R.y,u_mix:u.t})};function Bu(f,e){return 1/Wt(f,1,e.tileZoom)}function il(f,e,s,l){return f.translatePosMatrix(l?l.posMatrix:e.tileID.posMatrix,e,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const Zc=(f,e,s,l,u)=>{return{u_matrix:f,u_tl_parent:e,u_scale_parent:s,u_buffer_scale:1,u_fade_t:l.mix,u_opacity:l.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:(w=u.paint.get("raster-saturation"),w>0?1-1/(1.001-w):-w),u_contrast_factor:(p=u.paint.get("raster-contrast"),p>0?1/(1-p):1+p),u_spin_weights:td(u.paint.get("raster-hue-rotate"))};var p,w};function td(f){f*=Math.PI/180;const e=Math.sin(f),s=Math.cos(f);return[(2*s+1)/3,(-Math.sqrt(3)*e-s+1)/3,(Math.sqrt(3)*e-s+1)/3]}const go=(f,e,s,l,u,p,w,k,E,A,R,B,U,G)=>{const W=w.transform;return{u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:W.cameraToCenterDistance,u_pitch:W.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:W.width/W.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_matrix:k,u_label_plane_matrix:E,u_coord_matrix:A,u_is_text:+B,u_pitch_with_map:+l,u_is_along_line:u,u_is_variable_anchor:p,u_texsize:U,u_texture:0,u_translation:R,u_pitched_scale:G}},$s=(f,e,s,l,u,p,w,k,E,A,R,B,U,G,W)=>{const J=w.transform;return h.e(go(f,e,s,l,u,p,w,k,E,A,R,B,U,W),{u_gamma_scale:l?Math.cos(J._pitch)*J.cameraToCenterDistance:1,u_device_pixel_ratio:w.pixelRatio,u_is_halo:1})},_a=(f,e,s,l,u,p,w,k,E,A,R,B,U,G)=>h.e($s(f,e,s,l,u,p,w,k,E,A,R,!0,B,!0,G),{u_texsize_icon:U,u_texture_icon:1}),qa=(f,e,s)=>({u_matrix:f,u_opacity:e,u_color:s}),Fu=(f,e,s,l,u,p)=>h.e((function(w,k,E,A){const R=E.imageManager.getPattern(w.from.toString()),B=E.imageManager.getPattern(w.to.toString()),{width:U,height:G}=E.imageManager.getPixelSize(),W=Math.pow(2,A.tileID.overscaledZ),J=A.tileSize*Math.pow(2,E.transform.tileZoom)/W,re=J*(A.tileID.canonical.x+A.tileID.wrap*W),se=J*A.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:R.tl,u_pattern_br_a:R.br,u_pattern_tl_b:B.tl,u_pattern_br_b:B.br,u_texsize:[U,G],u_mix:k.t,u_pattern_size_a:R.displaySize,u_pattern_size_b:B.displaySize,u_scale_a:k.fromScale,u_scale_b:k.toScale,u_tile_units_to_pixels:1/Wt(A,1,E.transform.tileZoom),u_pixel_coord_upper:[re>>16,se>>16],u_pixel_coord_lower:[65535&re,65535&se]}})(l,p,s,u),{u_matrix:f,u_opacity:e}),Ou={fillExtrusion:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_lightpos:new h.aN(f,e.u_lightpos),u_lightintensity:new h.aI(f,e.u_lightintensity),u_lightcolor:new h.aN(f,e.u_lightcolor),u_vertical_gradient:new h.aI(f,e.u_vertical_gradient),u_opacity:new h.aI(f,e.u_opacity)}),fillExtrusionPattern:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_lightpos:new h.aN(f,e.u_lightpos),u_lightintensity:new h.aI(f,e.u_lightintensity),u_lightcolor:new h.aN(f,e.u_lightcolor),u_vertical_gradient:new h.aI(f,e.u_vertical_gradient),u_height_factor:new h.aI(f,e.u_height_factor),u_image:new h.aH(f,e.u_image),u_texsize:new h.aO(f,e.u_texsize),u_pixel_coord_upper:new h.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new h.aO(f,e.u_pixel_coord_lower),u_scale:new h.aN(f,e.u_scale),u_fade:new h.aI(f,e.u_fade),u_opacity:new h.aI(f,e.u_opacity)}),fill:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix)}),fillPattern:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_image:new h.aH(f,e.u_image),u_texsize:new h.aO(f,e.u_texsize),u_pixel_coord_upper:new h.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new h.aO(f,e.u_pixel_coord_lower),u_scale:new h.aN(f,e.u_scale),u_fade:new h.aI(f,e.u_fade)}),fillOutline:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_world:new h.aO(f,e.u_world)}),fillOutlinePattern:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_world:new h.aO(f,e.u_world),u_image:new h.aH(f,e.u_image),u_texsize:new h.aO(f,e.u_texsize),u_pixel_coord_upper:new h.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new h.aO(f,e.u_pixel_coord_lower),u_scale:new h.aN(f,e.u_scale),u_fade:new h.aI(f,e.u_fade)}),circle:(f,e)=>({u_camera_to_center_distance:new h.aI(f,e.u_camera_to_center_distance),u_scale_with_map:new h.aH(f,e.u_scale_with_map),u_pitch_with_map:new h.aH(f,e.u_pitch_with_map),u_extrude_scale:new h.aO(f,e.u_extrude_scale),u_device_pixel_ratio:new h.aI(f,e.u_device_pixel_ratio),u_matrix:new h.aJ(f,e.u_matrix)}),collisionBox:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_pixel_extrude_scale:new h.aO(f,e.u_pixel_extrude_scale)}),collisionCircle:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_inv_matrix:new h.aJ(f,e.u_inv_matrix),u_camera_to_center_distance:new h.aI(f,e.u_camera_to_center_distance),u_viewport_size:new h.aO(f,e.u_viewport_size)}),debug:(f,e)=>({u_color:new h.aL(f,e.u_color),u_matrix:new h.aJ(f,e.u_matrix),u_overlay:new h.aH(f,e.u_overlay),u_overlay_scale:new h.aI(f,e.u_overlay_scale)}),clippingMask:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix)}),heatmap:(f,e)=>({u_extrude_scale:new h.aI(f,e.u_extrude_scale),u_intensity:new h.aI(f,e.u_intensity),u_matrix:new h.aJ(f,e.u_matrix)}),heatmapTexture:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_world:new h.aO(f,e.u_world),u_image:new h.aH(f,e.u_image),u_color_ramp:new h.aH(f,e.u_color_ramp),u_opacity:new h.aI(f,e.u_opacity)}),hillshade:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_image:new h.aH(f,e.u_image),u_latrange:new h.aO(f,e.u_latrange),u_light:new h.aO(f,e.u_light),u_shadow:new h.aL(f,e.u_shadow),u_highlight:new h.aL(f,e.u_highlight),u_accent:new h.aL(f,e.u_accent)}),hillshadePrepare:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_image:new h.aH(f,e.u_image),u_dimension:new h.aO(f,e.u_dimension),u_zoom:new h.aI(f,e.u_zoom),u_unpack:new h.aK(f,e.u_unpack)}),line:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_ratio:new h.aI(f,e.u_ratio),u_device_pixel_ratio:new h.aI(f,e.u_device_pixel_ratio),u_units_to_pixels:new h.aO(f,e.u_units_to_pixels)}),lineGradient:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_ratio:new h.aI(f,e.u_ratio),u_device_pixel_ratio:new h.aI(f,e.u_device_pixel_ratio),u_units_to_pixels:new h.aO(f,e.u_units_to_pixels),u_image:new h.aH(f,e.u_image),u_image_height:new h.aI(f,e.u_image_height)}),linePattern:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_texsize:new h.aO(f,e.u_texsize),u_ratio:new h.aI(f,e.u_ratio),u_device_pixel_ratio:new h.aI(f,e.u_device_pixel_ratio),u_image:new h.aH(f,e.u_image),u_units_to_pixels:new h.aO(f,e.u_units_to_pixels),u_scale:new h.aN(f,e.u_scale),u_fade:new h.aI(f,e.u_fade)}),lineSDF:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_ratio:new h.aI(f,e.u_ratio),u_device_pixel_ratio:new h.aI(f,e.u_device_pixel_ratio),u_units_to_pixels:new h.aO(f,e.u_units_to_pixels),u_patternscale_a:new h.aO(f,e.u_patternscale_a),u_patternscale_b:new h.aO(f,e.u_patternscale_b),u_sdfgamma:new h.aI(f,e.u_sdfgamma),u_image:new h.aH(f,e.u_image),u_tex_y_a:new h.aI(f,e.u_tex_y_a),u_tex_y_b:new h.aI(f,e.u_tex_y_b),u_mix:new h.aI(f,e.u_mix)}),raster:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_tl_parent:new h.aO(f,e.u_tl_parent),u_scale_parent:new h.aI(f,e.u_scale_parent),u_buffer_scale:new h.aI(f,e.u_buffer_scale),u_fade_t:new h.aI(f,e.u_fade_t),u_opacity:new h.aI(f,e.u_opacity),u_image0:new h.aH(f,e.u_image0),u_image1:new h.aH(f,e.u_image1),u_brightness_low:new h.aI(f,e.u_brightness_low),u_brightness_high:new h.aI(f,e.u_brightness_high),u_saturation_factor:new h.aI(f,e.u_saturation_factor),u_contrast_factor:new h.aI(f,e.u_contrast_factor),u_spin_weights:new h.aN(f,e.u_spin_weights)}),symbolIcon:(f,e)=>({u_is_size_zoom_constant:new h.aH(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new h.aH(f,e.u_is_size_feature_constant),u_size_t:new h.aI(f,e.u_size_t),u_size:new h.aI(f,e.u_size),u_camera_to_center_distance:new h.aI(f,e.u_camera_to_center_distance),u_pitch:new h.aI(f,e.u_pitch),u_rotate_symbol:new h.aH(f,e.u_rotate_symbol),u_aspect_ratio:new h.aI(f,e.u_aspect_ratio),u_fade_change:new h.aI(f,e.u_fade_change),u_matrix:new h.aJ(f,e.u_matrix),u_label_plane_matrix:new h.aJ(f,e.u_label_plane_matrix),u_coord_matrix:new h.aJ(f,e.u_coord_matrix),u_is_text:new h.aH(f,e.u_is_text),u_pitch_with_map:new h.aH(f,e.u_pitch_with_map),u_is_along_line:new h.aH(f,e.u_is_along_line),u_is_variable_anchor:new h.aH(f,e.u_is_variable_anchor),u_texsize:new h.aO(f,e.u_texsize),u_texture:new h.aH(f,e.u_texture),u_translation:new h.aO(f,e.u_translation),u_pitched_scale:new h.aI(f,e.u_pitched_scale)}),symbolSDF:(f,e)=>({u_is_size_zoom_constant:new h.aH(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new h.aH(f,e.u_is_size_feature_constant),u_size_t:new h.aI(f,e.u_size_t),u_size:new h.aI(f,e.u_size),u_camera_to_center_distance:new h.aI(f,e.u_camera_to_center_distance),u_pitch:new h.aI(f,e.u_pitch),u_rotate_symbol:new h.aH(f,e.u_rotate_symbol),u_aspect_ratio:new h.aI(f,e.u_aspect_ratio),u_fade_change:new h.aI(f,e.u_fade_change),u_matrix:new h.aJ(f,e.u_matrix),u_label_plane_matrix:new h.aJ(f,e.u_label_plane_matrix),u_coord_matrix:new h.aJ(f,e.u_coord_matrix),u_is_text:new h.aH(f,e.u_is_text),u_pitch_with_map:new h.aH(f,e.u_pitch_with_map),u_is_along_line:new h.aH(f,e.u_is_along_line),u_is_variable_anchor:new h.aH(f,e.u_is_variable_anchor),u_texsize:new h.aO(f,e.u_texsize),u_texture:new h.aH(f,e.u_texture),u_gamma_scale:new h.aI(f,e.u_gamma_scale),u_device_pixel_ratio:new h.aI(f,e.u_device_pixel_ratio),u_is_halo:new h.aH(f,e.u_is_halo),u_translation:new h.aO(f,e.u_translation),u_pitched_scale:new h.aI(f,e.u_pitched_scale)}),symbolTextAndIcon:(f,e)=>({u_is_size_zoom_constant:new h.aH(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new h.aH(f,e.u_is_size_feature_constant),u_size_t:new h.aI(f,e.u_size_t),u_size:new h.aI(f,e.u_size),u_camera_to_center_distance:new h.aI(f,e.u_camera_to_center_distance),u_pitch:new h.aI(f,e.u_pitch),u_rotate_symbol:new h.aH(f,e.u_rotate_symbol),u_aspect_ratio:new h.aI(f,e.u_aspect_ratio),u_fade_change:new h.aI(f,e.u_fade_change),u_matrix:new h.aJ(f,e.u_matrix),u_label_plane_matrix:new h.aJ(f,e.u_label_plane_matrix),u_coord_matrix:new h.aJ(f,e.u_coord_matrix),u_is_text:new h.aH(f,e.u_is_text),u_pitch_with_map:new h.aH(f,e.u_pitch_with_map),u_is_along_line:new h.aH(f,e.u_is_along_line),u_is_variable_anchor:new h.aH(f,e.u_is_variable_anchor),u_texsize:new h.aO(f,e.u_texsize),u_texsize_icon:new h.aO(f,e.u_texsize_icon),u_texture:new h.aH(f,e.u_texture),u_texture_icon:new h.aH(f,e.u_texture_icon),u_gamma_scale:new h.aI(f,e.u_gamma_scale),u_device_pixel_ratio:new h.aI(f,e.u_device_pixel_ratio),u_is_halo:new h.aH(f,e.u_is_halo),u_translation:new h.aO(f,e.u_translation),u_pitched_scale:new h.aI(f,e.u_pitched_scale)}),background:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_opacity:new h.aI(f,e.u_opacity),u_color:new h.aL(f,e.u_color)}),backgroundPattern:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_opacity:new h.aI(f,e.u_opacity),u_image:new h.aH(f,e.u_image),u_pattern_tl_a:new h.aO(f,e.u_pattern_tl_a),u_pattern_br_a:new h.aO(f,e.u_pattern_br_a),u_pattern_tl_b:new h.aO(f,e.u_pattern_tl_b),u_pattern_br_b:new h.aO(f,e.u_pattern_br_b),u_texsize:new h.aO(f,e.u_texsize),u_mix:new h.aI(f,e.u_mix),u_pattern_size_a:new h.aO(f,e.u_pattern_size_a),u_pattern_size_b:new h.aO(f,e.u_pattern_size_b),u_scale_a:new h.aI(f,e.u_scale_a),u_scale_b:new h.aI(f,e.u_scale_b),u_pixel_coord_upper:new h.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new h.aO(f,e.u_pixel_coord_lower),u_tile_units_to_pixels:new h.aI(f,e.u_tile_units_to_pixels)}),terrain:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_texture:new h.aH(f,e.u_texture),u_ele_delta:new h.aI(f,e.u_ele_delta),u_fog_matrix:new h.aJ(f,e.u_fog_matrix),u_fog_color:new h.aL(f,e.u_fog_color),u_fog_ground_blend:new h.aI(f,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new h.aI(f,e.u_fog_ground_blend_opacity),u_horizon_color:new h.aL(f,e.u_horizon_color),u_horizon_fog_blend:new h.aI(f,e.u_horizon_fog_blend)}),terrainDepth:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_ele_delta:new h.aI(f,e.u_ele_delta)}),terrainCoords:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_texture:new h.aH(f,e.u_texture),u_terrain_coords_id:new h.aI(f,e.u_terrain_coords_id),u_ele_delta:new h.aI(f,e.u_ele_delta)}),sky:(f,e)=>({u_sky_color:new h.aL(f,e.u_sky_color),u_horizon_color:new h.aL(f,e.u_horizon_color),u_horizon:new h.aI(f,e.u_horizon),u_sky_horizon_blend:new h.aI(f,e.u_sky_horizon_blend)})};class Di{constructor(e,s,l){this.context=e;const u=e.gl;this.buffer=u.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?u.DYNAMIC_DRAW:u.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Hl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class sl{constructor(e,s,l,u){this.length=s.length,this.attributes=l,this.itemSize=s.bytesPerElement,this.dynamicDraw=u,this.context=e;const p=e.gl;this.buffer=p.createBuffer(),e.bindVertexBuffer.set(this.buffer),p.bufferData(p.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,s){for(let l=0;l<this.attributes.length;l++){const u=s.attributes[this.attributes[l].name];u!==void 0&&e.enableVertexAttribArray(u)}}setVertexAttribPointers(e,s,l){for(let u=0;u<this.attributes.length;u++){const p=this.attributes[u],w=s.attributes[p.name];w!==void 0&&e.vertexAttribPointer(w,p.components,e[Hl[p.type]],!1,this.itemSize,p.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const va=new WeakMap;function Zn(f){var e;if(va.has(f))return va.get(f);{const s=(e=f.getParameter(f.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return va.set(f,s),s}}class _r{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Za extends _r{getDefault(){return h.aM.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Gc extends _r{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class qs extends _r{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Kl extends _r{getDefault(){return[!0,!0,!0,!0]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Nu extends _r{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class vi extends _r{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Ga extends _r{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const s=this.current;(e.func!==s.func||e.ref!==s.ref||e.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class al extends _r{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class yo extends _r{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=e,this.dirty=!1}}class Hc extends _r{getDefault(){return[0,1]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Wl extends _r{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=e,this.dirty=!1}}class Xl extends _r{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class rs extends _r{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.BLEND):s.disable(s.BLEND),this.current=e,this.dirty=!1}}class ol extends _r{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Kc extends _r{getDefault(){return h.aM.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Wc extends _r{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class ll extends _r{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=e,this.dirty=!1}}class rd extends _r{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class _o extends _r{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class nd extends _r{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class id extends _r{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Xc extends _r{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Yc extends _r{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Jc extends _r{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Yl extends _r{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Qc extends _r{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Jl extends _r{getDefault(){return null}set(e){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Zs extends _r{getDefault(){return null}set(e){var s;if(e===this.current&&!this.dirty)return;const l=this.gl;Zn(l)?l.bindVertexArray(e):(s=l.getExtension("OES_vertex_array_object"))===null||s===void 0||s.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class ju extends _r{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class ul extends _r{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Vu extends _r{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Ql extends _r{constructor(e,s){super(e),this.context=e,this.parent=s}getDefault(){return null}}class Uu extends Ql{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class xa extends Ql{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class $u extends Ql{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class sd{constructor(e,s,l,u,p){this.context=e,this.width=s,this.height=l;const w=e.gl,k=this.framebuffer=w.createFramebuffer();if(this.colorAttachment=new Uu(e,k),u)this.depthAttachment=p?new $u(e,k):new xa(e,k);else if(p)throw new Error("Stencil cannot be set without depth");if(w.checkFramebufferStatus(w.FRAMEBUFFER)!==w.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,s=this.colorAttachment.get();if(s&&e.deleteTexture(s),this.depthAttachment){const l=this.depthAttachment.get();l&&e.deleteRenderbuffer(l)}e.deleteFramebuffer(this.framebuffer)}}class tn{constructor(e,s,l){this.blendFunction=e,this.blendColor=s,this.mask=l}}tn.Replace=[1,0],tn.disabled=new tn(tn.Replace,h.aM.transparent,[!1,!1,!1,!1]),tn.unblended=new tn(tn.Replace,h.aM.transparent,[!0,!0,!0,!0]),tn.alphaBlended=new tn([1,771],h.aM.transparent,[!0,!0,!0,!0]);class ad{constructor(e){var s,l;if(this.gl=e,this.clearColor=new Za(this),this.clearDepth=new Gc(this),this.clearStencil=new qs(this),this.colorMask=new Kl(this),this.depthMask=new Nu(this),this.stencilMask=new vi(this),this.stencilFunc=new Ga(this),this.stencilOp=new al(this),this.stencilTest=new yo(this),this.depthRange=new Hc(this),this.depthTest=new Wl(this),this.depthFunc=new Xl(this),this.blend=new rs(this),this.blendFunc=new ol(this),this.blendColor=new Kc(this),this.blendEquation=new Wc(this),this.cullFace=new ll(this),this.cullFaceSide=new rd(this),this.frontFace=new _o(this),this.program=new nd(this),this.activeTexture=new id(this),this.viewport=new Xc(this),this.bindFramebuffer=new Yc(this),this.bindRenderbuffer=new Jc(this),this.bindTexture=new Yl(this),this.bindVertexBuffer=new Qc(this),this.bindElementBuffer=new Jl(this),this.bindVertexArray=new Zs(this),this.pixelStoreUnpack=new ju(this),this.pixelStoreUnpackPremultiplyAlpha=new ul(this),this.pixelStoreUnpackFlipY=new Vu(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),Zn(e)){this.HALF_FLOAT=e.HALF_FLOAT;const u=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(s=e.RGBA16F)!==null&&s!==void 0?s:u==null?void 0:u.RGBA16F_EXT,this.RGB16F=(l=e.RGB16F)!==null&&l!==void 0?l:u==null?void 0:u.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const u=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=u==null?void 0:u.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,s){return new Di(this,e,s)}createVertexBuffer(e,s,l){return new sl(this,e,s,l)}createRenderbuffer(e,s,l){const u=this.gl,p=u.createRenderbuffer();return this.bindRenderbuffer.set(p),u.renderbufferStorage(u.RENDERBUFFER,e,s,l),this.bindRenderbuffer.set(null),p}createFramebuffer(e,s,l,u){return new sd(this,e,s,l,u)}clear({color:e,depth:s,stencil:l}){const u=this.gl;let p=0;e&&(p|=u.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(p|=u.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),l!==void 0&&(p|=u.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),u.clear(p)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){h.aE(e.blendFunction,tn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return Zn(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var s;return Zn(this.gl)?this.gl.deleteVertexArray(e):(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class sr{constructor(e,s,l){this.func=e,this.mask=s,this.range=l}}sr.ReadOnly=!1,sr.ReadWrite=!0,sr.disabled=new sr(519,sr.ReadOnly,[0,1]);const eu=7680;class Lr{constructor(e,s,l,u,p,w){this.test=e,this.ref=s,this.mask=l,this.fail=u,this.depthFail=p,this.pass=w}}Lr.disabled=new Lr({func:519,mask:0},0,0,eu,eu,eu);class kr{constructor(e,s,l){this.enable=e,this.mode=s,this.frontFace=l}}let ns;function cl(f,e,s,l,u){const p=f.context,w=p.gl,k=f.useProgram("collisionBox"),E=[];let A=0,R=0;for(let se=0;se<l.length;se++){const ce=l[se],ee=e.getTile(ce).getBucket(s);if(!ee)continue;const fe=u?ee.textCollisionBox:ee.iconCollisionBox,ye=ee.collisionCircleArray;if(ye.length>0){const be=h.H();h.aQ(be,ee.placementInvProjMatrix,f.transform.glCoordMatrix),h.aQ(be,be,ee.placementViewportMatrix),E.push({circleArray:ye,circleOffset:R,transform:ce.posMatrix,invTransform:be,coord:ce}),A+=ye.length/4,R=A}fe&&k.draw(p,w.LINES,sr.disabled,Lr.disabled,f.colorModeForRenderPass(),kr.disabled,{u_matrix:ce.posMatrix,u_pixel_extrude_scale:[1/(B=f.transform).width,1/B.height]},f.style.map.terrain&&f.style.map.terrain.getTerrainData(ce),s.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,null,f.transform.zoom,null,null,fe.collisionVertexBuffer)}var B;if(!u||!E.length)return;const U=f.useProgram("collisionCircle"),G=new h.aR;G.resize(4*A),G._trim();let W=0;for(const se of E)for(let ce=0;ce<se.circleArray.length/4;ce++){const ee=4*ce,fe=se.circleArray[ee+0],ye=se.circleArray[ee+1],be=se.circleArray[ee+2],Fe=se.circleArray[ee+3];G.emplace(W++,fe,ye,be,Fe,0),G.emplace(W++,fe,ye,be,Fe,1),G.emplace(W++,fe,ye,be,Fe,2),G.emplace(W++,fe,ye,be,Fe,3)}(!ns||ns.length<2*A)&&(ns=(function(se){const ce=2*se,ee=new h.aT;ee.resize(ce),ee._trim();for(let fe=0;fe<ce;fe++){const ye=6*fe;ee.uint16[ye+0]=4*fe+0,ee.uint16[ye+1]=4*fe+1,ee.uint16[ye+2]=4*fe+2,ee.uint16[ye+3]=4*fe+2,ee.uint16[ye+4]=4*fe+3,ee.uint16[ye+5]=4*fe+0}return ee})(A));const J=p.createIndexBuffer(ns,!0),re=p.createVertexBuffer(G,h.aS.members,!0);for(const se of E){const ce=ri(se.transform,se.invTransform,f.transform);U.draw(p,w.TRIANGLES,sr.disabled,Lr.disabled,f.colorModeForRenderPass(),kr.disabled,ce,f.style.map.terrain&&f.style.map.terrain.getTerrainData(se.coord),s.id,re,J,h.a0.simpleSegment(0,2*se.circleOffset,se.circleArray.length,se.circleArray.length/2),null,f.transform.zoom,null,null,null)}re.destroy(),J.destroy()}kr.disabled=new kr(!1,1029,2305),kr.backCCW=new kr(!0,1029,2305);const vo=h.an(new Float32Array(16));function tu(f,e,s,l,u,p){const{horizontalAlign:w,verticalAlign:k}=h.au(f);return new h.P((-(w-.5)*e/u+l[0])*p,(-(k-.5)*s/u+l[1])*p)}function wa(f,e,s,l,u,p){const w=e.tileAnchorPoint.add(new h.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let k=l.mult(p);s||(k=k.rotate(-u));const E=w.add(k);return ie(E.x,E.y,e.labelPlaneMatrix,e.getElevation).point}if(s){const k=Me(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(f),E=Math.atan(k.y/k.x)+(k.x<0?Math.PI:0);return f.add(l.rotate(E))}return f.add(l)}function Ha(f,e,s,l,u,p,w,k,E,A,R,B,U,G){const W=f.text.placedSymbolArray,J=f.text.dynamicLayoutVertexArray,re=f.icon.dynamicLayoutVertexArray,se={};J.clear();for(let ce=0;ce<W.length;ce++){const ee=W.get(ce),fe=ee.hidden||!ee.crossTileID||f.allowVerticalPlacement&&!ee.placedOrientation?null:l[ee.crossTileID];if(fe){const ye=new h.P(ee.anchorX,ee.anchorY),be={getElevation:G,width:u.width,height:u.height,labelPlaneMatrix:p,pitchWithMap:s,projection:R,tileAnchorPoint:ye,translation:B,unwrappedTileID:U},Fe=s?ie(ye.x,ye.y,w,G):Me(ye.x,ye.y,be),Ge=j(u.cameraToCenterDistance,Fe.signedDistanceFromCamera);let Qe=h.ai(f.textSizeData,E,ee)*Ge/h.ap;s&&(Qe*=f.tilePixelRatio/k);const{width:ct,height:tt,anchor:Xe,textOffset:_t,textBoxScale:Nt}=fe,nt=tu(Xe,ct,tt,_t,Nt,Qe),st=R.getPitchedTextCorrection(u,ye.add(new h.P(B[0],B[1])),U),Ot=wa(Fe.point,be,e,nt,u.angle,st),Pr=f.allowVerticalPlacement&&ee.placedOrientation===h.ah.vertical?Math.PI/2:0;for(let Gt=0;Gt<ee.numGlyphs;Gt++)h.aj(J,Ot,Pr);A&&ee.associatedIconIndex>=0&&(se[ee.associatedIconIndex]={shiftedAnchor:Ot,angle:Pr})}else Ct(ee.numGlyphs,J)}if(A){re.clear();const ce=f.icon.placedSymbolArray;for(let ee=0;ee<ce.length;ee++){const fe=ce.get(ee);if(fe.hidden)Ct(fe.numGlyphs,re);else{const ye=se[ee];if(ye)for(let be=0;be<fe.numGlyphs;be++)h.aj(re,ye.shiftedAnchor,ye.angle);else Ct(fe.numGlyphs,re)}}f.icon.dynamicLayoutVertexBuffer.updateData(re)}f.text.dynamicLayoutVertexBuffer.updateData(J)}function xi(f,e,s){return s.iconsInText&&e?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function ba(f,e,s,l,u,p,w,k,E,A,R,B){const U=f.context,G=U.gl,W=f.transform,J=Na(),re=k==="map",se=E==="map",ce=k!=="viewport"&&s.layout.get("symbol-placement")!=="point",ee=re&&!se&&!ce,fe=!se&&ce,ye=!s.layout.get("symbol-sort-key").isConstant();let be=!1;const Fe=f.depthModeForSublayer(0,sr.ReadOnly),Ge=s._unevaluatedLayout.hasValue("text-variable-anchor")||s._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Qe=[],ct=J.getCircleRadiusCorrection(W);for(const tt of l){const Xe=e.getTile(tt),_t=Xe.getBucket(s);if(!_t)continue;const Nt=u?_t.text:_t.icon;if(!Nt||!Nt.segments.get().length||!Nt.hasVisibleVertices)continue;const nt=Nt.programConfigurations.get(s.id),st=u||_t.sdfIcons,Ot=u?_t.textSizeData:_t.iconSizeData,Pr=se||W.pitch!==0,Gt=f.useProgram(xi(st,u,_t),nt),Qt=h.ag(Ot,W.zoom),Mr=f.style.map.terrain&&f.style.map.terrain.getTerrainData(tt);let Tn,bi,Ar,_n,Vr=[0,0],rn=null;if(u)bi=Xe.glyphAtlasTexture,Ar=G.LINEAR,Tn=Xe.glyphAtlasTexture.size,_t.iconsInText&&(Vr=Xe.imageAtlasTexture.size,rn=Xe.imageAtlasTexture,_n=Pr||f.options.rotating||f.options.zooming||Ot.kind==="composite"||Ot.kind==="camera"?G.LINEAR:G.NEAREST);else{const nr=s.layout.get("icon-size").constantOr(0)!==1||_t.iconsNeedLinear;bi=Xe.imageAtlasTexture,Ar=st||f.options.rotating||f.options.zooming||nr||Pr?G.LINEAR:G.NEAREST,Tn=Xe.imageAtlasTexture.size}const Mn=Wt(Xe,1,f.transform.zoom),ls=fe?tt.posMatrix:vo,ai=yi(ls,se,re,f.transform,Mn),us=Un(ls,se,re,f.transform,Mn),Ca=Un(tt.posMatrix,se,re,f.transform,Mn),Si=J.translatePosition(f.transform,Xe,p,w),Oi=Ge&&_t.hasTextData(),zs=s.layout.get("icon-text-fit")!=="none"&&Oi&&_t.hasIconData();if(ce){const nr=f.style.map.terrain?(Ma,hs)=>f.style.map.terrain.getElevation(tt,Ma,hs):null,Ti=s.layout.get("text-rotation-alignment")==="map";H(_t,tt.posMatrix,f,u,ai,Ca,se,A,Ti,J,tt.toUnwrapped(),W.width,W.height,Si,nr)}const Hn=tt.posMatrix,ki=u&&Ge||zs,cs=ce||ki?vo:ai,Ni=us,ln=st&&s.paint.get(u?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let qr;qr=st?_t.iconsInText?_a(Ot.kind,Qt,ee,se,ce,ki,f,Hn,cs,Ni,Si,Tn,Vr,ct):$s(Ot.kind,Qt,ee,se,ce,ki,f,Hn,cs,Ni,Si,u,Tn,!0,ct):go(Ot.kind,Qt,ee,se,ce,ki,f,Hn,cs,Ni,Si,u,Tn,ct);const An={program:Gt,buffers:Nt,uniformValues:qr,atlasTexture:bi,atlasTextureIcon:rn,atlasInterpolation:Ar,atlasInterpolationIcon:_n,isSDF:st,hasHalo:ln};if(ye&&_t.canOverlap){be=!0;const nr=Nt.segments.get();for(const Ti of nr)Qe.push({segments:new h.a0([Ti]),sortKey:Ti.sortKey,state:An,terrainData:Mr})}else Qe.push({segments:Nt.segments,sortKey:0,state:An,terrainData:Mr})}be&&Qe.sort(((tt,Xe)=>tt.sortKey-Xe.sortKey));for(const tt of Qe){const Xe=tt.state;if(U.activeTexture.set(G.TEXTURE0),Xe.atlasTexture.bind(Xe.atlasInterpolation,G.CLAMP_TO_EDGE),Xe.atlasTextureIcon&&(U.activeTexture.set(G.TEXTURE1),Xe.atlasTextureIcon&&Xe.atlasTextureIcon.bind(Xe.atlasInterpolationIcon,G.CLAMP_TO_EDGE)),Xe.isSDF){const _t=Xe.uniformValues;Xe.hasHalo&&(_t.u_is_halo=1,qu(Xe.buffers,tt.segments,s,f,Xe.program,Fe,R,B,_t,tt.terrainData)),_t.u_is_halo=0}qu(Xe.buffers,tt.segments,s,f,Xe.program,Fe,R,B,Xe.uniformValues,tt.terrainData)}}function qu(f,e,s,l,u,p,w,k,E,A){const R=l.context;u.draw(R,R.gl.TRIANGLES,p,w,k,kr.disabled,E,A,s.id,f.layoutVertexBuffer,f.indexBuffer,e,s.paint,l.transform.zoom,f.programConfigurations.get(s.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function Zu(f,e,s,l){const u=f.context,p=u.gl,w=Lr.disabled,k=new tn([p.ONE,p.ONE],h.aM.transparent,[!0,!0,!0,!0]),E=e.getBucket(s);if(!E)return;const A=l.key;let R=s.heatmapFbos.get(A);R||(R=xo(u,e.tileSize,e.tileSize),s.heatmapFbos.set(A,R)),u.bindFramebuffer.set(R.framebuffer),u.viewport.set([0,0,e.tileSize,e.tileSize]),u.clear({color:h.aM.transparent});const B=E.programConfigurations.get(s.id),U=f.useProgram("heatmap",B),G=f.style.map.terrain.getTerrainData(l);U.draw(u,p.TRIANGLES,sr.disabled,w,k,kr.disabled,kn(l.posMatrix,e,f.transform.zoom,s.paint.get("heatmap-intensity")),G,s.id,E.layoutVertexBuffer,E.indexBuffer,E.segments,s.paint,f.transform.zoom,B)}function Ka(f,e,s){const l=f.context,u=l.gl;l.setColorMode(f.colorModeForRenderPass());const p=wo(l,e),w=s.key,k=e.heatmapFbos.get(w);k&&(l.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,k.colorAttachment.get()),l.activeTexture.set(u.TEXTURE1),p.bind(u.LINEAR,u.CLAMP_TO_EDGE),f.useProgram("heatmapTexture").draw(l,u.TRIANGLES,sr.disabled,Lr.disabled,f.colorModeForRenderPass(),kr.disabled,ya(f,e,0,1),null,e.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments,e.paint,f.transform.zoom),k.destroy(),e.heatmapFbos.delete(w))}function xo(f,e,s){var l,u;const p=f.gl,w=p.createTexture();p.bindTexture(p.TEXTURE_2D,w),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.LINEAR),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.LINEAR);const k=(l=f.HALF_FLOAT)!==null&&l!==void 0?l:p.UNSIGNED_BYTE,E=(u=f.RGBA16F)!==null&&u!==void 0?u:p.RGBA;p.texImage2D(p.TEXTURE_2D,0,E,e,s,0,p.RGBA,k,null);const A=f.createFramebuffer(e,s,!1,!1);return A.colorAttachment.set(w),A}function wo(f,e){return e.colorRampTexture||(e.colorRampTexture=new vt(f,e.colorRamp,f.gl.RGBA)),e.colorRampTexture}function Es(f,e,s,l,u){if(!s||!l||!l.imageAtlas)return;const p=l.imageAtlas.patternPositions;let w=p[s.to.toString()],k=p[s.from.toString()];if(!w&&k&&(w=k),!k&&w&&(k=w),!w||!k){const E=u.getPaintProperty(e);w=p[E],k=p[E]}w&&k&&f.setConstantPatternPositions(w,k)}function Gs(f,e,s,l,u,p,w){const k=f.context.gl,E="fill-pattern",A=s.paint.get(E),R=A&&A.constantOr(1),B=s.getCrossfadeParameters();let U,G,W,J,re;w?(G=R&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",U=k.LINES):(G=R?"fillPattern":"fill",U=k.TRIANGLES);const se=A.constantOr(null);for(const ce of l){const ee=e.getTile(ce);if(R&&!ee.patternsLoaded())continue;const fe=ee.getBucket(s);if(!fe)continue;const ye=fe.programConfigurations.get(s.id),be=f.useProgram(G,ye),Fe=f.style.map.terrain&&f.style.map.terrain.getTerrainData(ce);R&&(f.context.activeTexture.set(k.TEXTURE0),ee.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),ye.updatePaintBuffers(B)),Es(ye,E,se,ee,s);const Ge=Fe?ce:null,Qe=f.translatePosMatrix(Ge?Ge.posMatrix:ce.posMatrix,ee,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(w){J=fe.indexBuffer2,re=fe.segments2;const ct=[k.drawingBufferWidth,k.drawingBufferHeight];W=G==="fillOutlinePattern"&&R?ql(Qe,f,B,ee,ct):qc(Qe,ct)}else J=fe.indexBuffer,re=fe.segments,W=R?Lu(Qe,f,B,ee):$a(Qe);be.draw(f.context,U,u,f.stencilModeForClipping(ce),p,kr.disabled,W,Fe,s.id,fe.layoutVertexBuffer,J,re,s.paint,f.transform.zoom,ye)}}function ru(f,e,s,l,u,p,w){const k=f.context,E=k.gl,A="fill-extrusion-pattern",R=s.paint.get(A),B=R.constantOr(1),U=s.getCrossfadeParameters(),G=s.paint.get("fill-extrusion-opacity"),W=R.constantOr(null);for(const J of l){const re=e.getTile(J),se=re.getBucket(s);if(!se)continue;const ce=f.style.map.terrain&&f.style.map.terrain.getTerrainData(J),ee=se.programConfigurations.get(s.id),fe=f.useProgram(B?"fillExtrusionPattern":"fillExtrusion",ee);B&&(f.context.activeTexture.set(E.TEXTURE0),re.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),ee.updatePaintBuffers(U)),Es(ee,A,W,re,s);const ye=f.translatePosMatrix(J.posMatrix,re,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),be=s.paint.get("fill-extrusion-vertical-gradient"),Fe=B?mo(ye,f,be,G,J,U,re):fo(ye,f,be,G);fe.draw(k,k.gl.TRIANGLES,u,p,w,kr.backCCW,Fe,ce,s.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,s.paint,f.transform.zoom,ee,f.style.map.terrain&&se.centroidVertexBuffer)}}function Hs(f,e,s,l,u,p,w){const k=f.context,E=k.gl,A=s.fbo;if(!A)return;const R=f.useProgram("hillshade"),B=f.style.map.terrain&&f.style.map.terrain.getTerrainData(e);k.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,A.colorAttachment.get()),R.draw(k,E.TRIANGLES,u,p,w,kr.disabled,((U,G,W,J)=>{const re=W.paint.get("hillshade-shadow-color"),se=W.paint.get("hillshade-highlight-color"),ce=W.paint.get("hillshade-accent-color");let ee=W.paint.get("hillshade-illumination-direction")*(Math.PI/180);W.paint.get("hillshade-illumination-anchor")==="viewport"&&(ee-=U.transform.angle);const fe=!U.options.moving;return{u_matrix:J?J.posMatrix:U.transform.calculatePosMatrix(G.tileID.toUnwrapped(),fe),u_image:0,u_latrange:ts(0,G.tileID),u_light:[W.paint.get("hillshade-exaggeration"),ee],u_shadow:re,u_highlight:se,u_accent:ce}})(f,s,l,B?e:null),B,l.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}function bo(f,e,s,l,u,p){const w=f.context,k=w.gl,E=e.dem;if(E&&E.data){const A=E.dim,R=E.stride,B=E.getPixels();if(w.activeTexture.set(k.TEXTURE1),w.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||f.getTileTexture(R),e.demTexture){const G=e.demTexture;G.update(B,{premultiply:!1}),G.bind(k.NEAREST,k.CLAMP_TO_EDGE)}else e.demTexture=new vt(w,B,k.RGBA,{premultiply:!1}),e.demTexture.bind(k.NEAREST,k.CLAMP_TO_EDGE);w.activeTexture.set(k.TEXTURE0);let U=e.fbo;if(!U){const G=new vt(w,{width:A,height:A,data:null},k.RGBA);G.bind(k.LINEAR,k.CLAMP_TO_EDGE),U=e.fbo=w.createFramebuffer(A,A,!0,!1),U.colorAttachment.set(G.texture)}w.bindFramebuffer.set(U.framebuffer),w.viewport.set([0,0,A,A]),f.useProgram("hillshadePrepare").draw(w,k.TRIANGLES,l,u,p,kr.disabled,((G,W)=>{const J=W.stride,re=h.H();return h.aP(re,0,h.X,-h.X,0,0,1),h.J(re,re,[0,-h.X,0]),{u_matrix:re,u_image:1,u_dimension:[J,J],u_zoom:G.overscaledZ,u_unpack:W.getUnpackVector()}})(e.tileID,E),null,s.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function Gu(f,e,s,l,u,p){const w=l.paint.get("raster-fade-duration");if(!p&&w>0){const k=Y.now(),E=(k-f.timeAdded)/w,A=e?(k-e.timeAdded)/w:-1,R=s.getSource(),B=u.coveringZoomLevel({tileSize:R.tileSize,roundZoom:R.roundZoom}),U=!e||Math.abs(e.tileID.overscaledZ-B)>Math.abs(f.tileID.overscaledZ-B),G=U&&f.refreshedUponExpiration?1:h.ac(U?E:1-A,0,1);return f.refreshedUponExpiration&&E>=1&&(f.refreshedUponExpiration=!1),e?{opacity:1,mix:1-G}:{opacity:G,mix:0}}return{opacity:1,mix:0}}const hl=new h.aM(1,0,0,1),dr=new h.aM(0,1,0,1),dl=new h.aM(0,0,1,1),eh=new h.aM(1,0,1,1),Hu=new h.aM(0,1,1,1);function So(f,e,s,l){nu(f,0,e+s/2,f.transform.width,s,l)}function th(f,e,s,l){nu(f,e-s/2,0,s,f.transform.height,l)}function nu(f,e,s,l,u,p){const w=f.context,k=w.gl;k.enable(k.SCISSOR_TEST),k.scissor(e*f.pixelRatio,s*f.pixelRatio,l*f.pixelRatio,u*f.pixelRatio),w.clear({color:p}),k.disable(k.SCISSOR_TEST)}function rh(f,e,s){const l=f.context,u=l.gl,p=s.posMatrix,w=f.useProgram("debug"),k=sr.disabled,E=Lr.disabled,A=f.colorModeForRenderPass(),R="$debug",B=f.style.map.terrain&&f.style.map.terrain.getTerrainData(s);l.activeTexture.set(u.TEXTURE0);const U=e.getTileByID(s.key).latestRawTileData,G=Math.floor((U&&U.byteLength||0)/1024),W=e.getTile(s).tileSize,J=512/Math.min(W,512)*(s.overscaledZ/f.transform.zoom)*.5;let re=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(re+=` => ${s.overscaledZ}`),(function(se,ce){se.initDebugOverlayCanvas();const ee=se.debugOverlayCanvas,fe=se.context.gl,ye=se.debugOverlayCanvas.getContext("2d");ye.clearRect(0,0,ee.width,ee.height),ye.shadowColor="white",ye.shadowBlur=2,ye.lineWidth=1.5,ye.strokeStyle="white",ye.textBaseline="top",ye.font="bold 36px Open Sans, sans-serif",ye.fillText(ce,5,5),ye.strokeText(ce,5,5),se.debugOverlayTexture.update(ee),se.debugOverlayTexture.bind(fe.LINEAR,fe.CLAMP_TO_EDGE)})(f,`${re} ${G}kB`),w.draw(l,u.TRIANGLES,k,E,tn.alphaBlended,kr.disabled,zi(p,h.aM.transparent,J),null,R,f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments),w.draw(l,u.LINE_STRIP,k,E,A,kr.disabled,zi(p,h.aM.red),B,R,f.debugBuffer,f.tileBorderIndexBuffer,f.debugSegments)}function nh(f,e,s){const l=f.context,u=l.gl,p=f.colorModeForRenderPass(),w=new sr(u.LEQUAL,sr.ReadWrite,f.depthRangeFor3D),k=f.useProgram("terrain"),E=e.getTerrainMesh();l.bindFramebuffer.set(null),l.viewport.set([0,0,f.width,f.height]);for(const A of s){const R=f.renderToTexture.getTexture(A),B=e.getTerrainData(A.tileID);l.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,R.texture);const U=f.transform.calculatePosMatrix(A.tileID.toUnwrapped()),G=e.getMeshFrameDelta(f.transform.zoom),W=f.transform.calculateFogMatrix(A.tileID.toUnwrapped()),J=Du(U,G,W,f.style.sky,f.transform.pitch);k.draw(l,u.TRIANGLES,w,Lr.disabled,p,kr.backCCW,J,B,"terrain",E.vertexBuffer,E.indexBuffer,E.segments)}}class ni{constructor(e,s,l){this.vertexBuffer=e,this.indexBuffer=s,this.segments=l}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class Sa{constructor(e,s){this.context=new ad(e),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:h.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Ft.maxUnderzooming+Ft.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Va}resize(e,s,l){if(this.width=Math.floor(e*l),this.height=Math.floor(s*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style._order)this.style._layers[u].resize()}setup(){const e=this.context,s=new h.aX;s.emplaceBack(0,0),s.emplaceBack(h.X,0),s.emplaceBack(0,h.X),s.emplaceBack(h.X,h.X),this.tileExtentBuffer=e.createVertexBuffer(s,Vs.members),this.tileExtentSegments=h.a0.simpleSegment(0,0,4,2);const l=new h.aX;l.emplaceBack(0,0),l.emplaceBack(h.X,0),l.emplaceBack(0,h.X),l.emplaceBack(h.X,h.X),this.debugBuffer=e.createVertexBuffer(l,Vs.members),this.debugSegments=h.a0.simpleSegment(0,0,4,5);const u=new h.$;u.emplaceBack(0,0,0,0),u.emplaceBack(h.X,0,h.X,0),u.emplaceBack(0,h.X,0,h.X),u.emplaceBack(h.X,h.X,h.X,h.X),this.rasterBoundsBuffer=e.createVertexBuffer(u,ks.members),this.rasterBoundsSegments=h.a0.simpleSegment(0,0,4,2);const p=new h.aX;p.emplaceBack(0,0),p.emplaceBack(1,0),p.emplaceBack(0,1),p.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(p,Vs.members),this.viewportSegments=h.a0.simpleSegment(0,0,4,2);const w=new h.aZ;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(w);const k=new h.aY;k.emplaceBack(0,1,2),k.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(k);const E=this.context.gl;this.stencilClearMode=new Lr({func:E.ALWAYS,mask:0},0,255,E.ZERO,E.ZERO,E.ZERO)}clearStencil(){const e=this.context,s=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=h.H();h.aP(l,0,this.width,this.height,0,0,1),h.K(l,l,[s.drawingBufferWidth,s.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,s.TRIANGLES,sr.disabled,this.stencilClearMode,tn.disabled,kr.disabled,on(l),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,s){if(this.currentStencilSource===e.source||!e.isTileClipped()||!s||!s.length)return;this.currentStencilSource=e.source;const l=this.context,u=l.gl;this.nextStencilID+s.length>256&&this.clearStencil(),l.setColorMode(tn.disabled),l.setDepthMode(sr.disabled);const p=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const w of s){const k=this._tileClippingMaskIDs[w.key]=this.nextStencilID++,E=this.style.map.terrain&&this.style.map.terrain.getTerrainData(w);p.draw(l,u.TRIANGLES,sr.disabled,new Lr({func:u.ALWAYS,mask:0},k,255,u.KEEP,u.KEEP,u.REPLACE),tn.disabled,kr.disabled,on(w.posMatrix),E,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,s=this.context.gl;return new Lr({func:s.NOTEQUAL,mask:255},e,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(e){const s=this.context.gl;return new Lr({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(e){const s=this.context.gl,l=e.sort(((w,k)=>k.overscaledZ-w.overscaledZ)),u=l[l.length-1].overscaledZ,p=l[0].overscaledZ-u+1;if(p>1){this.currentStencilSource=void 0,this.nextStencilID+p>256&&this.clearStencil();const w={};for(let k=0;k<p;k++)w[k+u]=new Lr({func:s.GEQUAL,mask:255},k+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=p,[w,l]}return[{[u]:Lr.disabled},l]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new tn([e.CONSTANT_COLOR,e.ONE],new h.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?tn.unblended:tn.alphaBlended}depthModeForSublayer(e,s,l){if(!this.opaquePassEnabledForLayer())return sr.disabled;const u=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new sr(l||this.context.gl.LEQUAL,s,[u,u])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,s){this.style=e,this.options=s,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(Y.now()),this.imageManager.beginFrame();const l=this.style._order,u=this.style.sourceCaches,p={},w={},k={};for(const E in u){const A=u[E];A.used&&A.prepare(this.context),p[E]=A.getVisibleCoordinates(),w[E]=p[E].slice().reverse(),k[E]=A.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let E=0;E<l.length;E++)if(this.style._layers[l[E]].is3D()){this.opaquePassCutoff=E;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const E of l){const A=this.style._layers[E];if(!A.hasOffscreenPass()||A.isHidden(this.transform.zoom))continue;const R=w[A.source];(A.type==="custom"||R.length)&&this.renderLayer(this,u[A.source],A,R)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?h.aM.black:h.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(E,A){const R=E.context,B=R.gl,U=((se,ce,ee)=>({u_sky_color:se.properties.get("sky-color"),u_horizon_color:se.properties.get("horizon-color"),u_horizon:(ce.height/2+ce.getHorizon())*ee,u_sky_horizon_blend:se.properties.get("sky-horizon-blend")*ce.height/2*ee}))(A,E.style.map.transform,E.pixelRatio),G=new sr(B.LEQUAL,sr.ReadWrite,[0,1]),W=Lr.disabled,J=E.colorModeForRenderPass(),re=E.useProgram("sky");if(!A.mesh){const se=new h.aX;se.emplaceBack(-1,-1),se.emplaceBack(1,-1),se.emplaceBack(1,1),se.emplaceBack(-1,1);const ce=new h.aY;ce.emplaceBack(0,1,2),ce.emplaceBack(0,2,3),A.mesh=new ni(R.createVertexBuffer(se,Vs.members),R.createIndexBuffer(ce),h.a0.simpleSegment(0,0,se.length,ce.length))}re.draw(R,B.TRIANGLES,G,W,J,kr.disabled,U,void 0,"sky",A.mesh.vertexBuffer,A.mesh.indexBuffer,A.mesh.segments)})(this,this.style.sky),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=l.length-1;this.currentLayer>=0;this.currentLayer--){const E=this.style._layers[l[this.currentLayer]],A=u[E.source],R=p[E.source];this._renderTileClippingMasks(E,R),this.renderLayer(this,A,E,R)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<l.length;this.currentLayer++){const E=this.style._layers[l[this.currentLayer]],A=u[E.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(E))continue;const R=(E.type==="symbol"?k:w)[E.source];this._renderTileClippingMasks(E,p[E.source]),this.renderLayer(this,A,E,R)}if(this.options.showTileBoundaries){const E=(function(A,R){let B=null;const U=Object.values(A._layers).flatMap((re=>re.source&&!re.isHidden(R)?[A.sourceCaches[re.source]]:[])),G=U.filter((re=>re.getSource().type==="vector")),W=U.filter((re=>re.getSource().type!=="vector")),J=re=>{(!B||B.getSource().maxzoom<re.getSource().maxzoom)&&(B=re)};return G.forEach((re=>J(re))),B||W.forEach((re=>J(re))),B})(this.style,this.transform.zoom);E&&(function(A,R,B){for(let U=0;U<B.length;U++)rh(A,R,B[U])})(this,E,E.getVisibleCoordinates())}this.options.showPadding&&(function(E){const A=E.transform.padding;So(E,E.transform.height-(A.top||0),3,hl),So(E,A.bottom||0,3,dr),th(E,A.left||0,3,dl),th(E,E.transform.width-(A.right||0),3,eh);const R=E.transform.centerPoint;(function(B,U,G,W){nu(B,U-1,G-10,2,20,W),nu(B,U-10,G-1,20,2,W)})(E,R.x,E.transform.height-R.y,Hu)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const s=this.terrainFacilitator.matrix,l=this.transform.modelViewProjectionMatrix;let u=this.terrainFacilitator.dirty;u||(u=e?!h.a_(s,l):!h.a$(s,l)),u||(u=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),u&&(h.b0(s,l),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(p,w){const k=p.context,E=k.gl,A=tn.unblended,R=new sr(E.LEQUAL,sr.ReadWrite,[0,1]),B=w.getTerrainMesh(),U=w.sourceCache.getRenderableTiles(),G=p.useProgram("terrainDepth");k.bindFramebuffer.set(w.getFramebuffer("depth").framebuffer),k.viewport.set([0,0,p.width/devicePixelRatio,p.height/devicePixelRatio]),k.clear({color:h.aM.transparent,depth:1});for(const W of U){const J=w.getTerrainData(W.tileID),re={u_matrix:p.transform.calculatePosMatrix(W.tileID.toUnwrapped()),u_ele_delta:w.getMeshFrameDelta(p.transform.zoom)};G.draw(k,E.TRIANGLES,R,Lr.disabled,A,kr.backCCW,re,J,"terrain",B.vertexBuffer,B.indexBuffer,B.segments)}k.bindFramebuffer.set(null),k.viewport.set([0,0,p.width,p.height])})(this,this.style.map.terrain),(function(p,w){const k=p.context,E=k.gl,A=tn.unblended,R=new sr(E.LEQUAL,sr.ReadWrite,[0,1]),B=w.getTerrainMesh(),U=w.getCoordsTexture(),G=w.sourceCache.getRenderableTiles(),W=p.useProgram("terrainCoords");k.bindFramebuffer.set(w.getFramebuffer("coords").framebuffer),k.viewport.set([0,0,p.width/devicePixelRatio,p.height/devicePixelRatio]),k.clear({color:h.aM.transparent,depth:1}),w.coordsIndex=[];for(const J of G){const re=w.getTerrainData(J.tileID);k.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,U.texture);const se={u_matrix:p.transform.calculatePosMatrix(J.tileID.toUnwrapped()),u_terrain_coords_id:(255-w.coordsIndex.length)/255,u_texture:0,u_ele_delta:w.getMeshFrameDelta(p.transform.zoom)};W.draw(k,E.TRIANGLES,R,Lr.disabled,A,kr.backCCW,se,re,"terrain",B.vertexBuffer,B.indexBuffer,B.segments),w.coordsIndex.push(J.tileID.key)}k.bindFramebuffer.set(null),k.viewport.set([0,0,p.width,p.height])})(this,this.style.map.terrain))}renderLayer(e,s,l,u){if(!l.isHidden(this.transform.zoom)&&(l.type==="background"||l.type==="custom"||(u||[]).length))switch(this.id=l.id,l.type){case"symbol":(function(p,w,k,E,A){if(p.renderPass!=="translucent")return;const R=Lr.disabled,B=p.colorModeForRenderPass();(k._unevaluatedLayout.hasValue("text-variable-anchor")||k._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(U,G,W,J,re,se,ce,ee,fe){const ye=G.transform,be=Na(),Fe=re==="map",Ge=se==="map";for(const Qe of U){const ct=J.getTile(Qe),tt=ct.getBucket(W);if(!tt||!tt.text||!tt.text.segments.get().length)continue;const Xe=h.ag(tt.textSizeData,ye.zoom),_t=Wt(ct,1,G.transform.zoom),Nt=yi(Qe.posMatrix,Ge,Fe,G.transform,_t),nt=W.layout.get("icon-text-fit")!=="none"&&tt.hasIconData();if(Xe){const st=Math.pow(2,ye.zoom-ct.tileID.overscaledZ),Ot=G.style.map.terrain?(Gt,Qt)=>G.style.map.terrain.getElevation(Qe,Gt,Qt):null,Pr=be.translatePosition(ye,ct,ce,ee);Ha(tt,Fe,Ge,fe,ye,Nt,Qe.posMatrix,st,Xe,nt,be,Pr,Qe.toUnwrapped(),Ot)}}})(E,p,k,w,k.layout.get("text-rotation-alignment"),k.layout.get("text-pitch-alignment"),k.paint.get("text-translate"),k.paint.get("text-translate-anchor"),A),k.paint.get("icon-opacity").constantOr(1)!==0&&ba(p,w,k,E,!1,k.paint.get("icon-translate"),k.paint.get("icon-translate-anchor"),k.layout.get("icon-rotation-alignment"),k.layout.get("icon-pitch-alignment"),k.layout.get("icon-keep-upright"),R,B),k.paint.get("text-opacity").constantOr(1)!==0&&ba(p,w,k,E,!0,k.paint.get("text-translate"),k.paint.get("text-translate-anchor"),k.layout.get("text-rotation-alignment"),k.layout.get("text-pitch-alignment"),k.layout.get("text-keep-upright"),R,B),w.map.showCollisionBoxes&&(cl(p,w,k,E,!0),cl(p,w,k,E,!1))})(e,s,l,u,this.style.placement.variableOffsets);break;case"circle":(function(p,w,k,E){if(p.renderPass!=="translucent")return;const A=k.paint.get("circle-opacity"),R=k.paint.get("circle-stroke-width"),B=k.paint.get("circle-stroke-opacity"),U=!k.layout.get("circle-sort-key").isConstant();if(A.constantOr(1)===0&&(R.constantOr(1)===0||B.constantOr(1)===0))return;const G=p.context,W=G.gl,J=p.depthModeForSublayer(0,sr.ReadOnly),re=Lr.disabled,se=p.colorModeForRenderPass(),ce=[];for(let ee=0;ee<E.length;ee++){const fe=E[ee],ye=w.getTile(fe),be=ye.getBucket(k);if(!be)continue;const Fe=be.programConfigurations.get(k.id),Ge=p.useProgram("circle",Fe),Qe=be.layoutVertexBuffer,ct=be.indexBuffer,tt=p.style.map.terrain&&p.style.map.terrain.getTerrainData(fe),Xe={programConfiguration:Fe,program:Ge,layoutVertexBuffer:Qe,indexBuffer:ct,uniformValues:Zl(p,fe,ye,k),terrainData:tt};if(U){const _t=be.segments.get();for(const Nt of _t)ce.push({segments:new h.a0([Nt]),sortKey:Nt.sortKey,state:Xe})}else ce.push({segments:be.segments,sortKey:0,state:Xe})}U&&ce.sort(((ee,fe)=>ee.sortKey-fe.sortKey));for(const ee of ce){const{programConfiguration:fe,program:ye,layoutVertexBuffer:be,indexBuffer:Fe,uniformValues:Ge,terrainData:Qe}=ee.state;ye.draw(G,W.TRIANGLES,J,re,se,kr.disabled,Ge,Qe,k.id,be,Fe,ee.segments,k.paint,p.transform.zoom,fe)}})(e,s,l,u);break;case"heatmap":(function(p,w,k,E){if(k.paint.get("heatmap-opacity")===0)return;const A=p.context;if(p.style.map.terrain){for(const R of E){const B=w.getTile(R);w.hasRenderableParent(R)||(p.renderPass==="offscreen"?Zu(p,B,k,R):p.renderPass==="translucent"&&Ka(p,k,R))}A.viewport.set([0,0,p.width,p.height])}else p.renderPass==="offscreen"?(function(R,B,U,G){const W=R.context,J=W.gl,re=Lr.disabled,se=new tn([J.ONE,J.ONE],h.aM.transparent,[!0,!0,!0,!0]);(function(ce,ee,fe){const ye=ce.gl;ce.activeTexture.set(ye.TEXTURE1),ce.viewport.set([0,0,ee.width/4,ee.height/4]);let be=fe.heatmapFbos.get(h.aU);be?(ye.bindTexture(ye.TEXTURE_2D,be.colorAttachment.get()),ce.bindFramebuffer.set(be.framebuffer)):(be=xo(ce,ee.width/4,ee.height/4),fe.heatmapFbos.set(h.aU,be))})(W,R,U),W.clear({color:h.aM.transparent});for(let ce=0;ce<G.length;ce++){const ee=G[ce];if(B.hasRenderableParent(ee))continue;const fe=B.getTile(ee),ye=fe.getBucket(U);if(!ye)continue;const be=ye.programConfigurations.get(U.id),Fe=R.useProgram("heatmap",be),{zoom:Ge}=R.transform;Fe.draw(W,J.TRIANGLES,sr.disabled,re,se,kr.disabled,kn(ee.posMatrix,fe,Ge,U.paint.get("heatmap-intensity")),null,U.id,ye.layoutVertexBuffer,ye.indexBuffer,ye.segments,U.paint,R.transform.zoom,be)}W.viewport.set([0,0,R.width,R.height])})(p,w,k,E):p.renderPass==="translucent"&&(function(R,B){const U=R.context,G=U.gl;U.setColorMode(R.colorModeForRenderPass());const W=B.heatmapFbos.get(h.aU);W&&(U.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_2D,W.colorAttachment.get()),U.activeTexture.set(G.TEXTURE1),wo(U,B).bind(G.LINEAR,G.CLAMP_TO_EDGE),R.useProgram("heatmapTexture").draw(U,G.TRIANGLES,sr.disabled,Lr.disabled,R.colorModeForRenderPass(),kr.disabled,ya(R,B,0,1),null,B.id,R.viewportBuffer,R.quadTriangleIndexBuffer,R.viewportSegments,B.paint,R.transform.zoom))})(p,k)})(e,s,l,u);break;case"line":(function(p,w,k,E){if(p.renderPass!=="translucent")return;const A=k.paint.get("line-opacity"),R=k.paint.get("line-width");if(A.constantOr(1)===0||R.constantOr(1)===0)return;const B=p.depthModeForSublayer(0,sr.ReadOnly),U=p.colorModeForRenderPass(),G=k.paint.get("line-dasharray"),W=k.paint.get("line-pattern"),J=W.constantOr(1),re=k.paint.get("line-gradient"),se=k.getCrossfadeParameters(),ce=J?"linePattern":G?"lineSDF":re?"lineGradient":"line",ee=p.context,fe=ee.gl;let ye=!0;for(const be of E){const Fe=w.getTile(be);if(J&&!Fe.patternsLoaded())continue;const Ge=Fe.getBucket(k);if(!Ge)continue;const Qe=Ge.programConfigurations.get(k.id),ct=p.context.program.get(),tt=p.useProgram(ce,Qe),Xe=ye||tt.program!==ct,_t=p.style.map.terrain&&p.style.map.terrain.getTerrainData(be),Nt=W.constantOr(null);if(Nt&&Fe.imageAtlas){const Ot=Fe.imageAtlas,Pr=Ot.patternPositions[Nt.to.toString()],Gt=Ot.patternPositions[Nt.from.toString()];Pr&&Gt&&Qe.setConstantPatternPositions(Pr,Gt)}const nt=_t?be:null,st=J?Is(p,Fe,k,se,nt):G?ed(p,Fe,k,G,se,nt):re?Ru(p,Fe,k,Ge.lineClipsArray.length,nt):Gl(p,Fe,k,nt);if(J)ee.activeTexture.set(fe.TEXTURE0),Fe.imageAtlasTexture.bind(fe.LINEAR,fe.CLAMP_TO_EDGE),Qe.updatePaintBuffers(se);else if(G&&(Xe||p.lineAtlas.dirty))ee.activeTexture.set(fe.TEXTURE0),p.lineAtlas.bind(ee);else if(re){const Ot=Ge.gradients[k.id];let Pr=Ot.texture;if(k.gradientVersion!==Ot.version){let Gt=256;if(k.stepInterpolant){const Qt=w.getSource().maxzoom,Mr=be.canonical.z===Qt?Math.ceil(1<<p.transform.maxZoom-be.canonical.z):1;Gt=h.ac(h.aV(Ge.maxLineLength/h.X*1024*Mr),256,ee.maxTextureSize)}Ot.gradient=h.aW({expression:k.gradientExpression(),evaluationKey:"lineProgress",resolution:Gt,image:Ot.gradient||void 0,clips:Ge.lineClipsArray}),Ot.texture?Ot.texture.update(Ot.gradient):Ot.texture=new vt(ee,Ot.gradient,fe.RGBA),Ot.version=k.gradientVersion,Pr=Ot.texture}ee.activeTexture.set(fe.TEXTURE0),Pr.bind(k.stepInterpolant?fe.NEAREST:fe.LINEAR,fe.CLAMP_TO_EDGE)}tt.draw(ee,fe.TRIANGLES,B,p.stencilModeForClipping(be),U,kr.disabled,st,_t,k.id,Ge.layoutVertexBuffer,Ge.indexBuffer,Ge.segments,k.paint,p.transform.zoom,Qe,Ge.layoutVertexBuffer2),ye=!1}})(e,s,l,u);break;case"fill":(function(p,w,k,E){const A=k.paint.get("fill-color"),R=k.paint.get("fill-opacity");if(R.constantOr(1)===0)return;const B=p.colorModeForRenderPass(),U=k.paint.get("fill-pattern"),G=p.opaquePassEnabledForLayer()&&!U.constantOr(1)&&A.constantOr(h.aM.transparent).a===1&&R.constantOr(0)===1?"opaque":"translucent";if(p.renderPass===G){const W=p.depthModeForSublayer(1,p.renderPass==="opaque"?sr.ReadWrite:sr.ReadOnly);Gs(p,w,k,E,W,B,!1)}if(p.renderPass==="translucent"&&k.paint.get("fill-antialias")){const W=p.depthModeForSublayer(k.getPaintProperty("fill-outline-color")?2:0,sr.ReadOnly);Gs(p,w,k,E,W,B,!0)}})(e,s,l,u);break;case"fill-extrusion":(function(p,w,k,E){const A=k.paint.get("fill-extrusion-opacity");if(A!==0&&p.renderPass==="translucent"){const R=new sr(p.context.gl.LEQUAL,sr.ReadWrite,p.depthRangeFor3D);if(A!==1||k.paint.get("fill-extrusion-pattern").constantOr(1))ru(p,w,k,E,R,Lr.disabled,tn.disabled),ru(p,w,k,E,R,p.stencilModeFor3D(),p.colorModeForRenderPass());else{const B=p.colorModeForRenderPass();ru(p,w,k,E,R,Lr.disabled,B)}}})(e,s,l,u);break;case"hillshade":(function(p,w,k,E){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent")return;const A=p.context,R=p.depthModeForSublayer(0,sr.ReadOnly),B=p.colorModeForRenderPass(),[U,G]=p.renderPass==="translucent"?p.stencilConfigForOverlap(E):[{},E];for(const W of G){const J=w.getTile(W);J.needsHillshadePrepare!==void 0&&J.needsHillshadePrepare&&p.renderPass==="offscreen"?bo(p,J,k,R,Lr.disabled,B):p.renderPass==="translucent"&&Hs(p,W,J,k,R,U[W.overscaledZ],B)}A.viewport.set([0,0,p.width,p.height])})(e,s,l,u);break;case"raster":(function(p,w,k,E){if(p.renderPass!=="translucent"||k.paint.get("raster-opacity")===0||!E.length)return;const A=p.context,R=A.gl,B=w.getSource(),U=p.useProgram("raster"),G=p.colorModeForRenderPass(),[W,J]=B instanceof Ts?[{},E]:p.stencilConfigForOverlap(E),re=J[J.length-1].overscaledZ,se=!p.options.moving;for(const ce of J){const ee=p.depthModeForSublayer(ce.overscaledZ-re,k.paint.get("raster-opacity")===1?sr.ReadWrite:sr.ReadOnly,R.LESS),fe=w.getTile(ce);fe.registerFadeDuration(k.paint.get("raster-fade-duration"));const ye=w.findLoadedParent(ce,0),be=w.findLoadedSibling(ce),Fe=Gu(fe,ye||be||null,w,k,p.transform,p.style.map.terrain);let Ge,Qe;const ct=k.paint.get("raster-resampling")==="nearest"?R.NEAREST:R.LINEAR;A.activeTexture.set(R.TEXTURE0),fe.texture.bind(ct,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST),A.activeTexture.set(R.TEXTURE1),ye?(ye.texture.bind(ct,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST),Ge=Math.pow(2,ye.tileID.overscaledZ-fe.tileID.overscaledZ),Qe=[fe.tileID.canonical.x*Ge%1,fe.tileID.canonical.y*Ge%1]):fe.texture.bind(ct,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST),fe.texture.useMipmap&&A.extTextureFilterAnisotropic&&p.transform.pitch>20&&R.texParameterf(R.TEXTURE_2D,A.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,A.extTextureFilterAnisotropicMax);const tt=p.style.map.terrain&&p.style.map.terrain.getTerrainData(ce),Xe=tt?ce:null,_t=Xe?Xe.posMatrix:p.transform.calculatePosMatrix(ce.toUnwrapped(),se),Nt=Zc(_t,Qe||[0,0],Ge||1,Fe,k);B instanceof Ts?U.draw(A,R.TRIANGLES,ee,Lr.disabled,G,kr.disabled,Nt,tt,k.id,B.boundsBuffer,p.quadTriangleIndexBuffer,B.boundsSegments):U.draw(A,R.TRIANGLES,ee,W[ce.overscaledZ],G,kr.disabled,Nt,tt,k.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}})(e,s,l,u);break;case"background":(function(p,w,k,E){const A=k.paint.get("background-color"),R=k.paint.get("background-opacity");if(R===0)return;const B=p.context,U=B.gl,G=p.transform,W=G.tileSize,J=k.paint.get("background-pattern");if(p.isPatternMissing(J))return;const re=!J&&A.a===1&&R===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==re)return;const se=Lr.disabled,ce=p.depthModeForSublayer(0,re==="opaque"?sr.ReadWrite:sr.ReadOnly),ee=p.colorModeForRenderPass(),fe=p.useProgram(J?"backgroundPattern":"background"),ye=E||G.coveringTiles({tileSize:W,terrain:p.style.map.terrain});J&&(B.activeTexture.set(U.TEXTURE0),p.imageManager.bind(p.context));const be=k.getCrossfadeParameters();for(const Fe of ye){const Ge=E?Fe.posMatrix:p.transform.calculatePosMatrix(Fe.toUnwrapped()),Qe=J?Fu(Ge,R,p,J,{tileID:Fe,tileSize:W},be):qa(Ge,R,A),ct=p.style.map.terrain&&p.style.map.terrain.getTerrainData(Fe);fe.draw(B,U.TRIANGLES,ce,se,ee,kr.disabled,Qe,ct,k.id,p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}})(e,0,l,u);break;case"custom":(function(p,w,k){const E=p.context,A=k.implementation;if(p.renderPass==="offscreen"){const R=A.prerender;R&&(p.setCustomLayerDefaults(),E.setColorMode(p.colorModeForRenderPass()),R.call(A,E.gl,p.transform.customLayerMatrix()),E.setDirty(),p.setBaseState())}else if(p.renderPass==="translucent"){p.setCustomLayerDefaults(),E.setColorMode(p.colorModeForRenderPass()),E.setStencilMode(Lr.disabled);const R=A.renderingMode==="3d"?new sr(p.context.gl.LEQUAL,sr.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,sr.ReadOnly);E.setDepthMode(R),A.render(E.gl,p.transform.customLayerMatrix(),{farZ:p.transform.farZ,nearZ:p.transform.nearZ,fov:p.transform._fov,modelViewProjectionMatrix:p.transform.modelViewProjectionMatrix,projectionMatrix:p.transform.projectionMatrix}),E.setDirty(),p.setBaseState(),E.bindFramebuffer.set(null)}})(e,0,l)}}translatePosMatrix(e,s,l,u,p){if(!l[0]&&!l[1])return e;const w=p?u==="map"?this.transform.angle:0:u==="viewport"?-this.transform.angle:0;if(w){const A=Math.sin(w),R=Math.cos(w);l=[l[0]*R-l[1]*A,l[0]*A+l[1]*R]}const k=[p?l[0]:Wt(s,l[0],this.transform.zoom),p?l[1]:Wt(s,l[1],this.transform.zoom),0],E=new Float32Array(16);return h.J(E,e,k),E}saveTileTexture(e){const s=this._tileTextures[e.size[0]];s?s.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const s=this._tileTextures[e];return s&&s.length>0?s.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const s=this.imageManager.getPattern(e.from.toString()),l=this.imageManager.getPattern(e.to.toString());return!s||!l}useProgram(e,s){this.cache=this.cache||{};const l=e+(s?s.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[l]||(this.cache[l]=new Sr(this.context,Us[e],s,Ou[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[l]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new vt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:s}=this.context.gl;return this.width!==e||this.height!==s}}class Wa{constructor(e,s){this.points=e,this.planes=s}static fromInvProjectionMatrix(e,s,l){const u=Math.pow(2,l),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((k=>{const E=1/(k=h.af([],k,e))[3]/s*u;return h.b1(k,k,[E,E,1/k[3],E])})),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((k=>{const E=(function(U,G){var W=G[0],J=G[1],re=G[2],se=W*W+J*J+re*re;return se>0&&(se=1/Math.sqrt(se)),U[0]=G[0]*se,U[1]=G[1]*se,U[2]=G[2]*se,U})([],(function(U,G,W){var J=G[0],re=G[1],se=G[2],ce=W[0],ee=W[1],fe=W[2];return U[0]=re*fe-se*ee,U[1]=se*ce-J*fe,U[2]=J*ee-re*ce,U})([],je([],p[k[0]],p[k[1]]),je([],p[k[2]],p[k[1]]))),A=-((R=E)[0]*(B=p[k[1]])[0]+R[1]*B[1]+R[2]*B[2]);var R,B;return E.concat(A)}));return new Wa(p,w)}}class Xa{constructor(e,s){this.min=e,this.max=s,this.center=(function(l,u,p){return l[0]=.5*u[0],l[1]=.5*u[1],l[2]=.5*u[2],l})([],(function(l,u,p){return l[0]=u[0]+p[0],l[1]=u[1]+p[1],l[2]=u[2]+p[2],l})([],this.min,this.max))}quadrant(e){const s=[e%2==0,e<2],l=Je(this.min),u=Je(this.max);for(let p=0;p<s.length;p++)l[p]=s[p]?this.min[p]:this.center[p],u[p]=s[p]?this.center[p]:this.max[p];return u[2]=this.max[2],new Xa(l,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const s=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let l=!0;for(let u=0;u<e.planes.length;u++){const p=e.planes[u];let w=0;for(let k=0;k<s.length;k++)h.b2(p,s[k])>=0&&w++;if(w===0)return 0;w!==s.length&&(l=!1)}if(l)return 2;for(let u=0;u<3;u++){let p=Number.MAX_VALUE,w=-Number.MAX_VALUE;for(let k=0;k<e.points.length;k++){const E=e.points[k][u]-this.min[u];p=Math.min(p,E),w=Math.max(w,E)}if(w<0||p>this.max[u]-this.min[u])return 0}return 1}}class Ya{constructor(e=0,s=0,l=0,u=0){if(isNaN(e)||e<0||isNaN(s)||s<0||isNaN(l)||l<0||isNaN(u)||u<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=s,this.left=l,this.right=u}interpolate(e,s,l){return s.top!=null&&e.top!=null&&(this.top=h.y.number(e.top,s.top,l)),s.bottom!=null&&e.bottom!=null&&(this.bottom=h.y.number(e.bottom,s.bottom,l)),s.left!=null&&e.left!=null&&(this.left=h.y.number(e.left,s.left,l)),s.right!=null&&e.right!=null&&(this.right=h.y.number(e.right,s.right,l)),this}getCenter(e,s){const l=h.ac((this.left+e-this.right)/2,0,e),u=h.ac((this.top+s-this.bottom)/2,0,s);return new h.P(l,u)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Ya(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const iu=85.051129;class ka{constructor(e,s,l,u,p){this.tileSize=512,this._renderWorldCopies=p===void 0||!!p,this._minZoom=e||0,this._maxZoom=s||22,this._minPitch=l??0,this._maxPitch=u??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new h.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Ya,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const e=new ka(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.lngRange=e.lngRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new h.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const s=-h.b3(e,-180,180)*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=(function(){var l=new h.A(4);return h.A!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l})(),(function(l,u,p){var w=u[0],k=u[1],E=u[2],A=u[3],R=Math.sin(p),B=Math.cos(p);l[0]=w*B+E*R,l[1]=k*B+A*R,l[2]=w*-R+E*B,l[3]=k*-R+A*B})(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const s=h.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const s=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this.tileZoom=Math.max(0,Math.floor(s)),this.scale=this.zoomScale(s),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,s,l){this._unmodified=!1,this._edgeInsets.interpolate(e,s,l),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const s=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(e){const s=[new h.b4(0,e)];if(this._renderWorldCopies){const l=this.pointCoordinate(new h.P(0,0)),u=this.pointCoordinate(new h.P(this.width,0)),p=this.pointCoordinate(new h.P(this.width,this.height)),w=this.pointCoordinate(new h.P(0,this.height)),k=Math.floor(Math.min(l.x,u.x,p.x,w.x)),E=Math.floor(Math.max(l.x,u.x,p.x,w.x)),A=1;for(let R=k-A;R<=E+A;R++)R!==0&&s.push(new h.b4(R,e))}return s}coveringTiles(e){var s,l;let u=this.coveringZoomLevel(e);const p=u;if(e.minzoom!==void 0&&u<e.minzoom)return[];e.maxzoom!==void 0&&u>e.maxzoom&&(u=e.maxzoom);const w=this.pointCoordinate(this.getCameraPoint()),k=h.Z.fromLngLat(this.center),E=Math.pow(2,u),A=[E*w.x,E*w.y,0],R=[E*k.x,E*k.y,0],B=Wa.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,u);let U=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(U=u);const G=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,W=ee=>({aabb:new Xa([ee*E,0,0],[(ee+1)*E,E,0]),zoom:0,x:0,y:0,wrap:ee,fullyVisible:!1}),J=[],re=[],se=u,ce=e.reparseOverscaled?p:u;if(this._renderWorldCopies)for(let ee=1;ee<=3;ee++)J.push(W(-ee)),J.push(W(ee));for(J.push(W(0));J.length>0;){const ee=J.pop(),fe=ee.x,ye=ee.y;let be=ee.fullyVisible;if(!be){const tt=ee.aabb.intersects(B);if(tt===0)continue;be=tt===2}const Fe=e.terrain?A:R,Ge=ee.aabb.distanceX(Fe),Qe=ee.aabb.distanceY(Fe),ct=Math.max(Math.abs(Ge),Math.abs(Qe));if(ee.zoom===se||ct>G+(1<<se-ee.zoom)-2&&ee.zoom>=U){const tt=se-ee.zoom,Xe=A[0]-.5-(fe<<tt),_t=A[1]-.5-(ye<<tt);re.push({tileID:new h.S(ee.zoom===se?ce:ee.zoom,ee.wrap,ee.zoom,fe,ye),distanceSq:ut([R[0]-.5-fe,R[1]-.5-ye]),tileDistanceToCamera:Math.sqrt(Xe*Xe+_t*_t)})}else for(let tt=0;tt<4;tt++){const Xe=(fe<<1)+tt%2,_t=(ye<<1)+(tt>>1),Nt=ee.zoom+1;let nt=ee.aabb.quadrant(tt);if(e.terrain){const st=new h.S(Nt,ee.wrap,Nt,Xe,_t),Ot=e.terrain.getMinMaxElevation(st),Pr=(s=Ot.minElevation)!==null&&s!==void 0?s:this.elevation,Gt=(l=Ot.maxElevation)!==null&&l!==void 0?l:this.elevation;nt=new Xa([nt.min[0],nt.min[1],Pr],[nt.max[0],nt.max[1],Gt])}J.push({aabb:nt,zoom:Nt,x:Xe,y:_t,wrap:ee.wrap,fullyVisible:be})}}return re.sort(((ee,fe)=>ee.distanceSq-fe.distanceSq)).map((ee=>ee.tileID))}resize(e,s){this.width=e,this.height=s,this.pixelsToGLUnits=[2/e,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const s=h.ac(e.lat,-85.051129,iu);return new h.P(h.O(e.lng)*this.worldSize,h.Q(s)*this.worldSize)}unproject(e){return new h.Z(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const s=this.elevation,l=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,u=this.pointLocation(this.centerPoint,e),p=e.getElevationForLngLatZoom(u,this.tileZoom);if(!(this.elevation-p))return;const w=l+s-p,k=Math.cos(this._pitch)*this.cameraToCenterDistance/w/h.b5(1,u.lat),E=this.scaleZoom(k/this.tileSize);this._elevation=p,this._center=u,this.zoom=E}setLocationAtPoint(e,s){const l=this.pointCoordinate(s),u=this.pointCoordinate(this.centerPoint),p=this.locationCoordinate(e),w=new h.Z(p.x-(l.x-u.x),p.y-(l.y-u.y));this.center=this.coordinateLocation(w),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,s){return s?this.coordinatePoint(this.locationCoordinate(e),s.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,s){return this.coordinateLocation(this.pointCoordinate(e,s))}locationCoordinate(e){return h.Z.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,s){if(s){const U=s.pointCoordinate(e);if(U!=null)return U}const l=[e.x,e.y,0,1],u=[e.x,e.y,1,1];h.af(l,l,this.pixelMatrixInverse),h.af(u,u,this.pixelMatrixInverse);const p=l[3],w=u[3],k=l[1]/p,E=u[1]/w,A=l[2]/p,R=u[2]/w,B=A===R?0:(0-A)/(R-A);return new h.Z(h.y.number(l[0]/p,u[0]/w,B)/this.worldSize,h.y.number(k,E,B)/this.worldSize)}coordinatePoint(e,s=0,l=this.pixelMatrix){const u=[e.x*this.worldSize,e.y*this.worldSize,s,1];return h.af(u,u,l),new h.P(u[0]/u[3],u[1]/u[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new Ee().extend(this.pointLocation(new h.P(0,e))).extend(this.pointLocation(new h.P(this.width,e))).extend(this.pointLocation(new h.P(this.width,this.height))).extend(this.pointLocation(new h.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Ee([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,iu])}calculateTileMatrix(e){const s=e.canonical,l=this.worldSize/this.zoomScale(s.z),u=s.x+Math.pow(2,s.z)*e.wrap,p=h.an(new Float64Array(16));return h.J(p,p,[u*l,s.y*l,0]),h.K(p,p,[l/h.X,l/h.X,1]),p}calculatePosMatrix(e,s=!1){const l=e.key,u=s?this._alignedPosMatrixCache:this._posMatrixCache;if(u[l])return u[l];const p=this.calculateTileMatrix(e);return h.L(p,s?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,p),u[l]=new Float32Array(p),u[l]}calculateFogMatrix(e){const s=e.key,l=this._fogMatrixCache;if(l[s])return l[s];const u=this.calculateTileMatrix(e);return h.L(u,this.fogMatrix,u),l[s]=new Float32Array(u),l[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,s){s=h.ac(+s,this.minZoom,this.maxZoom);const l={center:new h.N(e.lng,e.lat),zoom:s};let u=this.lngRange;if(!this._renderWorldCopies&&u===null){const ee=179.9999999999;u=[-ee,ee]}const p=this.tileSize*this.zoomScale(l.zoom);let w=0,k=p,E=0,A=p,R=0,B=0;const{x:U,y:G}=this.size;if(this.latRange){const ee=this.latRange;w=h.Q(ee[1])*p,k=h.Q(ee[0])*p,k-w<G&&(R=G/(k-w))}u&&(E=h.b3(h.O(u[0])*p,0,p),A=h.b3(h.O(u[1])*p,0,p),A<E&&(A+=p),A-E<U&&(B=U/(A-E)));const{x:W,y:J}=this.project.call({worldSize:p},e);let re,se;const ce=Math.max(B||0,R||0);if(ce){const ee=new h.P(B?(A+E)/2:W,R?(k+w)/2:J);return l.center=this.unproject.call({worldSize:p},ee).wrap(),l.zoom+=this.scaleZoom(ce),l}if(this.latRange){const ee=G/2;J-ee<w&&(se=w+ee),J+ee>k&&(se=k-ee)}if(u){const ee=(E+A)/2;let fe=W;this._renderWorldCopies&&(fe=h.b3(W,ee-p/2,ee+p/2));const ye=U/2;fe-ye<E&&(re=E+ye),fe+ye>A&&(re=A-ye)}if(re!==void 0||se!==void 0){const ee=new h.P(re??W,se??J);l.center=this.unproject.call({worldSize:p},ee).wrap()}return l}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:s,zoom:l}=this.getConstrained(this.center,this.zoom);this.center=s,this.zoom=l,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,s=this.point.x,l=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=h.b5(1,this.center.lat)*this.worldSize;let u=h.an(new Float64Array(16));h.K(u,u,[this.width/2,-this.height/2,1]),h.J(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=h.an(new Float64Array(16)),h.K(u,u,[1,-1,1]),h.J(u,u,[-1,-1,0]),h.K(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u;const p=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),w=Math.min(this.elevation,this.minElevationForCurrentTile),k=p-w*this._pixelPerMeter/Math.cos(this._pitch),E=w<0?k:p,A=Math.PI/2+this._pitch,R=this._fov*(.5+e.y/this.height),B=Math.sin(R)*E/Math.sin(h.ac(Math.PI-A-R,.01,Math.PI-.01)),U=this.getHorizon(),G=2*Math.atan(U/this.cameraToCenterDistance)*(.5+e.y/(2*U)),W=Math.sin(G)*E/Math.sin(h.ac(Math.PI-A-G,.01,Math.PI-.01)),J=Math.min(B,W);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*J+E),this.nearZ=this.height/50,u=new Float64Array(16),h.b6(u,this._fov,this.width/this.height,this.nearZ,this.farZ),u[8]=2*-e.x/this.width,u[9]=2*e.y/this.height,this.projectionMatrix=h.ae(u),h.K(u,u,[1,-1,1]),h.J(u,u,[0,0,-this.cameraToCenterDistance]),h.b7(u,u,this._pitch),h.ad(u,u,this.angle),h.J(u,u,[-s,-l,0]),this.mercatorMatrix=h.K([],u,[this.worldSize,this.worldSize,this.worldSize]),h.K(u,u,[1,1,this._pixelPerMeter]),this.pixelMatrix=h.L(new Float64Array(16),this.labelPlaneMatrix,u),h.J(u,u,[0,0,-this.elevation]),this.modelViewProjectionMatrix=u,this.invModelViewProjectionMatrix=h.as([],u),this.fogMatrix=new Float64Array(16),h.b6(this.fogMatrix,this._fov,this.width/this.height,p,this.farZ),this.fogMatrix[8]=2*-e.x/this.width,this.fogMatrix[9]=2*e.y/this.height,h.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),h.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),h.b7(this.fogMatrix,this.fogMatrix,this._pitch),h.ad(this.fogMatrix,this.fogMatrix,this.angle),h.J(this.fogMatrix,this.fogMatrix,[-s,-l,0]),h.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),h.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=h.L(new Float64Array(16),this.labelPlaneMatrix,u);const re=this.width%2/2,se=this.height%2/2,ce=Math.cos(this.angle),ee=Math.sin(this.angle),fe=s-Math.round(s)+ce*re+ee*se,ye=l-Math.round(l)+ce*se+ee*re,be=new Float64Array(u);if(h.J(be,be,[fe>.5?fe-1:fe,ye>.5?ye-1:ye,0]),this.alignedModelViewProjectionMatrix=be,u=h.as(new Float64Array(16),this.pixelMatrix),!u)throw new Error("failed to invert matrix");this.pixelMatrixInverse=u,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new h.P(0,0)),s=[e.x*this.worldSize,e.y*this.worldSize,0,1];return h.af(s,s,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new h.P(0,e))}getCameraQueryGeometry(e){const s=this.getCameraPoint();if(e.length===1)return[e[0],s];{let l=s.x,u=s.y,p=s.x,w=s.y;for(const k of e)l=Math.min(l,k.x),u=Math.min(u,k.y),p=Math.max(p,k.x),w=Math.max(w,k.y);return[new h.P(l,u),new h.P(p,u),new h.P(p,w),new h.P(l,w),new h.P(l,u)]}}lngLatToCameraDepth(e,s){const l=this.locationCoordinate(e),u=[l.x*this.worldSize,l.y*this.worldSize,s,1];return h.af(u,u,this.modelViewProjectionMatrix),u[2]/u[3]}}function pl(f,e){let s,l=!1,u=null,p=null;const w=()=>{u=null,l&&(f.apply(p,s),u=setTimeout(w,e),l=!1)};return(...k)=>(l=!0,p=this,s=k,u||w(),u)}class su{constructor(e){this._getCurrentHash=()=>{const s=window.location.hash.replace("#","");if(this._hashName){let l;return s.split("&").map((u=>u.split("="))).forEach((u=>{u[0]===this._hashName&&(l=u)})),(l&&l[1]||"").split("/")}return s.split("/")},this._onHashChange=()=>{const s=this._getCurrentHash();if(s.length>=3&&!s.some((l=>isNaN(l)))){const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:l,pitch:+(s[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const s=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,s)},this._removeHash=()=>{const s=this._getCurrentHash();if(s.length===0)return;const l=s.join("/");let u=l;u.split("&").length>0&&(u=u.split("&")[0]),this._hashName&&(u=`${this._hashName}=${l}`);let p=window.location.hash.replace(u,"");p.startsWith("#&")?p=p.slice(0,1)+p.slice(2):p==="#"&&(p="");let w=window.location.href.replace(/(#.+)?$/,p);w=w.replace("&&","&"),window.history.replaceState(window.history.state,null,w)},this._updateHash=pl(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const s=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,u=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),p=Math.pow(10,u),w=Math.round(s.lng*p)/p,k=Math.round(s.lat*p)/p,E=this._map.getBearing(),A=this._map.getPitch();let R="";if(R+=e?`/${w}/${k}/${l}`:`${l}/${k}/${w}`,(E||A)&&(R+="/"+Math.round(10*E)/10),A&&(R+=`/${Math.round(A)}`),this._hashName){const B=this._hashName;let U=!1;const G=window.location.hash.slice(1).split("&").map((W=>{const J=W.split("=")[0];return J===B?(U=!0,`${J}=${R}`):W})).filter((W=>W));return U||G.push(`${B}=${R}`),`#${G.join("&")}`}return`#${R}`}}const Ks={linearity:.3,easing:h.b8(0,0,.3,1)},fl=h.e({deceleration:2500,maxSpeed:1400},Ks),ml=h.e({deceleration:20,maxSpeed:1400},Ks),au=h.e({deceleration:1e3,maxSpeed:360},Ks),gl=h.e({deceleration:1e3,maxSpeed:90},Ks);class ko{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Y.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,s=Y.now();for(;e.length>0&&s-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new h.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:p}of this._inertiaBuffer)s.zoom+=p.zoomDelta||0,s.bearing+=p.bearingDelta||0,s.pitch+=p.pitchDelta||0,p.panDelta&&s.pan._add(p.panDelta),p.around&&(s.around=p.around),p.pinchAround&&(s.pinchAround=p.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,u={};if(s.pan.mag()){const p=Ja(s.pan.mag(),l,h.e({},fl,e||{}));u.offset=s.pan.mult(p.amount/s.pan.mag()),u.center=this._map.transform.center,Ps(u,p)}if(s.zoom){const p=Ja(s.zoom,l,ml);u.zoom=this._map.transform.zoom+p.amount,Ps(u,p)}if(s.bearing){const p=Ja(s.bearing,l,au);u.bearing=this._map.transform.bearing+h.ac(p.amount,-179,179),Ps(u,p)}if(s.pitch){const p=Ja(s.pitch,l,gl);u.pitch=this._map.transform.pitch+p.amount,Ps(u,p)}if(u.zoom||u.bearing){const p=s.pinchAround===void 0?s.around:s.pinchAround;u.around=p?this._map.unproject(p):this._map.getCenter()}return this.clear(),h.e(u,{noMoveStart:!0})}}function Ps(f,e){(!f.duration||f.duration<e.duration)&&(f.duration=e.duration,f.easing=e.easing)}function Ja(f,e,s){const{maxSpeed:l,linearity:u,deceleration:p}=s,w=h.ac(f*u/(e/1e3),-l,l),k=Math.abs(w)/(p*u);return{easing:s.easing,duration:1e3*k,amount:w*(k/2)}}class Pn extends h.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,l,u={}){const p=Z.mousePos(s.getCanvas(),l),w=s.unproject(p);super(e,h.e({point:p,lngLat:w,originalEvent:l},u)),this._defaultPrevented=!1,this.target=s}}class Cs extends h.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,l){const u=e==="touchend"?l.changedTouches:l.touches,p=Z.touchPos(s.getCanvasContainer(),u),w=p.map((E=>s.unproject(E))),k=p.reduce(((E,A,R,B)=>E.add(A.div(B.length))),new h.P(0,0));super(e,{points:p,point:k,lngLats:w,lngLat:s.unproject(k),originalEvent:l}),this._defaultPrevented=!1}}class Ku extends h.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,l){super(e,{originalEvent:l}),this._defaultPrevented=!1}}class Wu{constructor(e,s){this._map=e,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Ku(e.type,this._map,e))}mousedown(e,s){return this._mousedownPos=s,this._firePreventable(new Pn(e.type,this._map,e))}mouseup(e){this._map.fire(new Pn(e.type,this._map,e))}click(e,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new Pn(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Pn(e.type,this._map,e))}mouseover(e){this._map.fire(new Pn(e.type,this._map,e))}mouseout(e){this._map.fire(new Pn(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Cs(e.type,this._map,e))}touchmove(e){this._map.fire(new Cs(e.type,this._map,e))}touchend(e){this._map.fire(new Cs(e.type,this._map,e))}touchcancel(e){this._map.fire(new Cs(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Yr{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Pn(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Pn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Pn(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Li{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(h.P.convert(e),this._map.terrain)}}class ii{constructor(e,s){this._map=e,this._tr=new Li(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,s){this.isEnabled()&&e.shiftKey&&e.button===0&&(Z.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(e,s){if(!this._active)return;const l=s;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const u=this._startPos;this._lastPos=l,this._box||(this._box=Z.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const p=Math.min(u.x,l.x),w=Math.max(u.x,l.x),k=Math.min(u.y,l.y),E=Math.max(u.y,l.y);Z.setTransform(this._box,`translate(${p}px,${k}px)`),this._box.style.width=w-p+"px",this._box.style.height=E-k+"px"}mouseupWindow(e,s){if(!this._active||e.button!==0)return;const l=this._startPos,u=s;if(this.reset(),Z.suppressClick(),l.x!==u.x||l.y!==u.y)return this._map.fire(new h.k("boxzoomend",{originalEvent:e})),{cameraAnimation:p=>p.fitScreenCoordinates(l,u,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(Z.remove(this._box),this._box=null),Z.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,s){return this._map.fire(new h.k(e,{originalEvent:s}))}}function To(f,e){if(f.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${f.length}, points ${e.length}`);const s={};for(let l=0;l<f.length;l++)s[f[l].identifier]=e[l];return s}class Ms{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,s,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),l.length===this.numTouches&&(this.centroid=(function(u){const p=new h.P(0,0);for(const w of u)p._add(w);return p.div(u.length)})(s),this.touches=To(l,s)))}touchmove(e,s,l){if(this.aborted||!this.centroid)return;const u=To(l,s);for(const p in this.touches){const w=u[p];(!w||w.dist(this.touches[p])>30)&&(this.aborted=!0)}}touchend(e,s,l){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const u=!this.aborted&&this.centroid;if(this.reset(),u)return u}}}class Io{constructor(e){this.singleTap=new Ms(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,s,l){this.singleTap.touchstart(e,s,l)}touchmove(e,s,l){this.singleTap.touchmove(e,s,l)}touchend(e,s,l){const u=this.singleTap.touchend(e,s,l);if(u){const p=e.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(u)<30;if(p&&w||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=u,this.count===this.numTaps)return this.reset(),u}}}class Ta{constructor(e){this._tr=new Li(e),this._zoomIn=new Io({numTouches:1,numTaps:2}),this._zoomOut=new Io({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,s,l){this._zoomIn.touchstart(e,s,l),this._zoomOut.touchstart(e,s,l)}touchmove(e,s,l){this._zoomIn.touchmove(e,s,l),this._zoomOut.touchmove(e,s,l)}touchend(e,s,l){const u=this._zoomIn.touchend(e,s,l),p=this._zoomOut.touchend(e,s,l),w=this._tr;return u?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:k=>k.easeTo({duration:300,zoom:w.zoom+1,around:w.unproject(u)},{originalEvent:e})}):p?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:k=>k.easeTo({duration:300,zoom:w.zoom-1,around:w.unproject(p)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ws{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const s=this._moveFunction(...e);if(s.bearingDelta||s.pitchDelta||s.around||s.panDelta)return this._active=!0,s}dragStart(e,s){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=s.length?s[0]:s,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,s){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const u=s.length?s[0]:s;return!this._moved&&u.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=u,this._move(l,u))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&Z.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Xu={0:1,2:2};class Ia{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const s=Z.mouseButton(e);this._eventButton=s}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!(function(s,l){const u=Xu[l];return s.buttons===void 0||(s.buttons&u)!==u})(e,this._eventButton)}isValidEndEvent(e){return Z.mouseButton(e)===this._eventButton}}class Yu{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}const yl=f=>{f.mousedown=f.dragStart,f.mousemoveWindow=f.dragMove,f.mouseup=f.dragEnd,f.contextmenu=e=>{e.preventDefault()}},ou=({enable:f,clickTolerance:e,bearingDegreesPerPixelMoved:s=.8})=>{const l=new Ia({checkCorrectEvent:u=>Z.mouseButton(u)===0&&u.ctrlKey||Z.mouseButton(u)===2});return new Ws({clickTolerance:e,move:(u,p)=>({bearingDelta:(p.x-u.x)*s}),moveStateManager:l,enable:f,assignEvents:yl})},Rr=({enable:f,clickTolerance:e,pitchDegreesPerPixelMoved:s=-.5})=>{const l=new Ia({checkCorrectEvent:u=>Z.mouseButton(u)===0&&u.ctrlKey||Z.mouseButton(u)===2});return new Ws({clickTolerance:e,move:(u,p)=>({pitchDelta:(p.y-u.y)*s}),moveStateManager:l,enable:f,assignEvents:yl})};class Xs{constructor(e,s){this._clickTolerance=e.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new h.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,s,l){return this._calculateTransform(e,s,l)}touchmove(e,s,l){if(this._active){if(!this._shouldBePrevented(l.length))return e.preventDefault(),this._calculateTransform(e,s,l);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,s,l){this._calculateTransform(e,s,l),this._active&&this._shouldBePrevented(l.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,s,l){l.length>0&&(this._active=!0);const u=To(l,s),p=new h.P(0,0),w=new h.P(0,0);let k=0;for(const A in u){const R=u[A],B=this._touches[A];B&&(p._add(R),w._add(R.sub(B)),k++,u[A]=R)}if(this._touches=u,this._shouldBePrevented(k)||!w.mag())return;const E=w.div(k);return this._sum._add(E),this._sum.mag()<this._clickTolerance?void 0:{around:p.div(k),panDelta:E}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qa{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,s,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([s[0],s[1]]))}touchmove(e,s,l){if(!this._firstTwoTouches)return;e.preventDefault();const[u,p]=this._firstTwoTouches,w=Ys(l,s,u),k=Ys(l,s,p);if(!w||!k)return;const E=this._aroundCenter?null:w.add(k).div(2);return this._move([w,k],E,e)}touchend(e,s,l){if(!this._firstTwoTouches)return;const[u,p]=this._firstTwoTouches,w=Ys(l,s,u),k=Ys(l,s,p);w&&k||(this._active&&Z.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ys(f,e,s){for(let l=0;l<f.length;l++)if(f[l].identifier===s)return e[l]}function lu(f,e){return Math.log(f/e)/Math.LN2}class _l extends Qa{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,s){const l=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(lu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:lu(this._distance,l),pinchAround:s}}}function eo(f,e){return 180*f.angleWith(e)/Math.PI}class Eo extends Qa{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,s,l){const u=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:eo(this._vector,u),pinchAround:s}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const s=25/(Math.PI*this._minDiameter)*360,l=eo(e,this._startVector);return Math.abs(l)<s}}function Js(f){return Math.abs(f.y)>Math.abs(f.x)}class Po extends Qa{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,s,l){super.touchstart(e,s,l),this._currentTouchCount=l.length}_start(e){this._lastPoints=e,Js(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,s,l){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const u=e[0].sub(this._lastPoints[0]),p=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(u,p,l.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(u.y+p.y)/2*-.5}):void 0}gestureBeginsVertically(e,s,l){if(this._valid!==void 0)return this._valid;const u=e.mag()>=2,p=s.mag()>=2;if(!u&&!p)return;if(!u||!p)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const w=e.y>0==s.y>0;return Js(e)&&Js(s)&&w}}const ih={panStep:100,bearingStep:15,pitchStep:10};class Ri{constructor(e){this._tr=new Li(e);const s=ih;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let s=0,l=0,u=0,p=0,w=0;switch(e.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:e.shiftKey?l=-1:(e.preventDefault(),p=-1);break;case 39:e.shiftKey?l=1:(e.preventDefault(),p=1);break;case 38:e.shiftKey?u=1:(e.preventDefault(),w=-1);break;case 40:e.shiftKey?u=-1:(e.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(l=0,u=0),{cameraAnimation:k=>{const E=this._tr;k.easeTo({duration:300,easeId:"keyboardHandler",easing:is,zoom:s?Math.round(E.zoom)+s*(e.shiftKey?2:1):E.zoom,bearing:E.bearing+l*this._bearingStep,pitch:E.pitch+u*this._pitchStep,offset:[-p*this._panStep,-w*this._panStep],center:E.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function is(f){return f*(2-f)}const Co=4.000244140625;class si{constructor(e,s){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=e,this._tr=new Li(e),this._triggerRenderFrame=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let s=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const l=Y.now(),u=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,s!==0&&s%Co==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":u>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(u*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),e.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=e,this._delta-=s,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=Z.mousePos(this._map.getCanvas(),e),l=this._tr;this._around=s.y>l.transform.height/2-l.transform.getHorizon()?h.N.convert(this._aroundCenter?l.center:l.unproject(s)):h.N.convert(l.center),this._aroundPoint=l.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(this._delta!==0){const E=this._type==="wheel"&&Math.abs(this._delta)>Co?this._wheelZoomRate:this._defaultZoomRate;let A=2/(1+Math.exp(-Math.abs(this._delta*E)));this._delta<0&&A!==0&&(A=1/A);const R=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(R*A))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,l=this._startZoom,u=this._easing;let p,w=!1;const k=Y.now()-this._lastWheelEventTime;if(this._type==="wheel"&&l&&u&&k){const E=Math.min(k/200,1),A=u(E);p=h.y.number(l,s,A),E<1?this._frameId||(this._frameId=!0):w=!0}else p=s,w=!0;return this._active=!0,w&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!w,zoomDelta:p-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let s=h.b9;if(this._prevEase){const l=this._prevEase,u=(Y.now()-l.start)/l.duration,p=l.easing(u+.01)-l.easing(u),w=.27/Math.sqrt(p*p+1e-4)*.01,k=Math.sqrt(.0729-w*w);s=h.b8(w,k,.25,1)}return this._prevEase={start:Y.now(),duration:e,easing:s},s}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Qs{constructor(e,s){this._clickZoom=e,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ju{constructor(e){this._tr=new Li(e),this.reset()}reset(){this._active=!1}dblclick(e,s){return e.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(s)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qu{constructor(){this._tap=new Io({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,s,l){if(!this._swipePoint)if(this._tapTime){const u=s[0],p=e.timeStamp-this._tapTime<500,w=this._tapPoint.dist(u)<30;p&&w?l.length>0&&(this._swipePoint=u,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(e,s,l)}touchmove(e,s,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const u=s[0],p=u.y-this._swipePoint.y;return this._swipePoint=u,e.preventDefault(),this._active=!0,{zoomDelta:p/128}}}else this._tap.touchmove(e,s,l)}touchend(e,s,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const u=this._tap.touchend(e,s,l);u&&(this._tapTime=e.timeStamp,this._tapPoint=u)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class uu{constructor(e,s,l){this._el=e,this._mousePan=s,this._touchPan=l}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class sh{constructor(e,s,l){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=s,this._mousePitch=l}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class cu{constructor(e,s,l,u){this._el=e,this._touchZoom=s,this._touchRotate=l,this._tapDragZoom=u,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Mo{constructor(e,s){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=s,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=Z.create("div","maplibregl-cooperative-gesture-screen",e);let s=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(s=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const l=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),u=document.createElement("div");u.className="maplibregl-desktop-message",u.textContent=s,this._container.appendChild(u);const p=document.createElement("div");p.className="maplibregl-mobile-message",p.textContent=l,this._container.appendChild(p),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(Z.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,s){this._enabled&&(this._map.fire(new h.k("cooperativegestureprevented",{gestureType:e,originalEvent:s})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const Bi=f=>f.zoom||f.drag||f.pitch||f.rotate;class mt extends h.k{}function ss(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class hu{constructor(e,s){this.handleWindowEvent=u=>{this.handleEvent(u,`${u.type}Window`)},this.handleEvent=(u,p)=>{if(u.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const w=u.type==="renderFrame"?void 0:u,k={needsRenderFrame:!1},E={},A={},R=u.touches,B=R?this._getMapTouches(R):void 0,U=B?Z.touchPos(this._map.getCanvas(),B):Z.mousePos(this._map.getCanvas(),u);for(const{handlerName:J,handler:re,allowed:se}of this._handlers){if(!re.isEnabled())continue;let ce;this._blockedByActive(A,se,J)?re.reset():re[p||u.type]&&(ce=re[p||u.type](u,U,B),this.mergeHandlerResult(k,E,ce,J,w),ce&&ce.needsRenderFrame&&this._triggerRenderFrame()),(ce||re.isActive())&&(A[J]=re)}const G={};for(const J in this._previousActiveHandlers)A[J]||(G[J]=w);this._previousActiveHandlers=A,(Object.keys(G).length||ss(k))&&(this._changes.push([k,E,G]),this._triggerRenderFrame()),(Object.keys(A).length||ss(k))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:W}=k;W&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],W(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ko(e),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[u,p,w]of this._listeners)Z.addEventListener(u,p,u===document?this.handleWindowEvent:this.handleEvent,w)}destroy(){for(const[e,s,l]of this._listeners)Z.removeEventListener(e,s,e===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(e){const s=this._map,l=s.getCanvasContainer();this._add("mapEvent",new Wu(s,e));const u=s.boxZoom=new ii(s,e);this._add("boxZoom",u),e.interactive&&e.boxZoom&&u.enable();const p=s.cooperativeGestures=new Mo(s,e.cooperativeGestures);this._add("cooperativeGestures",p),e.cooperativeGestures&&p.enable();const w=new Ta(s),k=new Ju(s);s.doubleClickZoom=new Qs(k,w),this._add("tapZoom",w),this._add("clickZoom",k),e.interactive&&e.doubleClickZoom&&s.doubleClickZoom.enable();const E=new Qu;this._add("tapDragZoom",E);const A=s.touchPitch=new Po(s);this._add("touchPitch",A),e.interactive&&e.touchPitch&&s.touchPitch.enable(e.touchPitch);const R=ou(e),B=Rr(e);s.dragRotate=new sh(e,R,B),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",B,["mouseRotate"]),e.interactive&&e.dragRotate&&s.dragRotate.enable();const U=(({enable:ce,clickTolerance:ee})=>{const fe=new Ia({checkCorrectEvent:ye=>Z.mouseButton(ye)===0&&!ye.ctrlKey});return new Ws({clickTolerance:ee,move:(ye,be)=>({around:be,panDelta:be.sub(ye)}),activateOnStart:!0,moveStateManager:fe,enable:ce,assignEvents:yl})})(e),G=new Xs(e,s);s.dragPan=new uu(l,U,G),this._add("mousePan",U),this._add("touchPan",G,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&s.dragPan.enable(e.dragPan);const W=new Eo,J=new _l;s.touchZoomRotate=new cu(l,J,W,E),this._add("touchRotate",W,["touchPan","touchZoom"]),this._add("touchZoom",J,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&s.touchZoomRotate.enable(e.touchZoomRotate);const re=s.scrollZoom=new si(s,(()=>this._triggerRenderFrame()));this._add("scrollZoom",re,["mousePan"]),e.interactive&&e.scrollZoom&&s.scrollZoom.enable(e.scrollZoom);const se=s.keyboard=new Ri(s);this._add("keyboard",se),e.interactive&&e.keyboard&&s.keyboard.enable(),this._add("blockableMapEvent",new Yr(s))}_add(e,s,l){this._handlers.push({handlerName:e,handler:s,allowed:l}),this._handlersById[e]=s}stop(e){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Bi(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,s,l){for(const u in e)if(u!==l&&(!s||s.indexOf(u)<0))return!0;return!1}_getMapTouches(e){const s=[];for(const l of e)this._el.contains(l.target)&&s.push(l);return s}mergeHandlerResult(e,s,l,u,p){if(!l)return;h.e(e,l);const w={handlerName:u,originalEvent:l.originalEvent||p};l.zoomDelta!==void 0&&(s.zoom=w),l.panDelta!==void 0&&(s.drag=w),l.pitchDelta!==void 0&&(s.pitch=w),l.bearingDelta!==void 0&&(s.rotate=w)}_applyChanges(){const e={},s={},l={};for(const[u,p,w]of this._changes)u.panDelta&&(e.panDelta=(e.panDelta||new h.P(0,0))._add(u.panDelta)),u.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+u.zoomDelta),u.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+u.bearingDelta),u.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+u.pitchDelta),u.around!==void 0&&(e.around=u.around),u.pinchAround!==void 0&&(e.pinchAround=u.pinchAround),u.noInertia&&(e.noInertia=u.noInertia),h.e(s,p),h.e(l,w);this._updateMapTransform(e,s,l),this._changes=[]}_updateMapTransform(e,s,l){const u=this._map,p=u._getTransformForUpdate(),w=u.terrain;if(!(ss(e)||w&&this._terrainMovement))return this._fireEvents(s,l,!0);let{panDelta:k,zoomDelta:E,bearingDelta:A,pitchDelta:R,around:B,pinchAround:U}=e;U!==void 0&&(B=U),u._stop(!0),B=B||u.transform.centerPoint;const G=p.pointLocation(k?B.sub(k):B);A&&(p.bearing+=A),R&&(p.pitch+=R),E&&(p.zoom+=E),w?this._terrainMovement||!s.drag&&!s.zoom?s.drag&&this._terrainMovement?p.center=p.pointLocation(p.centerPoint.sub(k)):p.setLocationAtPoint(G,B):(this._terrainMovement=!0,this._map._elevationFreeze=!0,p.setLocationAtPoint(G,B)):p.setLocationAtPoint(G,B),u._applyUpdatedTransform(p),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(s,l,!0)}_fireEvents(e,s,l){const u=Bi(this._eventsInProgress),p=Bi(e),w={};for(const B in e){const{originalEvent:U}=e[B];this._eventsInProgress[B]||(w[`${B}start`]=U),this._eventsInProgress[B]=e[B]}!u&&p&&this._fireEvent("movestart",p.originalEvent);for(const B in w)this._fireEvent(B,w[B]);p&&this._fireEvent("move",p.originalEvent);for(const B in e){const{originalEvent:U}=e[B];this._fireEvent(B,U)}const k={};let E;for(const B in this._eventsInProgress){const{handlerName:U,originalEvent:G}=this._eventsInProgress[B];this._handlersById[U].isActive()||(delete this._eventsInProgress[B],E=s[U]||G,k[`${B}end`]=E)}for(const B in k)this._fireEvent(B,k[B]);const A=Bi(this._eventsInProgress),R=(u||p)&&!A;if(R&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const B=this._map._getTransformForUpdate();B.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(B)}if(l&&R){this._updatingCamera=!0;const B=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=G=>G!==0&&-this._bearingSnap<G&&G<this._bearingSnap;!B||!B.essential&&Y.prefersReducedMotion?(this._map.fire(new h.k("moveend",{originalEvent:E})),U(this._map.getBearing())&&this._map.resetNorth()):(U(B.bearing||this._map.getBearing())&&(B.bearing=0),B.freezeElevation=!0,this._map.easeTo(B,{originalEvent:E})),this._updatingCamera=!1}}_fireEvent(e,s){this._map.fire(new h.k(e,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{delete this._frameId,this.handleEvent(new mt("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class to extends h.E{constructor(e,s){super(),this._renderFrameCallback=()=>{const l=Math.min((Y.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(l)),l<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=s.bearingSnap,this.on("moveend",(()=>{delete this._requestedCameraState}))}getCenter(){return new h.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,s){return this.jumpTo({center:e},s)}panBy(e,s,l){return e=h.P.convert(e).mult(-1),this.panTo(this.transform.center,h.e({offset:e},s),l)}panTo(e,s,l){return this.easeTo(h.e({center:e},s),l)}getZoom(){return this.transform.zoom}setZoom(e,s){return this.jumpTo({zoom:e},s),this}zoomTo(e,s,l){return this.easeTo(h.e({zoom:e},s),l)}zoomIn(e,s){return this.zoomTo(this.getZoom()+1,e,s),this}zoomOut(e,s){return this.zoomTo(this.getZoom()-1,e,s),this}getBearing(){return this.transform.bearing}setBearing(e,s){return this.jumpTo({bearing:e},s),this}getPadding(){return this.transform.padding}setPadding(e,s){return this.jumpTo({padding:e},s),this}rotateTo(e,s,l){return this.easeTo(h.e({bearing:e},s),l)}resetNorth(e,s){return this.rotateTo(0,h.e({duration:1e3},e),s),this}resetNorthPitch(e,s){return this.easeTo(h.e({bearing:0,pitch:0,duration:1e3},e),s),this}snapToNorth(e,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,s):this}getPitch(){return this.transform.pitch}setPitch(e,s){return this.jumpTo({pitch:e},s),this}cameraForBounds(e,s){e=Ee.convert(e).adjustAntiMeridian();const l=s&&s.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),l,s)}_cameraForBoxAndBearing(e,s,l,u){const p={top:0,bottom:0,right:0,left:0};if(typeof(u=h.e({padding:p,offset:[0,0],maxZoom:this.transform.maxZoom},u)).padding=="number"){const tt=u.padding;u.padding={top:tt,bottom:tt,right:tt,left:tt}}u.padding=h.e(p,u.padding);const w=this.transform,k=w.padding,E=new Ee(e,s),A=w.project(E.getNorthWest()),R=w.project(E.getNorthEast()),B=w.project(E.getSouthEast()),U=w.project(E.getSouthWest()),G=h.ba(-l),W=A.rotate(G),J=R.rotate(G),re=B.rotate(G),se=U.rotate(G),ce=new h.P(Math.max(W.x,J.x,se.x,re.x),Math.max(W.y,J.y,se.y,re.y)),ee=new h.P(Math.min(W.x,J.x,se.x,re.x),Math.min(W.y,J.y,se.y,re.y)),fe=ce.sub(ee),ye=(w.width-(k.left+k.right+u.padding.left+u.padding.right))/fe.x,be=(w.height-(k.top+k.bottom+u.padding.top+u.padding.bottom))/fe.y;if(be<0||ye<0)return void h.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Fe=Math.min(w.scaleZoom(w.scale*Math.min(ye,be)),u.maxZoom),Ge=h.P.convert(u.offset),Qe=new h.P((u.padding.left-u.padding.right)/2,(u.padding.top-u.padding.bottom)/2).rotate(h.ba(l)),ct=Ge.add(Qe).mult(w.scale/w.zoomScale(Fe));return{center:w.unproject(A.add(B).div(2).sub(ct)),zoom:Fe,bearing:l}}fitBounds(e,s,l){return this._fitInternal(this.cameraForBounds(e,s),s,l)}fitScreenCoordinates(e,s,l,u,p){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(h.P.convert(e)),this.transform.pointLocation(h.P.convert(s)),l,u),u,p)}_fitInternal(e,s,l){return e?(delete(s=h.e(e,s)).padding,s.linear?this.easeTo(s,l):this.flyTo(s,l)):this}jumpTo(e,s){this.stop();const l=this._getTransformForUpdate();let u=!1,p=!1,w=!1;return"zoom"in e&&l.zoom!==+e.zoom&&(u=!0,l.zoom=+e.zoom),e.center!==void 0&&(l.center=h.N.convert(e.center)),"bearing"in e&&l.bearing!==+e.bearing&&(p=!0,l.bearing=+e.bearing),"pitch"in e&&l.pitch!==+e.pitch&&(w=!0,l.pitch=+e.pitch),e.padding==null||l.isPaddingEqual(e.padding)||(l.padding=e.padding),this._applyUpdatedTransform(l),this.fire(new h.k("movestart",s)).fire(new h.k("move",s)),u&&this.fire(new h.k("zoomstart",s)).fire(new h.k("zoom",s)).fire(new h.k("zoomend",s)),p&&this.fire(new h.k("rotatestart",s)).fire(new h.k("rotate",s)).fire(new h.k("rotateend",s)),w&&this.fire(new h.k("pitchstart",s)).fire(new h.k("pitch",s)).fire(new h.k("pitchend",s)),this.fire(new h.k("moveend",s))}calculateCameraOptionsFromTo(e,s,l,u=0){const p=h.Z.fromLngLat(e,s),w=h.Z.fromLngLat(l,u),k=w.x-p.x,E=w.y-p.y,A=w.z-p.z,R=Math.hypot(k,E,A);if(R===0)throw new Error("Can't calculate camera options with same From and To");const B=Math.hypot(k,E),U=this.transform.scaleZoom(this.transform.cameraToCenterDistance/R/this.transform.tileSize),G=180*Math.atan2(k,-E)/Math.PI;let W=180*Math.acos(B/R)/Math.PI;return W=A<0?90-W:90+W,{center:w.toLngLat(),zoom:U,pitch:W,bearing:G}}easeTo(e,s){var l;this._stop(!1,e.easeId),((e=h.e({offset:[0,0],duration:500,easing:h.b9},e)).animate===!1||!e.essential&&Y.prefersReducedMotion)&&(e.duration=0);const u=this._getTransformForUpdate(),p=u.zoom,w=u.bearing,k=u.pitch,E=u.padding,A="bearing"in e?this._normalizeBearing(e.bearing,w):w,R="pitch"in e?+e.pitch:k,B="padding"in e?e.padding:u.padding,U=h.P.convert(e.offset);let G=u.centerPoint.add(U);const W=u.pointLocation(G),{center:J,zoom:re}=u.getConstrained(h.N.convert(e.center||W),(l=e.zoom)!==null&&l!==void 0?l:p);this._normalizeCenter(J,u);const se=u.project(W),ce=u.project(J).sub(se),ee=u.zoomScale(re-p);let fe,ye;e.around&&(fe=h.N.convert(e.around),ye=u.locationPoint(fe));const be={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||re!==p,this._rotating=this._rotating||w!==A,this._pitching=this._pitching||R!==k,this._padding=!u.isPaddingEqual(B),this._easeId=e.easeId,this._prepareEase(s,e.noMoveStart,be),this.terrain&&this._prepareElevation(J),this._ease((Fe=>{if(this._zooming&&(u.zoom=h.y.number(p,re,Fe)),this._rotating&&(u.bearing=h.y.number(w,A,Fe)),this._pitching&&(u.pitch=h.y.number(k,R,Fe)),this._padding&&(u.interpolatePadding(E,B,Fe),G=u.centerPoint.add(U)),this.terrain&&!e.freezeElevation&&this._updateElevation(Fe),fe)u.setLocationAtPoint(fe,ye);else{const Ge=u.zoomScale(u.zoom-p),Qe=re>p?Math.min(2,ee):Math.max(.5,ee),ct=Math.pow(Qe,1-Fe),tt=u.unproject(se.add(ce.mult(Fe*ct)).mult(Ge));u.setLocationAtPoint(u.renderWorldCopies?tt.wrap():tt,G)}this._applyUpdatedTransform(u),this._fireMoveEvents(s)}),(Fe=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(s,Fe)}),e),this}_prepareEase(e,s,l={}){this._moving=!0,s||l.moving||this.fire(new h.k("movestart",e)),this._zooming&&!l.zooming&&this.fire(new h.k("zoomstart",e)),this._rotating&&!l.rotating&&this.fire(new h.k("rotatestart",e)),this._pitching&&!l.pitching&&this.fire(new h.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const s=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&s!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(l-(s-(l*e+this._elevationStart))/(1-e)),this._elevationTarget=s}this.transform.elevation=h.y.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){const s=e.getCameraPosition(),l=this.terrain.getElevationForLngLatZoom(s.lngLat,e.zoom);if(s.altitude<l){const u=this.calculateCameraOptionsFromTo(s.lngLat,l,e.center,e.elevation);return{pitch:u.pitch,zoom:u.zoom}}return{}}_applyUpdatedTransform(e){const s=[];if(this.terrain&&s.push((u=>this._elevateCameraIfInsideTerrain(u))),this.transformCameraUpdate&&s.push((u=>this.transformCameraUpdate(u))),!s.length)return;const l=e.clone();for(const u of s){const p=l.clone(),{center:w,zoom:k,pitch:E,bearing:A,elevation:R}=u(p);w&&(p.center=w),k!==void 0&&(p.zoom=k),E!==void 0&&(p.pitch=E),A!==void 0&&(p.bearing=A),R!==void 0&&(p.elevation=R),l.apply(p)}this.transform.apply(l)}_fireMoveEvents(e){this.fire(new h.k("move",e)),this._zooming&&this.fire(new h.k("zoom",e)),this._rotating&&this.fire(new h.k("rotate",e)),this._pitching&&this.fire(new h.k("pitch",e))}_afterEase(e,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId;const l=this._zooming,u=this._rotating,p=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,l&&this.fire(new h.k("zoomend",e)),u&&this.fire(new h.k("rotateend",e)),p&&this.fire(new h.k("pitchend",e)),this.fire(new h.k("moveend",e))}flyTo(e,s){var l;if(!e.essential&&Y.prefersReducedMotion){const st=h.M(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(st,s)}this.stop(),e=h.e({offset:[0,0],speed:1.2,curve:1.42,easing:h.b9},e);const u=this._getTransformForUpdate(),p=u.zoom,w=u.bearing,k=u.pitch,E=u.padding,A="bearing"in e?this._normalizeBearing(e.bearing,w):w,R="pitch"in e?+e.pitch:k,B="padding"in e?e.padding:u.padding,U=h.P.convert(e.offset);let G=u.centerPoint.add(U);const W=u.pointLocation(G),{center:J,zoom:re}=u.getConstrained(h.N.convert(e.center||W),(l=e.zoom)!==null&&l!==void 0?l:p);this._normalizeCenter(J,u);const se=u.zoomScale(re-p),ce=u.project(W),ee=u.project(J).sub(ce);let fe=e.curve;const ye=Math.max(u.width,u.height),be=ye/se,Fe=ee.mag();if("minZoom"in e){const st=h.ac(Math.min(e.minZoom,p,re),u.minZoom,u.maxZoom),Ot=ye/u.zoomScale(st-p);fe=Math.sqrt(Ot/Fe*2)}const Ge=fe*fe;function Qe(st){const Ot=(be*be-ye*ye+(st?-1:1)*Ge*Ge*Fe*Fe)/(2*(st?be:ye)*Ge*Fe);return Math.log(Math.sqrt(Ot*Ot+1)-Ot)}function ct(st){return(Math.exp(st)-Math.exp(-st))/2}function tt(st){return(Math.exp(st)+Math.exp(-st))/2}const Xe=Qe(!1);let _t=function(st){return tt(Xe)/tt(Xe+fe*st)},Nt=function(st){return ye*((tt(Xe)*(ct(Ot=Xe+fe*st)/tt(Ot))-ct(Xe))/Ge)/Fe;var Ot},nt=(Qe(!0)-Xe)/fe;if(Math.abs(Fe)<1e-6||!isFinite(nt)){if(Math.abs(ye-be)<1e-6)return this.easeTo(e,s);const st=be<ye?-1:1;nt=Math.abs(Math.log(be/ye))/fe,Nt=()=>0,_t=Ot=>Math.exp(st*fe*Ot)}return e.duration="duration"in e?+e.duration:1e3*nt/("screenSpeed"in e?+e.screenSpeed/fe:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=w!==A,this._pitching=R!==k,this._padding=!u.isPaddingEqual(B),this._prepareEase(s,!1),this.terrain&&this._prepareElevation(J),this._ease((st=>{const Ot=st*nt,Pr=1/_t(Ot);u.zoom=st===1?re:p+u.scaleZoom(Pr),this._rotating&&(u.bearing=h.y.number(w,A,st)),this._pitching&&(u.pitch=h.y.number(k,R,st)),this._padding&&(u.interpolatePadding(E,B,st),G=u.centerPoint.add(U)),this.terrain&&!e.freezeElevation&&this._updateElevation(st);const Gt=st===1?J:u.unproject(ce.add(ee.mult(Nt(Ot))).mult(Pr));u.setLocationAtPoint(u.renderWorldCopies?Gt.wrap():Gt,G),this._applyUpdatedTransform(u),this._fireMoveEvents(s)}),(()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(s)}),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,s){var l;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const u=this._onEaseEnd;delete this._onEaseEnd,u.call(this,s)}return e||(l=this.handlers)===null||l===void 0||l.stop(!1),this}_ease(e,s,l){l.animate===!1||l.duration===0?(e(1),s()):(this._easeStart=Y.now(),this._easeOptions=l,this._onEaseFrame=e,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,s){e=h.b3(e,-180,180);const l=Math.abs(e-s);return Math.abs(e-360-s)<l&&(e-=360),Math.abs(e+360-s)<l&&(e+=360),e}_normalizeCenter(e,s){if(!s.renderWorldCopies||s.lngRange)return;const l=e.lng-s.center.lng;e.lng+=l>180?-360:l<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(h.N.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}const Gn={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class As{constructor(e=Gn){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=s=>{!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"&&s.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=Z.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=Z.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Z.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){Z.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,s){const l=this._map._getUIString(`AttributionControl.${s}`);e.title=l,e.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map((u=>typeof u!="string"?"":u))):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}const s=this._map.style.sourceCaches;for(const u in s){const p=s[u];if(p.used||p.usedForTerrain){const w=p.getSource();w.attribution&&e.indexOf(w.attribution)<0&&e.push(w.attribution)}}e=e.filter((u=>String(u).trim())),e.sort(((u,p)=>u.length-p.length)),e=e.filter(((u,p)=>{for(let w=p+1;w<e.length;w++)if(e[w].indexOf(u)>=0)return!1;return!0}));const l=e.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,e.length?(this._innerContainer.innerHTML=l,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class as{constructor(e={}){this._updateCompact=()=>{const s=this._container.children;if(s.length){const l=s[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=Z.create("div","maplibregl-ctrl");const s=Z.create("a","maplibregl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){Z.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class or{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const s=++this._id;return this._queue.push({callback:e,id:s,cancelled:!1}),s}remove(e){const s=this._currentlyRunning,l=s?this._queue.concat(s):this._queue;for(const u of l)if(u.id===e)return void(u.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const l of s)if(!l.cancelled&&(l.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var ec=h.Y([{name:"a_pos3d",type:"Int16",components:3}]);class od extends h.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,s){this.sourceCache.update(e,s),this._renderableTilesKeys=[];const l={};for(const u of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s}))l[u.key]=!0,this._renderableTilesKeys.push(u.key),this._tiles[u.key]||(u.posMatrix=new Float64Array(16),h.aP(u.posMatrix,0,h.X,0,h.X,0,1),this._tiles[u.key]=new ma(u,this.tileSize));for(const u in this._tiles)l[u]||delete this._tiles[u]}freeRtt(e){for(const s in this._tiles){const l=this._tiles[s];(!e||l.tileID.equals(e)||l.tileID.isChildOf(e)||e.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((e=>this.getTileByID(e)))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const s={};for(const l of this._renderableTilesKeys){const u=this._tiles[l].tileID;if(u.canonical.equals(e.canonical)){const p=e.clone();p.posMatrix=new Float64Array(16),h.aP(p.posMatrix,0,h.X,0,h.X,0,1),s[l]=p}else if(u.canonical.isChildOf(e.canonical)){const p=e.clone();p.posMatrix=new Float64Array(16);const w=u.canonical.z-e.canonical.z,k=u.canonical.x-(u.canonical.x>>w<<w),E=u.canonical.y-(u.canonical.y>>w<<w),A=h.X>>w;h.aP(p.posMatrix,0,A,0,A,0,1),h.J(p.posMatrix,p.posMatrix,[-k*A,-E*A,0]),s[l]=p}else if(e.canonical.isChildOf(u.canonical)){const p=e.clone();p.posMatrix=new Float64Array(16);const w=e.canonical.z-u.canonical.z,k=e.canonical.x-(e.canonical.x>>w<<w),E=e.canonical.y-(e.canonical.y>>w<<w),A=h.X>>w;h.aP(p.posMatrix,0,h.X,0,h.X,0,1),h.J(p.posMatrix,p.posMatrix,[k*A,E*A,0]),h.K(p.posMatrix,p.posMatrix,[1/2**w,1/2**w,0]),s[l]=p}}return s}getSourceTile(e,s){const l=this.sourceCache._source;let u=e.overscaledZ-this.deltaZoom;if(u>l.maxzoom&&(u=l.maxzoom),u<l.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(u).key);let p=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!p||!p.dem)&&s)for(;u>=l.minzoom&&(!p||!p.dem);)p=this.sourceCache.getTileByID(e.scaledTo(u--).key);return p}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter((s=>s.timeAdded>=e))}}class ea{constructor(e,s,l){this.painter=e,this.sourceCache=new od(s),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,s,l,u=h.X){var p;if(!(s>=0&&s<u&&l>=0&&l<u))return 0;const w=this.getTerrainData(e),k=(p=w.tile)===null||p===void 0?void 0:p.dem;if(!k)return 0;const E=(function(W,J,re){var se=J[0],ce=J[1];return W[0]=re[0]*se+re[4]*ce+re[12],W[1]=re[1]*se+re[5]*ce+re[13],W})([],[s/u*h.X,l/u*h.X],w.u_terrain_matrix),A=[E[0]*k.dim,E[1]*k.dim],R=Math.floor(A[0]),B=Math.floor(A[1]),U=A[0]-R,G=A[1]-B;return k.get(R,B)*(1-U)*(1-G)+k.get(R+1,B)*U*(1-G)+k.get(R,B+1)*(1-U)*G+k.get(R+1,B+1)*U*G}getElevationForLngLatZoom(e,s){if(!h.bb(s,e.wrap()))return 0;const{tileID:l,mercatorX:u,mercatorY:p}=this._getOverscaledTileIDFromLngLatZoom(e,s);return this.getElevation(l,u%h.X,p%h.X,h.X)}getElevation(e,s,l,u=h.X){return this.getDEMElevation(e,s,l,u)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const u=this.painter.context,p=new h.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new vt(u,p,u.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new vt(u,new h.R({width:1,height:1}),u.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=h.an([])}const s=this.sourceCache.getSourceTile(e,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const u=this.painter.context;s.demTexture=this.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new vt(u,s.dem.getPixels(),u.gl.RGBA,{premultiply:!1}),s.demTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const l=s&&s+s.tileID.key+e.key;if(l&&!this._demMatrixCache[l]){const u=this.sourceCache.sourceCache._source.maxzoom;let p=e.canonical.z-s.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=u?p=e.canonical.z-u:h.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const w=e.canonical.x-(e.canonical.x>>p<<p),k=e.canonical.y-(e.canonical.y>>p<<p),E=h.bc(new Float64Array(16),[1/(h.X<<p),1/(h.X<<p),0]);h.J(E,E,[w*h.X,k*h.X,0]),this._demMatrixCache[e.key]={matrix:E,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getFramebuffer(e){const s=this.painter,l=s.width/devicePixelRatio,u=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===u||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new vt(s.context,{width:l,height:u,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new vt(s.context,{width:l,height:u,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(l,u,!0,!1),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,l,u))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let p=0,w=0;p<this._coordsTextureSize;p++)for(let k=0;k<this._coordsTextureSize;k++,w+=4)s[w+0]=255&k,s[w+1]=255&p,s[w+2]=k>>8<<4|p>>8,s[w+3]=0;const l=new h.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),u=new vt(e,l,e.gl.RGBA,{premultiply:!1});return u.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=u,u}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const s=new Uint8Array(4),l=this.painter.context,u=l.gl,p=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),w=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),k=Math.round(this.painter.height/devicePixelRatio);l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),u.readPixels(p,k-w-1,1,1,u.RGBA,u.UNSIGNED_BYTE,s),l.bindFramebuffer.set(null);const E=s[0]+(s[2]>>4<<8),A=s[1]+((15&s[2])<<8),R=this.coordsIndex[255-s[3]],B=R&&this.sourceCache.getTileByID(R);if(!B)return null;const U=this._coordsTextureSize,G=(1<<B.tileID.canonical.z)*U;return new h.Z((B.tileID.canonical.x*U+E)/G+B.tileID.wrap,(B.tileID.canonical.y*U+A)/G,this.getElevation(B.tileID,E,A,U))}depthAtPoint(e){const s=new Uint8Array(4),l=this.painter.context,u=l.gl;return l.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),u.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,u.RGBA,u.UNSIGNED_BYTE,s),l.bindFramebuffer.set(null),(s[0]/16777216+s[1]/65536+s[2]/256+s[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,s=new h.bd,l=new h.aY,u=this.meshSize,p=h.X/u,w=u*u;for(let B=0;B<=u;B++)for(let U=0;U<=u;U++)s.emplaceBack(U*p,B*p,0);for(let B=0;B<w;B+=u+1)for(let U=0;U<u;U++)l.emplaceBack(U+B,u+U+B+1,u+U+B+2),l.emplaceBack(U+B,u+U+B+2,U+B+1);const k=s.length,E=k+2*(u+1);for(const B of[0,1])for(let U=0;U<=u;U++)for(const G of[0,1])s.emplaceBack(U*p,B*h.X,G);for(let B=0;B<2*u;B+=2)l.emplaceBack(E+B,E+B+1,E+B+3),l.emplaceBack(E+B,E+B+3,E+B+2),l.emplaceBack(k+B,k+B+3,k+B+1),l.emplaceBack(k+B,k+B+2,k+B+3);const A=s.length,R=A+2*(u+1);for(const B of[0,1])for(let U=0;U<=u;U++)for(const G of[0,1])s.emplaceBack(B*h.X,U*p,G);for(let B=0;B<2*u;B+=2)l.emplaceBack(A+B,A+B+1,A+B+3),l.emplaceBack(A+B,A+B+3,A+B+2),l.emplaceBack(R+B,R+B+3,R+B+1),l.emplaceBack(R+B,R+B+2,R+B+3);return this._mesh=new ni(e.createVertexBuffer(s,ec.members),e.createIndexBuffer(l),h.a0.simpleSegment(0,0,s.length,l.length)),this._mesh}getMeshFrameDelta(e){return 2*Math.PI*h.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,s){var l;const{tileID:u}=this._getOverscaledTileIDFromLngLatZoom(e,s);return(l=this.getMinMaxElevation(u).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(e){const s=this.getTerrainData(e).tile,l={minElevation:null,maxElevation:null};return s&&s.dem&&(l.minElevation=s.dem.min*this.exaggeration,l.maxElevation=s.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(e,s){const l=h.Z.fromLngLat(e.wrap()),u=(1<<s)*h.X,p=l.x*u,w=l.y*u,k=Math.floor(p/h.X),E=Math.floor(w/h.X);return{tileID:new h.S(s,0,s,k,E),mercatorX:p,mercatorY:w}}}class vl{constructor(e,s,l){this._context=e,this._size=s,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const s=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new vt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),s.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),s.colorAttachment.set(l.texture),{id:e,fbo:s,texture:l,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((s=>e.id!==s)),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const s of this._recentlyUsed)if(!this._objects[s].inUse)return this._objects[s];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((e=>!e.inUse))===!1}}const os={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class xl{constructor(e,s){this.painter=e,this.terrain=s,this.pool=new vl(e.context,30,s.sourceCache.tileSize*s.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,s){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter((l=>!e._layers[l].isHidden(s))),this._coordsDescendingInv={};for(const l in e.sourceCaches){this._coordsDescendingInv[l]={};const u=e.sourceCaches[l].getVisibleCoordinates();for(const p of u){const w=this.terrain.sourceCache.getTerrainCoords(p);for(const k in w)this._coordsDescendingInv[l][k]||(this._coordsDescendingInv[l][k]=[]),this._coordsDescendingInv[l][k].push(w[k])}}this._coordsDescendingInvStr={};for(const l of e._order){const u=e._layers[l],p=u.source;if(os[u.type]&&!this._coordsDescendingInvStr[p]){this._coordsDescendingInvStr[p]={};for(const w in this._coordsDescendingInv[p])this._coordsDescendingInvStr[p][w]=this._coordsDescendingInv[p][w].map((k=>k.key)).sort().join()}}for(const l of this._renderableTiles)for(const u in this._coordsDescendingInvStr){const p=this._coordsDescendingInvStr[u][l.tileID.key];p&&p!==l.rttCoords[u]&&(l.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const s=e.type,l=this.painter,u=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(os[s]&&(this._prevType&&os[this._prevType]||this._stacks.push([]),this._prevType=s,this._stacks[this._stacks.length-1].push(e.id),!u))return!0;if(os[this._prevType]||os[s]&&u){this._prevType=s;const p=this._stacks.length-1,w=this._stacks[p]||[];for(const k of this._renderableTiles){if(this.pool.isFull()&&(nh(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(k),k.rtt[p]){const A=this.pool.getObjectForId(k.rtt[p].id);if(A.stamp===k.rtt[p].stamp){this.pool.useObject(A);continue}}const E=this.pool.getOrCreateFreeObject();this.pool.useObject(E),this.pool.stampObject(E),k.rtt[p]={id:E.id,stamp:E.stamp},l.context.bindFramebuffer.set(E.fbo.framebuffer),l.context.clear({color:h.aM.transparent,stencil:0}),l.currentStencilSource=void 0;for(let A=0;A<w.length;A++){const R=l.style._layers[w[A]],B=R.source?this._coordsDescendingInv[R.source][k.tileID.key]:[k.tileID];l.context.viewport.set([0,0,E.fbo.width,E.fbo.height]),l._renderTileClippingMasks(R,B),l.renderLayer(l,l.style.sourceCaches[R.source],R,B),R.source&&(k.rttCoords[R.source]=this._coordsDescendingInvStr[R.source][k.tileID.key])}}return nh(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),os[s]}return!1}}const wl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},ro=X,Ea={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Gn,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:h.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},Br=f=>{f.touchstart=f.dragStart,f.touchmoveWindow=f.dragMove,f.touchend=f.dragEnd},jr={showCompass:!0,showZoom:!0,visualizePitch:!1};class Pa{constructor(e,s,l=!1){this.mousedown=w=>{this.startMouse(h.e({},w,{ctrlKey:!0,preventDefault:()=>w.preventDefault()}),Z.mousePos(this.element,w)),Z.addEventListener(window,"mousemove",this.mousemove),Z.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=w=>{this.moveMouse(w,Z.mousePos(this.element,w))},this.mouseup=w=>{this.mouseRotate.dragEnd(w),this.mousePitch&&this.mousePitch.dragEnd(w),this.offTemp()},this.touchstart=w=>{w.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Z.touchPos(this.element,w.targetTouches)[0],this.startTouch(w,this._startPos),Z.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),Z.addEventListener(window,"touchend",this.touchend))},this.touchmove=w=>{w.targetTouches.length!==1?this.reset():(this._lastPos=Z.touchPos(this.element,w.targetTouches)[0],this.moveTouch(w,this._lastPos))},this.touchend=w=>{w.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const u=e.dragRotate._mouseRotate.getClickTolerance(),p=e.dragRotate._mousePitch.getClickTolerance();this.element=s,this.mouseRotate=ou({clickTolerance:u,enable:!0}),this.touchRotate=(({enable:w,clickTolerance:k,bearingDegreesPerPixelMoved:E=.8})=>{const A=new Yu;return new Ws({clickTolerance:k,move:(R,B)=>({bearingDelta:(B.x-R.x)*E}),moveStateManager:A,enable:w,assignEvents:Br})})({clickTolerance:u,enable:!0}),this.map=e,l&&(this.mousePitch=Rr({clickTolerance:p,enable:!0}),this.touchPitch=(({enable:w,clickTolerance:k,pitchDegreesPerPixelMoved:E=-.5})=>{const A=new Yu;return new Ws({clickTolerance:k,move:(R,B)=>({pitchDelta:(B.y-R.y)*E}),moveStateManager:A,enable:w,assignEvents:Br})})({clickTolerance:p,enable:!0})),Z.addEventListener(s,"mousedown",this.mousedown),Z.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),Z.addEventListener(s,"touchcancel",this.reset)}startMouse(e,s){this.mouseRotate.dragStart(e,s),this.mousePitch&&this.mousePitch.dragStart(e,s),Z.disableDrag()}startTouch(e,s){this.touchRotate.dragStart(e,s),this.touchPitch&&this.touchPitch.dragStart(e,s),Z.disableDrag()}moveMouse(e,s){const l=this.map,{bearingDelta:u}=this.mouseRotate.dragMove(e,s)||{};if(u&&l.setBearing(l.getBearing()+u),this.mousePitch){const{pitchDelta:p}=this.mousePitch.dragMove(e,s)||{};p&&l.setPitch(l.getPitch()+p)}}moveTouch(e,s){const l=this.map,{bearingDelta:u}=this.touchRotate.dragMove(e,s)||{};if(u&&l.setBearing(l.getBearing()+u),this.touchPitch){const{pitchDelta:p}=this.touchPitch.dragMove(e,s)||{};p&&l.setPitch(l.getPitch()+p)}}off(){const e=this.element;Z.removeEventListener(e,"mousedown",this.mousedown),Z.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),Z.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Z.removeEventListener(window,"touchend",this.touchend),Z.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){Z.enableDrag(),Z.removeEventListener(window,"mousemove",this.mousemove),Z.removeEventListener(window,"mouseup",this.mouseup),Z.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Z.removeEventListener(window,"touchend",this.touchend)}}let Cr;function ur(f,e,s){const l=new h.N(f.lng,f.lat);if(f=new h.N(f.lng,f.lat),e){const u=new h.N(f.lng-360,f.lat),p=new h.N(f.lng+360,f.lat),w=s.locationPoint(f).distSqr(e);s.locationPoint(u).distSqr(e)<w?f=u:s.locationPoint(p).distSqr(e)<w&&(f=p)}for(;Math.abs(f.lng-s.center.lng)>180;){const u=s.locationPoint(f);if(u.x>=0&&u.y>=0&&u.x<=s.width&&u.y<=s.height)break;f.lng>s.center.lng?f.lng-=360:f.lng+=360}return f.lng!==l.lng&&s.locationPoint(f).y>s.height/2-s.getHorizon()?f:l}const Fi={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ta(f,e,s){const l=f.classList;for(const u in Fi)l.remove(`maplibregl-${s}-anchor-${u}`);l.add(`maplibregl-${s}-anchor-${e}`)}class Cn extends h.E{constructor(e){if(super(),this._onKeyPress=s=>{const l=s.code,u=s.charCode||s.keyCode;l!=="Space"&&l!=="Enter"&&u!==32&&u!==13||this.togglePopup()},this._onMapClick=s=>{const l=s.originalEvent.target,u=this._element;this._popup&&(l===u||u.contains(l))&&this.togglePopup()},this._update=s=>{var l;if(!this._map)return;const u=this._map.loaded()&&!this._map.isMoving();((s==null?void 0:s.type)==="terrain"||(s==null?void 0:s.type)==="render"&&!u)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?ur(this._lngLat,this._flatPos,this._map.transform):(l=this._lngLat)===null||l===void 0?void 0:l.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let p="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?p=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(p=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let w="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?w="rotateX(0deg)":this._pitchAlignment==="map"&&(w=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||s&&s.type!=="moveend"||(this._pos=this._pos.round()),Z.setTransform(this._element,`${Fi[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${w} ${p}`),Y.frameAsync(new AbortController).then((()=>{this._updateOpacity(s&&s.type==="moveend")})).catch((()=>{}))},this._onMove=s=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new h.k("dragstart"))),this.fire(new h.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new h.k("dragend")),this._state="inactive"},this._addDragHandler=s=>{this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=h.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=Z.create("div");const s=Z.createNS("http://www.w3.org/2000/svg","svg"),l=41,u=27;s.setAttributeNS(null,"display","block"),s.setAttributeNS(null,"height",`${l}px`),s.setAttributeNS(null,"width",`${u}px`),s.setAttributeNS(null,"viewBox",`0 0 ${u} ${l}`);const p=Z.createNS("http://www.w3.org/2000/svg","g");p.setAttributeNS(null,"stroke","none"),p.setAttributeNS(null,"stroke-width","1"),p.setAttributeNS(null,"fill","none"),p.setAttributeNS(null,"fill-rule","evenodd");const w=Z.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"fill-rule","nonzero");const k=Z.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"transform","translate(3.0, 29.0)"),k.setAttributeNS(null,"fill","#000000");const E=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const se of E){const ce=Z.createNS("http://www.w3.org/2000/svg","ellipse");ce.setAttributeNS(null,"opacity","0.04"),ce.setAttributeNS(null,"cx","10.5"),ce.setAttributeNS(null,"cy","5.80029008"),ce.setAttributeNS(null,"rx",se.rx),ce.setAttributeNS(null,"ry",se.ry),k.appendChild(ce)}const A=Z.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill",this._color);const R=Z.createNS("http://www.w3.org/2000/svg","path");R.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),A.appendChild(R);const B=Z.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"opacity","0.25"),B.setAttributeNS(null,"fill","#000000");const U=Z.createNS("http://www.w3.org/2000/svg","path");U.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),B.appendChild(U);const G=Z.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"transform","translate(6.0, 7.0)"),G.setAttributeNS(null,"fill","#FFFFFF");const W=Z.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"transform","translate(8.0, 8.0)");const J=Z.createNS("http://www.w3.org/2000/svg","circle");J.setAttributeNS(null,"fill","#000000"),J.setAttributeNS(null,"opacity","0.25"),J.setAttributeNS(null,"cx","5.5"),J.setAttributeNS(null,"cy","5.5"),J.setAttributeNS(null,"r","5.4999962");const re=Z.createNS("http://www.w3.org/2000/svg","circle");re.setAttributeNS(null,"fill","#FFFFFF"),re.setAttributeNS(null,"cx","5.5"),re.setAttributeNS(null,"cy","5.5"),re.setAttributeNS(null,"r","5.4999962"),W.appendChild(J),W.appendChild(re),w.appendChild(k),w.appendChild(A),w.appendChild(B),w.appendChild(G),w.appendChild(W),s.appendChild(w),s.setAttributeNS(null,"height",l*this._scale+"px"),s.setAttributeNS(null,"width",u*this._scale+"px"),this._element.appendChild(s),this._offset=h.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(s=>{s.preventDefault()})),this._element.addEventListener("mousedown",(s=>{s.preventDefault()})),ta(this._element,this._anchor,"marker"),e&&e.className)for(const s of e.className.split(" "))this._element.classList.add(s);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Z.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=h.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const u=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[u,-1*(38.1-13.5+u)],"bottom-right":[-u,-1*(38.1-13.5+u)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var s,l;if(!(!((s=this._map)===null||s===void 0)&&s.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const u=this._map,p=u.terrain.depthAtPoint(this._pos),w=u.terrain.getElevationForLngLatZoom(this._lngLat,u.transform.tileZoom);if(u.transform.lngLatToCameraDepth(this._lngLat,w)-p<.006)return void(this._element.style.opacity=this._opacity);const k=-this._offset.y/u.transform._pixelPerMeter,E=Math.sin(u.getPitch()*Math.PI/180)*k,A=u.terrain.depthAtPoint(new h.P(this._pos.x,this._pos.y-this._offset.y)),R=u.transform.lngLatToCameraDepth(this._lngLat,w+E)-A>.006;!((l=this._popup)===null||l===void 0)&&l.isOpen()&&R&&this._popup.remove(),this._element.style.opacity=R?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=h.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,s){return e===void 0&&s===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),s!==void 0&&(this._opacityWhenCovered=s),this._map&&this._updateOpacity(!0),this}}const bl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ao=0,zo=!1;const wi={maxWidth:100,unit:"metric"};function Do(f,e,s){const l=s&&s.maxWidth||100,u=f._container.clientHeight/2,p=f.unproject([0,u]),w=f.unproject([l,u]),k=p.distanceTo(w);if(s&&s.unit==="imperial"){const E=3.2808*k;E>5280?gt(e,l,E/5280,f._getUIString("ScaleControl.Miles")):gt(e,l,E,f._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?gt(e,l,k/1852,f._getUIString("ScaleControl.NauticalMiles")):k>=1e3?gt(e,l,k/1e3,f._getUIString("ScaleControl.Kilometers")):gt(e,l,k,f._getUIString("ScaleControl.Meters"))}function gt(f,e,s,l){const u=(function(p){const w=Math.pow(10,`${Math.floor(p)}`.length-1);let k=p/w;return k=k>=10?10:k>=5?5:k>=3?3:k>=2?2:k>=1?1:(function(E){const A=Math.pow(10,Math.ceil(-Math.log(E)/Math.LN10));return Math.round(E*A)/A})(k),w*k})(s);f.style.width=e*(u/s)+"px",f.innerHTML=`${u}&nbsp;${l}`}const At={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Lo=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Sl(f){if(f){if(typeof f=="number"){const e=Math.round(Math.abs(f)/Math.SQRT2);return{center:new h.P(0,0),top:new h.P(0,f),"top-left":new h.P(e,e),"top-right":new h.P(-e,e),bottom:new h.P(0,-f),"bottom-left":new h.P(e,-e),"bottom-right":new h.P(-e,-e),left:new h.P(f,0),right:new h.P(-f,0)}}if(f instanceof h.P||Array.isArray(f)){const e=h.P.convert(f);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:h.P.convert(f.center||[0,0]),top:h.P.convert(f.top||[0,0]),"top-left":h.P.convert(f["top-left"]||[0,0]),"top-right":h.P.convert(f["top-right"]||[0,0]),bottom:h.P.convert(f.bottom||[0,0]),"bottom-left":h.P.convert(f["bottom-left"]||[0,0]),"bottom-right":h.P.convert(f["bottom-right"]||[0,0]),left:h.P.convert(f.left||[0,0]),right:h.P.convert(f.right||[0,0])}}return Sl(new h.P(0,0))}const tc=X;T.AJAXError=h.bh,T.Evented=h.E,T.LngLat=h.N,T.MercatorCoordinate=h.Z,T.Point=h.P,T.addProtocol=h.bi,T.config=h.a,T.removeProtocol=h.bj,T.AttributionControl=As,T.BoxZoomHandler=ii,T.CanvasSource=mi,T.CooperativeGesturesHandler=Mo,T.DoubleClickZoomHandler=Qs,T.DragPanHandler=uu,T.DragRotateHandler=sh,T.EdgeInsets=Ya,T.FullscreenControl=class extends h.E{constructor(f={}){super(),this._onFullscreenChange=()=>{var e;let s=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=s==null?void 0:s.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)s=s.shadowRoot.fullscreenElement;s===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:h.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=Z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){Z.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const f=this._fullscreenButton=Z.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);Z.create("span","maplibregl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.title=f}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new h.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new h.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},T.GeoJSONSource=Ss,T.GeolocateControl=class extends h.E{constructor(f){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new h.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new h.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const s=new h.N(e.coords.longitude,e.coords.latitude),l=e.coords.accuracy,u=this._map.getBearing(),p=h.e({bearing:u},this.options.fitBoundsOptions),w=Ee.fromLngLat(s,l);this._map.fitBounds(w,p,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const s=new h.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&zo)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new h.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=Z.create("button","maplibregl-ctrl-geolocate",this._container),Z.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){h.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Z.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Cn({element:this._dotElement}),this._circleElement=Z.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Cn({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new h.k("trackuserlocationend")),this.fire(new h.k("userlocationlostfocus")))}))}},this.options=h.e({},bl,f)}onAdd(f){return this._map=f,this._container=Z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return h._(this,arguments,void 0,(function*(e=!1){if(Cr!==void 0&&!e)return Cr;if(window.navigator.permissions===void 0)return Cr=!!window.navigator.geolocation,Cr;try{Cr=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Cr=!!window.navigator.geolocation}return Cr}))})().then((e=>this._finishSetupUI(e))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Z.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ao=0,zo=!1}_isOutOfMapMaxBounds(f){const e=this._map.getMaxBounds(),s=f.coords;return e&&(s.longitude<e.getWest()||s.longitude>e.getEast()||s.latitude<e.getSouth()||s.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const f=this._map.getBounds(),e=f.getSouthEast(),s=f.getNorthEast(),l=e.distanceTo(s),u=Math.ceil(this._accuracy/(l/this._map._container.clientHeight)*2);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}trigger(){if(!this._setup)return h.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new h.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ao--,zo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new h.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new h.k("trackuserlocationstart")),this.fire(new h.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ao++,Ao>1?(f={maximumAge:6e5,timeout:0},zo=!0):(f=this.options.positionOptions,zo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},T.Hash=su,T.ImageSource=Ts,T.KeyboardHandler=Ri,T.LngLatBounds=Ee,T.LogoControl=as,T.Map=class extends to{constructor(f){h.bf.mark(h.bg.create);const e=Object.assign(Object.assign({},Ea),f);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new ka(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new or,this._controls=[],this._mapId=h.a4(),this._contextLost=s=>{s.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new h.k("webglcontextlost",{originalEvent:s}))},this._contextRestored=s=>{this._setupPainter(),this.resize(),this._update(),this.fire(new h.k("webglcontextrestored",{originalEvent:s}))},this._onMapScroll=s=>{if(s.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer===!0,this._antialias=e.antialias===!0,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles===!0,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions===!0,this._collectResourceTiming=e.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},wl),e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=$e.addThrottleControl((()=>this.isMoving())),this._requestManager=new et(e.transformRequest),typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))).on("moveend",(()=>this._update(!1))).on("zoom",(()=>this._update(!0))).on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})).once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let s=!1;const l=pl((u=>{this._trackResize&&!this._removed&&(this.resize(u),this.redraw())}),50);this._resizeObserver=new ResizeObserver((u=>{s?l(u):s=!0})),this._resizeObserver.observe(this._container)}this.handlers=new hu(this,e),this._hash=e.hash&&new su(typeof e.hash=="string"&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,h.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new As(typeof e.attributionControl=="boolean"?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new as,e.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(s=>{this._update(s.dataType==="style"),this.fire(new h.k(`${s.dataType}data`,s))})),this.on("dataloading",(s=>{this.fire(new h.k(`${s.dataType}dataloading`,s))})),this.on("dataabort",(s=>{this.fire(new h.k("sourcedataabort",s))}))}_getMapId(){return this._mapId}addControl(f,e){if(e===void 0&&(e=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new h.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=f.onAdd(this);this._controls.push(f);const l=this._controlPositions[e];return e.indexOf("bottom")!==-1?l.insertBefore(s,l.firstChild):l.appendChild(s),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new h.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(f);return e>-1&&this._controls.splice(e,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}calculateCameraOptionsFromTo(f,e,s,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(f,e,s,l)}resize(f){var e;const s=this._containerDimensions(),l=s[0],u=s[1],p=this._getClampedPixelRatio(l,u);if(this._resizeCanvas(l,u,p),this.painter.resize(l,u,p),this.painter.overLimit()){const k=this.painter.context.gl;this._maxCanvasSize=[k.drawingBufferWidth,k.drawingBufferHeight];const E=this._getClampedPixelRatio(l,u);this._resizeCanvas(l,u,E),this.painter.resize(l,u,E)}this.transform.resize(l,u),(e=this._requestedCameraState)===null||e===void 0||e.resize(l,u);const w=!this._moving;return w&&(this.stop(),this.fire(new h.k("movestart",f)).fire(new h.k("move",f))),this.fire(new h.k("resize",f)),w&&this.fire(new h.k("moveend",f)),this}_getClampedPixelRatio(f,e){const{0:s,1:l}=this._maxCanvasSize,u=this.getPixelRatio(),p=f*u,w=e*u;return Math.min(p>s?s/p:1,w>l?l/w:1)*u}getPixelRatio(){var f;return(f=this._overridePixelRatio)!==null&&f!==void 0?f:devicePixelRatio}setPixelRatio(f){this._overridePixelRatio=f,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(f){return this.transform.setMaxBounds(Ee.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f&&this.setZoom(f),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f&&this.setZoom(f),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f&&this.setPitch(f),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f&&this.setPitch(f),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this._update()}project(f){return this.transform.locationPoint(h.N.convert(f),this.style&&this.terrain)}unproject(f){return this.transform.pointLocation(h.P.convert(f),this.terrain)}isMoving(){var f;return this._moving||((f=this.handlers)===null||f===void 0?void 0:f.isMoving())}isZooming(){var f;return this._zooming||((f=this.handlers)===null||f===void 0?void 0:f.isZooming())}isRotating(){var f;return this._rotating||((f=this.handlers)===null||f===void 0?void 0:f.isRotating())}_createDelegatedListener(f,e,s){if(f==="mouseenter"||f==="mouseover"){let l=!1;return{layers:e,listener:s,delegates:{mousemove:p=>{const w=e.filter((E=>this.getLayer(E))),k=w.length!==0?this.queryRenderedFeatures(p.point,{layers:w}):[];k.length?l||(l=!0,s.call(this,new Pn(f,this,p.originalEvent,{features:k}))):l=!1},mouseout:()=>{l=!1}}}}if(f==="mouseleave"||f==="mouseout"){let l=!1;return{layers:e,listener:s,delegates:{mousemove:w=>{const k=e.filter((E=>this.getLayer(E)));(k.length!==0?this.queryRenderedFeatures(w.point,{layers:k}):[]).length?l=!0:l&&(l=!1,s.call(this,new Pn(f,this,w.originalEvent)))},mouseout:w=>{l&&(l=!1,s.call(this,new Pn(f,this,w.originalEvent)))}}}}{const l=u=>{const p=e.filter((k=>this.getLayer(k))),w=p.length!==0?this.queryRenderedFeatures(u.point,{layers:p}):[];w.length&&(u.features=w,s.call(this,u),delete u.features)};return{layers:e,listener:s,delegates:{[f]:l}}}}_saveDelegatedListener(f,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(e)}_removeDelegatedListener(f,e,s){if(!this._delegatedListeners||!this._delegatedListeners[f])return;const l=this._delegatedListeners[f];for(let u=0;u<l.length;u++){const p=l[u];if(p.listener===s&&p.layers.length===e.length&&p.layers.every((w=>e.includes(w)))){for(const w in p.delegates)this.off(w,p.delegates[w]);return void l.splice(u,1)}}}on(f,e,s){if(s===void 0)return super.on(f,e);const l=this._createDelegatedListener(f,typeof e=="string"?[e]:e,s);this._saveDelegatedListener(f,l);for(const u in l.delegates)this.on(u,l.delegates[u]);return this}once(f,e,s){if(s===void 0)return super.once(f,e);const l=typeof e=="string"?[e]:e,u=this._createDelegatedListener(f,l,s);for(const p in u.delegates){const w=u.delegates[p];u.delegates[p]=(...k)=>{this._removeDelegatedListener(f,l,s),w(...k)}}this._saveDelegatedListener(f,u);for(const p in u.delegates)this.once(p,u.delegates[p]);return this}off(f,e,s){return s===void 0?super.off(f,e):(this._removeDelegatedListener(f,typeof e=="string"?[e]:e,s),this)}queryRenderedFeatures(f,e){if(!this.style)return[];let s;const l=f instanceof h.P||Array.isArray(f),u=l?f:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(l?{}:f)||{},u instanceof h.P||typeof u[0]=="number")s=[h.P.convert(u)];else{const p=h.P.convert(u[0]),w=h.P.convert(u[1]);s=[p,new h.P(w.x,p.y),w,new h.P(p.x,w.y),p]}return this.style.queryRenderedFeatures(s,e,this.transform)}querySourceFeatures(f,e){return this.style.querySourceFeatures(f,e)}setStyle(f,e){return(e=h.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&f?(this._diffStyle(f,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(f,e))}setTransformRequest(f){return this._requestManager.setTransformRequest(f),this}_getUIString(f){const e=this._locale[f];if(e==null)throw new Error(`Missing UI string '${f}'`);return e}_updateStyle(f,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(f,e)));const s=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!f)),f?(this.style=new $l(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof f=="string"?this.style.loadURL(f,e,s):this.style.loadJSON(f,e,s),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new $l(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,e){if(typeof f=="string"){const s=this._requestManager.transformRequest(f,"Style");h.h(s,new AbortController).then((l=>{this._updateDiff(l.data,e)})).catch((l=>{l&&this.fire(new h.j(l))}))}else typeof f=="object"&&this._updateDiff(f,e)}_updateDiff(f,e){try{this.style.setState(f,e)&&this._update(!0)}catch(s){h.w(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(f,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():h.w("There is no style added to the map.")}addSource(f,e){return this._lazyInitEmptyStyle(),this.style.addSource(f,e),this._update(!0)}isSourceLoaded(f){const e=this.style&&this.style.sourceCaches[f];if(e!==void 0)return e.loaded();this.fire(new h.j(new Error(`There is no source with ID '${f}'`)))}setTerrain(f){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),f){const e=this.style.sourceCaches[f.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${f.source}`);this.terrain===null&&e.reload();for(const s in this.style._layers){const l=this.style._layers[s];l.type==="hillshade"&&l.source===f.source&&h.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new ea(this.painter,e,f),this.painter.renderToTexture=new xl(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=s=>{s.dataType==="style"?this.terrain.sourceCache.freeRtt():s.dataType==="source"&&s.tile&&(s.sourceId!==f.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(s.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new h.k("terrain",{terrain:f})),this}getTerrain(){var f,e;return(e=(f=this.terrain)===null||f===void 0?void 0:f.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const f=this.style&&this.style.sourceCaches;for(const e in f){const s=f[e]._tiles;for(const l in s){const u=s[l];if(u.state!=="loaded"&&u.state!=="errored")return!1}}return!0}removeSource(f){return this.style.removeSource(f),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,e,s={}){const{pixelRatio:l=1,sdf:u=!1,stretchX:p,stretchY:w,content:k,textFitWidth:E,textFitHeight:A}=s;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||h.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new h.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:R,height:B,data:U}=e,G=e;return this.style.addImage(f,{data:new h.R({width:R,height:B},new Uint8Array(U)),pixelRatio:l,stretchX:p,stretchY:w,content:k,textFitWidth:E,textFitHeight:A,sdf:u,version:0,userImage:G}),G.onAdd&&G.onAdd(this,f),this}}{const{width:R,height:B,data:U}=Y.getImageData(e);this.style.addImage(f,{data:new h.R({width:R,height:B},U),pixelRatio:l,stretchX:p,stretchY:w,content:k,textFitWidth:E,textFitHeight:A,sdf:u,version:0})}}updateImage(f,e){const s=this.style.getImage(f);if(!s)return this.fire(new h.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=e instanceof HTMLImageElement||h.b(e)?Y.getImageData(e):e,{width:u,height:p,data:w}=l;if(u===void 0||p===void 0)return this.fire(new h.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(u!==s.data.width||p!==s.data.height)return this.fire(new h.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const k=!(e instanceof HTMLImageElement||h.b(e));return s.data.replace(w,k),this.style.updateImage(f,s),this}getImage(f){return this.style.getImage(f)}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new h.j(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f){return $e.getImage(this._requestManager.transformRequest(f,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(f,e){return this._lazyInitEmptyStyle(),this.style.addLayer(f,e),this._update(!0)}moveLayer(f,e){return this.style.moveLayer(f,e),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(f,e,s){return this.style.setLayerZoomRange(f,e,s),this._update(!0)}setFilter(f,e,s={}){return this.style.setFilter(f,e,s),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,e,s,l={}){return this.style.setPaintProperty(f,e,s,l),this._update(!0)}getPaintProperty(f,e){return this.style.getPaintProperty(f,e)}setLayoutProperty(f,e,s,l={}){return this.style.setLayoutProperty(f,e,s,l),this._update(!0)}getLayoutProperty(f,e){return this.style.getLayoutProperty(f,e)}setGlyphs(f,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(f,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(f,e,s={}){return this._lazyInitEmptyStyle(),this.style.addSprite(f,e,s,(l=>{l||this._update(!0)})),this}removeSprite(f){return this._lazyInitEmptyStyle(),this.style.removeSprite(f),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(f,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(f,e,(s=>{s||this._update(!0)})),this}setLight(f,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(f){return this._lazyInitEmptyStyle(),this.style.setSky(f),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(f,e){return this.style.setFeatureState(f,e),this._update()}removeFeatureState(f,e){return this.style.removeFeatureState(f,e),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let f=0,e=0;return this._container&&(f=this._container.clientWidth||400,e=this._container.clientHeight||300),[f,e]}_setupContainer(){const f=this._container;f.classList.add("maplibregl-map");const e=this._canvasContainer=Z.create("div","maplibregl-canvas-container",f);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=Z.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const s=this._containerDimensions(),l=this._getClampedPixelRatio(s[0],s[1]);this._resizeCanvas(s[0],s[1],l);const u=this._controlContainer=Z.create("div","maplibregl-control-container",f),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((w=>{p[w]=Z.create("div",`maplibregl-ctrl-${w} `,u)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,e,s){this._canvas.width=Math.floor(s*f),this._canvas.height=Math.floor(s*e),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const f={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",(l=>{e={requestedAttributes:f},l&&(e.statusMessage=l.statusMessage,e.type=l.type)}),{once:!0});const s=this._canvas.getContext("webgl2",f)||this._canvas.getContext("webgl",f);if(!s){const l="Failed to initialize WebGL";throw e?(e.message=l,new Error(JSON.stringify(e))):new Error(l)}this.painter=new Sa(s,this.transform),Ie.testSupport(s)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_render(f){const e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),this._removed)return;let s=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const u=this.transform.zoom,p=Y.now();this.style.zoomHistory.update(u,p);const w=new h.z(u,{now:p,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),k=w.crossFadingFactor();k===1&&k===this._crossFadingFactor||(s=!0,this._crossFadingFactor=k),this.style.update(w)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new h.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,h.bf.mark(h.bg.load),this.fire(new h.k("load"))),this.style&&(this.style.hasTransitions()||s)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const l=this._sourcesDirty||this._styleDirty||this._placementDirty;return l||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new h.k("idle")),!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,h.bf.mark(h.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var f;this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),$e.removeThrottleControl(this._imageQueueHandle),(f=this._resizeObserver)===null||f===void 0||f.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),Z.remove(this._canvasContainer),Z.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),h.bf.clearMetrics(),this._removed=!0,this.fire(new h.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,Y.frameAsync(this._frameRequest).then((f=>{h.bf.frame(f),this._frameRequest=null,this._render(f)})).catch((()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get version(){return ro}getCameraTargetElevation(){return this.transform.elevation}},T.MapMouseEvent=Pn,T.MapTouchEvent=Cs,T.MapWheelEvent=Ku,T.Marker=Cn,T.NavigationControl=class{constructor(f){this._updateZoomButtons=()=>{const e=this._map.getZoom(),s=e===this._map.getMaxZoom(),l=e===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,s)=>{const l=this._map._getUIString(`NavigationControl.${s}`);e.title=l,e.setAttribute("aria-label",l)},this.options=h.e({},jr,f),this._container=Z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(e=>this._map.zoomIn({},{originalEvent:e}))),Z.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(e=>this._map.zoomOut({},{originalEvent:e}))),Z.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})})),this._compassIcon=Z.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Pa(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){Z.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(f,e){const s=Z.create("button",f,this._container);return s.type="button",s.addEventListener("click",e),s}},T.Popup=class extends h.E{constructor(f){super(),this.remove=()=>(this._content&&Z.remove(this._content),this._container&&(Z.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new h.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var s;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=Z.create("div","maplibregl-popup",this._map.getContainer()),this._tip=Z.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const k of this.options.className.split(" "))this._container.classList.add(k);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?ur(this._lngLat,this._flatPos,this._map.transform):(s=this._lngLat)===null||s===void 0?void 0:s.wrap(),this._trackPointer&&!e)return;const l=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let u=this.options.anchor;const p=Sl(this.options.offset);if(!u){const k=this._container.offsetWidth,E=this._container.offsetHeight;let A;A=l.y+p.bottom.y<E?["top"]:l.y>this._map.transform.height-E?["bottom"]:[],l.x<k/2?A.push("left"):l.x>this._map.transform.width-k/2&&A.push("right"),u=A.length===0?"bottom":A.join("-")}let w=l.add(p[u]);this.options.subpixelPositioning||(w=w.round()),Z.setTransform(this._container,`${Fi[u]} translate(${w.x}px,${w.y}px)`),ta(this._container,u,"popup")},this._onClose=()=>{this.remove()},this.options=h.e(Object.create(At),f)}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new h.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(f){return this._lngLat=h.N.convert(f),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const e=document.createDocumentFragment(),s=document.createElement("body");let l;for(s.innerHTML=f;l=s.firstChild,l;)e.appendChild(l);return this.setDOMContent(e)}getMaxWidth(){var f;return(f=this._container)===null||f===void 0?void 0:f.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Z.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(f){return this._container&&this._container.classList.add(f),this}removeClassName(f){return this._container&&this._container.classList.remove(f),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){if(this._container)return this._container.classList.toggle(f)}setSubpixelPositioning(f){this.options.subpixelPositioning=f}_createCloseButton(){this.options.closeButton&&(this._closeButton=Z.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(Lo);f&&f.focus()}},T.RasterDEMTileSource=Dr,T.RasterTileSource=fr,T.ScaleControl=class{constructor(f){this._onMove=()=>{Do(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Do(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},wi),f)}getDefaultPosition(){return"bottom-left"}onAdd(f){return this._map=f,this._container=Z.create("div","maplibregl-ctrl maplibregl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){Z.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},T.ScrollZoomHandler=si,T.Style=$l,T.TerrainControl=class{constructor(f){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=f}onAdd(f){return this._map=f,this._container=Z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Z.create("button","maplibregl-ctrl-terrain",this._container),Z.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){Z.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},T.TwoFingersTouchPitchHandler=Po,T.TwoFingersTouchRotateHandler=Eo,T.TwoFingersTouchZoomHandler=_l,T.TwoFingersTouchZoomRotateHandler=cu,T.VectorTileSource=co,T.VideoSource=Fa,T.addSourceType=(f,e)=>h._(void 0,void 0,void 0,(function*(){if(Oa(f))throw new Error(`A source type called "${f}" already exists.`);((s,l)=>{ho[s]=l})(f,e)})),T.clearPrewarmedResources=function(){const f=cr;f&&(f.isPreloaded()&&f.numActive()===1?(f.release(Yt),cr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},T.getMaxParallelImageRequests=function(){return h.a.MAX_PARALLEL_IMAGE_REQUESTS},T.getRTLTextPluginStatus=function(){return Jn().getRTLTextPluginStatus()},T.getVersion=function(){return tc},T.getWorkerCount=function(){return ir.workerCount},T.getWorkerUrl=function(){return h.a.WORKER_URL},T.importScriptInWorkers=function(f){return fa().broadcast("IS",f)},T.prewarm=function(){Ir().acquire(Yt)},T.setMaxParallelImageRequests=function(f){h.a.MAX_PARALLEL_IMAGE_REQUESTS=f},T.setRTLTextPlugin=function(f,e){return Jn().setRTLTextPlugin(f,e)},T.setWorkerCount=function(f){ir.workerCount=f},T.setWorkerUrl=function(f){h.a.WORKER_URL=f}}));var F=b;return F}))})(gf)),gf.exports}var vv=_v();const Vd=Om(vv);function xv({boatPosition:_,restrictions:y,signs:b}){console.log(" MapView render:",{position:_,restrictionsCount:y.length,signsCount:b.length});const C=Xr.useRef(null),D=Xr.useRef(null),F=Xr.useRef(null),T=Xr.useRef([]);Xr.useEffect(()=>{if(!C.current)return;const ae=new Vd.Map({container:C.current,style:{version:8,sources:{osm:{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:" OpenStreetMap contributors"}},layers:[{id:"osm",type:"raster",source:"osm",minzoom:0,maxzoom:19}]},center:[25,60.5],zoom:8,attributionControl:!0});return ae.addControl(new Vd.NavigationControl,"top-right"),D.current=ae,h(),()=>{var Q;(Q=F.current)==null||Q.remove(),T.current.forEach(Y=>Y.remove()),ae.remove(),D.current=null}},[]),Xr.useEffect(()=>{if(!D.current||!_)return;const ae=D.current;if(F.current)F.current.setLngLat([_.lng,_.lat]);else{const Q=document.createElement("div");Q.className="boat-marker",Q.innerHTML="",F.current=new Vd.Marker({element:Q}).setLngLat([_.lng,_.lat]).addTo(ae),ae.flyTo({center:[_.lng,_.lat],zoom:13,duration:1e3})}if(_.heading!=null&&F.current){const Q=F.current.getElement();Q.style.transform=`rotate(${_.heading}deg)`}},[_]),Xr.useEffect(()=>{if(!D.current)return;const ae=D.current;T.current.forEach(Q=>Q.remove()),T.current=[],b.forEach(Q=>{const Y=document.createElement("div");Y.className="sign-marker";const Z=document.createElement("img");Z.src=Q.iconUrl,Z.alt=Q.nimiFi||"Merkki",Z.onerror=()=>{const Re=Q.iconKey.split("_")[0];Z.src=`/icons/${Re}.png`,Z.onerror=()=>{Z.src="/icons/merkki_default.png"}},Y.appendChild(Z);const Ie=new Vd.Marker({element:Y}).setLngLat(Q.geometry.coordinates).setPopup(new Vd.Popup({offset:25}).setHTML(`
            <div class="sign-popup">
              <strong>${Q.nimiFi||Q.nimiSv||"Merkki"}</strong>
              ${Q.lisakilmentekstiFi?`<p>${Q.lisakilmentekstiFi}</p>`:""}
              <p class="distance">${Q.distance} m</p>
            </div>
          `)).addTo(ae);T.current.push(Ie)})},[b]),console.log(" CODE EXISTS - About to define all-areas useEffect");const h=()=>{if(console.log(" displayAllAreas function called"),!D.current){console.log(" No map ref, trying again in 1 second..."),setTimeout(h,1e3);return}const ae=D.current;console.log(" Map ref exists, checking if loaded:",ae.loaded()),ae.loaded()?(console.log(" Map already loaded"),X(ae)):(console.log(" Map not loaded, waiting..."),ae.once("load",()=>{console.log(" Map load event fired"),X(ae)}))},X=ae=>{console.log(" Adding all areas to map..."),Ns.restriction_areas.toArray().then(Q=>{if(console.log(" Loaded",Q.length,"areas from DB"),Q.length===0){console.log(" No areas to display");return}try{ae.getLayer("all-restrictions-fill")&&ae.removeLayer("all-restrictions-fill"),ae.getLayer("all-restrictions-line")&&ae.removeLayer("all-restrictions-line"),ae.getSource("all-restrictions")&&ae.removeSource("all-restrictions")}catch{console.log(" Removed old layers (or they didnt exist)")}const Y={type:"FeatureCollection",features:Q.map(Z=>({type:"Feature",properties:{id:Z.id},geometry:Z.geometry}))};console.log(" Adding source with",Y.features.length,"features"),ae.addSource("all-restrictions",{type:"geojson",data:Y}),console.log(" Adding layers (RED color, high opacity)"),ae.addLayer({id:"all-restrictions-fill",type:"fill",source:"all-restrictions",paint:{"fill-color":"#ff0000","fill-opacity":.5}}),ae.addLayer({id:"all-restrictions-line",type:"line",source:"all-restrictions",paint:{"line-color":"#ff0000","line-width":3}}),console.log(" SUCCESS! Red polygons should be visible now!")}).catch(Q=>{console.error(" Error loading areas:",Q)})};return h(),at.jsx("div",{ref:C,className:"map-container"})}function wv({restrictions:_,signs:y}){const[b,C]=Xr.useState(!1),D=_.length>0||y.length>0;return at.jsxs("div",{className:`bottom-sheet ${b?"expanded":""} ${D?"":"empty"}`,children:[at.jsxs("div",{className:"bottom-sheet-header",onClick:()=>C(!b),children:[at.jsx("div",{className:"drag-handle"}),at.jsxs("div",{className:"header-content",children:[_.length>0&&at.jsx("div",{className:"primary-info",children:Vg(_[0])}),_.length===0&&y.length===0&&at.jsx("div",{className:"no-data",children:"Ei rajoituksia tai merkkej lhistll"})]})]}),at.jsxs("div",{className:"bottom-sheet-content",children:[_.length>0&&at.jsxs("section",{className:"restrictions-section",children:[at.jsx("h3",{children:"Voimassa olevat rajoitukset"}),at.jsx("div",{className:"restrictions-list",children:_.map((F,T)=>at.jsxs("div",{className:`restriction-item ${F.isPrimary?"primary":""}`,children:[at.jsxs("div",{className:"restriction-title",children:[Vg(F),F.isPrimary&&at.jsx("span",{className:"badge",children:"Trkein"})]}),F.poikkeus&&at.jsxs("div",{className:"restriction-detail",children:[at.jsx("strong",{children:"Poikkeus:"})," ",F.poikkeus]}),F.lisatieto&&at.jsxs("div",{className:"restriction-detail",children:[at.jsx("strong",{children:"Listieto:"})," ",F.lisatieto]}),F.alkuPvm&&at.jsxs("div",{className:"restriction-meta",children:["Voimassa: ",new Date(F.alkuPvm).toLocaleDateString("fi-FI"),F.loppuPvm&&` - ${new Date(F.loppuPvm).toLocaleDateString("fi-FI")}`]})]},F.id))})]}),y.length>0&&at.jsxs("section",{className:"signs-section",children:[at.jsx("h3",{children:"Lhell olevat merkit"}),at.jsx("div",{className:"signs-list",children:y.map(F=>at.jsxs("div",{className:"sign-item",children:[at.jsx("div",{className:"sign-icon",children:at.jsx("img",{src:F.iconUrl,alt:Ug(F),onError:T=>{const h=T.target,X=F.iconKey.split("_")[0];h.src.includes("_")?h.src=`/icons/${X}.png`:h.src.includes("default")||(h.src="/icons/merkki_default.png")}})}),at.jsxs("div",{className:"sign-info",children:[at.jsx("div",{className:"sign-name",children:Ug(F)}),F.lisakilmentekstiFi&&at.jsx("div",{className:"sign-detail",children:F.lisakilmentekstiFi}),at.jsx("div",{className:"sign-distance",children:mv(F.distance)})]})]},F.id))})]})]})]})}function bv({filters:_,availableVlmtyyppi:y,onFilterChange:b,onClose:C}){const D=h=>{const X=new Set(_.selectedVlmtyyppi);X.has(h)?X.delete(h):X.add(h),b("selectedVlmtyyppi",X)},F=()=>{b("selectedVlmtyyppi",new Set(y))},T=()=>{b("selectedVlmtyyppi",new Set)};return at.jsx("div",{className:"settings-overlay",onClick:C,children:at.jsxs("div",{className:"settings-panel",onClick:h=>h.stopPropagation(),children:[at.jsxs("div",{className:"settings-header",children:[at.jsx("h2",{children:"Asetukset"}),at.jsx("button",{className:"close-btn",onClick:C,children:""})]}),at.jsxs("div",{className:"settings-content",children:[at.jsxs("section",{className:"settings-section",children:[at.jsx("h3",{children:"Rajoitussuodattimet"}),at.jsxs("div",{className:"setting-item",children:[at.jsxs("label",{className:"switch-label",children:[at.jsx("input",{type:"checkbox",checked:_.ammattiliikenne,onChange:h=>b("ammattiliikenne",h.target.checked)}),at.jsx("span",{className:"switch"}),at.jsx("span",{className:"label-text",children:"Ammattiliikenne"})]}),at.jsx("p",{className:"setting-description",children:'Kun pois plt, piilotetaan rajoitukset joissa poikkeus sislt "huvi"'})]}),at.jsxs("div",{className:"setting-item",children:[at.jsxs("label",{className:"switch-label",children:[at.jsx("input",{type:"checkbox",checked:_.vesiskootteri,onChange:h=>b("vesiskootteri",h.target.checked)}),at.jsx("span",{className:"switch"}),at.jsx("span",{className:"label-text",children:"Vesiskootteri"})]}),at.jsx("p",{className:"setting-description",children:"Kun pois plt, piilotetaan vesiskootteri-rajoitukset"})]})]}),at.jsxs("section",{className:"settings-section",children:[at.jsx("h3",{children:"Lheisten merkkien sde"}),at.jsx("div",{className:"setting-item",children:at.jsxs("label",{children:[at.jsxs("span",{className:"label-text",children:["Sde: ",_.nearbyRadius," m"]}),at.jsx("input",{type:"range",min:"50",max:"1000",step:"50",value:_.nearbyRadius,onChange:h=>b("nearbyRadius",parseInt(h.target.value)),className:"radius-slider"})]})})]}),at.jsxs("section",{className:"settings-section",children:[at.jsxs("div",{className:"section-header",children:[at.jsx("h3",{children:"Merkkityypit"}),at.jsxs("div",{className:"bulk-actions",children:[at.jsx("button",{onClick:F,className:"text-btn",children:"Valitse kaikki"}),at.jsx("button",{onClick:T,className:"text-btn",children:"Tyhjenn"})]})]}),at.jsx("p",{className:"setting-description",children:_.selectedVlmtyyppi.size===0?"Nytetn kaikki merkit":`Valittu ${_.selectedVlmtyyppi.size} tyyppi`}),at.jsx("div",{className:"vlmtyyppi-grid",children:y.map(h=>at.jsxs("label",{className:"checkbox-label",children:[at.jsx("input",{type:"checkbox",checked:_.selectedVlmtyyppi.has(h),onChange:()=>D(h)}),at.jsx("span",{className:"checkbox-custom"}),at.jsxs("span",{className:"label-text",children:["Tyyppi ",h]})]},h))})]})]})]})})}function Sv({onUpdate:_,status:y}){const[b,C]=Xr.useState("");Xr.useEffect(()=>{D()},[y.isUpdating]);const D=async()=>{const F=await Lg("rajoitus"),T=await Lg("vesiliikenne");if(F||T){const h=new Date(F||T||"");C(h.toLocaleString("fi-FI"))}};return at.jsxs("div",{className:"update-button-container",children:[at.jsx("button",{className:"update-btn",onClick:_,disabled:y.isUpdating,children:y.isUpdating?at.jsxs(at.Fragment,{children:[at.jsx("span",{className:"spinner"}),"Pivitetn..."]}):at.jsxs(at.Fragment,{children:[at.jsx("span",{children:""}),"Pivit aineisto"]})}),y.message&&at.jsxs("div",{className:`update-message ${y.isUpdating?"active":""}`,children:[y.message,y.isUpdating&&y.progress>0&&at.jsx("div",{className:"progress-bar",children:at.jsx("div",{className:"progress-fill",style:{width:`${y.progress}%`}})})]}),b&&!y.isUpdating&&at.jsxs("div",{className:"last-update",children:["Viimeksi pivitetty: ",b]})]})}function kv(){const[_,y]=Xr.useState({isUpdating:!1,progress:0,message:""});Xr.useEffect(()=>(Le.current||(Le.current=new Bg(y)),()=>{var ut;(ut=Le.current)==null||ut.cleanup()}),[]);const[b,C]=Xr.useState({ammattiliikenne:!0,vesiskootteri:!0,selectedVlmtyyppi:new Set,nearbyRadius:250}),[D,F]=Xr.useState(null),[T,h]=Xr.useState([]),[X,ae]=Xr.useState([]),[Q,Y]=Xr.useState(!1),[Z,Ie]=Xr.useState(!1),[Re,Pe]=Xr.useState([]),Le=Xr.useRef(null),De=Xr.useRef(null),ze=Xr.useRef(0),$e=Xr.useRef(null);Xr.useEffect(()=>(Le.current=new Bg(y),()=>{Le.current&&Le.current.cleanup()}),[]),Xr.useEffect(()=>{et()},[]);const et=async()=>{var ut,Ve,tr,vt;try{console.log("Loading data from IndexedDB...");const ar=await Ns.restriction_areas.toArray(),Rt=await Ns.traffic_signs.toArray();if(console.log("Loaded from DB:",{areas:ar.length,signs:Rt.length}),ar.length>0&&Rt.length>0){console.log("Building spatial indexes..."),jd.buildAreaIndex(ar),jd.buildSignIndex(Rt),console.log("Sample area bbox:",(ut=ar[0])==null?void 0:ut.bbox),console.log("Sample area geometry:",(Ve=ar[0])==null?void 0:Ve.geometry),console.log("Sample sign coordinates:",(vt=(tr=Rt[0])==null?void 0:tr.geometry)==null?void 0:vt.coordinates);const Bt=jd.getCandidateAreas(24.925,60.247,1);console.log("Test search (radius 1.0 deg):",Bt.length,"candidates"),Pe(gv(Rt)),Ie(!0),$e.current&&(console.log(" Forcing initial evaluation with current position"),ze.current=0,He($e.current)),console.log("Data loaded and indexed successfully!")}else console.log("No data in IndexedDB yet")}catch(ar){console.error("Failed to load data from IndexedDB:",ar)}},Je=async()=>{var ut;console.log("=== UPDATE STARTED ===");try{console.log("Calling updater.updateData()..."),await((ut=Le.current)==null?void 0:ut.updateData()),console.log("=== UPDATE COMPLETED SUCCESSFULLY ==="),console.log("Reloading data from IndexedDB..."),await et(),console.log("Data reloaded!"),alert("Pivitys valmis! Ladattu "+await Ns.restriction_areas.count()+" rajoitusaluetta ja "+await Ns.traffic_signs.count()+" merkki.")}catch(Ve){console.error("=== UPDATE FAILED ==="),console.error("Update failed:",Ve),alert("Pivitys eponnistui: "+(Ve instanceof Error?Ve.message:"Unknown error"))}};Xr.useEffect(()=>{if(!navigator.geolocation){console.error("Geolocation not supported");return}return De.current=navigator.geolocation.watchPosition(ut=>{const Ve={lat:ut.coords.latitude,lng:ut.coords.longitude,accuracy:ut.coords.accuracy,heading:ut.coords.heading??void 0,speed:ut.coords.speed??void 0,timestamp:ut.timestamp};F(Ve),$e.current=Ve,He(Ve)},ut=>{console.error("Geolocation error:",ut)},{enableHighAccuracy:!0,maximumAge:1e3,timeout:1e4}),()=>{De.current!==null&&navigator.geolocation.clearWatch(De.current)}},[b,Z]);const He=Xr.useCallback(ut=>{if(console.log(" evaluatePosition called:",{lat:ut.lat,lng:ut.lng,dataLoaded:Z}),!Z){console.log(" Data not loaded yet, skipping evaluation");return}const Ve=Date.now();if(Ve-ze.current<1e3){console.log(" Throttled (too soon)");return}ze.current=Ve,console.log(" Evaluating...");const vt=jd.getCandidateAreas(ut.lng,ut.lat,.05);console.log(" Candidate areas from spatial index:",vt.length);const ar=hv(vt,ut,b);console.log(" Applicable restrictions:",ar.length),h(ar);const Rt=jd.getNearbySignsInRadius(ut.lng,ut.lat,b.nearbyRadius);console.log(" Candidate signs:",Rt.length);const Bt=pv(Rt,ut,b);console.log(" Nearby signs after filtering:",Bt.length),ae(Bt.slice(0,10))},[b,Z]),je=(ut,Ve)=>{C(tr=>({...tr,[ut]:Ve}))};return at.jsxs("div",{className:"app",children:[at.jsx(xv,{boatPosition:D,restrictions:T,signs:X}),at.jsxs("div",{className:"controls",children:[at.jsx(Sv,{onUpdate:Je,status:_}),at.jsx("button",{className:"settings-btn",onClick:()=>Y(!Q),"aria-label":"Asetukset",children:""})]}),at.jsx(wv,{restrictions:T,signs:X}),Q&&at.jsx(bv,{filters:b,availableVlmtyyppi:Re,onFilterChange:je,onClose:()=>Y(!1)}),_.error&&at.jsx("div",{className:"error-toast",children:_.error})]})}t_.createRoot(document.getElementById("root")).render(at.jsx(Ky.StrictMode,{children:at.jsx(kv,{})}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").catch(()=>{})});
