var Uy=Object.defineProperty;var $y=(_,y,b)=>y in _?Uy(_,y,{enumerable:!0,configurable:!0,writable:!0,value:b}):_[y]=b;var Jo=(_,y,b)=>$y(_,typeof y!="symbol"?y+"":y,b);(function(){const y=document.createElement("link").relList;if(y&&y.supports&&y.supports("modulepreload"))return;for(const D of document.querySelectorAll('link[rel="modulepreload"]'))C(D);new MutationObserver(D=>{for(const F of D)if(F.type==="childList")for(const T of F.addedNodes)T.tagName==="LINK"&&T.rel==="modulepreload"&&C(T)}).observe(document,{childList:!0,subtree:!0});function b(D){const F={};return D.integrity&&(F.integrity=D.integrity),D.referrerPolicy&&(F.referrerPolicy=D.referrerPolicy),D.crossOrigin==="use-credentials"?F.credentials="include":D.crossOrigin==="anonymous"?F.credentials="omit":F.credentials="same-origin",F}function C(D){if(D.ep)return;D.ep=!0;const F=b(D);fetch(D.href,F)}})();function Om(_){return _&&_.__esModule&&Object.prototype.hasOwnProperty.call(_,"default")?_.default:_}var Yf={exports:{}},Fd={},Jf={exports:{}},_r={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pg;function qy(){if(pg)return _r;pg=1;var _=Symbol.for("react.element"),y=Symbol.for("react.portal"),b=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),D=Symbol.for("react.profiler"),F=Symbol.for("react.provider"),T=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),W=Symbol.for("react.suspense"),ue=Symbol.for("react.memo"),ne=Symbol.for("react.lazy"),Y=Symbol.iterator;function Z(xe){return xe===null||typeof xe!="object"?null:(xe=Y&&xe[Y]||xe["@@iterator"],typeof xe=="function"?xe:null)}var Ie={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Re=Object.assign,Pe={};function Le(xe,Ne,Xt){this.props=xe,this.context=Ne,this.refs=Pe,this.updater=Xt||Ie}Le.prototype.isReactComponent={},Le.prototype.setState=function(xe,Ne){if(typeof xe!="object"&&typeof xe!="function"&&xe!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,xe,Ne,"setState")},Le.prototype.forceUpdate=function(xe){this.updater.enqueueForceUpdate(this,xe,"forceUpdate")};function De(){}De.prototype=Le.prototype;function ze(xe,Ne,Xt){this.props=xe,this.context=Ne,this.refs=Pe,this.updater=Xt||Ie}var Ue=ze.prototype=new De;Ue.constructor=ze,Re(Ue,Le.prototype),Ue.isPureReactComponent=!0;var et=Array.isArray,Je=Object.prototype.hasOwnProperty,He={current:null},je={key:!0,ref:!0,__self:!0,__source:!0};function pt(xe,Ne,Xt){var Yt,nr={},cr=null,ur=null;if(Ne!=null)for(Yt in Ne.ref!==void 0&&(ur=Ne.ref),Ne.key!==void 0&&(cr=""+Ne.key),Ne)Je.call(Ne,Yt)&&!je.hasOwnProperty(Yt)&&(nr[Yt]=Ne[Yt]);var or=arguments.length-2;if(or===1)nr.children=Xt;else if(1<or){for(var Ir=Array(or),mn=0;mn<or;mn++)Ir[mn]=arguments[mn+2];nr.children=Ir}if(xe&&xe.defaultProps)for(Yt in or=xe.defaultProps,or)nr[Yt]===void 0&&(nr[Yt]=or[Yt]);return{$$typeof:_,type:xe,key:cr,ref:ur,props:nr,_owner:He.current}}function $e(xe,Ne){return{$$typeof:_,type:xe.type,key:Ne,ref:xe.ref,props:xe.props,_owner:xe._owner}}function ar(xe){return typeof xe=="object"&&xe!==null&&xe.$$typeof===_}function xt(xe){var Ne={"=":"=0",":":"=2"};return"$"+xe.replace(/[=:]/g,function(Xt){return Ne[Xt]})}var wr=/\/+/g;function Zt(xe,Ne){return typeof xe=="object"&&xe!==null&&xe.key!=null?xt(""+xe.key):Ne.toString(36)}function Nt(xe,Ne,Xt,Yt,nr){var cr=typeof xe;(cr==="undefined"||cr==="boolean")&&(xe=null);var ur=!1;if(xe===null)ur=!0;else switch(cr){case"string":case"number":ur=!0;break;case"object":switch(xe.$$typeof){case _:case y:ur=!0}}if(ur)return ur=xe,nr=nr(ur),xe=Yt===""?"."+Zt(ur,0):Yt,et(nr)?(Xt="",xe!=null&&(Xt=xe.replace(wr,"$&/")+"/"),Nt(nr,Ne,Xt,"",function(mn){return mn})):nr!=null&&(ar(nr)&&(nr=$e(nr,Xt+(!nr.key||ur&&ur.key===nr.key?"":(""+nr.key).replace(wr,"$&/")+"/")+xe)),Ne.push(nr)),1;if(ur=0,Yt=Yt===""?".":Yt+":",et(xe))for(var or=0;or<xe.length;or++){cr=xe[or];var Ir=Yt+Zt(cr,or);ur+=Nt(cr,Ne,Xt,Ir,nr)}else if(Ir=Z(xe),typeof Ir=="function")for(xe=Ir.call(xe),or=0;!(cr=xe.next()).done;)cr=cr.value,Ir=Yt+Zt(cr,or++),ur+=Nt(cr,Ne,Xt,Ir,nr);else if(cr==="object")throw Ne=String(xe),Error("Objects are not valid as a React child (found: "+(Ne==="[object Object]"?"object with keys {"+Object.keys(xe).join(", ")+"}":Ne)+"). If you meant to render a collection of children, use an array instead.");return ur}function Mr(xe,Ne,Xt){if(xe==null)return xe;var Yt=[],nr=0;return Nt(xe,Yt,"","",function(cr){return Ne.call(Xt,cr,nr++)}),Yt}function Pr(xe){if(xe._status===-1){var Ne=xe._result;Ne=Ne(),Ne.then(function(Xt){(xe._status===0||xe._status===-1)&&(xe._status=1,xe._result=Xt)},function(Xt){(xe._status===0||xe._status===-1)&&(xe._status=2,xe._result=Xt)}),xe._status===-1&&(xe._status=0,xe._result=Ne)}if(xe._status===1)return xe._result.default;throw xe._result}var $t={current:null},ot={transition:null},Pt={ReactCurrentDispatcher:$t,ReactCurrentBatchConfig:ot,ReactCurrentOwner:He};function ft(){throw Error("act(...) is not supported in production builds of React.")}return _r.Children={map:Mr,forEach:function(xe,Ne,Xt){Mr(xe,function(){Ne.apply(this,arguments)},Xt)},count:function(xe){var Ne=0;return Mr(xe,function(){Ne++}),Ne},toArray:function(xe){return Mr(xe,function(Ne){return Ne})||[]},only:function(xe){if(!ar(xe))throw Error("React.Children.only expected to receive a single React element child.");return xe}},_r.Component=Le,_r.Fragment=b,_r.Profiler=D,_r.PureComponent=ze,_r.StrictMode=C,_r.Suspense=W,_r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Pt,_r.act=ft,_r.cloneElement=function(xe,Ne,Xt){if(xe==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+xe+".");var Yt=Re({},xe.props),nr=xe.key,cr=xe.ref,ur=xe._owner;if(Ne!=null){if(Ne.ref!==void 0&&(cr=Ne.ref,ur=He.current),Ne.key!==void 0&&(nr=""+Ne.key),xe.type&&xe.type.defaultProps)var or=xe.type.defaultProps;for(Ir in Ne)Je.call(Ne,Ir)&&!je.hasOwnProperty(Ir)&&(Yt[Ir]=Ne[Ir]===void 0&&or!==void 0?or[Ir]:Ne[Ir])}var Ir=arguments.length-2;if(Ir===1)Yt.children=Xt;else if(1<Ir){or=Array(Ir);for(var mn=0;mn<Ir;mn++)or[mn]=arguments[mn+2];Yt.children=or}return{$$typeof:_,type:xe.type,key:nr,ref:cr,props:Yt,_owner:ur}},_r.createContext=function(xe){return xe={$$typeof:T,_currentValue:xe,_currentValue2:xe,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},xe.Provider={$$typeof:F,_context:xe},xe.Consumer=xe},_r.createElement=pt,_r.createFactory=function(xe){var Ne=pt.bind(null,xe);return Ne.type=xe,Ne},_r.createRef=function(){return{current:null}},_r.forwardRef=function(xe){return{$$typeof:h,render:xe}},_r.isValidElement=ar,_r.lazy=function(xe){return{$$typeof:ne,_payload:{_status:-1,_result:xe},_init:Pr}},_r.memo=function(xe,Ne){return{$$typeof:ue,type:xe,compare:Ne===void 0?null:Ne}},_r.startTransition=function(xe){var Ne=ot.transition;ot.transition={};try{xe()}finally{ot.transition=Ne}},_r.unstable_act=ft,_r.useCallback=function(xe,Ne){return $t.current.useCallback(xe,Ne)},_r.useContext=function(xe){return $t.current.useContext(xe)},_r.useDebugValue=function(){},_r.useDeferredValue=function(xe){return $t.current.useDeferredValue(xe)},_r.useEffect=function(xe,Ne){return $t.current.useEffect(xe,Ne)},_r.useId=function(){return $t.current.useId()},_r.useImperativeHandle=function(xe,Ne,Xt){return $t.current.useImperativeHandle(xe,Ne,Xt)},_r.useInsertionEffect=function(xe,Ne){return $t.current.useInsertionEffect(xe,Ne)},_r.useLayoutEffect=function(xe,Ne){return $t.current.useLayoutEffect(xe,Ne)},_r.useMemo=function(xe,Ne){return $t.current.useMemo(xe,Ne)},_r.useReducer=function(xe,Ne,Xt){return $t.current.useReducer(xe,Ne,Xt)},_r.useRef=function(xe){return $t.current.useRef(xe)},_r.useState=function(xe){return $t.current.useState(xe)},_r.useSyncExternalStore=function(xe,Ne,Xt){return $t.current.useSyncExternalStore(xe,Ne,Xt)},_r.useTransition=function(){return $t.current.useTransition()},_r.version="18.3.1",_r}var fg;function Nm(){return fg||(fg=1,Jf.exports=qy()),Jf.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mg;function Zy(){if(mg)return Fd;mg=1;var _=Nm(),y=Symbol.for("react.element"),b=Symbol.for("react.fragment"),C=Object.prototype.hasOwnProperty,D=_.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,F={key:!0,ref:!0,__self:!0,__source:!0};function T(h,W,ue){var ne,Y={},Z=null,Ie=null;ue!==void 0&&(Z=""+ue),W.key!==void 0&&(Z=""+W.key),W.ref!==void 0&&(Ie=W.ref);for(ne in W)C.call(W,ne)&&!F.hasOwnProperty(ne)&&(Y[ne]=W[ne]);if(h&&h.defaultProps)for(ne in W=h.defaultProps,W)Y[ne]===void 0&&(Y[ne]=W[ne]);return{$$typeof:y,type:h,key:Z,ref:Ie,props:Y,_owner:D.current}}return Fd.Fragment=b,Fd.jsx=T,Fd.jsxs=T,Fd}var gg;function Gy(){return gg||(gg=1,Yf.exports=Zy()),Yf.exports}var at=Gy(),Xr=Nm();const Hy=Om(Xr);var Xp={},Qf={exports:{}},Fs={},em={exports:{}},tm={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yg;function Ky(){return yg||(yg=1,(function(_){function y(ot,Pt){var ft=ot.length;ot.push(Pt);e:for(;0<ft;){var xe=ft-1>>>1,Ne=ot[xe];if(0<D(Ne,Pt))ot[xe]=Pt,ot[ft]=Ne,ft=xe;else break e}}function b(ot){return ot.length===0?null:ot[0]}function C(ot){if(ot.length===0)return null;var Pt=ot[0],ft=ot.pop();if(ft!==Pt){ot[0]=ft;e:for(var xe=0,Ne=ot.length,Xt=Ne>>>1;xe<Xt;){var Yt=2*(xe+1)-1,nr=ot[Yt],cr=Yt+1,ur=ot[cr];if(0>D(nr,ft))cr<Ne&&0>D(ur,nr)?(ot[xe]=ur,ot[cr]=ft,xe=cr):(ot[xe]=nr,ot[Yt]=ft,xe=Yt);else if(cr<Ne&&0>D(ur,ft))ot[xe]=ur,ot[cr]=ft,xe=cr;else break e}}return Pt}function D(ot,Pt){var ft=ot.sortIndex-Pt.sortIndex;return ft!==0?ft:ot.id-Pt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var F=performance;_.unstable_now=function(){return F.now()}}else{var T=Date,h=T.now();_.unstable_now=function(){return T.now()-h}}var W=[],ue=[],ne=1,Y=null,Z=3,Ie=!1,Re=!1,Pe=!1,Le=typeof setTimeout=="function"?setTimeout:null,De=typeof clearTimeout=="function"?clearTimeout:null,ze=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Ue(ot){for(var Pt=b(ue);Pt!==null;){if(Pt.callback===null)C(ue);else if(Pt.startTime<=ot)C(ue),Pt.sortIndex=Pt.expirationTime,y(W,Pt);else break;Pt=b(ue)}}function et(ot){if(Pe=!1,Ue(ot),!Re)if(b(W)!==null)Re=!0,Pr(Je);else{var Pt=b(ue);Pt!==null&&$t(et,Pt.startTime-ot)}}function Je(ot,Pt){Re=!1,Pe&&(Pe=!1,De(pt),pt=-1),Ie=!0;var ft=Z;try{for(Ue(Pt),Y=b(W);Y!==null&&(!(Y.expirationTime>Pt)||ot&&!xt());){var xe=Y.callback;if(typeof xe=="function"){Y.callback=null,Z=Y.priorityLevel;var Ne=xe(Y.expirationTime<=Pt);Pt=_.unstable_now(),typeof Ne=="function"?Y.callback=Ne:Y===b(W)&&C(W),Ue(Pt)}else C(W);Y=b(W)}if(Y!==null)var Xt=!0;else{var Yt=b(ue);Yt!==null&&$t(et,Yt.startTime-Pt),Xt=!1}return Xt}finally{Y=null,Z=ft,Ie=!1}}var He=!1,je=null,pt=-1,$e=5,ar=-1;function xt(){return!(_.unstable_now()-ar<$e)}function wr(){if(je!==null){var ot=_.unstable_now();ar=ot;var Pt=!0;try{Pt=je(!0,ot)}finally{Pt?Zt():(He=!1,je=null)}}else He=!1}var Zt;if(typeof ze=="function")Zt=function(){ze(wr)};else if(typeof MessageChannel<"u"){var Nt=new MessageChannel,Mr=Nt.port2;Nt.port1.onmessage=wr,Zt=function(){Mr.postMessage(null)}}else Zt=function(){Le(wr,0)};function Pr(ot){je=ot,He||(He=!0,Zt())}function $t(ot,Pt){pt=Le(function(){ot(_.unstable_now())},Pt)}_.unstable_IdlePriority=5,_.unstable_ImmediatePriority=1,_.unstable_LowPriority=4,_.unstable_NormalPriority=3,_.unstable_Profiling=null,_.unstable_UserBlockingPriority=2,_.unstable_cancelCallback=function(ot){ot.callback=null},_.unstable_continueExecution=function(){Re||Ie||(Re=!0,Pr(Je))},_.unstable_forceFrameRate=function(ot){0>ot||125<ot?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):$e=0<ot?Math.floor(1e3/ot):5},_.unstable_getCurrentPriorityLevel=function(){return Z},_.unstable_getFirstCallbackNode=function(){return b(W)},_.unstable_next=function(ot){switch(Z){case 1:case 2:case 3:var Pt=3;break;default:Pt=Z}var ft=Z;Z=Pt;try{return ot()}finally{Z=ft}},_.unstable_pauseExecution=function(){},_.unstable_requestPaint=function(){},_.unstable_runWithPriority=function(ot,Pt){switch(ot){case 1:case 2:case 3:case 4:case 5:break;default:ot=3}var ft=Z;Z=ot;try{return Pt()}finally{Z=ft}},_.unstable_scheduleCallback=function(ot,Pt,ft){var xe=_.unstable_now();switch(typeof ft=="object"&&ft!==null?(ft=ft.delay,ft=typeof ft=="number"&&0<ft?xe+ft:xe):ft=xe,ot){case 1:var Ne=-1;break;case 2:Ne=250;break;case 5:Ne=1073741823;break;case 4:Ne=1e4;break;default:Ne=5e3}return Ne=ft+Ne,ot={id:ne++,callback:Pt,priorityLevel:ot,startTime:ft,expirationTime:Ne,sortIndex:-1},ft>xe?(ot.sortIndex=ft,y(ue,ot),b(W)===null&&ot===b(ue)&&(Pe?(De(pt),pt=-1):Pe=!0,$t(et,ft-xe))):(ot.sortIndex=Ne,y(W,ot),Re||Ie||(Re=!0,Pr(Je))),ot},_.unstable_shouldYield=xt,_.unstable_wrapCallback=function(ot){var Pt=Z;return function(){var ft=Z;Z=Pt;try{return ot.apply(this,arguments)}finally{Z=ft}}}})(tm)),tm}var _g;function Wy(){return _g||(_g=1,em.exports=Ky()),em.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vg;function Xy(){if(vg)return Fs;vg=1;var _=Nm(),y=Wy();function b(i){for(var a="https://reactjs.org/docs/error-decoder.html?invariant="+i,d=1;d<arguments.length;d++)a+="&args[]="+encodeURIComponent(arguments[d]);return"Minified React error #"+i+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var C=new Set,D={};function F(i,a){T(i,a),T(i+"Capture",a)}function T(i,a){for(D[i]=a,i=0;i<a.length;i++)C.add(a[i])}var h=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),W=Object.prototype.hasOwnProperty,ue=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,ne={},Y={};function Z(i){return W.call(Y,i)?!0:W.call(ne,i)?!1:ue.test(i)?Y[i]=!0:(ne[i]=!0,!1)}function Ie(i,a,d,v){if(d!==null&&d.type===0)return!1;switch(typeof a){case"function":case"symbol":return!0;case"boolean":return v?!1:d!==null?!d.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function Re(i,a,d,v){if(a===null||typeof a>"u"||Ie(i,a,d,v))return!0;if(v)return!1;if(d!==null)switch(d.type){case 3:return!a;case 4:return a===!1;case 5:return isNaN(a);case 6:return isNaN(a)||1>a}return!1}function Pe(i,a,d,v,I,M,$){this.acceptsBooleans=a===2||a===3||a===4,this.attributeName=v,this.attributeNamespace=I,this.mustUseProperty=d,this.propertyName=i,this.type=a,this.sanitizeURL=M,this.removeEmptyString=$}var Le={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){Le[i]=new Pe(i,0,!1,i,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var a=i[0];Le[a]=new Pe(a,1,!1,i[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(i){Le[i]=new Pe(i,2,!1,i.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){Le[i]=new Pe(i,2,!1,i,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){Le[i]=new Pe(i,3,!1,i.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(i){Le[i]=new Pe(i,3,!0,i,null,!1,!1)}),["capture","download"].forEach(function(i){Le[i]=new Pe(i,4,!1,i,null,!1,!1)}),["cols","rows","size","span"].forEach(function(i){Le[i]=new Pe(i,6,!1,i,null,!1,!1)}),["rowSpan","start"].forEach(function(i){Le[i]=new Pe(i,5,!1,i.toLowerCase(),null,!1,!1)});var De=/[\-:]([a-z])/g;function ze(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var a=i.replace(De,ze);Le[a]=new Pe(a,1,!1,i,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var a=i.replace(De,ze);Le[a]=new Pe(a,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(i){var a=i.replace(De,ze);Le[a]=new Pe(a,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(i){Le[i]=new Pe(i,1,!1,i.toLowerCase(),null,!1,!1)}),Le.xlinkHref=new Pe("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(i){Le[i]=new Pe(i,1,!1,i.toLowerCase(),null,!0,!0)});function Ue(i,a,d,v){var I=Le.hasOwnProperty(a)?Le[a]:null;(I!==null?I.type!==0:v||!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(Re(a,d,I,v)&&(d=null),v||I===null?Z(a)&&(d===null?i.removeAttribute(a):i.setAttribute(a,""+d)):I.mustUseProperty?i[I.propertyName]=d===null?I.type===3?!1:"":d:(a=I.attributeName,v=I.attributeNamespace,d===null?i.removeAttribute(a):(I=I.type,d=I===3||I===4&&d===!0?"":""+d,v?i.setAttributeNS(v,a,d):i.setAttribute(a,d))))}var et=_.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Je=Symbol.for("react.element"),He=Symbol.for("react.portal"),je=Symbol.for("react.fragment"),pt=Symbol.for("react.strict_mode"),$e=Symbol.for("react.profiler"),ar=Symbol.for("react.provider"),xt=Symbol.for("react.context"),wr=Symbol.for("react.forward_ref"),Zt=Symbol.for("react.suspense"),Nt=Symbol.for("react.suspense_list"),Mr=Symbol.for("react.memo"),Pr=Symbol.for("react.lazy"),$t=Symbol.for("react.offscreen"),ot=Symbol.iterator;function Pt(i){return i===null||typeof i!="object"?null:(i=ot&&i[ot]||i["@@iterator"],typeof i=="function"?i:null)}var ft=Object.assign,xe;function Ne(i){if(xe===void 0)try{throw Error()}catch(d){var a=d.stack.trim().match(/\n( *(at )?)/);xe=a&&a[1]||""}return`
`+xe+i}var Xt=!1;function Yt(i,a){if(!i||Xt)return"";Xt=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(a)if(a=function(){throw Error()},Object.defineProperty(a.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(a,[])}catch(Ce){var v=Ce}Reflect.construct(i,[],a)}else{try{a.call()}catch(Ce){v=Ce}i.call(a.prototype)}else{try{throw Error()}catch(Ce){v=Ce}i()}}catch(Ce){if(Ce&&v&&typeof Ce.stack=="string"){for(var I=Ce.stack.split(`
`),M=v.stack.split(`
`),$=I.length-1,ae=M.length-1;1<=$&&0<=ae&&I[$]!==M[ae];)ae--;for(;1<=$&&0<=ae;$--,ae--)if(I[$]!==M[ae]){if($!==1||ae!==1)do if($--,ae--,0>ae||I[$]!==M[ae]){var pe=`
`+I[$].replace(" at new "," at ");return i.displayName&&pe.includes("<anonymous>")&&(pe=pe.replace("<anonymous>",i.displayName)),pe}while(1<=$&&0<=ae);break}}}finally{Xt=!1,Error.prepareStackTrace=d}return(i=i?i.displayName||i.name:"")?Ne(i):""}function nr(i){switch(i.tag){case 5:return Ne(i.type);case 16:return Ne("Lazy");case 13:return Ne("Suspense");case 19:return Ne("SuspenseList");case 0:case 2:case 15:return i=Yt(i.type,!1),i;case 11:return i=Yt(i.type.render,!1),i;case 1:return i=Yt(i.type,!0),i;default:return""}}function cr(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case je:return"Fragment";case He:return"Portal";case $e:return"Profiler";case pt:return"StrictMode";case Zt:return"Suspense";case Nt:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case xt:return(i.displayName||"Context")+".Consumer";case ar:return(i._context.displayName||"Context")+".Provider";case wr:var a=i.render;return i=i.displayName,i||(i=a.displayName||a.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case Mr:return a=i.displayName||null,a!==null?a:cr(i.type)||"Memo";case Pr:a=i._payload,i=i._init;try{return cr(i(a))}catch{}}return null}function ur(i){var a=i.type;switch(i.tag){case 24:return"Cache";case 9:return(a.displayName||"Context")+".Consumer";case 10:return(a._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=a.render,i=i.displayName||i.name||"",a.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return a;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return cr(a);case 8:return a===pt?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a}return null}function or(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function Ir(i){var a=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function mn(i){var a=Ir(i)?"checked":"value",d=Object.getOwnPropertyDescriptor(i.constructor.prototype,a),v=""+i[a];if(!i.hasOwnProperty(a)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var I=d.get,M=d.set;return Object.defineProperty(i,a,{configurable:!0,get:function(){return I.call(this)},set:function($){v=""+$,M.call(this,$)}}),Object.defineProperty(i,a,{enumerable:d.enumerable}),{getValue:function(){return v},setValue:function($){v=""+$},stopTracking:function(){i._valueTracker=null,delete i[a]}}}}function pa(i){i._valueTracker||(i._valueTracker=mn(i))}function ws(i){if(!i)return!1;var a=i._valueTracker;if(!a)return!0;var d=a.getValue(),v="";return i&&(v=Ir(i)?i.checked?"true":"false":i.value),i=v,i!==d?(a.setValue(i),!0):!1}function Yi(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function bs(i,a){var d=a.checked;return ft({},a,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:d??i._wrapperState.initialChecked})}function Ra(i,a){var d=a.defaultValue==null?"":a.defaultValue,v=a.checked!=null?a.checked:a.defaultChecked;d=or(a.value!=null?a.value:d),i._wrapperState={initialChecked:v,initialValue:d,controlled:a.type==="checkbox"||a.type==="radio"?a.checked!=null:a.value!=null}}function Ee(i,a){a=a.checked,a!=null&&Ue(i,"checked",a,!1)}function Ns(i,a){Ee(i,a);var d=or(a.value),v=a.type;if(d!=null)v==="number"?(d===0&&i.value===""||i.value!=d)&&(i.value=""+d):i.value!==""+d&&(i.value=""+d);else if(v==="submit"||v==="reset"){i.removeAttribute("value");return}a.hasOwnProperty("value")?pr(i,a.type,d):a.hasOwnProperty("defaultValue")&&pr(i,a.type,or(a.defaultValue)),a.checked==null&&a.defaultChecked!=null&&(i.defaultChecked=!!a.defaultChecked)}function co(i,a,d){if(a.hasOwnProperty("value")||a.hasOwnProperty("defaultValue")){var v=a.type;if(!(v!=="submit"&&v!=="reset"||a.value!==void 0&&a.value!==null))return;a=""+i._wrapperState.initialValue,d||a===i.value||(i.value=a),i.defaultValue=a}d=i.name,d!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,d!==""&&(i.name=d)}function pr(i,a,d){(a!=="number"||Yi(i.ownerDocument)!==i)&&(d==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+d&&(i.defaultValue=""+d))}var Rr=Array.isArray;function Ss(i,a,d,v){if(i=i.options,a){a={};for(var I=0;I<d.length;I++)a["$"+d[I]]=!0;for(d=0;d<i.length;d++)I=a.hasOwnProperty("$"+i[d].value),i[d].selected!==I&&(i[d].selected=I),I&&v&&(i[d].defaultSelected=!0)}else{for(d=""+or(d),a=null,I=0;I<i.length;I++){if(i[I].value===d){i[I].selected=!0,v&&(i[I].defaultSelected=!0);return}a!==null||i[I].disabled||(a=i[I])}a!==null&&(a.selected=!0)}}function ks(i,a){if(a.dangerouslySetInnerHTML!=null)throw Error(b(91));return ft({},a,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function Ts(i,a){var d=a.value;if(d==null){if(d=a.children,a=a.defaultValue,d!=null){if(a!=null)throw Error(b(92));if(Rr(d)){if(1<d.length)throw Error(b(93));d=d[0]}a=d}a==null&&(a=""),d=a}i._wrapperState={initialValue:or(d)}}function Ba(i,a){var d=or(a.value),v=or(a.defaultValue);d!=null&&(d=""+d,d!==i.value&&(i.value=d),a.defaultValue==null&&i.defaultValue!==d&&(i.defaultValue=d)),v!=null&&(i.defaultValue=""+v)}function mi(i){var a=i.textContent;a===i._wrapperState.initialValue&&a!==""&&a!==null&&(i.value=a)}function ho(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Fa(i,a){return i==null||i==="http://www.w3.org/1999/xhtml"?ho(a):i==="http://www.w3.org/2000/svg"&&a==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var Ke,Ji=(function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(a,d,v,I){MSApp.execUnsafeLocalFunction(function(){return i(a,d,v,I)})}:i})(function(i,a){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=a;else{for(Ke=Ke||document.createElement("div"),Ke.innerHTML="<svg>"+a.valueOf().toString()+"</svg>",a=Ke.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;a.firstChild;)i.appendChild(a.firstChild)}});function gn(i,a){if(a){var d=i.firstChild;if(d&&d===i.lastChild&&d.nodeType===3){d.nodeValue=a;return}}i.textContent=a}var Jn={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},fa=["Webkit","ms","Moz","O"];Object.keys(Jn).forEach(function(i){fa.forEach(function(a){a=a+i.charAt(0).toUpperCase()+i.substring(1),Jn[a]=Jn[i]})});function rt(i,a,d){return a==null||typeof a=="boolean"||a===""?"":d||typeof a!="number"||a===0||Jn.hasOwnProperty(i)&&Jn[i]?(""+a).trim():a+"px"}function Jt(i,a){i=i.style;for(var d in a)if(a.hasOwnProperty(d)){var v=d.indexOf("--")===0,I=rt(d,a[d],v);d==="float"&&(d="cssFloat"),v?i.setProperty(d,I):i[d]=I}}var Rt=ft({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ln(i,a){if(a){if(Rt[i]&&(a.children!=null||a.dangerouslySetInnerHTML!=null))throw Error(b(137,i));if(a.dangerouslySetInnerHTML!=null){if(a.children!=null)throw Error(b(60));if(typeof a.dangerouslySetInnerHTML!="object"||!("__html"in a.dangerouslySetInnerHTML))throw Error(b(61))}if(a.style!=null&&typeof a.style!="object")throw Error(b(62))}}function gi(i,a){if(i.indexOf("-")===-1)return typeof a.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var jt=null;function Ai(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var Qi=null,yi=null,Un=null;function ie(i){if(i=vl(i)){if(typeof Qi!="function")throw Error(b(280));var a=i.stateNode;a&&(a=xl(a),Qi(i.stateNode,i.type,a))}}function j(i){yi?Un?Un.push(i):Un=[i]:yi=i}function N(){if(yi){var i=yi,a=Un;if(Un=yi=null,ie(i),a)for(i=0;i<a.length;i++)ie(a[i])}}function H(i,a){return i(a)}function ee(){}var he=!1;function me(i,a,d){if(he)return i(a,d);he=!0;try{return H(i,a,d)}finally{he=!1,(yi!==null||Un!==null)&&(ee(),N())}}function ve(i,a){var d=i.stateNode;if(d===null)return null;var v=xl(d);if(v===null)return null;d=v[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(v=!v.disabled)||(i=i.type,v=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!v;break e;default:i=!1}if(i)return null;if(d&&typeof d!="function")throw Error(b(231,a,typeof d));return d}var le=!1;if(h)try{var Me={};Object.defineProperty(Me,"passive",{get:function(){le=!0}}),window.addEventListener("test",Me,Me),window.removeEventListener("test",Me,Me)}catch{le=!1}function Oe(i,a,d,v,I,M,$,ae,pe){var Ce=Array.prototype.slice.call(arguments,3);try{a.apply(d,Ce)}catch(Ze){this.onError(Ze)}}var ke=!1,Ye=null,wt=!1,Ct=null,fr={onError:function(i){ke=!0,Ye=i}};function Gt(i,a,d,v,I,M,$,ae,pe){ke=!1,Ye=null,Oe.apply(fr,arguments)}function mr(i,a,d,v,I,M,$,ae,pe){if(Gt.apply(this,arguments),ke){if(ke){var Ce=Ye;ke=!1,Ye=null}else throw Error(b(198));wt||(wt=!0,Ct=Ce)}}function Wt(i){var a=i,d=i;if(i.alternate)for(;a.return;)a=a.return;else{i=a;do a=i,(a.flags&4098)!==0&&(d=a.return),i=a.return;while(i)}return a.tag===3?d:null}function sn(i){if(i.tag===13){var a=i.memoizedState;if(a===null&&(i=i.alternate,i!==null&&(a=i.memoizedState)),a!==null)return a.dehydrated}return null}function Gr(i){if(Wt(i)!==i)throw Error(b(188))}function tr(i){var a=i.alternate;if(!a){if(a=Wt(i),a===null)throw Error(b(188));return a!==i?null:i}for(var d=i,v=a;;){var I=d.return;if(I===null)break;var M=I.alternate;if(M===null){if(v=I.return,v!==null){d=v;continue}break}if(I.child===M.child){for(M=I.child;M;){if(M===d)return Gr(I),i;if(M===v)return Gr(I),a;M=M.sibling}throw Error(b(188))}if(d.return!==v.return)d=I,v=M;else{for(var $=!1,ae=I.child;ae;){if(ae===d){$=!0,d=I,v=M;break}if(ae===v){$=!0,v=I,d=M;break}ae=ae.sibling}if(!$){for(ae=M.child;ae;){if(ae===d){$=!0,d=M,v=I;break}if(ae===v){$=!0,v=M,d=I;break}ae=ae.sibling}if(!$)throw Error(b(189))}}if(d.alternate!==v)throw Error(b(190))}if(d.tag!==3)throw Error(b(188));return d.stateNode.current===d?i:a}function br(i){return i=tr(i),i!==null?jr(i):null}function jr(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var a=jr(i);if(a!==null)return a;i=i.sibling}return null}var yn=y.unstable_scheduleCallback,Sn=y.unstable_cancelCallback,$n=y.unstable_shouldYield,po=y.unstable_requestPaint,Vt=y.unstable_now,zu=y.unstable_getCurrentPriorityLevel,tl=y.unstable_ImmediatePriority,Qn=y.unstable_UserBlockingPriority,Rn=y.unstable_NormalPriority,Jh=y.unstable_LowPriority,_i=y.unstable_IdlePriority,Bn=null,qn=null;function Oa(i){if(qn&&typeof qn.onCommitFiberRoot=="function")try{qn.onCommitFiberRoot(Bn,i,void 0,(i.current.flags&128)===128)}catch{}}var Er=Math.clz32?Math.clz32:an,rl=Math.log,es=Math.LN2;function an(i){return i>>>=0,i===0?32:31-(rl(i)/es|0)|0}var Na=64,ei=4194304;function ja(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function ti(i,a){var d=i.pendingLanes;if(d===0)return 0;var v=0,I=i.suspendedLanes,M=i.pingedLanes,$=d&268435455;if($!==0){var ae=$&~I;ae!==0?v=ja(ae):(M&=$,M!==0&&(v=ja(M)))}else $=d&~I,$!==0?v=ja($):M!==0&&(v=ja(M));if(v===0)return 0;if(a!==0&&a!==v&&(a&I)===0&&(I=v&-v,M=a&-a,I>=M||I===16&&(M&4194240)!==0))return a;if((v&4)!==0&&(v|=d&16),a=i.entangledLanes,a!==0)for(i=i.entanglements,a&=v;0<a;)d=31-Er(a),I=1<<d,v|=i[d],a&=~I;return v}function Qh(i,a){switch(i){case 1:case 2:case 4:return a+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function $l(i,a){for(var d=i.suspendedLanes,v=i.pingedLanes,I=i.expirationTimes,M=i.pendingLanes;0<M;){var $=31-Er(M),ae=1<<$,pe=I[$];pe===-1?((ae&d)===0||(ae&v)!==0)&&(I[$]=Qh(ae,a)):pe<=a&&(i.expiredLanes|=ae),M&=~ae}}function js(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function Vs(){var i=Na;return Na<<=1,(Na&4194240)===0&&(Na=64),i}function gr(i){for(var a=[],d=0;31>d;d++)a.push(i);return a}function Va(i,a,d){i.pendingLanes|=a,a!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,a=31-Er(a),i[a]=d}function Du(i,a){var d=i.pendingLanes&~a;i.pendingLanes=a,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=a,i.mutableReadLanes&=a,i.entangledLanes&=a,a=i.entanglements;var v=i.eventTimes;for(i=i.expirationTimes;0<d;){var I=31-Er(d),M=1<<I;a[I]=0,v[I]=-1,i[I]=-1,d&=~M}}function ma(i,a){var d=i.entangledLanes|=a;for(i=i.entanglements;d;){var v=31-Er(d),I=1<<v;I&a|i[v]&a&&(i[v]|=a),d&=~I}}var Sr=0;function nl(i){return i&=-i,1<i?4<i?(i&268435455)!==0?16:536870912:4:1}var fo,mo,Ua,Lu,qc,ql=!1,Zl=[],ri=null,zi=null,on=null,kn=new Map,ga=new Map,ts=[],Gl="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ru(i,a){switch(i){case"focusin":case"focusout":ri=null;break;case"dragenter":case"dragleave":zi=null;break;case"mouseover":case"mouseout":on=null;break;case"pointerover":case"pointerout":kn.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":ga.delete(a.pointerId)}}function Is(i,a,d,v,I,M){return i===null||i.nativeEvent!==M?(i={blockedOn:a,domEventName:d,eventSystemFlags:v,nativeEvent:M,targetContainers:[I]},a!==null&&(a=vl(a),a!==null&&mo(a)),i):(i.eventSystemFlags|=v,a=i.targetContainers,I!==null&&a.indexOf(I)===-1&&a.push(I),i)}function ed(i,a,d,v,I){switch(a){case"focusin":return ri=Is(ri,i,a,d,v,I),!0;case"dragenter":return zi=Is(zi,i,a,d,v,I),!0;case"mouseover":return on=Is(on,i,a,d,v,I),!0;case"pointerover":var M=I.pointerId;return kn.set(M,Is(kn.get(M)||null,i,a,d,v,I)),!0;case"gotpointercapture":return M=I.pointerId,ga.set(M,Is(ga.get(M)||null,i,a,d,v,I)),!0}return!1}function Bu(i){var a=Qs(i.target);if(a!==null){var d=Wt(a);if(d!==null){if(a=d.tag,a===13){if(a=sn(d),a!==null){i.blockedOn=a,qc(i.priority,function(){Ua(d)});return}}else if(a===3&&d.stateNode.current.memoizedState.isDehydrated){i.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}i.blockedOn=null}function il(i){if(i.blockedOn!==null)return!1;for(var a=i.targetContainers;0<a.length;){var d=sl(i.domEventName,i.eventSystemFlags,a[0],i.nativeEvent);if(d===null){d=i.nativeEvent;var v=new d.constructor(d.type,d);jt=v,d.target.dispatchEvent(v),jt=null}else return a=vl(d),a!==null&&mo(a),i.blockedOn=d,!1;a.shift()}return!0}function Zc(i,a,d){il(i)&&d.delete(a)}function td(){ql=!1,ri!==null&&il(ri)&&(ri=null),zi!==null&&il(zi)&&(zi=null),on!==null&&il(on)&&(on=null),kn.forEach(Zc),ga.forEach(Zc)}function go(i,a){i.blockedOn===a&&(i.blockedOn=null,ql||(ql=!0,y.unstable_scheduleCallback(y.unstable_NormalPriority,td)))}function Us(i){function a(I){return go(I,i)}if(0<Zl.length){go(Zl[0],i);for(var d=1;d<Zl.length;d++){var v=Zl[d];v.blockedOn===i&&(v.blockedOn=null)}}for(ri!==null&&go(ri,i),zi!==null&&go(zi,i),on!==null&&go(on,i),kn.forEach(a),ga.forEach(a),d=0;d<ts.length;d++)v=ts[d],v.blockedOn===i&&(v.blockedOn=null);for(;0<ts.length&&(d=ts[0],d.blockedOn===null);)Bu(d),d.blockedOn===null&&ts.shift()}var ya=et.ReactCurrentBatchConfig,$a=!0;function Fu(i,a,d,v){var I=Sr,M=ya.transition;ya.transition=null;try{Sr=1,Di(i,a,d,v)}finally{Sr=I,ya.transition=M}}function Ou(i,a,d,v){var I=Sr,M=ya.transition;ya.transition=null;try{Sr=4,Di(i,a,d,v)}finally{Sr=I,ya.transition=M}}function Di(i,a,d,v){if($a){var I=sl(i,a,d,v);if(I===null)_l(i,a,v,Hl,d),Ru(i,v);else if(ed(I,i,a,d,v))v.stopPropagation();else if(Ru(i,v),a&4&&-1<Gl.indexOf(i)){for(;I!==null;){var M=vl(I);if(M!==null&&fo(M),M=sl(i,a,d,v),M===null&&_l(i,a,v,Hl,d),M===I)break;I=M}I!==null&&v.stopPropagation()}else _l(i,a,v,null,d)}}var Hl=null;function sl(i,a,d,v){if(Hl=null,i=Ai(v),i=Qs(i),i!==null)if(a=Wt(i),a===null)i=null;else if(d=a.tag,d===13){if(i=sn(a),i!==null)return i;i=null}else if(d===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;i=null}else a!==i&&(i=null);return Hl=i,null}function _a(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(zu()){case tl:return 1;case Qn:return 4;case Rn:case Jh:return 16;case _i:return 536870912;default:return 16}default:return 16}}var Zn=null,yr=null,qa=null;function Gc(){if(qa)return qa;var i,a=yr,d=a.length,v,I="value"in Zn?Zn.value:Zn.textContent,M=I.length;for(i=0;i<d&&a[i]===I[i];i++);var $=d-i;for(v=1;v<=$&&a[d-v]===I[M-v];v++);return qa=I.slice(i,1<v?1-v:void 0)}function $s(i){var a=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&a===13&&(i=13)):i=a,i===10&&(i=13),32<=i||i===13?i:0}function Kl(){return!0}function Nu(){return!1}function vi(i){function a(d,v,I,M,$){this._reactName=d,this._targetInst=I,this.type=v,this.nativeEvent=M,this.target=$,this.currentTarget=null;for(var ae in i)i.hasOwnProperty(ae)&&(d=i[ae],this[ae]=d?d(M):M[ae]);return this.isDefaultPrevented=(M.defaultPrevented!=null?M.defaultPrevented:M.returnValue===!1)?Kl:Nu,this.isPropagationStopped=Nu,this}return ft(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=Kl)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=Kl)},persist:function(){},isPersistent:Kl}),a}var Za={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},al=vi(Za),yo=ft({},Za,{view:0,detail:0}),Hc=vi(yo),Wl,Xl,rs,ol=ft({},yo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ul,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==rs&&(rs&&i.type==="mousemove"?(Wl=i.screenX-rs.screenX,Xl=i.screenY-rs.screenY):Xl=Wl=0,rs=i),Wl)},movementY:function(i){return"movementY"in i?i.movementY:Xl}}),Kc=vi(ol),Wc=ft({},ol,{dataTransfer:0}),ll=vi(Wc),rd=ft({},yo,{relatedTarget:0}),_o=vi(rd),nd=ft({},Za,{animationName:0,elapsedTime:0,pseudoElement:0}),id=vi(nd),Xc=ft({},Za,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),Yc=vi(Xc),Jc=ft({},Za,{data:0}),Yl=vi(Jc),Qc={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Jl={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},qs={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ju(i){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(i):(i=qs[i])?!!a[i]:!1}function ul(){return ju}var Vu=ft({},yo,{key:function(i){if(i.key){var a=Qc[i.key]||i.key;if(a!=="Unidentified")return a}return i.type==="keypress"?(i=$s(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?Jl[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ul,charCode:function(i){return i.type==="keypress"?$s(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?$s(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),Ql=vi(Vu),Uu=ft({},ol,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),va=vi(Uu),$u=ft({},yo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ul}),sd=vi($u),tn=ft({},Za,{propertyName:0,elapsedTime:0,pseudoElement:0}),ad=vi(tn),ir=ft({},ol,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),eu=vi(ir),Br=[9,13,27,32],kr=h&&"CompositionEvent"in window,ns=null;h&&"documentMode"in document&&(ns=document.documentMode);var cl=h&&"TextEvent"in window&&!ns,vo=h&&(!kr||ns&&8<ns&&11>=ns),tu=" ",xa=!1;function Ga(i,a){switch(i){case"keyup":return Br.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function xi(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var wa=!1;function qu(i,a){switch(i){case"compositionend":return xi(a);case"keypress":return a.which!==32?null:(xa=!0,tu);case"textInput":return i=a.data,i===tu&&xa?null:i;default:return null}}function Zu(i,a){if(wa)return i==="compositionend"||!kr&&Ga(i,a)?(i=Gc(),qa=yr=Zn=null,wa=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return vo&&a.locale!=="ko"?null:a.data;default:return null}}var Ha={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function xo(i){var a=i&&i.nodeName&&i.nodeName.toLowerCase();return a==="input"?!!Ha[i.type]:a==="textarea"}function wo(i,a,d,v){j(v),a=Eo(a,"onChange"),0<a.length&&(d=new al("onChange","change",null,d,v),i.push({event:d,listeners:a}))}var Es=null,Zs=null;function ru(i){ou(i,0)}function Gs(i){var a=os(i);if(ws(a))return i}function bo(i,a){if(i==="change")return a}var Gu=!1;if(h){var hl;if(h){var hr="oninput"in document;if(!hr){var dl=document.createElement("div");dl.setAttribute("oninput","return;"),hr=typeof dl.oninput=="function"}hl=hr}else hl=!1;Gu=hl&&(!document.documentMode||9<document.documentMode)}function eh(){Es&&(Es.detachEvent("onpropertychange",Hu),Zs=Es=null)}function Hu(i){if(i.propertyName==="value"&&Gs(Zs)){var a=[];wo(a,Zs,i,Ai(i)),me(ru,a)}}function So(i,a,d){i==="focusin"?(eh(),Es=a,Zs=d,Es.attachEvent("onpropertychange",Hu)):i==="focusout"&&eh()}function th(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return Gs(Zs)}function nu(i,a){if(i==="click")return Gs(a)}function rh(i,a){if(i==="input"||i==="change")return Gs(a)}function nh(i,a){return i===a&&(i!==0||1/i===1/a)||i!==i&&a!==a}var ni=typeof Object.is=="function"?Object.is:nh;function ba(i,a){if(ni(i,a))return!0;if(typeof i!="object"||i===null||typeof a!="object"||a===null)return!1;var d=Object.keys(i),v=Object.keys(a);if(d.length!==v.length)return!1;for(v=0;v<d.length;v++){var I=d[v];if(!W.call(a,I)||!ni(i[I],a[I]))return!1}return!0}function Ka(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function Wa(i,a){var d=Ka(i);i=0;for(var v;d;){if(d.nodeType===3){if(v=i+d.textContent.length,i<=a&&v>=a)return{node:d,offset:a-i};i=v}e:{for(;d;){if(d.nextSibling){d=d.nextSibling;break e}d=d.parentNode}d=void 0}d=Ka(d)}}function Xa(i,a){return i&&a?i===a?!0:i&&i.nodeType===3?!1:a&&a.nodeType===3?Xa(i,a.parentNode):"contains"in i?i.contains(a):i.compareDocumentPosition?!!(i.compareDocumentPosition(a)&16):!1:!1}function iu(){for(var i=window,a=Yi();a instanceof i.HTMLIFrameElement;){try{var d=typeof a.contentWindow.location.href=="string"}catch{d=!1}if(d)i=a.contentWindow;else break;a=Yi(i.document)}return a}function Sa(i){var a=i&&i.nodeName&&i.nodeName.toLowerCase();return a&&(a==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||a==="textarea"||i.contentEditable==="true")}function pl(i){var a=iu(),d=i.focusedElem,v=i.selectionRange;if(a!==d&&d&&d.ownerDocument&&Xa(d.ownerDocument.documentElement,d)){if(v!==null&&Sa(d)){if(a=v.start,i=v.end,i===void 0&&(i=a),"selectionStart"in d)d.selectionStart=a,d.selectionEnd=Math.min(i,d.value.length);else if(i=(a=d.ownerDocument||document)&&a.defaultView||window,i.getSelection){i=i.getSelection();var I=d.textContent.length,M=Math.min(v.start,I);v=v.end===void 0?M:Math.min(v.end,I),!i.extend&&M>v&&(I=v,v=M,M=I),I=Wa(d,M);var $=Wa(d,v);I&&$&&(i.rangeCount!==1||i.anchorNode!==I.node||i.anchorOffset!==I.offset||i.focusNode!==$.node||i.focusOffset!==$.offset)&&(a=a.createRange(),a.setStart(I.node,I.offset),i.removeAllRanges(),M>v?(i.addRange(a),i.extend($.node,$.offset)):(a.setEnd($.node,$.offset),i.addRange(a)))}}for(a=[],i=d;i=i.parentNode;)i.nodeType===1&&a.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof d.focus=="function"&&d.focus(),d=0;d<a.length;d++)i=a[d],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var su=h&&"documentMode"in document&&11>=document.documentMode,Hs=null,fl=null,ml=null,au=!1;function gl(i,a,d){var v=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;au||Hs==null||Hs!==Yi(v)||(v=Hs,"selectionStart"in v&&Sa(v)?v={start:v.selectionStart,end:v.selectionEnd}:(v=(v.ownerDocument&&v.ownerDocument.defaultView||window).getSelection(),v={anchorNode:v.anchorNode,anchorOffset:v.anchorOffset,focusNode:v.focusNode,focusOffset:v.focusOffset}),ml&&ba(ml,v)||(ml=v,v=Eo(fl,"onSelect"),0<v.length&&(a=new al("onSelect","select",null,a,d),i.push({event:a,listeners:v}),a.target=Hs)))}function ko(i,a){var d={};return d[i.toLowerCase()]=a.toLowerCase(),d["Webkit"+i]="webkit"+a,d["Moz"+i]="moz"+a,d}var Ps={animationend:ko("Animation","AnimationEnd"),animationiteration:ko("Animation","AnimationIteration"),animationstart:ko("Animation","AnimationStart"),transitionend:ko("Transition","TransitionEnd")},Ya={},Pn={};h&&(Pn=document.createElement("div").style,"AnimationEvent"in window||(delete Ps.animationend.animation,delete Ps.animationiteration.animation,delete Ps.animationstart.animation),"TransitionEvent"in window||delete Ps.transitionend.transition);function Cs(i){if(Ya[i])return Ya[i];if(!Ps[i])return i;var a=Ps[i],d;for(d in a)if(a.hasOwnProperty(d)&&d in Pn)return Ya[i]=a[d];return i}var Ku=Cs("animationend"),Wu=Cs("animationiteration"),Yr=Cs("animationstart"),Li=Cs("transitionend"),ii=new Map,To="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ms(i,a){ii.set(i,a),F(a,[i])}for(var Io=0;Io<To.length;Io++){var ka=To[Io],Ks=ka.toLowerCase(),Xu=ka[0].toUpperCase()+ka.slice(1);Ms(Ks,"on"+Xu)}Ms(Ku,"onAnimationEnd"),Ms(Wu,"onAnimationIteration"),Ms(Yr,"onAnimationStart"),Ms("dblclick","onDoubleClick"),Ms("focusin","onFocus"),Ms("focusout","onBlur"),Ms(Li,"onTransitionEnd"),T("onMouseEnter",["mouseout","mouseover"]),T("onMouseLeave",["mouseout","mouseover"]),T("onPointerEnter",["pointerout","pointerover"]),T("onPointerLeave",["pointerout","pointerover"]),F("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),F("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),F("onBeforeInput",["compositionend","keypress","textInput","paste"]),F("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),F("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),F("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ta="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Yu=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ta));function yl(i,a,d){var v=i.type||"unknown-event";i.currentTarget=d,mr(v,a,void 0,i),i.currentTarget=null}function ou(i,a){a=(a&4)!==0;for(var d=0;d<i.length;d++){var v=i[d],I=v.event;v=v.listeners;e:{var M=void 0;if(a)for(var $=v.length-1;0<=$;$--){var ae=v[$],pe=ae.instance,Ce=ae.currentTarget;if(ae=ae.listener,pe!==M&&I.isPropagationStopped())break e;yl(I,ae,Ce),M=pe}else for($=0;$<v.length;$++){if(ae=v[$],pe=ae.instance,Ce=ae.currentTarget,ae=ae.listener,pe!==M&&I.isPropagationStopped())break e;yl(I,ae,Ce),M=pe}}}if(wt)throw i=Ct,wt=!1,Ct=null,i}function Fr(i,a){var d=a[sr];d===void 0&&(d=a[sr]=new Set);var v=i+"__bubble";d.has(v)||(lu(a,i,2,!1),d.add(v))}function Ws(i,a,d){var v=0;a&&(v|=4),lu(d,i,v,a)}var Ja="_reactListening"+Math.random().toString(36).slice(2);function Xs(i){if(!i[Ja]){i[Ja]=!0,C.forEach(function(d){d!=="selectionchange"&&(Yu.has(d)||Ws(d,!1,i),Ws(d,!0,i))});var a=i.nodeType===9?i:i.ownerDocument;a===null||a[Ja]||(a[Ja]=!0,Ws("selectionchange",!1,a))}}function lu(i,a,d,v){switch(_a(a)){case 1:var I=Fu;break;case 4:I=Ou;break;default:I=Di}d=I.bind(null,a,d,i),I=void 0,!le||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(I=!0),v?I!==void 0?i.addEventListener(a,d,{capture:!0,passive:I}):i.addEventListener(a,d,!0):I!==void 0?i.addEventListener(a,d,{passive:I}):i.addEventListener(a,d,!1)}function _l(i,a,d,v,I){var M=v;if((a&1)===0&&(a&2)===0&&v!==null)e:for(;;){if(v===null)return;var $=v.tag;if($===3||$===4){var ae=v.stateNode.containerInfo;if(ae===I||ae.nodeType===8&&ae.parentNode===I)break;if($===4)for($=v.return;$!==null;){var pe=$.tag;if((pe===3||pe===4)&&(pe=$.stateNode.containerInfo,pe===I||pe.nodeType===8&&pe.parentNode===I))return;$=$.return}for(;ae!==null;){if($=Qs(ae),$===null)return;if(pe=$.tag,pe===5||pe===6){v=M=$;continue e}ae=ae.parentNode}}v=v.return}me(function(){var Ce=M,Ze=Ai(d),We=[];e:{var qe=ii.get(i);if(qe!==void 0){var ct=al,bt=i;switch(i){case"keypress":if($s(d)===0)break e;case"keydown":case"keyup":ct=Ql;break;case"focusin":bt="focus",ct=_o;break;case"focusout":bt="blur",ct=_o;break;case"beforeblur":case"afterblur":ct=_o;break;case"click":if(d.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ct=Kc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ct=ll;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ct=sd;break;case Ku:case Wu:case Yr:ct=id;break;case Li:ct=ad;break;case"scroll":ct=Hc;break;case"wheel":ct=eu;break;case"copy":case"cut":case"paste":ct=Yc;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ct=va}var Mt=(a&4)!==0,dn=!Mt&&i==="scroll",Se=Mt?qe!==null?qe+"Capture":null:qe;Mt=[];for(var ge=Ce,Te;ge!==null;){Te=ge;var it=Te.stateNode;if(Te.tag===5&&it!==null&&(Te=it,Se!==null&&(it=ve(ge,Se),it!=null&&Mt.push(Qa(ge,it,Te)))),dn)break;ge=ge.return}0<Mt.length&&(qe=new ct(qe,bt,null,d,Ze),We.push({event:qe,listeners:Mt}))}}if((a&7)===0){e:{if(qe=i==="mouseover"||i==="pointerover",ct=i==="mouseout"||i==="pointerout",qe&&d!==jt&&(bt=d.relatedTarget||d.fromElement)&&(Qs(bt)||bt[as]))break e;if((ct||qe)&&(qe=Ze.window===Ze?Ze:(qe=Ze.ownerDocument)?qe.defaultView||qe.parentWindow:window,ct?(bt=d.relatedTarget||d.toElement,ct=Ce,bt=bt?Qs(bt):null,bt!==null&&(dn=Wt(bt),bt!==dn||bt.tag!==5&&bt.tag!==6)&&(bt=null)):(ct=null,bt=Ce),ct!==bt)){if(Mt=Kc,it="onMouseLeave",Se="onMouseEnter",ge="mouse",(i==="pointerout"||i==="pointerover")&&(Mt=va,it="onPointerLeave",Se="onPointerEnter",ge="pointer"),dn=ct==null?qe:os(ct),Te=bt==null?qe:os(bt),qe=new Mt(it,ge+"leave",ct,d,Ze),qe.target=dn,qe.relatedTarget=Te,it=null,Qs(Ze)===Ce&&(Mt=new Mt(Se,ge+"enter",bt,d,Ze),Mt.target=Te,Mt.relatedTarget=dn,it=Mt),dn=it,ct&&bt)t:{for(Mt=ct,Se=bt,ge=0,Te=Mt;Te;Te=Ys(Te))ge++;for(Te=0,it=Se;it;it=Ys(it))Te++;for(;0<ge-Te;)Mt=Ys(Mt),ge--;for(;0<Te-ge;)Se=Ys(Se),Te--;for(;ge--;){if(Mt===Se||Se!==null&&Mt===Se.alternate)break t;Mt=Ys(Mt),Se=Ys(Se)}Mt=null}else Mt=null;ct!==null&&Po(We,qe,ct,Mt,!1),bt!==null&&dn!==null&&Po(We,dn,bt,Mt,!0)}}e:{if(qe=Ce?os(Ce):window,ct=qe.nodeName&&qe.nodeName.toLowerCase(),ct==="select"||ct==="input"&&qe.type==="file")var zt=bo;else if(xo(qe))if(Gu)zt=rh;else{zt=th;var Ot=So}else(ct=qe.nodeName)&&ct.toLowerCase()==="input"&&(qe.type==="checkbox"||qe.type==="radio")&&(zt=nu);if(zt&&(zt=zt(i,Ce))){wo(We,zt,d,Ze);break e}Ot&&Ot(i,qe,Ce),i==="focusout"&&(Ot=qe._wrapperState)&&Ot.controlled&&qe.type==="number"&&pr(qe,"number",qe.value)}switch(Ot=Ce?os(Ce):window,i){case"focusin":(xo(Ot)||Ot.contentEditable==="true")&&(Hs=Ot,fl=Ce,ml=null);break;case"focusout":ml=fl=Hs=null;break;case"mousedown":au=!0;break;case"contextmenu":case"mouseup":case"dragend":au=!1,gl(We,d,Ze);break;case"selectionchange":if(su)break;case"keydown":case"keyup":gl(We,d,Ze)}var Dt;if(kr)e:{switch(i){case"compositionstart":var Kt="onCompositionStart";break e;case"compositionend":Kt="onCompositionEnd";break e;case"compositionupdate":Kt="onCompositionUpdate";break e}Kt=void 0}else wa?Ga(i,d)&&(Kt="onCompositionEnd"):i==="keydown"&&d.keyCode===229&&(Kt="onCompositionStart");Kt&&(vo&&d.locale!=="ko"&&(wa||Kt!=="onCompositionStart"?Kt==="onCompositionEnd"&&wa&&(Dt=Gc()):(Zn=Ze,yr="value"in Zn?Zn.value:Zn.textContent,wa=!0)),Ot=Eo(Ce,Kt),0<Ot.length&&(Kt=new Yl(Kt,i,null,d,Ze),We.push({event:Kt,listeners:Ot}),Dt?Kt.data=Dt:(Dt=xi(d),Dt!==null&&(Kt.data=Dt)))),(Dt=cl?qu(i,d):Zu(i,d))&&(Ce=Eo(Ce,"onBeforeInput"),0<Ce.length&&(Ze=new Yl("onBeforeInput","beforeinput",null,d,Ze),We.push({event:Ze,listeners:Ce}),Ze.data=Dt))}ou(We,a)})}function Qa(i,a,d){return{instance:i,listener:a,currentTarget:d}}function Eo(i,a){for(var d=a+"Capture",v=[];i!==null;){var I=i,M=I.stateNode;I.tag===5&&M!==null&&(I=M,M=ve(i,d),M!=null&&v.unshift(Qa(i,M,I)),M=ve(i,a),M!=null&&v.push(Qa(i,M,I))),i=i.return}return v}function Ys(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function Po(i,a,d,v,I){for(var M=a._reactName,$=[];d!==null&&d!==v;){var ae=d,pe=ae.alternate,Ce=ae.stateNode;if(pe!==null&&pe===v)break;ae.tag===5&&Ce!==null&&(ae=Ce,I?(pe=ve(d,M),pe!=null&&$.unshift(Qa(d,pe,ae))):I||(pe=ve(d,M),pe!=null&&$.push(Qa(d,pe,ae)))),d=d.return}$.length!==0&&i.push({event:a,listeners:$})}var ih=/\r\n?/g,Ri=/\u0000|\uFFFD/g;function is(i){return(typeof i=="string"?i:""+i).replace(ih,`
`).replace(Ri,"")}function Co(i,a,d){if(a=is(a),is(i)!==a&&d)throw Error(b(425))}function si(){}var Js=null,Ju=null;function Qu(i,a){return i==="textarea"||i==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var uu=typeof setTimeout=="function"?setTimeout:void 0,sh=typeof clearTimeout=="function"?clearTimeout:void 0,cu=typeof Promise=="function"?Promise:void 0,Mo=typeof queueMicrotask=="function"?queueMicrotask:typeof cu<"u"?function(i){return cu.resolve(null).then(i).catch(Bi)}:uu;function Bi(i){setTimeout(function(){throw i})}function mt(i,a){var d=a,v=0;do{var I=d.nextSibling;if(i.removeChild(d),I&&I.nodeType===8)if(d=I.data,d==="/$"){if(v===0){i.removeChild(I),Us(a);return}v--}else d!=="$"&&d!=="$?"&&d!=="$!"||v++;d=I}while(d);Us(a)}function ss(i){for(;i!=null;i=i.nextSibling){var a=i.nodeType;if(a===1||a===3)break;if(a===8){if(a=i.data,a==="$"||a==="$!"||a==="$?")break;if(a==="/$")return null}}return i}function hu(i){i=i.previousSibling;for(var a=0;i;){if(i.nodeType===8){var d=i.data;if(d==="$"||d==="$!"||d==="$?"){if(a===0)return i;a--}else d==="/$"&&a++}i=i.previousSibling}return null}var eo=Math.random().toString(36).slice(2),Gn="__reactFiber$"+eo,As="__reactProps$"+eo,as="__reactContainer$"+eo,sr="__reactEvents$"+eo,ec="__reactListeners$"+eo,od="__reactHandles$"+eo;function Qs(i){var a=i[Gn];if(a)return a;for(var d=i.parentNode;d;){if(a=d[as]||d[Gn]){if(d=a.alternate,a.child!==null||d!==null&&d.child!==null)for(i=hu(i);i!==null;){if(d=i[Gn])return d;i=hu(i)}return a}i=d,d=i.parentNode}return null}function vl(i){return i=i[Gn]||i[as],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function os(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(b(33))}function xl(i){return i[As]||null}var wl=[],to=-1;function Ia(i){return{current:i}}function Or(i){0>to||(i.current=wl[to],wl[to]=null,to--)}function Vr(i,a){to++,wl[to]=i.current,i.current=a}var Ea={},Ar=Ia(Ea),lr=Ia(!1),Fi=Ea;function ea(i,a){var d=i.type.contextTypes;if(!d)return Ea;var v=i.stateNode;if(v&&v.__reactInternalMemoizedUnmaskedChildContext===a)return v.__reactInternalMemoizedMaskedChildContext;var I={},M;for(M in d)I[M]=a[M];return v&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=a,i.__reactInternalMemoizedMaskedChildContext=I),I}function Cn(i){return i=i.childContextTypes,i!=null}function bl(){Or(lr),Or(Ar)}function Ao(i,a,d){if(Ar.current!==Ea)throw Error(b(168));Vr(Ar,a),Vr(lr,d)}function zo(i,a,d){var v=i.stateNode;if(a=a.childContextTypes,typeof v.getChildContext!="function")return d;v=v.getChildContext();for(var I in v)if(!(I in a))throw Error(b(108,ur(i)||"Unknown",I));return ft({},d,v)}function wi(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||Ea,Fi=Ar.current,Vr(Ar,i),Vr(lr,lr.current),!0}function Do(i,a,d){var v=i.stateNode;if(!v)throw Error(b(169));d?(i=zo(i,a,Fi),v.__reactInternalMemoizedMergedChildContext=i,Or(lr),Or(Ar),Vr(Ar,i)):Or(lr),Vr(lr,d)}var gt=null,At=!1,Lo=!1;function Sl(i){gt===null?gt=[i]:gt.push(i)}function tc(i){At=!0,Sl(i)}function f(){if(!Lo&&gt!==null){Lo=!0;var i=0,a=Sr;try{var d=gt;for(Sr=1;i<d.length;i++){var v=d[i];do v=v(!0);while(v!==null)}gt=null,At=!1}catch(I){throw gt!==null&&(gt=gt.slice(i+1)),yn(tl,f),I}finally{Sr=a,Lo=!1}}return null}var e=[],s=0,l=null,u=0,p=[],w=0,k=null,E=1,A="";function R(i,a){e[s++]=u,e[s++]=l,l=i,u=a}function B(i,a,d){p[w++]=E,p[w++]=A,p[w++]=k,k=i;var v=E;i=A;var I=32-Er(v)-1;v&=~(1<<I),d+=1;var M=32-Er(a)+I;if(30<M){var $=I-I%5;M=(v&(1<<$)-1).toString(32),v>>=$,I-=$,E=1<<32-Er(a)+I|d<<I|v,A=M+i}else E=1<<M|d<<I|v,A=i}function U(i){i.return!==null&&(R(i,1),B(i,1,0))}function G(i){for(;i===l;)l=e[--s],e[s]=null,u=e[--s],e[s]=null;for(;i===k;)k=p[--w],p[w]=null,A=p[--w],p[w]=null,E=p[--w],p[w]=null}var X=null,J=null,te=!1,se=null;function ce(i,a){var d=qi(5,null,null,0);d.elementType="DELETED",d.stateNode=a,d.return=i,a=i.deletions,a===null?(i.deletions=[d],i.flags|=16):a.push(d)}function Q(i,a){switch(i.tag){case 5:var d=i.type;return a=a.nodeType!==1||d.toLowerCase()!==a.nodeName.toLowerCase()?null:a,a!==null?(i.stateNode=a,X=i,J=ss(a.firstChild),!0):!1;case 6:return a=i.pendingProps===""||a.nodeType!==3?null:a,a!==null?(i.stateNode=a,X=i,J=null,!0):!1;case 13:return a=a.nodeType!==8?null:a,a!==null?(d=k!==null?{id:E,overflow:A}:null,i.memoizedState={dehydrated:a,treeContext:d,retryLane:1073741824},d=qi(18,null,null,0),d.stateNode=a,d.return=i,i.child=d,X=i,J=null,!0):!1;default:return!1}}function fe(i){return(i.mode&1)!==0&&(i.flags&128)===0}function ye(i){if(te){var a=J;if(a){var d=a;if(!Q(i,a)){if(fe(i))throw Error(b(418));a=ss(d.nextSibling);var v=X;a&&Q(i,a)?ce(v,d):(i.flags=i.flags&-4097|2,te=!1,X=i)}}else{if(fe(i))throw Error(b(418));i.flags=i.flags&-4097|2,te=!1,X=i}}}function be(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;X=i}function Fe(i){if(i!==X)return!1;if(!te)return be(i),te=!0,!1;var a;if((a=i.tag!==3)&&!(a=i.tag!==5)&&(a=i.type,a=a!=="head"&&a!=="body"&&!Qu(i.type,i.memoizedProps)),a&&(a=J)){if(fe(i))throw Ge(),Error(b(418));for(;a;)ce(i,a),a=ss(a.nextSibling)}if(be(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(b(317));e:{for(i=i.nextSibling,a=0;i;){if(i.nodeType===8){var d=i.data;if(d==="/$"){if(a===0){J=ss(i.nextSibling);break e}a--}else d!=="$"&&d!=="$!"&&d!=="$?"||a++}i=i.nextSibling}J=null}}else J=X?ss(i.stateNode.nextSibling):null;return!0}function Ge(){for(var i=J;i;)i=ss(i.nextSibling)}function Qe(){J=X=null,te=!1}function ut(i){se===null?se=[i]:se.push(i)}var tt=et.ReactCurrentBatchConfig;function Xe(i,a,d){if(i=d.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(d._owner){if(d=d._owner,d){if(d.tag!==1)throw Error(b(309));var v=d.stateNode}if(!v)throw Error(b(147,i));var I=v,M=""+i;return a!==null&&a.ref!==null&&typeof a.ref=="function"&&a.ref._stringRef===M?a.ref:(a=function($){var ae=I.refs;$===null?delete ae[M]:ae[M]=$},a._stringRef=M,a)}if(typeof i!="string")throw Error(b(284));if(!d._owner)throw Error(b(290,i))}return i}function _t(i,a){throw i=Object.prototype.toString.call(a),Error(b(31,i==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":i))}function Ft(i){var a=i._init;return a(i._payload)}function nt(i){function a(Se,ge){if(i){var Te=Se.deletions;Te===null?(Se.deletions=[ge],Se.flags|=16):Te.push(ge)}}function d(Se,ge){if(!i)return null;for(;ge!==null;)a(Se,ge),ge=ge.sibling;return null}function v(Se,ge){for(Se=new Map;ge!==null;)ge.key!==null?Se.set(ge.key,ge):Se.set(ge.index,ge),ge=ge.sibling;return Se}function I(Se,ge){return Se=Go(Se,ge),Se.index=0,Se.sibling=null,Se}function M(Se,ge,Te){return Se.index=Te,i?(Te=Se.alternate,Te!==null?(Te=Te.index,Te<ge?(Se.flags|=2,ge):Te):(Se.flags|=2,ge)):(Se.flags|=1048576,ge)}function $(Se){return i&&Se.alternate===null&&(Se.flags|=2),Se}function ae(Se,ge,Te,it){return ge===null||ge.tag!==6?(ge=Rs(Te,Se.mode,it),ge.return=Se,ge):(ge=I(ge,Te),ge.return=Se,ge)}function pe(Se,ge,Te,it){var zt=Te.type;return zt===je?Ze(Se,ge,Te.props.children,it,Te.key):ge!==null&&(ge.elementType===zt||typeof zt=="object"&&zt!==null&&zt.$$typeof===Pr&&Ft(zt)===ge.type)?(it=I(ge,Te.props),it.ref=Xe(Se,ge,Te),it.return=Se,it):(it=Cc(Te.type,Te.key,Te.props,null,Se.mode,it),it.ref=Xe(Se,ge,Te),it.return=Se,it)}function Ce(Se,ge,Te,it){return ge===null||ge.tag!==4||ge.stateNode.containerInfo!==Te.containerInfo||ge.stateNode.implementation!==Te.implementation?(ge=za(Te,Se.mode,it),ge.return=Se,ge):(ge=I(ge,Te.children||[]),ge.return=Se,ge)}function Ze(Se,ge,Te,it,zt){return ge===null||ge.tag!==7?(ge=Ho(Te,Se.mode,it,zt),ge.return=Se,ge):(ge=I(ge,Te),ge.return=Se,ge)}function We(Se,ge,Te){if(typeof ge=="string"&&ge!==""||typeof ge=="number")return ge=Rs(""+ge,Se.mode,Te),ge.return=Se,ge;if(typeof ge=="object"&&ge!==null){switch(ge.$$typeof){case Je:return Te=Cc(ge.type,ge.key,ge.props,null,Se.mode,Te),Te.ref=Xe(Se,null,ge),Te.return=Se,Te;case He:return ge=za(ge,Se.mode,Te),ge.return=Se,ge;case Pr:var it=ge._init;return We(Se,it(ge._payload),Te)}if(Rr(ge)||Pt(ge))return ge=Ho(ge,Se.mode,Te,null),ge.return=Se,ge;_t(Se,ge)}return null}function qe(Se,ge,Te,it){var zt=ge!==null?ge.key:null;if(typeof Te=="string"&&Te!==""||typeof Te=="number")return zt!==null?null:ae(Se,ge,""+Te,it);if(typeof Te=="object"&&Te!==null){switch(Te.$$typeof){case Je:return Te.key===zt?pe(Se,ge,Te,it):null;case He:return Te.key===zt?Ce(Se,ge,Te,it):null;case Pr:return zt=Te._init,qe(Se,ge,zt(Te._payload),it)}if(Rr(Te)||Pt(Te))return zt!==null?null:Ze(Se,ge,Te,it,null);_t(Se,Te)}return null}function ct(Se,ge,Te,it,zt){if(typeof it=="string"&&it!==""||typeof it=="number")return Se=Se.get(Te)||null,ae(ge,Se,""+it,zt);if(typeof it=="object"&&it!==null){switch(it.$$typeof){case Je:return Se=Se.get(it.key===null?Te:it.key)||null,pe(ge,Se,it,zt);case He:return Se=Se.get(it.key===null?Te:it.key)||null,Ce(ge,Se,it,zt);case Pr:var Ot=it._init;return ct(Se,ge,Te,Ot(it._payload),zt)}if(Rr(it)||Pt(it))return Se=Se.get(Te)||null,Ze(ge,Se,it,zt,null);_t(ge,it)}return null}function bt(Se,ge,Te,it){for(var zt=null,Ot=null,Dt=ge,Kt=ge=0,Dn=null;Dt!==null&&Kt<Te.length;Kt++){Dt.index>Kt?(Dn=Dt,Dt=null):Dn=Dt.sibling;var Tr=qe(Se,Dt,Te[Kt],it);if(Tr===null){Dt===null&&(Dt=Dn);break}i&&Dt&&Tr.alternate===null&&a(Se,Dt),ge=M(Tr,ge,Kt),Ot===null?zt=Tr:Ot.sibling=Tr,Ot=Tr,Dt=Dn}if(Kt===Te.length)return d(Se,Dt),te&&R(Se,Kt),zt;if(Dt===null){for(;Kt<Te.length;Kt++)Dt=We(Se,Te[Kt],it),Dt!==null&&(ge=M(Dt,ge,Kt),Ot===null?zt=Dt:Ot.sibling=Dt,Ot=Dt);return te&&R(Se,Kt),zt}for(Dt=v(Se,Dt);Kt<Te.length;Kt++)Dn=ct(Dt,Se,Kt,Te[Kt],it),Dn!==null&&(i&&Dn.alternate!==null&&Dt.delete(Dn.key===null?Kt:Dn.key),ge=M(Dn,ge,Kt),Ot===null?zt=Dn:Ot.sibling=Dn,Ot=Dn);return i&&Dt.forEach(function(so){return a(Se,so)}),te&&R(Se,Kt),zt}function Mt(Se,ge,Te,it){var zt=Pt(Te);if(typeof zt!="function")throw Error(b(150));if(Te=zt.call(Te),Te==null)throw Error(b(151));for(var Ot=zt=null,Dt=ge,Kt=ge=0,Dn=null,Tr=Te.next();Dt!==null&&!Tr.done;Kt++,Tr=Te.next()){Dt.index>Kt?(Dn=Dt,Dt=null):Dn=Dt.sibling;var so=qe(Se,Dt,Tr.value,it);if(so===null){Dt===null&&(Dt=Dn);break}i&&Dt&&so.alternate===null&&a(Se,Dt),ge=M(so,ge,Kt),Ot===null?zt=so:Ot.sibling=so,Ot=so,Dt=Dn}if(Tr.done)return d(Se,Dt),te&&R(Se,Kt),zt;if(Dt===null){for(;!Tr.done;Kt++,Tr=Te.next())Tr=We(Se,Tr.value,it),Tr!==null&&(ge=M(Tr,ge,Kt),Ot===null?zt=Tr:Ot.sibling=Tr,Ot=Tr);return te&&R(Se,Kt),zt}for(Dt=v(Se,Dt);!Tr.done;Kt++,Tr=Te.next())Tr=ct(Dt,Se,Kt,Tr.value,it),Tr!==null&&(i&&Tr.alternate!==null&&Dt.delete(Tr.key===null?Kt:Tr.key),ge=M(Tr,ge,Kt),Ot===null?zt=Tr:Ot.sibling=Tr,Ot=Tr);return i&&Dt.forEach(function(Nf){return a(Se,Nf)}),te&&R(Se,Kt),zt}function dn(Se,ge,Te,it){if(typeof Te=="object"&&Te!==null&&Te.type===je&&Te.key===null&&(Te=Te.props.children),typeof Te=="object"&&Te!==null){switch(Te.$$typeof){case Je:e:{for(var zt=Te.key,Ot=ge;Ot!==null;){if(Ot.key===zt){if(zt=Te.type,zt===je){if(Ot.tag===7){d(Se,Ot.sibling),ge=I(Ot,Te.props.children),ge.return=Se,Se=ge;break e}}else if(Ot.elementType===zt||typeof zt=="object"&&zt!==null&&zt.$$typeof===Pr&&Ft(zt)===Ot.type){d(Se,Ot.sibling),ge=I(Ot,Te.props),ge.ref=Xe(Se,Ot,Te),ge.return=Se,Se=ge;break e}d(Se,Ot);break}else a(Se,Ot);Ot=Ot.sibling}Te.type===je?(ge=Ho(Te.props.children,Se.mode,it,Te.key),ge.return=Se,Se=ge):(it=Cc(Te.type,Te.key,Te.props,null,Se.mode,it),it.ref=Xe(Se,ge,Te),it.return=Se,Se=it)}return $(Se);case He:e:{for(Ot=Te.key;ge!==null;){if(ge.key===Ot)if(ge.tag===4&&ge.stateNode.containerInfo===Te.containerInfo&&ge.stateNode.implementation===Te.implementation){d(Se,ge.sibling),ge=I(ge,Te.children||[]),ge.return=Se,Se=ge;break e}else{d(Se,ge);break}else a(Se,ge);ge=ge.sibling}ge=za(Te,Se.mode,it),ge.return=Se,Se=ge}return $(Se);case Pr:return Ot=Te._init,dn(Se,ge,Ot(Te._payload),it)}if(Rr(Te))return bt(Se,ge,Te,it);if(Pt(Te))return Mt(Se,ge,Te,it);_t(Se,Te)}return typeof Te=="string"&&Te!==""||typeof Te=="number"?(Te=""+Te,ge!==null&&ge.tag===6?(d(Se,ge.sibling),ge=I(ge,Te),ge.return=Se,Se=ge):(d(Se,ge),ge=Rs(Te,Se.mode,it),ge.return=Se,Se=ge),$(Se)):d(Se,ge)}return dn}var st=nt(!0),Bt=nt(!1),Cr=Ia(null),Ht=null,Qt=null,zr=null;function Tn(){zr=Qt=Ht=null}function bi(i){var a=Cr.current;Or(Cr),i._currentValue=a}function Dr(i,a,d){for(;i!==null;){var v=i.alternate;if((i.childLanes&a)!==a?(i.childLanes|=a,v!==null&&(v.childLanes|=a)):v!==null&&(v.childLanes&a)!==a&&(v.childLanes|=a),i===d)break;i=i.return}}function _n(i,a){Ht=i,zr=Qt=null,i=i.dependencies,i!==null&&i.firstContext!==null&&((i.lanes&a)!==0&&(Ii=!0),i.firstContext=null)}function Ur(i){var a=i._currentValue;if(zr!==i)if(i={context:i,memoizedValue:a,next:null},Qt===null){if(Ht===null)throw Error(b(308));Qt=i,Ht.dependencies={lanes:0,firstContext:i}}else Qt=Qt.next=i;return a}var rn=null;function Mn(i){rn===null?rn=[i]:rn.push(i)}function ls(i,a,d,v){var I=a.interleaved;return I===null?(d.next=d,Mn(a)):(d.next=I.next,I.next=d),a.interleaved=d,ai(i,v)}function ai(i,a){i.lanes|=a;var d=i.alternate;for(d!==null&&(d.lanes|=a),d=i,i=i.return;i!==null;)i.childLanes|=a,d=i.alternate,d!==null&&(d.childLanes|=a),d=i,i=i.return;return d.tag===3?d.stateNode:null}var us=!1;function Pa(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Si(i,a){i=i.updateQueue,a.updateQueue===i&&(a.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function Oi(i,a){return{eventTime:i,lane:a,tag:0,payload:null,callback:null,next:null}}function zs(i,a,d){var v=i.updateQueue;if(v===null)return null;if(v=v.shared,(vr&2)!==0){var I=v.pending;return I===null?a.next=a:(a.next=I.next,I.next=a),v.pending=a,ai(i,d)}return I=v.interleaved,I===null?(a.next=a,Mn(v)):(a.next=I.next,I.next=a),v.interleaved=a,ai(i,d)}function Hn(i,a,d){if(a=a.updateQueue,a!==null&&(a=a.shared,(d&4194240)!==0)){var v=a.lanes;v&=i.pendingLanes,d|=v,a.lanes=d,ma(i,d)}}function ki(i,a){var d=i.updateQueue,v=i.alternate;if(v!==null&&(v=v.updateQueue,d===v)){var I=null,M=null;if(d=d.firstBaseUpdate,d!==null){do{var $={eventTime:d.eventTime,lane:d.lane,tag:d.tag,payload:d.payload,callback:d.callback,next:null};M===null?I=M=$:M=M.next=$,d=d.next}while(d!==null);M===null?I=M=a:M=M.next=a}else I=M=a;d={baseState:v.baseState,firstBaseUpdate:I,lastBaseUpdate:M,shared:v.shared,effects:v.effects},i.updateQueue=d;return}i=d.lastBaseUpdate,i===null?d.firstBaseUpdate=a:i.next=a,d.lastBaseUpdate=a}function cs(i,a,d,v){var I=i.updateQueue;us=!1;var M=I.firstBaseUpdate,$=I.lastBaseUpdate,ae=I.shared.pending;if(ae!==null){I.shared.pending=null;var pe=ae,Ce=pe.next;pe.next=null,$===null?M=Ce:$.next=Ce,$=pe;var Ze=i.alternate;Ze!==null&&(Ze=Ze.updateQueue,ae=Ze.lastBaseUpdate,ae!==$&&(ae===null?Ze.firstBaseUpdate=Ce:ae.next=Ce,Ze.lastBaseUpdate=pe))}if(M!==null){var We=I.baseState;$=0,Ze=Ce=pe=null,ae=M;do{var qe=ae.lane,ct=ae.eventTime;if((v&qe)===qe){Ze!==null&&(Ze=Ze.next={eventTime:ct,lane:0,tag:ae.tag,payload:ae.payload,callback:ae.callback,next:null});e:{var bt=i,Mt=ae;switch(qe=a,ct=d,Mt.tag){case 1:if(bt=Mt.payload,typeof bt=="function"){We=bt.call(ct,We,qe);break e}We=bt;break e;case 3:bt.flags=bt.flags&-65537|128;case 0:if(bt=Mt.payload,qe=typeof bt=="function"?bt.call(ct,We,qe):bt,qe==null)break e;We=ft({},We,qe);break e;case 2:us=!0}}ae.callback!==null&&ae.lane!==0&&(i.flags|=64,qe=I.effects,qe===null?I.effects=[ae]:qe.push(ae))}else ct={eventTime:ct,lane:qe,tag:ae.tag,payload:ae.payload,callback:ae.callback,next:null},Ze===null?(Ce=Ze=ct,pe=We):Ze=Ze.next=ct,$|=qe;if(ae=ae.next,ae===null){if(ae=I.shared.pending,ae===null)break;qe=ae,ae=qe.next,qe.next=null,I.lastBaseUpdate=qe,I.shared.pending=null}}while(!0);if(Ze===null&&(pe=We),I.baseState=pe,I.firstBaseUpdate=Ce,I.lastBaseUpdate=Ze,a=I.shared.interleaved,a!==null){I=a;do $|=I.lane,I=I.next;while(I!==a)}else M===null&&(I.shared.lanes=0);Cl|=$,i.lanes=$,i.memoizedState=We}}function Ni(i,a,d){if(i=a.effects,a.effects=null,i!==null)for(a=0;a<i.length;a++){var v=i[a],I=v.callback;if(I!==null){if(v.callback=null,v=d,typeof I!="function")throw Error(b(191,I));I.call(v)}}}var ln={},qr=Ia(ln),An=Ia(ln),rr=Ia(ln);function Ti(i){if(i===ln)throw Error(b(174));return i}function Ca(i,a){switch(Vr(rr,a),Vr(An,i),Vr(qr,ln),i=a.nodeType,i){case 9:case 11:a=(a=a.documentElement)?a.namespaceURI:Fa(null,"");break;default:i=i===8?a.parentNode:a,a=i.namespaceURI||null,i=i.tagName,a=Fa(a,i)}Or(qr),Vr(qr,a)}function hs(){Or(qr),Or(An),Or(rr)}function rc(i){Ti(rr.current);var a=Ti(qr.current),d=Fa(a,i.type);a!==d&&(Vr(An,i),Vr(qr,d))}function nc(i){An.current===i&&(Or(qr),Or(An))}var Hr=Ia(0);function ds(i){for(var a=i;a!==null;){if(a.tag===13){var d=a.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||d.data==="$?"||d.data==="$!"))return a}else if(a.tag===19&&a.memoizedProps.revealOrder!==void 0){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===i)break;for(;a.sibling===null;){if(a.return===null||a.return===i)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var du=[];function Ro(){for(var i=0;i<du.length;i++)du[i]._workInProgressVersionPrimary=null;du.length=0}var Ma=et.ReactCurrentDispatcher,Bo=et.ReactCurrentBatchConfig,Ds=0,Lr=null,Jr=null,vn=null,ic=!1,pu=!1,sc=0,ld=0;function In(){throw Error(b(321))}function Fo(i,a){if(a===null)return!1;for(var d=0;d<a.length&&d<i.length;d++)if(!ni(i[d],a[d]))return!1;return!0}function ta(i,a,d,v,I,M){if(Ds=M,Lr=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,Ma.current=i===null||i.memoizedState===null?dh:Ef,i=d(v,I),pu){M=0;do{if(pu=!1,sc=0,25<=M)throw Error(b(301));M+=1,vn=Jr=null,a.updateQueue=null,Ma.current=cp,i=d(v,I)}while(pu)}if(Ma.current=hh,a=Jr!==null&&Jr.next!==null,Ds=0,vn=Jr=Lr=null,ic=!1,a)throw Error(b(300));return i}function ps(){var i=sc!==0;return sc=0,i}function Kn(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return vn===null?Lr.memoizedState=vn=i:vn=vn.next=i,vn}function fs(){if(Jr===null){var i=Lr.alternate;i=i!==null?i.memoizedState:null}else i=Jr.next;var a=vn===null?Lr.memoizedState:vn.next;if(a!==null)vn=a,Jr=i;else{if(i===null)throw Error(b(310));Jr=i,i={memoizedState:Jr.memoizedState,baseState:Jr.baseState,baseQueue:Jr.baseQueue,queue:Jr.queue,next:null},vn===null?Lr.memoizedState=vn=i:vn=vn.next=i}return vn}function ra(i,a){return typeof a=="function"?a(i):a}function ud(i){var a=fs(),d=a.queue;if(d===null)throw Error(b(311));d.lastRenderedReducer=i;var v=Jr,I=v.baseQueue,M=d.pending;if(M!==null){if(I!==null){var $=I.next;I.next=M.next,M.next=$}v.baseQueue=I=M,d.pending=null}if(I!==null){M=I.next,v=v.baseState;var ae=$=null,pe=null,Ce=M;do{var Ze=Ce.lane;if((Ds&Ze)===Ze)pe!==null&&(pe=pe.next={lane:0,action:Ce.action,hasEagerState:Ce.hasEagerState,eagerState:Ce.eagerState,next:null}),v=Ce.hasEagerState?Ce.eagerState:i(v,Ce.action);else{var We={lane:Ze,action:Ce.action,hasEagerState:Ce.hasEagerState,eagerState:Ce.eagerState,next:null};pe===null?(ae=pe=We,$=v):pe=pe.next=We,Lr.lanes|=Ze,Cl|=Ze}Ce=Ce.next}while(Ce!==null&&Ce!==M);pe===null?$=v:pe.next=ae,ni(v,a.memoizedState)||(Ii=!0),a.memoizedState=v,a.baseState=$,a.baseQueue=pe,d.lastRenderedState=v}if(i=d.interleaved,i!==null){I=i;do M=I.lane,Lr.lanes|=M,Cl|=M,I=I.next;while(I!==i)}else I===null&&(d.lanes=0);return[a.memoizedState,d.dispatch]}function ah(i){var a=fs(),d=a.queue;if(d===null)throw Error(b(311));d.lastRenderedReducer=i;var v=d.dispatch,I=d.pending,M=a.memoizedState;if(I!==null){d.pending=null;var $=I=I.next;do M=i(M,$.action),$=$.next;while($!==I);ni(M,a.memoizedState)||(Ii=!0),a.memoizedState=M,a.baseQueue===null&&(a.baseState=M),d.lastRenderedState=M}return[M,v]}function un(){}function oh(i,a){var d=Lr,v=fs(),I=a(),M=!ni(v.memoizedState,I);if(M&&(v.memoizedState=I,Ii=!0),v=v.queue,lc(No.bind(null,d,v,i),[i]),v.getSnapshot!==a||M||vn!==null&&vn.memoizedState.tag&1){if(d.flags|=2048,oc(9,Oo.bind(null,d,v,I,a),void 0,null),zn===null)throw Error(b(349));(Ds&30)!==0||cd(d,a,I)}return I}function cd(i,a,d){i.flags|=16384,i={getSnapshot:a,value:d},a=Lr.updateQueue,a===null?(a={lastEffect:null,stores:null},Lr.updateQueue=a,a.stores=[i]):(d=a.stores,d===null?a.stores=[i]:d.push(i))}function Oo(i,a,d,v){a.value=d,a.getSnapshot=v,ac(a)&&lh(i)}function No(i,a,d){return d(function(){ac(a)&&lh(i)})}function ac(i){var a=i.getSnapshot;i=i.value;try{var d=a();return!ni(i,d)}catch{return!0}}function lh(i){var a=ai(i,1);a!==null&&ia(a,i,1,-1)}function hd(i){var a=Kn();return typeof i=="function"&&(i=i()),a.memoizedState=a.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ra,lastRenderedState:i},a.queue=i,i=i.dispatch=mu.bind(null,Lr,i),[a.memoizedState,i]}function oc(i,a,d,v){return i={tag:i,create:a,destroy:d,deps:v,next:null},a=Lr.updateQueue,a===null?(a={lastEffect:null,stores:null},Lr.updateQueue=a,a.lastEffect=i.next=i):(d=a.lastEffect,d===null?a.lastEffect=i.next=i:(v=d.next,d.next=i,i.next=v,a.lastEffect=i)),i}function dd(){return fs().memoizedState}function uh(i,a,d,v){var I=Kn();Lr.flags|=i,I.memoizedState=oc(1|a,d,void 0,v===void 0?null:v)}function fu(i,a,d,v){var I=fs();v=v===void 0?null:v;var M=void 0;if(Jr!==null){var $=Jr.memoizedState;if(M=$.destroy,v!==null&&Fo(v,$.deps)){I.memoizedState=oc(a,d,M,v);return}}Lr.flags|=i,I.memoizedState=oc(1|a,d,M,v)}function ap(i,a){return uh(8390656,8,i,a)}function lc(i,a){return fu(2048,8,i,a)}function pd(i,a){return fu(4,2,i,a)}function fd(i,a){return fu(4,4,i,a)}function kl(i,a){if(typeof a=="function")return i=i(),a(i),function(){a(null)};if(a!=null)return i=i(),a.current=i,function(){a.current=null}}function op(i,a,d){return d=d!=null?d.concat([i]):null,fu(4,4,kl.bind(null,a,i),d)}function Tl(){}function uc(i,a){var d=fs();a=a===void 0?null:a;var v=d.memoizedState;return v!==null&&a!==null&&Fo(a,v[1])?v[0]:(d.memoizedState=[i,a],i)}function cc(i,a){var d=fs();a=a===void 0?null:a;var v=d.memoizedState;return v!==null&&a!==null&&Fo(a,v[1])?v[0]:(i=i(),d.memoizedState=[i,a],i)}function md(i,a,d){return(Ds&21)===0?(i.baseState&&(i.baseState=!1,Ii=!0),i.memoizedState=d):(ni(d,a)||(d=Vs(),Lr.lanes|=d,Cl|=d,i.baseState=!0),a)}function lp(i,a){var d=Sr;Sr=d!==0&&4>d?d:4,i(!0);var v=Bo.transition;Bo.transition={};try{i(!1),a()}finally{Sr=d,Bo.transition=v}}function up(){return fs().memoizedState}function oi(i,a,d){var v=Zo(i);if(d={lane:v,action:d,hasEagerState:!1,eagerState:null,next:null},ch(i))gd(a,d);else if(d=ls(i,a,d,v),d!==null){var I=Ei();ia(d,i,v,I),gu(d,a,v)}}function mu(i,a,d){var v=Zo(i),I={lane:v,action:d,hasEagerState:!1,eagerState:null,next:null};if(ch(i))gd(a,I);else{var M=i.alternate;if(i.lanes===0&&(M===null||M.lanes===0)&&(M=a.lastRenderedReducer,M!==null))try{var $=a.lastRenderedState,ae=M($,d);if(I.hasEagerState=!0,I.eagerState=ae,ni(ae,$)){var pe=a.interleaved;pe===null?(I.next=I,Mn(a)):(I.next=pe.next,pe.next=I),a.interleaved=I;return}}catch{}finally{}d=ls(i,a,I,v),d!==null&&(I=Ei(),ia(d,i,v,I),gu(d,a,v))}}function ch(i){var a=i.alternate;return i===Lr||a!==null&&a===Lr}function gd(i,a){pu=ic=!0;var d=i.pending;d===null?a.next=a:(a.next=d.next,d.next=a),i.pending=a}function gu(i,a,d){if((d&4194240)!==0){var v=a.lanes;v&=i.pendingLanes,d|=v,a.lanes=d,ma(i,d)}}var hh={readContext:Ur,useCallback:In,useContext:In,useEffect:In,useImperativeHandle:In,useInsertionEffect:In,useLayoutEffect:In,useMemo:In,useReducer:In,useRef:In,useState:In,useDebugValue:In,useDeferredValue:In,useTransition:In,useMutableSource:In,useSyncExternalStore:In,useId:In,unstable_isNewReconciler:!1},dh={readContext:Ur,useCallback:function(i,a){return Kn().memoizedState=[i,a===void 0?null:a],i},useContext:Ur,useEffect:ap,useImperativeHandle:function(i,a,d){return d=d!=null?d.concat([i]):null,uh(4194308,4,kl.bind(null,a,i),d)},useLayoutEffect:function(i,a){return uh(4194308,4,i,a)},useInsertionEffect:function(i,a){return uh(4,2,i,a)},useMemo:function(i,a){var d=Kn();return a=a===void 0?null:a,i=i(),d.memoizedState=[i,a],i},useReducer:function(i,a,d){var v=Kn();return a=d!==void 0?d(a):a,v.memoizedState=v.baseState=a,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:a},v.queue=i,i=i.dispatch=oi.bind(null,Lr,i),[v.memoizedState,i]},useRef:function(i){var a=Kn();return i={current:i},a.memoizedState=i},useState:hd,useDebugValue:Tl,useDeferredValue:function(i){return Kn().memoizedState=i},useTransition:function(){var i=hd(!1),a=i[0];return i=lp.bind(null,i[1]),Kn().memoizedState=i,[a,i]},useMutableSource:function(){},useSyncExternalStore:function(i,a,d){var v=Lr,I=Kn();if(te){if(d===void 0)throw Error(b(407));d=d()}else{if(d=a(),zn===null)throw Error(b(349));(Ds&30)!==0||cd(v,a,d)}I.memoizedState=d;var M={value:d,getSnapshot:a};return I.queue=M,ap(No.bind(null,v,M,i),[i]),v.flags|=2048,oc(9,Oo.bind(null,v,M,d,a),void 0,null),d},useId:function(){var i=Kn(),a=zn.identifierPrefix;if(te){var d=A,v=E;d=(v&~(1<<32-Er(v)-1)).toString(32)+d,a=":"+a+"R"+d,d=sc++,0<d&&(a+="H"+d.toString(32)),a+=":"}else d=ld++,a=":"+a+"r"+d.toString(32)+":";return i.memoizedState=a},unstable_isNewReconciler:!1},Ef={readContext:Ur,useCallback:uc,useContext:Ur,useEffect:lc,useImperativeHandle:op,useInsertionEffect:pd,useLayoutEffect:fd,useMemo:cc,useReducer:ud,useRef:dd,useState:function(){return ud(ra)},useDebugValue:Tl,useDeferredValue:function(i){var a=fs();return md(a,Jr.memoizedState,i)},useTransition:function(){var i=ud(ra)[0],a=fs().memoizedState;return[i,a]},useMutableSource:un,useSyncExternalStore:oh,useId:up,unstable_isNewReconciler:!1},cp={readContext:Ur,useCallback:uc,useContext:Ur,useEffect:lc,useImperativeHandle:op,useInsertionEffect:pd,useLayoutEffect:fd,useMemo:cc,useReducer:ah,useRef:dd,useState:function(){return ah(ra)},useDebugValue:Tl,useDeferredValue:function(i){var a=fs();return Jr===null?a.memoizedState=i:md(a,Jr.memoizedState,i)},useTransition:function(){var i=ah(ra)[0],a=fs().memoizedState;return[i,a]},useMutableSource:un,useSyncExternalStore:oh,useId:up,unstable_isNewReconciler:!1};function Ls(i,a){if(i&&i.defaultProps){a=ft({},a),i=i.defaultProps;for(var d in i)a[d]===void 0&&(a[d]=i[d]);return a}return a}function ph(i,a,d,v){a=i.memoizedState,d=d(v,a),d=d==null?a:ft({},a,d),i.memoizedState=d,i.lanes===0&&(i.updateQueue.baseState=d)}var fh={isMounted:function(i){return(i=i._reactInternals)?Wt(i)===i:!1},enqueueSetState:function(i,a,d){i=i._reactInternals;var v=Ei(),I=Zo(i),M=Oi(v,I);M.payload=a,d!=null&&(M.callback=d),a=zs(i,M,I),a!==null&&(ia(a,i,I,v),Hn(a,i,I))},enqueueReplaceState:function(i,a,d){i=i._reactInternals;var v=Ei(),I=Zo(i),M=Oi(v,I);M.tag=1,M.payload=a,d!=null&&(M.callback=d),a=zs(i,M,I),a!==null&&(ia(a,i,I,v),Hn(a,i,I))},enqueueForceUpdate:function(i,a){i=i._reactInternals;var d=Ei(),v=Zo(i),I=Oi(d,v);I.tag=2,a!=null&&(I.callback=a),a=zs(i,I,v),a!==null&&(ia(a,i,v,d),Hn(a,i,v))}};function mh(i,a,d,v,I,M,$){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(v,M,$):a.prototype&&a.prototype.isPureReactComponent?!ba(d,v)||!ba(I,M):!0}function yd(i,a,d){var v=!1,I=Ea,M=a.contextType;return typeof M=="object"&&M!==null?M=Ur(M):(I=Cn(a)?Fi:Ar.current,v=a.contextTypes,M=(v=v!=null)?ea(i,I):Ea),a=new a(d,M),i.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,a.updater=fh,i.stateNode=a,a._reactInternals=i,v&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=I,i.__reactInternalMemoizedMaskedChildContext=M),a}function gh(i,a,d,v){i=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(d,v),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(d,v),a.state!==i&&fh.enqueueReplaceState(a,a.state,null)}function Il(i,a,d,v){var I=i.stateNode;I.props=d,I.state=i.memoizedState,I.refs={},Pa(i);var M=a.contextType;typeof M=="object"&&M!==null?I.context=Ur(M):(M=Cn(a)?Fi:Ar.current,I.context=ea(i,M)),I.state=i.memoizedState,M=a.getDerivedStateFromProps,typeof M=="function"&&(ph(i,a,M,d),I.state=i.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof I.getSnapshotBeforeUpdate=="function"||typeof I.UNSAFE_componentWillMount!="function"&&typeof I.componentWillMount!="function"||(a=I.state,typeof I.componentWillMount=="function"&&I.componentWillMount(),typeof I.UNSAFE_componentWillMount=="function"&&I.UNSAFE_componentWillMount(),a!==I.state&&fh.enqueueReplaceState(I,I.state,null),cs(i,d,I,v),I.state=i.memoizedState),typeof I.componentDidMount=="function"&&(i.flags|=4194308)}function Fn(i,a){try{var d="",v=a;do d+=nr(v),v=v.return;while(v);var I=d}catch(M){I=`
Error generating stack: `+M.message+`
`+M.stack}return{value:i,source:a,stack:I,digest:null}}function yh(i,a,d){return{value:i,source:null,stack:d??null,digest:a??null}}function hc(i,a){try{console.error(a.value)}catch(d){setTimeout(function(){throw d})}}var Pf=typeof WeakMap=="function"?WeakMap:Map;function _d(i,a,d){d=Oi(-1,d),d.tag=3,d.payload={element:null};var v=a.value;return d.callback=function(){wc||(wc=!0,Ph=v),hc(i,a)},d}function hp(i,a,d){d=Oi(-1,d),d.tag=3;var v=i.type.getDerivedStateFromError;if(typeof v=="function"){var I=a.value;d.payload=function(){return v(I)},d.callback=function(){hc(i,a)}}var M=i.stateNode;return M!==null&&typeof M.componentDidCatch=="function"&&(d.callback=function(){hc(i,a),typeof v!="function"&&(dr===null?dr=new Set([this]):dr.add(this));var $=a.stack;this.componentDidCatch(a.value,{componentStack:$!==null?$:""})}),d}function dp(i,a,d){var v=i.pingCache;if(v===null){v=i.pingCache=new Pf;var I=new Set;v.set(a,I)}else I=v.get(a),I===void 0&&(I=new Set,v.set(a,I));I.has(d)||(I.add(d),i=Lf.bind(null,i,a,d),a.then(i,i))}function pp(i){do{var a;if((a=i.tag===13)&&(a=i.memoizedState,a=a!==null?a.dehydrated!==null:!0),a)return i;i=i.return}while(i!==null);return null}function fp(i,a,d,v,I){return(i.mode&1)===0?(i===a?i.flags|=65536:(i.flags|=128,d.flags|=131072,d.flags&=-52805,d.tag===1&&(d.alternate===null?d.tag=17:(a=Oi(-1,1),a.tag=2,zs(d,a,1))),d.lanes|=1),i):(i.flags|=65536,i.lanes=I,i)}var mp=et.ReactCurrentOwner,Ii=!1;function xn(i,a,d,v){a.child=i===null?Bt(a,null,d,v):st(a,i.child,d,v)}function yu(i,a,d,v,I){d=d.render;var M=a.ref;return _n(a,I),v=ta(i,a,d,v,M,I),d=ps(),i!==null&&!Ii?(a.updateQueue=i.updateQueue,a.flags&=-2053,i.lanes&=~I,ms(i,a,I)):(te&&d&&U(a),a.flags|=1,xn(i,a,v,I),a.child)}function gp(i,a,d,v,I){if(i===null){var M=d.type;return typeof M=="function"&&!Pc(M)&&M.defaultProps===void 0&&d.compare===null&&d.defaultProps===void 0?(a.tag=15,a.type=M,yp(i,a,M,v,I)):(i=Cc(d.type,null,v,a,a.mode,I),i.ref=a.ref,i.return=a,a.child=i)}if(M=i.child,(i.lanes&I)===0){var $=M.memoizedProps;if(d=d.compare,d=d!==null?d:ba,d($,v)&&i.ref===a.ref)return ms(i,a,I)}return a.flags|=1,i=Go(M,v),i.ref=a.ref,i.return=a,a.child=i}function yp(i,a,d,v,I){if(i!==null){var M=i.memoizedProps;if(ba(M,v)&&i.ref===a.ref)if(Ii=!1,a.pendingProps=v=M,(i.lanes&I)!==0)(i.flags&131072)!==0&&(Ii=!0);else return a.lanes=i.lanes,ms(i,a,I)}return vd(i,a,d,v,I)}function _p(i,a,d){var v=a.pendingProps,I=v.children,M=i!==null?i.memoizedState:null;if(v.mode==="hidden")if((a.mode&1)===0)a.memoizedState={baseLanes:0,cachePool:null,transitions:null},Vr(xu,ci),ci|=d;else{if((d&1073741824)===0)return i=M!==null?M.baseLanes|d:d,a.lanes=a.childLanes=1073741824,a.memoizedState={baseLanes:i,cachePool:null,transitions:null},a.updateQueue=null,Vr(xu,ci),ci|=i,null;a.memoizedState={baseLanes:0,cachePool:null,transitions:null},v=M!==null?M.baseLanes:d,Vr(xu,ci),ci|=v}else M!==null?(v=M.baseLanes|d,a.memoizedState=null):v=d,Vr(xu,ci),ci|=v;return xn(i,a,I,d),a.child}function vp(i,a){var d=a.ref;(i===null&&d!==null||i!==null&&i.ref!==d)&&(a.flags|=512,a.flags|=2097152)}function vd(i,a,d,v,I){var M=Cn(d)?Fi:Ar.current;return M=ea(a,M),_n(a,I),d=ta(i,a,d,v,M,I),v=ps(),i!==null&&!Ii?(a.updateQueue=i.updateQueue,a.flags&=-2053,i.lanes&=~I,ms(i,a,I)):(te&&v&&U(a),a.flags|=1,xn(i,a,d,I),a.child)}function xp(i,a,d,v,I){if(Cn(d)){var M=!0;wi(a)}else M=!1;if(_n(a,I),a.stateNode===null)fc(i,a),yd(a,d,v),Il(a,d,v,I),v=!0;else if(i===null){var $=a.stateNode,ae=a.memoizedProps;$.props=ae;var pe=$.context,Ce=d.contextType;typeof Ce=="object"&&Ce!==null?Ce=Ur(Ce):(Ce=Cn(d)?Fi:Ar.current,Ce=ea(a,Ce));var Ze=d.getDerivedStateFromProps,We=typeof Ze=="function"||typeof $.getSnapshotBeforeUpdate=="function";We||typeof $.UNSAFE_componentWillReceiveProps!="function"&&typeof $.componentWillReceiveProps!="function"||(ae!==v||pe!==Ce)&&gh(a,$,v,Ce),us=!1;var qe=a.memoizedState;$.state=qe,cs(a,v,$,I),pe=a.memoizedState,ae!==v||qe!==pe||lr.current||us?(typeof Ze=="function"&&(ph(a,d,Ze,v),pe=a.memoizedState),(ae=us||mh(a,d,ae,v,qe,pe,Ce))?(We||typeof $.UNSAFE_componentWillMount!="function"&&typeof $.componentWillMount!="function"||(typeof $.componentWillMount=="function"&&$.componentWillMount(),typeof $.UNSAFE_componentWillMount=="function"&&$.UNSAFE_componentWillMount()),typeof $.componentDidMount=="function"&&(a.flags|=4194308)):(typeof $.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=v,a.memoizedState=pe),$.props=v,$.state=pe,$.context=Ce,v=ae):(typeof $.componentDidMount=="function"&&(a.flags|=4194308),v=!1)}else{$=a.stateNode,Si(i,a),ae=a.memoizedProps,Ce=a.type===a.elementType?ae:Ls(a.type,ae),$.props=Ce,We=a.pendingProps,qe=$.context,pe=d.contextType,typeof pe=="object"&&pe!==null?pe=Ur(pe):(pe=Cn(d)?Fi:Ar.current,pe=ea(a,pe));var ct=d.getDerivedStateFromProps;(Ze=typeof ct=="function"||typeof $.getSnapshotBeforeUpdate=="function")||typeof $.UNSAFE_componentWillReceiveProps!="function"&&typeof $.componentWillReceiveProps!="function"||(ae!==We||qe!==pe)&&gh(a,$,v,pe),us=!1,qe=a.memoizedState,$.state=qe,cs(a,v,$,I);var bt=a.memoizedState;ae!==We||qe!==bt||lr.current||us?(typeof ct=="function"&&(ph(a,d,ct,v),bt=a.memoizedState),(Ce=us||mh(a,d,Ce,v,qe,bt,pe)||!1)?(Ze||typeof $.UNSAFE_componentWillUpdate!="function"&&typeof $.componentWillUpdate!="function"||(typeof $.componentWillUpdate=="function"&&$.componentWillUpdate(v,bt,pe),typeof $.UNSAFE_componentWillUpdate=="function"&&$.UNSAFE_componentWillUpdate(v,bt,pe)),typeof $.componentDidUpdate=="function"&&(a.flags|=4),typeof $.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof $.componentDidUpdate!="function"||ae===i.memoizedProps&&qe===i.memoizedState||(a.flags|=4),typeof $.getSnapshotBeforeUpdate!="function"||ae===i.memoizedProps&&qe===i.memoizedState||(a.flags|=1024),a.memoizedProps=v,a.memoizedState=bt),$.props=v,$.state=bt,$.context=pe,v=Ce):(typeof $.componentDidUpdate!="function"||ae===i.memoizedProps&&qe===i.memoizedState||(a.flags|=4),typeof $.getSnapshotBeforeUpdate!="function"||ae===i.memoizedProps&&qe===i.memoizedState||(a.flags|=1024),v=!1)}return xd(i,a,d,v,M,I)}function xd(i,a,d,v,I,M){vp(i,a);var $=(a.flags&128)!==0;if(!v&&!$)return I&&Do(a,d,!1),ms(i,a,M);v=a.stateNode,mp.current=a;var ae=$&&typeof d.getDerivedStateFromError!="function"?null:v.render();return a.flags|=1,i!==null&&$?(a.child=st(a,i.child,null,M),a.child=st(a,null,ae,M)):xn(i,a,ae,M),a.memoizedState=v.state,I&&Do(a,d,!0),a.child}function _h(i){var a=i.stateNode;a.pendingContext?Ao(i,a.pendingContext,a.pendingContext!==a.context):a.context&&Ao(i,a.context,!1),Ca(i,a.containerInfo)}function wp(i,a,d,v,I){return Qe(),ut(I),a.flags|=256,xn(i,a,d,v),a.child}var jo={dehydrated:null,treeContext:null,retryLane:0};function wd(i){return{baseLanes:i,cachePool:null,transitions:null}}function nn(i,a,d){var v=a.pendingProps,I=Hr.current,M=!1,$=(a.flags&128)!==0,ae;if((ae=$)||(ae=i!==null&&i.memoizedState===null?!1:(I&2)!==0),ae?(M=!0,a.flags&=-129):(i===null||i.memoizedState!==null)&&(I|=1),Vr(Hr,I&1),i===null)return ye(a),i=a.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?((a.mode&1)===0?a.lanes=1:i.data==="$!"?a.lanes=8:a.lanes=1073741824,null):($=v.children,i=v.fallback,M?(v=a.mode,M=a.child,$={mode:"hidden",children:$},(v&1)===0&&M!==null?(M.childLanes=0,M.pendingProps=$):M=Ko($,v,0,null),i=Ho(i,v,d,null),M.return=a,i.return=a,M.sibling=i,a.child=M,a.child.memoizedState=wd(d),a.memoizedState=jo,i):_u(a,$));if(I=i.memoizedState,I!==null&&(ae=I.dehydrated,ae!==null))return vh(i,a,$,v,ae,I,d);if(M){M=v.fallback,$=a.mode,I=i.child,ae=I.sibling;var pe={mode:"hidden",children:v.children};return($&1)===0&&a.child!==I?(v=a.child,v.childLanes=0,v.pendingProps=pe,a.deletions=null):(v=Go(I,pe),v.subtreeFlags=I.subtreeFlags&14680064),ae!==null?M=Go(ae,M):(M=Ho(M,$,d,null),M.flags|=2),M.return=a,v.return=a,v.sibling=M,a.child=v,v=M,M=a.child,$=i.child.memoizedState,$=$===null?wd(d):{baseLanes:$.baseLanes|d,cachePool:null,transitions:$.transitions},M.memoizedState=$,M.childLanes=i.childLanes&~d,a.memoizedState=jo,v}return M=i.child,i=M.sibling,v=Go(M,{mode:"visible",children:v.children}),(a.mode&1)===0&&(v.lanes=d),v.return=a,v.sibling=null,i!==null&&(d=a.deletions,d===null?(a.deletions=[i],a.flags|=16):d.push(i)),a.child=v,a.memoizedState=null,v}function _u(i,a){return a=Ko({mode:"visible",children:a},i.mode,0,null),a.return=i,i.child=a}function dc(i,a,d,v){return v!==null&&ut(v),st(a,i.child,null,d),i=_u(a,a.pendingProps.children),i.flags|=2,a.memoizedState=null,i}function vh(i,a,d,v,I,M,$){if(d)return a.flags&256?(a.flags&=-257,v=yh(Error(b(422))),dc(i,a,$,v)):a.memoizedState!==null?(a.child=i.child,a.flags|=128,null):(M=v.fallback,I=a.mode,v=Ko({mode:"visible",children:v.children},I,0,null),M=Ho(M,I,$,null),M.flags|=2,v.return=a,M.return=a,v.sibling=M,a.child=v,(a.mode&1)!==0&&st(a,i.child,null,$),a.child.memoizedState=wd($),a.memoizedState=jo,M);if((a.mode&1)===0)return dc(i,a,$,null);if(I.data==="$!"){if(v=I.nextSibling&&I.nextSibling.dataset,v)var ae=v.dgst;return v=ae,M=Error(b(419)),v=yh(M,v,void 0),dc(i,a,$,v)}if(ae=($&i.childLanes)!==0,Ii||ae){if(v=zn,v!==null){switch($&-$){case 4:I=2;break;case 16:I=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:I=32;break;case 536870912:I=268435456;break;default:I=0}I=(I&(v.suspendedLanes|$))!==0?0:I,I!==0&&I!==M.retryLane&&(M.retryLane=I,ai(i,I),ia(v,i,I,-1))}return Ah(),v=yh(Error(b(421))),dc(i,a,$,v)}return I.data==="$?"?(a.flags|=128,a.child=i.child,a=Fp.bind(null,i),I._reactRetry=a,null):(i=M.treeContext,J=ss(I.nextSibling),X=a,te=!0,se=null,i!==null&&(p[w++]=E,p[w++]=A,p[w++]=k,E=i.id,A=i.overflow,k=a),a=_u(a,v.children),a.flags|=4096,a)}function pc(i,a,d){i.lanes|=a;var v=i.alternate;v!==null&&(v.lanes|=a),Dr(i.return,a,d)}function El(i,a,d,v,I){var M=i.memoizedState;M===null?i.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:v,tail:d,tailMode:I}:(M.isBackwards=a,M.rendering=null,M.renderingStartTime=0,M.last=v,M.tail=d,M.tailMode=I)}function bd(i,a,d){var v=a.pendingProps,I=v.revealOrder,M=v.tail;if(xn(i,a,v.children,d),v=Hr.current,(v&2)!==0)v=v&1|2,a.flags|=128;else{if(i!==null&&(i.flags&128)!==0)e:for(i=a.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&pc(i,d,a);else if(i.tag===19)pc(i,d,a);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===a)break e;for(;i.sibling===null;){if(i.return===null||i.return===a)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}v&=1}if(Vr(Hr,v),(a.mode&1)===0)a.memoizedState=null;else switch(I){case"forwards":for(d=a.child,I=null;d!==null;)i=d.alternate,i!==null&&ds(i)===null&&(I=d),d=d.sibling;d=I,d===null?(I=a.child,a.child=null):(I=d.sibling,d.sibling=null),El(a,!1,I,d,M);break;case"backwards":for(d=null,I=a.child,a.child=null;I!==null;){if(i=I.alternate,i!==null&&ds(i)===null){a.child=I;break}i=I.sibling,I.sibling=d,d=I,I=i}El(a,!0,d,null,M);break;case"together":El(a,!1,null,null,void 0);break;default:a.memoizedState=null}return a.child}function fc(i,a){(a.mode&1)===0&&i!==null&&(i.alternate=null,a.alternate=null,a.flags|=2)}function ms(i,a,d){if(i!==null&&(a.dependencies=i.dependencies),Cl|=a.lanes,(d&a.childLanes)===0)return null;if(i!==null&&a.child!==i.child)throw Error(b(153));if(a.child!==null){for(i=a.child,d=Go(i,i.pendingProps),a.child=d,d.return=a;i.sibling!==null;)i=i.sibling,d=d.sibling=Go(i,i.pendingProps),d.return=a;d.sibling=null}return a.child}function Sd(i,a,d){switch(a.tag){case 3:_h(a),Qe();break;case 5:rc(a);break;case 1:Cn(a.type)&&wi(a);break;case 4:Ca(a,a.stateNode.containerInfo);break;case 10:var v=a.type._context,I=a.memoizedProps.value;Vr(Cr,v._currentValue),v._currentValue=I;break;case 13:if(v=a.memoizedState,v!==null)return v.dehydrated!==null?(Vr(Hr,Hr.current&1),a.flags|=128,null):(d&a.child.childLanes)!==0?nn(i,a,d):(Vr(Hr,Hr.current&1),i=ms(i,a,d),i!==null?i.sibling:null);Vr(Hr,Hr.current&1);break;case 19:if(v=(d&a.childLanes)!==0,(i.flags&128)!==0){if(v)return bd(i,a,d);a.flags|=128}if(I=a.memoizedState,I!==null&&(I.rendering=null,I.tail=null,I.lastEffect=null),Vr(Hr,Hr.current),v)break;return null;case 22:case 23:return a.lanes=0,_p(i,a,d)}return ms(i,a,d)}var xh,mc,wh,kd;xh=function(i,a){for(var d=a.child;d!==null;){if(d.tag===5||d.tag===6)i.appendChild(d.stateNode);else if(d.tag!==4&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===a)break;for(;d.sibling===null;){if(d.return===null||d.return===a)return;d=d.return}d.sibling.return=d.return,d=d.sibling}},mc=function(){},wh=function(i,a,d,v){var I=i.memoizedProps;if(I!==v){i=a.stateNode,Ti(qr.current);var M=null;switch(d){case"input":I=bs(i,I),v=bs(i,v),M=[];break;case"select":I=ft({},I,{value:void 0}),v=ft({},v,{value:void 0}),M=[];break;case"textarea":I=ks(i,I),v=ks(i,v),M=[];break;default:typeof I.onClick!="function"&&typeof v.onClick=="function"&&(i.onclick=si)}Ln(d,v);var $;d=null;for(Ce in I)if(!v.hasOwnProperty(Ce)&&I.hasOwnProperty(Ce)&&I[Ce]!=null)if(Ce==="style"){var ae=I[Ce];for($ in ae)ae.hasOwnProperty($)&&(d||(d={}),d[$]="")}else Ce!=="dangerouslySetInnerHTML"&&Ce!=="children"&&Ce!=="suppressContentEditableWarning"&&Ce!=="suppressHydrationWarning"&&Ce!=="autoFocus"&&(D.hasOwnProperty(Ce)?M||(M=[]):(M=M||[]).push(Ce,null));for(Ce in v){var pe=v[Ce];if(ae=I!=null?I[Ce]:void 0,v.hasOwnProperty(Ce)&&pe!==ae&&(pe!=null||ae!=null))if(Ce==="style")if(ae){for($ in ae)!ae.hasOwnProperty($)||pe&&pe.hasOwnProperty($)||(d||(d={}),d[$]="");for($ in pe)pe.hasOwnProperty($)&&ae[$]!==pe[$]&&(d||(d={}),d[$]=pe[$])}else d||(M||(M=[]),M.push(Ce,d)),d=pe;else Ce==="dangerouslySetInnerHTML"?(pe=pe?pe.__html:void 0,ae=ae?ae.__html:void 0,pe!=null&&ae!==pe&&(M=M||[]).push(Ce,pe)):Ce==="children"?typeof pe!="string"&&typeof pe!="number"||(M=M||[]).push(Ce,""+pe):Ce!=="suppressContentEditableWarning"&&Ce!=="suppressHydrationWarning"&&(D.hasOwnProperty(Ce)?(pe!=null&&Ce==="onScroll"&&Fr("scroll",i),M||ae===pe||(M=[])):(M=M||[]).push(Ce,pe))}d&&(M=M||[]).push("style",d);var Ce=M;(a.updateQueue=Ce)&&(a.flags|=4)}},kd=function(i,a,d,v){d!==v&&(a.flags|=4)};function vu(i,a){if(!te)switch(i.tailMode){case"hidden":a=i.tail;for(var d=null;a!==null;)a.alternate!==null&&(d=a),a=a.sibling;d===null?i.tail=null:d.sibling=null;break;case"collapsed":d=i.tail;for(var v=null;d!==null;)d.alternate!==null&&(v=d),d=d.sibling;v===null?a||i.tail===null?i.tail=null:i.tail.sibling=null:v.sibling=null}}function li(i){var a=i.alternate!==null&&i.alternate.child===i.child,d=0,v=0;if(a)for(var I=i.child;I!==null;)d|=I.lanes|I.childLanes,v|=I.subtreeFlags&14680064,v|=I.flags&14680064,I.return=i,I=I.sibling;else for(I=i.child;I!==null;)d|=I.lanes|I.childLanes,v|=I.subtreeFlags,v|=I.flags,I.return=i,I=I.sibling;return i.subtreeFlags|=v,i.childLanes=d,a}function Cf(i,a,d){var v=a.pendingProps;switch(G(a),a.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return li(a),null;case 1:return Cn(a.type)&&bl(),li(a),null;case 3:return v=a.stateNode,hs(),Or(lr),Or(Ar),Ro(),v.pendingContext&&(v.context=v.pendingContext,v.pendingContext=null),(i===null||i.child===null)&&(Fe(a)?a.flags|=4:i===null||i.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,se!==null&&(Pd(se),se=null))),mc(i,a),li(a),null;case 5:nc(a);var I=Ti(rr.current);if(d=a.type,i!==null&&a.stateNode!=null)wh(i,a,d,v,I),i.ref!==a.ref&&(a.flags|=512,a.flags|=2097152);else{if(!v){if(a.stateNode===null)throw Error(b(166));return li(a),null}if(i=Ti(qr.current),Fe(a)){v=a.stateNode,d=a.type;var M=a.memoizedProps;switch(v[Gn]=a,v[As]=M,i=(a.mode&1)!==0,d){case"dialog":Fr("cancel",v),Fr("close",v);break;case"iframe":case"object":case"embed":Fr("load",v);break;case"video":case"audio":for(I=0;I<Ta.length;I++)Fr(Ta[I],v);break;case"source":Fr("error",v);break;case"img":case"image":case"link":Fr("error",v),Fr("load",v);break;case"details":Fr("toggle",v);break;case"input":Ra(v,M),Fr("invalid",v);break;case"select":v._wrapperState={wasMultiple:!!M.multiple},Fr("invalid",v);break;case"textarea":Ts(v,M),Fr("invalid",v)}Ln(d,M),I=null;for(var $ in M)if(M.hasOwnProperty($)){var ae=M[$];$==="children"?typeof ae=="string"?v.textContent!==ae&&(M.suppressHydrationWarning!==!0&&Co(v.textContent,ae,i),I=["children",ae]):typeof ae=="number"&&v.textContent!==""+ae&&(M.suppressHydrationWarning!==!0&&Co(v.textContent,ae,i),I=["children",""+ae]):D.hasOwnProperty($)&&ae!=null&&$==="onScroll"&&Fr("scroll",v)}switch(d){case"input":pa(v),co(v,M,!0);break;case"textarea":pa(v),mi(v);break;case"select":case"option":break;default:typeof M.onClick=="function"&&(v.onclick=si)}v=I,a.updateQueue=v,v!==null&&(a.flags|=4)}else{$=I.nodeType===9?I:I.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=ho(d)),i==="http://www.w3.org/1999/xhtml"?d==="script"?(i=$.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof v.is=="string"?i=$.createElement(d,{is:v.is}):(i=$.createElement(d),d==="select"&&($=i,v.multiple?$.multiple=!0:v.size&&($.size=v.size))):i=$.createElementNS(i,d),i[Gn]=a,i[As]=v,xh(i,a,!1,!1),a.stateNode=i;e:{switch($=gi(d,v),d){case"dialog":Fr("cancel",i),Fr("close",i),I=v;break;case"iframe":case"object":case"embed":Fr("load",i),I=v;break;case"video":case"audio":for(I=0;I<Ta.length;I++)Fr(Ta[I],i);I=v;break;case"source":Fr("error",i),I=v;break;case"img":case"image":case"link":Fr("error",i),Fr("load",i),I=v;break;case"details":Fr("toggle",i),I=v;break;case"input":Ra(i,v),I=bs(i,v),Fr("invalid",i);break;case"option":I=v;break;case"select":i._wrapperState={wasMultiple:!!v.multiple},I=ft({},v,{value:void 0}),Fr("invalid",i);break;case"textarea":Ts(i,v),I=ks(i,v),Fr("invalid",i);break;default:I=v}Ln(d,I),ae=I;for(M in ae)if(ae.hasOwnProperty(M)){var pe=ae[M];M==="style"?Jt(i,pe):M==="dangerouslySetInnerHTML"?(pe=pe?pe.__html:void 0,pe!=null&&Ji(i,pe)):M==="children"?typeof pe=="string"?(d!=="textarea"||pe!=="")&&gn(i,pe):typeof pe=="number"&&gn(i,""+pe):M!=="suppressContentEditableWarning"&&M!=="suppressHydrationWarning"&&M!=="autoFocus"&&(D.hasOwnProperty(M)?pe!=null&&M==="onScroll"&&Fr("scroll",i):pe!=null&&Ue(i,M,pe,$))}switch(d){case"input":pa(i),co(i,v,!1);break;case"textarea":pa(i),mi(i);break;case"option":v.value!=null&&i.setAttribute("value",""+or(v.value));break;case"select":i.multiple=!!v.multiple,M=v.value,M!=null?Ss(i,!!v.multiple,M,!1):v.defaultValue!=null&&Ss(i,!!v.multiple,v.defaultValue,!0);break;default:typeof I.onClick=="function"&&(i.onclick=si)}switch(d){case"button":case"input":case"select":case"textarea":v=!!v.autoFocus;break e;case"img":v=!0;break e;default:v=!1}}v&&(a.flags|=4)}a.ref!==null&&(a.flags|=512,a.flags|=2097152)}return li(a),null;case 6:if(i&&a.stateNode!=null)kd(i,a,i.memoizedProps,v);else{if(typeof v!="string"&&a.stateNode===null)throw Error(b(166));if(d=Ti(rr.current),Ti(qr.current),Fe(a)){if(v=a.stateNode,d=a.memoizedProps,v[Gn]=a,(M=v.nodeValue!==d)&&(i=X,i!==null))switch(i.tag){case 3:Co(v.nodeValue,d,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&Co(v.nodeValue,d,(i.mode&1)!==0)}M&&(a.flags|=4)}else v=(d.nodeType===9?d:d.ownerDocument).createTextNode(v),v[Gn]=a,a.stateNode=v}return li(a),null;case 13:if(Or(Hr),v=a.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(te&&J!==null&&(a.mode&1)!==0&&(a.flags&128)===0)Ge(),Qe(),a.flags|=98560,M=!1;else if(M=Fe(a),v!==null&&v.dehydrated!==null){if(i===null){if(!M)throw Error(b(318));if(M=a.memoizedState,M=M!==null?M.dehydrated:null,!M)throw Error(b(317));M[Gn]=a}else Qe(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;li(a),M=!1}else se!==null&&(Pd(se),se=null),M=!0;if(!M)return a.flags&65536?a:null}return(a.flags&128)!==0?(a.lanes=d,a):(v=v!==null,v!==(i!==null&&i.memoizedState!==null)&&v&&(a.child.flags|=8192,(a.mode&1)!==0&&(i===null||(Hr.current&1)!==0?En===0&&(En=3):Ah())),a.updateQueue!==null&&(a.flags|=4),li(a),null);case 4:return hs(),mc(i,a),i===null&&Xs(a.stateNode.containerInfo),li(a),null;case 10:return bi(a.type._context),li(a),null;case 17:return Cn(a.type)&&bl(),li(a),null;case 19:if(Or(Hr),M=a.memoizedState,M===null)return li(a),null;if(v=(a.flags&128)!==0,$=M.rendering,$===null)if(v)vu(M,!1);else{if(En!==0||i!==null&&(i.flags&128)!==0)for(i=a.child;i!==null;){if($=ds(i),$!==null){for(a.flags|=128,vu(M,!1),v=$.updateQueue,v!==null&&(a.updateQueue=v,a.flags|=4),a.subtreeFlags=0,v=d,d=a.child;d!==null;)M=d,i=v,M.flags&=14680066,$=M.alternate,$===null?(M.childLanes=0,M.lanes=i,M.child=null,M.subtreeFlags=0,M.memoizedProps=null,M.memoizedState=null,M.updateQueue=null,M.dependencies=null,M.stateNode=null):(M.childLanes=$.childLanes,M.lanes=$.lanes,M.child=$.child,M.subtreeFlags=0,M.deletions=null,M.memoizedProps=$.memoizedProps,M.memoizedState=$.memoizedState,M.updateQueue=$.updateQueue,M.type=$.type,i=$.dependencies,M.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),d=d.sibling;return Vr(Hr,Hr.current&1|2),a.child}i=i.sibling}M.tail!==null&&Vt()>Kr&&(a.flags|=128,v=!0,vu(M,!1),a.lanes=4194304)}else{if(!v)if(i=ds($),i!==null){if(a.flags|=128,v=!0,d=i.updateQueue,d!==null&&(a.updateQueue=d,a.flags|=4),vu(M,!0),M.tail===null&&M.tailMode==="hidden"&&!$.alternate&&!te)return li(a),null}else 2*Vt()-M.renderingStartTime>Kr&&d!==1073741824&&(a.flags|=128,v=!0,vu(M,!1),a.lanes=4194304);M.isBackwards?($.sibling=a.child,a.child=$):(d=M.last,d!==null?d.sibling=$:a.child=$,M.last=$)}return M.tail!==null?(a=M.tail,M.rendering=a,M.tail=a.sibling,M.renderingStartTime=Vt(),a.sibling=null,d=Hr.current,Vr(Hr,v?d&1|2:d&1),a):(li(a),null);case 22:case 23:return kc(),v=a.memoizedState!==null,i!==null&&i.memoizedState!==null!==v&&(a.flags|=8192),v&&(a.mode&1)!==0?(ci&1073741824)!==0&&(li(a),a.subtreeFlags&6&&(a.flags|=8192)):li(a),null;case 24:return null;case 25:return null}throw Error(b(156,a.tag))}function Mf(i,a){switch(G(a),a.tag){case 1:return Cn(a.type)&&bl(),i=a.flags,i&65536?(a.flags=i&-65537|128,a):null;case 3:return hs(),Or(lr),Or(Ar),Ro(),i=a.flags,(i&65536)!==0&&(i&128)===0?(a.flags=i&-65537|128,a):null;case 5:return nc(a),null;case 13:if(Or(Hr),i=a.memoizedState,i!==null&&i.dehydrated!==null){if(a.alternate===null)throw Error(b(340));Qe()}return i=a.flags,i&65536?(a.flags=i&-65537|128,a):null;case 19:return Or(Hr),null;case 4:return hs(),null;case 10:return bi(a.type._context),null;case 22:case 23:return kc(),null;case 24:return null;default:return null}}var bh=!1,ui=!1,Vo=typeof WeakSet=="function"?WeakSet:Set,Tt=null;function Pl(i,a){var d=i.ref;if(d!==null)if(typeof d=="function")try{d(null)}catch(v){Qr(i,a,v)}else d.current=null}function Uo(i,a,d){try{d()}catch(v){Qr(i,a,v)}}var bp=!1;function Af(i,a){if(Js=$a,i=iu(),Sa(i)){if("selectionStart"in i)var d={start:i.selectionStart,end:i.selectionEnd};else e:{d=(d=i.ownerDocument)&&d.defaultView||window;var v=d.getSelection&&d.getSelection();if(v&&v.rangeCount!==0){d=v.anchorNode;var I=v.anchorOffset,M=v.focusNode;v=v.focusOffset;try{d.nodeType,M.nodeType}catch{d=null;break e}var $=0,ae=-1,pe=-1,Ce=0,Ze=0,We=i,qe=null;t:for(;;){for(var ct;We!==d||I!==0&&We.nodeType!==3||(ae=$+I),We!==M||v!==0&&We.nodeType!==3||(pe=$+v),We.nodeType===3&&($+=We.nodeValue.length),(ct=We.firstChild)!==null;)qe=We,We=ct;for(;;){if(We===i)break t;if(qe===d&&++Ce===I&&(ae=$),qe===M&&++Ze===v&&(pe=$),(ct=We.nextSibling)!==null)break;We=qe,qe=We.parentNode}We=ct}d=ae===-1||pe===-1?null:{start:ae,end:pe}}else d=null}d=d||{start:0,end:0}}else d=null;for(Ju={focusedElem:i,selectionRange:d},$a=!1,Tt=a;Tt!==null;)if(a=Tt,i=a.child,(a.subtreeFlags&1028)!==0&&i!==null)i.return=a,Tt=i;else for(;Tt!==null;){a=Tt;try{var bt=a.alternate;if((a.flags&1024)!==0)switch(a.tag){case 0:case 11:case 15:break;case 1:if(bt!==null){var Mt=bt.memoizedProps,dn=bt.memoizedState,Se=a.stateNode,ge=Se.getSnapshotBeforeUpdate(a.elementType===a.type?Mt:Ls(a.type,Mt),dn);Se.__reactInternalSnapshotBeforeUpdate=ge}break;case 3:var Te=a.stateNode.containerInfo;Te.nodeType===1?Te.textContent="":Te.nodeType===9&&Te.documentElement&&Te.removeChild(Te.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(b(163))}}catch(it){Qr(a,a.return,it)}if(i=a.sibling,i!==null){i.return=a.return,Tt=i;break}Tt=a.return}return bt=bp,bp=!1,bt}function gc(i,a,d){var v=a.updateQueue;if(v=v!==null?v.lastEffect:null,v!==null){var I=v=v.next;do{if((I.tag&i)===i){var M=I.destroy;I.destroy=void 0,M!==void 0&&Uo(a,d,M)}I=I.next}while(I!==v)}}function yc(i,a){if(a=a.updateQueue,a=a!==null?a.lastEffect:null,a!==null){var d=a=a.next;do{if((d.tag&i)===i){var v=d.create;d.destroy=v()}d=d.next}while(d!==a)}}function Sh(i){var a=i.ref;if(a!==null){var d=i.stateNode;switch(i.tag){case 5:i=d;break;default:i=d}typeof a=="function"?a(i):a.current=i}}function Sp(i){var a=i.alternate;a!==null&&(i.alternate=null,Sp(a)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(a=i.stateNode,a!==null&&(delete a[Gn],delete a[As],delete a[sr],delete a[ec],delete a[od])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function kp(i){return i.tag===5||i.tag===3||i.tag===4}function Tp(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||kp(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function Td(i,a,d){var v=i.tag;if(v===5||v===6)i=i.stateNode,a?d.nodeType===8?d.parentNode.insertBefore(i,a):d.insertBefore(i,a):(d.nodeType===8?(a=d.parentNode,a.insertBefore(i,d)):(a=d,a.appendChild(i)),d=d._reactRootContainer,d!=null||a.onclick!==null||(a.onclick=si));else if(v!==4&&(i=i.child,i!==null))for(Td(i,a,d),i=i.sibling;i!==null;)Td(i,a,d),i=i.sibling}function _c(i,a,d){var v=i.tag;if(v===5||v===6)i=i.stateNode,a?d.insertBefore(i,a):d.appendChild(i);else if(v!==4&&(i=i.child,i!==null))for(_c(i,a,d),i=i.sibling;i!==null;)_c(i,a,d),i=i.sibling}var wn=null,gs=!1;function $o(i,a,d){for(d=d.child;d!==null;)Ip(i,a,d),d=d.sibling}function Ip(i,a,d){if(qn&&typeof qn.onCommitFiberUnmount=="function")try{qn.onCommitFiberUnmount(Bn,d)}catch{}switch(d.tag){case 5:ui||Pl(d,a);case 6:var v=wn,I=gs;wn=null,$o(i,a,d),wn=v,gs=I,wn!==null&&(gs?(i=wn,d=d.stateNode,i.nodeType===8?i.parentNode.removeChild(d):i.removeChild(d)):wn.removeChild(d.stateNode));break;case 18:wn!==null&&(gs?(i=wn,d=d.stateNode,i.nodeType===8?mt(i.parentNode,d):i.nodeType===1&&mt(i,d),Us(i)):mt(wn,d.stateNode));break;case 4:v=wn,I=gs,wn=d.stateNode.containerInfo,gs=!0,$o(i,a,d),wn=v,gs=I;break;case 0:case 11:case 14:case 15:if(!ui&&(v=d.updateQueue,v!==null&&(v=v.lastEffect,v!==null))){I=v=v.next;do{var M=I,$=M.destroy;M=M.tag,$!==void 0&&((M&2)!==0||(M&4)!==0)&&Uo(d,a,$),I=I.next}while(I!==v)}$o(i,a,d);break;case 1:if(!ui&&(Pl(d,a),v=d.stateNode,typeof v.componentWillUnmount=="function"))try{v.props=d.memoizedProps,v.state=d.memoizedState,v.componentWillUnmount()}catch(ae){Qr(d,a,ae)}$o(i,a,d);break;case 21:$o(i,a,d);break;case 22:d.mode&1?(ui=(v=ui)||d.memoizedState!==null,$o(i,a,d),ui=v):$o(i,a,d);break;default:$o(i,a,d)}}function Id(i){var a=i.updateQueue;if(a!==null){i.updateQueue=null;var d=i.stateNode;d===null&&(d=i.stateNode=new Vo),a.forEach(function(v){var I=Op.bind(null,i,v);d.has(v)||(d.add(v),v.then(I,I))})}}function na(i,a){var d=a.deletions;if(d!==null)for(var v=0;v<d.length;v++){var I=d[v];try{var M=i,$=a,ae=$;e:for(;ae!==null;){switch(ae.tag){case 5:wn=ae.stateNode,gs=!1;break e;case 3:wn=ae.stateNode.containerInfo,gs=!0;break e;case 4:wn=ae.stateNode.containerInfo,gs=!0;break e}ae=ae.return}if(wn===null)throw Error(b(160));Ip(M,$,I),wn=null,gs=!1;var pe=I.alternate;pe!==null&&(pe.return=null),I.return=null}catch(Ce){Qr(I,a,Ce)}}if(a.subtreeFlags&12854)for(a=a.child;a!==null;)Ep(a,i),a=a.sibling}function Ep(i,a){var d=i.alternate,v=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(na(a,i),ji(i),v&4){try{gc(3,i,i.return),yc(3,i)}catch(Mt){Qr(i,i.return,Mt)}try{gc(5,i,i.return)}catch(Mt){Qr(i,i.return,Mt)}}break;case 1:na(a,i),ji(i),v&512&&d!==null&&Pl(d,d.return);break;case 5:if(na(a,i),ji(i),v&512&&d!==null&&Pl(d,d.return),i.flags&32){var I=i.stateNode;try{gn(I,"")}catch(Mt){Qr(i,i.return,Mt)}}if(v&4&&(I=i.stateNode,I!=null)){var M=i.memoizedProps,$=d!==null?d.memoizedProps:M,ae=i.type,pe=i.updateQueue;if(i.updateQueue=null,pe!==null)try{ae==="input"&&M.type==="radio"&&M.name!=null&&Ee(I,M),gi(ae,$);var Ce=gi(ae,M);for($=0;$<pe.length;$+=2){var Ze=pe[$],We=pe[$+1];Ze==="style"?Jt(I,We):Ze==="dangerouslySetInnerHTML"?Ji(I,We):Ze==="children"?gn(I,We):Ue(I,Ze,We,Ce)}switch(ae){case"input":Ns(I,M);break;case"textarea":Ba(I,M);break;case"select":var qe=I._wrapperState.wasMultiple;I._wrapperState.wasMultiple=!!M.multiple;var ct=M.value;ct!=null?Ss(I,!!M.multiple,ct,!1):qe!==!!M.multiple&&(M.defaultValue!=null?Ss(I,!!M.multiple,M.defaultValue,!0):Ss(I,!!M.multiple,M.multiple?[]:"",!1))}I[As]=M}catch(Mt){Qr(i,i.return,Mt)}}break;case 6:if(na(a,i),ji(i),v&4){if(i.stateNode===null)throw Error(b(162));I=i.stateNode,M=i.memoizedProps;try{I.nodeValue=M}catch(Mt){Qr(i,i.return,Mt)}}break;case 3:if(na(a,i),ji(i),v&4&&d!==null&&d.memoizedState.isDehydrated)try{Us(a.containerInfo)}catch(Mt){Qr(i,i.return,Mt)}break;case 4:na(a,i),ji(i);break;case 13:na(a,i),ji(i),I=i.child,I.flags&8192&&(M=I.memoizedState!==null,I.stateNode.isHidden=M,!M||I.alternate!==null&&I.alternate.memoizedState!==null||(Ml=Vt())),v&4&&Id(i);break;case 22:if(Ze=d!==null&&d.memoizedState!==null,i.mode&1?(ui=(Ce=ui)||Ze,na(a,i),ui=Ce):na(a,i),ji(i),v&8192){if(Ce=i.memoizedState!==null,(i.stateNode.isHidden=Ce)&&!Ze&&(i.mode&1)!==0)for(Tt=i,Ze=i.child;Ze!==null;){for(We=Tt=Ze;Tt!==null;){switch(qe=Tt,ct=qe.child,qe.tag){case 0:case 11:case 14:case 15:gc(4,qe,qe.return);break;case 1:Pl(qe,qe.return);var bt=qe.stateNode;if(typeof bt.componentWillUnmount=="function"){v=qe,d=qe.return;try{a=v,bt.props=a.memoizedProps,bt.state=a.memoizedState,bt.componentWillUnmount()}catch(Mt){Qr(v,d,Mt)}}break;case 5:Pl(qe,qe.return);break;case 22:if(qe.memoizedState!==null){Ap(We);continue}}ct!==null?(ct.return=qe,Tt=ct):Ap(We)}Ze=Ze.sibling}e:for(Ze=null,We=i;;){if(We.tag===5){if(Ze===null){Ze=We;try{I=We.stateNode,Ce?(M=I.style,typeof M.setProperty=="function"?M.setProperty("display","none","important"):M.display="none"):(ae=We.stateNode,pe=We.memoizedProps.style,$=pe!=null&&pe.hasOwnProperty("display")?pe.display:null,ae.style.display=rt("display",$))}catch(Mt){Qr(i,i.return,Mt)}}}else if(We.tag===6){if(Ze===null)try{We.stateNode.nodeValue=Ce?"":We.memoizedProps}catch(Mt){Qr(i,i.return,Mt)}}else if((We.tag!==22&&We.tag!==23||We.memoizedState===null||We===i)&&We.child!==null){We.child.return=We,We=We.child;continue}if(We===i)break e;for(;We.sibling===null;){if(We.return===null||We.return===i)break e;Ze===We&&(Ze=null),We=We.return}Ze===We&&(Ze=null),We.sibling.return=We.return,We=We.sibling}}break;case 19:na(a,i),ji(i),v&4&&Id(i);break;case 21:break;default:na(a,i),ji(i)}}function ji(i){var a=i.flags;if(a&2){try{e:{for(var d=i.return;d!==null;){if(kp(d)){var v=d;break e}d=d.return}throw Error(b(160))}switch(v.tag){case 5:var I=v.stateNode;v.flags&32&&(gn(I,""),v.flags&=-33);var M=Tp(i);_c(i,M,I);break;case 3:case 4:var $=v.stateNode.containerInfo,ae=Tp(i);Td(i,ae,$);break;default:throw Error(b(161))}}catch(pe){Qr(i,i.return,pe)}i.flags&=-3}a&4096&&(i.flags&=-4097)}function Pp(i,a,d){Tt=i,Cp(i)}function Cp(i,a,d){for(var v=(i.mode&1)!==0;Tt!==null;){var I=Tt,M=I.child;if(I.tag===22&&v){var $=I.memoizedState!==null||bh;if(!$){var ae=I.alternate,pe=ae!==null&&ae.memoizedState!==null||ui;ae=bh;var Ce=ui;if(bh=$,(ui=pe)&&!Ce)for(Tt=I;Tt!==null;)$=Tt,pe=$.child,$.tag===22&&$.memoizedState!==null?zp(I):pe!==null?(pe.return=$,Tt=pe):zp(I);for(;M!==null;)Tt=M,Cp(M),M=M.sibling;Tt=I,bh=ae,ui=Ce}Mp(i)}else(I.subtreeFlags&8772)!==0&&M!==null?(M.return=I,Tt=M):Mp(i)}}function Mp(i){for(;Tt!==null;){var a=Tt;if((a.flags&8772)!==0){var d=a.alternate;try{if((a.flags&8772)!==0)switch(a.tag){case 0:case 11:case 15:ui||yc(5,a);break;case 1:var v=a.stateNode;if(a.flags&4&&!ui)if(d===null)v.componentDidMount();else{var I=a.elementType===a.type?d.memoizedProps:Ls(a.type,d.memoizedProps);v.componentDidUpdate(I,d.memoizedState,v.__reactInternalSnapshotBeforeUpdate)}var M=a.updateQueue;M!==null&&Ni(a,M,v);break;case 3:var $=a.updateQueue;if($!==null){if(d=null,a.child!==null)switch(a.child.tag){case 5:d=a.child.stateNode;break;case 1:d=a.child.stateNode}Ni(a,$,d)}break;case 5:var ae=a.stateNode;if(d===null&&a.flags&4){d=ae;var pe=a.memoizedProps;switch(a.type){case"button":case"input":case"select":case"textarea":pe.autoFocus&&d.focus();break;case"img":pe.src&&(d.src=pe.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(a.memoizedState===null){var Ce=a.alternate;if(Ce!==null){var Ze=Ce.memoizedState;if(Ze!==null){var We=Ze.dehydrated;We!==null&&Us(We)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(b(163))}ui||a.flags&512&&Sh(a)}catch(qe){Qr(a,a.return,qe)}}if(a===i){Tt=null;break}if(d=a.sibling,d!==null){d.return=a.return,Tt=d;break}Tt=a.return}}function Ap(i){for(;Tt!==null;){var a=Tt;if(a===i){Tt=null;break}var d=a.sibling;if(d!==null){d.return=a.return,Tt=d;break}Tt=a.return}}function zp(i){for(;Tt!==null;){var a=Tt;try{switch(a.tag){case 0:case 11:case 15:var d=a.return;try{yc(4,a)}catch(pe){Qr(a,d,pe)}break;case 1:var v=a.stateNode;if(typeof v.componentDidMount=="function"){var I=a.return;try{v.componentDidMount()}catch(pe){Qr(a,I,pe)}}var M=a.return;try{Sh(a)}catch(pe){Qr(a,M,pe)}break;case 5:var $=a.return;try{Sh(a)}catch(pe){Qr(a,$,pe)}}}catch(pe){Qr(a,a.return,pe)}if(a===i){Tt=null;break}var ae=a.sibling;if(ae!==null){ae.return=a.return,Tt=ae;break}Tt=a.return}}var zf=Math.ceil,kh=et.ReactCurrentDispatcher,Th=et.ReactCurrentOwner,Vi=et.ReactCurrentBatchConfig,vr=0,zn=null,bn=null,Wn=0,ci=0,xu=Ia(0),En=0,vc=null,Cl=0,Ih=0,Eh=0,xc=null,Ui=null,Ml=0,Kr=1/0,Aa=null,wc=!1,Ph=null,dr=null,wu=!1,ro=null,bc=0,ys=0,qo=null,Sc=-1,Ch=0;function Ei(){return(vr&6)!==0?Vt():Sc!==-1?Sc:Sc=Vt()}function Zo(i){return(i.mode&1)===0?1:(vr&2)!==0&&Wn!==0?Wn&-Wn:tt.transition!==null?(Ch===0&&(Ch=Vs()),Ch):(i=Sr,i!==0||(i=window.event,i=i===void 0?16:_a(i.type)),i)}function ia(i,a,d,v){if(50<ys)throw ys=0,qo=null,Error(b(185));Va(i,d,v),((vr&2)===0||i!==zn)&&(i===zn&&((vr&2)===0&&(Ih|=d),En===4&&sa(i,Wn)),$i(i,v),d===1&&vr===0&&(a.mode&1)===0&&(Kr=Vt()+500,At&&f()))}function $i(i,a){var d=i.callbackNode;$l(i,a);var v=ti(i,i===zn?Wn:0);if(v===0)d!==null&&Sn(d),i.callbackNode=null,i.callbackPriority=0;else if(a=v&-v,i.callbackPriority!==a){if(d!=null&&Sn(d),a===1)i.tag===0?tc(Al.bind(null,i)):Sl(Al.bind(null,i)),Mo(function(){(vr&6)===0&&f()}),d=null;else{switch(nl(v)){case 1:d=tl;break;case 4:d=Qn;break;case 16:d=Rn;break;case 536870912:d=_i;break;default:d=Rn}d=Ad(d,Dp.bind(null,i))}i.callbackPriority=a,i.callbackNode=d}}function Dp(i,a){if(Sc=-1,Ch=0,(vr&6)!==0)throw Error(b(327));var d=i.callbackNode;if(oa()&&i.callbackNode!==d)return null;var v=ti(i,i===zn?Wn:0);if(v===0)return null;if((v&30)!==0||(v&i.expiredLanes)!==0||a)a=Tc(i,v);else{a=v;var I=vr;vr|=2;var M=Rp();(zn!==i||Wn!==a)&&(Aa=null,Kr=Vt()+500,zl(i,a));do try{Cd();break}catch(ae){Lp(i,ae)}while(!0);Tn(),kh.current=M,vr=I,bn!==null?a=0:(zn=null,Wn=0,a=En)}if(a!==0){if(a===2&&(I=js(i),I!==0&&(v=I,a=Ed(i,I))),a===1)throw d=vc,zl(i,0),sa(i,v),$i(i,Vt()),d;if(a===6)sa(i,v);else{if(I=i.current.alternate,(v&30)===0&&!Df(I)&&(a=Tc(i,v),a===2&&(M=js(i),M!==0&&(v=M,a=Ed(i,M))),a===1))throw d=vc,zl(i,0),sa(i,v),$i(i,Vt()),d;switch(i.finishedWork=I,i.finishedLanes=v,a){case 0:case 1:throw Error(b(345));case 2:aa(i,Ui,Aa);break;case 3:if(sa(i,v),(v&130023424)===v&&(a=Ml+500-Vt(),10<a)){if(ti(i,0)!==0)break;if(I=i.suspendedLanes,(I&v)!==v){Ei(),i.pingedLanes|=i.suspendedLanes&I;break}i.timeoutHandle=uu(aa.bind(null,i,Ui,Aa),a);break}aa(i,Ui,Aa);break;case 4:if(sa(i,v),(v&4194240)===v)break;for(a=i.eventTimes,I=-1;0<v;){var $=31-Er(v);M=1<<$,$=a[$],$>I&&(I=$),v&=~M}if(v=I,v=Vt()-v,v=(120>v?120:480>v?480:1080>v?1080:1920>v?1920:3e3>v?3e3:4320>v?4320:1960*zf(v/1960))-v,10<v){i.timeoutHandle=uu(aa.bind(null,i,Ui,Aa),v);break}aa(i,Ui,Aa);break;case 5:aa(i,Ui,Aa);break;default:throw Error(b(329))}}}return $i(i,Vt()),i.callbackNode===d?Dp.bind(null,i):null}function Ed(i,a){var d=xc;return i.current.memoizedState.isDehydrated&&(zl(i,a).flags|=256),i=Tc(i,a),i!==2&&(a=Ui,Ui=d,a!==null&&Pd(a)),i}function Pd(i){Ui===null?Ui=i:Ui.push.apply(Ui,i)}function Df(i){for(var a=i;;){if(a.flags&16384){var d=a.updateQueue;if(d!==null&&(d=d.stores,d!==null))for(var v=0;v<d.length;v++){var I=d[v],M=I.getSnapshot;I=I.value;try{if(!ni(M(),I))return!1}catch{return!1}}}if(d=a.child,a.subtreeFlags&16384&&d!==null)d.return=a,a=d;else{if(a===i)break;for(;a.sibling===null;){if(a.return===null||a.return===i)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function sa(i,a){for(a&=~Eh,a&=~Ih,i.suspendedLanes|=a,i.pingedLanes&=~a,i=i.expirationTimes;0<a;){var d=31-Er(a),v=1<<d;i[d]=-1,a&=~v}}function Al(i){if((vr&6)!==0)throw Error(b(327));oa();var a=ti(i,0);if((a&1)===0)return $i(i,Vt()),null;var d=Tc(i,a);if(i.tag!==0&&d===2){var v=js(i);v!==0&&(a=v,d=Ed(i,v))}if(d===1)throw d=vc,zl(i,0),sa(i,a),$i(i,Vt()),d;if(d===6)throw Error(b(345));return i.finishedWork=i.current.alternate,i.finishedLanes=a,aa(i,Ui,Aa),$i(i,Vt()),null}function Mh(i,a){var d=vr;vr|=1;try{return i(a)}finally{vr=d,vr===0&&(Kr=Vt()+500,At&&f())}}function no(i){ro!==null&&ro.tag===0&&(vr&6)===0&&oa();var a=vr;vr|=1;var d=Vi.transition,v=Sr;try{if(Vi.transition=null,Sr=1,i)return i()}finally{Sr=v,Vi.transition=d,vr=a,(vr&6)===0&&f()}}function kc(){ci=xu.current,Or(xu)}function zl(i,a){i.finishedWork=null,i.finishedLanes=0;var d=i.timeoutHandle;if(d!==-1&&(i.timeoutHandle=-1,sh(d)),bn!==null)for(d=bn.return;d!==null;){var v=d;switch(G(v),v.tag){case 1:v=v.type.childContextTypes,v!=null&&bl();break;case 3:hs(),Or(lr),Or(Ar),Ro();break;case 5:nc(v);break;case 4:hs();break;case 13:Or(Hr);break;case 19:Or(Hr);break;case 10:bi(v.type._context);break;case 22:case 23:kc()}d=d.return}if(zn=i,bn=i=Go(i.current,null),Wn=ci=a,En=0,vc=null,Eh=Ih=Cl=0,Ui=xc=null,rn!==null){for(a=0;a<rn.length;a++)if(d=rn[a],v=d.interleaved,v!==null){d.interleaved=null;var I=v.next,M=d.pending;if(M!==null){var $=M.next;M.next=I,v.next=$}d.pending=v}rn=null}return i}function Lp(i,a){do{var d=bn;try{if(Tn(),Ma.current=hh,ic){for(var v=Lr.memoizedState;v!==null;){var I=v.queue;I!==null&&(I.pending=null),v=v.next}ic=!1}if(Ds=0,vn=Jr=Lr=null,pu=!1,sc=0,Th.current=null,d===null||d.return===null){En=1,vc=a,bn=null;break}e:{var M=i,$=d.return,ae=d,pe=a;if(a=Wn,ae.flags|=32768,pe!==null&&typeof pe=="object"&&typeof pe.then=="function"){var Ce=pe,Ze=ae,We=Ze.tag;if((Ze.mode&1)===0&&(We===0||We===11||We===15)){var qe=Ze.alternate;qe?(Ze.updateQueue=qe.updateQueue,Ze.memoizedState=qe.memoizedState,Ze.lanes=qe.lanes):(Ze.updateQueue=null,Ze.memoizedState=null)}var ct=pp($);if(ct!==null){ct.flags&=-257,fp(ct,$,ae,M,a),ct.mode&1&&dp(M,Ce,a),a=ct,pe=Ce;var bt=a.updateQueue;if(bt===null){var Mt=new Set;Mt.add(pe),a.updateQueue=Mt}else bt.add(pe);break e}else{if((a&1)===0){dp(M,Ce,a),Ah();break e}pe=Error(b(426))}}else if(te&&ae.mode&1){var dn=pp($);if(dn!==null){(dn.flags&65536)===0&&(dn.flags|=256),fp(dn,$,ae,M,a),ut(Fn(pe,ae));break e}}M=pe=Fn(pe,ae),En!==4&&(En=2),xc===null?xc=[M]:xc.push(M),M=$;do{switch(M.tag){case 3:M.flags|=65536,a&=-a,M.lanes|=a;var Se=_d(M,pe,a);ki(M,Se);break e;case 1:ae=pe;var ge=M.type,Te=M.stateNode;if((M.flags&128)===0&&(typeof ge.getDerivedStateFromError=="function"||Te!==null&&typeof Te.componentDidCatch=="function"&&(dr===null||!dr.has(Te)))){M.flags|=65536,a&=-a,M.lanes|=a;var it=hp(M,ae,a);ki(M,it);break e}}M=M.return}while(M!==null)}io(d)}catch(zt){a=zt,bn===d&&d!==null&&(bn=d=d.return);continue}break}while(!0)}function Rp(){var i=kh.current;return kh.current=hh,i===null?hh:i}function Ah(){(En===0||En===3||En===2)&&(En=4),zn===null||(Cl&268435455)===0&&(Ih&268435455)===0||sa(zn,Wn)}function Tc(i,a){var d=vr;vr|=2;var v=Rp();(zn!==i||Wn!==a)&&(Aa=null,zl(i,a));do try{Pi();break}catch(I){Lp(i,I)}while(!0);if(Tn(),vr=d,kh.current=v,bn!==null)throw Error(b(261));return zn=null,Wn=0,En}function Pi(){for(;bn!==null;)Md(bn)}function Cd(){for(;bn!==null&&!$n();)Md(bn)}function Md(i){var a=Np(i.alternate,i,ci);i.memoizedProps=i.pendingProps,a===null?io(i):bn=a,Th.current=null}function io(i){var a=i;do{var d=a.alternate;if(i=a.return,(a.flags&32768)===0){if(d=Cf(d,a,ci),d!==null){bn=d;return}}else{if(d=Mf(d,a),d!==null){d.flags&=32767,bn=d;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{En=6,bn=null;return}}if(a=a.sibling,a!==null){bn=a;return}bn=a=i}while(a!==null);En===0&&(En=5)}function aa(i,a,d){var v=Sr,I=Vi.transition;try{Vi.transition=null,Sr=1,Ic(i,a,d,v)}finally{Vi.transition=I,Sr=v}return null}function Ic(i,a,d,v){do oa();while(ro!==null);if((vr&6)!==0)throw Error(b(327));d=i.finishedWork;var I=i.finishedLanes;if(d===null)return null;if(i.finishedWork=null,i.finishedLanes=0,d===i.current)throw Error(b(177));i.callbackNode=null,i.callbackPriority=0;var M=d.lanes|d.childLanes;if(Du(i,M),i===zn&&(bn=zn=null,Wn=0),(d.subtreeFlags&2064)===0&&(d.flags&2064)===0||wu||(wu=!0,Ad(Rn,function(){return oa(),null})),M=(d.flags&15990)!==0,(d.subtreeFlags&15990)!==0||M){M=Vi.transition,Vi.transition=null;var $=Sr;Sr=1;var ae=vr;vr|=4,Th.current=null,Af(i,d),Ep(d,i),pl(Ju),$a=!!Js,Ju=Js=null,i.current=d,Pp(d),po(),vr=ae,Sr=$,Vi.transition=M}else i.current=d;if(wu&&(wu=!1,ro=i,bc=I),M=i.pendingLanes,M===0&&(dr=null),Oa(d.stateNode),$i(i,Vt()),a!==null)for(v=i.onRecoverableError,d=0;d<a.length;d++)I=a[d],v(I.value,{componentStack:I.stack,digest:I.digest});if(wc)throw wc=!1,i=Ph,Ph=null,i;return(bc&1)!==0&&i.tag!==0&&oa(),M=i.pendingLanes,(M&1)!==0?i===qo?ys++:(ys=0,qo=i):ys=0,f(),null}function oa(){if(ro!==null){var i=nl(bc),a=Vi.transition,d=Sr;try{if(Vi.transition=null,Sr=16>i?16:i,ro===null)var v=!1;else{if(i=ro,ro=null,bc=0,(vr&6)!==0)throw Error(b(331));var I=vr;for(vr|=4,Tt=i.current;Tt!==null;){var M=Tt,$=M.child;if((Tt.flags&16)!==0){var ae=M.deletions;if(ae!==null){for(var pe=0;pe<ae.length;pe++){var Ce=ae[pe];for(Tt=Ce;Tt!==null;){var Ze=Tt;switch(Ze.tag){case 0:case 11:case 15:gc(8,Ze,M)}var We=Ze.child;if(We!==null)We.return=Ze,Tt=We;else for(;Tt!==null;){Ze=Tt;var qe=Ze.sibling,ct=Ze.return;if(Sp(Ze),Ze===Ce){Tt=null;break}if(qe!==null){qe.return=ct,Tt=qe;break}Tt=ct}}}var bt=M.alternate;if(bt!==null){var Mt=bt.child;if(Mt!==null){bt.child=null;do{var dn=Mt.sibling;Mt.sibling=null,Mt=dn}while(Mt!==null)}}Tt=M}}if((M.subtreeFlags&2064)!==0&&$!==null)$.return=M,Tt=$;else e:for(;Tt!==null;){if(M=Tt,(M.flags&2048)!==0)switch(M.tag){case 0:case 11:case 15:gc(9,M,M.return)}var Se=M.sibling;if(Se!==null){Se.return=M.return,Tt=Se;break e}Tt=M.return}}var ge=i.current;for(Tt=ge;Tt!==null;){$=Tt;var Te=$.child;if(($.subtreeFlags&2064)!==0&&Te!==null)Te.return=$,Tt=Te;else e:for($=ge;Tt!==null;){if(ae=Tt,(ae.flags&2048)!==0)try{switch(ae.tag){case 0:case 11:case 15:yc(9,ae)}}catch(zt){Qr(ae,ae.return,zt)}if(ae===$){Tt=null;break e}var it=ae.sibling;if(it!==null){it.return=ae.return,Tt=it;break e}Tt=ae.return}}if(vr=I,f(),qn&&typeof qn.onPostCommitFiberRoot=="function")try{qn.onPostCommitFiberRoot(Bn,i)}catch{}v=!0}return v}finally{Sr=d,Vi.transition=a}}return!1}function Ec(i,a,d){a=Fn(d,a),a=_d(i,a,1),i=zs(i,a,1),a=Ei(),i!==null&&(Va(i,1,a),$i(i,a))}function Qr(i,a,d){if(i.tag===3)Ec(i,i,d);else for(;a!==null;){if(a.tag===3){Ec(a,i,d);break}else if(a.tag===1){var v=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof v.componentDidCatch=="function"&&(dr===null||!dr.has(v))){i=Fn(d,i),i=hp(a,i,1),a=zs(a,i,1),i=Ei(),a!==null&&(Va(a,1,i),$i(a,i));break}}a=a.return}}function Lf(i,a,d){var v=i.pingCache;v!==null&&v.delete(a),a=Ei(),i.pingedLanes|=i.suspendedLanes&d,zn===i&&(Wn&d)===d&&(En===4||En===3&&(Wn&130023424)===Wn&&500>Vt()-Ml?zl(i,0):Eh|=d),$i(i,a)}function Bp(i,a){a===0&&((i.mode&1)===0?a=1:(a=ei,ei<<=1,(ei&130023424)===0&&(ei=4194304)));var d=Ei();i=ai(i,a),i!==null&&(Va(i,a,d),$i(i,d))}function Fp(i){var a=i.memoizedState,d=0;a!==null&&(d=a.retryLane),Bp(i,d)}function Op(i,a){var d=0;switch(i.tag){case 13:var v=i.stateNode,I=i.memoizedState;I!==null&&(d=I.retryLane);break;case 19:v=i.stateNode;break;default:throw Error(b(314))}v!==null&&v.delete(a),Bp(i,d)}var Np;Np=function(i,a,d){if(i!==null)if(i.memoizedProps!==a.pendingProps||lr.current)Ii=!0;else{if((i.lanes&d)===0&&(a.flags&128)===0)return Ii=!1,Sd(i,a,d);Ii=(i.flags&131072)!==0}else Ii=!1,te&&(a.flags&1048576)!==0&&B(a,u,a.index);switch(a.lanes=0,a.tag){case 2:var v=a.type;fc(i,a),i=a.pendingProps;var I=ea(a,Ar.current);_n(a,d),I=ta(null,a,v,i,I,d);var M=ps();return a.flags|=1,typeof I=="object"&&I!==null&&typeof I.render=="function"&&I.$$typeof===void 0?(a.tag=1,a.memoizedState=null,a.updateQueue=null,Cn(v)?(M=!0,wi(a)):M=!1,a.memoizedState=I.state!==null&&I.state!==void 0?I.state:null,Pa(a),I.updater=fh,a.stateNode=I,I._reactInternals=a,Il(a,v,i,d),a=xd(null,a,v,!0,M,d)):(a.tag=0,te&&M&&U(a),xn(null,a,I,d),a=a.child),a;case 16:v=a.elementType;e:{switch(fc(i,a),i=a.pendingProps,I=v._init,v=I(v._payload),a.type=v,I=a.tag=Rf(v),i=Ls(v,i),I){case 0:a=vd(null,a,v,i,d);break e;case 1:a=xp(null,a,v,i,d);break e;case 11:a=yu(null,a,v,i,d);break e;case 14:a=gp(null,a,v,Ls(v.type,i),d);break e}throw Error(b(306,v,""))}return a;case 0:return v=a.type,I=a.pendingProps,I=a.elementType===v?I:Ls(v,I),vd(i,a,v,I,d);case 1:return v=a.type,I=a.pendingProps,I=a.elementType===v?I:Ls(v,I),xp(i,a,v,I,d);case 3:e:{if(_h(a),i===null)throw Error(b(387));v=a.pendingProps,M=a.memoizedState,I=M.element,Si(i,a),cs(a,v,null,d);var $=a.memoizedState;if(v=$.element,M.isDehydrated)if(M={element:v,isDehydrated:!1,cache:$.cache,pendingSuspenseBoundaries:$.pendingSuspenseBoundaries,transitions:$.transitions},a.updateQueue.baseState=M,a.memoizedState=M,a.flags&256){I=Fn(Error(b(423)),a),a=wp(i,a,v,d,I);break e}else if(v!==I){I=Fn(Error(b(424)),a),a=wp(i,a,v,d,I);break e}else for(J=ss(a.stateNode.containerInfo.firstChild),X=a,te=!0,se=null,d=Bt(a,null,v,d),a.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling;else{if(Qe(),v===I){a=ms(i,a,d);break e}xn(i,a,v,d)}a=a.child}return a;case 5:return rc(a),i===null&&ye(a),v=a.type,I=a.pendingProps,M=i!==null?i.memoizedProps:null,$=I.children,Qu(v,I)?$=null:M!==null&&Qu(v,M)&&(a.flags|=32),vp(i,a),xn(i,a,$,d),a.child;case 6:return i===null&&ye(a),null;case 13:return nn(i,a,d);case 4:return Ca(a,a.stateNode.containerInfo),v=a.pendingProps,i===null?a.child=st(a,null,v,d):xn(i,a,v,d),a.child;case 11:return v=a.type,I=a.pendingProps,I=a.elementType===v?I:Ls(v,I),yu(i,a,v,I,d);case 7:return xn(i,a,a.pendingProps,d),a.child;case 8:return xn(i,a,a.pendingProps.children,d),a.child;case 12:return xn(i,a,a.pendingProps.children,d),a.child;case 10:e:{if(v=a.type._context,I=a.pendingProps,M=a.memoizedProps,$=I.value,Vr(Cr,v._currentValue),v._currentValue=$,M!==null)if(ni(M.value,$)){if(M.children===I.children&&!lr.current){a=ms(i,a,d);break e}}else for(M=a.child,M!==null&&(M.return=a);M!==null;){var ae=M.dependencies;if(ae!==null){$=M.child;for(var pe=ae.firstContext;pe!==null;){if(pe.context===v){if(M.tag===1){pe=Oi(-1,d&-d),pe.tag=2;var Ce=M.updateQueue;if(Ce!==null){Ce=Ce.shared;var Ze=Ce.pending;Ze===null?pe.next=pe:(pe.next=Ze.next,Ze.next=pe),Ce.pending=pe}}M.lanes|=d,pe=M.alternate,pe!==null&&(pe.lanes|=d),Dr(M.return,d,a),ae.lanes|=d;break}pe=pe.next}}else if(M.tag===10)$=M.type===a.type?null:M.child;else if(M.tag===18){if($=M.return,$===null)throw Error(b(341));$.lanes|=d,ae=$.alternate,ae!==null&&(ae.lanes|=d),Dr($,d,a),$=M.sibling}else $=M.child;if($!==null)$.return=M;else for($=M;$!==null;){if($===a){$=null;break}if(M=$.sibling,M!==null){M.return=$.return,$=M;break}$=$.return}M=$}xn(i,a,I.children,d),a=a.child}return a;case 9:return I=a.type,v=a.pendingProps.children,_n(a,d),I=Ur(I),v=v(I),a.flags|=1,xn(i,a,v,d),a.child;case 14:return v=a.type,I=Ls(v,a.pendingProps),I=Ls(v.type,I),gp(i,a,v,I,d);case 15:return yp(i,a,a.type,a.pendingProps,d);case 17:return v=a.type,I=a.pendingProps,I=a.elementType===v?I:Ls(v,I),fc(i,a),a.tag=1,Cn(v)?(i=!0,wi(a)):i=!1,_n(a,d),yd(a,v,I),Il(a,v,I,d),xd(null,a,v,!0,i,d);case 19:return bd(i,a,d);case 22:return _p(i,a,d)}throw Error(b(156,a.tag))};function Ad(i,a){return yn(i,a)}function jp(i,a,d,v){this.tag=i,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=v,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function qi(i,a,d,v){return new jp(i,a,d,v)}function Pc(i){return i=i.prototype,!(!i||!i.isReactComponent)}function Rf(i){if(typeof i=="function")return Pc(i)?1:0;if(i!=null){if(i=i.$$typeof,i===wr)return 11;if(i===Mr)return 14}return 2}function Go(i,a){var d=i.alternate;return d===null?(d=qi(i.tag,a,i.key,i.mode),d.elementType=i.elementType,d.type=i.type,d.stateNode=i.stateNode,d.alternate=i,i.alternate=d):(d.pendingProps=a,d.type=i.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=i.flags&14680064,d.childLanes=i.childLanes,d.lanes=i.lanes,d.child=i.child,d.memoizedProps=i.memoizedProps,d.memoizedState=i.memoizedState,d.updateQueue=i.updateQueue,a=i.dependencies,d.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},d.sibling=i.sibling,d.index=i.index,d.ref=i.ref,d}function Cc(i,a,d,v,I,M){var $=2;if(v=i,typeof i=="function")Pc(i)&&($=1);else if(typeof i=="string")$=5;else e:switch(i){case je:return Ho(d.children,I,M,a);case pt:$=8,I|=8;break;case $e:return i=qi(12,d,a,I|2),i.elementType=$e,i.lanes=M,i;case Zt:return i=qi(13,d,a,I),i.elementType=Zt,i.lanes=M,i;case Nt:return i=qi(19,d,a,I),i.elementType=Nt,i.lanes=M,i;case $t:return Ko(d,I,M,a);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case ar:$=10;break e;case xt:$=9;break e;case wr:$=11;break e;case Mr:$=14;break e;case Pr:$=16,v=null;break e}throw Error(b(130,i==null?i:typeof i,""))}return a=qi($,d,a,I),a.elementType=i,a.type=v,a.lanes=M,a}function Ho(i,a,d,v){return i=qi(7,i,v,a),i.lanes=d,i}function Ko(i,a,d,v){return i=qi(22,i,v,a),i.elementType=$t,i.lanes=d,i.stateNode={isHidden:!1},i}function Rs(i,a,d){return i=qi(6,i,null,a),i.lanes=d,i}function za(i,a,d){return a=qi(4,i.children!==null?i.children:[],i.key,a),a.lanes=d,a.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},a}function Vp(i,a,d,v,I){this.tag=a,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gr(0),this.expirationTimes=gr(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gr(0),this.identifierPrefix=v,this.onRecoverableError=I,this.mutableSourceEagerHydrationData=null}function Mc(i,a,d,v,I,M,$,ae,pe){return i=new Vp(i,a,d,ae,pe),a===1?(a=1,M===!0&&(a|=8)):a=0,M=qi(3,null,null,a),i.current=M,M.stateNode=i,M.memoizedState={element:v,isDehydrated:d,cache:null,transitions:null,pendingSuspenseBoundaries:null},Pa(M),i}function Bf(i,a,d){var v=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:He,key:v==null?null:""+v,children:i,containerInfo:a,implementation:d}}function Up(i){if(!i)return Ea;i=i._reactInternals;e:{if(Wt(i)!==i||i.tag!==1)throw Error(b(170));var a=i;do{switch(a.tag){case 3:a=a.stateNode.context;break e;case 1:if(Cn(a.type)){a=a.stateNode.__reactInternalMemoizedMergedChildContext;break e}}a=a.return}while(a!==null);throw Error(b(171))}if(i.tag===1){var d=i.type;if(Cn(d))return zo(i,d,a)}return a}function Ac(i,a,d,v,I,M,$,ae,pe){return i=Mc(d,v,!0,i,I,M,$,ae,pe),i.context=Up(null),d=i.current,v=Ei(),I=Zo(d),M=Oi(v,I),M.callback=a??null,zs(d,M,I),i.current.lanes=I,Va(i,I,v),$i(i,v),i}function bu(i,a,d,v){var I=a.current,M=Ei(),$=Zo(I);return d=Up(d),a.context===null?a.context=d:a.pendingContext=d,a=Oi(M,$),a.payload={element:i},v=v===void 0?null:v,v!==null&&(a.callback=v),i=zs(I,a,$),i!==null&&(ia(i,I,$,M),Hn(i,I,$)),$}function zh(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function Dh(i,a){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var d=i.retryLane;i.retryLane=d!==0&&d<a?d:a}}function zc(i,a){Dh(i,a),(i=i.alternate)&&Dh(i,a)}function Su(){return null}var zd=typeof reportError=="function"?reportError:function(i){console.error(i)};function Lh(i){this._internalRoot=i}ku.prototype.render=Lh.prototype.render=function(i){var a=this._internalRoot;if(a===null)throw Error(b(409));bu(i,a,null,null)},ku.prototype.unmount=Lh.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var a=i.containerInfo;no(function(){bu(null,i,null,null)}),a[as]=null}};function ku(i){this._internalRoot=i}ku.prototype.unstable_scheduleHydration=function(i){if(i){var a=Lu();i={blockedOn:null,target:i,priority:a};for(var d=0;d<ts.length&&a!==0&&a<ts[d].priority;d++);ts.splice(d,0,i),d===0&&Bu(i)}};function Rh(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function Dl(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function Dd(){}function Ff(i,a,d,v,I){if(I){if(typeof v=="function"){var M=v;v=function(){var Ce=zh($);M.call(Ce)}}var $=Ac(a,v,i,0,null,!1,!1,"",Dd);return i._reactRootContainer=$,i[as]=$.current,Xs(i.nodeType===8?i.parentNode:i),no(),$}for(;I=i.lastChild;)i.removeChild(I);if(typeof v=="function"){var ae=v;v=function(){var Ce=zh(pe);ae.call(Ce)}}var pe=Mc(i,0,!1,null,null,!1,!1,"",Dd);return i._reactRootContainer=pe,i[as]=pe.current,Xs(i.nodeType===8?i.parentNode:i),no(function(){bu(a,pe,d,v)}),pe}function Bh(i,a,d,v,I){var M=d._reactRootContainer;if(M){var $=M;if(typeof I=="function"){var ae=I;I=function(){var pe=zh($);ae.call(pe)}}bu(a,$,i,I)}else $=Ff(d,a,i,I,v);return zh($)}fo=function(i){switch(i.tag){case 3:var a=i.stateNode;if(a.current.memoizedState.isDehydrated){var d=ja(a.pendingLanes);d!==0&&(ma(a,d|1),$i(a,Vt()),(vr&6)===0&&(Kr=Vt()+500,f()))}break;case 13:no(function(){var v=ai(i,1);if(v!==null){var I=Ei();ia(v,i,1,I)}}),zc(i,1)}},mo=function(i){if(i.tag===13){var a=ai(i,134217728);if(a!==null){var d=Ei();ia(a,i,134217728,d)}zc(i,134217728)}},Ua=function(i){if(i.tag===13){var a=Zo(i),d=ai(i,a);if(d!==null){var v=Ei();ia(d,i,a,v)}zc(i,a)}},Lu=function(){return Sr},qc=function(i,a){var d=Sr;try{return Sr=i,a()}finally{Sr=d}},Qi=function(i,a,d){switch(a){case"input":if(Ns(i,d),a=d.name,d.type==="radio"&&a!=null){for(d=i;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll("input[name="+JSON.stringify(""+a)+'][type="radio"]'),a=0;a<d.length;a++){var v=d[a];if(v!==i&&v.form===i.form){var I=xl(v);if(!I)throw Error(b(90));ws(v),Ns(v,I)}}}break;case"textarea":Ba(i,d);break;case"select":a=d.value,a!=null&&Ss(i,!!d.multiple,a,!1)}},H=Mh,ee=no;var $p={usingClientEntryPoint:!1,Events:[vl,os,xl,j,N,Mh]},Dc={findFiberByHostInstance:Qs,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Of={bundleType:Dc.bundleType,version:Dc.version,rendererPackageName:Dc.rendererPackageName,rendererConfig:Dc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:et.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=br(i),i===null?null:i.stateNode},findFiberByHostInstance:Dc.findFiberByHostInstance||Su,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Fh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Fh.isDisabled&&Fh.supportsFiber)try{Bn=Fh.inject(Of),qn=Fh}catch{}}return Fs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=$p,Fs.createPortal=function(i,a){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Rh(a))throw Error(b(200));return Bf(i,a,null,d)},Fs.createRoot=function(i,a){if(!Rh(i))throw Error(b(299));var d=!1,v="",I=zd;return a!=null&&(a.unstable_strictMode===!0&&(d=!0),a.identifierPrefix!==void 0&&(v=a.identifierPrefix),a.onRecoverableError!==void 0&&(I=a.onRecoverableError)),a=Mc(i,1,!1,null,null,d,!1,v,I),i[as]=a.current,Xs(i.nodeType===8?i.parentNode:i),new Lh(a)},Fs.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var a=i._reactInternals;if(a===void 0)throw typeof i.render=="function"?Error(b(188)):(i=Object.keys(i).join(","),Error(b(268,i)));return i=br(a),i=i===null?null:i.stateNode,i},Fs.flushSync=function(i){return no(i)},Fs.hydrate=function(i,a,d){if(!Dl(a))throw Error(b(200));return Bh(null,i,a,!0,d)},Fs.hydrateRoot=function(i,a,d){if(!Rh(i))throw Error(b(405));var v=d!=null&&d.hydratedSources||null,I=!1,M="",$=zd;if(d!=null&&(d.unstable_strictMode===!0&&(I=!0),d.identifierPrefix!==void 0&&(M=d.identifierPrefix),d.onRecoverableError!==void 0&&($=d.onRecoverableError)),a=Ac(a,null,i,1,d??null,I,!1,M,$),i[as]=a.current,Xs(i),v)for(i=0;i<v.length;i++)d=v[i],I=d._getVersion,I=I(d._source),a.mutableSourceEagerHydrationData==null?a.mutableSourceEagerHydrationData=[d,I]:a.mutableSourceEagerHydrationData.push(d,I);return new ku(a)},Fs.render=function(i,a,d){if(!Dl(a))throw Error(b(200));return Bh(null,i,a,!1,d)},Fs.unmountComponentAtNode=function(i){if(!Dl(i))throw Error(b(40));return i._reactRootContainer?(no(function(){Bh(null,null,i,!1,function(){i._reactRootContainer=null,i[as]=null})}),!0):!1},Fs.unstable_batchedUpdates=Mh,Fs.unstable_renderSubtreeIntoContainer=function(i,a,d,v){if(!Dl(d))throw Error(b(200));if(i==null||i._reactInternals===void 0)throw Error(b(38));return Bh(i,a,d,!1,v)},Fs.version="18.3.1-next-f1338f8080-20240426",Fs}var xg;function Yy(){if(xg)return Qf.exports;xg=1;function _(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(_)}catch(y){console.error(y)}}return _(),Qf.exports=Xy(),Qf.exports}var wg;function Jy(){if(wg)return Xp;wg=1;var _=Yy();return Xp.createRoot=_.createRoot,Xp.hydrateRoot=_.hydrateRoot,Xp}var Qy=Jy();const e_=Om(Qy),hn=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Vn=Object.keys,Xi=Array.isArray;function xs(_,y){return typeof y!="object"||Vn(y).forEach((function(b){_[b]=y[b]})),_}typeof Promise>"u"||hn.Promise||(hn.Promise=Promise);const Xd=Object.getPrototypeOf,t_={}.hasOwnProperty;function da(_,y){return t_.call(_,y)}function Wh(_,y){typeof y=="function"&&(y=y(Xd(_))),(typeof Reflect>"u"?Vn:Reflect.ownKeys)(y).forEach((b=>{jl(_,b,y[b])}))}const $g=Object.defineProperty;function jl(_,y,b,C){$g(_,y,xs(b&&da(b,"get")&&typeof b.get=="function"?{get:b.get,set:b.set,configurable:!0}:{value:b,configurable:!0,writable:!0},C))}function Gh(_){return{from:function(y){return _.prototype=Object.create(y.prototype),jl(_.prototype,"constructor",_),{extend:Wh.bind(null,_.prototype)}}}}const r_=Object.getOwnPropertyDescriptor;function jm(_,y){let b;return r_(_,y)||(b=Xd(_))&&jm(b,y)}const n_=[].slice;function yf(_,y,b){return n_.call(_,y,b)}function qg(_,y){return y(_)}function Vd(_){if(!_)throw new Error("Assertion Failed")}function Zg(_){hn.setImmediate?setImmediate(_):setTimeout(_,0)}function Gg(_,y){return _.reduce(((b,C,D)=>{var F=y(C,D);return F&&(b[F[0]]=F[1]),b}),{})}function Vl(_,y){if(typeof y=="string"&&da(_,y))return _[y];if(!y)return _;if(typeof y!="string"){for(var b=[],C=0,D=y.length;C<D;++C){var F=Vl(_,y[C]);b.push(F)}return b}var T=y.indexOf(".");if(T!==-1){var h=_[y.substr(0,T)];return h==null?void 0:Vl(h,y.substr(T+1))}}function uo(_,y,b){if(_&&y!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(_)))if(typeof y!="string"&&"length"in y){Vd(typeof b!="string"&&"length"in b);for(var C=0,D=y.length;C<D;++C)uo(_,y[C],b[C])}else{var F=y.indexOf(".");if(F!==-1){var T=y.substr(0,F),h=y.substr(F+1);if(h==="")b===void 0?Xi(_)&&!isNaN(parseInt(T))?_.splice(T,1):delete _[T]:_[T]=b;else{var W=_[T];W&&da(_,T)||(W=_[T]={}),uo(W,h,b)}}else b===void 0?Xi(_)&&!isNaN(parseInt(y))?_.splice(y,1):delete _[y]:_[y]=b}}function Hg(_){var y={};for(var b in _)da(_,b)&&(y[b]=_[b]);return y}const i_=[].concat;function Kg(_){return i_.apply([],_)}const Wg="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Kg([8,16,32,64].map((_=>["Int","Uint","Float"].map((y=>y+_+"Array")))))).filter((_=>hn[_])),s_=Wg.map((_=>hn[_]));Gg(Wg,(_=>[_,!0]));let Eu=null;function np(_){Eu=typeof WeakMap<"u"&&new WeakMap;const y=hm(_);return Eu=null,y}function hm(_){if(!_||typeof _!="object")return _;let y=Eu&&Eu.get(_);if(y)return y;if(Xi(_)){y=[],Eu&&Eu.set(_,y);for(var b=0,C=_.length;b<C;++b)y.push(hm(_[b]))}else if(s_.indexOf(_.constructor)>=0)y=_;else{const F=Xd(_);for(var D in y=F===Object.prototype?{}:Object.create(F),Eu&&Eu.set(_,y),_)da(_,D)&&(y[D]=hm(_[D]))}return y}const{toString:a_}={};function dm(_){return a_.call(_).slice(8,-1)}const pm=typeof Symbol<"u"?Symbol.iterator:"@@iterator",o_=typeof pm=="symbol"?function(_){var y;return _!=null&&(y=_[pm])&&y.apply(_)}:function(){return null},qh={};function Ol(_){var y,b,C,D;if(arguments.length===1){if(Xi(_))return _.slice();if(this===qh&&typeof _=="string")return[_];if(D=o_(_)){for(b=[];!(C=D.next()).done;)b.push(C.value);return b}if(_==null)return[_];if(typeof(y=_.length)=="number"){for(b=new Array(y);y--;)b[y]=_[y];return b}return[_]}for(y=arguments.length,b=new Array(y);y--;)b[y]=arguments[y];return b}const Vm=typeof Symbol<"u"?_=>_[Symbol.toStringTag]==="AsyncFunction":()=>!1;var el=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Xg(_,y){el=_,Yg=y}var Yg=()=>!0;const l_=!new Error("").stack;function $c(){if(l_)try{throw $c.arguments,new Error}catch(_){return _}return new Error}function fm(_,y){var b=_.stack;return b?(y=y||0,b.indexOf(_.name)===0&&(y+=(_.name+_.message).split(`
`).length),b.split(`
`).slice(y).filter(Yg).map((C=>`
`+C)).join("")):""}var Jg=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Um=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Jg),u_={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Hh(_,y){this._e=$c(),this.name=_,this.message=y}function Qg(_,y){return _+". Errors: "+Object.keys(y).map((b=>y[b].toString())).filter(((b,C,D)=>D.indexOf(b)===C)).join(`
`)}function _f(_,y,b,C){this._e=$c(),this.failures=y,this.failedKeys=C,this.successCount=b,this.message=Qg(_,y)}function Zd(_,y){this._e=$c(),this.name="BulkError",this.failures=Object.keys(y).map((b=>y[b])),this.failuresByPos=y,this.message=Qg(_,y)}Gh(Hh).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+fm(this._e,2))}},toString:function(){return this.name+": "+this.message}}),Gh(_f).from(Hh),Gh(Zd).from(Hh);var $m=Um.reduce(((_,y)=>(_[y]=y+"Error",_)),{});const c_=Hh;var er=Um.reduce(((_,y)=>{var b=y+"Error";function C(D,F){this._e=$c(),this.name=b,D?typeof D=="string"?(this.message=`${D}${F?`
 `+F:""}`,this.inner=F||null):typeof D=="object"&&(this.message=`${D.name} ${D.message}`,this.inner=D):(this.message=u_[y]||b,this.inner=null)}return Gh(C).from(c_),_[y]=C,_}),{});er.Syntax=SyntaxError,er.Type=TypeError,er.Range=RangeError;var bg=Jg.reduce(((_,y)=>(_[y+"Error"]=er[y],_)),{}),uf=Um.reduce(((_,y)=>(["Syntax","Type","Range"].indexOf(y)===-1&&(_[y+"Error"]=er[y]),_)),{});function en(){}function Yd(_){return _}function h_(_,y){return _==null||_===Yd?y:function(b){return y(_(b))}}function Vc(_,y){return function(){_.apply(this,arguments),y.apply(this,arguments)}}function d_(_,y){return _===en?y:function(){var b=_.apply(this,arguments);b!==void 0&&(arguments[0]=b);var C=this.onsuccess,D=this.onerror;this.onsuccess=null,this.onerror=null;var F=y.apply(this,arguments);return C&&(this.onsuccess=this.onsuccess?Vc(C,this.onsuccess):C),D&&(this.onerror=this.onerror?Vc(D,this.onerror):D),F!==void 0?F:b}}function p_(_,y){return _===en?y:function(){_.apply(this,arguments);var b=this.onsuccess,C=this.onerror;this.onsuccess=this.onerror=null,y.apply(this,arguments),b&&(this.onsuccess=this.onsuccess?Vc(b,this.onsuccess):b),C&&(this.onerror=this.onerror?Vc(C,this.onerror):C)}}function f_(_,y){return _===en?y:function(b){var C=_.apply(this,arguments);xs(b,C);var D=this.onsuccess,F=this.onerror;this.onsuccess=null,this.onerror=null;var T=y.apply(this,arguments);return D&&(this.onsuccess=this.onsuccess?Vc(D,this.onsuccess):D),F&&(this.onerror=this.onerror?Vc(F,this.onerror):F),C===void 0?T===void 0?void 0:T:xs(C,T)}}function m_(_,y){return _===en?y:function(){return y.apply(this,arguments)!==!1&&_.apply(this,arguments)}}function qm(_,y){return _===en?y:function(){var b=_.apply(this,arguments);if(b&&typeof b.then=="function"){for(var C=this,D=arguments.length,F=new Array(D);D--;)F[D]=arguments[D];return b.then((function(){return y.apply(C,F)}))}return y.apply(this,arguments)}}uf.ModifyError=_f,uf.DexieError=Hh,uf.BulkError=Zd;var Jd={};const ey=100,[mm,vf,gm]=typeof Promise>"u"?[]:(()=>{let _=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[_,Xd(_),_];const y=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[y,Xd(y),_]})(),ty=vf&&vf.then,cf=mm&&mm.constructor,Zm=!!gm;var ym=!1,g_=gm?()=>{gm.then(Yp)}:hn.setImmediate?setImmediate.bind(null,Yp):hn.MutationObserver?()=>{var _=document.createElement("div");new MutationObserver((()=>{Yp(),_=null})).observe(_,{attributes:!0}),_.setAttribute("i","1")}:()=>{setTimeout(Yp,0)},Gd=function(_,y){Ud.push([_,y]),xf&&(g_(),xf=!1)},_m=!0,xf=!0,Oc=[],hf=[],vm=null,xm=Yd,Kh={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Tg,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach((_=>{try{Tg(_[0],_[1])}catch{}}))}},qt=Kh,Ud=[],Nc=0,df=[];function Et(_){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=en,this._lib=!1;var y=this._PSD=qt;if(el&&(this._stackHolder=$c(),this._prev=null,this._numPrev=0),typeof _!="function"){if(_!==Jd)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&bm(this,this._value))}this._state=null,this._value=null,++y.ref,ny(this,_)}const wm={get:function(){var _=qt,y=wf;function b(C,D){var F=!_.global&&(_!==qt||y!==wf);const T=F&&!Ul();var h=new Et(((W,ue)=>{Gm(this,new ry(bf(C,_,F,T),bf(D,_,F,T),W,ue,_))}));return el&&ay(h,this),h}return b.prototype=Jd,b},set:function(_){jl(this,"then",_&&_.prototype===Jd?wm:{get:function(){return _},set:wm.set})}};function ry(_,y,b,C,D){this.onFulfilled=typeof _=="function"?_:null,this.onRejected=typeof y=="function"?y:null,this.resolve=b,this.reject=C,this.psd=D}function ny(_,y){try{y((b=>{if(_._state===null){if(b===_)throw new TypeError("A promise cannot be resolved with itself.");var C=_._lib&&ip();b&&typeof b.then=="function"?ny(_,((D,F)=>{b instanceof Et?b._then(D,F):b.then(D,F)})):(_._state=!0,_._value=b,iy(_)),C&&sp()}}),bm.bind(null,_))}catch(b){bm(_,b)}}function bm(_,y){if(hf.push(y),_._state===null){var b=_._lib&&ip();y=xm(y),_._state=!1,_._value=y,el&&y!==null&&typeof y=="object"&&!y._promise&&(function(C,D,F){try{C.apply(null,F)}catch{}})((()=>{var C=jm(y,"stack");y._promise=_,jl(y,"stack",{get:()=>ym?C&&(C.get?C.get.apply(y):C.value):_.stack})})),(function(C){Oc.some((D=>D._value===C._value))||Oc.push(C)})(_),iy(_),b&&sp()}}function iy(_){var y=_._listeners;_._listeners=[];for(var b=0,C=y.length;b<C;++b)Gm(_,y[b]);var D=_._PSD;--D.ref||D.finalize(),Nc===0&&(++Nc,Gd((()=>{--Nc==0&&Hm()}),[]))}function Gm(_,y){if(_._state!==null){var b=_._state?y.onFulfilled:y.onRejected;if(b===null)return(_._state?y.resolve:y.reject)(_._value);++y.psd.ref,++Nc,Gd(y_,[b,_,y])}else _._listeners.push(y)}function y_(_,y,b){try{vm=y;var C,D=y._value;y._state?C=_(D):(hf.length&&(hf=[]),C=_(D),hf.indexOf(D)===-1&&(function(F){for(var T=Oc.length;T;)if(Oc[--T]._value===F._value)return void Oc.splice(T,1)})(y)),b.resolve(C)}catch(F){b.reject(F)}finally{vm=null,--Nc==0&&Hm(),--b.psd.ref||b.psd.finalize()}}function sy(_,y,b){if(y.length===b)return y;var C="";if(_._state===!1){var D,F,T=_._value;T!=null?(D=T.name||"Error",F=T.message||T,C=fm(T,0)):(D=T,F=""),y.push(D+(F?": "+F:"")+C)}return el&&((C=fm(_._stackHolder,2))&&y.indexOf(C)===-1&&y.push(C),_._prev&&sy(_._prev,y,b)),y}function ay(_,y){var b=y?y._numPrev+1:0;b<100&&(_._prev=y,_._numPrev=b)}function Yp(){ip()&&sp()}function ip(){var _=_m;return _m=!1,xf=!1,_}function sp(){var _,y,b;do for(;Ud.length>0;)for(_=Ud,Ud=[],b=_.length,y=0;y<b;++y){var C=_[y];C[0].apply(null,C[1])}while(Ud.length>0);_m=!0,xf=!0}function Hm(){var _=Oc;Oc=[],_.forEach((C=>{C._PSD.onunhandled.call(null,C._value,C)}));for(var y=df.slice(0),b=y.length;b;)y[--b]()}function Jp(_){return new Et(Jd,!1,_)}function fn(_,y){var b=qt;return function(){var C=ip(),D=qt;try{return Mu(b,!0),_.apply(this,arguments)}catch(F){y&&y(F)}finally{Mu(D,!1),C&&sp()}}}Wh(Et.prototype,{then:wm,_then:function(_,y){Gm(this,new ry(null,null,_,y,qt))},catch:function(_){if(arguments.length===1)return this.then(null,_);var y=arguments[0],b=arguments[1];return typeof y=="function"?this.then(null,(C=>C instanceof y?b(C):Jp(C))):this.then(null,(C=>C&&C.name===y?b(C):Jp(C)))},finally:function(_){return this.then((y=>(_(),y)),(y=>(_(),Jp(y))))},stack:{get:function(){if(this._stack)return this._stack;try{ym=!0;var _=sy(this,[],20).join(`
From previous: `);return this._state!==null&&(this._stack=_),_}finally{ym=!1}}},timeout:function(_,y){return _<1/0?new Et(((b,C)=>{var D=setTimeout((()=>C(new er.Timeout(y))),_);this.then(b,C).finally(clearTimeout.bind(null,D))})):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&jl(Et.prototype,Symbol.toStringTag,"Dexie.Promise"),Kh.env=oy(),Wh(Et,{all:function(){var _=Ol.apply(null,arguments).map(Qp);return new Et((function(y,b){_.length===0&&y([]);var C=_.length;_.forEach(((D,F)=>Et.resolve(D).then((T=>{_[F]=T,--C||y(_)}),b)))}))},resolve:_=>{if(_ instanceof Et)return _;if(_&&typeof _.then=="function")return new Et(((b,C)=>{_.then(b,C)}));var y=new Et(Jd,!0,_);return ay(y,vm),y},reject:Jp,race:function(){var _=Ol.apply(null,arguments).map(Qp);return new Et(((y,b)=>{_.map((C=>Et.resolve(C).then(y,b)))}))},PSD:{get:()=>qt,set:_=>qt=_},totalEchoes:{get:()=>wf},newPSD:Cu,usePSD:Yh,scheduler:{get:()=>Gd,set:_=>{Gd=_}},rejectionMapper:{get:()=>xm,set:_=>{xm=_}},follow:(_,y)=>new Et(((b,C)=>Cu(((D,F)=>{var T=qt;T.unhandleds=[],T.onunhandled=F,T.finalize=Vc((function(){(function(h){function W(){h(),df.splice(df.indexOf(W),1)}df.push(W),++Nc,Gd((()=>{--Nc==0&&Hm()}),[])})((()=>{this.unhandleds.length===0?D():F(this.unhandleds[0])}))}),T.finalize),_()}),y,b,C)))}),cf&&(cf.allSettled&&jl(Et,"allSettled",(function(){const _=Ol.apply(null,arguments).map(Qp);return new Et((y=>{_.length===0&&y([]);let b=_.length;const C=new Array(b);_.forEach(((D,F)=>Et.resolve(D).then((T=>C[F]={status:"fulfilled",value:T}),(T=>C[F]={status:"rejected",reason:T})).then((()=>--b||y(C)))))}))})),cf.any&&typeof AggregateError<"u"&&jl(Et,"any",(function(){const _=Ol.apply(null,arguments).map(Qp);return new Et(((y,b)=>{_.length===0&&b(new AggregateError([]));let C=_.length;const D=new Array(C);_.forEach(((F,T)=>Et.resolve(F).then((h=>y(h)),(h=>{D[T]=h,--C||b(new AggregateError(D))}))))}))})));const Wi={awaits:0,echoes:0,id:0};var __=0,pf=[],rm=0,wf=0,v_=0;function Cu(_,y,b,C){var D=qt,F=Object.create(D);F.parent=D,F.ref=0,F.global=!1,F.id=++v_;var T=Kh.env;F.env=Zm?{Promise:Et,PromiseProp:{value:Et,configurable:!0,writable:!0},all:Et.all,race:Et.race,allSettled:Et.allSettled,any:Et.any,resolve:Et.resolve,reject:Et.reject,nthen:Sg(T.nthen,F),gthen:Sg(T.gthen,F)}:{},y&&xs(F,y),++D.ref,F.finalize=function(){--this.parent.ref||this.parent.finalize()};var h=Yh(F,_,b,C);return F.ref===0&&F.finalize(),h}function Xh(){return Wi.id||(Wi.id=++__),++Wi.awaits,Wi.echoes+=ey,Wi.id}function Ul(){return!!Wi.awaits&&(--Wi.awaits==0&&(Wi.id=0),Wi.echoes=Wi.awaits*ey,!0)}function Qp(_){return Wi.echoes&&_&&_.constructor===cf?(Xh(),_.then((y=>(Ul(),y)),(y=>(Ul(),Yn(y))))):_}function x_(_){++wf,Wi.echoes&&--Wi.echoes!=0||(Wi.echoes=Wi.id=0),pf.push(qt),Mu(_,!0)}function w_(){var _=pf[pf.length-1];pf.pop(),Mu(_,!1)}function Mu(_,y){var b=qt;if((y?!Wi.echoes||rm++&&_===qt:!rm||--rm&&_===qt)||ly(y?x_.bind(null,_):w_),_!==qt&&(qt=_,b===Kh&&(Kh.env=oy()),Zm)){var C=Kh.env.Promise,D=_.env;vf.then=D.nthen,C.prototype.then=D.gthen,(b.global||_.global)&&(Object.defineProperty(hn,"Promise",D.PromiseProp),C.all=D.all,C.race=D.race,C.resolve=D.resolve,C.reject=D.reject,D.allSettled&&(C.allSettled=D.allSettled),D.any&&(C.any=D.any))}}function oy(){var _=hn.Promise;return Zm?{Promise:_,PromiseProp:Object.getOwnPropertyDescriptor(hn,"Promise"),all:_.all,race:_.race,allSettled:_.allSettled,any:_.any,resolve:_.resolve,reject:_.reject,nthen:vf.then,gthen:_.prototype.then}:{}}function Yh(_,y,b,C,D){var F=qt;try{return Mu(_,!0),y(b,C,D)}finally{Mu(F,!1)}}function ly(_){ty.call(mm,_)}function bf(_,y,b,C){return typeof _!="function"?_:function(){var D=qt;b&&Xh(),Mu(y,!0);try{return _.apply(this,arguments)}finally{Mu(D,!1),C&&ly(Ul)}}}function Sg(_,y){return function(b,C){return _.call(this,bf(b,y),bf(C,y))}}(""+ty).indexOf("[native code]")===-1&&(Xh=Ul=en);const kg="unhandledrejection";function Tg(_,y){var b;try{b=y.onuncatched(_)}catch{}if(b!==!1)try{var C,D={promise:y,reason:_};if(hn.document&&document.createEvent?((C=document.createEvent("Event")).initEvent(kg,!0,!0),xs(C,D)):hn.CustomEvent&&xs(C=new CustomEvent(kg,{detail:D}),D),C&&hn.dispatchEvent&&(dispatchEvent(C),!hn.PromiseRejectionEvent&&hn.onunhandledrejection))try{hn.onunhandledrejection(C)}catch{}el&&C&&!C.defaultPrevented&&console.warn(`Unhandled rejection: ${_.stack||_}`)}catch{}}var Yn=Et.reject;function Sm(_,y,b,C){if(_.idbdb&&(_._state.openComplete||qt.letThrough||_._vip)){var D=_._createTransaction(y,b,_._dbSchema);try{D.create(),_._state.PR1398_maxLoop=3}catch(F){return F.name===$m.InvalidState&&_.isOpen()&&--_._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),_._close(),_.open().then((()=>Sm(_,y,b,C)))):Yn(F)}return D._promise(y,((F,T)=>Cu((()=>(qt.trans=D,C(F,T,D)))))).then((F=>D._completion.then((()=>F))))}if(_._state.openComplete)return Yn(new er.DatabaseClosed(_._state.dbOpenError));if(!_._state.isBeingOpened){if(!_._options.autoOpen)return Yn(new er.DatabaseClosed);_.open().catch(en)}return _._state.dbReadyPromise.then((()=>Sm(_,y,b,C)))}const Ig="3.2.7",Fc="",km=-1/0,Bl="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",uy="String expected.",Hd=[],Tf=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),b_=Tf,S_=Tf,cy=_=>!/(dexie\.js|dexie\.min\.js)/.test(_),If="__dbnames",nm="readonly",im="readwrite";function Uc(_,y){return _?y?function(){return _.apply(this,arguments)&&y.apply(this,arguments)}:_:y}const hy={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function ef(_){return typeof _!="string"||/\./.test(_)?y=>y:y=>(y[_]===void 0&&_ in y&&delete(y=np(y))[_],y)}class k_{_trans(y,b,C){const D=this._tx||qt.trans,F=this.name;function T(W,ue,ne){if(!ne.schema[F])throw new er.NotFound("Table "+F+" not part of transaction");return b(ne.idbtrans,ne)}const h=ip();try{return D&&D.db===this.db?D===qt.trans?D._promise(y,T,C):Cu((()=>D._promise(y,T,C)),{trans:D,transless:qt.transless||qt}):Sm(this.db,y,[this.name],T)}finally{h&&sp()}}get(y,b){return y&&y.constructor===Object?this.where(y).first(b):this._trans("readonly",(C=>this.core.get({trans:C,key:y}).then((D=>this.hook.reading.fire(D))))).then(b)}where(y){if(typeof y=="string")return new this.db.WhereClause(this,y);if(Xi(y))return new this.db.WhereClause(this,`[${y.join("+")}]`);const b=Vn(y);if(b.length===1)return this.where(b[0]).equals(y[b[0]]);const C=this.schema.indexes.concat(this.schema.primKey).filter((ue=>{if(ue.compound&&b.every((ne=>ue.keyPath.indexOf(ne)>=0))){for(let ne=0;ne<b.length;++ne)if(b.indexOf(ue.keyPath[ne])===-1)return!1;return!0}return!1})).sort(((ue,ne)=>ue.keyPath.length-ne.keyPath.length))[0];if(C&&this.db._maxKey!==Fc){const ue=C.keyPath.slice(0,b.length);return this.where(ue).equals(ue.map((ne=>y[ne])))}!C&&el&&console.warn(`The query ${JSON.stringify(y)} on ${this.name} would benefit of a compound index [${b.join("+")}]`);const{idxByName:D}=this.schema,F=this.db._deps.indexedDB;function T(ue,ne){try{return F.cmp(ue,ne)===0}catch{return!1}}const[h,W]=b.reduce((([ue,ne],Y)=>{const Z=D[Y],Ie=y[Y];return[ue||Z,ue||!Z?Uc(ne,Z&&Z.multi?Re=>{const Pe=Vl(Re,Y);return Xi(Pe)&&Pe.some((Le=>T(Ie,Le)))}:Re=>T(Ie,Vl(Re,Y))):ne]}),[null,null]);return h?this.where(h.name).equals(y[h.keyPath]).filter(W):C?this.filter(W):this.where(b).equals("")}filter(y){return this.toCollection().and(y)}count(y){return this.toCollection().count(y)}offset(y){return this.toCollection().offset(y)}limit(y){return this.toCollection().limit(y)}each(y){return this.toCollection().each(y)}toArray(y){return this.toCollection().toArray(y)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(y){return new this.db.Collection(new this.db.WhereClause(this,Xi(y)?`[${y.join("+")}]`:y))}reverse(){return this.toCollection().reverse()}mapToClass(y){this.schema.mappedClass=y;const b=C=>{if(!C)return C;const D=Object.create(y.prototype);for(var F in C)if(da(C,F))try{D[F]=C[F]}catch{}return D};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=b,this.hook("reading",b),y}defineClass(){return this.mapToClass((function(y){xs(this,y)}))}add(y,b){const{auto:C,keyPath:D}=this.schema.primKey;let F=y;return D&&C&&(F=ef(D)(y)),this._trans("readwrite",(T=>this.core.mutate({trans:T,type:"add",keys:b!=null?[b]:null,values:[F]}))).then((T=>T.numFailures?Et.reject(T.failures[0]):T.lastResult)).then((T=>{if(D)try{uo(y,D,T)}catch{}return T}))}update(y,b){if(typeof y!="object"||Xi(y))return this.where(":id").equals(y).modify(b);{const C=Vl(y,this.schema.primKey.keyPath);if(C===void 0)return Yn(new er.InvalidArgument("Given object does not contain its primary key"));try{typeof b!="function"?Vn(b).forEach((D=>{uo(y,D,b[D])})):b(y,{value:y,primKey:C})}catch{}return this.where(":id").equals(C).modify(b)}}put(y,b){const{auto:C,keyPath:D}=this.schema.primKey;let F=y;return D&&C&&(F=ef(D)(y)),this._trans("readwrite",(T=>this.core.mutate({trans:T,type:"put",values:[F],keys:b!=null?[b]:null}))).then((T=>T.numFailures?Et.reject(T.failures[0]):T.lastResult)).then((T=>{if(D)try{uo(y,D,T)}catch{}return T}))}delete(y){return this._trans("readwrite",(b=>this.core.mutate({trans:b,type:"delete",keys:[y]}))).then((b=>b.numFailures?Et.reject(b.failures[0]):void 0))}clear(){return this._trans("readwrite",(y=>this.core.mutate({trans:y,type:"deleteRange",range:hy}))).then((y=>y.numFailures?Et.reject(y.failures[0]):void 0))}bulkGet(y){return this._trans("readonly",(b=>this.core.getMany({keys:y,trans:b}).then((C=>C.map((D=>this.hook.reading.fire(D)))))))}bulkAdd(y,b,C){const D=Array.isArray(b)?b:void 0,F=(C=C||(D?void 0:b))?C.allKeys:void 0;return this._trans("readwrite",(T=>{const{auto:h,keyPath:W}=this.schema.primKey;if(W&&D)throw new er.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(D&&D.length!==y.length)throw new er.InvalidArgument("Arguments objects and keys must have the same length");const ue=y.length;let ne=W&&h?y.map(ef(W)):y;return this.core.mutate({trans:T,type:"add",keys:D,values:ne,wantResults:F}).then((({numFailures:Y,results:Z,lastResult:Ie,failures:Re})=>{if(Y===0)return F?Z:Ie;throw new Zd(`${this.name}.bulkAdd(): ${Y} of ${ue} operations failed`,Re)}))}))}bulkPut(y,b,C){const D=Array.isArray(b)?b:void 0,F=(C=C||(D?void 0:b))?C.allKeys:void 0;return this._trans("readwrite",(T=>{const{auto:h,keyPath:W}=this.schema.primKey;if(W&&D)throw new er.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(D&&D.length!==y.length)throw new er.InvalidArgument("Arguments objects and keys must have the same length");const ue=y.length;let ne=W&&h?y.map(ef(W)):y;return this.core.mutate({trans:T,type:"put",keys:D,values:ne,wantResults:F}).then((({numFailures:Y,results:Z,lastResult:Ie,failures:Re})=>{if(Y===0)return F?Z:Ie;throw new Zd(`${this.name}.bulkPut(): ${Y} of ${ue} operations failed`,Re)}))}))}bulkDelete(y){const b=y.length;return this._trans("readwrite",(C=>this.core.mutate({trans:C,type:"delete",keys:y}))).then((({numFailures:C,lastResult:D,failures:F})=>{if(C===0)return D;throw new Zd(`${this.name}.bulkDelete(): ${C} of ${b} operations failed`,F)}))}}function Kd(_){var y={},b=function(T,h){if(h){for(var W=arguments.length,ue=new Array(W-1);--W;)ue[W-1]=arguments[W];return y[T].subscribe.apply(null,ue),_}if(typeof T=="string")return y[T]};b.addEventType=F;for(var C=1,D=arguments.length;C<D;++C)F(arguments[C]);return b;function F(T,h,W){if(typeof T!="object"){var ue;h||(h=m_),W||(W=en);var ne={subscribers:[],fire:W,subscribe:function(Y){ne.subscribers.indexOf(Y)===-1&&(ne.subscribers.push(Y),ne.fire=h(ne.fire,Y))},unsubscribe:function(Y){ne.subscribers=ne.subscribers.filter((function(Z){return Z!==Y})),ne.fire=ne.subscribers.reduce(h,W)}};return y[T]=b[T]=ne,ne}Vn(ue=T).forEach((function(Y){var Z=ue[Y];if(Xi(Z))F(Y,ue[Y][0],ue[Y][1]);else{if(Z!=="asap")throw new er.InvalidArgument("Invalid event config");var Ie=F(Y,Yd,(function(){for(var Re=arguments.length,Pe=new Array(Re);Re--;)Pe[Re]=arguments[Re];Ie.subscribers.forEach((function(Le){Zg((function(){Le.apply(null,Pe)}))}))}))}}))}}function Od(_,y){return Gh(y).from({prototype:_}),y}function Vh(_,y){return!(_.filter||_.algorithm||_.or)&&(y?_.justLimit:!_.replayFilter)}function sm(_,y){_.filter=Uc(_.filter,y)}function am(_,y,b){var C=_.replayFilter;_.replayFilter=C?()=>Uc(C(),y()):y,_.justLimit=b&&!C}function ff(_,y){if(_.isPrimKey)return y.primaryKey;const b=y.getIndexByKeyPath(_.index);if(!b)throw new er.Schema("KeyPath "+_.index+" on object store "+y.name+" is not indexed");return b}function Eg(_,y,b){const C=ff(_,y.schema);return y.openCursor({trans:b,values:!_.keysOnly,reverse:_.dir==="prev",unique:!!_.unique,query:{index:C,range:_.range}})}function tf(_,y,b,C){const D=_.replayFilter?Uc(_.filter,_.replayFilter()):_.filter;if(_.or){const F={},T=(h,W,ue)=>{if(!D||D(W,ue,(Z=>W.stop(Z)),(Z=>W.fail(Z)))){var ne=W.primaryKey,Y=""+ne;Y==="[object ArrayBuffer]"&&(Y=""+new Uint8Array(ne)),da(F,Y)||(F[Y]=!0,y(h,W,ue))}};return Promise.all([_.or._iterate(T,b),Pg(Eg(_,C,b),_.algorithm,T,!_.keysOnly&&_.valueMapper)])}return Pg(Eg(_,C,b),Uc(_.algorithm,D),y,!_.keysOnly&&_.valueMapper)}function Pg(_,y,b,C){var D=fn(C?(F,T,h)=>b(C(F),T,h):b);return _.then((F=>{if(F)return F.start((()=>{var T=()=>F.continue();y&&!y(F,(h=>T=h),(h=>{F.stop(h),T=en}),(h=>{F.fail(h),T=en}))||D(F.value,F,(h=>T=h)),T()}))}))}function vs(_,y){try{const b=Cg(_),C=Cg(y);if(b!==C)return b==="Array"?1:C==="Array"?-1:b==="binary"?1:C==="binary"?-1:b==="string"?1:C==="string"?-1:b==="Date"?1:C!=="Date"?NaN:-1;switch(b){case"number":case"Date":case"string":return _>y?1:_<y?-1:0;case"binary":return(function(D,F){const T=D.length,h=F.length,W=T<h?T:h;for(let ue=0;ue<W;++ue)if(D[ue]!==F[ue])return D[ue]<F[ue]?-1:1;return T===h?0:T<h?-1:1})(Mg(_),Mg(y));case"Array":return(function(D,F){const T=D.length,h=F.length,W=T<h?T:h;for(let ue=0;ue<W;++ue){const ne=vs(D[ue],F[ue]);if(ne!==0)return ne}return T===h?0:T<h?-1:1})(_,y)}}catch{}return NaN}function Cg(_){const y=typeof _;if(y!=="object")return y;if(ArrayBuffer.isView(_))return"binary";const b=dm(_);return b==="ArrayBuffer"?"binary":b}function Mg(_){return _ instanceof Uint8Array?_:ArrayBuffer.isView(_)?new Uint8Array(_.buffer,_.byteOffset,_.byteLength):new Uint8Array(_)}class T_{_read(y,b){var C=this._ctx;return C.error?C.table._trans(null,Yn.bind(null,C.error)):C.table._trans("readonly",y).then(b)}_write(y){var b=this._ctx;return b.error?b.table._trans(null,Yn.bind(null,b.error)):b.table._trans("readwrite",y,"locked")}_addAlgorithm(y){var b=this._ctx;b.algorithm=Uc(b.algorithm,y)}_iterate(y,b){return tf(this._ctx,y,b,this._ctx.table.core)}clone(y){var b=Object.create(this.constructor.prototype),C=Object.create(this._ctx);return y&&xs(C,y),b._ctx=C,b}raw(){return this._ctx.valueMapper=null,this}each(y){var b=this._ctx;return this._read((C=>tf(b,y,C,b.table.core)))}count(y){return this._read((b=>{const C=this._ctx,D=C.table.core;if(Vh(C,!0))return D.count({trans:b,query:{index:ff(C,D.schema),range:C.range}}).then((T=>Math.min(T,C.limit)));var F=0;return tf(C,(()=>(++F,!1)),b,D).then((()=>F))})).then(y)}sortBy(y,b){const C=y.split(".").reverse(),D=C[0],F=C.length-1;function T(ue,ne){return ne?T(ue[C[ne]],ne-1):ue[D]}var h=this._ctx.dir==="next"?1:-1;function W(ue,ne){var Y=T(ue,F),Z=T(ne,F);return Y<Z?-h:Y>Z?h:0}return this.toArray((function(ue){return ue.sort(W)})).then(b)}toArray(y){return this._read((b=>{var C=this._ctx;if(C.dir==="next"&&Vh(C,!0)&&C.limit>0){const{valueMapper:D}=C,F=ff(C,C.table.core.schema);return C.table.core.query({trans:b,limit:C.limit,values:!0,query:{index:F,range:C.range}}).then((({result:T})=>D?T.map(D):T))}{const D=[];return tf(C,(F=>D.push(F)),b,C.table.core).then((()=>D))}}),y)}offset(y){var b=this._ctx;return y<=0||(b.offset+=y,Vh(b)?am(b,(()=>{var C=y;return(D,F)=>C===0||(C===1?(--C,!1):(F((()=>{D.advance(C),C=0})),!1))})):am(b,(()=>{var C=y;return()=>--C<0}))),this}limit(y){return this._ctx.limit=Math.min(this._ctx.limit,y),am(this._ctx,(()=>{var b=y;return function(C,D,F){return--b<=0&&D(F),b>=0}}),!0),this}until(y,b){return sm(this._ctx,(function(C,D,F){return!y(C.value)||(D(F),b)})),this}first(y){return this.limit(1).toArray((function(b){return b[0]})).then(y)}last(y){return this.reverse().first(y)}filter(y){var b,C;return sm(this._ctx,(function(D){return y(D.value)})),b=this._ctx,C=y,b.isMatch=Uc(b.isMatch,C),this}and(y){return this.filter(y)}or(y){return new this.db.WhereClause(this._ctx.table,y,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(y){var b=this._ctx;return b.keysOnly=!b.isMatch,this.each((function(C,D){y(D.key,D)}))}eachUniqueKey(y){return this._ctx.unique="unique",this.eachKey(y)}eachPrimaryKey(y){var b=this._ctx;return b.keysOnly=!b.isMatch,this.each((function(C,D){y(D.primaryKey,D)}))}keys(y){var b=this._ctx;b.keysOnly=!b.isMatch;var C=[];return this.each((function(D,F){C.push(F.key)})).then((function(){return C})).then(y)}primaryKeys(y){var b=this._ctx;if(b.dir==="next"&&Vh(b,!0)&&b.limit>0)return this._read((D=>{var F=ff(b,b.table.core.schema);return b.table.core.query({trans:D,values:!1,limit:b.limit,query:{index:F,range:b.range}})})).then((({result:D})=>D)).then(y);b.keysOnly=!b.isMatch;var C=[];return this.each((function(D,F){C.push(F.primaryKey)})).then((function(){return C})).then(y)}uniqueKeys(y){return this._ctx.unique="unique",this.keys(y)}firstKey(y){return this.limit(1).keys((function(b){return b[0]})).then(y)}lastKey(y){return this.reverse().firstKey(y)}distinct(){var y=this._ctx,b=y.index&&y.table.schema.idxByName[y.index];if(!b||!b.multi)return this;var C={};return sm(this._ctx,(function(D){var F=D.primaryKey.toString(),T=da(C,F);return C[F]=!0,!T})),this}modify(y){var b=this._ctx;return this._write((C=>{var D;if(typeof y=="function")D=y;else{var F=Vn(y),T=F.length;D=function(Pe){for(var Le=!1,De=0;De<T;++De){var ze=F[De],Ue=y[ze];Vl(Pe,ze)!==Ue&&(uo(Pe,ze,Ue),Le=!0)}return Le}}const h=b.table.core,{outbound:W,extractKey:ue}=h.schema.primaryKey,ne=this.db._options.modifyChunkSize||200,Y=[];let Z=0;const Ie=[],Re=(Pe,Le)=>{const{failures:De,numFailures:ze}=Le;Z+=Pe-ze;for(let Ue of Vn(De))Y.push(De[Ue])};return this.clone().primaryKeys().then((Pe=>{const Le=De=>{const ze=Math.min(ne,Pe.length-De);return h.getMany({trans:C,keys:Pe.slice(De,De+ze),cache:"immutable"}).then((Ue=>{const et=[],Je=[],He=W?[]:null,je=[];for(let $e=0;$e<ze;++$e){const ar=Ue[$e],xt={value:np(ar),primKey:Pe[De+$e]};D.call(xt,xt.value,xt)!==!1&&(xt.value==null?je.push(Pe[De+$e]):W||vs(ue(ar),ue(xt.value))===0?(Je.push(xt.value),W&&He.push(Pe[De+$e])):(je.push(Pe[De+$e]),et.push(xt.value)))}const pt=Vh(b)&&b.limit===1/0&&(typeof y!="function"||y===om)&&{index:b.index,range:b.range};return Promise.resolve(et.length>0&&h.mutate({trans:C,type:"add",values:et}).then(($e=>{for(let ar in $e.failures)je.splice(parseInt(ar),1);Re(et.length,$e)}))).then((()=>(Je.length>0||pt&&typeof y=="object")&&h.mutate({trans:C,type:"put",keys:He,values:Je,criteria:pt,changeSpec:typeof y!="function"&&y}).then(($e=>Re(Je.length,$e))))).then((()=>(je.length>0||pt&&y===om)&&h.mutate({trans:C,type:"delete",keys:je,criteria:pt}).then(($e=>Re(je.length,$e))))).then((()=>Pe.length>De+ze&&Le(De+ne)))}))};return Le(0).then((()=>{if(Y.length>0)throw new _f("Error modifying one or more objects",Y,Z,Ie);return Pe.length}))}))}))}delete(){var y=this._ctx,b=y.range;return Vh(y)&&(y.isPrimKey&&!S_||b.type===3)?this._write((C=>{const{primaryKey:D}=y.table.core.schema,F=b;return y.table.core.count({trans:C,query:{index:D,range:F}}).then((T=>y.table.core.mutate({trans:C,type:"deleteRange",range:F}).then((({failures:h,lastResult:W,results:ue,numFailures:ne})=>{if(ne)throw new _f("Could not delete some values",Object.keys(h).map((Y=>h[Y])),T-ne);return T-ne}))))})):this.modify(om)}}const om=(_,y)=>y.value=null;function I_(_,y){return _<y?-1:_===y?0:1}function E_(_,y){return _>y?-1:_===y?0:1}function ha(_,y,b){var C=_ instanceof py?new _.Collection(_):_;return C._ctx.error=b?new b(y):new TypeError(y),C}function Uh(_){return new _.Collection(_,(()=>dy(""))).limit(0)}function P_(_,y,b,C,D,F){for(var T=Math.min(_.length,C.length),h=-1,W=0;W<T;++W){var ue=y[W];if(ue!==C[W])return D(_[W],b[W])<0?_.substr(0,W)+b[W]+b.substr(W+1):D(_[W],C[W])<0?_.substr(0,W)+C[W]+b.substr(W+1):h>=0?_.substr(0,h)+y[h]+b.substr(h+1):null;D(_[W],ue)<0&&(h=W)}return T<C.length&&F==="next"?_+b.substr(_.length):T<_.length&&F==="prev"?_.substr(0,b.length):h<0?null:_.substr(0,h)+C[h]+b.substr(h+1)}function rf(_,y,b,C){var D,F,T,h,W,ue,ne,Y=b.length;if(!b.every((Pe=>typeof Pe=="string")))return ha(_,uy);function Z(Pe){D=(function(De){return De==="next"?ze=>ze.toUpperCase():ze=>ze.toLowerCase()})(Pe),F=(function(De){return De==="next"?ze=>ze.toLowerCase():ze=>ze.toUpperCase()})(Pe),T=Pe==="next"?I_:E_;var Le=b.map((function(De){return{lower:F(De),upper:D(De)}})).sort((function(De,ze){return T(De.lower,ze.lower)}));h=Le.map((function(De){return De.upper})),W=Le.map((function(De){return De.lower})),ue=Pe,ne=Pe==="next"?"":C}Z("next");var Ie=new _.Collection(_,(()=>Iu(h[0],W[Y-1]+C)));Ie._ondirectionchange=function(Pe){Z(Pe)};var Re=0;return Ie._addAlgorithm((function(Pe,Le,De){var ze=Pe.key;if(typeof ze!="string")return!1;var Ue=F(ze);if(y(Ue,W,Re))return!0;for(var et=null,Je=Re;Je<Y;++Je){var He=P_(ze,Ue,h[Je],W[Je],T,ue);He===null&&et===null?Re=Je+1:(et===null||T(et,He)>0)&&(et=He)}return Le(et!==null?function(){Pe.continue(et+ne)}:De),!1})),Ie}function Iu(_,y,b,C){return{type:2,lower:_,upper:y,lowerOpen:b,upperOpen:C}}function dy(_){return{type:1,lower:_,upper:_}}class py{get Collection(){return this._ctx.table.db.Collection}between(y,b,C,D){C=C!==!1,D=D===!0;try{return this._cmp(y,b)>0||this._cmp(y,b)===0&&(C||D)&&(!C||!D)?Uh(this):new this.Collection(this,(()=>Iu(y,b,!C,!D)))}catch{return ha(this,Bl)}}equals(y){return y==null?ha(this,Bl):new this.Collection(this,(()=>dy(y)))}above(y){return y==null?ha(this,Bl):new this.Collection(this,(()=>Iu(y,void 0,!0)))}aboveOrEqual(y){return y==null?ha(this,Bl):new this.Collection(this,(()=>Iu(y,void 0,!1)))}below(y){return y==null?ha(this,Bl):new this.Collection(this,(()=>Iu(void 0,y,!1,!0)))}belowOrEqual(y){return y==null?ha(this,Bl):new this.Collection(this,(()=>Iu(void 0,y)))}startsWith(y){return typeof y!="string"?ha(this,uy):this.between(y,y+Fc,!0,!0)}startsWithIgnoreCase(y){return y===""?this.startsWith(y):rf(this,((b,C)=>b.indexOf(C[0])===0),[y],Fc)}equalsIgnoreCase(y){return rf(this,((b,C)=>b===C[0]),[y],"")}anyOfIgnoreCase(){var y=Ol.apply(qh,arguments);return y.length===0?Uh(this):rf(this,((b,C)=>C.indexOf(b)!==-1),y,"")}startsWithAnyOfIgnoreCase(){var y=Ol.apply(qh,arguments);return y.length===0?Uh(this):rf(this,((b,C)=>C.some((D=>b.indexOf(D)===0))),y,Fc)}anyOf(){const y=Ol.apply(qh,arguments);let b=this._cmp;try{y.sort(b)}catch{return ha(this,Bl)}if(y.length===0)return Uh(this);const C=new this.Collection(this,(()=>Iu(y[0],y[y.length-1])));C._ondirectionchange=F=>{b=F==="next"?this._ascending:this._descending,y.sort(b)};let D=0;return C._addAlgorithm(((F,T,h)=>{const W=F.key;for(;b(W,y[D])>0;)if(++D,D===y.length)return T(h),!1;return b(W,y[D])===0||(T((()=>{F.continue(y[D])})),!1)})),C}notEqual(y){return this.inAnyRange([[km,y],[y,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const y=Ol.apply(qh,arguments);if(y.length===0)return new this.Collection(this);try{y.sort(this._ascending)}catch{return ha(this,Bl)}const b=y.reduce(((C,D)=>C?C.concat([[C[C.length-1][1],D]]):[[km,D]]),null);return b.push([y[y.length-1],this.db._maxKey]),this.inAnyRange(b,{includeLowers:!1,includeUppers:!1})}inAnyRange(y,b){const C=this._cmp,D=this._ascending,F=this._descending,T=this._min,h=this._max;if(y.length===0)return Uh(this);if(!y.every((ze=>ze[0]!==void 0&&ze[1]!==void 0&&D(ze[0],ze[1])<=0)))return ha(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",er.InvalidArgument);const W=!b||b.includeLowers!==!1,ue=b&&b.includeUppers===!0;let ne,Y=D;function Z(ze,Ue){return Y(ze[0],Ue[0])}try{ne=y.reduce((function(ze,Ue){let et=0,Je=ze.length;for(;et<Je;++et){const He=ze[et];if(C(Ue[0],He[1])<0&&C(Ue[1],He[0])>0){He[0]=T(He[0],Ue[0]),He[1]=h(He[1],Ue[1]);break}}return et===Je&&ze.push(Ue),ze}),[]),ne.sort(Z)}catch{return ha(this,Bl)}let Ie=0;const Re=ue?ze=>D(ze,ne[Ie][1])>0:ze=>D(ze,ne[Ie][1])>=0,Pe=W?ze=>F(ze,ne[Ie][0])>0:ze=>F(ze,ne[Ie][0])>=0;let Le=Re;const De=new this.Collection(this,(()=>Iu(ne[0][0],ne[ne.length-1][1],!W,!ue)));return De._ondirectionchange=ze=>{ze==="next"?(Le=Re,Y=D):(Le=Pe,Y=F),ne.sort(Z)},De._addAlgorithm(((ze,Ue,et)=>{for(var Je=ze.key;Le(Je);)if(++Ie,Ie===ne.length)return Ue(et),!1;return!!(function(He){return!Re(He)&&!Pe(He)})(Je)||(this._cmp(Je,ne[Ie][1])===0||this._cmp(Je,ne[Ie][0])===0||Ue((()=>{Y===D?ze.continue(ne[Ie][0]):ze.continue(ne[Ie][1])})),!1)})),De}startsWithAnyOf(){const y=Ol.apply(qh,arguments);return y.every((b=>typeof b=="string"))?y.length===0?Uh(this):this.inAnyRange(y.map((b=>[b,b+Fc]))):ha(this,"startsWithAnyOf() only works with strings")}}function Qo(_){return fn((function(y){return Qd(y),_(y.target.error),!1}))}function Qd(_){_.stopPropagation&&_.stopPropagation(),_.preventDefault&&_.preventDefault()}const ep="storagemutated",Pu="x-storagemutated-1",Au=Kd(null,ep);class C_{_lock(){return Vd(!qt.global),++this._reculock,this._reculock!==1||qt.global||(qt.lockOwnerFor=this),this}_unlock(){if(Vd(!qt.global),--this._reculock==0)for(qt.global||(qt.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var y=this._blockedFuncs.shift();try{Yh(y[1],y[0])}catch{}}return this}_locked(){return this._reculock&&qt.lockOwnerFor!==this}create(y){if(!this.mode)return this;const b=this.db.idbdb,C=this.db._state.dbOpenError;if(Vd(!this.idbtrans),!y&&!b)switch(C&&C.name){case"DatabaseClosedError":throw new er.DatabaseClosed(C);case"MissingAPIError":throw new er.MissingAPI(C.message,C);default:throw new er.OpenFailed(C)}if(!this.active)throw new er.TransactionInactive;return Vd(this._completion._state===null),(y=this.idbtrans=y||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):b.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=fn((D=>{Qd(D),this._reject(y.error)})),y.onabort=fn((D=>{Qd(D),this.active&&this._reject(new er.Abort(y.error)),this.active=!1,this.on("abort").fire(D)})),y.oncomplete=fn((()=>{this.active=!1,this._resolve(),"mutatedParts"in y&&Au.storagemutated.fire(y.mutatedParts)})),this}_promise(y,b,C){if(y==="readwrite"&&this.mode!=="readwrite")return Yn(new er.ReadOnly("Transaction is readonly"));if(!this.active)return Yn(new er.TransactionInactive);if(this._locked())return new Et(((F,T)=>{this._blockedFuncs.push([()=>{this._promise(y,b,C).then(F,T)},qt])}));if(C)return Cu((()=>{var F=new Et(((T,h)=>{this._lock();const W=b(T,h,this);W&&W.then&&W.then(T,h)}));return F.finally((()=>this._unlock())),F._lib=!0,F}));var D=new Et(((F,T)=>{var h=b(F,T,this);h&&h.then&&h.then(F,T)}));return D._lib=!0,D}_root(){return this.parent?this.parent._root():this}waitFor(y){var b=this._root();const C=Et.resolve(y);if(b._waitingFor)b._waitingFor=b._waitingFor.then((()=>C));else{b._waitingFor=C,b._waitingQueue=[];var D=b.idbtrans.objectStore(b.storeNames[0]);(function T(){for(++b._spinCount;b._waitingQueue.length;)b._waitingQueue.shift()();b._waitingFor&&(D.get(-1/0).onsuccess=T)})()}var F=b._waitingFor;return new Et(((T,h)=>{C.then((W=>b._waitingQueue.push(fn(T.bind(null,W)))),(W=>b._waitingQueue.push(fn(h.bind(null,W))))).finally((()=>{b._waitingFor===F&&(b._waitingFor=null)}))}))}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new er.Abort))}table(y){const b=this._memoizedTables||(this._memoizedTables={});if(da(b,y))return b[y];const C=this.schema[y];if(!C)throw new er.NotFound("Table "+y+" not part of transaction");const D=new this.db.Table(y,C,this);return D.core=this.db.core.table(y),b[y]=D,D}}function Tm(_,y,b,C,D,F,T){return{name:_,keyPath:y,unique:b,multi:C,auto:D,compound:F,src:(b&&!T?"&":"")+(C?"*":"")+(D?"++":"")+fy(y)}}function fy(_){return typeof _=="string"?_:_?"["+[].join.call(_,"+")+"]":""}function my(_,y,b){return{name:_,primKey:y,indexes:b,mappedClass:null,idxByName:Gg(b,(C=>[C.name,C]))}}let tp=_=>{try{return _.only([[]]),tp=()=>[[]],[[]]}catch{return tp=()=>Fc,Fc}};function Im(_){return _==null?()=>{}:typeof _=="string"?(function(y){return y.split(".").length===1?C=>C[y]:C=>Vl(C,y)})(_):y=>Vl(y,_)}function Ag(_){return[].slice.call(_)}let M_=0;function Wd(_){return _==null?":id":typeof _=="string"?_:`[${_.join("+")}]`}function A_(_,y,b){function C(W){if(W.type===3)return null;if(W.type===4)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:ue,upper:ne,lowerOpen:Y,upperOpen:Z}=W;return ue===void 0?ne===void 0?null:y.upperBound(ne,!!Z):ne===void 0?y.lowerBound(ue,!!Y):y.bound(ue,ne,!!Y,!!Z)}const{schema:D,hasGetAll:F}=(function(W,ue){const ne=Ag(W.objectStoreNames);return{schema:{name:W.name,tables:ne.map((Y=>ue.objectStore(Y))).map((Y=>{const{keyPath:Z,autoIncrement:Ie}=Y,Re=Xi(Z),Pe=Z==null,Le={},De={name:Y.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:Pe,compound:Re,keyPath:Z,autoIncrement:Ie,unique:!0,extractKey:Im(Z)},indexes:Ag(Y.indexNames).map((ze=>Y.index(ze))).map((ze=>{const{name:Ue,unique:et,multiEntry:Je,keyPath:He}=ze,je={name:Ue,compound:Xi(He),keyPath:He,unique:et,multiEntry:Je,extractKey:Im(He)};return Le[Wd(He)]=je,je})),getIndexByKeyPath:ze=>Le[Wd(ze)]};return Le[":id"]=De.primaryKey,Z!=null&&(Le[Wd(Z)]=De.primaryKey),De}))},hasGetAll:ne.length>0&&"getAll"in ue.objectStore(ne[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}})(_,b),T=D.tables.map((W=>(function(ue){const ne=ue.name;return{name:ne,schema:ue,mutate:function({trans:Y,type:Z,keys:Ie,values:Re,range:Pe}){return new Promise(((Le,De)=>{Le=fn(Le);const ze=Y.objectStore(ne),Ue=ze.keyPath==null,et=Z==="put"||Z==="add";if(!et&&Z!=="delete"&&Z!=="deleteRange")throw new Error("Invalid operation type: "+Z);const{length:Je}=Ie||Re||{length:1};if(Ie&&Re&&Ie.length!==Re.length)throw new Error("Given keys array must have same length as given values array.");if(Je===0)return Le({numFailures:0,failures:{},results:[],lastResult:void 0});let He;const je=[],pt=[];let $e=0;const ar=wr=>{++$e,Qd(wr)};if(Z==="deleteRange"){if(Pe.type===4)return Le({numFailures:$e,failures:pt,results:[],lastResult:void 0});Pe.type===3?je.push(He=ze.clear()):je.push(He=ze.delete(C(Pe)))}else{const[wr,Zt]=et?Ue?[Re,Ie]:[Re,null]:[Ie,null];if(et)for(let Nt=0;Nt<Je;++Nt)je.push(He=Zt&&Zt[Nt]!==void 0?ze[Z](wr[Nt],Zt[Nt]):ze[Z](wr[Nt])),He.onerror=ar;else for(let Nt=0;Nt<Je;++Nt)je.push(He=ze[Z](wr[Nt])),He.onerror=ar}const xt=wr=>{const Zt=wr.target.result;je.forEach(((Nt,Mr)=>Nt.error!=null&&(pt[Mr]=Nt.error))),Le({numFailures:$e,failures:pt,results:Z==="delete"?Ie:je.map((Nt=>Nt.result)),lastResult:Zt})};He.onerror=wr=>{ar(wr),xt(wr)},He.onsuccess=xt}))},getMany:({trans:Y,keys:Z})=>new Promise(((Ie,Re)=>{Ie=fn(Ie);const Pe=Y.objectStore(ne),Le=Z.length,De=new Array(Le);let ze,Ue=0,et=0;const Je=je=>{const pt=je.target;De[pt._pos]=pt.result,++et===Ue&&Ie(De)},He=Qo(Re);for(let je=0;je<Le;++je)Z[je]!=null&&(ze=Pe.get(Z[je]),ze._pos=je,ze.onsuccess=Je,ze.onerror=He,++Ue);Ue===0&&Ie(De)})),get:({trans:Y,key:Z})=>new Promise(((Ie,Re)=>{Ie=fn(Ie);const Pe=Y.objectStore(ne).get(Z);Pe.onsuccess=Le=>Ie(Le.target.result),Pe.onerror=Qo(Re)})),query:(function(Y){return Z=>new Promise(((Ie,Re)=>{Ie=fn(Ie);const{trans:Pe,values:Le,limit:De,query:ze}=Z,Ue=De===1/0?void 0:De,{index:et,range:Je}=ze,He=Pe.objectStore(ne),je=et.isPrimaryKey?He:He.index(et.name),pt=C(Je);if(De===0)return Ie({result:[]});if(Y){const $e=Le?je.getAll(pt,Ue):je.getAllKeys(pt,Ue);$e.onsuccess=ar=>Ie({result:ar.target.result}),$e.onerror=Qo(Re)}else{let $e=0;const ar=Le||!("openKeyCursor"in je)?je.openCursor(pt):je.openKeyCursor(pt),xt=[];ar.onsuccess=wr=>{const Zt=ar.result;return Zt?(xt.push(Le?Zt.value:Zt.primaryKey),++$e===De?Ie({result:xt}):void Zt.continue()):Ie({result:xt})},ar.onerror=Qo(Re)}}))})(F),openCursor:function({trans:Y,values:Z,query:Ie,reverse:Re,unique:Pe}){return new Promise(((Le,De)=>{Le=fn(Le);const{index:ze,range:Ue}=Ie,et=Y.objectStore(ne),Je=ze.isPrimaryKey?et:et.index(ze.name),He=Re?Pe?"prevunique":"prev":Pe?"nextunique":"next",je=Z||!("openKeyCursor"in Je)?Je.openCursor(C(Ue),He):Je.openKeyCursor(C(Ue),He);je.onerror=Qo(De),je.onsuccess=fn((pt=>{const $e=je.result;if(!$e)return void Le(null);$e.___id=++M_,$e.done=!1;const ar=$e.continue.bind($e);let xt=$e.continuePrimaryKey;xt&&(xt=xt.bind($e));const wr=$e.advance.bind($e),Zt=()=>{throw new Error("Cursor not stopped")};$e.trans=Y,$e.stop=$e.continue=$e.continuePrimaryKey=$e.advance=()=>{throw new Error("Cursor not started")},$e.fail=fn(De),$e.next=function(){let Nt=1;return this.start((()=>Nt--?this.continue():this.stop())).then((()=>this))},$e.start=Nt=>{const Mr=new Promise((($t,ot)=>{$t=fn($t),je.onerror=Qo(ot),$e.fail=ot,$e.stop=Pt=>{$e.stop=$e.continue=$e.continuePrimaryKey=$e.advance=Zt,$t(Pt)}})),Pr=()=>{if(je.result)try{Nt()}catch($t){$e.fail($t)}else $e.done=!0,$e.start=()=>{throw new Error("Cursor behind last entry")},$e.stop()};return je.onsuccess=fn(($t=>{je.onsuccess=Pr,Pr()})),$e.continue=ar,$e.continuePrimaryKey=xt,$e.advance=wr,Pr(),Mr},Le($e)}),De)}))},count({query:Y,trans:Z}){const{index:Ie,range:Re}=Y;return new Promise(((Pe,Le)=>{const De=Z.objectStore(ne),ze=Ie.isPrimaryKey?De:De.index(Ie.name),Ue=C(Re),et=Ue?ze.count(Ue):ze.count();et.onsuccess=fn((Je=>Pe(Je.target.result))),et.onerror=Qo(Le)}))}}})(W))),h={};return T.forEach((W=>h[W.name]=W)),{stack:"dbcore",transaction:_.transaction.bind(_),table(W){if(!h[W])throw new Error(`Table '${W}' not found`);return h[W]},MIN_KEY:-1/0,MAX_KEY:tp(y),schema:D}}function Em({_novip:_},y){const b=y.db,C=(function(D,F,{IDBKeyRange:T,indexedDB:h},W){return{dbcore:(function(ne,Y){return Y.reduce(((Z,{create:Ie})=>({...Z,...Ie(Z)})),ne)})(A_(F,T,W),D.dbcore)}})(_._middlewares,b,_._deps,y);_.core=C.dbcore,_.tables.forEach((D=>{const F=D.name;_.core.schema.tables.some((T=>T.name===F))&&(D.core=_.core.table(F),_[F]instanceof _.Table&&(_[F].core=D.core))}))}function Sf({_novip:_},y,b,C){b.forEach((D=>{const F=C[D];y.forEach((T=>{const h=jm(T,D);(!h||"value"in h&&h.value===void 0)&&(T===_.Transaction.prototype||T instanceof _.Transaction?jl(T,D,{get(){return this.table(D)},set(W){$g(this,D,{value:W,writable:!0,configurable:!0,enumerable:!0})}}):T[D]=new _.Table(D,F))}))}))}function Pm({_novip:_},y){y.forEach((b=>{for(let C in b)b[C]instanceof _.Table&&delete b[C]}))}function z_(_,y){return _._cfg.version-y._cfg.version}function D_(_,y,b,C){const D=_._dbSchema,F=_._createTransaction("readwrite",_._storeNames,D);F.create(b),F._completion.catch(C);const T=F._reject.bind(F),h=qt.transless||qt;Cu((()=>{qt.trans=F,qt.transless=h,y===0?(Vn(D).forEach((W=>{lm(b,W,D[W].primKey,D[W].indexes)})),Em(_,b),Et.follow((()=>_.on.populate.fire(F))).catch(T)):(function({_novip:W},ue,ne,Y){const Z=[],Ie=W._versions;let Re=W._dbSchema=Mm(W,W.idbdb,Y),Pe=!1;const Le=Ie.filter((ze=>ze._cfg.version>=ue));function De(){return Z.length?Et.resolve(Z.shift()(ne.idbtrans)).then(De):Et.resolve()}return Le.forEach((ze=>{Z.push((()=>{const Ue=Re,et=ze._cfg.dbschema;Am(W,Ue,Y),Am(W,et,Y),Re=W._dbSchema=et;const Je=gy(Ue,et);Je.add.forEach((je=>{lm(Y,je[0],je[1].primKey,je[1].indexes)})),Je.change.forEach((je=>{if(je.recreate)throw new er.Upgrade("Not yet support for changing primary key");{const pt=Y.objectStore(je.name);je.add.forEach(($e=>Cm(pt,$e))),je.change.forEach(($e=>{pt.deleteIndex($e.name),Cm(pt,$e)})),je.del.forEach(($e=>pt.deleteIndex($e)))}}));const He=ze._cfg.contentUpgrade;if(He&&ze._cfg.version>ue){Em(W,Y),ne._memoizedTables={},Pe=!0;let je=Hg(et);Je.del.forEach((xt=>{je[xt]=Ue[xt]})),Pm(W,[W.Transaction.prototype]),Sf(W,[W.Transaction.prototype],Vn(je),je),ne.schema=je;const pt=Vm(He);let $e;pt&&Xh();const ar=Et.follow((()=>{if($e=He(ne),$e&&pt){var xt=Ul.bind(null,null);$e.then(xt,xt)}}));return $e&&typeof $e.then=="function"?Et.resolve($e):ar.then((()=>$e))}})),Z.push((Ue=>{(!Pe||!b_)&&(function(et,Je){[].slice.call(Je.db.objectStoreNames).forEach((He=>et[He]==null&&Je.db.deleteObjectStore(He)))})(ze._cfg.dbschema,Ue),Pm(W,[W.Transaction.prototype]),Sf(W,[W.Transaction.prototype],W._storeNames,W._dbSchema),ne.schema=W._dbSchema}))})),De().then((()=>{var ze,Ue;Ue=Y,Vn(ze=Re).forEach((et=>{Ue.db.objectStoreNames.contains(et)||lm(Ue,et,ze[et].primKey,ze[et].indexes)}))}))})(_,y,F,b).catch(T)}))}function gy(_,y){const b={del:[],add:[],change:[]};let C;for(C in _)y[C]||b.del.push(C);for(C in y){const D=_[C],F=y[C];if(D){const T={name:C,def:F,recreate:!1,del:[],add:[],change:[]};if(""+(D.primKey.keyPath||"")!=""+(F.primKey.keyPath||"")||D.primKey.auto!==F.primKey.auto&&!Tf)T.recreate=!0,b.change.push(T);else{const h=D.idxByName,W=F.idxByName;let ue;for(ue in h)W[ue]||T.del.push(ue);for(ue in W){const ne=h[ue],Y=W[ue];ne?ne.src!==Y.src&&T.change.push(Y):T.add.push(Y)}(T.del.length>0||T.add.length>0||T.change.length>0)&&b.change.push(T)}}else b.add.push([C,F])}return b}function lm(_,y,b,C){const D=_.db.createObjectStore(y,b.keyPath?{keyPath:b.keyPath,autoIncrement:b.auto}:{autoIncrement:b.auto});return C.forEach((F=>Cm(D,F))),D}function Cm(_,y){_.createIndex(y.name,y.keyPath,{unique:y.unique,multiEntry:y.multi})}function Mm(_,y,b){const C={};return yf(y.objectStoreNames,0).forEach((D=>{const F=b.objectStore(D);let T=F.keyPath;const h=Tm(fy(T),T||"",!1,!1,!!F.autoIncrement,T&&typeof T!="string",!0),W=[];for(let ne=0;ne<F.indexNames.length;++ne){const Y=F.index(F.indexNames[ne]);T=Y.keyPath;var ue=Tm(Y.name,T,!!Y.unique,!!Y.multiEntry,!1,T&&typeof T!="string",!1);W.push(ue)}C[D]=my(D,h,W)})),C}function Am({_novip:_},y,b){const C=b.db.objectStoreNames;for(let D=0;D<C.length;++D){const F=C[D],T=b.objectStore(F);_._hasGetAll="getAll"in T;for(let h=0;h<T.indexNames.length;++h){const W=T.indexNames[h],ue=T.index(W).keyPath,ne=typeof ue=="string"?ue:"["+yf(ue).join("+")+"]";if(y[F]){const Y=y[F].idxByName[ne];Y&&(Y.name=W,delete y[F].idxByName[ne],y[F].idxByName[W]=Y)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&hn.WorkerGlobalScope&&hn instanceof hn.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(_._hasGetAll=!1)}class L_{_parseStoresSpec(y,b){Vn(y).forEach((C=>{if(y[C]!==null){var D=y[C].split(",").map(((T,h)=>{const W=(T=T.trim()).replace(/([&*]|\+\+)/g,""),ue=/^\[/.test(W)?W.match(/^\[(.*)\]$/)[1].split("+"):W;return Tm(W,ue||null,/\&/.test(T),/\*/.test(T),/\+\+/.test(T),Xi(ue),h===0)})),F=D.shift();if(F.multi)throw new er.Schema("Primary key cannot be multi-valued");D.forEach((T=>{if(T.auto)throw new er.Schema("Only primary key can be marked as autoIncrement (++)");if(!T.keyPath)throw new er.Schema("Index must have a name and cannot be an empty string")})),b[C]=my(C,F,D)}}))}stores(y){const b=this.db;this._cfg.storesSource=this._cfg.storesSource?xs(this._cfg.storesSource,y):y;const C=b._versions,D={};let F={};return C.forEach((T=>{xs(D,T._cfg.storesSource),F=T._cfg.dbschema={},T._parseStoresSpec(D,F)})),b._dbSchema=F,Pm(b,[b._allTables,b,b.Transaction.prototype]),Sf(b,[b._allTables,b,b.Transaction.prototype,this._cfg.tables],Vn(F),F),b._storeNames=Vn(F),this}upgrade(y){return this._cfg.contentUpgrade=qm(this._cfg.contentUpgrade||en,y),this}}function Km(_,y){let b=_._dbNamesDB;return b||(b=_._dbNamesDB=new jc(If,{addons:[],indexedDB:_,IDBKeyRange:y}),b.version(1).stores({dbnames:"name"})),b.table("dbnames")}function Wm(_){return _&&typeof _.databases=="function"}function zm(_){return Cu((function(){return qt.letThrough=!0,_()}))}function R_(){var _;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise((function(y){var b=function(){return indexedDB.databases().finally(y)};_=setInterval(b,100),b()})).finally((function(){return clearInterval(_)})):Promise.resolve()}function B_(_){const y=_._state,{indexedDB:b}=_._deps;if(y.isBeingOpened||_.idbdb)return y.dbReadyPromise.then((()=>y.dbOpenError?Yn(y.dbOpenError):_));el&&(y.openCanceller._stackHolder=$c()),y.isBeingOpened=!0,y.dbOpenError=null,y.openComplete=!1;const C=y.openCanceller;function D(){if(y.openCanceller!==C)throw new er.DatabaseClosed("db.open() was cancelled")}let F=y.dbReadyResolve,T=null,h=!1;const W=()=>new Et(((ue,ne)=>{if(D(),!b)throw new er.MissingAPI;const Y=_.name,Z=y.autoSchema?b.open(Y):b.open(Y,Math.round(10*_.verno));if(!Z)throw new er.MissingAPI;Z.onerror=Qo(ne),Z.onblocked=fn(_._fireOnBlocked),Z.onupgradeneeded=fn((Ie=>{if(T=Z.transaction,y.autoSchema&&!_._options.allowEmptyDB){Z.onerror=Qd,T.abort(),Z.result.close();const Pe=b.deleteDatabase(Y);Pe.onsuccess=Pe.onerror=fn((()=>{ne(new er.NoSuchDatabase(`Database ${Y} doesnt exist`))}))}else{T.onerror=Qo(ne);var Re=Ie.oldVersion>Math.pow(2,62)?0:Ie.oldVersion;h=Re<1,_._novip.idbdb=Z.result,D_(_,Re/10,T,ne)}}),ne),Z.onsuccess=fn((()=>{T=null;const Ie=_._novip.idbdb=Z.result,Re=yf(Ie.objectStoreNames);if(Re.length>0)try{const Le=Ie.transaction((Pe=Re).length===1?Pe[0]:Pe,"readonly");y.autoSchema?(function({_novip:De},ze,Ue){De.verno=ze.version/10;const et=De._dbSchema=Mm(0,ze,Ue);De._storeNames=yf(ze.objectStoreNames,0),Sf(De,[De._allTables],Vn(et),et)})(_,Ie,Le):(Am(_,_._dbSchema,Le),(function(De,ze){const Ue=gy(Mm(0,De.idbdb,ze),De._dbSchema);return!(Ue.add.length||Ue.change.some((et=>et.add.length||et.change.length)))})(_,Le)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),Em(_,Le)}catch{}var Pe;Hd.push(_),Ie.onversionchange=fn((Le=>{y.vcFired=!0,_.on("versionchange").fire(Le)})),Ie.onclose=fn((Le=>{_.on("close").fire(Le)})),h&&(function({indexedDB:Le,IDBKeyRange:De},ze){!Wm(Le)&&ze!==If&&Km(Le,De).put({name:ze}).catch(en)})(_._deps,Y),ue()}),ne)})).catch((ue=>ue&&ue.name==="UnknownError"&&y.PR1398_maxLoop>0?(y.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),W()):Et.reject(ue)));return Et.race([C,(typeof navigator>"u"?Et.resolve():R_()).then(W)]).then((()=>(D(),y.onReadyBeingFired=[],Et.resolve(zm((()=>_.on.ready.fire(_.vip)))).then((function ue(){if(y.onReadyBeingFired.length>0){let ne=y.onReadyBeingFired.reduce(qm,en);return y.onReadyBeingFired=[],Et.resolve(zm((()=>ne(_.vip)))).then(ue)}}))))).finally((()=>{y.onReadyBeingFired=null,y.isBeingOpened=!1})).then((()=>_)).catch((ue=>{y.dbOpenError=ue;try{T&&T.abort()}catch{}return C===y.openCanceller&&_._close(),Yn(ue)})).finally((()=>{y.openComplete=!0,F()}))}function Dm(_){var y=F=>_.next(F),b=D(y),C=D((F=>_.throw(F)));function D(F){return T=>{var h=F(T),W=h.value;return h.done?W:W&&typeof W.then=="function"?W.then(b,C):Xi(W)?Promise.all(W).then(b,C):b(W)}}return D(y)()}function F_(_,y,b){var C=arguments.length;if(C<2)throw new er.InvalidArgument("Too few arguments");for(var D=new Array(C-1);--C;)D[C-1]=arguments[C];return b=D.pop(),[_,Kg(D),b]}function yy(_,y,b,C,D){return Et.resolve().then((()=>{const F=qt.transless||qt,T=_._createTransaction(y,b,_._dbSchema,C),h={trans:T,transless:F};if(C)T.idbtrans=C.idbtrans;else try{T.create(),_._state.PR1398_maxLoop=3}catch(Y){return Y.name===$m.InvalidState&&_.isOpen()&&--_._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),_._close(),_.open().then((()=>yy(_,y,b,null,D)))):Yn(Y)}const W=Vm(D);let ue;W&&Xh();const ne=Et.follow((()=>{if(ue=D.call(T,T),ue)if(W){var Y=Ul.bind(null,null);ue.then(Y,Y)}else typeof ue.next=="function"&&typeof ue.throw=="function"&&(ue=Dm(ue))}),h);return(ue&&typeof ue.then=="function"?Et.resolve(ue).then((Y=>T.active?Y:Yn(new er.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn")))):ne.then((()=>ue))).then((Y=>(C&&T._resolve(),T._completion.then((()=>Y))))).catch((Y=>(T._reject(Y),Yn(Y))))}))}function nf(_,y,b){const C=Xi(_)?_.slice():[_];for(let D=0;D<b;++D)C.push(y);return C}const O_={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(_){return{..._,table(y){const b=_.table(y),{schema:C}=b,D={},F=[];function T(ne,Y,Z){const Ie=Wd(ne),Re=D[Ie]=D[Ie]||[],Pe=ne==null?0:typeof ne=="string"?1:ne.length,Le=Y>0,De={...Z,isVirtual:Le,keyTail:Y,keyLength:Pe,extractKey:Im(ne),unique:!Le&&Z.unique};return Re.push(De),De.isPrimaryKey||F.push(De),Pe>1&&T(Pe===2?ne[0]:ne.slice(0,Pe-1),Y+1,Z),Re.sort(((ze,Ue)=>ze.keyTail-Ue.keyTail)),De}const h=T(C.primaryKey.keyPath,0,C.primaryKey);D[":id"]=[h];for(const ne of C.indexes)T(ne.keyPath,0,ne);function W(ne){const Y=ne.query.index;return Y.isVirtual?{...ne,query:{index:Y,range:(Z=ne.query.range,Ie=Y.keyTail,{type:Z.type===1?2:Z.type,lower:nf(Z.lower,Z.lowerOpen?_.MAX_KEY:_.MIN_KEY,Ie),lowerOpen:!0,upper:nf(Z.upper,Z.upperOpen?_.MIN_KEY:_.MAX_KEY,Ie),upperOpen:!0})}}:ne;var Z,Ie}return{...b,schema:{...C,primaryKey:h,indexes:F,getIndexByKeyPath:function(ne){const Y=D[Wd(ne)];return Y&&Y[0]}},count:ne=>b.count(W(ne)),query:ne=>b.query(W(ne)),openCursor(ne){const{keyTail:Y,isVirtual:Z,keyLength:Ie}=ne.query.index;return Z?b.openCursor(W(ne)).then((Re=>Re&&(function(Pe){return Object.create(Pe,{continue:{value:function(De){De!=null?Pe.continue(nf(De,ne.reverse?_.MAX_KEY:_.MIN_KEY,Y)):ne.unique?Pe.continue(Pe.key.slice(0,Ie).concat(ne.reverse?_.MIN_KEY:_.MAX_KEY,Y)):Pe.continue()}},continuePrimaryKey:{value(De,ze){Pe.continuePrimaryKey(nf(De,_.MAX_KEY,Y),ze)}},primaryKey:{get:()=>Pe.primaryKey},key:{get(){const De=Pe.key;return Ie===1?De[0]:De.slice(0,Ie)}},value:{get:()=>Pe.value}})})(Re))):b.openCursor(ne)}}}}}};function Xm(_,y,b,C){return b=b||{},C=C||"",Vn(_).forEach((D=>{if(da(y,D)){var F=_[D],T=y[D];if(typeof F=="object"&&typeof T=="object"&&F&&T){const h=dm(F);h!==dm(T)?b[C+D]=y[D]:h==="Object"?Xm(F,T,b,C+D+"."):F!==T&&(b[C+D]=y[D])}else F!==T&&(b[C+D]=y[D])}else b[C+D]=void 0})),Vn(y).forEach((D=>{da(_,D)||(b[C+D]=y[D])})),b}const N_={stack:"dbcore",name:"HooksMiddleware",level:2,create:_=>({..._,table(y){const b=_.table(y),{primaryKey:C}=b.schema;return{...b,mutate(F){const T=qt.trans,{deleting:h,creating:W,updating:ue}=T.table(y).hook;switch(F.type){case"add":if(W.fire===en)break;return T._promise("readwrite",(()=>ne(F)),!0);case"put":if(W.fire===en&&ue.fire===en)break;return T._promise("readwrite",(()=>ne(F)),!0);case"delete":if(h.fire===en)break;return T._promise("readwrite",(()=>ne(F)),!0);case"deleteRange":if(h.fire===en)break;return T._promise("readwrite",(()=>(function(Z){return Y(Z.trans,Z.range,1e4)})(F)),!0)}return b.mutate(F);function ne(Z){const Ie=qt.trans,Re=Z.keys||(function(Pe,Le){return Le.type==="delete"?Le.keys:Le.keys||Le.values.map(Pe.extractKey)})(C,Z);if(!Re)throw new Error("Keys missing");return(Z=Z.type==="add"||Z.type==="put"?{...Z,keys:Re}:{...Z}).type!=="delete"&&(Z.values=[...Z.values]),Z.keys&&(Z.keys=[...Z.keys]),(function(Pe,Le,De){return Le.type==="add"?Promise.resolve([]):Pe.getMany({trans:Le.trans,keys:De,cache:"immutable"})})(b,Z,Re).then((Pe=>{const Le=Re.map(((De,ze)=>{const Ue=Pe[ze],et={onerror:null,onsuccess:null};if(Z.type==="delete")h.fire.call(et,De,Ue,Ie);else if(Z.type==="add"||Ue===void 0){const Je=W.fire.call(et,De,Z.values[ze],Ie);De==null&&Je!=null&&(De=Je,Z.keys[ze]=De,C.outbound||uo(Z.values[ze],C.keyPath,De))}else{const Je=Xm(Ue,Z.values[ze]),He=ue.fire.call(et,Je,De,Ue,Ie);if(He){const je=Z.values[ze];Object.keys(He).forEach((pt=>{da(je,pt)?je[pt]=He[pt]:uo(je,pt,He[pt])}))}}return et}));return b.mutate(Z).then((({failures:De,results:ze,numFailures:Ue,lastResult:et})=>{for(let Je=0;Je<Re.length;++Je){const He=ze?ze[Je]:Re[Je],je=Le[Je];He==null?je.onerror&&je.onerror(De[Je]):je.onsuccess&&je.onsuccess(Z.type==="put"&&Pe[Je]?Z.values[Je]:He)}return{failures:De,results:ze,numFailures:Ue,lastResult:et}})).catch((De=>(Le.forEach((ze=>ze.onerror&&ze.onerror(De))),Promise.reject(De))))}))}function Y(Z,Ie,Re){return b.query({trans:Z,values:!1,query:{index:C,range:Ie},limit:Re}).then((({result:Pe})=>ne({type:"delete",keys:Pe,trans:Z}).then((Le=>Le.numFailures>0?Promise.reject(Le.failures[0]):Pe.length<Re?{failures:[],numFailures:0,lastResult:void 0}:Y(Z,{...Ie,lower:Pe[Pe.length-1],lowerOpen:!0},Re)))))}}}}})};function _y(_,y,b){try{if(!y||y.keys.length<_.length)return null;const C=[];for(let D=0,F=0;D<y.keys.length&&F<_.length;++D)vs(y.keys[D],_[F])===0&&(C.push(b?np(y.values[D]):y.values[D]),++F);return C.length===_.length?C:null}catch{return null}}const j_={stack:"dbcore",level:-1,create:_=>({table:y=>{const b=_.table(y);return{...b,getMany:C=>{if(!C.cache)return b.getMany(C);const D=_y(C.keys,C.trans._cache,C.cache==="clone");return D?Et.resolve(D):b.getMany(C).then((F=>(C.trans._cache={keys:C.keys,values:C.cache==="clone"?np(F):F},F)))},mutate:C=>(C.type!=="add"&&(C.trans._cache=null),b.mutate(C))}}})};function Ym(_){return!("from"in _)}const Fl=function(_,y){if(!this){const b=new Fl;return _&&"d"in _&&xs(b,_),b}xs(this,arguments.length?{d:1,from:_,to:arguments.length>1?y:_}:{d:0})};function rp(_,y,b){const C=vs(y,b);if(isNaN(C))return;if(C>0)throw RangeError();if(Ym(_))return xs(_,{from:y,to:b,d:1});const D=_.l,F=_.r;if(vs(b,_.from)<0)return D?rp(D,y,b):_.l={from:y,to:b,d:1,l:null,r:null},zg(_);if(vs(y,_.to)>0)return F?rp(F,y,b):_.r={from:y,to:b,d:1,l:null,r:null},zg(_);vs(y,_.from)<0&&(_.from=y,_.l=null,_.d=F?F.d+1:1),vs(b,_.to)>0&&(_.to=b,_.r=null,_.d=_.l?_.l.d+1:1);const T=!_.r;D&&!_.l&&kf(_,D),F&&T&&kf(_,F)}function kf(_,y){Ym(y)||(function b(C,{from:D,to:F,l:T,r:h}){rp(C,D,F),T&&b(C,T),h&&b(C,h)})(_,y)}function V_(_,y){const b=Lm(y);let C=b.next();if(C.done)return!1;let D=C.value;const F=Lm(_);let T=F.next(D.from),h=T.value;for(;!C.done&&!T.done;){if(vs(h.from,D.to)<=0&&vs(h.to,D.from)>=0)return!0;vs(D.from,h.from)<0?D=(C=b.next(h.from)).value:h=(T=F.next(D.from)).value}return!1}function Lm(_){let y=Ym(_)?null:{s:0,n:_};return{next(b){const C=arguments.length>0;for(;y;)switch(y.s){case 0:if(y.s=1,C)for(;y.n.l&&vs(b,y.n.from)<0;)y={up:y,n:y.n.l,s:1};else for(;y.n.l;)y={up:y,n:y.n.l,s:1};case 1:if(y.s=2,!C||vs(b,y.n.to)<=0)return{value:y.n,done:!1};case 2:if(y.n.r){y.s=3,y={up:y,n:y.n.r,s:0};continue}case 3:y=y.up}return{done:!0}}}}function zg(_){var y,b;const C=(((y=_.r)===null||y===void 0?void 0:y.d)||0)-(((b=_.l)===null||b===void 0?void 0:b.d)||0),D=C>1?"r":C<-1?"l":"";if(D){const F=D==="r"?"l":"r",T={..._},h=_[D];_.from=h.from,_.to=h.to,_[D]=h[D],T[D]=h[F],_[F]=T,T.d=Dg(T)}_.d=Dg(_)}function Dg({r:_,l:y}){return(_?y?Math.max(_.d,y.d):_.d:y?y.d:0)+1}Wh(Fl.prototype,{add(_){return kf(this,_),this},addKey(_){return rp(this,_,_),this},addKeys(_){return _.forEach((y=>rp(this,y,y))),this},[pm](){return Lm(this)}});const U_={stack:"dbcore",level:0,create:_=>{const y=_.schema.name,b=new Fl(_.MIN_KEY,_.MAX_KEY);return{..._,table:C=>{const D=_.table(C),{schema:F}=D,{primaryKey:T}=F,{extractKey:h,outbound:W}=T,ue={...D,mutate:Z=>{const Ie=Z.trans,Re=Ie.mutatedParts||(Ie.mutatedParts={}),Pe=He=>{const je=`idb://${y}/${C}/${He}`;return Re[je]||(Re[je]=new Fl)},Le=Pe(""),De=Pe(":dels"),{type:ze}=Z;let[Ue,et]=Z.type==="deleteRange"?[Z.range]:Z.type==="delete"?[Z.keys]:Z.values.length<50?[[],Z.values]:[];const Je=Z.trans._cache;return D.mutate(Z).then((He=>{if(Xi(Ue)){ze!=="delete"&&(Ue=He.results),Le.addKeys(Ue);const je=_y(Ue,Je);je||ze==="add"||De.addKeys(Ue),(je||et)&&(function(pt,$e,ar,xt){function wr(Zt){const Nt=pt(Zt.name||"");function Mr($t){return $t!=null?Zt.extractKey($t):null}const Pr=$t=>Zt.multiEntry&&Xi($t)?$t.forEach((ot=>Nt.addKey(ot))):Nt.addKey($t);(ar||xt).forEach((($t,ot)=>{const Pt=ar&&Mr(ar[ot]),ft=xt&&Mr(xt[ot]);vs(Pt,ft)!==0&&(Pt!=null&&Pr(Pt),ft!=null&&Pr(ft))}))}$e.indexes.forEach(wr)})(Pe,F,je,et)}else if(Ue){const je={from:Ue.lower,to:Ue.upper};De.add(je),Le.add(je)}else Le.add(b),De.add(b),F.indexes.forEach((je=>Pe(je.name).add(b)));return He}))}},ne=({query:{index:Z,range:Ie}})=>{var Re,Pe;return[Z,new Fl((Re=Ie.lower)!==null&&Re!==void 0?Re:_.MIN_KEY,(Pe=Ie.upper)!==null&&Pe!==void 0?Pe:_.MAX_KEY)]},Y={get:Z=>[T,new Fl(Z.key)],getMany:Z=>[T,new Fl().addKeys(Z.keys)],count:ne,query:ne,openCursor:ne};return Vn(Y).forEach((Z=>{ue[Z]=function(Ie){const{subscr:Re}=qt;if(Re){const Pe=et=>{const Je=`idb://${y}/${C}/${et}`;return Re[Je]||(Re[Je]=new Fl)},Le=Pe(""),De=Pe(":dels"),[ze,Ue]=Y[Z](Ie);if(Pe(ze.name||"").add(Ue),!ze.isPrimaryKey){if(Z!=="count"){const et=Z==="query"&&W&&Ie.values&&D.query({...Ie,values:!1});return D[Z].apply(this,arguments).then((Je=>{if(Z==="query"){if(W&&Ie.values)return et.then((({result:je})=>(Le.addKeys(je),Je)));const He=Ie.values?Je.result.map(h):Je.result;Ie.values?Le.addKeys(He):De.addKeys(He)}else if(Z==="openCursor"){const He=Je,je=Ie.values;return He&&Object.create(He,{key:{get:()=>(De.addKey(He.primaryKey),He.key)},primaryKey:{get(){const pt=He.primaryKey;return De.addKey(pt),pt}},value:{get:()=>(je&&Le.addKey(He.primaryKey),He.value)}})}return Je}))}De.add(b)}}return D[Z].apply(this,arguments)}})),ue}}}};class jc{constructor(y,b){this._middlewares={},this.verno=0;const C=jc.dependencies;this._options=b={addons:jc.addons,autoOpen:!0,indexedDB:C.indexedDB,IDBKeyRange:C.IDBKeyRange,...b},this._deps={indexedDB:b.indexedDB,IDBKeyRange:b.IDBKeyRange};const{addons:D}=b;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const F={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:en,dbReadyPromise:null,cancelOpen:en,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var T;F.dbReadyPromise=new Et((h=>{F.dbReadyResolve=h})),F.openCanceller=new Et(((h,W)=>{F.cancelOpen=W})),this._state=F,this.name=y,this.on=Kd(this,"populate","blocked","versionchange","close",{ready:[qm,en]}),this.on.ready.subscribe=qg(this.on.ready.subscribe,(h=>(W,ue)=>{jc.vip((()=>{const ne=this._state;if(ne.openComplete)ne.dbOpenError||Et.resolve().then(W),ue&&h(W);else if(ne.onReadyBeingFired)ne.onReadyBeingFired.push(W),ue&&h(W);else{h(W);const Y=this;ue||h((function Z(){Y.on.ready.unsubscribe(W),Y.on.ready.unsubscribe(Z)}))}}))})),this.Collection=(T=this,Od(T_.prototype,(function(h,W){this.db=T;let ue=hy,ne=null;if(W)try{ue=W()}catch(Re){ne=Re}const Y=h._ctx,Z=Y.table,Ie=Z.hook.reading.fire;this._ctx={table:Z,index:Y.index,isPrimKey:!Y.index||Z.schema.primKey.keyPath&&Y.index===Z.schema.primKey.name,range:ue,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:ne,or:Y.or,valueMapper:Ie!==Yd?Ie:null}}))),this.Table=(function(h){return Od(k_.prototype,(function(W,ue,ne){this.db=h,this._tx=ne,this.name=W,this.schema=ue,this.hook=h._allTables[W]?h._allTables[W].hook:Kd(null,{creating:[d_,en],reading:[h_,Yd],updating:[f_,en],deleting:[p_,en]})}))})(this),this.Transaction=(function(h){return Od(C_.prototype,(function(W,ue,ne,Y,Z){this.db=h,this.mode=W,this.storeNames=ue,this.schema=ne,this.chromeTransactionDurability=Y,this.idbtrans=null,this.on=Kd(this,"complete","error","abort"),this.parent=Z||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Et(((Ie,Re)=>{this._resolve=Ie,this._reject=Re})),this._completion.then((()=>{this.active=!1,this.on.complete.fire()}),(Ie=>{var Re=this.active;return this.active=!1,this.on.error.fire(Ie),this.parent?this.parent._reject(Ie):Re&&this.idbtrans&&this.idbtrans.abort(),Yn(Ie)}))}))})(this),this.Version=(function(h){return Od(L_.prototype,(function(W){this.db=h,this._cfg={version:W,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}}))})(this),this.WhereClause=(function(h){return Od(py.prototype,(function(W,ue,ne){this.db=h,this._ctx={table:W,index:ue===":id"?null:ue,or:ne};const Y=h._deps.indexedDB;if(!Y)throw new er.MissingAPI;this._cmp=this._ascending=Y.cmp.bind(Y),this._descending=(Z,Ie)=>Y.cmp(Ie,Z),this._max=(Z,Ie)=>Y.cmp(Z,Ie)>0?Z:Ie,this._min=(Z,Ie)=>Y.cmp(Z,Ie)<0?Z:Ie,this._IDBKeyRange=h._deps.IDBKeyRange}))})(this),this.on("versionchange",(h=>{h.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()})),this.on("blocked",(h=>{!h.newVersion||h.newVersion<h.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${h.oldVersion/10}`)})),this._maxKey=tp(b.IDBKeyRange),this._createTransaction=(h,W,ue,ne)=>new this.Transaction(h,W,ue,this._options.chromeTransactionDurability,ne),this._fireOnBlocked=h=>{this.on("blocked").fire(h),Hd.filter((W=>W.name===this.name&&W!==this&&!W._state.vcFired)).map((W=>W.on("versionchange").fire(h)))},this.use(O_),this.use(N_),this.use(U_),this.use(j_),this.vip=Object.create(this,{_vip:{value:!0}}),D.forEach((h=>h(this)))}version(y){if(isNaN(y)||y<.1)throw new er.Type("Given version is not a positive number");if(y=Math.round(10*y)/10,this.idbdb||this._state.isBeingOpened)throw new er.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,y);const b=this._versions;var C=b.filter((D=>D._cfg.version===y))[0];return C||(C=new this.Version(y),b.push(C),b.sort(z_),C.stores({}),this._state.autoSchema=!1,C)}_whenReady(y){return this.idbdb&&(this._state.openComplete||qt.letThrough||this._vip)?y():new Et(((b,C)=>{if(this._state.openComplete)return C(new er.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void C(new er.DatabaseClosed);this.open().catch(en)}this._state.dbReadyPromise.then(b,C)})).then(y)}use({stack:y,create:b,level:C,name:D}){D&&this.unuse({stack:y,name:D});const F=this._middlewares[y]||(this._middlewares[y]=[]);return F.push({stack:y,create:b,level:C??10,name:D}),F.sort(((T,h)=>T.level-h.level)),this}unuse({stack:y,name:b,create:C}){return y&&this._middlewares[y]&&(this._middlewares[y]=this._middlewares[y].filter((D=>C?D.create!==C:!!b&&D.name!==b))),this}open(){return B_(this)}_close(){const y=this._state,b=Hd.indexOf(this);if(b>=0&&Hd.splice(b,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}y.dbReadyPromise=new Et((C=>{y.dbReadyResolve=C})),y.openCanceller=new Et(((C,D)=>{y.cancelOpen=D}))}close(){this._close();const y=this._state;this._options.autoOpen=!1,y.dbOpenError=new er.DatabaseClosed,y.isBeingOpened&&y.cancelOpen(y.dbOpenError)}delete(){const y=arguments.length>0,b=this._state;return new Et(((C,D)=>{const F=()=>{this.close();var T=this._deps.indexedDB.deleteDatabase(this.name);T.onsuccess=fn((()=>{(function({indexedDB:h,IDBKeyRange:W},ue){!Wm(h)&&ue!==If&&Km(h,W).delete(ue).catch(en)})(this._deps,this.name),C()})),T.onerror=Qo(D),T.onblocked=this._fireOnBlocked};if(y)throw new er.InvalidArgument("Arguments not allowed in db.delete()");b.isBeingOpened?b.dbReadyPromise.then(F):F()}))}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){const y=this._state.dbOpenError;return y&&y.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return Vn(this._allTables).map((y=>this._allTables[y]))}transaction(){const y=F_.apply(this,arguments);return this._transaction.apply(this,y)}_transaction(y,b,C){let D=qt.trans;D&&D.db===this&&y.indexOf("!")===-1||(D=null);const F=y.indexOf("?")!==-1;let T,h;y=y.replace("!","").replace("?","");try{if(h=b.map((ue=>{var ne=ue instanceof this.Table?ue.name:ue;if(typeof ne!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return ne})),y=="r"||y===nm)T=nm;else{if(y!="rw"&&y!=im)throw new er.InvalidArgument("Invalid transaction mode: "+y);T=im}if(D){if(D.mode===nm&&T===im){if(!F)throw new er.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");D=null}D&&h.forEach((ue=>{if(D&&D.storeNames.indexOf(ue)===-1){if(!F)throw new er.SubTransaction("Table "+ue+" not included in parent transaction.");D=null}})),F&&D&&!D.active&&(D=null)}}catch(ue){return D?D._promise(null,((ne,Y)=>{Y(ue)})):Yn(ue)}const W=yy.bind(null,this,T,h,D,C);return D?D._promise(T,W,"lock"):qt.trans?Yh(qt.transless,(()=>this._whenReady(W))):this._whenReady(W)}table(y){if(!da(this._allTables,y))throw new er.InvalidTable(`Table ${y} does not exist`);return this._allTables[y]}}const $_=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable";class q_{constructor(y){this._subscribe=y}subscribe(y,b,C){return this._subscribe(y&&typeof y!="function"?y:{next:y,error:b,complete:C})}[$_](){return this}}function vy(_,y){return Vn(y).forEach((b=>{kf(_[b]||(_[b]=new Fl),y[b])})),_}function Z_(_){let y,b=!1;const C=new q_((D=>{const F=Vm(_);let T=!1,h={},W={};const ue={get closed(){return T},unsubscribe:()=>{T=!0,Au.storagemutated.unsubscribe(Ie)}};D.start&&D.start(ue);let ne=!1,Y=!1;function Z(){return Vn(W).some((Pe=>h[Pe]&&V_(h[Pe],W[Pe])))}const Ie=Pe=>{vy(h,Pe),Z()&&Re()},Re=()=>{if(ne||T)return;h={};const Pe={},Le=(function(De){F&&Xh();const ze=()=>Cu(_,{subscr:De,trans:null}),Ue=qt.trans?Yh(qt.transless,ze):ze();return F&&Ue.then(Ul,Ul),Ue})(Pe);Y||(Au(ep,Ie),Y=!0),ne=!0,Promise.resolve(Le).then((De=>{b=!0,y=De,ne=!1,T||(Z()?Re():(h={},W=Pe,D.next&&D.next(De)))}),(De=>{ne=!1,b=!1,D.error&&D.error(De),ue.unsubscribe()}))};return Re(),ue}));return C.hasValue=()=>b,C.getValue=()=>y,C}let Rm;try{Rm={indexedDB:hn.indexedDB||hn.mozIndexedDB||hn.webkitIndexedDB||hn.msIndexedDB,IDBKeyRange:hn.IDBKeyRange||hn.webkitIDBKeyRange}}catch{Rm={indexedDB:null,IDBKeyRange:null}}const Bc=jc;function mf(_){let y=Nl;try{Nl=!0,Au.storagemutated.fire(_)}finally{Nl=y}}Wh(Bc,{...uf,delete:_=>new Bc(_,{addons:[]}).delete(),exists:_=>new Bc(_,{addons:[]}).open().then((y=>(y.close(),!0))).catch("NoSuchDatabaseError",(()=>!1)),getDatabaseNames(_){try{return(function({indexedDB:y,IDBKeyRange:b}){return Wm(y)?Promise.resolve(y.databases()).then((C=>C.map((D=>D.name)).filter((D=>D!==If)))):Km(y,b).toCollection().primaryKeys()})(Bc.dependencies).then(_)}catch{return Yn(new er.MissingAPI)}},defineClass:()=>function(_){xs(this,_)},ignoreTransaction:_=>qt.trans?Yh(qt.transless,_):_(),vip:zm,async:function(_){return function(){try{var y=Dm(_.apply(this,arguments));return y&&typeof y.then=="function"?y:Et.resolve(y)}catch(b){return Yn(b)}}},spawn:function(_,y,b){try{var C=Dm(_.apply(b,y||[]));return C&&typeof C.then=="function"?C:Et.resolve(C)}catch(D){return Yn(D)}},currentTransaction:{get:()=>qt.trans||null},waitFor:function(_,y){const b=Et.resolve(typeof _=="function"?Bc.ignoreTransaction(_):_).timeout(y||6e4);return qt.trans?qt.trans.waitFor(b):b},Promise:Et,debug:{get:()=>el,set:_=>{Xg(_,_==="dexie"?()=>!0:cy)}},derive:Gh,extend:xs,props:Wh,override:qg,Events:Kd,on:Au,liveQuery:Z_,extendObservabilitySet:vy,getByKeyPath:Vl,setByKeyPath:uo,delByKeyPath:function(_,y){typeof y=="string"?uo(_,y,void 0):"length"in y&&[].map.call(y,(function(b){uo(_,b,void 0)}))},shallowClone:Hg,deepClone:np,getObjectDiff:Xm,cmp:vs,asap:Zg,minKey:km,addons:[],connections:Hd,errnames:$m,dependencies:Rm,semVer:Ig,version:Ig.split(".").map((_=>parseInt(_))).reduce(((_,y,b)=>_+y/Math.pow(10,2*b)))}),Bc.maxKey=tp(Bc.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Au(ep,(_=>{if(!Nl){let y;Tf?(y=document.createEvent("CustomEvent"),y.initCustomEvent(Pu,!0,!0,_)):y=new CustomEvent(Pu,{detail:_}),Nl=!0,dispatchEvent(y),Nl=!1}})),addEventListener(Pu,(({detail:_})=>{Nl||mf(_)})));let Nl=!1;if(typeof BroadcastChannel<"u"){const _=new BroadcastChannel(Pu);typeof _.unref=="function"&&_.unref(),Au(ep,(y=>{Nl||_.postMessage(y)})),_.onmessage=y=>{y.data&&mf(y.data)}}else if(typeof self<"u"&&typeof navigator<"u"){Au(ep,(y=>{try{Nl||(typeof localStorage<"u"&&localStorage.setItem(Pu,JSON.stringify({trig:Math.random(),changedParts:y})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach((b=>b.postMessage({type:Pu,changedParts:y}))))}catch{}})),typeof addEventListener<"u"&&addEventListener("storage",(y=>{if(y.key===Pu){const b=JSON.parse(y.newValue);b&&mf(b.changedParts)}}));const _=self.document&&navigator.serviceWorker;_&&_.addEventListener("message",(function({data:y}){y&&y.type===Pu&&mf(y.changedParts)}))}Et.rejectionMapper=function(_,y){if(!_||_ instanceof Hh||_ instanceof TypeError||_ instanceof SyntaxError||!_.name||!bg[_.name])return _;var b=new bg[_.name](y||_.message,_);return"stack"in _&&jl(b,"stack",{get:function(){return this.inner.stack}}),b},Xg(el,cy);class G_ extends jc{constructor(){super("boater_map_db");Jo(this,"meta");Jo(this,"restriction_areas");Jo(this,"traffic_signs");this.version(1).stores({meta:"key",restriction_areas:"id, bbox",traffic_signs:"id, vlmtyyppi"})}}const lo=new G_,xy=async _=>{const y=await lo.meta.get(_);return y==null?void 0:y.value},wy=async(_,y)=>{await lo.meta.put({key:_,value:y})},Lg=async _=>await xy(`${_}_lastUpdated`),Rg=async(_,y)=>{await wy(`${_}_lastUpdated`,y)},H_="/finland-boater-map/data/rajoitusalue_a.gpkg",K_="/finland-boater-map/data/vesiliikennemerkit.gpkg";class W_{constructor(y){Jo(this,"worker",null);Jo(this,"onStatusChange");this.onStatusChange=y}updateStatus(y){this.onStatusChange({isUpdating:!1,progress:0,message:"",...y})}async updateData(){this.updateStatus({isUpdating:!0,progress:0,message:"Aloitetaan pivitys..."});try{this.updateStatus({progress:10,message:"Ladataan rajoitusalueet..."});const y=this.fetchFile(H_,"rajoitus");this.updateStatus({progress:30,message:"Ladataan liikennemerkit..."});const b=this.fetchFile(K_,"vesiliikenne"),[C,D]=await Promise.all([y,b]);this.updateStatus({progress:50,message:"Ksitelln rajoitusalueet..."});const F=await this.parseInWorker(C,"rajoitus");this.updateStatus({progress:70,message:"Ksitelln liikennemerkit..."});const T=await this.parseInWorker(D,"vesiliikenne");this.updateStatus({progress:85,message:"Tallennetaan tietokantaan..."}),await this.storeData(F,T);const h=new Date().toISOString();await Rg("rajoitus",h),await Rg("vesiliikenne",h),this.updateStatus({isUpdating:!1,progress:100,message:"Pivitys valmis!"}),setTimeout(()=>{this.updateStatus({progress:0,message:""})},3e3)}catch(y){console.error("Update failed:",y),this.updateStatus({isUpdating:!1,progress:0,message:"",error:y instanceof Error?y.message:"Pivitys eponnistui"})}}async fetchFile(y,b){const C=await xy(`${b}_etag`),D={};C&&(D["If-None-Match"]=C);const F=await fetch(y,{headers:D});if(F.status===304)return console.log("Data not modified, using cached version"),null;if(!F.ok)throw new Error(`HTTP error! status: ${F.status}`);const T=F.headers.get("ETag");return T&&await wy(`${b}_etag`,T),await F.arrayBuffer()}async parseInWorker(y,b){return new Promise((C,D)=>{this.worker||(this.worker=new Worker(new URL("/finland-boater-map/assets/gpkgParser.worker-ByOx_uvh.js",import.meta.url),{type:"module"}));const F=T=>{var h,W;T.data.type==="result"?((h=this.worker)==null||h.removeEventListener("message",F),C(T.data.data)):T.data.type==="error"&&((W=this.worker)==null||W.removeEventListener("message",F),D(new Error(T.data.error)))};this.worker.addEventListener("message",F),this.worker.postMessage({type:"parse",dataType:b,arrayBuffer:y})})}async storeData(y,b){await lo.transaction("rw",[lo.restriction_areas,lo.traffic_signs],async()=>{await lo.restriction_areas.clear(),await lo.traffic_signs.clear(),await lo.restriction_areas.bulkAdd(y),await lo.traffic_signs.bulkAdd(b)})}cleanup(){this.worker&&(this.worker.terminate(),this.worker=null)}}function X_(_,y,b,C,D){by(_,y,b||0,C||_.length-1,D||Y_)}function by(_,y,b,C,D){for(;C>b;){if(C-b>600){var F=C-b+1,T=y-b+1,h=Math.log(F),W=.5*Math.exp(2*h/3),ue=.5*Math.sqrt(h*W*(F-W)/F)*(T-F/2<0?-1:1),ne=Math.max(b,Math.floor(y-T*W/F+ue)),Y=Math.min(C,Math.floor(y+(F-T)*W/F+ue));by(_,y,ne,Y,D)}var Z=_[y],Ie=b,Re=C;for(Nd(_,b,y),D(_[C],Z)>0&&Nd(_,b,C);Ie<Re;){for(Nd(_,Ie,Re),Ie++,Re--;D(_[Ie],Z)<0;)Ie++;for(;D(_[Re],Z)>0;)Re--}D(_[b],Z)===0?Nd(_,b,Re):(Re++,Nd(_,Re,C)),Re<=y&&(b=Re+1),y<=Re&&(C=Re-1)}}function Nd(_,y,b){var C=_[y];_[y]=_[b],_[b]=C}function Y_(_,y){return _<y?-1:_>y?1:0}class Bg{constructor(y=9){this._maxEntries=Math.max(4,y),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(y){let b=this.data;const C=[];if(!af(y,b))return C;const D=this.toBBox,F=[];for(;b;){for(let T=0;T<b.children.length;T++){const h=b.children[T],W=b.leaf?D(h):h;af(y,W)&&(b.leaf?C.push(h):cm(y,W)?this._all(h,C):F.push(h))}b=F.pop()}return C}collides(y){let b=this.data;if(!af(y,b))return!1;const C=[];for(;b;){for(let D=0;D<b.children.length;D++){const F=b.children[D],T=b.leaf?this.toBBox(F):F;if(af(y,T)){if(b.leaf||cm(y,T))return!0;C.push(F)}}b=C.pop()}return!1}load(y){if(!(y&&y.length))return this;if(y.length<this._minEntries){for(let C=0;C<y.length;C++)this.insert(y[C]);return this}let b=this._build(y.slice(),0,y.length-1,0);if(!this.data.children.length)this.data=b;else if(this.data.height===b.height)this._splitRoot(this.data,b);else{if(this.data.height<b.height){const C=this.data;this.data=b,b=C}this._insert(b,this.data.height-b.height-1,!0)}return this}insert(y){return y&&this._insert(y,this.data.height-1),this}clear(){return this.data=Zh([]),this}remove(y,b){if(!y)return this;let C=this.data;const D=this.toBBox(y),F=[],T=[];let h,W,ue;for(;C||F.length;){if(C||(C=F.pop(),W=F[F.length-1],h=T.pop(),ue=!0),C.leaf){const ne=J_(y,C.children,b);if(ne!==-1)return C.children.splice(ne,1),F.push(C),this._condense(F),this}!ue&&!C.leaf&&cm(C,D)?(F.push(C),T.push(h),h=0,W=C,C=C.children[0]):W?(h++,C=W.children[h],ue=!1):C=null}return this}toBBox(y){return y}compareMinX(y,b){return y.minX-b.minX}compareMinY(y,b){return y.minY-b.minY}toJSON(){return this.data}fromJSON(y){return this.data=y,this}_all(y,b){const C=[];for(;y;)y.leaf?b.push(...y.children):C.push(...y.children),y=C.pop();return b}_build(y,b,C,D){const F=C-b+1;let T=this._maxEntries,h;if(F<=T)return h=Zh(y.slice(b,C+1)),$h(h,this.toBBox),h;D||(D=Math.ceil(Math.log(F)/Math.log(T)),T=Math.ceil(F/Math.pow(T,D-1))),h=Zh([]),h.leaf=!1,h.height=D;const W=Math.ceil(F/T),ue=W*Math.ceil(Math.sqrt(T));Fg(y,b,C,ue,this.compareMinX);for(let ne=b;ne<=C;ne+=ue){const Y=Math.min(ne+ue-1,C);Fg(y,ne,Y,W,this.compareMinY);for(let Z=ne;Z<=Y;Z+=W){const Ie=Math.min(Z+W-1,Y);h.children.push(this._build(y,Z,Ie,D-1))}}return $h(h,this.toBBox),h}_chooseSubtree(y,b,C,D){for(;D.push(b),!(b.leaf||D.length-1===C);){let F=1/0,T=1/0,h;for(let W=0;W<b.children.length;W++){const ue=b.children[W],ne=um(ue),Y=tv(y,ue)-ne;Y<T?(T=Y,F=ne<F?ne:F,h=ue):Y===T&&ne<F&&(F=ne,h=ue)}b=h||b.children[0]}return b}_insert(y,b,C){const D=C?y:this.toBBox(y),F=[],T=this._chooseSubtree(D,this.data,b,F);for(T.children.push(y),qd(T,D);b>=0&&F[b].children.length>this._maxEntries;)this._split(F,b),b--;this._adjustParentBBoxes(D,F,b)}_split(y,b){const C=y[b],D=C.children.length,F=this._minEntries;this._chooseSplitAxis(C,F,D);const T=this._chooseSplitIndex(C,F,D),h=Zh(C.children.splice(T,C.children.length-T));h.height=C.height,h.leaf=C.leaf,$h(C,this.toBBox),$h(h,this.toBBox),b?y[b-1].children.push(h):this._splitRoot(C,h)}_splitRoot(y,b){this.data=Zh([y,b]),this.data.height=y.height+1,this.data.leaf=!1,$h(this.data,this.toBBox)}_chooseSplitIndex(y,b,C){let D,F=1/0,T=1/0;for(let h=b;h<=C-b;h++){const W=$d(y,0,h,this.toBBox),ue=$d(y,h,C,this.toBBox),ne=rv(W,ue),Y=um(W)+um(ue);ne<F?(F=ne,D=h,T=Y<T?Y:T):ne===F&&Y<T&&(T=Y,D=h)}return D||C-b}_chooseSplitAxis(y,b,C){const D=y.leaf?this.compareMinX:Q_,F=y.leaf?this.compareMinY:ev,T=this._allDistMargin(y,b,C,D),h=this._allDistMargin(y,b,C,F);T<h&&y.children.sort(D)}_allDistMargin(y,b,C,D){y.children.sort(D);const F=this.toBBox,T=$d(y,0,b,F),h=$d(y,C-b,C,F);let W=sf(T)+sf(h);for(let ue=b;ue<C-b;ue++){const ne=y.children[ue];qd(T,y.leaf?F(ne):ne),W+=sf(T)}for(let ue=C-b-1;ue>=b;ue--){const ne=y.children[ue];qd(h,y.leaf?F(ne):ne),W+=sf(h)}return W}_adjustParentBBoxes(y,b,C){for(let D=C;D>=0;D--)qd(b[D],y)}_condense(y){for(let b=y.length-1,C;b>=0;b--)y[b].children.length===0?b>0?(C=y[b-1].children,C.splice(C.indexOf(y[b]),1)):this.clear():$h(y[b],this.toBBox)}}function J_(_,y,b){if(!b)return y.indexOf(_);for(let C=0;C<y.length;C++)if(b(_,y[C]))return C;return-1}function $h(_,y){$d(_,0,_.children.length,y,_)}function $d(_,y,b,C,D){D||(D=Zh(null)),D.minX=1/0,D.minY=1/0,D.maxX=-1/0,D.maxY=-1/0;for(let F=y;F<b;F++){const T=_.children[F];qd(D,_.leaf?C(T):T)}return D}function qd(_,y){return _.minX=Math.min(_.minX,y.minX),_.minY=Math.min(_.minY,y.minY),_.maxX=Math.max(_.maxX,y.maxX),_.maxY=Math.max(_.maxY,y.maxY),_}function Q_(_,y){return _.minX-y.minX}function ev(_,y){return _.minY-y.minY}function um(_){return(_.maxX-_.minX)*(_.maxY-_.minY)}function sf(_){return _.maxX-_.minX+(_.maxY-_.minY)}function tv(_,y){return(Math.max(y.maxX,_.maxX)-Math.min(y.minX,_.minX))*(Math.max(y.maxY,_.maxY)-Math.min(y.minY,_.minY))}function rv(_,y){const b=Math.max(_.minX,y.minX),C=Math.max(_.minY,y.minY),D=Math.min(_.maxX,y.maxX),F=Math.min(_.maxY,y.maxY);return Math.max(0,D-b)*Math.max(0,F-C)}function cm(_,y){return _.minX<=y.minX&&_.minY<=y.minY&&y.maxX<=_.maxX&&y.maxY<=_.maxY}function af(_,y){return y.minX<=_.maxX&&y.minY<=_.maxY&&y.maxX>=_.minX&&y.maxY>=_.minY}function Zh(_){return{children:_,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Fg(_,y,b,C,D){const F=[y,b];for(;F.length;){if(b=F.pop(),y=F.pop(),b-y<=C)continue;const T=y+Math.ceil((b-y)/C/2)*C;X_(_,T,y,b,D),F.push(y,T,T,b)}}class nv{constructor(){Jo(this,"areaIndex");Jo(this,"signIndex");Jo(this,"areaMap");Jo(this,"signMap");this.areaIndex=new Bg,this.signIndex=new Bg,this.areaMap=new Map,this.signMap=new Map}buildAreaIndex(y){this.areaMap.clear();const b=[];for(const C of y)this.areaMap.set(C.id,C),b.push({minX:C.bbox[0],minY:C.bbox[1],maxX:C.bbox[2],maxY:C.bbox[3],id:C.id});this.areaIndex.clear(),this.areaIndex.load(b)}buildSignIndex(y){this.signMap.clear();const b=[];for(const C of y){this.signMap.set(C.id,C);const[D,F]=C.geometry.coordinates;b.push({minX:D,minY:F,maxX:D,maxY:F,id:C.id})}this.signIndex.clear(),this.signIndex.load(b)}getCandidateAreas(y,b,C=.01){return this.areaIndex.search({minX:y-C,minY:b-C,maxX:y+C,maxY:b+C}).map(F=>this.areaMap.get(F.id)).filter(F=>F!=null)}getNearbySignsInRadius(y,b,C){const D=C/111e3,F=C/55e3;return this.signIndex.search({minX:y-F,minY:b-D,maxX:y+F,maxY:b+D}).map(h=>this.signMap.get(h.id)).filter(h=>h!=null)}getAllAreas(){return Array.from(this.areaMap.values())}getAllSigns(){return Array.from(this.signMap.values())}}const of=new nv;var Os=63710088e-1,iv={centimeters:Os*100,centimetres:Os*100,degrees:Os/111325,feet:Os*3.28084,inches:Os*39.37,kilometers:Os/1e3,kilometres:Os/1e3,meters:Os,metres:Os,miles:Os/1609.344,millimeters:Os*1e3,millimetres:Os*1e3,nauticalmiles:Os/1852,radians:1,yards:Os*1.0936};function sv(_,y,b){b===void 0&&(b={});var C={type:"Feature"};return(b.id===0||b.id)&&(C.id=b.id),b.bbox&&(C.bbox=b.bbox),C.properties={},C.geometry=_,C}function Bm(_,y,b){if(b===void 0&&(b={}),!_)throw new Error("coordinates is required");if(!Array.isArray(_))throw new Error("coordinates must be an Array");if(_.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Og(_[0])||!Og(_[1]))throw new Error("coordinates must contain numbers");var C={type:"Point",coordinates:_};return sv(C,y,b)}function av(_,y){y===void 0&&(y="kilometers");var b=iv[y];if(!b)throw new Error(y+" units is invalid");return _*b}function lf(_){var y=_%360;return y*Math.PI/180}function Og(_){return!isNaN(_)&&_!==null&&!Array.isArray(_)}function Fm(_){if(!_)throw new Error("coord is required");if(!Array.isArray(_)){if(_.type==="Feature"&&_.geometry!==null&&_.geometry.type==="Point")return _.geometry.coordinates;if(_.type==="Point")return _.coordinates}if(Array.isArray(_)&&_.length>=2&&!Array.isArray(_[0])&&!Array.isArray(_[1]))return _;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function ov(_){return _.type==="Feature"?_.geometry:_}function lv(_,y,b){if(b===void 0&&(b={}),!_)throw new Error("point is required");if(!y)throw new Error("polygon is required");var C=Fm(_),D=ov(y),F=D.type,T=y.bbox,h=D.coordinates;if(T&&uv(C,T)===!1)return!1;F==="Polygon"&&(h=[h]);for(var W=!1,ue=0;ue<h.length&&!W;ue++)if(Ng(C,h[ue][0],b.ignoreBoundary)){for(var ne=!1,Y=1;Y<h[ue].length&&!ne;)Ng(C,h[ue][Y],!b.ignoreBoundary)&&(ne=!0),Y++;ne||(W=!0)}return W}function Ng(_,y,b){var C=!1;y[0][0]===y[y.length-1][0]&&y[0][1]===y[y.length-1][1]&&(y=y.slice(0,y.length-1));for(var D=0,F=y.length-1;D<y.length;F=D++){var T=y[D][0],h=y[D][1],W=y[F][0],ue=y[F][1],ne=_[1]*(T-W)+h*(W-_[0])+ue*(_[0]-T)===0&&(T-_[0])*(W-_[0])<=0&&(h-_[1])*(ue-_[1])<=0;if(ne)return!b;var Y=h>_[1]!=ue>_[1]&&_[0]<(W-T)*(_[1]-h)/(ue-h)+T;Y&&(C=!C)}return C}function uv(_,y){return y[0]<=_[0]&&y[1]<=_[1]&&y[2]>=_[0]&&y[3]>=_[1]}function cv(_,y,b,C=new Date){const D=Bm([y.lng,y.lat]);if(!lv(D,_.geometry))return!1;if(_.alkuPvm){const T=new Date(_.alkuPvm);if(C<T)return!1}if(_.loppuPvm){const T=new Date(_.loppuPvm);if(C>T)return!1}return!(!b.ammattiliikenne&&_.poikkeus&&_.poikkeus.toLowerCase().includes("huvi")||!b.vesiskootteri&&_.rajoitustyyppi&&_.rajoitustyyppi.toLowerCase().includes("vesiskootterilla"))}function hv(_,y,b){const C=new Date,D=[];for(const T of _)cv(T,y,b,C)&&D.push({...T});const F=D.filter(T=>T.suuruusKmh!=null);if(F.length>0){const T=F.reduce((h,W)=>W.suuruusKmh<h.suuruusKmh?W:h);T.isPrimary=!0}return D.sort((T,h)=>T.isPrimary&&!h.isPrimary?-1:!T.isPrimary&&h.isPrimary?1:T.suuruusKmh!=null&&h.suuruusKmh!=null?T.suuruusKmh-h.suuruusKmh:T.suuruusKmh!=null?-1:h.suuruusKmh!=null?1:T.rajoitustyyppi.localeCompare(h.rajoitustyyppi,"fi")),D}function jg(_){return _.suuruusKmh!=null?`Nopeusrajoitus ${_.suuruusKmh} km/h`:_.rajoitustyyppi||"Rajoitus"}function dv(_,y,b){b===void 0&&(b={});var C=Fm(_),D=Fm(y),F=lf(D[1]-C[1]),T=lf(D[0]-C[0]),h=lf(C[1]),W=lf(D[1]),ue=Math.pow(Math.sin(F/2),2)+Math.pow(Math.sin(T/2),2)*Math.cos(h)*Math.cos(W);return av(2*Math.atan2(Math.sqrt(ue),Math.sqrt(1-ue)),b.units)}function pv(_,y,b){const C=Bm([y.lng,y.lat]),D=[];for(const F of _){if(b.selectedVlmtyyppi.size>0&&!b.selectedVlmtyyppi.has(F.vlmtyyppi))continue;const T=Bm(F.geometry.coordinates),h=dv(C,T,{units:"meters"});h<=b.nearbyRadius&&D.push({...F,distance:Math.round(h),iconUrl:fv(F.iconKey)})}return D.sort((F,T)=>F.distance-T.distance),D}function fv(_){return`/icons/${_}.png`}function Vg(_){return _.nimiFi||_.nimiSv||`Merkki ${_.vlmlajityyppi}`}function mv(_){return _<1e3?`${_} m`:`${(_/1e3).toFixed(1)} km`}function gv(_){const y=new Set;return _.forEach(b=>y.add(b.vlmtyyppi)),Array.from(y).sort((b,C)=>b-C)}var gf={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */var yv=gf.exports,Ug;function _v(){return Ug||(Ug=1,(function(_,y){(function(b,C){_.exports=C()})(yv,(function(){var b={},C={};function D(T,h,W){if(C[T]=W,T==="index"){var ue="var sharedModule = {}; ("+C.shared+")(sharedModule); ("+C.worker+")(sharedModule);",ne={};return C.shared(ne),C.index(b,ne),typeof window<"u"&&b.setWorkerUrl(window.URL.createObjectURL(new Blob([ue],{type:"text/javascript"}))),b}}D("shared",["exports"],(function(T){function h(r,t,n,o){return new(n||(n=Promise))((function(c,m){function g(P){try{S(o.next(P))}catch(z){m(z)}}function x(P){try{S(o.throw(P))}catch(z){m(z)}}function S(P){var z;P.done?c(P.value):(z=P.value,z instanceof n?z:new n((function(L){L(z)}))).then(g,x)}S((o=o.apply(r,t||[])).next())}))}function W(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}typeof SuppressedError=="function"&&SuppressedError;var ue=ne;function ne(r,t){this.x=r,this.y=t}ne.prototype={clone:function(){return new ne(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,t){return this.clone()._rotateAround(r,t)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var t=r.x-this.x,n=r.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,t){return Math.atan2(this.x*t-this.y*r,this.x*r+this.y*t)},_matMult:function(r){var t=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=t,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var t=Math.cos(r),n=Math.sin(r),o=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=o,this},_rotateAround:function(r,t){var n=Math.cos(r),o=Math.sin(r),c=t.y+o*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-o*(this.y-t.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ne.convert=function(r){return r instanceof ne?r:Array.isArray(r)?new ne(r[0],r[1]):r};var Y=W(ue),Z=Ie;function Ie(r,t,n,o){this.cx=3*r,this.bx=3*(n-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(o-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=t,this.p2x=n,this.p2y=o}Ie.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,t){if(t===void 0&&(t=1e-6),r<0)return 0;if(r>1)return 1;for(var n=r,o=0;o<8;o++){var c=this.sampleCurveX(n)-r;if(Math.abs(c)<t)return n;var m=this.sampleCurveDerivativeX(n);if(Math.abs(m)<1e-6)break;n-=c/m}var g=0,x=1;for(n=r,o=0;o<20&&(c=this.sampleCurveX(n),!(Math.abs(c-r)<t));o++)r>c?g=n:x=n,n=.5*(x-g)+g;return n},solve:function(r,t){return this.sampleCurveY(this.solveCurveX(r,t))}};var Re=W(Z);let Pe,Le;function De(){return Pe==null&&(Pe=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Pe}function ze(){if(Le==null&&(Le=!1,De())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let o=0;o<25;o++){const c=4*o;t.fillStyle=`rgb(${c},${c+1},${c+2})`,t.fillRect(o%5,Math.floor(o/5),1,1)}const n=t.getImageData(0,0,5,5).data;for(let o=0;o<100;o++)if(o%4!=3&&n[o]!==o){Le=!0;break}}}return Le||!1}function Ue(r,t,n,o){const c=new Re(r,t,n,o);return m=>c.solve(m)}const et=Ue(.25,.1,.25,1);function Je(r,t,n){return Math.min(n,Math.max(t,r))}function He(r,t,n){const o=n-t,c=((r-t)%o+o)%o+t;return c===t?n:c}function je(r,...t){for(const n of t)for(const o in n)r[o]=n[o];return r}let pt=1;function $e(r,t,n){const o={};for(const c in r)o[c]=t.call(this,r[c],c,r);return o}function ar(r,t,n){const o={};for(const c in r)t.call(this,r[c],c,r)&&(o[c]=r[c]);return o}function xt(r){return Array.isArray(r)?r.map(xt):typeof r=="object"&&r?$e(r,xt):r}const wr={};function Zt(r){wr[r]||(typeof console<"u"&&console.warn(r),wr[r]=!0)}function Nt(r,t,n){return(n.y-r.y)*(t.x-r.x)>(t.y-r.y)*(n.x-r.x)}function Mr(r){return typeof WorkerGlobalScope<"u"&&r!==void 0&&r instanceof WorkerGlobalScope}let Pr=null;function $t(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}const ot="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Pt(r,t,n,o,c){return h(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const m=new VideoFrame(r,{timestamp:0});try{const g=m==null?void 0:m.format;if(!g||!g.startsWith("BGR")&&!g.startsWith("RGB"))throw new Error(`Unrecognized format ${g}`);const x=g.startsWith("BGR"),S=new Uint8ClampedArray(o*c*4);if(yield m.copyTo(S,(function(P,z,L,O,V){const q=4*Math.max(-z,0),K=(Math.max(0,L)-L)*O*4+q,re=4*O,oe=Math.max(0,z),we=Math.max(0,L);return{rect:{x:oe,y:we,width:Math.min(P.width,z+O)-oe,height:Math.min(P.height,L+V)-we},layout:[{offset:K,stride:re}]}})(r,t,n,o,c)),x)for(let P=0;P<S.length;P+=4){const z=S[P];S[P]=S[P+2],S[P+2]=z}return S}finally{m.close()}}))}let ft,xe;const Ne="AbortError";function Xt(){return new Error(Ne)}const Yt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function nr(r){return Yt.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))]}const cr="global-dispatcher";class ur extends Error{constructor(t,n,o,c){super(`AJAXError: ${n} (${t}): ${o}`),this.status=t,this.statusText=n,this.url=o,this.body=c}}const or=()=>Mr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Ir=function(r,t){if(/:\/\//.test(r.url)&&!/^https?:|^file:/.test(r.url)){const o=nr(r.url);if(o)return o(r,t);if(Mr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,targetMapId:cr},t)}if(!(/^file:/.test(n=r.url)||/^file:/.test(or())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(o,c){return h(this,void 0,void 0,(function*(){const m=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:or(),signal:c.signal});o.type!=="json"||m.headers.has("Accept")||m.headers.set("Accept","application/json");const g=yield fetch(m);if(!g.ok){const P=yield g.blob();throw new ur(g.status,g.statusText,o.url,P)}let x;x=o.type==="arrayBuffer"||o.type==="image"?g.arrayBuffer():o.type==="json"?g.json():g.text();const S=yield x;if(c.signal.aborted)throw Xt();return{data:S,cacheControl:g.headers.get("Cache-Control"),expires:g.headers.get("Expires")}}))})(r,t);if(Mr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,mustQueue:!0,targetMapId:cr},t)}var n;return(function(o,c){return new Promise(((m,g)=>{var x;const S=new XMLHttpRequest;S.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(S.responseType="arraybuffer");for(const P in o.headers)S.setRequestHeader(P,o.headers[P]);o.type==="json"&&(S.responseType="text",!((x=o.headers)===null||x===void 0)&&x.Accept||S.setRequestHeader("Accept","application/json")),S.withCredentials=o.credentials==="include",S.onerror=()=>{g(new Error(S.statusText))},S.onload=()=>{if(!c.signal.aborted)if((S.status>=200&&S.status<300||S.status===0)&&S.response!==null){let P=S.response;if(o.type==="json")try{P=JSON.parse(S.response)}catch(z){return void g(z)}m({data:P,cacheControl:S.getResponseHeader("Cache-Control"),expires:S.getResponseHeader("Expires")})}else{const P=new Blob([S.response],{type:S.getResponseHeader("Content-Type")});g(new ur(S.status,S.statusText,o.url,P))}},c.signal.addEventListener("abort",(()=>{S.abort(),g(Xt())})),S.send(o.body)}))})(r,t)};function mn(r){if(!r||r.indexOf("://")<=0||r.indexOf("data:image/")===0||r.indexOf("blob:")===0)return!0;const t=new URL(r),n=window.location;return t.protocol===n.protocol&&t.host===n.host}function pa(r,t,n){n[r]&&n[r].indexOf(t)!==-1||(n[r]=n[r]||[],n[r].push(t))}function ws(r,t,n){if(n&&n[r]){const o=n[r].indexOf(t);o!==-1&&n[r].splice(o,1)}}class Yi{constructor(t,n={}){je(this,n),this.type=t}}class bs extends Yi{constructor(t,n={}){super("error",je({error:t},n))}}class Ra{on(t,n){return this._listeners=this._listeners||{},pa(t,n,this._listeners),this}off(t,n){return ws(t,n,this._listeners),ws(t,n,this._oneTimeListeners),this}once(t,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},pa(t,n,this._oneTimeListeners),this):new Promise((o=>this.once(t,o)))}fire(t,n){typeof t=="string"&&(t=new Yi(t,n||{}));const o=t.type;if(this.listens(o)){t.target=this;const c=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const x of c)x.call(this,t);const m=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const x of m)ws(o,x,this._oneTimeListeners),x.call(this,t);const g=this._eventedParent;g&&(je(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(t))}else t instanceof bs&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,n){return this._eventedParent=t,this._eventedParentData=n,this}}var Ee={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Ns=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function co(r,t){const n={};for(const o in r)o!=="ref"&&(n[o]=r[o]);return Ns.forEach((o=>{o in t&&(n[o]=t[o])})),n}function pr(r,t){if(Array.isArray(r)){if(!Array.isArray(t)||r.length!==t.length)return!1;for(let n=0;n<r.length;n++)if(!pr(r[n],t[n]))return!1;return!0}if(typeof r=="object"&&r!==null&&t!==null){if(typeof t!="object"||Object.keys(r).length!==Object.keys(t).length)return!1;for(const n in r)if(!pr(r[n],t[n]))return!1;return!0}return r===t}function Rr(r,t){r.push(t)}function Ss(r,t,n){Rr(n,{command:"addSource",args:[r,t[r]]})}function ks(r,t,n){Rr(t,{command:"removeSource",args:[r]}),n[r]=!0}function Ts(r,t,n,o){ks(r,n,o),Ss(r,t,n)}function Ba(r,t,n){let o;for(o in r[n])if(Object.prototype.hasOwnProperty.call(r[n],o)&&o!=="data"&&!pr(r[n][o],t[n][o]))return!1;for(o in t[n])if(Object.prototype.hasOwnProperty.call(t[n],o)&&o!=="data"&&!pr(r[n][o],t[n][o]))return!1;return!0}function mi(r,t,n,o,c,m){r=r||{},t=t||{};for(const g in r)Object.prototype.hasOwnProperty.call(r,g)&&(pr(r[g],t[g])||n.push({command:m,args:[o,g,t[g],c]}));for(const g in t)Object.prototype.hasOwnProperty.call(t,g)&&!Object.prototype.hasOwnProperty.call(r,g)&&(pr(r[g],t[g])||n.push({command:m,args:[o,g,t[g],c]}))}function ho(r){return r.id}function Fa(r,t){return r[t.id]=t,r}class Ke{constructor(t,n,o,c){this.message=(t?`${t}: `:"")+o,c&&(this.identifier=c),n!=null&&n.__line__&&(this.line=n.__line__)}}function Ji(r,...t){for(const n of t)for(const o in n)r[o]=n[o];return r}class gn extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}class Jn{constructor(t,n=[]){this.parent=t,this.bindings={};for(const[o,c]of n)this.bindings[o]=c}concat(t){return new Jn(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const fa={kind:"null"},rt={kind:"number"},Jt={kind:"string"},Rt={kind:"boolean"},Ln={kind:"color"},gi={kind:"object"},jt={kind:"value"},Ai={kind:"collator"},Qi={kind:"formatted"},yi={kind:"padding"},Un={kind:"resolvedImage"},ie={kind:"variableAnchorOffsetCollection"};function j(r,t){return{kind:"array",itemType:r,N:t}}function N(r){if(r.kind==="array"){const t=N(r.itemType);return typeof r.N=="number"?`array<${t}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${t}>`}return r.kind}const H=[fa,rt,Jt,Rt,Ln,Qi,gi,j(jt),yi,Un,ie];function ee(r,t){if(t.kind==="error")return null;if(r.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!ee(r.itemType,t.itemType))&&(typeof r.N!="number"||r.N===t.N))return null}else{if(r.kind===t.kind)return null;if(r.kind==="value"){for(const n of H)if(!ee(n,t))return null}}return`Expected ${N(r)} but found ${N(t)} instead.`}function he(r,t){return t.some((n=>n.kind===r.kind))}function me(r,t){return t.some((n=>n==="null"?r===null:n==="array"?Array.isArray(r):n==="object"?r&&!Array.isArray(r)&&typeof r=="object":n===typeof r))}function ve(r,t){return r.kind==="array"&&t.kind==="array"?r.itemType.kind===t.itemType.kind&&typeof r.N=="number":r.kind===t.kind}const le=.96422,Me=.82521,Oe=4/29,ke=6/29,Ye=3*ke*ke,wt=ke*ke*ke,Ct=Math.PI/180,fr=180/Math.PI;function Gt(r){return(r%=360)<0&&(r+=360),r}function mr([r,t,n,o]){let c,m;const g=sn((.2225045*(r=Wt(r))+.7168786*(t=Wt(t))+.0606169*(n=Wt(n)))/1);r===t&&t===n?c=m=g:(c=sn((.4360747*r+.3850649*t+.1430804*n)/le),m=sn((.0139322*r+.0971045*t+.7141733*n)/Me));const x=116*g-16;return[x<0?0:x,500*(c-g),200*(g-m),o]}function Wt(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function sn(r){return r>wt?Math.pow(r,1/3):r/Ye+Oe}function Gr([r,t,n,o]){let c=(r+16)/116,m=isNaN(t)?c:c+t/500,g=isNaN(n)?c:c-n/200;return c=1*br(c),m=le*br(m),g=Me*br(g),[tr(3.1338561*m-1.6168667*c-.4906146*g),tr(-.9787684*m+1.9161415*c+.033454*g),tr(.0719453*m-.2289914*c+1.4052427*g),o]}function tr(r){return(r=r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055)<0?0:r>1?1:r}function br(r){return r>ke?r*r*r:Ye*(r-Oe)}function jr(r){return parseInt(r.padEnd(2,r),16)/255}function yn(r,t){return Sn(t?r/100:r,0,1)}function Sn(r,t,n){return Math.min(Math.max(t,r),n)}function $n(r){return!r.some(Number.isNaN)}const po={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Vt{constructor(t,n,o,c=1,m=!0){this.r=t,this.g=n,this.b=o,this.a=c,m||(this.r*=c,this.g*=c,this.b*=c,c||this.overwriteGetter("rgb",[t,n,o,c]))}static parse(t){if(t instanceof Vt)return t;if(typeof t!="string")return;const n=(function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const c=po[o];if(c){const[g,x,S]=c;return[g/255,x/255,S/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const g=o.length<6?1:2;let x=1;return[jr(o.slice(x,x+=g)),jr(o.slice(x,x+=g)),jr(o.slice(x,x+=g)),jr(o.slice(x,x+g)||"ff")]}if(o.startsWith("rgb")){const g=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[x,S,P,z,L,O,V,q,K,re,oe,we]=g,de=[z||" ",V||" ",re].join("");if(de==="  "||de==="  /"||de===",,"||de===",,,"){const _e=[P,O,K].join(""),Ae=_e==="%%%"?100:_e===""?255:0;if(Ae){const Ve=[Sn(+S/Ae,0,1),Sn(+L/Ae,0,1),Sn(+q/Ae,0,1),oe?yn(+oe,we):1];if($n(Ve))return Ve}}return}}const m=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(m){const[g,x,S,P,z,L,O,V,q]=m,K=[S||" ",z||" ",O].join("");if(K==="  "||K==="  /"||K===",,"||K===",,,"){const re=[+x,Sn(+P,0,100),Sn(+L,0,100),V?yn(+V,q):1];if($n(re))return(function([oe,we,de,_e]){function Ae(Ve){const dt=(Ve+oe/30)%12,Lt=we*Math.min(de,1-de);return de-Lt*Math.max(-1,Math.min(dt-3,9-dt,1))}return oe=Gt(oe),we/=100,de/=100,[Ae(0),Ae(8),Ae(4),_e]})(re)}}})(t);return n?new Vt(...n,!1):void 0}get rgb(){const{r:t,g:n,b:o,a:c}=this,m=c||1/0;return this.overwriteGetter("rgb",[t/m,n/m,o/m,c])}get hcl(){return this.overwriteGetter("hcl",(function(t){const[n,o,c,m]=mr(t),g=Math.sqrt(o*o+c*c);return[Math.round(1e4*g)?Gt(Math.atan2(c,o)*fr):NaN,g,n,m]})(this.rgb))}get lab(){return this.overwriteGetter("lab",mr(this.rgb))}overwriteGetter(t,n){return Object.defineProperty(this,t,{value:n}),n}toString(){const[t,n,o,c]=this.rgb;return`rgba(${[t,n,o].map((m=>Math.round(255*m))).join(",")},${c})`}}Vt.black=new Vt(0,0,0,1),Vt.white=new Vt(1,1,1,1),Vt.transparent=new Vt(0,0,0,0),Vt.red=new Vt(1,0,0,1);class zu{constructor(t,n,o){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class tl{constructor(t,n,o,c,m){this.text=t,this.image=n,this.scale=o,this.fontStack=c,this.textColor=m}}class Qn{constructor(t){this.sections=t}static fromString(t){return new Qn([new tl(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((t=>t.text.length!==0||t.image&&t.image.name.length!==0))}static factory(t){return t instanceof Qn?t:Qn.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map((t=>t.text)).join("")}}class Rn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Rn)return t;if(typeof t=="number")return new Rn([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const n of t)if(typeof n!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new Rn(t)}}toString(){return JSON.stringify(this.values)}}const Jh=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class _i{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof _i)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let n=0;n<t.length;n+=2){const o=t[n],c=t[n+1];if(typeof o!="string"||!Jh.has(o)||!Array.isArray(c)||c.length!==2||typeof c[0]!="number"||typeof c[1]!="number")return}return new _i(t)}}toString(){return JSON.stringify(this.values)}}class Bn{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Bn({name:t,available:!1}):null}}function qn(r,t,n,o){return typeof r=="number"&&r>=0&&r<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof n=="number"&&n>=0&&n<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[r,t,n,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[r,t,n,o]:[r,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Oa(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof Vt||r instanceof zu||r instanceof Qn||r instanceof Rn||r instanceof _i||r instanceof Bn)return!0;if(Array.isArray(r)){for(const t of r)if(!Oa(t))return!1;return!0}if(typeof r=="object"){for(const t in r)if(!Oa(r[t]))return!1;return!0}return!1}function Er(r){if(r===null)return fa;if(typeof r=="string")return Jt;if(typeof r=="boolean")return Rt;if(typeof r=="number")return rt;if(r instanceof Vt)return Ln;if(r instanceof zu)return Ai;if(r instanceof Qn)return Qi;if(r instanceof Rn)return yi;if(r instanceof _i)return ie;if(r instanceof Bn)return Un;if(Array.isArray(r)){const t=r.length;let n;for(const o of r){const c=Er(o);if(n){if(n===c)continue;n=jt;break}n=c}return j(n||jt,t)}return gi}function rl(r){const t=typeof r;return r===null?"":t==="string"||t==="number"||t==="boolean"?String(r):r instanceof Vt||r instanceof Qn||r instanceof Rn||r instanceof _i||r instanceof Bn?r.toString():JSON.stringify(r)}class es{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(t.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Oa(t[1]))return n.error("invalid value");const o=t[1];let c=Er(o);const m=n.expectedType;return c.kind!=="array"||c.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(c=m),new es(c,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class an{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const Na={string:Jt,number:rt,boolean:Rt,object:gi};class ei{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let o,c=1;const m=t[0];if(m==="array"){let x,S;if(t.length>2){const P=t[1];if(typeof P!="string"||!(P in Na)||P==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);x=Na[P],c++}else x=jt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);S=t[2],c++}o=j(x,S)}else{if(!Na[m])throw new Error(`Types doesn't contain name = ${m}`);o=Na[m]}const g=[];for(;c<t.length;c++){const x=n.parse(t[c],c,jt);if(!x)return null;g.push(x)}return new ei(o,g)}evaluate(t){for(let n=0;n<this.args.length;n++){const o=this.args[n].evaluate(t);if(!ee(this.type,Er(o)))return o;if(n===this.args.length-1)throw new an(`Expected value to be of type ${N(this.type)}, but found ${N(Er(o))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const ja={"to-boolean":Rt,"to-color":Ln,"to-number":rt,"to-string":Jt};class ti{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const o=t[0];if(!ja[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&t.length!==2)return n.error("Expected one argument.");const c=ja[o],m=[];for(let g=1;g<t.length;g++){const x=n.parse(t[g],g,jt);if(!x)return null;m.push(x)}return new ti(c,m)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let n,o;for(const c of this.args){if(n=c.evaluate(t),o=null,n instanceof Vt)return n;if(typeof n=="string"){const m=t.parseColor(n);if(m)return m}else if(Array.isArray(n)&&(o=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:qn(n[0],n[1],n[2],n[3]),!o))return new Vt(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new an(o||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const o of this.args){n=o.evaluate(t);const c=Rn.parse(n);if(c)return c}throw new an(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const o of this.args){n=o.evaluate(t);const c=_i.parse(n);if(c)return c}throw new an(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const o of this.args){if(n=o.evaluate(t),n===null)return 0;const c=Number(n);if(!isNaN(c))return c}throw new an(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return Qn.fromString(rl(this.args[0].evaluate(t)));case"resolvedImage":return Bn.fromString(rl(this.args[0].evaluate(t)));default:return rl(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const Qh=["Unknown","Point","LineString","Polygon"];class $l{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Qh[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let n=this._parseColorCache[t];return n||(n=this._parseColorCache[t]=Vt.parse(t)),n}}class js{constructor(t,n,o=[],c,m=new Jn,g=[]){this.registry=t,this.path=o,this.key=o.map((x=>`[${x}]`)).join(""),this.scope=m,this.errors=g,this.expectedType=c,this._isConstant=n}parse(t,n,o,c,m={}){return n?this.concat(n,o,c)._parse(t,m):this._parse(t,m)}_parse(t,n){function o(c,m,g){return g==="assert"?new ei(m,[c]):g==="coerce"?new ti(m,[c]):c}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=t[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[c];if(m){let g=m.parse(t,this);if(!g)return null;if(this.expectedType){const x=this.expectedType,S=g.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||S.kind!=="value")if(x.kind!=="color"&&x.kind!=="formatted"&&x.kind!=="resolvedImage"||S.kind!=="value"&&S.kind!=="string")if(x.kind!=="padding"||S.kind!=="value"&&S.kind!=="number"&&S.kind!=="array")if(x.kind!=="variableAnchorOffsetCollection"||S.kind!=="value"&&S.kind!=="array"){if(this.checkSubtype(x,S))return null}else g=o(g,x,n.typeAnnotation||"coerce");else g=o(g,x,n.typeAnnotation||"coerce");else g=o(g,x,n.typeAnnotation||"coerce");else g=o(g,x,n.typeAnnotation||"assert")}if(!(g instanceof es)&&g.type.kind!=="resolvedImage"&&this._isConstant(g)){const x=new $l;try{g=new es(g.type,g.evaluate(x))}catch(S){return this.error(S.message),null}}return g}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,n,o){const c=typeof t=="number"?this.path.concat(t):this.path,m=o?this.scope.concat(o):this.scope;return new js(this.registry,this._isConstant,c,n||null,m,this.errors)}error(t,...n){const o=`${this.key}${n.map((c=>`[${c}]`)).join("")}`;this.errors.push(new gn(o,t))}checkSubtype(t,n){const o=ee(t,n);return o&&this.error(o),o}}class Vs{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const o=[];for(let m=1;m<t.length-1;m+=2){const g=t[m];if(typeof g!="string")return n.error(`Expected string, but found ${typeof g} instead.`,m);if(/[^a-zA-Z0-9_]/.test(g))return n.error("Variable names must contain only alphanumeric characters or '_'.",m);const x=n.parse(t[m+1],m+1);if(!x)return null;o.push([g,x])}const c=n.parse(t[t.length-1],t.length-1,n.expectedType,o);return c?new Vs(o,c):null}outputDefined(){return this.result.outputDefined()}}class gr{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(t.length!==2||typeof t[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const o=t[1];return n.scope.has(o)?new gr(o,n.scope.get(o)):n.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Va{constructor(t,n,o){this.type=t,this.index=n,this.input=o}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,rt),c=n.parse(t[2],2,j(n.expectedType||jt));return o&&c?new Va(c.type.itemType,o,c):null}evaluate(t){const n=this.index.evaluate(t),o=this.input.evaluate(t);if(n<0)throw new an(`Array index out of bounds: ${n} < 0.`);if(n>=o.length)throw new an(`Array index out of bounds: ${n} > ${o.length-1}.`);if(n!==Math.floor(n))throw new an(`Array index must be an integer, but found ${n} instead.`);return o[n]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Du{constructor(t,n){this.type=Rt,this.needle=t,this.haystack=n}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,jt),c=n.parse(t[2],2,jt);return o&&c?he(o.type,[Rt,Jt,rt,fa,jt])?new Du(o,c):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${N(o.type)} instead`):null}evaluate(t){const n=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!o)return!1;if(!me(n,["boolean","string","number","null"]))throw new an(`Expected first argument to be of type boolean, string, number or null, but found ${N(Er(n))} instead.`);if(!me(o,["string","array"]))throw new an(`Expected second argument to be of type array or string, but found ${N(Er(o))} instead.`);return o.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class ma{constructor(t,n,o){this.type=rt,this.needle=t,this.haystack=n,this.fromIndex=o}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,jt),c=n.parse(t[2],2,jt);if(!o||!c)return null;if(!he(o.type,[Rt,Jt,rt,fa,jt]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${N(o.type)} instead`);if(t.length===4){const m=n.parse(t[3],3,rt);return m?new ma(o,c,m):null}return new ma(o,c)}evaluate(t){const n=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!me(n,["boolean","string","number","null"]))throw new an(`Expected first argument to be of type boolean, string, number or null, but found ${N(Er(n))} instead.`);let c;if(this.fromIndex&&(c=this.fromIndex.evaluate(t)),me(o,["string"])){const m=o.indexOf(n,c);return m===-1?-1:[...o.slice(0,m)].length}if(me(o,["array"]))return o.indexOf(n,c);throw new an(`Expected second argument to be of type array or string, but found ${N(Er(o))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Sr{constructor(t,n,o,c,m,g){this.inputType=t,this.type=n,this.input=o,this.cases=c,this.outputs=m,this.otherwise=g}static parse(t,n){if(t.length<5)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return n.error("Expected an even number of arguments.");let o,c;n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);const m={},g=[];for(let P=2;P<t.length-1;P+=2){let z=t[P];const L=t[P+1];Array.isArray(z)||(z=[z]);const O=n.concat(P);if(z.length===0)return O.error("Expected at least one branch label.");for(const q of z){if(typeof q!="number"&&typeof q!="string")return O.error("Branch labels must be numbers or strings.");if(typeof q=="number"&&Math.abs(q)>Number.MAX_SAFE_INTEGER)return O.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof q=="number"&&Math.floor(q)!==q)return O.error("Numeric branch labels must be integer values.");if(o){if(O.checkSubtype(o,Er(q)))return null}else o=Er(q);if(m[String(q)]!==void 0)return O.error("Branch labels must be unique.");m[String(q)]=g.length}const V=n.parse(L,P,c);if(!V)return null;c=c||V.type,g.push(V)}const x=n.parse(t[1],1,jt);if(!x)return null;const S=n.parse(t[t.length-1],t.length-1,c);return S?x.type.kind!=="value"&&n.concat(1).checkSubtype(o,x.type)?null:new Sr(o,c,x,m,g,S):null}evaluate(t){const n=this.input.evaluate(t);return(Er(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}}class nl{constructor(t,n,o){this.type=t,this.branches=n,this.otherwise=o}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return n.error("Expected an odd number of arguments.");let o;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);const c=[];for(let g=1;g<t.length-1;g+=2){const x=n.parse(t[g],g,Rt);if(!x)return null;const S=n.parse(t[g+1],g+1,o);if(!S)return null;c.push([x,S]),o=o||S.type}const m=n.parse(t[t.length-1],t.length-1,o);if(!m)return null;if(!o)throw new Error("Can't infer output type");return new nl(o,c,m)}evaluate(t){for(const[n,o]of this.branches)if(n.evaluate(t))return o.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[n,o]of this.branches)t(n),t(o);t(this.otherwise)}outputDefined(){return this.branches.every((([t,n])=>n.outputDefined()))&&this.otherwise.outputDefined()}}class fo{constructor(t,n,o,c){this.type=t,this.input=n,this.beginIndex=o,this.endIndex=c}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,jt),c=n.parse(t[2],2,rt);if(!o||!c)return null;if(!he(o.type,[j(jt),Jt,jt]))return n.error(`Expected first argument to be of type array or string, but found ${N(o.type)} instead`);if(t.length===4){const m=n.parse(t[3],3,rt);return m?new fo(o.type,o,c,m):null}return new fo(o.type,o,c)}evaluate(t){const n=this.input.evaluate(t),o=this.beginIndex.evaluate(t);let c;if(this.endIndex&&(c=this.endIndex.evaluate(t)),me(n,["string"]))return[...n].slice(o,c).join("");if(me(n,["array"]))return n.slice(o,c);throw new an(`Expected first argument to be of type array or string, but found ${N(Er(n))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function mo(r,t){const n=r.length-1;let o,c,m=0,g=n,x=0;for(;m<=g;)if(x=Math.floor((m+g)/2),o=r[x],c=r[x+1],o<=t){if(x===n||t<c)return x;m=x+1}else{if(!(o>t))throw new an("Input is not a number.");g=x-1}return 0}class Ua{constructor(t,n,o){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(const[c,m]of o)this.labels.push(c),this.outputs.push(m)}static parse(t,n){if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");const o=n.parse(t[1],1,rt);if(!o)return null;const c=[];let m=null;n.expectedType&&n.expectedType.kind!=="value"&&(m=n.expectedType);for(let g=1;g<t.length;g+=2){const x=g===1?-1/0:t[g],S=t[g+1],P=g,z=g+1;if(typeof x!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(c.length&&c[c.length-1][0]>=x)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);const L=n.parse(S,z,m);if(!L)return null;m=m||L.type,c.push([x,L])}return new Ua(m,o,c)}evaluate(t){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(t);const c=this.input.evaluate(t);if(c<=n[0])return o[0].evaluate(t);const m=n.length;return c>=n[m-1]?o[m-1].evaluate(t):o[mo(n,c)].evaluate(t)}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function Lu(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var qc=ql;function ql(r,t,n,o){this.cx=3*r,this.bx=3*(n-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(o-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=t,this.p2x=n,this.p2y=o}ql.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,t){if(t===void 0&&(t=1e-6),r<0)return 0;if(r>1)return 1;for(var n=r,o=0;o<8;o++){var c=this.sampleCurveX(n)-r;if(Math.abs(c)<t)return n;var m=this.sampleCurveDerivativeX(n);if(Math.abs(m)<1e-6)break;n-=c/m}var g=0,x=1;for(n=r,o=0;o<20&&(c=this.sampleCurveX(n),!(Math.abs(c-r)<t));o++)r>c?g=n:x=n,n=.5*(x-g)+g;return n},solve:function(r,t){return this.sampleCurveY(this.solveCurveX(r,t))}};var Zl=Lu(qc);function ri(r,t,n){return r+n*(t-r)}function zi(r,t,n){return r.map(((o,c)=>ri(o,t[c],n)))}const on={number:ri,color:function(r,t,n,o="rgb"){switch(o){case"rgb":{const[c,m,g,x]=zi(r.rgb,t.rgb,n);return new Vt(c,m,g,x,!1)}case"hcl":{const[c,m,g,x]=r.hcl,[S,P,z,L]=t.hcl;let O,V;if(isNaN(c)||isNaN(S))isNaN(c)?isNaN(S)?O=NaN:(O=S,g!==1&&g!==0||(V=P)):(O=c,z!==1&&z!==0||(V=m));else{let we=S-c;S>c&&we>180?we-=360:S<c&&c-S>180&&(we+=360),O=c+n*we}const[q,K,re,oe]=(function([we,de,_e,Ae]){return we=isNaN(we)?0:we*Ct,Gr([_e,Math.cos(we)*de,Math.sin(we)*de,Ae])})([O,V??ri(m,P,n),ri(g,z,n),ri(x,L,n)]);return new Vt(q,K,re,oe,!1)}case"lab":{const[c,m,g,x]=Gr(zi(r.lab,t.lab,n));return new Vt(c,m,g,x,!1)}}},array:zi,padding:function(r,t,n){return new Rn(zi(r.values,t.values,n))},variableAnchorOffsetCollection:function(r,t,n){const o=r.values,c=t.values;if(o.length!==c.length)throw new an(`Cannot interpolate values of different length. from: ${r.toString()}, to: ${t.toString()}`);const m=[];for(let g=0;g<o.length;g+=2){if(o[g]!==c[g])throw new an(`Cannot interpolate values containing mismatched anchors. from[${g}]: ${o[g]}, to[${g}]: ${c[g]}`);m.push(o[g]);const[x,S]=o[g+1],[P,z]=c[g+1];m.push([ri(x,P,n),ri(S,z,n)])}return new _i(m)}};class kn{constructor(t,n,o,c,m){this.type=t,this.operator=n,this.interpolation=o,this.input=c,this.labels=[],this.outputs=[];for(const[g,x]of m)this.labels.push(g),this.outputs.push(x)}static interpolationFactor(t,n,o,c){let m=0;if(t.name==="exponential")m=ga(n,t.base,o,c);else if(t.name==="linear")m=ga(n,1,o,c);else if(t.name==="cubic-bezier"){const g=t.controlPoints;m=new Zl(g[0],g[1],g[2],g[3]).solve(ga(n,1,o,c))}return m}static parse(t,n){let[o,c,m,...g]=t;if(!Array.isArray(c)||c.length===0)return n.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const P=c[1];if(typeof P!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:P}}else{if(c[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const P=c.slice(1);if(P.length!==4||P.some((z=>typeof z!="number"||z<0||z>1)))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:P}}}if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(m=n.parse(m,2,rt),!m)return null;const x=[];let S=null;o==="interpolate-hcl"||o==="interpolate-lab"?S=Ln:n.expectedType&&n.expectedType.kind!=="value"&&(S=n.expectedType);for(let P=0;P<g.length;P+=2){const z=g[P],L=g[P+1],O=P+3,V=P+4;if(typeof z!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(x.length&&x[x.length-1][0]>=z)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',O);const q=n.parse(L,V,S);if(!q)return null;S=S||q.type,x.push([z,q])}return ve(S,rt)||ve(S,Ln)||ve(S,yi)||ve(S,ie)||ve(S,j(rt))?new kn(S,o,c,m,x):n.error(`Type ${N(S)} is not interpolatable.`)}evaluate(t){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(t);const c=this.input.evaluate(t);if(c<=n[0])return o[0].evaluate(t);const m=n.length;if(c>=n[m-1])return o[m-1].evaluate(t);const g=mo(n,c),x=kn.interpolationFactor(this.interpolation,c,n[g],n[g+1]),S=o[g].evaluate(t),P=o[g+1].evaluate(t);switch(this.operator){case"interpolate":return on[this.type.kind](S,P,x);case"interpolate-hcl":return on.color(S,P,x,"hcl");case"interpolate-lab":return on.color(S,P,x,"lab")}}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function ga(r,t,n,o){const c=o-n,m=r-n;return c===0?0:t===1?m/c:(Math.pow(t,m)-1)/(Math.pow(t,c)-1)}class ts{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expectected at least one argument.");let o=null;const c=n.expectedType;c&&c.kind!=="value"&&(o=c);const m=[];for(const x of t.slice(1)){const S=n.parse(x,1+m.length,o,void 0,{typeAnnotation:"omit"});if(!S)return null;o=o||S.type,m.push(S)}if(!o)throw new Error("No output type");const g=c&&m.some((x=>ee(c,x.type)));return new ts(g?jt:o,m)}evaluate(t){let n,o=null,c=0;for(const m of this.args)if(c++,o=m.evaluate(t),o&&o instanceof Bn&&!o.available&&(n||(n=o.name),o=null,c===this.args.length&&(o=n)),o!==null)break;return o}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}function Gl(r,t){return r==="=="||r==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Ru(r,t,n,o){return o.compare(t,n)===0}function Is(r,t,n){const o=r!=="=="&&r!=="!=";return class Sy{constructor(m,g,x){this.type=Rt,this.lhs=m,this.rhs=g,this.collator=x,this.hasUntypedArgument=m.type.kind==="value"||g.type.kind==="value"}static parse(m,g){if(m.length!==3&&m.length!==4)return g.error("Expected two or three arguments.");const x=m[0];let S=g.parse(m[1],1,jt);if(!S)return null;if(!Gl(x,S.type))return g.concat(1).error(`"${x}" comparisons are not supported for type '${N(S.type)}'.`);let P=g.parse(m[2],2,jt);if(!P)return null;if(!Gl(x,P.type))return g.concat(2).error(`"${x}" comparisons are not supported for type '${N(P.type)}'.`);if(S.type.kind!==P.type.kind&&S.type.kind!=="value"&&P.type.kind!=="value")return g.error(`Cannot compare types '${N(S.type)}' and '${N(P.type)}'.`);o&&(S.type.kind==="value"&&P.type.kind!=="value"?S=new ei(P.type,[S]):S.type.kind!=="value"&&P.type.kind==="value"&&(P=new ei(S.type,[P])));let z=null;if(m.length===4){if(S.type.kind!=="string"&&P.type.kind!=="string"&&S.type.kind!=="value"&&P.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(z=g.parse(m[3],3,Ai),!z)return null}return new Sy(S,P,z)}evaluate(m){const g=this.lhs.evaluate(m),x=this.rhs.evaluate(m);if(o&&this.hasUntypedArgument){const S=Er(g),P=Er(x);if(S.kind!==P.kind||S.kind!=="string"&&S.kind!=="number")throw new an(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${S.kind}, ${P.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const S=Er(g),P=Er(x);if(S.kind!=="string"||P.kind!=="string")return t(m,g,x)}return this.collator?n(m,g,x,this.collator.evaluate(m)):t(m,g,x)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}}}const ed=Is("==",(function(r,t,n){return t===n}),Ru),Bu=Is("!=",(function(r,t,n){return t!==n}),(function(r,t,n,o){return!Ru(0,t,n,o)})),il=Is("<",(function(r,t,n){return t<n}),(function(r,t,n,o){return o.compare(t,n)<0})),Zc=Is(">",(function(r,t,n){return t>n}),(function(r,t,n,o){return o.compare(t,n)>0})),td=Is("<=",(function(r,t,n){return t<=n}),(function(r,t,n,o){return o.compare(t,n)<=0})),go=Is(">=",(function(r,t,n){return t>=n}),(function(r,t,n,o){return o.compare(t,n)>=0}));class Us{constructor(t,n,o){this.type=Ai,this.locale=o,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(t.length!==2)return n.error("Expected one argument.");const o=t[1];if(typeof o!="object"||Array.isArray(o))return n.error("Collator options argument must be an object.");const c=n.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Rt);if(!c)return null;const m=n.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Rt);if(!m)return null;let g=null;return o.locale&&(g=n.parse(o.locale,1,Jt),!g)?null:new Us(c,m,g)}evaluate(t){return new zu(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class ya{constructor(t,n,o,c,m){this.type=Jt,this.number=t,this.locale=n,this.currency=o,this.minFractionDigits=c,this.maxFractionDigits=m}static parse(t,n){if(t.length!==3)return n.error("Expected two arguments.");const o=n.parse(t[1],1,rt);if(!o)return null;const c=t[2];if(typeof c!="object"||Array.isArray(c))return n.error("NumberFormat options argument must be an object.");let m=null;if(c.locale&&(m=n.parse(c.locale,1,Jt),!m))return null;let g=null;if(c.currency&&(g=n.parse(c.currency,1,Jt),!g))return null;let x=null;if(c["min-fraction-digits"]&&(x=n.parse(c["min-fraction-digits"],1,rt),!x))return null;let S=null;return c["max-fraction-digits"]&&(S=n.parse(c["max-fraction-digits"],1,rt),!S)?null:new ya(o,m,g,x,S)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class $a{constructor(t){this.type=Qi,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const o=t[1];if(!Array.isArray(o)&&typeof o=="object")return n.error("First argument must be an image or text section.");const c=[];let m=!1;for(let g=1;g<=t.length-1;++g){const x=t[g];if(m&&typeof x=="object"&&!Array.isArray(x)){m=!1;let S=null;if(x["font-scale"]&&(S=n.parse(x["font-scale"],1,rt),!S))return null;let P=null;if(x["text-font"]&&(P=n.parse(x["text-font"],1,j(Jt)),!P))return null;let z=null;if(x["text-color"]&&(z=n.parse(x["text-color"],1,Ln),!z))return null;const L=c[c.length-1];L.scale=S,L.font=P,L.textColor=z}else{const S=n.parse(t[g],1,jt);if(!S)return null;const P=S.type.kind;if(P!=="string"&&P!=="value"&&P!=="null"&&P!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,c.push({content:S,scale:null,font:null,textColor:null})}}return new $a(c)}evaluate(t){return new Qn(this.sections.map((n=>{const o=n.content.evaluate(t);return Er(o)===Un?new tl("",o,null,null,null):new tl(rl(o),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null)})))}eachChild(t){for(const n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor)}outputDefined(){return!1}}class Fu{constructor(t){this.type=Un,this.input=t}static parse(t,n){if(t.length!==2)return n.error("Expected two arguments.");const o=n.parse(t[1],1,Jt);return o?new Fu(o):n.error("No image name provided.")}evaluate(t){const n=this.input.evaluate(t),o=Bn.fromString(n);return o&&t.availableImages&&(o.available=t.availableImages.indexOf(n)>-1),o}eachChild(t){t(this.input)}outputDefined(){return!1}}class Ou{constructor(t){this.type=rt,this.input=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=n.parse(t[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${N(o.type)} instead.`):new Ou(o):null}evaluate(t){const n=this.input.evaluate(t);if(typeof n=="string")return[...n].length;if(Array.isArray(n))return n.length;throw new an(`Expected value to be of type string or array, but found ${N(Er(n))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const Di=8192;function Hl(r,t){const n=(180+r[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,c=Math.pow(2,t.z);return[Math.round(n*c*Di),Math.round(o*c*Di)]}function sl(r,t){const n=Math.pow(2,t.z);return[(c=(r[0]/Di+t.x)/n,360*c-180),(o=(r[1]/Di+t.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,c}function _a(r,t){r[0]=Math.min(r[0],t[0]),r[1]=Math.min(r[1],t[1]),r[2]=Math.max(r[2],t[0]),r[3]=Math.max(r[3],t[1])}function Zn(r,t){return!(r[0]<=t[0]||r[2]>=t[2]||r[1]<=t[1]||r[3]>=t[3])}function yr(r,t,n){const o=r[0]-t[0],c=r[1]-t[1],m=r[0]-n[0],g=r[1]-n[1];return o*g-m*c==0&&o*m<=0&&c*g<=0}function qa(r,t,n,o){return(c=[o[0]-n[0],o[1]-n[1]])[0]*(m=[t[0]-r[0],t[1]-r[1]])[1]-c[1]*m[0]!=0&&!(!Za(r,t,n,o)||!Za(n,o,r,t));var c,m}function Gc(r,t,n){for(const o of n)for(let c=0;c<o.length-1;++c)if(qa(r,t,o[c],o[c+1]))return!0;return!1}function $s(r,t,n=!1){let o=!1;for(const x of t)for(let S=0;S<x.length-1;S++){if(yr(r,x[S],x[S+1]))return n;(m=x[S])[1]>(c=r)[1]!=(g=x[S+1])[1]>c[1]&&c[0]<(g[0]-m[0])*(c[1]-m[1])/(g[1]-m[1])+m[0]&&(o=!o)}var c,m,g;return o}function Kl(r,t){for(const n of t)if($s(r,n))return!0;return!1}function Nu(r,t){for(const n of r)if(!$s(n,t))return!1;for(let n=0;n<r.length-1;++n)if(Gc(r[n],r[n+1],t))return!1;return!0}function vi(r,t){for(const n of t)if(Nu(r,n))return!0;return!1}function Za(r,t,n,o){const c=o[0]-n[0],m=o[1]-n[1],g=(r[0]-n[0])*m-c*(r[1]-n[1]),x=(t[0]-n[0])*m-c*(t[1]-n[1]);return g>0&&x<0||g<0&&x>0}function al(r,t,n){const o=[];for(let c=0;c<r.length;c++){const m=[];for(let g=0;g<r[c].length;g++){const x=Hl(r[c][g],n);_a(t,x),m.push(x)}o.push(m)}return o}function yo(r,t,n){const o=[];for(let c=0;c<r.length;c++){const m=al(r[c],t,n);o.push(m)}return o}function Hc(r,t,n,o){if(r[0]<n[0]||r[0]>n[2]){const c=.5*o;let m=r[0]-n[0]>c?-o:n[0]-r[0]>c?o:0;m===0&&(m=r[0]-n[2]>c?-o:n[2]-r[0]>c?o:0),r[0]+=m}_a(t,r)}function Wl(r,t,n,o){const c=Math.pow(2,o.z)*Di,m=[o.x*Di,o.y*Di],g=[];for(const x of r)for(const S of x){const P=[S.x+m[0],S.y+m[1]];Hc(P,t,n,c),g.push(P)}return g}function Xl(r,t,n,o){const c=Math.pow(2,o.z)*Di,m=[o.x*Di,o.y*Di],g=[];for(const S of r){const P=[];for(const z of S){const L=[z.x+m[0],z.y+m[1]];_a(t,L),P.push(L)}g.push(P)}if(t[2]-t[0]<=c/2){(x=t)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const S of g)for(const P of S)Hc(P,t,n,c)}var x;return g}class rs{constructor(t,n){this.type=Rt,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Oa(t[1])){const o=t[1];if(o.type==="FeatureCollection"){const c=[];for(const m of o.features){const{type:g,coordinates:x}=m.geometry;g==="Polygon"&&c.push(x),g==="MultiPolygon"&&c.push(...x)}if(c.length)return new rs(o,{type:"MultiPolygon",coordinates:c})}else if(o.type==="Feature"){const c=o.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new rs(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new rs(o,o)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(n,o){const c=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(o.type==="Polygon"){const x=al(o.coordinates,m,g),S=Wl(n.geometry(),c,m,g);if(!Zn(c,m))return!1;for(const P of S)if(!$s(P,x))return!1}if(o.type==="MultiPolygon"){const x=yo(o.coordinates,m,g),S=Wl(n.geometry(),c,m,g);if(!Zn(c,m))return!1;for(const P of S)if(!Kl(P,x))return!1}return!0})(t,this.geometries);if(t.geometryType()==="LineString")return(function(n,o){const c=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(o.type==="Polygon"){const x=al(o.coordinates,m,g),S=Xl(n.geometry(),c,m,g);if(!Zn(c,m))return!1;for(const P of S)if(!Nu(P,x))return!1}if(o.type==="MultiPolygon"){const x=yo(o.coordinates,m,g),S=Xl(n.geometry(),c,m,g);if(!Zn(c,m))return!1;for(const P of S)if(!vi(P,x))return!1}return!0})(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let ol=class{constructor(r=[],t=((n,o)=>n<o?-1:n>o?1:0)){if(this.data=r,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:t,compare:n}=this,o=t[r];for(;r>0;){const c=r-1>>1,m=t[c];if(n(o,m)>=0)break;t[r]=m,r=c}t[r]=o}_down(r){const{data:t,compare:n}=this,o=this.length>>1,c=t[r];for(;r<o;){let m=1+(r<<1);const g=m+1;if(g<this.length&&n(t[g],t[m])<0&&(m=g),n(t[m],c)>=0)break;t[r]=t[m],r=m}t[r]=c}};function Kc(r,t,n,o,c){Wc(r,t,n,o||r.length-1,c||rd)}function Wc(r,t,n,o,c){for(;o>n;){if(o-n>600){var m=o-n+1,g=t-n+1,x=Math.log(m),S=.5*Math.exp(2*x/3),P=.5*Math.sqrt(x*S*(m-S)/m)*(g-m/2<0?-1:1);Wc(r,t,Math.max(n,Math.floor(t-g*S/m+P)),Math.min(o,Math.floor(t+(m-g)*S/m+P)),c)}var z=r[t],L=n,O=o;for(ll(r,n,t),c(r[o],z)>0&&ll(r,n,o);L<O;){for(ll(r,L,O),L++,O--;c(r[L],z)<0;)L++;for(;c(r[O],z)>0;)O--}c(r[n],z)===0?ll(r,n,O):ll(r,++O,o),O<=t&&(n=O+1),t<=O&&(o=O-1)}}function ll(r,t,n){var o=r[t];r[t]=r[n],r[n]=o}function rd(r,t){return r<t?-1:r>t?1:0}function _o(r,t){if(r.length<=1)return[r];const n=[];let o,c;for(const m of r){const g=id(m);g!==0&&(m.area=Math.abs(g),c===void 0&&(c=g<0),c===g<0?(o&&n.push(o),o=[m]):o.push(m))}if(o&&n.push(o),t>1)for(let m=0;m<n.length;m++)n[m].length<=t||(Kc(n[m],t,1,n[m].length-1,nd),n[m]=n[m].slice(0,t));return n}function nd(r,t){return t.area-r.area}function id(r){let t=0;for(let n,o,c=0,m=r.length,g=m-1;c<m;g=c++)n=r[c],o=r[g],t+=(o.x-n.x)*(n.y+o.y);return t}const Xc=1/298.257223563,Yc=Xc*(2-Xc),Jc=Math.PI/180;class Yl{constructor(t){const n=6378.137*Jc*1e3,o=Math.cos(t*Jc),c=1/(1-Yc*(1-o*o)),m=Math.sqrt(c);this.kx=n*m*o,this.ky=n*m*c*(1-Yc)}distance(t,n){const o=this.wrap(t[0]-n[0])*this.kx,c=(t[1]-n[1])*this.ky;return Math.sqrt(o*o+c*c)}pointOnLine(t,n){let o,c,m,g,x=1/0;for(let S=0;S<t.length-1;S++){let P=t[S][0],z=t[S][1],L=this.wrap(t[S+1][0]-P)*this.kx,O=(t[S+1][1]-z)*this.ky,V=0;L===0&&O===0||(V=(this.wrap(n[0]-P)*this.kx*L+(n[1]-z)*this.ky*O)/(L*L+O*O),V>1?(P=t[S+1][0],z=t[S+1][1]):V>0&&(P+=L/this.kx*V,z+=O/this.ky*V)),L=this.wrap(n[0]-P)*this.kx,O=(n[1]-z)*this.ky;const q=L*L+O*O;q<x&&(x=q,o=P,c=z,m=S,g=V)}return{point:[o,c],index:m,t:Math.max(0,Math.min(1,g))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Qc(r,t){return t[0]-r[0]}function Jl(r){return r[1]-r[0]+1}function qs(r,t){return r[1]>=r[0]&&r[1]<t}function ju(r,t){if(r[0]>r[1])return[null,null];const n=Jl(r);if(t){if(n===2)return[r,null];const c=Math.floor(n/2);return[[r[0],r[0]+c],[r[0]+c,r[1]]]}if(n===1)return[r,null];const o=Math.floor(n/2)-1;return[[r[0],r[0]+o],[r[0]+o+1,r[1]]]}function ul(r,t){if(!qs(t,r.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let o=t[0];o<=t[1];++o)_a(n,r[o]);return n}function Vu(r){const t=[1/0,1/0,-1/0,-1/0];for(const n of r)for(const o of n)_a(t,o);return t}function Ql(r){return r[0]!==-1/0&&r[1]!==-1/0&&r[2]!==1/0&&r[3]!==1/0}function Uu(r,t,n){if(!Ql(r)||!Ql(t))return NaN;let o=0,c=0;return r[2]<t[0]&&(o=t[0]-r[2]),r[0]>t[2]&&(o=r[0]-t[2]),r[1]>t[3]&&(c=r[1]-t[3]),r[3]<t[1]&&(c=t[1]-r[3]),n.distance([0,0],[o,c])}function va(r,t,n){const o=n.pointOnLine(t,r);return n.distance(r,o.point)}function $u(r,t,n,o,c){const m=Math.min(va(r,[n,o],c),va(t,[n,o],c)),g=Math.min(va(n,[r,t],c),va(o,[r,t],c));return Math.min(m,g)}function sd(r,t,n,o,c){if(!qs(t,r.length)||!qs(o,n.length))return 1/0;let m=1/0;for(let g=t[0];g<t[1];++g){const x=r[g],S=r[g+1];for(let P=o[0];P<o[1];++P){const z=n[P],L=n[P+1];if(qa(x,S,z,L))return 0;m=Math.min(m,$u(x,S,z,L,c))}}return m}function tn(r,t,n,o,c){if(!qs(t,r.length)||!qs(o,n.length))return NaN;let m=1/0;for(let g=t[0];g<=t[1];++g)for(let x=o[0];x<=o[1];++x)if(m=Math.min(m,c.distance(r[g],n[x])),m===0)return m;return m}function ad(r,t,n){if($s(r,t,!0))return 0;let o=1/0;for(const c of t){const m=c[0],g=c[c.length-1];if(m!==g&&(o=Math.min(o,va(r,[g,m],n)),o===0))return o;const x=n.pointOnLine(c,r);if(o=Math.min(o,n.distance(r,x.point)),o===0)return o}return o}function ir(r,t,n,o){if(!qs(t,r.length))return NaN;for(let m=t[0];m<=t[1];++m)if($s(r[m],n,!0))return 0;let c=1/0;for(let m=t[0];m<t[1];++m){const g=r[m],x=r[m+1];for(const S of n)for(let P=0,z=S.length,L=z-1;P<z;L=P++){const O=S[L],V=S[P];if(qa(g,x,O,V))return 0;c=Math.min(c,$u(g,x,O,V,o))}}return c}function eu(r,t){for(const n of r)for(const o of n)if($s(o,t,!0))return!0;return!1}function Br(r,t,n,o=1/0){const c=Vu(r),m=Vu(t);if(o!==1/0&&Uu(c,m,n)>=o)return o;if(Zn(c,m)){if(eu(r,t))return 0}else if(eu(t,r))return 0;let g=1/0;for(const x of r)for(let S=0,P=x.length,z=P-1;S<P;z=S++){const L=x[z],O=x[S];for(const V of t)for(let q=0,K=V.length,re=K-1;q<K;re=q++){const oe=V[re],we=V[q];if(qa(L,O,oe,we))return 0;g=Math.min(g,$u(L,O,oe,we,n))}}return g}function kr(r,t,n,o,c,m){if(!m)return;const g=Uu(ul(o,m),c,n);g<t&&r.push([g,m,[0,0]])}function ns(r,t,n,o,c,m,g){if(!m||!g)return;const x=Uu(ul(o,m),ul(c,g),n);x<t&&r.push([x,m,g])}function cl(r,t,n,o,c=1/0){let m=Math.min(o.distance(r[0],n[0][0]),c);if(m===0)return m;const g=new ol([[0,[0,r.length-1],[0,0]]],Qc),x=Vu(n);for(;g.length>0;){const S=g.pop();if(S[0]>=m)continue;const P=S[1],z=t?50:100;if(Jl(P)<=z){if(!qs(P,r.length))return NaN;if(t){const L=ir(r,P,n,o);if(isNaN(L)||L===0)return L;m=Math.min(m,L)}else for(let L=P[0];L<=P[1];++L){const O=ad(r[L],n,o);if(m=Math.min(m,O),m===0)return 0}}else{const L=ju(P,t);kr(g,m,o,r,x,L[0]),kr(g,m,o,r,x,L[1])}}return m}function vo(r,t,n,o,c,m=1/0){let g=Math.min(m,c.distance(r[0],n[0]));if(g===0)return g;const x=new ol([[0,[0,r.length-1],[0,n.length-1]]],Qc);for(;x.length>0;){const S=x.pop();if(S[0]>=g)continue;const P=S[1],z=S[2],L=t?50:100,O=o?50:100;if(Jl(P)<=L&&Jl(z)<=O){if(!qs(P,r.length)&&qs(z,n.length))return NaN;let V;if(t&&o)V=sd(r,P,n,z,c),g=Math.min(g,V);else if(t&&!o){const q=r.slice(P[0],P[1]+1);for(let K=z[0];K<=z[1];++K)if(V=va(n[K],q,c),g=Math.min(g,V),g===0)return g}else if(!t&&o){const q=n.slice(z[0],z[1]+1);for(let K=P[0];K<=P[1];++K)if(V=va(r[K],q,c),g=Math.min(g,V),g===0)return g}else V=tn(r,P,n,z,c),g=Math.min(g,V)}else{const V=ju(P,t),q=ju(z,o);ns(x,g,c,r,n,V[0],q[0]),ns(x,g,c,r,n,V[0],q[1]),ns(x,g,c,r,n,V[1],q[0]),ns(x,g,c,r,n,V[1],q[1])}}return g}function tu(r){return r.type==="MultiPolygon"?r.coordinates.map((t=>({type:"Polygon",coordinates:t}))):r.type==="MultiLineString"?r.coordinates.map((t=>({type:"LineString",coordinates:t}))):r.type==="MultiPoint"?r.coordinates.map((t=>({type:"Point",coordinates:t}))):[r]}class xa{constructor(t,n){this.type=rt,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Oa(t[1])){const o=t[1];if(o.type==="FeatureCollection")return new xa(o,o.features.map((c=>tu(c.geometry))).flat());if(o.type==="Feature")return new xa(o,tu(o.geometry));if("type"in o&&"coordinates"in o)return new xa(o,tu(o))}return n.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(n,o){const c=n.geometry(),m=c.flat().map((S=>sl([S.x,S.y],n.canonical)));if(c.length===0)return NaN;const g=new Yl(m[0][1]);let x=1/0;for(const S of o){switch(S.type){case"Point":x=Math.min(x,vo(m,!1,[S.coordinates],!1,g,x));break;case"LineString":x=Math.min(x,vo(m,!1,S.coordinates,!0,g,x));break;case"Polygon":x=Math.min(x,cl(m,!1,S.coordinates,g,x))}if(x===0)return x}return x})(t,this.geometries);if(t.geometryType()==="LineString")return(function(n,o){const c=n.geometry(),m=c.flat().map((S=>sl([S.x,S.y],n.canonical)));if(c.length===0)return NaN;const g=new Yl(m[0][1]);let x=1/0;for(const S of o){switch(S.type){case"Point":x=Math.min(x,vo(m,!0,[S.coordinates],!1,g,x));break;case"LineString":x=Math.min(x,vo(m,!0,S.coordinates,!0,g,x));break;case"Polygon":x=Math.min(x,cl(m,!0,S.coordinates,g,x))}if(x===0)return x}return x})(t,this.geometries);if(t.geometryType()==="Polygon")return(function(n,o){const c=n.geometry();if(c.length===0||c[0].length===0)return NaN;const m=_o(c,0).map((S=>S.map((P=>P.map((z=>sl([z.x,z.y],n.canonical))))))),g=new Yl(m[0][0][0][1]);let x=1/0;for(const S of o)for(const P of m){switch(S.type){case"Point":x=Math.min(x,cl([S.coordinates],!1,P,g,x));break;case"LineString":x=Math.min(x,cl(S.coordinates,!0,P,g,x));break;case"Polygon":x=Math.min(x,Br(P,S.coordinates,g,x))}if(x===0)return x}return x})(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Ga={"==":ed,"!=":Bu,">":Zc,"<":il,">=":go,"<=":td,array:ei,at:Va,boolean:ei,case:nl,coalesce:ts,collator:Us,format:$a,image:Fu,in:Du,"index-of":ma,interpolate:kn,"interpolate-hcl":kn,"interpolate-lab":kn,length:Ou,let:Vs,literal:es,match:Sr,number:ei,"number-format":ya,object:ei,slice:fo,step:Ua,string:ei,"to-boolean":ti,"to-color":ti,"to-number":ti,"to-string":ti,var:gr,within:rs,distance:xa};class xi{constructor(t,n,o,c){this.name=t,this.type=n,this._evaluate=o,this.args=c}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,n){const o=t[0],c=xi.definitions[o];if(!c)return n.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(c)?c[0]:c.type,g=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,x=g.filter((([P])=>!Array.isArray(P)||P.length===t.length-1));let S=null;for(const[P,z]of x){S=new js(n.registry,xo,n.path,null,n.scope);const L=[];let O=!1;for(let V=1;V<t.length;V++){const q=t[V],K=Array.isArray(P)?P[V-1]:P.type,re=S.parse(q,1+L.length,K);if(!re){O=!0;break}L.push(re)}if(!O)if(Array.isArray(P)&&P.length!==L.length)S.error(`Expected ${P.length} arguments, but found ${L.length} instead.`);else{for(let V=0;V<L.length;V++){const q=Array.isArray(P)?P[V]:P.type,K=L[V];S.concat(V+1).checkSubtype(q,K.type)}if(S.errors.length===0)return new xi(o,m,z,L)}}if(x.length===1)n.errors.push(...S.errors);else{const P=(x.length?x:g).map((([L])=>{return O=L,Array.isArray(O)?`(${O.map(N).join(", ")})`:`(${N(O.type)}...)`;var O})).join(" | "),z=[];for(let L=1;L<t.length;L++){const O=n.parse(t[L],1+z.length);if(!O)return null;z.push(N(O.type))}n.error(`Expected arguments of type ${P}, but found (${z.join(", ")}) instead.`)}return null}static register(t,n){xi.definitions=n;for(const o in n)t[o]=xi}}function wa(r,[t,n,o,c]){t=t.evaluate(r),n=n.evaluate(r),o=o.evaluate(r);const m=c?c.evaluate(r):1,g=qn(t,n,o,m);if(g)throw new an(g);return new Vt(t/255,n/255,o/255,m,!1)}function qu(r,t){return r in t}function Zu(r,t){const n=t[r];return n===void 0?null:n}function Ha(r){return{type:r}}function xo(r){if(r instanceof gr)return xo(r.boundExpression);if(r instanceof xi&&r.name==="error"||r instanceof Us||r instanceof rs||r instanceof xa)return!1;const t=r instanceof ti||r instanceof ei;let n=!0;return r.eachChild((o=>{n=t?n&&xo(o):n&&o instanceof es})),!!n&&wo(r)&&Zs(r,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function wo(r){if(r instanceof xi&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof rs||r instanceof xa)return!1;let t=!0;return r.eachChild((n=>{t&&!wo(n)&&(t=!1)})),t}function Es(r){if(r instanceof xi&&r.name==="feature-state")return!1;let t=!0;return r.eachChild((n=>{t&&!Es(n)&&(t=!1)})),t}function Zs(r,t){if(r instanceof xi&&t.indexOf(r.name)>=0)return!1;let n=!0;return r.eachChild((o=>{n&&!Zs(o,t)&&(n=!1)})),n}function ru(r){return{result:"success",value:r}}function Gs(r){return{result:"error",value:r}}function bo(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function Gu(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function hl(r){return!!r.expression&&r.expression.interpolated}function hr(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function dl(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function eh(r){return r}function Hu(r,t){const n=t.type==="color",o=r.stops&&typeof r.stops[0][0]=="object",c=o||!(o||r.property!==void 0),m=r.type||(hl(t)?"exponential":"interval");if(n||t.type==="padding"){const z=n?Vt.parse:Rn.parse;(r=Ji({},r)).stops&&(r.stops=r.stops.map((L=>[L[0],z(L[1])]))),r.default=z(r.default?r.default:t.default)}if(r.colorSpace&&(g=r.colorSpace)!=="rgb"&&g!=="hcl"&&g!=="lab")throw new Error(`Unknown color space: "${r.colorSpace}"`);var g;let x,S,P;if(m==="exponential")x=rh;else if(m==="interval")x=nu;else if(m==="categorical"){x=th,S=Object.create(null);for(const z of r.stops)S[z[0]]=z[1];P=typeof r.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);x=nh}if(o){const z={},L=[];for(let q=0;q<r.stops.length;q++){const K=r.stops[q],re=K[0].zoom;z[re]===void 0&&(z[re]={zoom:re,type:r.type,property:r.property,default:r.default,stops:[]},L.push(re)),z[re].stops.push([K[0].value,K[1]])}const O=[];for(const q of L)O.push([z[q].zoom,Hu(z[q],t)]);const V={name:"linear"};return{kind:"composite",interpolationType:V,interpolationFactor:kn.interpolationFactor.bind(void 0,V),zoomStops:O.map((q=>q[0])),evaluate:({zoom:q},K)=>rh({stops:O,base:r.base},t,q).evaluate(q,K)}}if(c){const z=m==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:z,interpolationFactor:kn.interpolationFactor.bind(void 0,z),zoomStops:r.stops.map((L=>L[0])),evaluate:({zoom:L})=>x(r,t,L,S,P)}}return{kind:"source",evaluate(z,L){const O=L&&L.properties?L.properties[r.property]:void 0;return O===void 0?So(r.default,t.default):x(r,t,O,S,P)}}}function So(r,t,n){return r!==void 0?r:t!==void 0?t:n!==void 0?n:void 0}function th(r,t,n,o,c){return So(typeof n===c?o[n]:void 0,r.default,t.default)}function nu(r,t,n){if(hr(n)!=="number")return So(r.default,t.default);const o=r.stops.length;if(o===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[o-1][0])return r.stops[o-1][1];const c=mo(r.stops.map((m=>m[0])),n);return r.stops[c][1]}function rh(r,t,n){const o=r.base!==void 0?r.base:1;if(hr(n)!=="number")return So(r.default,t.default);const c=r.stops.length;if(c===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[c-1][0])return r.stops[c-1][1];const m=mo(r.stops.map((z=>z[0])),n),g=(function(z,L,O,V){const q=V-O,K=z-O;return q===0?0:L===1?K/q:(Math.pow(L,K)-1)/(Math.pow(L,q)-1)})(n,o,r.stops[m][0],r.stops[m+1][0]),x=r.stops[m][1],S=r.stops[m+1][1],P=on[t.type]||eh;return typeof x.evaluate=="function"?{evaluate(...z){const L=x.evaluate.apply(void 0,z),O=S.evaluate.apply(void 0,z);if(L!==void 0&&O!==void 0)return P(L,O,g,r.colorSpace)}}:P(x,S,g,r.colorSpace)}function nh(r,t,n){switch(t.type){case"color":n=Vt.parse(n);break;case"formatted":n=Qn.fromString(n.toString());break;case"resolvedImage":n=Bn.fromString(n.toString());break;case"padding":n=Rn.parse(n);break;default:hr(n)===t.type||t.type==="enum"&&t.values[n]||(n=void 0)}return So(n,r.default,t.default)}xi.register(Ga,{error:[{kind:"error"},[Jt],(r,[t])=>{throw new an(t.evaluate(r))}],typeof:[Jt,[jt],(r,[t])=>N(Er(t.evaluate(r)))],"to-rgba":[j(rt,4),[Ln],(r,[t])=>{const[n,o,c,m]=t.evaluate(r).rgb;return[255*n,255*o,255*c,m]}],rgb:[Ln,[rt,rt,rt],wa],rgba:[Ln,[rt,rt,rt,rt],wa],has:{type:Rt,overloads:[[[Jt],(r,[t])=>qu(t.evaluate(r),r.properties())],[[Jt,gi],(r,[t,n])=>qu(t.evaluate(r),n.evaluate(r))]]},get:{type:jt,overloads:[[[Jt],(r,[t])=>Zu(t.evaluate(r),r.properties())],[[Jt,gi],(r,[t,n])=>Zu(t.evaluate(r),n.evaluate(r))]]},"feature-state":[jt,[Jt],(r,[t])=>Zu(t.evaluate(r),r.featureState||{})],properties:[gi,[],r=>r.properties()],"geometry-type":[Jt,[],r=>r.geometryType()],id:[jt,[],r=>r.id()],zoom:[rt,[],r=>r.globals.zoom],"heatmap-density":[rt,[],r=>r.globals.heatmapDensity||0],"line-progress":[rt,[],r=>r.globals.lineProgress||0],accumulated:[jt,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[rt,Ha(rt),(r,t)=>{let n=0;for(const o of t)n+=o.evaluate(r);return n}],"*":[rt,Ha(rt),(r,t)=>{let n=1;for(const o of t)n*=o.evaluate(r);return n}],"-":{type:rt,overloads:[[[rt,rt],(r,[t,n])=>t.evaluate(r)-n.evaluate(r)],[[rt],(r,[t])=>-t.evaluate(r)]]},"/":[rt,[rt,rt],(r,[t,n])=>t.evaluate(r)/n.evaluate(r)],"%":[rt,[rt,rt],(r,[t,n])=>t.evaluate(r)%n.evaluate(r)],ln2:[rt,[],()=>Math.LN2],pi:[rt,[],()=>Math.PI],e:[rt,[],()=>Math.E],"^":[rt,[rt,rt],(r,[t,n])=>Math.pow(t.evaluate(r),n.evaluate(r))],sqrt:[rt,[rt],(r,[t])=>Math.sqrt(t.evaluate(r))],log10:[rt,[rt],(r,[t])=>Math.log(t.evaluate(r))/Math.LN10],ln:[rt,[rt],(r,[t])=>Math.log(t.evaluate(r))],log2:[rt,[rt],(r,[t])=>Math.log(t.evaluate(r))/Math.LN2],sin:[rt,[rt],(r,[t])=>Math.sin(t.evaluate(r))],cos:[rt,[rt],(r,[t])=>Math.cos(t.evaluate(r))],tan:[rt,[rt],(r,[t])=>Math.tan(t.evaluate(r))],asin:[rt,[rt],(r,[t])=>Math.asin(t.evaluate(r))],acos:[rt,[rt],(r,[t])=>Math.acos(t.evaluate(r))],atan:[rt,[rt],(r,[t])=>Math.atan(t.evaluate(r))],min:[rt,Ha(rt),(r,t)=>Math.min(...t.map((n=>n.evaluate(r))))],max:[rt,Ha(rt),(r,t)=>Math.max(...t.map((n=>n.evaluate(r))))],abs:[rt,[rt],(r,[t])=>Math.abs(t.evaluate(r))],round:[rt,[rt],(r,[t])=>{const n=t.evaluate(r);return n<0?-Math.round(-n):Math.round(n)}],floor:[rt,[rt],(r,[t])=>Math.floor(t.evaluate(r))],ceil:[rt,[rt],(r,[t])=>Math.ceil(t.evaluate(r))],"filter-==":[Rt,[Jt,jt],(r,[t,n])=>r.properties()[t.value]===n.value],"filter-id-==":[Rt,[jt],(r,[t])=>r.id()===t.value],"filter-type-==":[Rt,[Jt],(r,[t])=>r.geometryType()===t.value],"filter-<":[Rt,[Jt,jt],(r,[t,n])=>{const o=r.properties()[t.value],c=n.value;return typeof o==typeof c&&o<c}],"filter-id-<":[Rt,[jt],(r,[t])=>{const n=r.id(),o=t.value;return typeof n==typeof o&&n<o}],"filter->":[Rt,[Jt,jt],(r,[t,n])=>{const o=r.properties()[t.value],c=n.value;return typeof o==typeof c&&o>c}],"filter-id->":[Rt,[jt],(r,[t])=>{const n=r.id(),o=t.value;return typeof n==typeof o&&n>o}],"filter-<=":[Rt,[Jt,jt],(r,[t,n])=>{const o=r.properties()[t.value],c=n.value;return typeof o==typeof c&&o<=c}],"filter-id-<=":[Rt,[jt],(r,[t])=>{const n=r.id(),o=t.value;return typeof n==typeof o&&n<=o}],"filter->=":[Rt,[Jt,jt],(r,[t,n])=>{const o=r.properties()[t.value],c=n.value;return typeof o==typeof c&&o>=c}],"filter-id->=":[Rt,[jt],(r,[t])=>{const n=r.id(),o=t.value;return typeof n==typeof o&&n>=o}],"filter-has":[Rt,[jt],(r,[t])=>t.value in r.properties()],"filter-has-id":[Rt,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[Rt,[j(Jt)],(r,[t])=>t.value.indexOf(r.geometryType())>=0],"filter-id-in":[Rt,[j(jt)],(r,[t])=>t.value.indexOf(r.id())>=0],"filter-in-small":[Rt,[Jt,j(jt)],(r,[t,n])=>n.value.indexOf(r.properties()[t.value])>=0],"filter-in-large":[Rt,[Jt,j(jt)],(r,[t,n])=>(function(o,c,m,g){for(;m<=g;){const x=m+g>>1;if(c[x]===o)return!0;c[x]>o?g=x-1:m=x+1}return!1})(r.properties()[t.value],n.value,0,n.value.length-1)],all:{type:Rt,overloads:[[[Rt,Rt],(r,[t,n])=>t.evaluate(r)&&n.evaluate(r)],[Ha(Rt),(r,t)=>{for(const n of t)if(!n.evaluate(r))return!1;return!0}]]},any:{type:Rt,overloads:[[[Rt,Rt],(r,[t,n])=>t.evaluate(r)||n.evaluate(r)],[Ha(Rt),(r,t)=>{for(const n of t)if(n.evaluate(r))return!0;return!1}]]},"!":[Rt,[Rt],(r,[t])=>!t.evaluate(r)],"is-supported-script":[Rt,[Jt],(r,[t])=>{const n=r.globals&&r.globals.isSupportedScript;return!n||n(t.evaluate(r))}],upcase:[Jt,[Jt],(r,[t])=>t.evaluate(r).toUpperCase()],downcase:[Jt,[Jt],(r,[t])=>t.evaluate(r).toLowerCase()],concat:[Jt,Ha(jt),(r,t)=>t.map((n=>rl(n.evaluate(r)))).join("")],"resolved-locale":[Jt,[Ai],(r,[t])=>t.evaluate(r).resolvedLocale()]});class ni{constructor(t,n){var o;this.expression=t,this._warningHistory={},this._evaluator=new $l,this._defaultValue=n?(o=n).type==="color"&&dl(o.default)?new Vt(0,0,0,0):o.type==="color"?Vt.parse(o.default)||null:o.type==="padding"?Rn.parse(o.default)||null:o.type==="variableAnchorOffsetCollection"?_i.parse(o.default)||null:o.default===void 0?null:o.default:null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(t,n,o,c,m,g){return this._evaluator.globals=t,this._evaluator.feature=n,this._evaluator.featureState=o,this._evaluator.canonical=c,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g,this.expression.evaluate(this._evaluator)}evaluate(t,n,o,c,m,g){this._evaluator.globals=t,this._evaluator.feature=n||null,this._evaluator.featureState=o||null,this._evaluator.canonical=c,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g||null;try{const x=this.expression.evaluate(this._evaluator);if(x==null||typeof x=="number"&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new an(`Expected value to be one of ${Object.keys(this._enumValues).map((S=>JSON.stringify(S))).join(", ")}, but found ${JSON.stringify(x)} instead.`);return x}catch(x){return this._warningHistory[x.message]||(this._warningHistory[x.message]=!0,typeof console<"u"&&console.warn(x.message)),this._defaultValue}}}function ba(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in Ga}function Ka(r,t){const n=new js(Ga,xo,[],t?(function(c){const m={color:Ln,string:Jt,number:rt,enum:Jt,boolean:Rt,formatted:Qi,padding:yi,resolvedImage:Un,variableAnchorOffsetCollection:ie};return c.type==="array"?j(m[c.value]||jt,c.length):m[c.type]})(t):void 0),o=n.parse(r,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?ru(new ni(o,t)):Gs(n.errors)}class Wa{constructor(t,n){this.kind=t,this._styleExpression=n,this.isStateDependent=t!=="constant"&&!Es(n.expression)}evaluateWithoutErrorHandling(t,n,o,c,m,g){return this._styleExpression.evaluateWithoutErrorHandling(t,n,o,c,m,g)}evaluate(t,n,o,c,m,g){return this._styleExpression.evaluate(t,n,o,c,m,g)}}class Xa{constructor(t,n,o,c){this.kind=t,this.zoomStops=o,this._styleExpression=n,this.isStateDependent=t!=="camera"&&!Es(n.expression),this.interpolationType=c}evaluateWithoutErrorHandling(t,n,o,c,m,g){return this._styleExpression.evaluateWithoutErrorHandling(t,n,o,c,m,g)}evaluate(t,n,o,c,m,g){return this._styleExpression.evaluate(t,n,o,c,m,g)}interpolationFactor(t,n,o){return this.interpolationType?kn.interpolationFactor(this.interpolationType,t,n,o):0}}function iu(r,t){const n=Ka(r,t);if(n.result==="error")return n;const o=n.value.expression,c=wo(o);if(!c&&!bo(t))return Gs([new gn("","data expressions not supported")]);const m=Zs(o,["zoom"]);if(!m&&!Gu(t))return Gs([new gn("","zoom expressions not supported")]);const g=pl(o);return g||m?g instanceof gn?Gs([g]):g instanceof kn&&!hl(t)?Gs([new gn("",'"interpolate" expressions cannot be used with this property')]):ru(g?new Xa(c?"camera":"composite",n.value,g.labels,g instanceof kn?g.interpolation:void 0):new Wa(c?"constant":"source",n.value)):Gs([new gn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Sa{constructor(t,n){this._parameters=t,this._specification=n,Ji(this,Hu(this._parameters,this._specification))}static deserialize(t){return new Sa(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function pl(r){let t=null;if(r instanceof Vs)t=pl(r.result);else if(r instanceof ts){for(const n of r.args)if(t=pl(n),t)break}else(r instanceof Ua||r instanceof kn)&&r.input instanceof xi&&r.input.name==="zoom"&&(t=r);return t instanceof gn||r.eachChild((n=>{const o=pl(n);o instanceof gn?t=o:!t&&o?t=new gn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&o&&t!==o&&(t=new gn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}function su(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const t of r.slice(1))if(!su(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const Hs={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function fl(r){if(r==null)return{filter:()=>!0,needGeometry:!1};su(r)||(r=gl(r));const t=Ka(r,Hs);if(t.result==="error")throw new Error(t.value.map((n=>`${n.key}: ${n.message}`)).join(", "));return{filter:(n,o,c)=>t.value.evaluate(n,o,{},c),needGeometry:au(r)}}function ml(r,t){return r<t?-1:r>t?1:0}function au(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let t=1;t<r.length;t++)if(au(r[t]))return!0;return!1}function gl(r){if(!r)return!0;const t=r[0];return r.length<=1?t!=="any":t==="=="?ko(r[1],r[2],"=="):t==="!="?Pn(ko(r[1],r[2],"==")):t==="<"||t===">"||t==="<="||t===">="?ko(r[1],r[2],t):t==="any"?(n=r.slice(1),["any"].concat(n.map(gl))):t==="all"?["all"].concat(r.slice(1).map(gl)):t==="none"?["all"].concat(r.slice(1).map(gl).map(Pn)):t==="in"?Ps(r[1],r.slice(2)):t==="!in"?Pn(Ps(r[1],r.slice(2))):t==="has"?Ya(r[1]):t!=="!has"||Pn(Ya(r[1]));var n}function ko(r,t,n){switch(r){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,r,t]}}function Ps(r,t){if(t.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((n=>typeof n!=typeof t[0]))?["filter-in-large",r,["literal",t.sort(ml)]]:["filter-in-small",r,["literal",t]]}}function Ya(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function Pn(r){return["!",r]}function Cs(r){const t=typeof r;if(t==="number"||t==="boolean"||t==="string"||r==null)return JSON.stringify(r);if(Array.isArray(r)){let c="[";for(const m of r)c+=`${Cs(m)},`;return`${c}]`}const n=Object.keys(r).sort();let o="{";for(let c=0;c<n.length;c++)o+=`${JSON.stringify(n[c])}:${Cs(r[n[c]])},`;return`${o}}`}function Ku(r){let t="";for(const n of Ns)t+=`/${Cs(r[n])}`;return t}function Wu(r){const t=r.value;return t?[new Ke(r.key,t,"constants have been deprecated as of v8")]:[]}function Yr(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Li(r){if(Array.isArray(r))return r.map(Li);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const t={};for(const n in r)t[n]=Li(r[n]);return t}return Yr(r)}function ii(r){const t=r.key,n=r.value,o=r.valueSpec||{},c=r.objectElementValidators||{},m=r.style,g=r.styleSpec,x=r.validateSpec;let S=[];const P=hr(n);if(P!=="object")return[new Ke(t,n,`object expected, ${P} found`)];for(const z in n){const L=z.split(".")[0],O=o[L]||o["*"];let V;if(c[L])V=c[L];else if(o[L])V=x;else if(c["*"])V=c["*"];else{if(!o["*"]){S.push(new Ke(t,n[z],`unknown property "${z}"`));continue}V=x}S=S.concat(V({key:(t&&`${t}.`)+z,value:n[z],valueSpec:O,style:m,styleSpec:g,object:n,objectKey:z,validateSpec:x},n))}for(const z in o)c[z]||o[z].required&&o[z].default===void 0&&n[z]===void 0&&S.push(new Ke(t,n,`missing required property "${z}"`));return S}function To(r){const t=r.value,n=r.valueSpec,o=r.style,c=r.styleSpec,m=r.key,g=r.arrayElementValidator||r.validateSpec;if(hr(t)!=="array")return[new Ke(m,t,`array expected, ${hr(t)} found`)];if(n.length&&t.length!==n.length)return[new Ke(m,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new Ke(m,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let x={type:n.value,values:n.values};c.$version<7&&(x.function=n.function),hr(n.value)==="object"&&(x=n.value);let S=[];for(let P=0;P<t.length;P++)S=S.concat(g({array:t,arrayIndex:P,value:t[P],valueSpec:x,validateSpec:r.validateSpec,style:o,styleSpec:c,key:`${m}[${P}]`}));return S}function Ms(r){const t=r.key,n=r.value,o=r.valueSpec;let c=hr(n);return c==="number"&&n!=n&&(c="NaN"),c!=="number"?[new Ke(t,n,`number expected, ${c} found`)]:"minimum"in o&&n<o.minimum?[new Ke(t,n,`${n} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&n>o.maximum?[new Ke(t,n,`${n} is greater than the maximum value ${o.maximum}`)]:[]}function Io(r){const t=r.valueSpec,n=Yr(r.value.type);let o,c,m,g={};const x=n!=="categorical"&&r.value.property===void 0,S=!x,P=hr(r.value.stops)==="array"&&hr(r.value.stops[0])==="array"&&hr(r.value.stops[0][0])==="object",z=ii({key:r.key,value:r.value,valueSpec:r.styleSpec.function,validateSpec:r.validateSpec,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(V){if(n==="identity")return[new Ke(V.key,V.value,'identity function may not have a "stops" property')];let q=[];const K=V.value;return q=q.concat(To({key:V.key,value:K,valueSpec:V.valueSpec,validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec,arrayElementValidator:L})),hr(K)==="array"&&K.length===0&&q.push(new Ke(V.key,K,"array must have at least one stop")),q},default:function(V){return V.validateSpec({key:V.key,value:V.value,valueSpec:t,validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec})}}});return n==="identity"&&x&&z.push(new Ke(r.key,r.value,'missing required property "property"')),n==="identity"||r.value.stops||z.push(new Ke(r.key,r.value,'missing required property "stops"')),n==="exponential"&&r.valueSpec.expression&&!hl(r.valueSpec)&&z.push(new Ke(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(S&&!bo(r.valueSpec)?z.push(new Ke(r.key,r.value,"property functions not supported")):x&&!Gu(r.valueSpec)&&z.push(new Ke(r.key,r.value,"zoom functions not supported"))),n!=="categorical"&&!P||r.value.property!==void 0||z.push(new Ke(r.key,r.value,'"property" property is required')),z;function L(V){let q=[];const K=V.value,re=V.key;if(hr(K)!=="array")return[new Ke(re,K,`array expected, ${hr(K)} found`)];if(K.length!==2)return[new Ke(re,K,`array length 2 expected, length ${K.length} found`)];if(P){if(hr(K[0])!=="object")return[new Ke(re,K,`object expected, ${hr(K[0])} found`)];if(K[0].zoom===void 0)return[new Ke(re,K,"object stop key must have zoom")];if(K[0].value===void 0)return[new Ke(re,K,"object stop key must have value")];if(m&&m>Yr(K[0].zoom))return[new Ke(re,K[0].zoom,"stop zoom values must appear in ascending order")];Yr(K[0].zoom)!==m&&(m=Yr(K[0].zoom),c=void 0,g={}),q=q.concat(ii({key:`${re}[0]`,value:K[0],valueSpec:{zoom:{}},validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec,objectElementValidators:{zoom:Ms,value:O}}))}else q=q.concat(O({key:`${re}[0]`,value:K[0],validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec},K));return ba(Li(K[1]))?q.concat([new Ke(`${re}[1]`,K[1],"expressions are not allowed in function stops.")]):q.concat(V.validateSpec({key:`${re}[1]`,value:K[1],valueSpec:t,validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec}))}function O(V,q){const K=hr(V.value),re=Yr(V.value),oe=V.value!==null?V.value:q;if(o){if(K!==o)return[new Ke(V.key,oe,`${K} stop domain type must match previous stop domain type ${o}`)]}else o=K;if(K!=="number"&&K!=="string"&&K!=="boolean")return[new Ke(V.key,oe,"stop domain value must be a number, string, or boolean")];if(K!=="number"&&n!=="categorical"){let we=`number expected, ${K} found`;return bo(t)&&n===void 0&&(we+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ke(V.key,oe,we)]}return n!=="categorical"||K!=="number"||isFinite(re)&&Math.floor(re)===re?n!=="categorical"&&K==="number"&&c!==void 0&&re<c?[new Ke(V.key,oe,"stop domain values must appear in ascending order")]:(c=re,n==="categorical"&&re in g?[new Ke(V.key,oe,"stop domain values must be unique")]:(g[re]=!0,[])):[new Ke(V.key,oe,`integer expected, found ${re}`)]}}function ka(r){const t=(r.expressionContext==="property"?iu:Ka)(Li(r.value),r.valueSpec);if(t.result==="error")return t.value.map((o=>new Ke(`${r.key}${o.key}`,r.value,o.message)));const n=t.value.expression||t.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!n.outputDefined())return[new Ke(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!Es(n))return[new Ke(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!Es(n))return[new Ke(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!Zs(n,["zoom","feature-state"]))return[new Ke(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!wo(n))return[new Ke(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ks(r){const t=r.key,n=r.value,o=r.valueSpec,c=[];return Array.isArray(o.values)?o.values.indexOf(Yr(n))===-1&&c.push(new Ke(t,n,`expected one of [${o.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(o.values).indexOf(Yr(n))===-1&&c.push(new Ke(t,n,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(n)} found`)),c}function Xu(r){return su(Li(r.value))?ka(Ji({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ta(r)}function Ta(r){const t=r.value,n=r.key;if(hr(t)!=="array")return[new Ke(n,t,`array expected, ${hr(t)} found`)];const o=r.styleSpec;let c,m=[];if(t.length<1)return[new Ke(n,t,"filter array must have at least 1 element")];switch(m=m.concat(Ks({key:`${n}[0]`,value:t[0],valueSpec:o.filter_operator,style:r.style,styleSpec:r.styleSpec})),Yr(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Yr(t[1])==="$type"&&m.push(new Ke(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&m.push(new Ke(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(c=hr(t[1]),c!=="string"&&m.push(new Ke(`${n}[1]`,t[1],`string expected, ${c} found`)));for(let g=2;g<t.length;g++)c=hr(t[g]),Yr(t[1])==="$type"?m=m.concat(Ks({key:`${n}[${g}]`,value:t[g],valueSpec:o.geometry_type,style:r.style,styleSpec:r.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&m.push(new Ke(`${n}[${g}]`,t[g],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let g=1;g<t.length;g++)m=m.concat(Ta({key:`${n}[${g}]`,value:t[g],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":c=hr(t[1]),t.length!==2?m.push(new Ke(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):c!=="string"&&m.push(new Ke(`${n}[1]`,t[1],`string expected, ${c} found`))}return m}function Yu(r,t){const n=r.key,o=r.validateSpec,c=r.style,m=r.styleSpec,g=r.value,x=r.objectKey,S=m[`${t}_${r.layerType}`];if(!S)return[];const P=x.match(/^(.*)-transition$/);if(t==="paint"&&P&&S[P[1]]&&S[P[1]].transition)return o({key:n,value:g,valueSpec:m.transition,style:c,styleSpec:m});const z=r.valueSpec||S[x];if(!z)return[new Ke(n,g,`unknown property "${x}"`)];let L;if(hr(g)==="string"&&bo(z)&&!z.tokens&&(L=/^{([^}]+)}$/.exec(g)))return[new Ke(n,g,`"${x}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(L[1])} }\`.`)];const O=[];return r.layerType==="symbol"&&(x==="text-field"&&c&&!c.glyphs&&O.push(new Ke(n,g,'use of "text-field" requires a style "glyphs" property')),x==="text-font"&&dl(Li(g))&&Yr(g.type)==="identity"&&O.push(new Ke(n,g,'"text-font" does not support identity functions'))),O.concat(o({key:r.key,value:g,valueSpec:z,style:c,styleSpec:m,expressionContext:"property",propertyType:t,propertyKey:x}))}function yl(r){return Yu(r,"paint")}function ou(r){return Yu(r,"layout")}function Fr(r){let t=[];const n=r.value,o=r.key,c=r.style,m=r.styleSpec;n.type||n.ref||t.push(new Ke(o,n,'either "type" or "ref" is required'));let g=Yr(n.type);const x=Yr(n.ref);if(n.id){const S=Yr(n.id);for(let P=0;P<r.arrayIndex;P++){const z=c.layers[P];Yr(z.id)===S&&t.push(new Ke(o,n.id,`duplicate layer id "${n.id}", previously used at line ${z.id.__line__}`))}}if("ref"in n){let S;["type","source","source-layer","filter","layout"].forEach((P=>{P in n&&t.push(new Ke(o,n[P],`"${P}" is prohibited for ref layers`))})),c.layers.forEach((P=>{Yr(P.id)===x&&(S=P)})),S?S.ref?t.push(new Ke(o,n.ref,"ref cannot reference another ref layer")):g=Yr(S.type):t.push(new Ke(o,n.ref,`ref layer "${x}" not found`))}else if(g!=="background")if(n.source){const S=c.sources&&c.sources[n.source],P=S&&Yr(S.type);S?P==="vector"&&g==="raster"?t.push(new Ke(o,n.source,`layer "${n.id}" requires a raster source`)):P!=="raster-dem"&&g==="hillshade"?t.push(new Ke(o,n.source,`layer "${n.id}" requires a raster-dem source`)):P==="raster"&&g!=="raster"?t.push(new Ke(o,n.source,`layer "${n.id}" requires a vector source`)):P!=="vector"||n["source-layer"]?P==="raster-dem"&&g!=="hillshade"?t.push(new Ke(o,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):g!=="line"||!n.paint||!n.paint["line-gradient"]||P==="geojson"&&S.lineMetrics||t.push(new Ke(o,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Ke(o,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new Ke(o,n.source,`source "${n.source}" not found`))}else t.push(new Ke(o,n,'missing required property "source"'));return t=t.concat(ii({key:o,value:n,valueSpec:m.layer,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,objectElementValidators:{"*":()=>[],type:()=>r.validateSpec({key:`${o}.type`,value:n.type,valueSpec:m.layer.type,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,object:n,objectKey:"type"}),filter:Xu,layout:S=>ii({layer:n,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":P=>ou(Ji({layerType:g},P))}}),paint:S=>ii({layer:n,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":P=>yl(Ji({layerType:g},P))}})}})),t}function Ws(r){const t=r.value,n=r.key,o=hr(t);return o!=="string"?[new Ke(n,t,`string expected, ${o} found`)]:[]}const Ja={promoteId:function({key:r,value:t}){if(hr(t)==="string")return Ws({key:r,value:t});{const n=[];for(const o in t)n.push(...Ws({key:`${r}.${o}`,value:t[o]}));return n}}};function Xs(r){const t=r.value,n=r.key,o=r.styleSpec,c=r.style,m=r.validateSpec;if(!t.type)return[new Ke(n,t,'"type" is required')];const g=Yr(t.type);let x;switch(g){case"vector":case"raster":return x=ii({key:n,value:t,valueSpec:o[`source_${g.replace("-","_")}`],style:r.style,styleSpec:o,objectElementValidators:Ja,validateSpec:m}),x;case"raster-dem":return x=(function(S){var P;const z=(P=S.sourceName)!==null&&P!==void 0?P:"",L=S.value,O=S.styleSpec,V=O.source_raster_dem,q=S.style;let K=[];const re=hr(L);if(L===void 0)return K;if(re!=="object")return K.push(new Ke("source_raster_dem",L,`object expected, ${re} found`)),K;const oe=Yr(L.encoding)==="custom",we=["redFactor","greenFactor","blueFactor","baseShift"],de=S.value.encoding?`"${S.value.encoding}"`:"Default";for(const _e in L)!oe&&we.includes(_e)?K.push(new Ke(_e,L[_e],`In "${z}": "${_e}" is only valid when "encoding" is set to "custom". ${de} encoding found`)):V[_e]?K=K.concat(S.validateSpec({key:_e,value:L[_e],valueSpec:V[_e],validateSpec:S.validateSpec,style:q,styleSpec:O})):K.push(new Ke(_e,L[_e],`unknown property "${_e}"`));return K})({sourceName:n,value:t,style:r.style,styleSpec:o,validateSpec:m}),x;case"geojson":if(x=ii({key:n,value:t,valueSpec:o.source_geojson,style:c,styleSpec:o,validateSpec:m,objectElementValidators:Ja}),t.cluster)for(const S in t.clusterProperties){const[P,z]=t.clusterProperties[S],L=typeof P=="string"?[P,["accumulated"],["get",S]]:P;x.push(...ka({key:`${n}.${S}.map`,value:z,expressionContext:"cluster-map"})),x.push(...ka({key:`${n}.${S}.reduce`,value:L,expressionContext:"cluster-reduce"}))}return x;case"video":return ii({key:n,value:t,valueSpec:o.source_video,style:c,validateSpec:m,styleSpec:o});case"image":return ii({key:n,value:t,valueSpec:o.source_image,style:c,validateSpec:m,styleSpec:o});case"canvas":return[new Ke(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ks({key:`${n}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function lu(r){const t=r.value,n=r.styleSpec,o=n.light,c=r.style;let m=[];const g=hr(t);if(t===void 0)return m;if(g!=="object")return m=m.concat([new Ke("light",t,`object expected, ${g} found`)]),m;for(const x in t){const S=x.match(/^(.*)-transition$/);m=m.concat(S&&o[S[1]]&&o[S[1]].transition?r.validateSpec({key:x,value:t[x],valueSpec:n.transition,validateSpec:r.validateSpec,style:c,styleSpec:n}):o[x]?r.validateSpec({key:x,value:t[x],valueSpec:o[x],validateSpec:r.validateSpec,style:c,styleSpec:n}):[new Ke(x,t[x],`unknown property "${x}"`)])}return m}function _l(r){const t=r.value,n=r.styleSpec,o=n.sky,c=r.style,m=hr(t);if(t===void 0)return[];if(m!=="object")return[new Ke("sky",t,`object expected, ${m} found`)];let g=[];for(const x in t)g=g.concat(o[x]?r.validateSpec({key:x,value:t[x],valueSpec:o[x],style:c,styleSpec:n}):[new Ke(x,t[x],`unknown property "${x}"`)]);return g}function Qa(r){const t=r.value,n=r.styleSpec,o=n.terrain,c=r.style;let m=[];const g=hr(t);if(t===void 0)return m;if(g!=="object")return m=m.concat([new Ke("terrain",t,`object expected, ${g} found`)]),m;for(const x in t)m=m.concat(o[x]?r.validateSpec({key:x,value:t[x],valueSpec:o[x],validateSpec:r.validateSpec,style:c,styleSpec:n}):[new Ke(x,t[x],`unknown property "${x}"`)]);return m}function Eo(r){let t=[];const n=r.value,o=r.key;if(Array.isArray(n)){const c=[],m=[];for(const g in n)n[g].id&&c.includes(n[g].id)&&t.push(new Ke(o,n,`all the sprites' ids must be unique, but ${n[g].id} is duplicated`)),c.push(n[g].id),n[g].url&&m.includes(n[g].url)&&t.push(new Ke(o,n,`all the sprites' URLs must be unique, but ${n[g].url} is duplicated`)),m.push(n[g].url),t=t.concat(ii({key:`${o}[${g}]`,value:n[g],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:r.validateSpec}));return t}return Ws({key:o,value:n})}const Ys={"*":()=>[],array:To,boolean:function(r){const t=r.value,n=r.key,o=hr(t);return o!=="boolean"?[new Ke(n,t,`boolean expected, ${o} found`)]:[]},number:Ms,color:function(r){const t=r.key,n=r.value,o=hr(n);return o!=="string"?[new Ke(t,n,`color expected, ${o} found`)]:Vt.parse(String(n))?[]:[new Ke(t,n,`color expected, "${n}" found`)]},constants:Wu,enum:Ks,filter:Xu,function:Io,layer:Fr,object:ii,source:Xs,light:lu,sky:_l,terrain:Qa,projection:function(r){const t=r.value,n=r.styleSpec,o=n.projection,c=r.style,m=hr(t);if(t===void 0)return[];if(m!=="object")return[new Ke("projection",t,`object expected, ${m} found`)];let g=[];for(const x in t)g=g.concat(o[x]?r.validateSpec({key:x,value:t[x],valueSpec:o[x],style:c,styleSpec:n}):[new Ke(x,t[x],`unknown property "${x}"`)]);return g},string:Ws,formatted:function(r){return Ws(r).length===0?[]:ka(r)},resolvedImage:function(r){return Ws(r).length===0?[]:ka(r)},padding:function(r){const t=r.key,n=r.value;if(hr(n)==="array"){if(n.length<1||n.length>4)return[new Ke(t,n,`padding requires 1 to 4 values; ${n.length} values found`)];const o={type:"number"};let c=[];for(let m=0;m<n.length;m++)c=c.concat(r.validateSpec({key:`${t}[${m}]`,value:n[m],validateSpec:r.validateSpec,valueSpec:o}));return c}return Ms({key:t,value:n,valueSpec:{}})},variableAnchorOffsetCollection:function(r){const t=r.key,n=r.value,o=hr(n),c=r.styleSpec;if(o!=="array"||n.length<1||n.length%2!=0)return[new Ke(t,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let m=[];for(let g=0;g<n.length;g+=2)m=m.concat(Ks({key:`${t}[${g}]`,value:n[g],valueSpec:c.layout_symbol["text-anchor"]})),m=m.concat(To({key:`${t}[${g+1}]`,value:n[g+1],valueSpec:{length:2,value:"number"},validateSpec:r.validateSpec,style:r.style,styleSpec:c}));return m},sprite:Eo};function Po(r){const t=r.value,n=r.valueSpec,o=r.styleSpec;return r.validateSpec=Po,n.expression&&dl(Yr(t))?Io(r):n.expression&&ba(Li(t))?ka(r):n.type&&Ys[n.type]?Ys[n.type](r):ii(Ji({},r,{valueSpec:n.type?o[n.type]:n}))}function ih(r){const t=r.value,n=r.key,o=Ws(r);return o.length||(t.indexOf("{fontstack}")===-1&&o.push(new Ke(n,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&o.push(new Ke(n,t,'"glyphs" url must include a "{range}" token'))),o}function Ri(r,t=Ee){let n=[];return n=n.concat(Po({key:"",value:r,valueSpec:t.$root,styleSpec:t,style:r,validateSpec:Po,objectElementValidators:{glyphs:ih,"*":()=>[]}})),r.constants&&(n=n.concat(Wu({key:"constants",value:r.constants}))),Co(n)}function is(r){return function(t){return r({...t,validateSpec:Po})}}function Co(r){return[].concat(r).sort(((t,n)=>t.line-n.line))}function si(r){return function(...t){return Co(r.apply(this,t))}}Ri.source=si(is(Xs)),Ri.sprite=si(is(Eo)),Ri.glyphs=si(is(ih)),Ri.light=si(is(lu)),Ri.sky=si(is(_l)),Ri.terrain=si(is(Qa)),Ri.layer=si(is(Fr)),Ri.filter=si(is(Xu)),Ri.paintProperty=si(is(yl)),Ri.layoutProperty=si(is(ou));const Js=Ri,Ju=Js.light,Qu=Js.sky,uu=Js.paintProperty,sh=Js.layoutProperty;function cu(r,t){let n=!1;if(t&&t.length)for(const o of t)r.fire(new bs(new Error(o.message))),n=!0;return n}class Mo{constructor(t,n,o){const c=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const g=new Int32Array(this.arrayBuffer);t=g[0],this.d=(n=g[1])+2*(o=g[2]);for(let S=0;S<this.d*this.d;S++){const P=g[3+S],z=g[3+S+1];c.push(P===z?null:g.subarray(P,z))}const x=g[3+c.length+1];this.keys=g.subarray(g[3+c.length],x),this.bboxes=g.subarray(x),this.insert=this._insertReadonly}else{this.d=n+2*o;for(let g=0;g<this.d*this.d;g++)c.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=t,this.padding=o,this.scale=n/t,this.uid=0;const m=o/n*t;this.min=-m,this.max=t+m}insert(t,n,o,c,m){this._forEachCell(n,o,c,m,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(c),this.bboxes.push(m)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,n,o,c,m,g){this.cells[m].push(g)}query(t,n,o,c,m){const g=this.min,x=this.max;if(t<=g&&n<=g&&x<=o&&x<=c&&!m)return Array.prototype.slice.call(this.keys);{const S=[];return this._forEachCell(t,n,o,c,this._queryCell,S,{},m),S}}_queryCell(t,n,o,c,m,g,x,S){const P=this.cells[m];if(P!==null){const z=this.keys,L=this.bboxes;for(let O=0;O<P.length;O++){const V=P[O];if(x[V]===void 0){const q=4*V;(S?S(L[q+0],L[q+1],L[q+2],L[q+3]):t<=L[q+2]&&n<=L[q+3]&&o>=L[q+0]&&c>=L[q+1])?(x[V]=!0,g.push(z[V])):x[V]=!1}}}}_forEachCell(t,n,o,c,m,g,x,S){const P=this._convertToCellCoord(t),z=this._convertToCellCoord(n),L=this._convertToCellCoord(o),O=this._convertToCellCoord(c);for(let V=P;V<=L;V++)for(let q=z;q<=O;q++){const K=this.d*q+V;if((!S||S(this._convertFromCellCoord(V),this._convertFromCellCoord(q),this._convertFromCellCoord(V+1),this._convertFromCellCoord(q+1)))&&m.call(this,t,n,o,c,K,g,x,S))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,n=3+this.cells.length+1+1;let o=0;for(let g=0;g<this.cells.length;g++)o+=this.cells[g].length;const c=new Int32Array(n+o+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;let m=n;for(let g=0;g<t.length;g++){const x=t[g];c[3+g]=m,c.set(x,m),m+=x.length}return c[3+t.length]=m,c.set(this.keys,m),m+=this.keys.length,c[3+t.length+1]=m,c.set(this.bboxes,m),m+=this.bboxes.length,c.buffer}static serialize(t,n){const o=t.toArrayBuffer();return n&&n.push(o),{buffer:o}}static deserialize(t){return new Mo(t.buffer)}}const Bi={};function mt(r,t,n={}){if(Bi[r])throw new Error(`${r} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:r,writeable:!1}),Bi[r]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}mt("Object",Object),mt("TransferableGridIndex",Mo),mt("Color",Vt),mt("Error",Error),mt("AJAXError",ur),mt("ResolvedImage",Bn),mt("StylePropertyFunction",Sa),mt("StyleExpression",ni,{omit:["_evaluator"]}),mt("ZoomDependentExpression",Xa),mt("ZoomConstantExpression",Wa),mt("CompoundExpression",xi,{omit:["_evaluate"]});for(const r in Ga)Ga[r]._classRegistryKey||mt(`Expression_${r}`,Ga[r]);function ss(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function hu(r){return r.$name||r.constructor._classRegistryKey}function eo(r){return!(function(t){if(t===null||typeof t!="object")return!1;const n=hu(t);return!(!n||n==="Object")})(r)&&(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||r instanceof Error||ss(r)||$t(r)||ArrayBuffer.isView(r)||r instanceof ImageData)}function Gn(r,t){if(eo(r))return(ss(r)||$t(r))&&t&&t.push(r),ArrayBuffer.isView(r)&&t&&t.push(r.buffer),r instanceof ImageData&&t&&t.push(r.data.buffer),r;if(Array.isArray(r)){const m=[];for(const g of r)m.push(Gn(g,t));return m}if(typeof r!="object")throw new Error("can't serialize object of type "+typeof r);const n=hu(r);if(!n)throw new Error(`can't serialize object of unregistered class ${r.constructor.name}`);if(!Bi[n])throw new Error(`${n} is not registered.`);const{klass:o}=Bi[n],c=o.serialize?o.serialize(r,t):{};if(o.serialize){if(t&&c===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const m in r){if(!r.hasOwnProperty(m)||Bi[n].omit.indexOf(m)>=0)continue;const g=r[m];c[m]=Bi[n].shallow.indexOf(m)>=0?g:Gn(g,t)}r instanceof Error&&(c.message=r.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(c.$name=n),c}function As(r){if(eo(r))return r;if(Array.isArray(r))return r.map(As);if(typeof r!="object")throw new Error("can't deserialize object of type "+typeof r);const t=hu(r)||"Object";if(!Bi[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:n}=Bi[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(r);const o=Object.create(n.prototype);for(const c of Object.keys(r)){if(c==="$name")continue;const m=r[c];o[c]=Bi[t].shallow.indexOf(c)>=0?m:As(m)}return o}class as{constructor(){this.first=!0}update(t,n){const o=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=n),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=o,!0))}}const sr={"Latin-1 Supplement":r=>r>=128&&r<=255,"Hangul Jamo":r=>r>=4352&&r<=4607,Khmer:r=>r>=6016&&r<=6143,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Katakana:r=>r>=12448&&r<=12543,Kanbun:r=>r>=12688&&r<=12703,"CJK Strokes":r=>r>=12736&&r<=12783,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"Private Use Area":r=>r>=57344&&r<=63743,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519};function ec(r){for(const t of r)if(wl(t.charCodeAt(0)))return!0;return!1}function od(r){for(const t of r)if(!os(t.charCodeAt(0)))return!1;return!0}function Qs(r){const t=r.map((n=>{try{return new RegExp(`\\p{sc=${n}}`,"u").source}catch{return null}})).filter((n=>n));return new RegExp(t.join("|"),"u")}const vl=Qs(["Arab","Dupl","Mong","Ougr","Syrc"]);function os(r){return!vl.test(String.fromCodePoint(r))}const xl=Qs(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function wl(r){return!(r!==746&&r!==747&&(r<4352||!(sr["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||sr["CJK Compatibility"](r)||sr["CJK Strokes"](r)||!(!sr["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||sr["Enclosed CJK Letters and Months"](r)||sr["Ideographic Description Characters"](r)||sr.Kanbun(r)||sr.Katakana(r)&&r!==12540||!(!sr["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!sr["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||sr["Vertical Forms"](r)||sr["Yijing Hexagram Symbols"](r)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(r))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(r))||xl.test(String.fromCodePoint(r)))))}function to(r){return!(wl(r)||(function(t){return!!(sr["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||sr["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||sr["Letterlike Symbols"](t)||sr["Number Forms"](t)||sr["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||sr["Control Pictures"](t)&&t!==9251||sr["Optical Character Recognition"](t)||sr["Enclosed Alphanumerics"](t)||sr["Geometric Shapes"](t)||sr["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||sr["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||sr["CJK Symbols and Punctuation"](t)||sr.Katakana(t)||sr["Private Use Area"](t)||sr["CJK Compatibility Forms"](t)||sr["Small Form Variants"](t)||sr["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)})(r))}const Ia=Qs(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Or(r){return Ia.test(String.fromCodePoint(r))}function Vr(r,t){return!(!t&&Or(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||sr.Khmer(r))}function Ea(r){for(const t of r)if(Or(t.charCodeAt(0)))return!0;return!1}const Ar=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(r){this.pluginStatus=r.pluginStatus,this.pluginURL=r.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(r){this.applyArabicShaping=r.applyArabicShaping,this.processBidirectionalText=r.processBidirectionalText,this.processStyledBidirectionalText=r.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class lr{constructor(t,n){this.zoom=t,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new as,this.transition={})}isSupportedScript(t){return(function(n,o){for(const c of n)if(!Vr(c.charCodeAt(0),o))return!1;return!0})(t,Ar.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,n=t-Math.floor(t),o=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*n}}}class Fi{constructor(t,n){this.property=t,this.value=n,this.expression=(function(o,c){if(dl(o))return new Sa(o,c);if(ba(o)){const m=iu(o,c);if(m.result==="error")throw new Error(m.value.map((g=>`${g.key}: ${g.message}`)).join(", "));return m.value}{let m=o;return c.type==="color"&&typeof o=="string"?m=Vt.parse(o):c.type!=="padding"||typeof o!="number"&&!Array.isArray(o)?c.type==="variableAnchorOffsetCollection"&&Array.isArray(o)&&(m=_i.parse(o)):m=Rn.parse(o),{kind:"constant",evaluate:()=>m}}})(n===void 0?t.specification.default:n,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,n,o){return this.property.possiblyEvaluate(this,t,n,o)}}class ea{constructor(t){this.property=t,this.value=new Fi(t,void 0)}transitioned(t,n){return new bl(this.property,this.value,n,je({},t.transition,this.transition),t.now)}untransitioned(){return new bl(this.property,this.value,null,{},0)}}class Cn{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return xt(this._values[t].value.value)}setValue(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new ea(this._values[t].property)),this._values[t].value=new Fi(this._values[t].property,n===null?void 0:xt(n))}getTransition(t){return xt(this._values[t].transition)}setTransition(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new ea(this._values[t].property)),this._values[t].transition=xt(n)||void 0}serialize(){const t={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(t[n]=o);const c=this.getTransition(n);c!==void 0&&(t[`${n}-transition`]=c)}return t}transitioned(t,n){const o=new Ao(this._properties);for(const c of Object.keys(this._values))o._values[c]=this._values[c].transitioned(t,n._values[c]);return o}untransitioned(){const t=new Ao(this._properties);for(const n of Object.keys(this._values))t._values[n]=this._values[n].untransitioned();return t}}class bl{constructor(t,n,o,c,m){this.property=t,this.value=n,this.begin=m+c.delay||0,this.end=this.begin+c.duration||0,t.specification.transition&&(c.delay||c.duration)&&(this.prior=o)}possiblyEvaluate(t,n,o){const c=t.now||0,m=this.value.possiblyEvaluate(t,n,o),g=this.prior;if(g){if(c>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(c<this.begin)return g.possiblyEvaluate(t,n,o);{const x=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(t,n,o),m,(function(S){if(S<=0)return 0;if(S>=1)return 1;const P=S*S,z=P*S;return 4*(S<.5?z:3*(S-P)+z-.75)})(x))}}return m}}class Ao{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,n,o){const c=new Do(this._properties);for(const m of Object.keys(this._values))c._values[m]=this._values[m].possiblyEvaluate(t,n,o);return c}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class zo{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return xt(this._values[t].value)}setValue(t,n){this._values[t]=new Fi(this._values[t].property,n===null?void 0:xt(n))}serialize(){const t={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(t[n]=o)}return t}possiblyEvaluate(t,n,o){const c=new Do(this._properties);for(const m of Object.keys(this._values))c._values[m]=this._values[m].possiblyEvaluate(t,n,o);return c}}class wi{constructor(t,n,o){this.property=t,this.value=n,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,n,o,c){return this.property.evaluate(this.value,this.parameters,t,n,o,c)}}class Do{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class gt{constructor(t){this.specification=t}possiblyEvaluate(t,n){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(n)}interpolate(t,n,o){const c=on[this.specification.type];return c?c(t,n,o):t}}class At{constructor(t,n){this.specification=t,this.overrides=n}possiblyEvaluate(t,n,o,c){return new wi(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(n,null,{},o,c)}:t.expression,n)}interpolate(t,n,o){if(t.value.kind!=="constant"||n.value.kind!=="constant")return t;if(t.value.value===void 0||n.value.value===void 0)return new wi(this,{kind:"constant",value:void 0},t.parameters);const c=on[this.specification.type];if(c){const m=c(t.value.value,n.value.value,o);return new wi(this,{kind:"constant",value:m},t.parameters)}return t}evaluate(t,n,o,c,m,g){return t.kind==="constant"?t.value:t.evaluate(n,o,c,m,g)}}class Lo extends At{possiblyEvaluate(t,n,o,c){if(t.value===void 0)return new wi(this,{kind:"constant",value:void 0},n);if(t.expression.kind==="constant"){const m=t.expression.evaluate(n,null,{},o,c),g=t.property.specification.type==="resolvedImage"&&typeof m!="string"?m.name:m,x=this._calculate(g,g,g,n);return new wi(this,{kind:"constant",value:x},n)}if(t.expression.kind==="camera"){const m=this._calculate(t.expression.evaluate({zoom:n.zoom-1}),t.expression.evaluate({zoom:n.zoom}),t.expression.evaluate({zoom:n.zoom+1}),n);return new wi(this,{kind:"constant",value:m},n)}return new wi(this,t.expression,n)}evaluate(t,n,o,c,m,g){if(t.kind==="source"){const x=t.evaluate(n,o,c,m,g);return this._calculate(x,x,x,n)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(n.zoom)-1},o,c),t.evaluate({zoom:Math.floor(n.zoom)},o,c),t.evaluate({zoom:Math.floor(n.zoom)+1},o,c),n):t.value}_calculate(t,n,o,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:o,to:n}}interpolate(t){return t}}class Sl{constructor(t){this.specification=t}possiblyEvaluate(t,n,o,c){if(t.value!==void 0){if(t.expression.kind==="constant"){const m=t.expression.evaluate(n,null,{},o,c);return this._calculate(m,m,m,n)}return this._calculate(t.expression.evaluate(new lr(Math.floor(n.zoom-1),n)),t.expression.evaluate(new lr(Math.floor(n.zoom),n)),t.expression.evaluate(new lr(Math.floor(n.zoom+1),n)),n)}}_calculate(t,n,o,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:o,to:n}}interpolate(t){return t}}class tc{constructor(t){this.specification=t}possiblyEvaluate(t,n,o,c){return!!t.expression.evaluate(n,null,{},o,c)}interpolate(){return!1}}class f{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in t){const o=t[n];o.specification.overridable&&this.overridableProperties.push(n);const c=this.defaultPropertyValues[n]=new Fi(o,void 0),m=this.defaultTransitionablePropertyValues[n]=new ea(o);this.defaultTransitioningPropertyValues[n]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=c.possiblyEvaluate({})}}}mt("DataDrivenProperty",At),mt("DataConstantProperty",gt),mt("CrossFadedDataDrivenProperty",Lo),mt("CrossFadedProperty",Sl),mt("ColorRampProperty",tc);const e="-transition";class s extends Ra{constructor(t,n){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),n.layout&&(this._unevaluatedLayout=new zo(n.layout)),n.paint)){this._transitionablePaint=new Cn(n.paint);for(const o in t.paint)this.setPaintProperty(o,t.paint[o],{validate:!1});for(const o in t.layout)this.setLayoutProperty(o,t.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Do(n.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,n,o={}){n!=null&&this._validate(sh,`layers.${this.id}.layout.${t}`,t,n,o)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,n):this.visibility=n)}getPaintProperty(t){return t.endsWith(e)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,n,o={}){if(n!=null&&this._validate(uu,`layers.${this.id}.paint.${t}`,t,n,o))return!1;if(t.endsWith(e))return this._transitionablePaint.setTransition(t.slice(0,-11),n||void 0),!1;{const c=this._transitionablePaint._values[t],m=c.property.specification["property-type"]==="cross-faded-data-driven",g=c.value.isDataDriven(),x=c.value;this._transitionablePaint.setValue(t,n),this._handleSpecialPaintPropertyUpdate(t);const S=this._transitionablePaint._values[t].value;return S.isDataDriven()||g||m||this._handleOverridablePaintPropertyUpdate(t,x,S)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,n,o){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,n){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,n)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),ar(t,((n,o)=>!(n===void 0||o==="layout"&&!Object.keys(n).length||o==="paint"&&!Object.keys(n).length)))}_validate(t,n,o,c,m={}){return(!m||m.validate!==!1)&&cu(this,t.call(Js,{key:n,layerType:this.type,objectKey:o,value:c,styleSpec:Ee,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const n=this.paint.get(t);if(n instanceof wi&&bo(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}const l={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class u{constructor(t,n){this._structArray=t,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class p{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,n){return t._trim(),n&&(t.isTransferred=!0,n.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const n=Object.create(this.prototype);return n.arrayBuffer=t.arrayBuffer,n.length=t.length,n.capacity=t.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function w(r,t=1){let n=0,o=0;return{members:r.map((c=>{const m=l[c.type].BYTES_PER_ELEMENT,g=n=k(n,Math.max(t,m)),x=c.components||1;return o=Math.max(o,m),n+=m*x,{name:c.name,type:c.type,components:x,offset:g}})),size:k(n,Math.max(o,t)),alignment:t}}function k(r,t){return Math.ceil(r/t)*t}class E extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const c=2*t;return this.int16[c+0]=n,this.int16[c+1]=o,t}}E.prototype.bytesPerElement=4,mt("StructArrayLayout2i4",E);class A extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,o)}emplace(t,n,o,c){const m=3*t;return this.int16[m+0]=n,this.int16[m+1]=o,this.int16[m+2]=c,t}}A.prototype.bytesPerElement=6,mt("StructArrayLayout3i6",A);class R extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,c){const m=this.length;return this.resize(m+1),this.emplace(m,t,n,o,c)}emplace(t,n,o,c,m){const g=4*t;return this.int16[g+0]=n,this.int16[g+1]=o,this.int16[g+2]=c,this.int16[g+3]=m,t}}R.prototype.bytesPerElement=8,mt("StructArrayLayout4i8",R);class B extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g){const x=this.length;return this.resize(x+1),this.emplace(x,t,n,o,c,m,g)}emplace(t,n,o,c,m,g,x){const S=6*t;return this.int16[S+0]=n,this.int16[S+1]=o,this.int16[S+2]=c,this.int16[S+3]=m,this.int16[S+4]=g,this.int16[S+5]=x,t}}B.prototype.bytesPerElement=12,mt("StructArrayLayout2i4i12",B);class U extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g){const x=this.length;return this.resize(x+1),this.emplace(x,t,n,o,c,m,g)}emplace(t,n,o,c,m,g,x){const S=4*t,P=8*t;return this.int16[S+0]=n,this.int16[S+1]=o,this.uint8[P+4]=c,this.uint8[P+5]=m,this.uint8[P+6]=g,this.uint8[P+7]=x,t}}U.prototype.bytesPerElement=8,mt("StructArrayLayout2i4ub8",U);class G extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const c=2*t;return this.float32[c+0]=n,this.float32[c+1]=o,t}}G.prototype.bytesPerElement=8,mt("StructArrayLayout2f8",G);class X extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g,x,S,P,z){const L=this.length;return this.resize(L+1),this.emplace(L,t,n,o,c,m,g,x,S,P,z)}emplace(t,n,o,c,m,g,x,S,P,z,L){const O=10*t;return this.uint16[O+0]=n,this.uint16[O+1]=o,this.uint16[O+2]=c,this.uint16[O+3]=m,this.uint16[O+4]=g,this.uint16[O+5]=x,this.uint16[O+6]=S,this.uint16[O+7]=P,this.uint16[O+8]=z,this.uint16[O+9]=L,t}}X.prototype.bytesPerElement=20,mt("StructArrayLayout10ui20",X);class J extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g,x,S,P,z,L,O){const V=this.length;return this.resize(V+1),this.emplace(V,t,n,o,c,m,g,x,S,P,z,L,O)}emplace(t,n,o,c,m,g,x,S,P,z,L,O,V){const q=12*t;return this.int16[q+0]=n,this.int16[q+1]=o,this.int16[q+2]=c,this.int16[q+3]=m,this.uint16[q+4]=g,this.uint16[q+5]=x,this.uint16[q+6]=S,this.uint16[q+7]=P,this.int16[q+8]=z,this.int16[q+9]=L,this.int16[q+10]=O,this.int16[q+11]=V,t}}J.prototype.bytesPerElement=24,mt("StructArrayLayout4i4ui4i24",J);class te extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,o)}emplace(t,n,o,c){const m=3*t;return this.float32[m+0]=n,this.float32[m+1]=o,this.float32[m+2]=c,t}}te.prototype.bytesPerElement=12,mt("StructArrayLayout3f12",te);class se extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint32[1*t+0]=n,t}}se.prototype.bytesPerElement=4,mt("StructArrayLayout1ul4",se);class ce extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g,x,S,P){const z=this.length;return this.resize(z+1),this.emplace(z,t,n,o,c,m,g,x,S,P)}emplace(t,n,o,c,m,g,x,S,P,z){const L=10*t,O=5*t;return this.int16[L+0]=n,this.int16[L+1]=o,this.int16[L+2]=c,this.int16[L+3]=m,this.int16[L+4]=g,this.int16[L+5]=x,this.uint32[O+3]=S,this.uint16[L+8]=P,this.uint16[L+9]=z,t}}ce.prototype.bytesPerElement=20,mt("StructArrayLayout6i1ul2ui20",ce);class Q extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g){const x=this.length;return this.resize(x+1),this.emplace(x,t,n,o,c,m,g)}emplace(t,n,o,c,m,g,x){const S=6*t;return this.int16[S+0]=n,this.int16[S+1]=o,this.int16[S+2]=c,this.int16[S+3]=m,this.int16[S+4]=g,this.int16[S+5]=x,t}}Q.prototype.bytesPerElement=12,mt("StructArrayLayout2i2i2i12",Q);class fe extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m){const g=this.length;return this.resize(g+1),this.emplace(g,t,n,o,c,m)}emplace(t,n,o,c,m,g){const x=4*t,S=8*t;return this.float32[x+0]=n,this.float32[x+1]=o,this.float32[x+2]=c,this.int16[S+6]=m,this.int16[S+7]=g,t}}fe.prototype.bytesPerElement=16,mt("StructArrayLayout2f1f2i16",fe);class ye extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g){const x=this.length;return this.resize(x+1),this.emplace(x,t,n,o,c,m,g)}emplace(t,n,o,c,m,g,x){const S=16*t,P=4*t,z=8*t;return this.uint8[S+0]=n,this.uint8[S+1]=o,this.float32[P+1]=c,this.float32[P+2]=m,this.int16[z+6]=g,this.int16[z+7]=x,t}}ye.prototype.bytesPerElement=16,mt("StructArrayLayout2ub2f2i16",ye);class be extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,o)}emplace(t,n,o,c){const m=3*t;return this.uint16[m+0]=n,this.uint16[m+1]=o,this.uint16[m+2]=c,t}}be.prototype.bytesPerElement=6,mt("StructArrayLayout3ui6",be);class Fe extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g,x,S,P,z,L,O,V,q,K,re,oe){const we=this.length;return this.resize(we+1),this.emplace(we,t,n,o,c,m,g,x,S,P,z,L,O,V,q,K,re,oe)}emplace(t,n,o,c,m,g,x,S,P,z,L,O,V,q,K,re,oe,we){const de=24*t,_e=12*t,Ae=48*t;return this.int16[de+0]=n,this.int16[de+1]=o,this.uint16[de+2]=c,this.uint16[de+3]=m,this.uint32[_e+2]=g,this.uint32[_e+3]=x,this.uint32[_e+4]=S,this.uint16[de+10]=P,this.uint16[de+11]=z,this.uint16[de+12]=L,this.float32[_e+7]=O,this.float32[_e+8]=V,this.uint8[Ae+36]=q,this.uint8[Ae+37]=K,this.uint8[Ae+38]=re,this.uint32[_e+10]=oe,this.int16[de+22]=we,t}}Fe.prototype.bytesPerElement=48,mt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Fe);class Ge extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g,x,S,P,z,L,O,V,q,K,re,oe,we,de,_e,Ae,Ve,dt,Lt,ht,lt,kt,vt){const yt=this.length;return this.resize(yt+1),this.emplace(yt,t,n,o,c,m,g,x,S,P,z,L,O,V,q,K,re,oe,we,de,_e,Ae,Ve,dt,Lt,ht,lt,kt,vt)}emplace(t,n,o,c,m,g,x,S,P,z,L,O,V,q,K,re,oe,we,de,_e,Ae,Ve,dt,Lt,ht,lt,kt,vt,yt){const Be=32*t,It=16*t;return this.int16[Be+0]=n,this.int16[Be+1]=o,this.int16[Be+2]=c,this.int16[Be+3]=m,this.int16[Be+4]=g,this.int16[Be+5]=x,this.int16[Be+6]=S,this.int16[Be+7]=P,this.uint16[Be+8]=z,this.uint16[Be+9]=L,this.uint16[Be+10]=O,this.uint16[Be+11]=V,this.uint16[Be+12]=q,this.uint16[Be+13]=K,this.uint16[Be+14]=re,this.uint16[Be+15]=oe,this.uint16[Be+16]=we,this.uint16[Be+17]=de,this.uint16[Be+18]=_e,this.uint16[Be+19]=Ae,this.uint16[Be+20]=Ve,this.uint16[Be+21]=dt,this.uint16[Be+22]=Lt,this.uint32[It+12]=ht,this.float32[It+13]=lt,this.float32[It+14]=kt,this.uint16[Be+30]=vt,this.uint16[Be+31]=yt,t}}Ge.prototype.bytesPerElement=64,mt("StructArrayLayout8i15ui1ul2f2ui64",Ge);class Qe extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.float32[1*t+0]=n,t}}Qe.prototype.bytesPerElement=4,mt("StructArrayLayout1f4",Qe);class ut extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,o)}emplace(t,n,o,c){const m=3*t;return this.uint16[6*t+0]=n,this.float32[m+1]=o,this.float32[m+2]=c,t}}ut.prototype.bytesPerElement=12,mt("StructArrayLayout1ui2f12",ut);class tt extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,o)}emplace(t,n,o,c){const m=4*t;return this.uint32[2*t+0]=n,this.uint16[m+2]=o,this.uint16[m+3]=c,t}}tt.prototype.bytesPerElement=8,mt("StructArrayLayout1ul2ui8",tt);class Xe extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const c=2*t;return this.uint16[c+0]=n,this.uint16[c+1]=o,t}}Xe.prototype.bytesPerElement=4,mt("StructArrayLayout2ui4",Xe);class _t extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint16[1*t+0]=n,t}}_t.prototype.bytesPerElement=2,mt("StructArrayLayout1ui2",_t);class Ft extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,c){const m=this.length;return this.resize(m+1),this.emplace(m,t,n,o,c)}emplace(t,n,o,c,m){const g=4*t;return this.float32[g+0]=n,this.float32[g+1]=o,this.float32[g+2]=c,this.float32[g+3]=m,t}}Ft.prototype.bytesPerElement=16,mt("StructArrayLayout4f16",Ft);class nt extends u{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Y(this.anchorPointX,this.anchorPointY)}}nt.prototype.size=20;class st extends ce{get(t){return new nt(this,t)}}mt("CollisionBoxArray",st);class Bt extends u{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Bt.prototype.size=48;class Cr extends Fe{get(t){return new Bt(this,t)}}mt("PlacedSymbolArray",Cr);class Ht extends u{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Ht.prototype.size=64;class Qt extends Ge{get(t){return new Ht(this,t)}}mt("SymbolInstanceArray",Qt);class zr extends Qe{getoffsetX(t){return this.float32[1*t+0]}}mt("GlyphOffsetArray",zr);class Tn extends A{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}mt("SymbolLineVertexArray",Tn);class bi extends u{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}bi.prototype.size=12;class Dr extends ut{get(t){return new bi(this,t)}}mt("TextAnchorOffsetArray",Dr);class _n extends u{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}_n.prototype.size=8;class Ur extends tt{get(t){return new _n(this,t)}}mt("FeatureIndexArray",Ur);class rn extends E{}class Mn extends E{}class ls extends E{}class ai extends B{}class us extends U{}class Pa extends G{}class Si extends X{}class Oi extends J{}class zs extends te{}class Hn extends se{}class ki extends Q{}class cs extends ye{}class Ni extends be{}class ln extends Xe{}const qr=w([{name:"a_pos",components:2,type:"Int16"}],4),{members:An}=qr;class rr{constructor(t=[]){this.segments=t}prepareSegment(t,n,o,c){let m=this.segments[this.segments.length-1];return t>rr.MAX_VERTEX_ARRAY_LENGTH&&Zt(`Max vertices per segment is ${rr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!m||m.vertexLength+t>rr.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==c)&&(m={vertexOffset:n.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0},c!==void 0&&(m.sortKey=c),this.segments.push(m)),m}get(){return this.segments}destroy(){for(const t of this.segments)for(const n in t.vaos)t.vaos[n].destroy()}static simpleSegment(t,n,o,c){return new rr([{vertexOffset:t,primitiveOffset:n,vertexLength:o,primitiveLength:c,vaos:{},sortKey:0}])}}function Ti(r,t){return 256*(r=Je(Math.floor(r),0,255))+Je(Math.floor(t),0,255)}rr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,mt("SegmentVector",rr);const Ca=w([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var hs={exports:{}},rc={exports:{}};rc.exports=function(r,t){var n,o,c,m,g,x,S,P;for(o=r.length-(n=3&r.length),c=t,g=3432918353,x=461845907,P=0;P<o;)S=255&r.charCodeAt(P)|(255&r.charCodeAt(++P))<<8|(255&r.charCodeAt(++P))<<16|(255&r.charCodeAt(++P))<<24,++P,c=27492+(65535&(m=5*(65535&(c=(c^=S=(65535&(S=(S=(65535&S)*g+(((S>>>16)*g&65535)<<16)&4294967295)<<15|S>>>17))*x+(((S>>>16)*x&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(S=0,n){case 3:S^=(255&r.charCodeAt(P+2))<<16;case 2:S^=(255&r.charCodeAt(P+1))<<8;case 1:c^=S=(65535&(S=(S=(65535&(S^=255&r.charCodeAt(P)))*g+(((S>>>16)*g&65535)<<16)&4294967295)<<15|S>>>17))*x+(((S>>>16)*x&65535)<<16)&4294967295}return c^=r.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0};var nc=rc.exports,Hr={exports:{}};Hr.exports=function(r,t){for(var n,o=r.length,c=t^o,m=0;o>=4;)n=1540483477*(65535&(n=255&r.charCodeAt(m)|(255&r.charCodeAt(++m))<<8|(255&r.charCodeAt(++m))<<16|(255&r.charCodeAt(++m))<<24))+((1540483477*(n>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),o-=4,++m;switch(o){case 3:c^=(255&r.charCodeAt(m+2))<<16;case 2:c^=(255&r.charCodeAt(m+1))<<8;case 1:c=1540483477*(65535&(c^=255&r.charCodeAt(m)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0};var ds=nc,du=Hr.exports;hs.exports=ds,hs.exports.murmur3=ds,hs.exports.murmur2=du;var Ro=W(hs.exports);class Ma{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,n,o,c){this.ids.push(Bo(t)),this.positions.push(n,o,c)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=Bo(t);let o=0,c=this.ids.length-1;for(;o<c;){const g=o+c>>1;this.ids[g]>=n?c=g:o=g+1}const m=[];for(;this.ids[o]===n;)m.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return m}static serialize(t,n){const o=new Float64Array(t.ids),c=new Uint32Array(t.positions);return Ds(o,c,0,o.length-1),n&&n.push(o.buffer,c.buffer),{ids:o,positions:c}}static deserialize(t){const n=new Ma;return n.ids=t.ids,n.positions=t.positions,n.indexed=!0,n}}function Bo(r){const t=+r;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Ro(String(r))}function Ds(r,t,n,o){for(;n<o;){const c=r[n+o>>1];let m=n-1,g=o+1;for(;;){do m++;while(r[m]<c);do g--;while(r[g]>c);if(m>=g)break;Lr(r,m,g),Lr(t,3*m,3*g),Lr(t,3*m+1,3*g+1),Lr(t,3*m+2,3*g+2)}g-n<o-g?(Ds(r,t,n,g),n=g+1):(Ds(r,t,g+1,o),o=g)}}function Lr(r,t,n){const o=r[t];r[t]=r[n],r[n]=o}mt("FeaturePositionMap",Ma);class Jr{constructor(t,n){this.gl=t.gl,this.location=n}}class vn extends Jr{constructor(t,n){super(t,n),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class ic extends Jr{constructor(t,n){super(t,n),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class pu extends Jr{constructor(t,n){super(t,n),this.current=Vt.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const sc=new Float32Array(16);function ld(r){return[Ti(255*r.r,255*r.g),Ti(255*r.b,255*r.a)]}class In{constructor(t,n,o){this.value=t,this.uniformNames=n.map((c=>`u_${c}`)),this.type=o}setUniform(t,n,o){t.set(o.constantOr(this.value))}getBinding(t,n,o){return this.type==="color"?new pu(t,n):new vn(t,n)}}class Fo{constructor(t,n){this.uniformNames=n.map((o=>`u_${o}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=t.tlbr}setUniform(t,n,o,c){const m=c==="u_pattern_to"?this.patternTo:c==="u_pattern_from"?this.patternFrom:c==="u_pixel_ratio_to"?this.pixelRatioTo:c==="u_pixel_ratio_from"?this.pixelRatioFrom:null;m&&t.set(m)}getBinding(t,n,o){return o.substr(0,9)==="u_pattern"?new ic(t,n):new vn(t,n)}}class ta{constructor(t,n,o,c){this.expression=t,this.type=o,this.maxValue=0,this.paintVertexAttributes=n.map((m=>({name:`a_${m}`,type:"Float32",components:o==="color"?2:1,offset:0}))),this.paintVertexArray=new c}populatePaintArray(t,n,o,c,m){const g=this.paintVertexArray.length,x=this.expression.evaluate(new lr(0),n,{},c,[],m);this.paintVertexArray.resize(t),this._setPaintValue(g,t,x)}updatePaintArray(t,n,o,c){const m=this.expression.evaluate({zoom:0},o,c);this._setPaintValue(t,n,m)}_setPaintValue(t,n,o){if(this.type==="color"){const c=ld(o);for(let m=t;m<n;m++)this.paintVertexArray.emplace(m,c[0],c[1])}else{for(let c=t;c<n;c++)this.paintVertexArray.emplace(c,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ps{constructor(t,n,o,c,m,g){this.expression=t,this.uniformNames=n.map((x=>`u_${x}_t`)),this.type=o,this.useIntegerZoom=c,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=n.map((x=>({name:`a_${x}`,type:"Float32",components:o==="color"?4:2,offset:0}))),this.paintVertexArray=new g}populatePaintArray(t,n,o,c,m){const g=this.expression.evaluate(new lr(this.zoom),n,{},c,[],m),x=this.expression.evaluate(new lr(this.zoom+1),n,{},c,[],m),S=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(S,t,g,x)}updatePaintArray(t,n,o,c){const m=this.expression.evaluate({zoom:this.zoom},o,c),g=this.expression.evaluate({zoom:this.zoom+1},o,c);this._setPaintValue(t,n,m,g)}_setPaintValue(t,n,o,c){if(this.type==="color"){const m=ld(o),g=ld(c);for(let x=t;x<n;x++)this.paintVertexArray.emplace(x,m[0],m[1],g[0],g[1])}else{for(let m=t;m<n;m++)this.paintVertexArray.emplace(m,o,c);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(c))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,n){const o=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,c=Je(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);t.set(c)}getBinding(t,n,o){return new vn(t,n)}}class Kn{constructor(t,n,o,c,m,g){this.expression=t,this.type=n,this.useIntegerZoom=o,this.zoom=c,this.layerId=g,this.zoomInPaintVertexArray=new m,this.zoomOutPaintVertexArray=new m}populatePaintArray(t,n,o){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(c,t,n.patterns&&n.patterns[this.layerId],o)}updatePaintArray(t,n,o,c,m){this._setPaintValues(t,n,o.patterns&&o.patterns[this.layerId],m)}_setPaintValues(t,n,o,c){if(!c||!o)return;const{min:m,mid:g,max:x}=o,S=c[m],P=c[g],z=c[x];if(S&&P&&z)for(let L=t;L<n;L++)this.zoomInPaintVertexArray.emplace(L,P.tl[0],P.tl[1],P.br[0],P.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],P.pixelRatio,S.pixelRatio),this.zoomOutPaintVertexArray.emplace(L,P.tl[0],P.tl[1],P.br[0],P.br[1],z.tl[0],z.tl[1],z.br[0],z.br[1],P.pixelRatio,z.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Ca.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Ca.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class fs{constructor(t,n,o){this.binders={},this._buffers=[];const c=[];for(const m in t.paint._values){if(!o(m))continue;const g=t.paint.get(m);if(!(g instanceof wi&&bo(g.property.specification)))continue;const x=ud(m,t.type),S=g.value,P=g.property.specification.type,z=g.property.useIntegerZoom,L=g.property.specification["property-type"],O=L==="cross-faded"||L==="cross-faded-data-driven";if(S.kind==="constant")this.binders[m]=O?new Fo(S.value,x):new In(S.value,x,P),c.push(`/u_${m}`);else if(S.kind==="source"||O){const V=ah(m,P,"source");this.binders[m]=O?new Kn(S,P,z,n,V,t.id):new ta(S,x,P,V),c.push(`/a_${m}`)}else{const V=ah(m,P,"composite");this.binders[m]=new ps(S,x,P,z,n,V),c.push(`/z_${m}`)}}this.cacheKey=c.sort().join("")}getMaxValue(t){const n=this.binders[t];return n instanceof ta||n instanceof ps?n.maxValue:0}populatePaintArrays(t,n,o,c,m){for(const g in this.binders){const x=this.binders[g];(x instanceof ta||x instanceof ps||x instanceof Kn)&&x.populatePaintArray(t,n,o,c,m)}}setConstantPatternPositions(t,n){for(const o in this.binders){const c=this.binders[o];c instanceof Fo&&c.setConstantPatternPositions(t,n)}}updatePaintArrays(t,n,o,c,m){let g=!1;for(const x in t){const S=n.getPositions(x);for(const P of S){const z=o.feature(P.index);for(const L in this.binders){const O=this.binders[L];if((O instanceof ta||O instanceof ps||O instanceof Kn)&&O.expression.isStateDependent===!0){const V=c.paint.get(L);O.expression=V.value,O.updatePaintArray(P.start,P.end,z,t[x],m),g=!0}}}}return g}defines(){const t=[];for(const n in this.binders){const o=this.binders[n];(o instanceof In||o instanceof Fo)&&t.push(...o.uniformNames.map((c=>`#define HAS_UNIFORM_${c}`)))}return t}getBinderAttributes(){const t=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof ta||o instanceof ps)for(let c=0;c<o.paintVertexAttributes.length;c++)t.push(o.paintVertexAttributes[c].name);else if(o instanceof Kn)for(let c=0;c<Ca.members.length;c++)t.push(Ca.members[c].name)}return t}getBinderUniforms(){const t=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof In||o instanceof Fo||o instanceof ps)for(const c of o.uniformNames)t.push(c)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,n){const o=[];for(const c in this.binders){const m=this.binders[c];if(m instanceof In||m instanceof Fo||m instanceof ps){for(const g of m.uniformNames)if(n[g]){const x=m.getBinding(t,n[g],g);o.push({name:g,property:c,binding:x})}}}return o}setUniforms(t,n,o,c){for(const{name:m,property:g,binding:x}of n)this.binders[g].setUniform(x,c,o.get(g),m)}updatePaintBuffers(t){this._buffers=[];for(const n in this.binders){const o=this.binders[n];if(t&&o instanceof Kn){const c=t.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(o instanceof ta||o instanceof ps)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(t){for(const n in this.binders){const o=this.binders[n];(o instanceof ta||o instanceof ps||o instanceof Kn)&&o.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const n=this.binders[t];(n instanceof ta||n instanceof ps||n instanceof Kn)&&n.destroy()}}}class ra{constructor(t,n,o=(()=>!0)){this.programConfigurations={};for(const c of t)this.programConfigurations[c.id]=new fs(c,n,o);this.needsUpload=!1,this._featureMap=new Ma,this._bufferOffset=0}populatePaintArrays(t,n,o,c,m,g){for(const x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(t,n,c,m,g);n.id!==void 0&&this._featureMap.add(n.id,o,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,n,o,c){for(const m of o)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(t,this._featureMap,n,m,c)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function ud(r,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[r]||[r.replace(`${t}-`,"").replace(/-/g,"_")]}function ah(r,t,n){const o={color:{source:G,composite:Ft},number:{source:Qe,composite:G}},c=(function(m){return{"line-pattern":{source:Si,composite:Si},"fill-pattern":{source:Si,composite:Si},"fill-extrusion-pattern":{source:Si,composite:Si}}[m]})(r);return c&&c[n]||o[t][n]}mt("ConstantBinder",In),mt("CrossFadedConstantBinder",Fo),mt("SourceExpressionBinder",ta),mt("CrossFadedCompositeBinder",Kn),mt("CompositeExpressionBinder",ps),mt("ProgramConfiguration",fs,{omit:["_buffers"]}),mt("ProgramConfigurationSet",ra);const un=8192,oh=Math.pow(2,14)-1,cd=-oh-1;function Oo(r){const t=un/r.extent,n=r.loadGeometry();for(let o=0;o<n.length;o++){const c=n[o];for(let m=0;m<c.length;m++){const g=c[m],x=Math.round(g.x*t),S=Math.round(g.y*t);g.x=Je(x,cd,oh),g.y=Je(S,cd,oh),(x<g.x||x>g.x+1||S<g.y||S>g.y+1)&&Zt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function No(r,t){return{type:r.type,id:r.id,properties:r.properties,geometry:t?Oo(r):[]}}function ac(r,t,n,o,c){r.emplaceBack(2*t+(o+1)/2,2*n+(c+1)/2)}class lh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Mn,this.indexArray=new Ni,this.segments=new rr,this.programConfigurations=new ra(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(t,n,o){const c=this.layers[0],m=[];let g=null,x=!1;c.type==="circle"&&(g=c.layout.get("circle-sort-key"),x=!g.isConstant());for(const{feature:S,id:P,index:z,sourceLayerIndex:L}of t){const O=this.layers[0]._featureFilter.needGeometry,V=No(S,O);if(!this.layers[0]._featureFilter.filter(new lr(this.zoom),V,o))continue;const q=x?g.evaluate(V,{},o):void 0,K={id:P,properties:S.properties,type:S.type,sourceLayerIndex:L,index:z,geometry:O?V.geometry:Oo(S),patterns:{},sortKey:q};m.push(K)}x&&m.sort(((S,P)=>S.sortKey-P.sortKey));for(const S of m){const{geometry:P,index:z,sourceLayerIndex:L}=S,O=t[z].feature;this.addFeature(S,P,z,o),n.featureIndex.insert(O,P,z,L,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,An),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,n,o,c){for(const m of n)for(const g of m){const x=g.x,S=g.y;if(x<0||x>=un||S<0||S>=un)continue;const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),z=P.vertexLength;ac(this.layoutVertexArray,x,S,-1,-1),ac(this.layoutVertexArray,x,S,1,-1),ac(this.layoutVertexArray,x,S,1,1),ac(this.layoutVertexArray,x,S,-1,1),this.indexArray.emplaceBack(z,z+1,z+2),this.indexArray.emplaceBack(z,z+3,z+2),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{},c)}}function hd(r,t){for(let n=0;n<r.length;n++)if(kl(t,r[n]))return!0;for(let n=0;n<t.length;n++)if(kl(r,t[n]))return!0;return!!fu(r,t)}function oc(r,t,n){return!!kl(r,t)||!!lc(t,r,n)}function dd(r,t){if(r.length===1)return fd(t,r[0]);for(let n=0;n<t.length;n++){const o=t[n];for(let c=0;c<o.length;c++)if(kl(r,o[c]))return!0}for(let n=0;n<r.length;n++)if(fd(t,r[n]))return!0;for(let n=0;n<t.length;n++)if(fu(r,t[n]))return!0;return!1}function uh(r,t,n){if(r.length>1){if(fu(r,t))return!0;for(let o=0;o<t.length;o++)if(lc(t[o],r,n))return!0}for(let o=0;o<r.length;o++)if(lc(r[o],t,n))return!0;return!1}function fu(r,t){if(r.length===0||t.length===0)return!1;for(let n=0;n<r.length-1;n++){const o=r[n],c=r[n+1];for(let m=0;m<t.length-1;m++)if(ap(o,c,t[m],t[m+1]))return!0}return!1}function ap(r,t,n,o){return Nt(r,n,o)!==Nt(t,n,o)&&Nt(r,t,n)!==Nt(r,t,o)}function lc(r,t,n){const o=n*n;if(t.length===1)return r.distSqr(t[0])<o;for(let c=1;c<t.length;c++)if(pd(r,t[c-1],t[c])<o)return!0;return!1}function pd(r,t,n){const o=t.distSqr(n);if(o===0)return r.distSqr(t);const c=((r.x-t.x)*(n.x-t.x)+(r.y-t.y)*(n.y-t.y))/o;return r.distSqr(c<0?t:c>1?n:n.sub(t)._mult(c)._add(t))}function fd(r,t){let n,o,c,m=!1;for(let g=0;g<r.length;g++){n=r[g];for(let x=0,S=n.length-1;x<n.length;S=x++)o=n[x],c=n[S],o.y>t.y!=c.y>t.y&&t.x<(c.x-o.x)*(t.y-o.y)/(c.y-o.y)+o.x&&(m=!m)}return m}function kl(r,t){let n=!1;for(let o=0,c=r.length-1;o<r.length;c=o++){const m=r[o],g=r[c];m.y>t.y!=g.y>t.y&&t.x<(g.x-m.x)*(t.y-m.y)/(g.y-m.y)+m.x&&(n=!n)}return n}function op(r,t,n){const o=n[0],c=n[2];if(r.x<o.x&&t.x<o.x||r.x>c.x&&t.x>c.x||r.y<o.y&&t.y<o.y||r.y>c.y&&t.y>c.y)return!1;const m=Nt(r,t,n[0]);return m!==Nt(r,t,n[1])||m!==Nt(r,t,n[2])||m!==Nt(r,t,n[3])}function Tl(r,t,n){const o=t.paint.get(r).value;return o.kind==="constant"?o.value:n.programConfigurations.get(t.id).getMaxValue(r)}function uc(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function cc(r,t,n,o,c){if(!t[0]&&!t[1])return r;const m=Y.convert(t)._mult(c);n==="viewport"&&m._rotate(-o);const g=[];for(let x=0;x<r.length;x++)g.push(r[x].sub(m));return g}let md,lp;mt("CircleBucket",lh,{omit:["layers"]});var up={get paint(){return lp=lp||new f({"circle-radius":new At(Ee.paint_circle["circle-radius"]),"circle-color":new At(Ee.paint_circle["circle-color"]),"circle-blur":new At(Ee.paint_circle["circle-blur"]),"circle-opacity":new At(Ee.paint_circle["circle-opacity"]),"circle-translate":new gt(Ee.paint_circle["circle-translate"]),"circle-translate-anchor":new gt(Ee.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new gt(Ee.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new gt(Ee.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new At(Ee.paint_circle["circle-stroke-width"]),"circle-stroke-color":new At(Ee.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new At(Ee.paint_circle["circle-stroke-opacity"])})},get layout(){return md=md||new f({"circle-sort-key":new At(Ee.layout_circle["circle-sort-key"])})}},oi=1e-6,mu=typeof Float32Array<"u"?Float32Array:Array;function ch(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function gd(r,t,n){var o=t[0],c=t[1],m=t[2],g=t[3],x=t[4],S=t[5],P=t[6],z=t[7],L=t[8],O=t[9],V=t[10],q=t[11],K=t[12],re=t[13],oe=t[14],we=t[15],de=n[0],_e=n[1],Ae=n[2],Ve=n[3];return r[0]=de*o+_e*x+Ae*L+Ve*K,r[1]=de*c+_e*S+Ae*O+Ve*re,r[2]=de*m+_e*P+Ae*V+Ve*oe,r[3]=de*g+_e*z+Ae*q+Ve*we,r[4]=(de=n[4])*o+(_e=n[5])*x+(Ae=n[6])*L+(Ve=n[7])*K,r[5]=de*c+_e*S+Ae*O+Ve*re,r[6]=de*m+_e*P+Ae*V+Ve*oe,r[7]=de*g+_e*z+Ae*q+Ve*we,r[8]=(de=n[8])*o+(_e=n[9])*x+(Ae=n[10])*L+(Ve=n[11])*K,r[9]=de*c+_e*S+Ae*O+Ve*re,r[10]=de*m+_e*P+Ae*V+Ve*oe,r[11]=de*g+_e*z+Ae*q+Ve*we,r[12]=(de=n[12])*o+(_e=n[13])*x+(Ae=n[14])*L+(Ve=n[15])*K,r[13]=de*c+_e*S+Ae*O+Ve*re,r[14]=de*m+_e*P+Ae*V+Ve*oe,r[15]=de*g+_e*z+Ae*q+Ve*we,r}Math.hypot||(Math.hypot=function(){for(var r=0,t=arguments.length;t--;)r+=arguments[t]*arguments[t];return Math.sqrt(r)});var gu,hh=gd;function dh(r,t,n){var o=t[0],c=t[1],m=t[2],g=t[3];return r[0]=n[0]*o+n[4]*c+n[8]*m+n[12]*g,r[1]=n[1]*o+n[5]*c+n[9]*m+n[13]*g,r[2]=n[2]*o+n[6]*c+n[10]*m+n[14]*g,r[3]=n[3]*o+n[7]*c+n[11]*m+n[15]*g,r}gu=new mu(4),mu!=Float32Array&&(gu[0]=0,gu[1]=0,gu[2]=0,gu[3]=0);class Ef extends s{constructor(t){super(t,up)}createBucket(t){return new lh(t)}queryRadius(t){const n=t;return Tl("circle-radius",this,n)+Tl("circle-stroke-width",this,n)+uc(this.paint.get("circle-translate"))}queryIntersectsFeature(t,n,o,c,m,g,x,S){const P=cc(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,x),z=this.paint.get("circle-radius").evaluate(n,o)+this.paint.get("circle-stroke-width").evaluate(n,o),L=this.paint.get("circle-pitch-alignment")==="map",O=L?P:(function(q,K){return q.map((re=>cp(re,K)))})(P,S),V=L?z*x:z;for(const q of c)for(const K of q){const re=L?K:cp(K,S);let oe=V;const we=dh([],[K.x,K.y,0,1],S);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?oe*=we[3]/g.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(oe*=g.cameraToCenterDistance/we[3]),oc(O,re,oe))return!0}return!1}}function cp(r,t){const n=dh([],[r.x,r.y,0,1],t);return new Y(n[0]/n[3],n[1]/n[3])}class Ls extends lh{}let ph;mt("HeatmapBucket",Ls,{omit:["layers"]});var fh={get paint(){return ph=ph||new f({"heatmap-radius":new At(Ee.paint_heatmap["heatmap-radius"]),"heatmap-weight":new At(Ee.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new gt(Ee.paint_heatmap["heatmap-intensity"]),"heatmap-color":new tc(Ee.paint_heatmap["heatmap-color"]),"heatmap-opacity":new gt(Ee.paint_heatmap["heatmap-opacity"])})}};function mh(r,{width:t,height:n},o,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==t*n*o)throw new RangeError(`mismatched image size. expected: ${c.length} but got: ${t*n*o}`)}else c=new Uint8Array(t*n*o);return r.width=t,r.height=n,r.data=c,r}function yd(r,{width:t,height:n},o){if(t===r.width&&n===r.height)return;const c=mh({},{width:t,height:n},o);gh(r,c,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,t),height:Math.min(r.height,n)},o),r.width=t,r.height=n,r.data=c.data}function gh(r,t,n,o,c,m){if(c.width===0||c.height===0)return t;if(c.width>r.width||c.height>r.height||n.x>r.width-c.width||n.y>r.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>t.width||c.height>t.height||o.x>t.width-c.width||o.y>t.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const g=r.data,x=t.data;if(g===x)throw new Error("srcData equals dstData, so image is already copied");for(let S=0;S<c.height;S++){const P=((n.y+S)*r.width+n.x)*m,z=((o.y+S)*t.width+o.x)*m;for(let L=0;L<c.width*m;L++)x[z+L]=g[P+L]}return t}class Il{constructor(t,n){mh(this,t,1,n)}resize(t){yd(this,t,1)}clone(){return new Il({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,o,c,m){gh(t,n,o,c,m,1)}}class Fn{constructor(t,n){mh(this,t,4,n)}resize(t){yd(this,t,4)}replace(t,n){n?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Fn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,o,c,m){gh(t,n,o,c,m,4)}}function yh(r){const t={},n=r.resolution||256,o=r.clips?r.clips.length:1,c=r.image||new Fn({width:n,height:o});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const m=(g,x,S)=>{t[r.evaluationKey]=S;const P=r.expression.evaluate(t);c.data[g+x+0]=Math.floor(255*P.r/P.a),c.data[g+x+1]=Math.floor(255*P.g/P.a),c.data[g+x+2]=Math.floor(255*P.b/P.a),c.data[g+x+3]=Math.floor(255*P.a)};if(r.clips)for(let g=0,x=0;g<o;++g,x+=4*n)for(let S=0,P=0;S<n;S++,P+=4){const z=S/(n-1),{start:L,end:O}=r.clips[g];m(x,P,L*(1-z)+O*z)}else for(let g=0,x=0;g<n;g++,x+=4)m(0,x,g/(n-1));return c}mt("AlphaImage",Il),mt("RGBAImage",Fn);const hc="big-fb";class Pf extends s{createBucket(t){return new Ls(t)}constructor(t){super(t,fh),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=yh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(hc)&&this.heatmapFbos.delete(hc)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let _d;var hp={get paint(){return _d=_d||new f({"hillshade-illumination-direction":new gt(Ee.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new gt(Ee.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new gt(Ee.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new gt(Ee.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new gt(Ee.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new gt(Ee.paint_hillshade["hillshade-accent-color"])})}};class dp extends s{constructor(t){super(t,hp)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const pp=w([{name:"a_pos",components:2,type:"Int16"}],4),{members:fp}=pp;function mp(r,t,n=2){const o=t&&t.length,c=o?t[0]*n:r.length;let m=Ii(r,0,c,n,!0);const g=[];if(!m||m.next===m.prev)return g;let x,S,P;if(o&&(m=(function(z,L,O,V){const q=[];for(let K=0,re=L.length;K<re;K++){const oe=Ii(z,L[K]*V,K<re-1?L[K+1]*V:z.length,V,!1);oe===oe.next&&(oe.steiner=!0),q.push(wp(oe))}q.sort(vd);for(let K=0;K<q.length;K++)O=xp(q[K],O);return O})(r,t,m,n)),r.length>80*n){x=1/0,S=1/0;let z=-1/0,L=-1/0;for(let O=n;O<c;O+=n){const V=r[O],q=r[O+1];V<x&&(x=V),q<S&&(S=q),V>z&&(z=V),q>L&&(L=q)}P=Math.max(z-x,L-S),P=P!==0?32767/P:0}return yu(m,g,n,x,S,P,0),g}function Ii(r,t,n,o,c){let m;if(c===(function(g,x,S,P){let z=0;for(let L=x,O=S-P;L<S;L+=P)z+=(g[O]-g[L])*(g[L+1]+g[O+1]),O=L;return z})(r,t,n,o)>0)for(let g=t;g<n;g+=o)m=fc(g/o|0,r[g],r[g+1],m);else for(let g=n-o;g>=t;g-=o)m=fc(g/o|0,r[g],r[g+1],m);return m&&_u(m,m.next)&&(ms(m),m=m.next),m}function xn(r,t){if(!r)return r;t||(t=r);let n,o=r;do if(n=!1,o.steiner||!_u(o,o.next)&&nn(o.prev,o,o.next)!==0)o=o.next;else{if(ms(o),o=t=o.prev,o===o.next)break;n=!0}while(n||o!==t);return t}function yu(r,t,n,o,c,m,g){if(!r)return;!g&&m&&(function(S,P,z,L){let O=S;do O.z===0&&(O.z=_h(O.x,O.y,P,z,L)),O.prevZ=O.prev,O.nextZ=O.next,O=O.next;while(O!==S);O.prevZ.nextZ=null,O.prevZ=null,(function(V){let q,K=1;do{let re,oe=V;V=null;let we=null;for(q=0;oe;){q++;let de=oe,_e=0;for(let Ve=0;Ve<K&&(_e++,de=de.nextZ,de);Ve++);let Ae=K;for(;_e>0||Ae>0&&de;)_e!==0&&(Ae===0||!de||oe.z<=de.z)?(re=oe,oe=oe.nextZ,_e--):(re=de,de=de.nextZ,Ae--),we?we.nextZ=re:V=re,re.prevZ=we,we=re;oe=de}we.nextZ=null,K*=2}while(q>1)})(O)})(r,o,c,m);let x=r;for(;r.prev!==r.next;){const S=r.prev,P=r.next;if(m?yp(r,o,c,m):gp(r))t.push(S.i,r.i,P.i),ms(r),r=P.next,x=P.next;else if((r=P)===x){g?g===1?yu(r=_p(xn(r),t),t,n,o,c,m,2):g===2&&vp(r,t,n,o,c,m):yu(xn(r),t,n,o,c,m,1);break}}}function gp(r){const t=r.prev,n=r,o=r.next;if(nn(t,n,o)>=0)return!1;const c=t.x,m=n.x,g=o.x,x=t.y,S=n.y,P=o.y,z=c<m?c<g?c:g:m<g?m:g,L=x<S?x<P?x:P:S<P?S:P,O=c>m?c>g?c:g:m>g?m:g,V=x>S?x>P?x:P:S>P?S:P;let q=o.next;for(;q!==t;){if(q.x>=z&&q.x<=O&&q.y>=L&&q.y<=V&&jo(c,x,m,S,g,P,q.x,q.y)&&nn(q.prev,q,q.next)>=0)return!1;q=q.next}return!0}function yp(r,t,n,o){const c=r.prev,m=r,g=r.next;if(nn(c,m,g)>=0)return!1;const x=c.x,S=m.x,P=g.x,z=c.y,L=m.y,O=g.y,V=x<S?x<P?x:P:S<P?S:P,q=z<L?z<O?z:O:L<O?L:O,K=x>S?x>P?x:P:S>P?S:P,re=z>L?z>O?z:O:L>O?L:O,oe=_h(V,q,t,n,o),we=_h(K,re,t,n,o);let de=r.prevZ,_e=r.nextZ;for(;de&&de.z>=oe&&_e&&_e.z<=we;){if(de.x>=V&&de.x<=K&&de.y>=q&&de.y<=re&&de!==c&&de!==g&&jo(x,z,S,L,P,O,de.x,de.y)&&nn(de.prev,de,de.next)>=0||(de=de.prevZ,_e.x>=V&&_e.x<=K&&_e.y>=q&&_e.y<=re&&_e!==c&&_e!==g&&jo(x,z,S,L,P,O,_e.x,_e.y)&&nn(_e.prev,_e,_e.next)>=0))return!1;_e=_e.nextZ}for(;de&&de.z>=oe;){if(de.x>=V&&de.x<=K&&de.y>=q&&de.y<=re&&de!==c&&de!==g&&jo(x,z,S,L,P,O,de.x,de.y)&&nn(de.prev,de,de.next)>=0)return!1;de=de.prevZ}for(;_e&&_e.z<=we;){if(_e.x>=V&&_e.x<=K&&_e.y>=q&&_e.y<=re&&_e!==c&&_e!==g&&jo(x,z,S,L,P,O,_e.x,_e.y)&&nn(_e.prev,_e,_e.next)>=0)return!1;_e=_e.nextZ}return!0}function _p(r,t){let n=r;do{const o=n.prev,c=n.next.next;!_u(o,c)&&dc(o,n,n.next,c)&&El(o,c)&&El(c,o)&&(t.push(o.i,n.i,c.i),ms(n),ms(n.next),n=r=c),n=n.next}while(n!==r);return xn(n)}function vp(r,t,n,o,c,m){let g=r;do{let x=g.next.next;for(;x!==g.prev;){if(g.i!==x.i&&wd(g,x)){let S=bd(g,x);return g=xn(g,g.next),S=xn(S,S.next),yu(g,t,n,o,c,m,0),void yu(S,t,n,o,c,m,0)}x=x.next}g=g.next}while(g!==r)}function vd(r,t){return r.x-t.x}function xp(r,t){const n=(function(c,m){let g=m;const x=c.x,S=c.y;let P,z=-1/0;do{if(S<=g.y&&S>=g.next.y&&g.next.y!==g.y){const K=g.x+(S-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(K<=x&&K>z&&(z=K,P=g.x<g.next.x?g:g.next,K===x))return P}g=g.next}while(g!==m);if(!P)return null;const L=P,O=P.x,V=P.y;let q=1/0;g=P;do{if(x>=g.x&&g.x>=O&&x!==g.x&&jo(S<V?x:z,S,O,V,S<V?z:x,S,g.x,g.y)){const K=Math.abs(S-g.y)/(x-g.x);El(g,c)&&(K<q||K===q&&(g.x>P.x||g.x===P.x&&xd(P,g)))&&(P=g,q=K)}g=g.next}while(g!==L);return P})(r,t);if(!n)return t;const o=bd(n,r);return xn(o,o.next),xn(n,n.next)}function xd(r,t){return nn(r.prev,r,t.prev)<0&&nn(t.next,r,r.next)<0}function _h(r,t,n,o,c){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-n)*c|0)|r<<8))|r<<4))|r<<2))|r<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-o)*c|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function wp(r){let t=r,n=r;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==r);return n}function jo(r,t,n,o,c,m,g,x){return(c-g)*(t-x)>=(r-g)*(m-x)&&(r-g)*(o-x)>=(n-g)*(t-x)&&(n-g)*(m-x)>=(c-g)*(o-x)}function wd(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!(function(n,o){let c=n;do{if(c.i!==n.i&&c.next.i!==n.i&&c.i!==o.i&&c.next.i!==o.i&&dc(c,c.next,n,o))return!0;c=c.next}while(c!==n);return!1})(r,t)&&(El(r,t)&&El(t,r)&&(function(n,o){let c=n,m=!1;const g=(n.x+o.x)/2,x=(n.y+o.y)/2;do c.y>x!=c.next.y>x&&c.next.y!==c.y&&g<(c.next.x-c.x)*(x-c.y)/(c.next.y-c.y)+c.x&&(m=!m),c=c.next;while(c!==n);return m})(r,t)&&(nn(r.prev,r,t.prev)||nn(r,t.prev,t))||_u(r,t)&&nn(r.prev,r,r.next)>0&&nn(t.prev,t,t.next)>0)}function nn(r,t,n){return(t.y-r.y)*(n.x-t.x)-(t.x-r.x)*(n.y-t.y)}function _u(r,t){return r.x===t.x&&r.y===t.y}function dc(r,t,n,o){const c=pc(nn(r,t,n)),m=pc(nn(r,t,o)),g=pc(nn(n,o,r)),x=pc(nn(n,o,t));return c!==m&&g!==x||!(c!==0||!vh(r,n,t))||!(m!==0||!vh(r,o,t))||!(g!==0||!vh(n,r,o))||!(x!==0||!vh(n,t,o))}function vh(r,t,n){return t.x<=Math.max(r.x,n.x)&&t.x>=Math.min(r.x,n.x)&&t.y<=Math.max(r.y,n.y)&&t.y>=Math.min(r.y,n.y)}function pc(r){return r>0?1:r<0?-1:0}function El(r,t){return nn(r.prev,r,r.next)<0?nn(r,t,r.next)>=0&&nn(r,r.prev,t)>=0:nn(r,t,r.prev)<0||nn(r,r.next,t)<0}function bd(r,t){const n=Sd(r.i,r.x,r.y),o=Sd(t.i,t.x,t.y),c=r.next,m=t.prev;return r.next=t,t.prev=r,n.next=c,c.prev=n,o.next=n,n.prev=o,m.next=o,o.prev=m,o}function fc(r,t,n,o){const c=Sd(r,t,n);return o?(c.next=o.next,c.prev=o,o.next.prev=c,o.next=c):(c.prev=c,c.next=c),c}function ms(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Sd(r,t,n){return{i:r,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function xh(r,t,n){const o=n.patternDependencies;let c=!1;for(const m of t){const g=m.paint.get(`${r}-pattern`);g.isConstant()||(c=!0);const x=g.constantOr(null);x&&(c=!0,o[x.to]=!0,o[x.from]=!0)}return c}function mc(r,t,n,o,c){const m=c.patternDependencies;for(const g of t){const x=g.paint.get(`${r}-pattern`).value;if(x.kind!=="constant"){let S=x.evaluate({zoom:o-1},n,{},c.availableImages),P=x.evaluate({zoom:o},n,{},c.availableImages),z=x.evaluate({zoom:o+1},n,{},c.availableImages);S=S&&S.name?S.name:S,P=P&&P.name?P.name:P,z=z&&z.name?z.name:z,m[S]=!0,m[P]=!0,m[z]=!0,n.patterns[g.id]={min:S,mid:P,max:z}}}return n}class wh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ls,this.indexArray=new Ni,this.indexArray2=new ln,this.programConfigurations=new ra(t.layers,t.zoom),this.segments=new rr,this.segments2=new rr,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(t,n,o){this.hasPattern=xh("fill",this.layers,n);const c=this.layers[0].layout.get("fill-sort-key"),m=!c.isConstant(),g=[];for(const{feature:x,id:S,index:P,sourceLayerIndex:z}of t){const L=this.layers[0]._featureFilter.needGeometry,O=No(x,L);if(!this.layers[0]._featureFilter.filter(new lr(this.zoom),O,o))continue;const V=m?c.evaluate(O,{},o,n.availableImages):void 0,q={id:S,properties:x.properties,type:x.type,sourceLayerIndex:z,index:P,geometry:L?O.geometry:Oo(x),patterns:{},sortKey:V};g.push(q)}m&&g.sort(((x,S)=>x.sortKey-S.sortKey));for(const x of g){const{geometry:S,index:P,sourceLayerIndex:z}=x;if(this.hasPattern){const L=mc("fill",this.layers,x,this.zoom,n);this.patternFeatures.push(L)}else this.addFeature(x,S,P,o,{});n.featureIndex.insert(t[P].feature,S,P,z,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}addFeatures(t,n,o){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,n,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,fp),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,n,o,c,m){for(const g of _o(n,500)){let x=0;for(const V of g)x+=V.length;const S=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray),P=S.vertexLength,z=[],L=[];for(const V of g){if(V.length===0)continue;V!==g[0]&&L.push(z.length/2);const q=this.segments2.prepareSegment(V.length,this.layoutVertexArray,this.indexArray2),K=q.vertexLength;this.layoutVertexArray.emplaceBack(V[0].x,V[0].y),this.indexArray2.emplaceBack(K+V.length-1,K),z.push(V[0].x),z.push(V[0].y);for(let re=1;re<V.length;re++)this.layoutVertexArray.emplaceBack(V[re].x,V[re].y),this.indexArray2.emplaceBack(K+re-1,K+re),z.push(V[re].x),z.push(V[re].y);q.vertexLength+=V.length,q.primitiveLength+=V.length}const O=mp(z,L);for(let V=0;V<O.length;V+=3)this.indexArray.emplaceBack(P+O[V],P+O[V+1],P+O[V+2]);S.vertexLength+=x,S.primitiveLength+=O.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,m,c)}}let kd,vu;mt("FillBucket",wh,{omit:["layers","patternFeatures"]});var li={get paint(){return vu=vu||new f({"fill-antialias":new gt(Ee.paint_fill["fill-antialias"]),"fill-opacity":new At(Ee.paint_fill["fill-opacity"]),"fill-color":new At(Ee.paint_fill["fill-color"]),"fill-outline-color":new At(Ee.paint_fill["fill-outline-color"]),"fill-translate":new gt(Ee.paint_fill["fill-translate"]),"fill-translate-anchor":new gt(Ee.paint_fill["fill-translate-anchor"]),"fill-pattern":new Lo(Ee.paint_fill["fill-pattern"])})},get layout(){return kd=kd||new f({"fill-sort-key":new At(Ee.layout_fill["fill-sort-key"])})}};class Cf extends s{constructor(t){super(t,li)}recalculate(t,n){super.recalculate(t,n);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new wh(t)}queryRadius(){return uc(this.paint.get("fill-translate"))}queryIntersectsFeature(t,n,o,c,m,g,x){return dd(cc(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,x),c)}isTileClipped(){return!0}}const Mf=w([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),bh=w([{name:"a_centroid",components:2,type:"Int16"}],4),{members:ui}=Mf;var Vo={},Tt=ue,Pl=Uo;function Uo(r,t,n,o,c){this.properties={},this.extent=n,this.type=0,this._pbf=r,this._geometry=-1,this._keys=o,this._values=c,r.readFields(bp,this,t)}function bp(r,t,n){r==1?t.id=n.readVarint():r==2?(function(o,c){for(var m=o.readVarint()+o.pos;o.pos<m;){var g=c._keys[o.readVarint()],x=c._values[o.readVarint()];c.properties[g]=x}})(n,t):r==3?t.type=n.readVarint():r==4&&(t._geometry=n.pos)}function Af(r){for(var t,n,o=0,c=0,m=r.length,g=m-1;c<m;g=c++)o+=((n=r[g]).x-(t=r[c]).x)*(t.y+n.y);return o}Uo.types=["Unknown","Point","LineString","Polygon"],Uo.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var t,n=r.readVarint()+r.pos,o=1,c=0,m=0,g=0,x=[];r.pos<n;){if(c<=0){var S=r.readVarint();o=7&S,c=S>>3}if(c--,o===1||o===2)m+=r.readSVarint(),g+=r.readSVarint(),o===1&&(t&&x.push(t),t=[]),t.push(new Tt(m,g));else{if(o!==7)throw new Error("unknown command "+o);t&&t.push(t[0].clone())}}return t&&x.push(t),x},Uo.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var t=r.readVarint()+r.pos,n=1,o=0,c=0,m=0,g=1/0,x=-1/0,S=1/0,P=-1/0;r.pos<t;){if(o<=0){var z=r.readVarint();n=7&z,o=z>>3}if(o--,n===1||n===2)(c+=r.readSVarint())<g&&(g=c),c>x&&(x=c),(m+=r.readSVarint())<S&&(S=m),m>P&&(P=m);else if(n!==7)throw new Error("unknown command "+n)}return[g,S,x,P]},Uo.prototype.toGeoJSON=function(r,t,n){var o,c,m=this.extent*Math.pow(2,n),g=this.extent*r,x=this.extent*t,S=this.loadGeometry(),P=Uo.types[this.type];function z(V){for(var q=0;q<V.length;q++){var K=V[q];V[q]=[360*(K.x+g)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(K.y+x)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var L=[];for(o=0;o<S.length;o++)L[o]=S[o][0];z(S=L);break;case 2:for(o=0;o<S.length;o++)z(S[o]);break;case 3:for(S=(function(V){var q=V.length;if(q<=1)return[V];for(var K,re,oe=[],we=0;we<q;we++){var de=Af(V[we]);de!==0&&(re===void 0&&(re=de<0),re===de<0?(K&&oe.push(K),K=[V[we]]):K.push(V[we]))}return K&&oe.push(K),oe})(S),o=0;o<S.length;o++)for(c=0;c<S[o].length;c++)z(S[o][c])}S.length===1?S=S[0]:P="Multi"+P;var O={type:"Feature",geometry:{type:P,coordinates:S},properties:this.properties};return"id"in this&&(O.id=this.id),O};var gc=Pl,yc=Sh;function Sh(r,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(Sp,this,t),this.length=this._features.length}function Sp(r,t,n){r===15?t.version=n.readVarint():r===1?t.name=n.readString():r===5?t.extent=n.readVarint():r===2?t._features.push(n.pos):r===3?t._keys.push(n.readString()):r===4&&t._values.push((function(o){for(var c=null,m=o.readVarint()+o.pos;o.pos<m;){var g=o.readVarint()>>3;c=g===1?o.readString():g===2?o.readFloat():g===3?o.readDouble():g===4?o.readVarint64():g===5?o.readVarint():g===6?o.readSVarint():g===7?o.readBoolean():null}return c})(n))}Sh.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var t=this._pbf.readVarint()+this._pbf.pos;return new gc(this._pbf,t,this.extent,this._keys,this._values)};var kp=yc;function Tp(r,t,n){if(r===3){var o=new kp(n,n.readVarint()+n.pos);o.length&&(t[o.name]=o)}}Vo.VectorTile=function(r,t){this.layers=r.readFields(Tp,{},t)},Vo.VectorTileFeature=Pl,Vo.VectorTileLayer=yc;const Td=Vo.VectorTileFeature.types,_c=Math.pow(2,13);function wn(r,t,n,o,c,m,g,x){r.emplaceBack(t,n,2*Math.floor(o*_c)+g,c*_c*2,m*_c*2,Math.round(x))}class gs{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ai,this.centroidVertexArray=new rn,this.indexArray=new Ni,this.programConfigurations=new ra(t.layers,t.zoom),this.segments=new rr,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(t,n,o){this.features=[],this.hasPattern=xh("fill-extrusion",this.layers,n);for(const{feature:c,id:m,index:g,sourceLayerIndex:x}of t){const S=this.layers[0]._featureFilter.needGeometry,P=No(c,S);if(!this.layers[0]._featureFilter.filter(new lr(this.zoom),P,o))continue;const z={id:m,sourceLayerIndex:x,index:g,geometry:S?P.geometry:Oo(c),properties:c.properties,type:c.type,patterns:{}};this.hasPattern?this.features.push(mc("fill-extrusion",this.layers,z,this.zoom,n)):this.addFeature(z,z.geometry,g,o,{}),n.featureIndex.insert(c,z.geometry,g,x,this.index,!0)}}addFeatures(t,n,o){for(const c of this.features){const{geometry:m}=c;this.addFeature(c,m,c.index,n,o)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ui),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,bh.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,n,o,c,m){for(const g of _o(n,500)){const x={x:0,y:0,vertexCount:0};let S=0;for(const q of g)S+=q.length;let P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const q of g){if(q.length===0||Ip(q))continue;let K=0;for(let re=0;re<q.length;re++){const oe=q[re];if(re>=1){const we=q[re-1];if(!$o(oe,we)){P.vertexLength+4>rr.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const de=oe.sub(we)._perp()._unit(),_e=we.dist(oe);K+_e>32768&&(K=0),wn(this.layoutVertexArray,oe.x,oe.y,de.x,de.y,0,0,K),wn(this.layoutVertexArray,oe.x,oe.y,de.x,de.y,0,1,K),x.x+=2*oe.x,x.y+=2*oe.y,x.vertexCount+=2,K+=_e,wn(this.layoutVertexArray,we.x,we.y,de.x,de.y,0,0,K),wn(this.layoutVertexArray,we.x,we.y,de.x,de.y,0,1,K),x.x+=2*we.x,x.y+=2*we.y,x.vertexCount+=2;const Ae=P.vertexLength;this.indexArray.emplaceBack(Ae,Ae+2,Ae+1),this.indexArray.emplaceBack(Ae+1,Ae+2,Ae+3),P.vertexLength+=4,P.primitiveLength+=2}}}}if(P.vertexLength+S>rr.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(S,this.layoutVertexArray,this.indexArray)),Td[t.type]!=="Polygon")continue;const z=[],L=[],O=P.vertexLength;for(const q of g)if(q.length!==0){q!==g[0]&&L.push(z.length/2);for(let K=0;K<q.length;K++){const re=q[K];wn(this.layoutVertexArray,re.x,re.y,0,0,1,1,0),x.x+=re.x,x.y+=re.y,x.vertexCount+=1,z.push(re.x),z.push(re.y)}}const V=mp(z,L);for(let q=0;q<V.length;q+=3)this.indexArray.emplaceBack(O+V[q],O+V[q+2],O+V[q+1]);P.primitiveLength+=V.length/3,P.vertexLength+=S;for(let q=0;q<x.vertexCount;q++){const K=Math.floor(x.x/x.vertexCount),re=Math.floor(x.y/x.vertexCount);this.centroidVertexArray.emplaceBack(K,re)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,m,c)}}function $o(r,t){return r.x===t.x&&(r.x<0||r.x>un)||r.y===t.y&&(r.y<0||r.y>un)}function Ip(r){return r.every((t=>t.x<0))||r.every((t=>t.x>un))||r.every((t=>t.y<0))||r.every((t=>t.y>un))}let Id;mt("FillExtrusionBucket",gs,{omit:["layers","features"]});var na={get paint(){return Id=Id||new f({"fill-extrusion-opacity":new gt(Ee["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new At(Ee["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new gt(Ee["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new gt(Ee["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Lo(Ee["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new At(Ee["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new At(Ee["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new gt(Ee["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Ep extends s{constructor(t){super(t,na)}createBucket(t){return new gs(t)}queryRadius(){return uc(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,n,o,c,m,g,x,S){const P=cc(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,x),z=this.paint.get("fill-extrusion-height").evaluate(n,o),L=this.paint.get("fill-extrusion-base").evaluate(n,o),O=(function(q,K,re,oe){const we=[];for(const de of q){const _e=[de.x,de.y,0,1];dh(_e,_e,K),we.push(new Y(_e[0]/_e[3],_e[1]/_e[3]))}return we})(P,S),V=(function(q,K,re,oe){const we=[],de=[],_e=oe[8]*K,Ae=oe[9]*K,Ve=oe[10]*K,dt=oe[11]*K,Lt=oe[8]*re,ht=oe[9]*re,lt=oe[10]*re,kt=oe[11]*re;for(const vt of q){const yt=[],Be=[];for(const It of vt){const St=It.x,Ut=It.y,$r=oe[0]*St+oe[4]*Ut+oe[12],Nr=oe[1]*St+oe[5]*Ut+oe[13],On=oe[2]*St+oe[6]*Ut+oe[14],Da=oe[3]*St+oe[7]*Ut+oe[15],di=On+Ve,Nn=Da+dt,Zi=$r+Lt,Gi=Nr+ht,Hi=On+lt,pn=Da+kt,jn=new Y(($r+_e)/Nn,(Nr+Ae)/Nn);jn.z=di/Nn,yt.push(jn);const Ci=new Y(Zi/pn,Gi/pn);Ci.z=Hi/pn,Be.push(Ci)}we.push(yt),de.push(Be)}return[we,de]})(c,L,z,S);return(function(q,K,re){let oe=1/0;dd(re,K)&&(oe=Pp(re,K[0]));for(let we=0;we<K.length;we++){const de=K[we],_e=q[we];for(let Ae=0;Ae<de.length-1;Ae++){const Ve=de[Ae],dt=[Ve,de[Ae+1],_e[Ae+1],_e[Ae],Ve];hd(re,dt)&&(oe=Math.min(oe,Pp(re,dt)))}}return oe!==1/0&&oe})(V[0],V[1],O)}}function ji(r,t){return r.x*t.x+r.y*t.y}function Pp(r,t){if(r.length===1){let n=0;const o=t[n++];let c;for(;!c||o.equals(c);)if(c=t[n++],!c)return 1/0;for(;n<t.length;n++){const m=t[n],g=r[0],x=c.sub(o),S=m.sub(o),P=g.sub(o),z=ji(x,x),L=ji(x,S),O=ji(S,S),V=ji(P,x),q=ji(P,S),K=z*O-L*L,re=(O*V-L*q)/K,oe=(z*q-L*V)/K,we=o.z*(1-re-oe)+c.z*re+m.z*oe;if(isFinite(we))return we}return 1/0}{let n=1/0;for(const o of t)n=Math.min(n,o.z);return n}}const Cp=w([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Mp}=Cp,Ap=w([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:zp}=Ap,zf=Vo.VectorTileFeature.types,kh=Math.cos(Math.PI/180*37.5),Th=Math.pow(2,14)/.5;class Vi{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((n=>{this.gradients[n.id]={}})),this.layoutVertexArray=new us,this.layoutVertexArray2=new Pa,this.indexArray=new Ni,this.programConfigurations=new ra(t.layers,t.zoom),this.segments=new rr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(t,n,o){this.hasPattern=xh("line",this.layers,n);const c=this.layers[0].layout.get("line-sort-key"),m=!c.isConstant(),g=[];for(const{feature:x,id:S,index:P,sourceLayerIndex:z}of t){const L=this.layers[0]._featureFilter.needGeometry,O=No(x,L);if(!this.layers[0]._featureFilter.filter(new lr(this.zoom),O,o))continue;const V=m?c.evaluate(O,{},o):void 0,q={id:S,properties:x.properties,type:x.type,sourceLayerIndex:z,index:P,geometry:L?O.geometry:Oo(x),patterns:{},sortKey:V};g.push(q)}m&&g.sort(((x,S)=>x.sortKey-S.sortKey));for(const x of g){const{geometry:S,index:P,sourceLayerIndex:z}=x;if(this.hasPattern){const L=mc("line",this.layers,x,this.zoom,n);this.patternFeatures.push(L)}else this.addFeature(x,S,P,o,{});n.featureIndex.insert(t[P].feature,S,P,z,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}addFeatures(t,n,o){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,n,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,zp)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Mp),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,n,o,c,m){const g=this.layers[0].layout,x=g.get("line-join").evaluate(t,{}),S=g.get("line-cap"),P=g.get("line-miter-limit"),z=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const L of n)this.addLine(L,t,x,S,P,z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,m,c)}addLine(t,n,o,c,m,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let oe=0;oe<t.length-1;oe++)this.totalDistance+=t[oe].dist(t[oe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x=zf[n.type]==="Polygon";let S=t.length;for(;S>=2&&t[S-1].equals(t[S-2]);)S--;let P=0;for(;P<S-1&&t[P].equals(t[P+1]);)P++;if(S<(x?3:2))return;o==="bevel"&&(m=1.05);const z=this.overscaling<=16?15*un/(512*this.overscaling):0,L=this.segments.prepareSegment(10*S,this.layoutVertexArray,this.indexArray);let O,V,q,K,re;this.e1=this.e2=-1,x&&(O=t[S-2],re=t[P].sub(O)._unit()._perp());for(let oe=P;oe<S;oe++){if(q=oe===S-1?x?t[P+1]:void 0:t[oe+1],q&&t[oe].equals(q))continue;re&&(K=re),O&&(V=O),O=t[oe],re=q?q.sub(O)._unit()._perp():K,K=K||re;let we=K.add(re);we.x===0&&we.y===0||we._unit();const de=K.x*re.x+K.y*re.y,_e=we.x*re.x+we.y*re.y,Ae=_e!==0?1/_e:1/0,Ve=2*Math.sqrt(2-2*_e),dt=_e<kh&&V&&q,Lt=K.x*re.y-K.y*re.x>0;if(dt&&oe>P){const kt=O.dist(V);if(kt>2*z){const vt=O.sub(O.sub(V)._mult(z/kt)._round());this.updateDistance(V,vt),this.addCurrentVertex(vt,K,0,0,L),V=vt}}const ht=V&&q;let lt=ht?o:x?"butt":c;if(ht&&lt==="round"&&(Ae<g?lt="miter":Ae<=2&&(lt="fakeround")),lt==="miter"&&Ae>m&&(lt="bevel"),lt==="bevel"&&(Ae>2&&(lt="flipbevel"),Ae<m&&(lt="miter")),V&&this.updateDistance(V,O),lt==="miter")we._mult(Ae),this.addCurrentVertex(O,we,0,0,L);else if(lt==="flipbevel"){if(Ae>100)we=re.mult(-1);else{const kt=Ae*K.add(re).mag()/K.sub(re).mag();we._perp()._mult(kt*(Lt?-1:1))}this.addCurrentVertex(O,we,0,0,L),this.addCurrentVertex(O,we.mult(-1),0,0,L)}else if(lt==="bevel"||lt==="fakeround"){const kt=-Math.sqrt(Ae*Ae-1),vt=Lt?kt:0,yt=Lt?0:kt;if(V&&this.addCurrentVertex(O,K,vt,yt,L),lt==="fakeround"){const Be=Math.round(180*Ve/Math.PI/20);for(let It=1;It<Be;It++){let St=It/Be;if(St!==.5){const $r=St-.5;St+=St*$r*(St-1)*((1.0904+de*(de*(3.55645-1.43519*de)-3.2452))*$r*$r+(.848013+de*(.215638*de-1.06021)))}const Ut=re.sub(K)._mult(St)._add(K)._unit()._mult(Lt?-1:1);this.addHalfVertex(O,Ut.x,Ut.y,!1,Lt,0,L)}}q&&this.addCurrentVertex(O,re,-vt,-yt,L)}else if(lt==="butt")this.addCurrentVertex(O,we,0,0,L);else if(lt==="square"){const kt=V?1:-1;this.addCurrentVertex(O,we,kt,kt,L)}else lt==="round"&&(V&&(this.addCurrentVertex(O,K,0,0,L),this.addCurrentVertex(O,K,1,1,L,!0)),q&&(this.addCurrentVertex(O,re,-1,-1,L,!0),this.addCurrentVertex(O,re,0,0,L)));if(dt&&oe<S-1){const kt=O.dist(q);if(kt>2*z){const vt=O.add(q.sub(O)._mult(z/kt)._round());this.updateDistance(O,vt),this.addCurrentVertex(vt,re,0,0,L),O=vt}}}}addCurrentVertex(t,n,o,c,m,g=!1){const x=n.y*c-n.x,S=-n.y-n.x*c;this.addHalfVertex(t,n.x+n.y*o,n.y-n.x*o,g,!1,o,m),this.addHalfVertex(t,x,S,g,!0,-c,m),this.distance>Th/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,n,o,c,m,g))}addHalfVertex({x:t,y:n},o,c,m,g,x,S){const P=.5*(this.lineClips?this.scaledDistance*(Th-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(m?1:0),(n<<1)+(g?1:0),Math.round(63*o)+128,Math.round(63*c)+128,1+(x===0?0:x<0?-1:1)|(63&P)<<2,P>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const z=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,z),S.primitiveLength++),g?this.e2=z:this.e1=z}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,n){this.distance+=t.dist(n),this.updateScaledDistance()}}let vr,zn;mt("LineBucket",Vi,{omit:["layers","patternFeatures"]});var bn={get paint(){return zn=zn||new f({"line-opacity":new At(Ee.paint_line["line-opacity"]),"line-color":new At(Ee.paint_line["line-color"]),"line-translate":new gt(Ee.paint_line["line-translate"]),"line-translate-anchor":new gt(Ee.paint_line["line-translate-anchor"]),"line-width":new At(Ee.paint_line["line-width"]),"line-gap-width":new At(Ee.paint_line["line-gap-width"]),"line-offset":new At(Ee.paint_line["line-offset"]),"line-blur":new At(Ee.paint_line["line-blur"]),"line-dasharray":new Sl(Ee.paint_line["line-dasharray"]),"line-pattern":new Lo(Ee.paint_line["line-pattern"]),"line-gradient":new tc(Ee.paint_line["line-gradient"])})},get layout(){return vr=vr||new f({"line-cap":new gt(Ee.layout_line["line-cap"]),"line-join":new At(Ee.layout_line["line-join"]),"line-miter-limit":new gt(Ee.layout_line["line-miter-limit"]),"line-round-limit":new gt(Ee.layout_line["line-round-limit"]),"line-sort-key":new At(Ee.layout_line["line-sort-key"])})}};class Wn extends At{possiblyEvaluate(t,n){return n=new lr(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(t,n)}evaluate(t,n,o,c){return n=je({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(t,n,o,c)}}let ci;class xu extends s{constructor(t){super(t,bn),this.gradientVersion=0,ci||(ci=new Wn(bn.paint.properties["line-width"].specification),ci.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!(function(o){return o._styleExpression!==void 0})(n)&&n._styleExpression.expression instanceof Ua,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,n){super.recalculate(t,n),this.paint._values["line-floorwidth"]=ci.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Vi(t)}queryRadius(t){const n=t,o=En(Tl("line-width",this,n),Tl("line-gap-width",this,n)),c=Tl("line-offset",this,n);return o/2+Math.abs(c)+uc(this.paint.get("line-translate"))}queryIntersectsFeature(t,n,o,c,m,g,x){const S=cc(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,x),P=x/2*En(this.paint.get("line-width").evaluate(n,o),this.paint.get("line-gap-width").evaluate(n,o)),z=this.paint.get("line-offset").evaluate(n,o);return z&&(c=(function(L,O){const V=[];for(let q=0;q<L.length;q++){const K=L[q],re=[];for(let oe=0;oe<K.length;oe++){const we=K[oe-1],de=K[oe],_e=K[oe+1],Ae=oe===0?new Y(0,0):de.sub(we)._unit()._perp(),Ve=oe===K.length-1?new Y(0,0):_e.sub(de)._unit()._perp(),dt=Ae._add(Ve)._unit(),Lt=dt.x*Ve.x+dt.y*Ve.y;Lt!==0&&dt._mult(1/Lt),re.push(dt._mult(O)._add(de))}V.push(re)}return V})(c,z*x)),(function(L,O,V){for(let q=0;q<O.length;q++){const K=O[q];if(L.length>=3){for(let re=0;re<K.length;re++)if(kl(L,K[re]))return!0}if(uh(L,K,V))return!0}return!1})(S,c,P)}isTileClipped(){return!0}}function En(r,t){return t>0?t+2*r:r}const vc=w([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Cl=w([{name:"a_projected_pos",components:3,type:"Float32"}],4);w([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Ih=w([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);w([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Eh=w([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),xc=w([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Ui(r,t,n){return r.sections.forEach((o=>{o.text=(function(c,m,g){const x=m.layout.get("text-transform").evaluate(g,{});return x==="uppercase"?c=c.toLocaleUpperCase():x==="lowercase"&&(c=c.toLocaleLowerCase()),Ar.applyArabicShaping&&(c=Ar.applyArabicShaping(c)),c})(o.text,t,n)})),r}w([{name:"triangle",components:3,type:"Uint16"}]),w([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),w([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),w([{type:"Float32",name:"offsetX"}]),w([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),w([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Ml={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Kr=24,Aa=dr,wc=function(r,t,n,o,c){var m,g,x=8*c-o-1,S=(1<<x)-1,P=S>>1,z=-7,L=c-1,O=-1,V=r[t+L];for(L+=O,m=V&(1<<-z)-1,V>>=-z,z+=x;z>0;m=256*m+r[t+L],L+=O,z-=8);for(g=m&(1<<-z)-1,m>>=-z,z+=o;z>0;g=256*g+r[t+L],L+=O,z-=8);if(m===0)m=1-P;else{if(m===S)return g?NaN:1/0*(V?-1:1);g+=Math.pow(2,o),m-=P}return(V?-1:1)*g*Math.pow(2,m-o)},Ph=function(r,t,n,o,c,m){var g,x,S,P=8*m-c-1,z=(1<<P)-1,L=z>>1,O=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,V=0,q=1,K=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(x=isNaN(t)?1:0,g=z):(g=Math.floor(Math.log(t)/Math.LN2),t*(S=Math.pow(2,-g))<1&&(g--,S*=2),(t+=g+L>=1?O/S:O*Math.pow(2,1-L))*S>=2&&(g++,S/=2),g+L>=z?(x=0,g=z):g+L>=1?(x=(t*S-1)*Math.pow(2,c),g+=L):(x=t*Math.pow(2,L-1)*Math.pow(2,c),g=0));c>=8;r[n+V]=255&x,V+=q,x/=256,c-=8);for(g=g<<c|x,P+=c;P>0;r[n+V]=255&g,V+=q,g/=256,P-=8);r[n+V-q]|=128*K};function dr(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}dr.Varint=0,dr.Fixed64=1,dr.Bytes=2,dr.Fixed32=5;var wu=4294967296,ro=1/wu,bc=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function ys(r){return r.type===dr.Bytes?r.readVarint()+r.pos:r.pos+1}function qo(r,t,n){return n?4294967296*t+(r>>>0):4294967296*(t>>>0)+(r>>>0)}function Sc(r,t,n){var o=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(o);for(var c=n.pos-1;c>=r;c--)n.buf[c+o]=n.buf[c]}function Ch(r,t){for(var n=0;n<r.length;n++)t.writeVarint(r[n])}function Ei(r,t){for(var n=0;n<r.length;n++)t.writeSVarint(r[n])}function Zo(r,t){for(var n=0;n<r.length;n++)t.writeFloat(r[n])}function ia(r,t){for(var n=0;n<r.length;n++)t.writeDouble(r[n])}function $i(r,t){for(var n=0;n<r.length;n++)t.writeBoolean(r[n])}function Dp(r,t){for(var n=0;n<r.length;n++)t.writeFixed32(r[n])}function Ed(r,t){for(var n=0;n<r.length;n++)t.writeSFixed32(r[n])}function Pd(r,t){for(var n=0;n<r.length;n++)t.writeFixed64(r[n])}function Df(r,t){for(var n=0;n<r.length;n++)t.writeSFixed64(r[n])}function sa(r,t){return(r[t]|r[t+1]<<8|r[t+2]<<16)+16777216*r[t+3]}function Al(r,t,n){r[n]=t,r[n+1]=t>>>8,r[n+2]=t>>>16,r[n+3]=t>>>24}function Mh(r,t){return(r[t]|r[t+1]<<8|r[t+2]<<16)+(r[t+3]<<24)}dr.prototype={destroy:function(){this.buf=null},readFields:function(r,t,n){for(n=n||this.length;this.pos<n;){var o=this.readVarint(),c=o>>3,m=this.pos;this.type=7&o,r(c,t,this),this.pos===m&&this.skip(o)}return t},readMessage:function(r,t){return this.readFields(r,t,this.readVarint()+this.pos)},readFixed32:function(){var r=sa(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=Mh(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=sa(this.buf,this.pos)+sa(this.buf,this.pos+4)*wu;return this.pos+=8,r},readSFixed64:function(){var r=sa(this.buf,this.pos)+Mh(this.buf,this.pos+4)*wu;return this.pos+=8,r},readFloat:function(){var r=wc(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=wc(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var t,n,o=this.buf;return t=127&(n=o[this.pos++]),n<128?t:(t|=(127&(n=o[this.pos++]))<<7,n<128?t:(t|=(127&(n=o[this.pos++]))<<14,n<128?t:(t|=(127&(n=o[this.pos++]))<<21,n<128?t:(function(c,m,g){var x,S,P=g.buf;if(x=(112&(S=P[g.pos++]))>>4,S<128||(x|=(127&(S=P[g.pos++]))<<3,S<128)||(x|=(127&(S=P[g.pos++]))<<10,S<128)||(x|=(127&(S=P[g.pos++]))<<17,S<128)||(x|=(127&(S=P[g.pos++]))<<24,S<128)||(x|=(1&(S=P[g.pos++]))<<31,S<128))return qo(c,x,m);throw new Error("Expected varint not more than 10 bytes")})(t|=(15&(n=o[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var r=this.readVarint()+this.pos,t=this.pos;return this.pos=r,r-t>=12&&bc?(function(n,o,c){return bc.decode(n.subarray(o,c))})(this.buf,t,r):(function(n,o,c){for(var m="",g=o;g<c;){var x,S,P,z=n[g],L=null,O=z>239?4:z>223?3:z>191?2:1;if(g+O>c)break;O===1?z<128&&(L=z):O===2?(192&(x=n[g+1]))==128&&(L=(31&z)<<6|63&x)<=127&&(L=null):O===3?(S=n[g+2],(192&(x=n[g+1]))==128&&(192&S)==128&&((L=(15&z)<<12|(63&x)<<6|63&S)<=2047||L>=55296&&L<=57343)&&(L=null)):O===4&&(S=n[g+2],P=n[g+3],(192&(x=n[g+1]))==128&&(192&S)==128&&(192&P)==128&&((L=(15&z)<<18|(63&x)<<12|(63&S)<<6|63&P)<=65535||L>=1114112)&&(L=null)),L===null?(L=65533,O=1):L>65535&&(L-=65536,m+=String.fromCharCode(L>>>10&1023|55296),L=56320|1023&L),m+=String.fromCharCode(L),g+=O}return m})(this.buf,t,r)},readBytes:function(){var r=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,r);return this.pos=r,t},readPackedVarint:function(r,t){if(this.type!==dr.Bytes)return r.push(this.readVarint(t));var n=ys(this);for(r=r||[];this.pos<n;)r.push(this.readVarint(t));return r},readPackedSVarint:function(r){if(this.type!==dr.Bytes)return r.push(this.readSVarint());var t=ys(this);for(r=r||[];this.pos<t;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==dr.Bytes)return r.push(this.readBoolean());var t=ys(this);for(r=r||[];this.pos<t;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==dr.Bytes)return r.push(this.readFloat());var t=ys(this);for(r=r||[];this.pos<t;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==dr.Bytes)return r.push(this.readDouble());var t=ys(this);for(r=r||[];this.pos<t;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==dr.Bytes)return r.push(this.readFixed32());var t=ys(this);for(r=r||[];this.pos<t;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==dr.Bytes)return r.push(this.readSFixed32());var t=ys(this);for(r=r||[];this.pos<t;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==dr.Bytes)return r.push(this.readFixed64());var t=ys(this);for(r=r||[];this.pos<t;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==dr.Bytes)return r.push(this.readSFixed64());var t=ys(this);for(r=r||[];this.pos<t;)r.push(this.readSFixed64());return r},skip:function(r){var t=7&r;if(t===dr.Varint)for(;this.buf[this.pos++]>127;);else if(t===dr.Bytes)this.pos=this.readVarint()+this.pos;else if(t===dr.Fixed32)this.pos+=4;else{if(t!==dr.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(r,t){this.writeVarint(r<<3|t)},realloc:function(r){for(var t=this.length||16;t<this.pos+r;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),Al(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),Al(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),Al(this.buf,-1&r,this.pos),Al(this.buf,Math.floor(r*ro),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),Al(this.buf,-1&r,this.pos),Al(this.buf,Math.floor(r*ro),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?(function(t,n){var o,c;if(t>=0?(o=t%4294967296|0,c=t/4294967296|0):(c=~(-t/4294967296),4294967295^(o=~(-t%4294967296))?o=o+1|0:(o=0,c=c+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),(function(m,g,x){x.buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,x.buf[x.pos]=127&(m>>>=7)})(o,0,n),(function(m,g){var x=(7&m)<<4;g.buf[g.pos++]|=x|((m>>>=3)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m)))))})(c,n)})(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(!!r)},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var t=this.pos;this.pos=(function(o,c,m){for(var g,x,S=0;S<c.length;S++){if((g=c.charCodeAt(S))>55295&&g<57344){if(!x){g>56319||S+1===c.length?(o[m++]=239,o[m++]=191,o[m++]=189):x=g;continue}if(g<56320){o[m++]=239,o[m++]=191,o[m++]=189,x=g;continue}g=x-55296<<10|g-56320|65536,x=null}else x&&(o[m++]=239,o[m++]=191,o[m++]=189,x=null);g<128?o[m++]=g:(g<2048?o[m++]=g>>6|192:(g<65536?o[m++]=g>>12|224:(o[m++]=g>>18|240,o[m++]=g>>12&63|128),o[m++]=g>>6&63|128),o[m++]=63&g|128)}return m})(this.buf,r,this.pos);var n=this.pos-t;n>=128&&Sc(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(r){this.realloc(4),Ph(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),Ph(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var t=r.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=r[n]},writeRawMessage:function(r,t){this.pos++;var n=this.pos;r(t,this);var o=this.pos-n;o>=128&&Sc(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o},writeMessage:function(r,t,n){this.writeTag(r,dr.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(r,t){t.length&&this.writeMessage(r,Ch,t)},writePackedSVarint:function(r,t){t.length&&this.writeMessage(r,Ei,t)},writePackedBoolean:function(r,t){t.length&&this.writeMessage(r,$i,t)},writePackedFloat:function(r,t){t.length&&this.writeMessage(r,Zo,t)},writePackedDouble:function(r,t){t.length&&this.writeMessage(r,ia,t)},writePackedFixed32:function(r,t){t.length&&this.writeMessage(r,Dp,t)},writePackedSFixed32:function(r,t){t.length&&this.writeMessage(r,Ed,t)},writePackedFixed64:function(r,t){t.length&&this.writeMessage(r,Pd,t)},writePackedSFixed64:function(r,t){t.length&&this.writeMessage(r,Df,t)},writeBytesField:function(r,t){this.writeTag(r,dr.Bytes),this.writeBytes(t)},writeFixed32Field:function(r,t){this.writeTag(r,dr.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(r,t){this.writeTag(r,dr.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(r,t){this.writeTag(r,dr.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(r,t){this.writeTag(r,dr.Fixed64),this.writeSFixed64(t)},writeVarintField:function(r,t){this.writeTag(r,dr.Varint),this.writeVarint(t)},writeSVarintField:function(r,t){this.writeTag(r,dr.Varint),this.writeSVarint(t)},writeStringField:function(r,t){this.writeTag(r,dr.Bytes),this.writeString(t)},writeFloatField:function(r,t){this.writeTag(r,dr.Fixed32),this.writeFloat(t)},writeDoubleField:function(r,t){this.writeTag(r,dr.Fixed64),this.writeDouble(t)},writeBooleanField:function(r,t){this.writeVarintField(r,!!t)}};var no=W(Aa);const kc=3;function zl(r,t,n){r===1&&n.readMessage(Lp,t)}function Lp(r,t,n){if(r===3){const{id:o,bitmap:c,width:m,height:g,left:x,top:S,advance:P}=n.readMessage(Rp,{});t.push({id:o,bitmap:new Il({width:m+2*kc,height:g+2*kc},c),metrics:{width:m,height:g,left:x,top:S,advance:P}})}}function Rp(r,t,n){r===1?t.id=n.readVarint():r===2?t.bitmap=n.readBytes():r===3?t.width=n.readVarint():r===4?t.height=n.readVarint():r===5?t.left=n.readSVarint():r===6?t.top=n.readSVarint():r===7&&(t.advance=n.readVarint())}const Ah=kc;function Tc(r){let t=0,n=0;for(const g of r)t+=g.w*g.h,n=Math.max(n,g.w);r.sort(((g,x)=>x.h-g.h));const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let c=0,m=0;for(const g of r)for(let x=o.length-1;x>=0;x--){const S=o[x];if(!(g.w>S.w||g.h>S.h)){if(g.x=S.x,g.y=S.y,m=Math.max(m,g.y+g.h),c=Math.max(c,g.x+g.w),g.w===S.w&&g.h===S.h){const P=o.pop();x<o.length&&(o[x]=P)}else g.h===S.h?(S.x+=g.w,S.w-=g.w):g.w===S.w?(S.y+=g.h,S.h-=g.h):(o.push({x:S.x+g.w,y:S.y,w:S.w-g.w,h:g.h}),S.y+=g.h,S.h-=g.h);break}}return{w:c,h:m,fill:t/(c*m)||0}}const Pi=1;class Cd{constructor(t,{pixelRatio:n,version:o,stretchX:c,stretchY:m,content:g,textFitWidth:x,textFitHeight:S}){this.paddedRect=t,this.pixelRatio=n,this.stretchX=c,this.stretchY=m,this.content=g,this.version=o,this.textFitWidth=x,this.textFitHeight=S}get tl(){return[this.paddedRect.x+Pi,this.paddedRect.y+Pi]}get br(){return[this.paddedRect.x+this.paddedRect.w-Pi,this.paddedRect.y+this.paddedRect.h-Pi]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Pi)/this.pixelRatio,(this.paddedRect.h-2*Pi)/this.pixelRatio]}}class Md{constructor(t,n){const o={},c={};this.haveRenderCallbacks=[];const m=[];this.addImages(t,o,m),this.addImages(n,c,m);const{w:g,h:x}=Tc(m),S=new Fn({width:g||1,height:x||1});for(const P in t){const z=t[P],L=o[P].paddedRect;Fn.copy(z.data,S,{x:0,y:0},{x:L.x+Pi,y:L.y+Pi},z.data)}for(const P in n){const z=n[P],L=c[P].paddedRect,O=L.x+Pi,V=L.y+Pi,q=z.data.width,K=z.data.height;Fn.copy(z.data,S,{x:0,y:0},{x:O,y:V},z.data),Fn.copy(z.data,S,{x:0,y:K-1},{x:O,y:V-1},{width:q,height:1}),Fn.copy(z.data,S,{x:0,y:0},{x:O,y:V+K},{width:q,height:1}),Fn.copy(z.data,S,{x:q-1,y:0},{x:O-1,y:V},{width:1,height:K}),Fn.copy(z.data,S,{x:0,y:0},{x:O+q,y:V},{width:1,height:K})}this.image=S,this.iconPositions=o,this.patternPositions=c}addImages(t,n,o){for(const c in t){const m=t[c],g={x:0,y:0,w:m.data.width+2*Pi,h:m.data.height+2*Pi};o.push(g),n[c]=new Cd(g,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(t,n){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in t.updatedImages)this.patchUpdatedImage(this.iconPositions[o],t.getImage(o),n),this.patchUpdatedImage(this.patternPositions[o],t.getImage(o),n)}patchUpdatedImage(t,n,o){if(!t||!n||t.version===n.version)return;t.version=n.version;const[c,m]=t.tl;o.update(n.data,void 0,{x:c,y:m})}}var io;mt("ImagePosition",Cd),mt("ImageAtlas",Md),T.ah=void 0,(io=T.ah||(T.ah={}))[io.none=0]="none",io[io.horizontal=1]="horizontal",io[io.vertical=2]="vertical",io[io.horizontalOnly=3]="horizontalOnly";const aa=-17;class Ic{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,n){const o=new Ic;return o.scale=t||1,o.fontStack=n,o}static forImage(t){const n=new Ic;return n.imageName=t,n}}class oa{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,n){const o=new oa;for(let c=0;c<t.sections.length;c++){const m=t.sections[c];m.image?o.addImageSection(m):o.addTextSection(m,n)}return o}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=(function(t){let n="";for(let o=0;o<t.length;o++){const c=t.charCodeAt(o+1)||null,m=t.charCodeAt(o-1)||null;n+=c&&to(c)&&!Ml[t[o+1]]||m&&to(m)&&!Ml[t[o-1]]||!Ml[t[o]]?t[o]:Ml[t[o]]}return n})(this.text)}trim(){let t=0;for(let o=0;o<this.text.length&&Qr[this.text.charCodeAt(o)];o++)t++;let n=this.text.length;for(let o=this.text.length-1;o>=0&&o>=t&&Qr[this.text.charCodeAt(o)];o--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)}substring(t,n){const o=new oa;return o.text=this.text.substring(t,n),o.sectionIndex=this.sectionIndex.slice(t,n),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,n)=>Math.max(t,this.sections[n].scale)),0)}addTextSection(t,n){this.text+=t.text,this.sections.push(Ic.forText(t.scale,t.fontStack||n));const o=this.sections.length-1;for(let c=0;c<t.text.length;++c)this.sectionIndex.push(o)}addImageSection(t){const n=t.image?t.image.name:"";if(n.length===0)return void Zt("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(Ic.forImage(n)),this.sectionIndex.push(this.sections.length-1)):Zt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ec(r,t,n,o,c,m,g,x,S,P,z,L,O,V,q){const K=oa.fromFeature(r,c);let re;L===T.ah.vertical&&K.verticalizePunctuation();const{processBidirectionalText:oe,processStyledBidirectionalText:we}=Ar;if(oe&&K.sections.length===1){re=[];const Ae=oe(K.toString(),qi(K,P,m,t,o,V));for(const Ve of Ae){const dt=new oa;dt.text=Ve,dt.sections=K.sections;for(let Lt=0;Lt<Ve.length;Lt++)dt.sectionIndex.push(0);re.push(dt)}}else if(we){re=[];const Ae=we(K.text,K.sectionIndex,qi(K,P,m,t,o,V));for(const Ve of Ae){const dt=new oa;dt.text=Ve[0],dt.sectionIndex=Ve[1],dt.sections=K.sections,re.push(dt)}}else re=(function(Ae,Ve){const dt=[],Lt=Ae.text;let ht=0;for(const lt of Ve)dt.push(Ae.substring(ht,lt)),ht=lt;return ht<Lt.length&&dt.push(Ae.substring(ht,Lt.length)),dt})(K,qi(K,P,m,t,o,V));const de=[],_e={positionedLines:de,text:K.toString(),top:z[1],bottom:z[1],left:z[0],right:z[0],writingMode:L,iconsInText:!1,verticalizable:!1};return(function(Ae,Ve,dt,Lt,ht,lt,kt,vt,yt,Be,It,St){let Ut=0,$r=aa,Nr=0,On=0;const Da=vt==="right"?1:vt==="left"?0:.5;let di=0;for(const pn of ht){pn.trim();const jn=pn.getMaxScale(),Ci=(jn-1)*Kr,pi={positionedGlyphs:[],lineOffset:0};Ae.positionedLines[di]=pi;const Ki=pi.positionedGlyphs;let fi=0;if(!pn.length()){$r+=lt,++di;continue}for(let _s=0;_s<pn.length();_s++){const xr=pn.getSection(_s),Zr=pn.getSectionIndex(_s),Wr=pn.getCharCode(_s);let Bs=0,cn=null,jh=null,Wo=null,Xo=Kr;const La=!(yt===T.ah.horizontal||!It&&!wl(Wr)||It&&(Qr[Wr]||(Nn=Wr,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(Nn)))));if(xr.imageName){const ua=Lt[xr.imageName];if(!ua)continue;Wo=xr.imageName,Ae.iconsInText=Ae.iconsInText||!0,jh=ua.paddedRect;const Xn=ua.displaySize;xr.scale=xr.scale*Kr/St,cn={width:Xn[0],height:Xn[1],left:Pi,top:-Ah,advance:La?Xn[1]:Xn[0]},Bs=Ci+(Kr-Xn[1]*xr.scale),Xo=cn.advance;const Ll=La?Xn[0]*xr.scale-Kr*jn:Xn[1]*xr.scale-Kr*jn;Ll>0&&Ll>fi&&(fi=Ll)}else{const ua=dt[xr.fontStack],Xn=ua&&ua[Wr];if(Xn&&Xn.rect)jh=Xn.rect,cn=Xn.metrics;else{const Ll=Ve[xr.fontStack],Bd=Ll&&Ll[Wr];if(!Bd)continue;cn=Bd.metrics}Bs=(jn-xr.scale)*Kr}La?(Ae.verticalizable=!0,Ki.push({glyph:Wr,imageName:Wo,x:Ut,y:$r+Bs,vertical:La,scale:xr.scale,fontStack:xr.fontStack,sectionIndex:Zr,metrics:cn,rect:jh}),Ut+=Xo*xr.scale+Be):(Ki.push({glyph:Wr,imageName:Wo,x:Ut,y:$r+Bs,vertical:La,scale:xr.scale,fontStack:xr.fontStack,sectionIndex:Zr,metrics:cn,rect:jh}),Ut+=cn.advance*xr.scale+Be)}Ki.length!==0&&(Nr=Math.max(Ut-Be,Nr),Rf(Ki,0,Ki.length-1,Da,fi)),Ut=0;const la=lt*jn+fi;pi.lineOffset=Math.max(fi,Ci),$r+=la,On=Math.max(la,On),++di}var Nn;const Zi=$r-aa,{horizontalAlign:Gi,verticalAlign:Hi}=Pc(kt);(function(pn,jn,Ci,pi,Ki,fi,la,_s,xr){const Zr=(jn-Ci)*Ki;let Wr=0;Wr=fi!==la?-_s*pi-aa:(-pi*xr+.5)*la;for(const Bs of pn)for(const cn of Bs.positionedGlyphs)cn.x+=Zr,cn.y+=Wr})(Ae.positionedLines,Da,Gi,Hi,Nr,On,lt,Zi,ht.length),Ae.top+=-Hi*Zi,Ae.bottom=Ae.top+Zi,Ae.left+=-Gi*Nr,Ae.right=Ae.left+Nr})(_e,t,n,o,re,g,x,S,L,P,O,q),!(function(Ae){for(const Ve of Ae)if(Ve.positionedGlyphs.length!==0)return!1;return!0})(de)&&_e}const Qr={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Lf={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Bp={40:!0};function Fp(r,t,n,o,c,m){if(t.imageName){const g=o[t.imageName];return g?g.displaySize[0]*t.scale*Kr/m+c:0}{const g=n[t.fontStack],x=g&&g[r];return x?x.metrics.advance*t.scale+c:0}}function Op(r,t,n,o){const c=Math.pow(r-t,2);return o?r<t?c/2:2*c:c+Math.abs(n)*n}function Np(r,t,n){let o=0;return r===10&&(o-=1e4),n&&(o+=150),r!==40&&r!==65288||(o+=50),t!==41&&t!==65289||(o+=50),o}function Ad(r,t,n,o,c,m){let g=null,x=Op(t,n,c,m);for(const S of o){const P=Op(t-S.x,n,c,m)+S.badness;P<=x&&(g=S,x=P)}return{index:r,x:t,priorBreak:g,badness:x}}function jp(r){return r?jp(r.priorBreak).concat(r.index):[]}function qi(r,t,n,o,c,m){if(!r)return[];const g=[],x=(function(L,O,V,q,K,re){let oe=0;for(let we=0;we<L.length();we++){const de=L.getSection(we);oe+=Fp(L.getCharCode(we),de,q,K,O,re)}return oe/Math.max(1,Math.ceil(oe/V))})(r,t,n,o,c,m),S=r.text.indexOf("")>=0;let P=0;for(let L=0;L<r.length();L++){const O=r.getSection(L),V=r.getCharCode(L);if(Qr[V]||(P+=Fp(V,O,o,c,t,m)),L<r.length()-1){const q=!((z=V)<11904)&&(!!sr["CJK Compatibility Forms"](z)||!!sr["CJK Compatibility"](z)||!!sr["CJK Strokes"](z)||!!sr["CJK Symbols and Punctuation"](z)||!!sr["Enclosed CJK Letters and Months"](z)||!!sr["Halfwidth and Fullwidth Forms"](z)||!!sr["Ideographic Description Characters"](z)||!!sr["Vertical Forms"](z)||xl.test(String.fromCodePoint(z)));(Lf[V]||q||O.imageName||L!==r.length()-2&&Bp[r.getCharCode(L+1)])&&g.push(Ad(L+1,P,x,g,Np(V,r.getCharCode(L+1),q&&S),!1))}}var z;return jp(Ad(r.length(),P,x,g,0,!0))}function Pc(r){let t=.5,n=.5;switch(r){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function Rf(r,t,n,o,c){if(!o&&!c)return;const m=r[n],g=(r[n].x+m.metrics.advance*m.scale)*o;for(let x=t;x<=n;x++)r[x].x-=g,r[x].y+=c}function Go(r,t,n){const{horizontalAlign:o,verticalAlign:c}=Pc(n),m=t[0]-r.displaySize[0]*o,g=t[1]-r.displaySize[1]*c;return{image:r,top:g,bottom:g+r.displaySize[1],left:m,right:m+r.displaySize[0]}}function Cc(r){var t,n;let o=r.left,c=r.top,m=r.right-o,g=r.bottom-c;const x=(t=r.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",S=(n=r.image.textFitHeight)!==null&&n!==void 0?n:"stretchOrShrink",P=(r.image.content[2]-r.image.content[0])/(r.image.content[3]-r.image.content[1]);if(S==="proportional"){if(x==="stretchOnly"&&m/g<P||x==="proportional"){const z=Math.ceil(g*P);o*=z/m,m=z}}else if(x==="proportional"&&S==="stretchOnly"&&P!==0&&m/g>P){const z=Math.ceil(m/P);c*=z/g,g=z}return{x1:o,y1:c,x2:o+m,y2:c+g}}function Ho(r,t,n,o,c,m){const g=r.image;let x;if(g.content){const re=g.content,oe=g.pixelRatio||1;x=[re[0]/oe,re[1]/oe,g.displaySize[0]-re[2]/oe,g.displaySize[1]-re[3]/oe]}const S=t.left*m,P=t.right*m;let z,L,O,V;n==="width"||n==="both"?(V=c[0]+S-o[3],L=c[0]+P+o[1]):(V=c[0]+(S+P-g.displaySize[0])/2,L=V+g.displaySize[0]);const q=t.top*m,K=t.bottom*m;return n==="height"||n==="both"?(z=c[1]+q-o[0],O=c[1]+K+o[2]):(z=c[1]+(q+K-g.displaySize[1])/2,O=z+g.displaySize[1]),{image:g,top:z,right:L,bottom:O,left:V,collisionPadding:x}}const Ko=255,Rs=128,za=Ko*Rs;function Vp(r,t){const{expression:n}=t;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new lr(r+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:c}=n;let m=0;for(;m<o.length&&o[m]<=r;)m++;m=Math.max(0,m-1);let g=m;for(;g<o.length&&o[g]<r+1;)g++;g=Math.min(o.length-1,g);const x=o[m],S=o[g];return n.kind==="composite"?{kind:"composite",minZoom:x,maxZoom:S,interpolationType:c}:{kind:"camera",minZoom:x,maxZoom:S,minSize:n.evaluate(new lr(x)),maxSize:n.evaluate(new lr(S)),interpolationType:c}}}function Mc(r,t,n){let o="never";const c=r.get(t);return c?o=c:r.get(n)&&(o="always"),o}const Bf=Vo.VectorTileFeature.types,Up=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ac(r,t,n,o,c,m,g,x,S,P,z,L,O){const V=x?Math.min(za,Math.round(x[0])):0,q=x?Math.min(za,Math.round(x[1])):0;r.emplaceBack(t,n,Math.round(32*o),Math.round(32*c),m,g,(V<<1)+(S?1:0),q,16*P,16*z,256*L,256*O)}function bu(r,t,n){r.emplaceBack(t.x,t.y,n),r.emplaceBack(t.x,t.y,n),r.emplaceBack(t.x,t.y,n),r.emplaceBack(t.x,t.y,n)}function zh(r){for(const t of r.sections)if(Ea(t.text))return!0;return!1}class Dh{constructor(t){this.layoutVertexArray=new Oi,this.indexArray=new Ni,this.programConfigurations=t,this.segments=new rr,this.dynamicLayoutVertexArray=new zs,this.opacityVertexArray=new Hn,this.hasVisibleVertices=!1,this.placedSymbolArray=new Cr}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,n,o,c){this.isEmpty()||(o&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,vc.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Cl.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Up,!0),this.opacityVertexBuffer.itemSize=1),(o||c)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}mt("SymbolBuffers",Dh);class zc{constructor(t,n,o){this.layoutVertexArray=new t,this.layoutAttributes=n,this.indexArray=new o,this.segments=new rr,this.collisionVertexArray=new cs}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Ih.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}mt("CollisionBuffers",zc);class Su{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((g=>g.id)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ch([]),this.placementViewportMatrix=ch([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Vp(this.zoom,n["text-size"]),this.iconSizeData=Vp(this.zoom,n["icon-size"]);const o=this.layers[0].layout,c=o.get("symbol-sort-key"),m=o.get("symbol-z-order");this.canOverlap=Mc(o,"text-overlap","text-allow-overlap")!=="never"||Mc(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&!c.isConstant(),this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map((g=>T.ah[g]))),this.stateDependentLayerIds=this.layers.filter((g=>g.isStateDependent())).map((g=>g.id)),this.sourceID=t.sourceID}createArrays(){this.text=new Dh(new ra(this.layers,this.zoom,(t=>/^text/.test(t)))),this.icon=new Dh(new ra(this.layers,this.zoom,(t=>/^icon/.test(t)))),this.glyphOffsetArray=new zr,this.lineVertexArray=new Tn,this.symbolInstances=new Qt,this.textAnchorOffsets=new Dr}calculateGlyphDependencies(t,n,o,c,m){for(let g=0;g<t.length;g++)if(n[t.charCodeAt(g)]=!0,(o||c)&&m){const x=Ml[t.charAt(g)];x&&(n[x.charCodeAt(0)]=!0)}}populate(t,n,o){const c=this.layers[0],m=c.layout,g=m.get("text-font"),x=m.get("text-field"),S=m.get("icon-image"),P=(x.value.kind!=="constant"||x.value.value instanceof Qn&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),z=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,L=m.get("symbol-sort-key");if(this.features=[],!P&&!z)return;const O=n.iconDependencies,V=n.glyphDependencies,q=n.availableImages,K=new lr(this.zoom);for(const{feature:re,id:oe,index:we,sourceLayerIndex:de}of t){const _e=c._featureFilter.needGeometry,Ae=No(re,_e);if(!c._featureFilter.filter(K,Ae,o))continue;let Ve,dt;if(_e||(Ae.geometry=Oo(re)),P){const ht=c.getValueAndResolveTokens("text-field",Ae,o,q),lt=Qn.factory(ht),kt=this.hasRTLText=this.hasRTLText||zh(lt);(!kt||Ar.getRTLTextPluginStatus()==="unavailable"||kt&&Ar.isParsed())&&(Ve=Ui(lt,c,Ae))}if(z){const ht=c.getValueAndResolveTokens("icon-image",Ae,o,q);dt=ht instanceof Bn?ht:Bn.fromString(ht)}if(!Ve&&!dt)continue;const Lt=this.sortFeaturesByKey?L.evaluate(Ae,{},o):void 0;if(this.features.push({id:oe,text:Ve,icon:dt,index:we,sourceLayerIndex:de,geometry:Ae.geometry,properties:re.properties,type:Bf[re.type],sortKey:Lt}),dt&&(O[dt.name]=!0),Ve){const ht=g.evaluate(Ae,{},o).join(","),lt=m.get("text-rotation-alignment")!=="viewport"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(T.ah.vertical)>=0;for(const kt of Ve.sections)if(kt.image)O[kt.image.name]=!0;else{const vt=ec(Ve.toString()),yt=kt.fontStack||ht,Be=V[yt]=V[yt]||{};this.calculateGlyphDependencies(kt.text,Be,lt,this.allowVerticalPlacement,vt)}}}m.get("symbol-placement")==="line"&&(this.features=(function(re){const oe={},we={},de=[];let _e=0;function Ae(ht){de.push(re[ht]),_e++}function Ve(ht,lt,kt){const vt=we[ht];return delete we[ht],we[lt]=vt,de[vt].geometry[0].pop(),de[vt].geometry[0]=de[vt].geometry[0].concat(kt[0]),vt}function dt(ht,lt,kt){const vt=oe[lt];return delete oe[lt],oe[ht]=vt,de[vt].geometry[0].shift(),de[vt].geometry[0]=kt[0].concat(de[vt].geometry[0]),vt}function Lt(ht,lt,kt){const vt=kt?lt[0][lt[0].length-1]:lt[0][0];return`${ht}:${vt.x}:${vt.y}`}for(let ht=0;ht<re.length;ht++){const lt=re[ht],kt=lt.geometry,vt=lt.text?lt.text.toString():null;if(!vt){Ae(ht);continue}const yt=Lt(vt,kt),Be=Lt(vt,kt,!0);if(yt in we&&Be in oe&&we[yt]!==oe[Be]){const It=dt(yt,Be,kt),St=Ve(yt,Be,de[It].geometry);delete oe[yt],delete we[Be],we[Lt(vt,de[St].geometry,!0)]=St,de[It].geometry=null}else yt in we?Ve(yt,Be,kt):Be in oe?dt(yt,Be,kt):(Ae(ht),oe[yt]=_e-1,we[Be]=_e-1)}return de.filter((ht=>ht.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((re,oe)=>re.sortKey-oe.sortKey))}update(t,n,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,n,this.layers,o),this.icon.programConfigurations.updatePaintArrays(t,n,this.layers,o))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,n){const o=this.lineVertexArray.length;if(t.segment!==void 0){let c=t.dist(n[t.segment+1]),m=t.dist(n[t.segment]);const g={};for(let x=t.segment+1;x<n.length;x++)g[x]={x:n[x].x,y:n[x].y,tileUnitDistanceFromAnchor:c},x<n.length-1&&(c+=n[x+1].dist(n[x]));for(let x=t.segment||0;x>=0;x--)g[x]={x:n[x].x,y:n[x].y,tileUnitDistanceFromAnchor:m},x>0&&(m+=n[x-1].dist(n[x]));for(let x=0;x<n.length;x++){const S=g[x];this.lineVertexArray.emplaceBack(S.x,S.y,S.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(t,n,o,c,m,g,x,S,P,z,L,O){const V=t.indexArray,q=t.layoutVertexArray,K=t.segments.prepareSegment(4*n.length,q,V,this.canOverlap?g.sortKey:void 0),re=this.glyphOffsetArray.length,oe=K.vertexLength,we=this.allowVerticalPlacement&&x===T.ah.vertical?Math.PI/2:0,de=g.text&&g.text.sections;for(let _e=0;_e<n.length;_e++){const{tl:Ae,tr:Ve,bl:dt,br:Lt,tex:ht,pixelOffsetTL:lt,pixelOffsetBR:kt,minFontScaleX:vt,minFontScaleY:yt,glyphOffset:Be,isSDF:It,sectionIndex:St}=n[_e],Ut=K.vertexLength,$r=Be[1];Ac(q,S.x,S.y,Ae.x,$r+Ae.y,ht.x,ht.y,o,It,lt.x,lt.y,vt,yt),Ac(q,S.x,S.y,Ve.x,$r+Ve.y,ht.x+ht.w,ht.y,o,It,kt.x,lt.y,vt,yt),Ac(q,S.x,S.y,dt.x,$r+dt.y,ht.x,ht.y+ht.h,o,It,lt.x,kt.y,vt,yt),Ac(q,S.x,S.y,Lt.x,$r+Lt.y,ht.x+ht.w,ht.y+ht.h,o,It,kt.x,kt.y,vt,yt),bu(t.dynamicLayoutVertexArray,S,we),V.emplaceBack(Ut,Ut+1,Ut+2),V.emplaceBack(Ut+1,Ut+2,Ut+3),K.vertexLength+=4,K.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Be[0]),_e!==n.length-1&&St===n[_e+1].sectionIndex||t.programConfigurations.populatePaintArrays(q.length,g,g.index,{},O,de&&de[St])}t.placedSymbolArray.emplaceBack(S.x,S.y,re,this.glyphOffsetArray.length-re,oe,P,z,S.segment,o?o[0]:0,o?o[1]:0,c[0],c[1],x,0,!1,0,L)}_addCollisionDebugVertex(t,n,o,c,m,g){return n.emplaceBack(0,0),t.emplaceBack(o.x,o.y,c,m,Math.round(g.x),Math.round(g.y))}addCollisionDebugVertices(t,n,o,c,m,g,x){const S=m.segments.prepareSegment(4,m.layoutVertexArray,m.indexArray),P=S.vertexLength,z=m.layoutVertexArray,L=m.collisionVertexArray,O=x.anchorX,V=x.anchorY;this._addCollisionDebugVertex(z,L,g,O,V,new Y(t,n)),this._addCollisionDebugVertex(z,L,g,O,V,new Y(o,n)),this._addCollisionDebugVertex(z,L,g,O,V,new Y(o,c)),this._addCollisionDebugVertex(z,L,g,O,V,new Y(t,c)),S.vertexLength+=4;const q=m.indexArray;q.emplaceBack(P,P+1),q.emplaceBack(P+1,P+2),q.emplaceBack(P+2,P+3),q.emplaceBack(P+3,P),S.primitiveLength+=4}addDebugCollisionBoxes(t,n,o,c){for(let m=t;m<n;m++){const g=this.collisionBoxArray.get(m);this.addCollisionDebugVertices(g.x1,g.y1,g.x2,g.y2,c?this.textCollisionBox:this.iconCollisionBox,g.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new zc(ki,Eh.members,ln),this.iconCollisionBox=new zc(ki,Eh.members,ln);for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(t,n,o,c,m,g,x,S,P){const z={};for(let L=n;L<o;L++){const O=t.get(L);z.textBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},z.textFeatureIndex=O.featureIndex;break}for(let L=c;L<m;L++){const O=t.get(L);z.verticalTextBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},z.verticalTextFeatureIndex=O.featureIndex;break}for(let L=g;L<x;L++){const O=t.get(L);z.iconBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},z.iconFeatureIndex=O.featureIndex;break}for(let L=S;L<P;L++){const O=t.get(L);z.verticalIconBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},z.verticalIconFeatureIndex=O.featureIndex;break}return z}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,n){const o=t.placedSymbolArray.get(n),c=o.vertexStartIndex+4*o.numGlyphs;for(let m=o.vertexStartIndex;m<c;m+=4)t.indexArray.emplaceBack(m,m+1,m+2),t.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(t),o=Math.cos(t),c=[],m=[],g=[];for(let x=0;x<this.symbolInstances.length;++x){g.push(x);const S=this.symbolInstances.get(x);c.push(0|Math.round(n*S.anchorX+o*S.anchorY)),m.push(S.featureIndex)}return g.sort(((x,S)=>c[x]-c[S]||m[S]-m[x])),g}addToSortKeyRanges(t,n){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===n?o.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const o=this.symbolInstances.get(n);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach(((c,m,g)=>{c>=0&&g.indexOf(c)===m&&this.addIndicesForPlacedSymbol(this.text,c)})),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let zd,Lh;mt("SymbolBucket",Su,{omit:["layers","collisionBoxArray","features","compareText"]}),Su.MAX_GLYPHS=65535,Su.addDynamicAttributes=bu;var ku={get paint(){return Lh=Lh||new f({"icon-opacity":new At(Ee.paint_symbol["icon-opacity"]),"icon-color":new At(Ee.paint_symbol["icon-color"]),"icon-halo-color":new At(Ee.paint_symbol["icon-halo-color"]),"icon-halo-width":new At(Ee.paint_symbol["icon-halo-width"]),"icon-halo-blur":new At(Ee.paint_symbol["icon-halo-blur"]),"icon-translate":new gt(Ee.paint_symbol["icon-translate"]),"icon-translate-anchor":new gt(Ee.paint_symbol["icon-translate-anchor"]),"text-opacity":new At(Ee.paint_symbol["text-opacity"]),"text-color":new At(Ee.paint_symbol["text-color"],{runtimeType:Ln,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new At(Ee.paint_symbol["text-halo-color"]),"text-halo-width":new At(Ee.paint_symbol["text-halo-width"]),"text-halo-blur":new At(Ee.paint_symbol["text-halo-blur"]),"text-translate":new gt(Ee.paint_symbol["text-translate"]),"text-translate-anchor":new gt(Ee.paint_symbol["text-translate-anchor"])})},get layout(){return zd=zd||new f({"symbol-placement":new gt(Ee.layout_symbol["symbol-placement"]),"symbol-spacing":new gt(Ee.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new gt(Ee.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new At(Ee.layout_symbol["symbol-sort-key"]),"symbol-z-order":new gt(Ee.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new gt(Ee.layout_symbol["icon-allow-overlap"]),"icon-overlap":new gt(Ee.layout_symbol["icon-overlap"]),"icon-ignore-placement":new gt(Ee.layout_symbol["icon-ignore-placement"]),"icon-optional":new gt(Ee.layout_symbol["icon-optional"]),"icon-rotation-alignment":new gt(Ee.layout_symbol["icon-rotation-alignment"]),"icon-size":new At(Ee.layout_symbol["icon-size"]),"icon-text-fit":new gt(Ee.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new gt(Ee.layout_symbol["icon-text-fit-padding"]),"icon-image":new At(Ee.layout_symbol["icon-image"]),"icon-rotate":new At(Ee.layout_symbol["icon-rotate"]),"icon-padding":new At(Ee.layout_symbol["icon-padding"]),"icon-keep-upright":new gt(Ee.layout_symbol["icon-keep-upright"]),"icon-offset":new At(Ee.layout_symbol["icon-offset"]),"icon-anchor":new At(Ee.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new gt(Ee.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new gt(Ee.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new gt(Ee.layout_symbol["text-rotation-alignment"]),"text-field":new At(Ee.layout_symbol["text-field"]),"text-font":new At(Ee.layout_symbol["text-font"]),"text-size":new At(Ee.layout_symbol["text-size"]),"text-max-width":new At(Ee.layout_symbol["text-max-width"]),"text-line-height":new gt(Ee.layout_symbol["text-line-height"]),"text-letter-spacing":new At(Ee.layout_symbol["text-letter-spacing"]),"text-justify":new At(Ee.layout_symbol["text-justify"]),"text-radial-offset":new At(Ee.layout_symbol["text-radial-offset"]),"text-variable-anchor":new gt(Ee.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new At(Ee.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new At(Ee.layout_symbol["text-anchor"]),"text-max-angle":new gt(Ee.layout_symbol["text-max-angle"]),"text-writing-mode":new gt(Ee.layout_symbol["text-writing-mode"]),"text-rotate":new At(Ee.layout_symbol["text-rotate"]),"text-padding":new gt(Ee.layout_symbol["text-padding"]),"text-keep-upright":new gt(Ee.layout_symbol["text-keep-upright"]),"text-transform":new At(Ee.layout_symbol["text-transform"]),"text-offset":new At(Ee.layout_symbol["text-offset"]),"text-allow-overlap":new gt(Ee.layout_symbol["text-allow-overlap"]),"text-overlap":new gt(Ee.layout_symbol["text-overlap"]),"text-ignore-placement":new gt(Ee.layout_symbol["text-ignore-placement"]),"text-optional":new gt(Ee.layout_symbol["text-optional"])})}};class Rh{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:fa,this.defaultValue=t}evaluate(t){if(t.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(t.formattedSection))return n.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}mt("FormatSectionOverride",Rh,{omit:["defaultValue"]});class Dl extends s{constructor(t){super(t,ku)}recalculate(t,n){if(super.recalculate(t,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const c=[];for(const m of o)c.indexOf(m)<0&&c.push(m);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,n,o,c){const m=this.layout.get(t).evaluate(n,{},o,c),g=this._unevaluatedLayout._values[t];return g.isDataDriven()||ba(g.value)||!m?m:(function(x,S){return S.replace(/{([^{}]+)}/g,((P,z)=>x&&z in x?String(x[z]):""))})(n.properties,m)}createBucket(t){return new Su(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of ku.paint.overridableProperties){if(!Dl.hasPaintOverride(this.layout,t))continue;const n=this.paint.get(t),o=new Rh(n),c=new ni(o,n.property.specification);let m=null;m=n.value.kind==="constant"||n.value.kind==="source"?new Wa("source",c):new Xa("composite",c,n.value.zoomStops),this.paint._values[t]=new wi(n.property,m,n.parameters)}}_handleOverridablePaintPropertyUpdate(t,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven())&&Dl.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,n){const o=t.get("text-field"),c=ku.paint.properties[n];let m=!1;const g=x=>{for(const S of x)if(c.overrides&&c.overrides.hasOverride(S))return void(m=!0)};if(o.value.kind==="constant"&&o.value.value instanceof Qn)g(o.value.value.sections);else if(o.value.kind==="source"){const x=P=>{m||(P instanceof es&&Er(P.value)===Qi?g(P.value.sections):P instanceof $a?g(P.sections):P.eachChild(x))},S=o.value;S._styleExpression&&x(S._styleExpression.expression)}return m}}let Dd;var Ff={get paint(){return Dd=Dd||new f({"background-color":new gt(Ee.paint_background["background-color"]),"background-pattern":new Sl(Ee.paint_background["background-pattern"]),"background-opacity":new gt(Ee.paint_background["background-opacity"])})}};class Bh extends s{constructor(t){super(t,Ff)}}let $p;var Dc={get paint(){return $p=$p||new f({"raster-opacity":new gt(Ee.paint_raster["raster-opacity"]),"raster-hue-rotate":new gt(Ee.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new gt(Ee.paint_raster["raster-brightness-min"]),"raster-brightness-max":new gt(Ee.paint_raster["raster-brightness-max"]),"raster-saturation":new gt(Ee.paint_raster["raster-saturation"]),"raster-contrast":new gt(Ee.paint_raster["raster-contrast"]),"raster-resampling":new gt(Ee.paint_raster["raster-resampling"]),"raster-fade-duration":new gt(Ee.paint_raster["raster-fade-duration"])})}};class Of extends s{constructor(t){super(t,Dc)}}class Fh extends s{constructor(t){super(t,{}),this.onAdd=n=>{this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)},this.onRemove=n=>{this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class i{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const a=63710088e-1;class d{constructor(t,n){if(isNaN(t)||isNaN(n))throw new Error(`Invalid LngLat object: (${t}, ${n})`);if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new d(He(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const n=Math.PI/180,o=this.lat*n,c=t.lat*n,m=Math.sin(o)*Math.sin(c)+Math.cos(o)*Math.cos(c)*Math.cos((t.lng-this.lng)*n);return a*Math.acos(Math.min(m,1))}static convert(t){if(t instanceof d)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new d(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new d(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const v=2*Math.PI*a;function I(r){return v*Math.cos(r*Math.PI/180)}function M(r){return(180+r)/360}function $(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function ae(r,t){return r/I(t)}function pe(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}class Ce{constructor(t,n,o=0){this.x=+t,this.y=+n,this.z=+o}static fromLngLat(t,n=0){const o=d.convert(t);return new Ce(M(o.lng),$(o.lat),ae(n,o.lat))}toLngLat(){return new d(360*this.x-180,pe(this.y))}toAltitude(){return this.z*I(pe(this.y))}meterInMercatorCoordinateUnits(){return 1/v*(t=pe(this.y),1/Math.cos(t*Math.PI/180));var t}}function Ze(r,t,n){var o=2*Math.PI*6378137/256/Math.pow(2,n);return[r*o-2*Math.PI*6378137/2,t*o-2*Math.PI*6378137/2]}class We{constructor(t,n,o){if(!(function(c,m,g){return!(c<0||c>25||g<0||g>=Math.pow(2,c)||m<0||m>=Math.pow(2,c))})(t,n,o))throw new Error(`x=${n}, y=${o}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=n,this.y=o,this.key=bt(0,t,t,n,o)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,n,o){const c=(g=this.y,x=this.z,S=Ze(256*(m=this.x),256*(g=Math.pow(2,x)-g-1),x),P=Ze(256*(m+1),256*(g+1),x),S[0]+","+S[1]+","+P[0]+","+P[1]);var m,g,x,S,P;const z=(function(L,O,V){let q,K="";for(let re=L;re>0;re--)q=1<<re-1,K+=(O&q?1:0)+(V&q?2:0);return K})(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,z).replace(/{bbox-epsg-3857}/g,c)}isChildOf(t){const n=this.z-t.z;return n>0&&t.x===this.x>>n&&t.y===this.y>>n}getTilePoint(t){const n=Math.pow(2,this.z);return new Y((t.x*n-this.x)*un,(t.y*n-this.y)*un)}toString(){return`${this.z}/${this.x}/${this.y}`}}class qe{constructor(t,n){this.wrap=t,this.canonical=n,this.key=bt(t,n.z,n.z,n.x,n.y)}}class ct{constructor(t,n,o,c,m){if(t<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${o}`);this.overscaledZ=t,this.wrap=n,this.canonical=new We(o,+c,+m),this.key=bt(n,t,o,c,m)}clone(){return new ct(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-t;return t>this.canonical.z?new ct(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ct(t,this.wrap,t,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(t,n){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-t;return t>this.canonical.z?bt(this.wrap*+n,t,this.canonical.z,this.canonical.x,this.canonical.y):bt(this.wrap*+n,t,t,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const n=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>n&&t.canonical.y===this.canonical.y>>n}children(t){if(this.overscaledZ>=t)return[new ct(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,o=2*this.canonical.x,c=2*this.canonical.y;return[new ct(n,this.wrap,n,o,c),new ct(n,this.wrap,n,o+1,c),new ct(n,this.wrap,n,o,c+1),new ct(n,this.wrap,n,o+1,c+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new ct(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new ct(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new qe(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Ce(t.x-this.wrap,t.y))}}function bt(r,t,n,o,c){(r*=2)<0&&(r=-1*r-1);const m=1<<n;return(m*m*r+m*c+o).toString(36)+n.toString(36)+t.toString(36)}mt("CanonicalTileID",We),mt("OverscaledTileID",ct,{omit:["posMatrix"]});class Mt{constructor(t,n,o,c=1,m=1,g=1,x=0){if(this.uid=t,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void Zt(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const S=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=c,this.greenFactor=m,this.blueFactor=g,this.baseShift=x;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let P=0;P<S;P++)this.data[this._idx(-1,P)]=this.data[this._idx(0,P)],this.data[this._idx(S,P)]=this.data[this._idx(S-1,P)],this.data[this._idx(P,-1)]=this.data[this._idx(P,0)],this.data[this._idx(P,S)]=this.data[this._idx(P,S-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(S,-1)]=this.data[this._idx(S-1,0)],this.data[this._idx(-1,S)]=this.data[this._idx(0,S-1)],this.data[this._idx(S,S)]=this.data[this._idx(S-1,S-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let P=0;P<S;P++)for(let z=0;z<S;z++){const L=this.get(P,z);L>this.max&&(this.max=L),L<this.min&&(this.min=L)}}get(t,n){const o=new Uint8Array(this.data.buffer),c=4*this._idx(t,n);return this.unpack(o[c],o[c+1],o[c+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,n){if(t<-1||t>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(t+1)}unpack(t,n,o){return t*this.redFactor+n*this.greenFactor+o*this.blueFactor-this.baseShift}getPixels(){return new Fn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,n,o){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let c=n*this.dim,m=n*this.dim+this.dim,g=o*this.dim,x=o*this.dim+this.dim;switch(n){case-1:c=m-1;break;case 1:m=c+1}switch(o){case-1:g=x-1;break;case 1:x=g+1}const S=-n*this.dim,P=-o*this.dim;for(let z=g;z<x;z++)for(let L=c;L<m;L++)this.data[this._idx(L,z)]=t.data[this._idx(L+S,z+P)]}}mt("DEMData",Mt);class dn{constructor(t){this._stringToNumber={},this._numberToString=[];for(let n=0;n<t.length;n++){const o=t[n];this._stringToNumber[o]=n,this._numberToString[n]=o}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class Se{constructor(t,n,o,c,m){this.type="Feature",this._vectorTileFeature=t,t._z=n,t._x=o,t._y=c,this.properties=t.properties,this.id=m}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(t[n]=this[n]);return t}}class ge{constructor(t,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Mo(un,16,0),this.grid3D=new Mo(un,16,0),this.featureIndexArray=new Ur,this.promoteId=n}insert(t,n,o,c,m,g){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,c,m);const S=g?this.grid3D:this.grid;for(let P=0;P<n.length;P++){const z=n[P],L=[1/0,1/0,-1/0,-1/0];for(let O=0;O<z.length;O++){const V=z[O];L[0]=Math.min(L[0],V.x),L[1]=Math.min(L[1],V.y),L[2]=Math.max(L[2],V.x),L[3]=Math.max(L[3],V.y)}L[0]<un&&L[1]<un&&L[2]>=0&&L[3]>=0&&S.insert(x,L[0],L[1],L[2],L[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Vo.VectorTile(new no(this.rawTileData)).layers,this.sourceLayerCoder=new dn(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,n,o,c){this.loadVTLayers();const m=t.params||{},g=un/t.tileSize/t.scale,x=fl(m.filter),S=t.queryGeometry,P=t.queryPadding*g,z=it(S),L=this.grid.query(z.minX-P,z.minY-P,z.maxX+P,z.maxY+P),O=it(t.cameraQueryGeometry),V=this.grid3D.query(O.minX-P,O.minY-P,O.maxX+P,O.maxY+P,((re,oe,we,de)=>(function(_e,Ae,Ve,dt,Lt){for(const lt of _e)if(Ae<=lt.x&&Ve<=lt.y&&dt>=lt.x&&Lt>=lt.y)return!0;const ht=[new Y(Ae,Ve),new Y(Ae,Lt),new Y(dt,Lt),new Y(dt,Ve)];if(_e.length>2){for(const lt of ht)if(kl(_e,lt))return!0}for(let lt=0;lt<_e.length-1;lt++)if(op(_e[lt],_e[lt+1],ht))return!0;return!1})(t.cameraQueryGeometry,re-P,oe-P,we+P,de+P)));for(const re of V)L.push(re);L.sort(zt);const q={};let K;for(let re=0;re<L.length;re++){const oe=L[re];if(oe===K)continue;K=oe;const we=this.featureIndexArray.get(oe);let de=null;this.loadMatchingFeature(q,we.bucketIndex,we.sourceLayerIndex,we.featureIndex,x,m.layers,m.availableImages,n,o,c,((_e,Ae,Ve)=>(de||(de=Oo(_e)),Ae.queryIntersectsFeature(S,_e,Ve,de,this.z,t.transform,g,t.pixelPosMatrix))))}return q}loadMatchingFeature(t,n,o,c,m,g,x,S,P,z,L){const O=this.bucketLayerIDs[n];if(g&&!(function(re,oe){for(let we=0;we<re.length;we++)if(oe.indexOf(re[we])>=0)return!0;return!1})(g,O))return;const V=this.sourceLayerCoder.decode(o),q=this.vtLayers[V].feature(c);if(m.needGeometry){const re=No(q,!0);if(!m.filter(new lr(this.tileID.overscaledZ),re,this.tileID.canonical))return}else if(!m.filter(new lr(this.tileID.overscaledZ),q))return;const K=this.getId(q,V);for(let re=0;re<O.length;re++){const oe=O[re];if(g&&g.indexOf(oe)<0)continue;const we=S[oe];if(!we)continue;let de={};K&&z&&(de=z.getState(we.sourceLayer||"_geojsonTileLayer",K));const _e=je({},P[oe]);_e.paint=Te(_e.paint,we.paint,q,de,x),_e.layout=Te(_e.layout,we.layout,q,de,x);const Ae=!L||L(q,we,de);if(!Ae)continue;const Ve=new Se(q,this.z,this.x,this.y,K);Ve.layer=_e;let dt=t[oe];dt===void 0&&(dt=t[oe]=[]),dt.push({featureIndex:c,feature:Ve,intersectionZ:Ae})}}lookupSymbolFeatures(t,n,o,c,m,g,x,S){const P={};this.loadVTLayers();const z=fl(m);for(const L of t)this.loadMatchingFeature(P,o,c,L,z,g,x,S,n);return P}hasLayer(t){for(const n of this.bucketLayerIDs)for(const o of n)if(t===o)return!0;return!1}getId(t,n){let o=t.id;return this.promoteId&&(o=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof o=="boolean"&&(o=Number(o))),o}}function Te(r,t,n,o,c){return $e(r,((m,g)=>{const x=t instanceof Do?t.get(g):null;return x&&x.evaluate?x.evaluate(n,o,c):x}))}function it(r){let t=1/0,n=1/0,o=-1/0,c=-1/0;for(const m of r)t=Math.min(t,m.x),n=Math.min(n,m.y),o=Math.max(o,m.x),c=Math.max(c,m.y);return{minX:t,minY:n,maxX:o,maxY:c}}function zt(r,t){return t-r}function Ot(r,t,n,o,c){const m=[];for(let g=0;g<r.length;g++){const x=r[g];let S;for(let P=0;P<x.length-1;P++){let z=x[P],L=x[P+1];z.x<t&&L.x<t||(z.x<t?z=new Y(t,z.y+(t-z.x)/(L.x-z.x)*(L.y-z.y))._round():L.x<t&&(L=new Y(t,z.y+(t-z.x)/(L.x-z.x)*(L.y-z.y))._round()),z.y<n&&L.y<n||(z.y<n?z=new Y(z.x+(n-z.y)/(L.y-z.y)*(L.x-z.x),n)._round():L.y<n&&(L=new Y(z.x+(n-z.y)/(L.y-z.y)*(L.x-z.x),n)._round()),z.x>=o&&L.x>=o||(z.x>=o?z=new Y(o,z.y+(o-z.x)/(L.x-z.x)*(L.y-z.y))._round():L.x>=o&&(L=new Y(o,z.y+(o-z.x)/(L.x-z.x)*(L.y-z.y))._round()),z.y>=c&&L.y>=c||(z.y>=c?z=new Y(z.x+(c-z.y)/(L.y-z.y)*(L.x-z.x),c)._round():L.y>=c&&(L=new Y(z.x+(c-z.y)/(L.y-z.y)*(L.x-z.x),c)._round()),S&&z.equals(S[S.length-1])||(S=[z],m.push(S)),S.push(L)))))}}return m}mt("FeatureIndex",ge,{omit:["rawTileData","sourceLayerCoder"]});class Dt extends Y{constructor(t,n,o,c){super(t,n),this.angle=o,c!==void 0&&(this.segment=c)}clone(){return new Dt(this.x,this.y,this.angle,this.segment)}}function Kt(r,t,n,o,c){if(t.segment===void 0||n===0)return!0;let m=t,g=t.segment+1,x=0;for(;x>-n/2;){if(g--,g<0)return!1;x-=r[g].dist(m),m=r[g]}x+=r[g].dist(r[g+1]),g++;const S=[];let P=0;for(;x<n/2;){const z=r[g],L=r[g+1];if(!L)return!1;let O=r[g-1].angleTo(z)-z.angleTo(L);for(O=Math.abs((O+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:x,angleDelta:O}),P+=O;x-S[0].distance>o;)P-=S.shift().angleDelta;if(P>c)return!1;g++,x+=z.dist(L)}return!0}function Dn(r){let t=0;for(let n=0;n<r.length-1;n++)t+=r[n].dist(r[n+1]);return t}function Tr(r,t,n){return r?.6*t*n:0}function so(r,t){return Math.max(r?r.right-r.left:0,t?t.right-t.left:0)}function Nf(r,t,n,o,c,m){const g=Tr(n,c,m),x=so(n,o)*m;let S=0;const P=Dn(r)/2;for(let z=0;z<r.length-1;z++){const L=r[z],O=r[z+1],V=L.dist(O);if(S+V>P){const q=(P-S)/V,K=on.number(L.x,O.x,q),re=on.number(L.y,O.y,q),oe=new Dt(K,re,O.angleTo(L),z);return oe._round(),!g||Kt(r,oe,x,g,t)?oe:void 0}S+=V}}function ky(r,t,n,o,c,m,g,x,S){const P=Tr(o,m,g),z=so(o,c),L=z*g,O=r[0].x===0||r[0].x===S||r[0].y===0||r[0].y===S;return t-L<t/4&&(t=L+t/4),Jm(r,O?t/2*x%t:(z/2+2*m)*g*x%t,t,P,n,L,O,!1,S)}function Jm(r,t,n,o,c,m,g,x,S){const P=m/2,z=Dn(r);let L=0,O=t-n,V=[];for(let q=0;q<r.length-1;q++){const K=r[q],re=r[q+1],oe=K.dist(re),we=re.angleTo(K);for(;O+n<L+oe;){O+=n;const de=(O-L)/oe,_e=on.number(K.x,re.x,de),Ae=on.number(K.y,re.y,de);if(_e>=0&&_e<S&&Ae>=0&&Ae<S&&O-P>=0&&O+P<=z){const Ve=new Dt(_e,Ae,we,q);Ve._round(),o&&!Kt(r,Ve,m,o,c)||V.push(Ve)}}L+=oe}return x||V.length||g||(V=Jm(r,L/2,n,o,c,m,g,!0,S)),V}mt("Anchor",Dt);const Oh=Pi;function Qm(r,t,n,o){const c=[],m=r.image,g=m.pixelRatio,x=m.paddedRect.w-2*Oh,S=m.paddedRect.h-2*Oh;let P={x1:r.left,y1:r.top,x2:r.right,y2:r.bottom};const z=m.stretchX||[[0,x]],L=m.stretchY||[[0,S]],O=(Be,It)=>Be+It[1]-It[0],V=z.reduce(O,0),q=L.reduce(O,0),K=x-V,re=S-q;let oe=0,we=V,de=0,_e=q,Ae=0,Ve=K,dt=0,Lt=re;if(m.content&&o){const Be=m.content,It=Be[2]-Be[0],St=Be[3]-Be[1];(m.textFitWidth||m.textFitHeight)&&(P=Cc(r)),oe=qp(z,0,Be[0]),de=qp(L,0,Be[1]),we=qp(z,Be[0],Be[2]),_e=qp(L,Be[1],Be[3]),Ae=Be[0]-oe,dt=Be[1]-de,Ve=It-we,Lt=St-_e}const ht=P.x1,lt=P.y1,kt=P.x2-ht,vt=P.y2-lt,yt=(Be,It,St,Ut)=>{const $r=Zp(Be.stretch-oe,we,kt,ht),Nr=Gp(Be.fixed-Ae,Ve,Be.stretch,V),On=Zp(It.stretch-de,_e,vt,lt),Da=Gp(It.fixed-dt,Lt,It.stretch,q),di=Zp(St.stretch-oe,we,kt,ht),Nn=Gp(St.fixed-Ae,Ve,St.stretch,V),Zi=Zp(Ut.stretch-de,_e,vt,lt),Gi=Gp(Ut.fixed-dt,Lt,Ut.stretch,q),Hi=new Y($r,On),pn=new Y(di,On),jn=new Y(di,Zi),Ci=new Y($r,Zi),pi=new Y(Nr/g,Da/g),Ki=new Y(Nn/g,Gi/g),fi=t*Math.PI/180;if(fi){const xr=Math.sin(fi),Zr=Math.cos(fi),Wr=[Zr,-xr,xr,Zr];Hi._matMult(Wr),pn._matMult(Wr),Ci._matMult(Wr),jn._matMult(Wr)}const la=Be.stretch+Be.fixed,_s=It.stretch+It.fixed;return{tl:Hi,tr:pn,bl:Ci,br:jn,tex:{x:m.paddedRect.x+Oh+la,y:m.paddedRect.y+Oh+_s,w:St.stretch+St.fixed-la,h:Ut.stretch+Ut.fixed-_s},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:pi,pixelOffsetBR:Ki,minFontScaleX:Ve/g/kt,minFontScaleY:Lt/g/vt,isSDF:n}};if(o&&(m.stretchX||m.stretchY)){const Be=eg(z,K,V),It=eg(L,re,q);for(let St=0;St<Be.length-1;St++){const Ut=Be[St],$r=Be[St+1];for(let Nr=0;Nr<It.length-1;Nr++)c.push(yt(Ut,It[Nr],$r,It[Nr+1]))}}else c.push(yt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:S+1}));return c}function qp(r,t,n){let o=0;for(const c of r)o+=Math.max(t,Math.min(n,c[1]))-Math.max(t,Math.min(n,c[0]));return o}function eg(r,t,n){const o=[{fixed:-Oh,stretch:0}];for(const[c,m]of r){const g=o[o.length-1];o.push({fixed:c-g.stretch,stretch:g.stretch}),o.push({fixed:c-g.stretch,stretch:g.stretch+(m-c)})}return o.push({fixed:t+Oh,stretch:n}),o}function Zp(r,t,n,o){return r/t*n+o}function Gp(r,t,n,o){return r-t*n/o}class Hp{constructor(t,n,o,c,m,g,x,S,P,z){var L;if(this.boxStartIndex=t.length,P){let O=g.top,V=g.bottom;const q=g.collisionPadding;q&&(O-=q[1],V+=q[3]);let K=V-O;K>0&&(K=Math.max(10,K),this.circleDiameter=K)}else{const O=!((L=g.image)===null||L===void 0)&&L.content&&(g.image.textFitWidth||g.image.textFitHeight)?Cc(g):{x1:g.left,y1:g.top,x2:g.right,y2:g.bottom};O.y1=O.y1*x-S[0],O.y2=O.y2*x+S[2],O.x1=O.x1*x-S[3],O.x2=O.x2*x+S[1];const V=g.collisionPadding;if(V&&(O.x1-=V[0]*x,O.y1-=V[1]*x,O.x2+=V[2]*x,O.y2+=V[3]*x),z){const q=new Y(O.x1,O.y1),K=new Y(O.x2,O.y1),re=new Y(O.x1,O.y2),oe=new Y(O.x2,O.y2),we=z*Math.PI/180;q._rotate(we),K._rotate(we),re._rotate(we),oe._rotate(we),O.x1=Math.min(q.x,K.x,re.x,oe.x),O.x2=Math.max(q.x,K.x,re.x,oe.x),O.y1=Math.min(q.y,K.y,re.y,oe.y),O.y2=Math.max(q.y,K.y,re.y,oe.y)}t.emplaceBack(n.x,n.y,O.x1,O.y1,O.x2,O.y2,o,c,m)}this.boxEndIndex=t.length}}class Ty{constructor(t=[],n=((o,c)=>o<c?-1:o>c?1:0)){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:o}=this,c=n[t];for(;t>0;){const m=t-1>>1,g=n[m];if(o(c,g)>=0)break;n[t]=g,t=m}n[t]=c}_down(t){const{data:n,compare:o}=this,c=this.length>>1,m=n[t];for(;t<c;){let g=1+(t<<1);const x=g+1;if(x<this.length&&o(n[x],n[g])<0&&(g=x),o(n[g],m)>=0)break;n[t]=n[g],t=g}n[t]=m}}function Iy(r,t=1,n=!1){let o=1/0,c=1/0,m=-1/0,g=-1/0;const x=r[0];for(let V=0;V<x.length;V++){const q=x[V];(!V||q.x<o)&&(o=q.x),(!V||q.y<c)&&(c=q.y),(!V||q.x>m)&&(m=q.x),(!V||q.y>g)&&(g=q.y)}const S=Math.min(m-o,g-c);let P=S/2;const z=new Ty([],Ey);if(S===0)return new Y(o,c);for(let V=o;V<m;V+=S)for(let q=c;q<g;q+=S)z.push(new Nh(V+P,q+P,P,r));let L=(function(V){let q=0,K=0,re=0;const oe=V[0];for(let we=0,de=oe.length,_e=de-1;we<de;_e=we++){const Ae=oe[we],Ve=oe[_e],dt=Ae.x*Ve.y-Ve.x*Ae.y;K+=(Ae.x+Ve.x)*dt,re+=(Ae.y+Ve.y)*dt,q+=3*dt}return new Nh(K/q,re/q,0,V)})(r),O=z.length;for(;z.length;){const V=z.pop();(V.d>L.d||!L.d)&&(L=V,n&&console.log("found best %d after %d probes",Math.round(1e4*V.d)/1e4,O)),V.max-L.d<=t||(P=V.h/2,z.push(new Nh(V.p.x-P,V.p.y-P,P,r)),z.push(new Nh(V.p.x+P,V.p.y-P,P,r)),z.push(new Nh(V.p.x-P,V.p.y+P,P,r)),z.push(new Nh(V.p.x+P,V.p.y+P,P,r)),O+=4)}return n&&(console.log(`num probes: ${O}`),console.log(`best distance: ${L.d}`)),L.p}function Ey(r,t){return t.max-r.max}function Nh(r,t,n,o){this.p=new Y(r,t),this.h=n,this.d=(function(c,m){let g=!1,x=1/0;for(let S=0;S<m.length;S++){const P=m[S];for(let z=0,L=P.length,O=L-1;z<L;O=z++){const V=P[z],q=P[O];V.y>c.y!=q.y>c.y&&c.x<(q.x-V.x)*(c.y-V.y)/(q.y-V.y)+V.x&&(g=!g),x=Math.min(x,pd(c,V,q))}}return(g?1:-1)*Math.sqrt(x)})(this.p,o),this.max=this.d+this.h*Math.SQRT2}var hi;T.aq=void 0,(hi=T.aq||(T.aq={}))[hi.center=1]="center",hi[hi.left=2]="left",hi[hi.right=3]="right",hi[hi.top=4]="top",hi[hi.bottom=5]="bottom",hi[hi["top-left"]=6]="top-left",hi[hi["top-right"]=7]="top-right",hi[hi["bottom-left"]=8]="bottom-left",hi[hi["bottom-right"]=9]="bottom-right";const Tu=7,jf=Number.POSITIVE_INFINITY;function tg(r,t){return t[1]!==jf?(function(n,o,c){let m=0,g=0;switch(o=Math.abs(o),c=Math.abs(c),n){case"top-right":case"top-left":case"top":g=c-Tu;break;case"bottom-right":case"bottom-left":case"bottom":g=-c+Tu}switch(n){case"top-right":case"bottom-right":case"right":m=-o;break;case"top-left":case"bottom-left":case"left":m=o}return[m,g]})(r,t[0],t[1]):(function(n,o){let c=0,m=0;o<0&&(o=0);const g=o/Math.SQRT2;switch(n){case"top-right":case"top-left":m=g-Tu;break;case"bottom-right":case"bottom-left":m=-g+Tu;break;case"bottom":m=-o+Tu;break;case"top":m=o-Tu}switch(n){case"top-right":case"bottom-right":c=-g;break;case"top-left":case"bottom-left":c=g;break;case"left":c=o;break;case"right":c=-o}return[c,m]})(r,t[0])}function rg(r,t,n){var o;const c=r.layout,m=(o=c.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(t,{},n);if(m){const x=m.values,S=[];for(let P=0;P<x.length;P+=2){const z=S[P]=x[P],L=x[P+1].map((O=>O*Kr));z.startsWith("top")?L[1]-=Tu:z.startsWith("bottom")&&(L[1]+=Tu),S[P+1]=L}return new _i(S)}const g=c.get("text-variable-anchor");if(g){let x;x=r._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[c.get("text-radial-offset").evaluate(t,{},n)*Kr,jf]:c.get("text-offset").evaluate(t,{},n).map((P=>P*Kr));const S=[];for(const P of g)S.push(P,tg(P,x));return new _i(S)}return null}function Vf(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Py(r,t,n,o,c,m,g,x,S,P,z){let L=m.textMaxSize.evaluate(t,{});L===void 0&&(L=g);const O=r.layers[0].layout,V=O.get("icon-offset").evaluate(t,{},z),q=ig(n.horizontal),K=g/24,re=r.tilePixelRatio*K,oe=r.tilePixelRatio*L/24,we=r.tilePixelRatio*x,de=r.tilePixelRatio*O.get("symbol-spacing"),_e=O.get("text-padding")*r.tilePixelRatio,Ae=(function(Be,It,St,Ut=1){const $r=Be.get("icon-padding").evaluate(It,{},St),Nr=$r&&$r.values;return[Nr[0]*Ut,Nr[1]*Ut,Nr[2]*Ut,Nr[3]*Ut]})(O,t,z,r.tilePixelRatio),Ve=O.get("text-max-angle")/180*Math.PI,dt=O.get("text-rotation-alignment")!=="viewport"&&O.get("symbol-placement")!=="point",Lt=O.get("icon-rotation-alignment")==="map"&&O.get("symbol-placement")!=="point",ht=O.get("symbol-placement"),lt=de/2,kt=O.get("icon-text-fit");let vt;o&&kt!=="none"&&(r.allowVerticalPlacement&&n.vertical&&(vt=Ho(o,n.vertical,kt,O.get("icon-text-fit-padding"),V,K)),q&&(o=Ho(o,q,kt,O.get("icon-text-fit-padding"),V,K)));const yt=(Be,It)=>{It.x<0||It.x>=un||It.y<0||It.y>=un||(function(St,Ut,$r,Nr,On,Da,di,Nn,Zi,Gi,Hi,pn,jn,Ci,pi,Ki,fi,la,_s,xr,Zr,Wr,Bs,cn,jh){const Wo=St.addToLineVertexArray(Ut,$r);let Xo,La,ua,Xn,Ll=0,Bd=0,lg=0,ug=0,Wf=-1,Xf=-1;const Rl={};let cg=Ro("");if(St.allowVerticalPlacement&&Nr.vertical){const Mi=Nn.layout.get("text-rotate").evaluate(Zr,{},cn)+90;ua=new Hp(Zi,Ut,Gi,Hi,pn,Nr.vertical,jn,Ci,pi,Mi),di&&(Xn=new Hp(Zi,Ut,Gi,Hi,pn,di,fi,la,pi,Mi))}if(On){const Mi=Nn.layout.get("icon-rotate").evaluate(Zr,{}),ca=Nn.layout.get("icon-text-fit")!=="none",Lc=Qm(On,Mi,Bs,ca),oo=di?Qm(di,Mi,Bs,ca):void 0;La=new Hp(Zi,Ut,Gi,Hi,pn,On,fi,la,!1,Mi),Ll=4*Lc.length;const Rc=St.iconSizeData;let Yo=null;Rc.kind==="source"?(Yo=[Rs*Nn.layout.get("icon-size").evaluate(Zr,{})],Yo[0]>za&&Zt(`${St.layerIds[0]}: Value for "icon-size" is >= ${Ko}. Reduce your "icon-size".`)):Rc.kind==="composite"&&(Yo=[Rs*Wr.compositeIconSizes[0].evaluate(Zr,{},cn),Rs*Wr.compositeIconSizes[1].evaluate(Zr,{},cn)],(Yo[0]>za||Yo[1]>za)&&Zt(`${St.layerIds[0]}: Value for "icon-size" is >= ${Ko}. Reduce your "icon-size".`)),St.addSymbols(St.icon,Lc,Yo,xr,_s,Zr,T.ah.none,Ut,Wo.lineStartIndex,Wo.lineLength,-1,cn),Wf=St.icon.placedSymbolArray.length-1,oo&&(Bd=4*oo.length,St.addSymbols(St.icon,oo,Yo,xr,_s,Zr,T.ah.vertical,Ut,Wo.lineStartIndex,Wo.lineLength,-1,cn),Xf=St.icon.placedSymbolArray.length-1)}const hg=Object.keys(Nr.horizontal);for(const Mi of hg){const ca=Nr.horizontal[Mi];if(!Xo){cg=Ro(ca.text);const oo=Nn.layout.get("text-rotate").evaluate(Zr,{},cn);Xo=new Hp(Zi,Ut,Gi,Hi,pn,ca,jn,Ci,pi,oo)}const Lc=ca.positionedLines.length===1;if(lg+=ng(St,Ut,ca,Da,Nn,pi,Zr,Ki,Wo,Nr.vertical?T.ah.horizontal:T.ah.horizontalOnly,Lc?hg:[Mi],Rl,Wf,Wr,cn),Lc)break}Nr.vertical&&(ug+=ng(St,Ut,Nr.vertical,Da,Nn,pi,Zr,Ki,Wo,T.ah.vertical,["vertical"],Rl,Xf,Wr,cn));const Ay=Xo?Xo.boxStartIndex:St.collisionBoxArray.length,zy=Xo?Xo.boxEndIndex:St.collisionBoxArray.length,Dy=ua?ua.boxStartIndex:St.collisionBoxArray.length,Ly=ua?ua.boxEndIndex:St.collisionBoxArray.length,Ry=La?La.boxStartIndex:St.collisionBoxArray.length,By=La?La.boxEndIndex:St.collisionBoxArray.length,Fy=Xn?Xn.boxStartIndex:St.collisionBoxArray.length,Oy=Xn?Xn.boxEndIndex:St.collisionBoxArray.length;let ao=-1;const Wp=(Mi,ca)=>Mi&&Mi.circleDiameter?Math.max(Mi.circleDiameter,ca):ca;ao=Wp(Xo,ao),ao=Wp(ua,ao),ao=Wp(La,ao),ao=Wp(Xn,ao);const dg=ao>-1?1:0;dg&&(ao*=jh/Kr),St.glyphOffsetArray.length>=Su.MAX_GLYPHS&&Zt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Zr.sortKey!==void 0&&St.addToSortKeyRanges(St.symbolInstances.length,Zr.sortKey);const Ny=rg(Nn,Zr,cn),[jy,Vy]=(function(Mi,ca){const Lc=Mi.length,oo=ca==null?void 0:ca.values;if((oo==null?void 0:oo.length)>0)for(let Rc=0;Rc<oo.length;Rc+=2){const Yo=oo[Rc+1];Mi.emplaceBack(T.aq[oo[Rc]],Yo[0],Yo[1])}return[Lc,Mi.length]})(St.textAnchorOffsets,Ny);St.symbolInstances.emplaceBack(Ut.x,Ut.y,Rl.right>=0?Rl.right:-1,Rl.center>=0?Rl.center:-1,Rl.left>=0?Rl.left:-1,Rl.vertical||-1,Wf,Xf,cg,Ay,zy,Dy,Ly,Ry,By,Fy,Oy,Gi,lg,ug,Ll,Bd,dg,0,jn,ao,jy,Vy)})(r,It,Be,n,o,c,vt,r.layers[0],r.collisionBoxArray,t.index,t.sourceLayerIndex,r.index,re,[_e,_e,_e,_e],dt,S,we,Ae,Lt,V,t,m,P,z,g)};if(ht==="line")for(const Be of Ot(t.geometry,0,0,un,un)){const It=ky(Be,de,Ve,n.vertical||q,o,24,oe,r.overscaling,un);for(const St of It)q&&Cy(r,q.text,lt,St)||yt(Be,St)}else if(ht==="line-center"){for(const Be of t.geometry)if(Be.length>1){const It=Nf(Be,Ve,n.vertical||q,o,24,oe);It&&yt(Be,It)}}else if(t.type==="Polygon")for(const Be of _o(t.geometry,0)){const It=Iy(Be,16);yt(Be[0],new Dt(It.x,It.y,0))}else if(t.type==="LineString")for(const Be of t.geometry)yt(Be,new Dt(Be[0].x,Be[0].y,0));else if(t.type==="Point")for(const Be of t.geometry)for(const It of Be)yt([It],new Dt(It.x,It.y,0))}function ng(r,t,n,o,c,m,g,x,S,P,z,L,O,V,q){const K=(function(we,de,_e,Ae,Ve,dt,Lt,ht){const lt=Ae.layout.get("text-rotate").evaluate(dt,{})*Math.PI/180,kt=[];for(const vt of de.positionedLines)for(const yt of vt.positionedGlyphs){if(!yt.rect)continue;const Be=yt.rect||{};let It=Ah+1,St=!0,Ut=1,$r=0;const Nr=(Ve||ht)&&yt.vertical,On=yt.metrics.advance*yt.scale/2;if(ht&&de.verticalizable&&($r=vt.lineOffset/2-(yt.imageName?-(Kr-yt.metrics.width*yt.scale)/2:(yt.scale-1)*Kr)),yt.imageName){const xr=Lt[yt.imageName];St=xr.sdf,Ut=xr.pixelRatio,It=Pi/Ut}const Da=Ve?[yt.x+On,yt.y]:[0,0];let di=Ve?[0,0]:[yt.x+On+_e[0],yt.y+_e[1]-$r],Nn=[0,0];Nr&&(Nn=di,di=[0,0]);const Zi=yt.metrics.isDoubleResolution?2:1,Gi=(yt.metrics.left-It)*yt.scale-On+di[0],Hi=(-yt.metrics.top-It)*yt.scale+di[1],pn=Gi+Be.w/Zi*yt.scale/Ut,jn=Hi+Be.h/Zi*yt.scale/Ut,Ci=new Y(Gi,Hi),pi=new Y(pn,Hi),Ki=new Y(Gi,jn),fi=new Y(pn,jn);if(Nr){const xr=new Y(-On,On-aa),Zr=-Math.PI/2,Wr=Kr/2-On,Bs=new Y(5-aa-Wr,-(yt.imageName?Wr:0)),cn=new Y(...Nn);Ci._rotateAround(Zr,xr)._add(Bs)._add(cn),pi._rotateAround(Zr,xr)._add(Bs)._add(cn),Ki._rotateAround(Zr,xr)._add(Bs)._add(cn),fi._rotateAround(Zr,xr)._add(Bs)._add(cn)}if(lt){const xr=Math.sin(lt),Zr=Math.cos(lt),Wr=[Zr,-xr,xr,Zr];Ci._matMult(Wr),pi._matMult(Wr),Ki._matMult(Wr),fi._matMult(Wr)}const la=new Y(0,0),_s=new Y(0,0);kt.push({tl:Ci,tr:pi,bl:Ki,br:fi,tex:Be,writingMode:de.writingMode,glyphOffset:Da,sectionIndex:yt.sectionIndex,isSDF:St,pixelOffsetTL:la,pixelOffsetBR:_s,minFontScaleX:0,minFontScaleY:0})}return kt})(0,n,x,c,m,g,o,r.allowVerticalPlacement),re=r.textSizeData;let oe=null;re.kind==="source"?(oe=[Rs*c.layout.get("text-size").evaluate(g,{})],oe[0]>za&&Zt(`${r.layerIds[0]}: Value for "text-size" is >= ${Ko}. Reduce your "text-size".`)):re.kind==="composite"&&(oe=[Rs*V.compositeTextSizes[0].evaluate(g,{},q),Rs*V.compositeTextSizes[1].evaluate(g,{},q)],(oe[0]>za||oe[1]>za)&&Zt(`${r.layerIds[0]}: Value for "text-size" is >= ${Ko}. Reduce your "text-size".`)),r.addSymbols(r.text,K,oe,x,m,g,P,t,S.lineStartIndex,S.lineLength,O,q);for(const we of z)L[we]=r.text.placedSymbolArray.length-1;return 4*K.length}function ig(r){for(const t in r)return r[t];return null}function Cy(r,t,n,o){const c=r.compareText;if(t in c){const m=c[t];for(let g=m.length-1;g>=0;g--)if(o.dist(m[g])<n)return!0}else c[t]=[];return c[t].push(o),!1}const sg=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Uf{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,o]=new Uint8Array(t,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const c=o>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);const m=sg[15&o];if(!m)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(t,2,1),[x]=new Uint32Array(t,4,1);return new Uf(x,g,m,t)}constructor(t,n=64,o=Float64Array,c){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=o,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const m=sg.indexOf(this.ArrayType),g=2*t*this.ArrayType.BYTES_PER_ELEMENT,x=t*this.IndexArrayType.BYTES_PER_ELEMENT,S=(8-x%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${o}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+x+S,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+g+x+S),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+x+S,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t)}add(t,n){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=t,this.coords[this._pos++]=n,o}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return $f(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,n,o,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:g,nodeSize:x}=this,S=[0,m.length-1,0],P=[];for(;S.length;){const z=S.pop()||0,L=S.pop()||0,O=S.pop()||0;if(L-O<=x){for(let re=O;re<=L;re++){const oe=g[2*re],we=g[2*re+1];oe>=t&&oe<=o&&we>=n&&we<=c&&P.push(m[re])}continue}const V=O+L>>1,q=g[2*V],K=g[2*V+1];q>=t&&q<=o&&K>=n&&K<=c&&P.push(m[V]),(z===0?t<=q:n<=K)&&(S.push(O),S.push(V-1),S.push(1-z)),(z===0?o>=q:c>=K)&&(S.push(V+1),S.push(L),S.push(1-z))}return P}within(t,n,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:m,nodeSize:g}=this,x=[0,c.length-1,0],S=[],P=o*o;for(;x.length;){const z=x.pop()||0,L=x.pop()||0,O=x.pop()||0;if(L-O<=g){for(let re=O;re<=L;re++)og(m[2*re],m[2*re+1],t,n)<=P&&S.push(c[re]);continue}const V=O+L>>1,q=m[2*V],K=m[2*V+1];og(q,K,t,n)<=P&&S.push(c[V]),(z===0?t-o<=q:n-o<=K)&&(x.push(O),x.push(V-1),x.push(1-z)),(z===0?t+o>=q:n+o>=K)&&(x.push(V+1),x.push(L),x.push(1-z))}return S}}function $f(r,t,n,o,c,m){if(c-o<=n)return;const g=o+c>>1;ag(r,t,g,o,c,m),$f(r,t,n,o,g-1,1-m),$f(r,t,n,g+1,c,1-m)}function ag(r,t,n,o,c,m){for(;c>o;){if(c-o>600){const P=c-o+1,z=n-o+1,L=Math.log(P),O=.5*Math.exp(2*L/3),V=.5*Math.sqrt(L*O*(P-O)/P)*(z-P/2<0?-1:1);ag(r,t,n,Math.max(o,Math.floor(n-z*O/P+V)),Math.min(c,Math.floor(n+(P-z)*O/P+V)),m)}const g=t[2*n+m];let x=o,S=c;for(Ld(r,t,o,n),t[2*c+m]>g&&Ld(r,t,o,c);x<S;){for(Ld(r,t,x,S),x++,S--;t[2*x+m]<g;)x++;for(;t[2*S+m]>g;)S--}t[2*o+m]===g?Ld(r,t,o,S):(S++,Ld(r,t,S,c)),S<=n&&(o=S+1),n<=S&&(c=S-1)}}function Ld(r,t,n,o){qf(r,n,o),qf(t,2*n,2*o),qf(t,2*n+1,2*o+1)}function qf(r,t,n){const o=r[t];r[t]=r[n],r[n]=o}function og(r,t,n,o){const c=r-n,m=t-o;return c*c+m*m}var Zf;T.bg=void 0,(Zf=T.bg||(T.bg={})).create="create",Zf.load="load",Zf.fullLoad="fullLoad";let Kp=null,Rd=[];const Gf=1e3/60,Hf="loadTime",Kf="fullLoadTime",My={mark(r){performance.mark(r)},frame(r){const t=r;Kp!=null&&Rd.push(t-Kp),Kp=t},clearMetrics(){Kp=null,Rd=[],performance.clearMeasures(Hf),performance.clearMeasures(Kf);for(const r in T.bg)performance.clearMarks(T.bg[r])},getPerformanceMetrics(){performance.measure(Hf,T.bg.create,T.bg.load),performance.measure(Kf,T.bg.create,T.bg.fullLoad);const r=performance.getEntriesByName(Hf)[0].duration,t=performance.getEntriesByName(Kf)[0].duration,n=Rd.length,o=1/(Rd.reduce(((m,g)=>m+g),0)/n/1e3),c=Rd.filter((m=>m>Gf)).reduce(((m,g)=>m+(g-Gf)/Gf),0);return{loadTime:r,fullLoadTime:t,fps:o,percentDroppedFrames:c/(n+c)*100,totalFrames:n}}};T.$=class extends R{},T.A=mu,T.B=Qu,T.C=function(r){if(Pr==null){const t=r.navigator?r.navigator.userAgent:null;Pr=!!r.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Pr},T.D=gt,T.E=Ra,T.F=class{constructor(r,t){this.target=r,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new i((()=>this.process())),this.subscription=(function(n,o,c,m){return n.addEventListener(o,c,!1),{unsubscribe:()=>{n.removeEventListener(o,c,!1)}}})(this.target,"message",(n=>this.receive(n))),this.globalScope=Mr(self)?r:window}registerMessageHandler(r,t){this.messageHandlers[r]=t}sendAsync(r,t){return new Promise(((n,o)=>{const c=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[c]={resolve:n,reject:o},t&&t.signal.addEventListener("abort",(()=>{delete this.resolveRejects[c];const x={id:c,type:"<cancel>",origin:location.origin,targetMapId:r.targetMapId,sourceMapId:this.mapId};this.target.postMessage(x)}),{once:!0});const m=[],g=Object.assign(Object.assign({},r),{id:c,sourceMapId:this.mapId,origin:location.origin,data:Gn(r.data,m)});this.target.postMessage(g,{transfer:m})}))}receive(r){const t=r.data,n=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[n];const o=this.abortControllers[n];return delete this.abortControllers[n],void(o&&o.abort())}if(Mr(self)||t.mustQueue)return this.tasks[n]=t,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,t)}}process(){if(this.taskQueue.length===0)return;const r=this.taskQueue.shift(),t=this.tasks[r];delete this.tasks[r],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(r,t)}processTask(r,t){return h(this,void 0,void 0,(function*(){if(t.type==="<response>"){const c=this.resolveRejects[r];return delete this.resolveRejects[r],c?void(t.error?c.reject(As(t.error)):c.resolve(As(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(r,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=As(t.data),o=new AbortController;this.abortControllers[r]=o;try{const c=yield this.messageHandlers[t.type](t.sourceMapId,n,o);this.completeTask(r,null,c)}catch(c){this.completeTask(r,c)}}))}completeTask(r,t,n){const o=[];delete this.abortControllers[r];const c={id:r,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?Gn(t):null,data:Gn(n,o)};this.target.postMessage(c,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},T.G=cr,T.H=function(){var r=new mu(16);return mu!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},T.I=Cd,T.J=function(r,t,n){var o,c,m,g,x,S,P,z,L,O,V,q,K=n[0],re=n[1],oe=n[2];return t===r?(r[12]=t[0]*K+t[4]*re+t[8]*oe+t[12],r[13]=t[1]*K+t[5]*re+t[9]*oe+t[13],r[14]=t[2]*K+t[6]*re+t[10]*oe+t[14],r[15]=t[3]*K+t[7]*re+t[11]*oe+t[15]):(c=t[1],m=t[2],g=t[3],x=t[4],S=t[5],P=t[6],z=t[7],L=t[8],O=t[9],V=t[10],q=t[11],r[0]=o=t[0],r[1]=c,r[2]=m,r[3]=g,r[4]=x,r[5]=S,r[6]=P,r[7]=z,r[8]=L,r[9]=O,r[10]=V,r[11]=q,r[12]=o*K+x*re+L*oe+t[12],r[13]=c*K+S*re+O*oe+t[13],r[14]=m*K+P*re+V*oe+t[14],r[15]=g*K+z*re+q*oe+t[15]),r},T.K=function(r,t,n){var o=n[0],c=n[1],m=n[2];return r[0]=t[0]*o,r[1]=t[1]*o,r[2]=t[2]*o,r[3]=t[3]*o,r[4]=t[4]*c,r[5]=t[5]*c,r[6]=t[6]*c,r[7]=t[7]*c,r[8]=t[8]*m,r[9]=t[9]*m,r[10]=t[10]*m,r[11]=t[11]*m,r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},T.L=gd,T.M=function(r,t){const n={};for(let o=0;o<t.length;o++){const c=t[o];c in r&&(n[c]=r[c])}return n},T.N=d,T.O=M,T.P=Y,T.Q=$,T.R=Fn,T.S=ct,T.T=Cn,T.U=De,T.V=ze,T.W=Pt,T.X=un,T.Y=w,T.Z=Ce,T._=h,T.a=Yt,T.a$=function(r,t){var n=r[0],o=r[1],c=r[2],m=r[3],g=r[4],x=r[5],S=r[6],P=r[7],z=r[8],L=r[9],O=r[10],V=r[11],q=r[12],K=r[13],re=r[14],oe=r[15],we=t[0],de=t[1],_e=t[2],Ae=t[3],Ve=t[4],dt=t[5],Lt=t[6],ht=t[7],lt=t[8],kt=t[9],vt=t[10],yt=t[11],Be=t[12],It=t[13],St=t[14],Ut=t[15];return Math.abs(n-we)<=oi*Math.max(1,Math.abs(n),Math.abs(we))&&Math.abs(o-de)<=oi*Math.max(1,Math.abs(o),Math.abs(de))&&Math.abs(c-_e)<=oi*Math.max(1,Math.abs(c),Math.abs(_e))&&Math.abs(m-Ae)<=oi*Math.max(1,Math.abs(m),Math.abs(Ae))&&Math.abs(g-Ve)<=oi*Math.max(1,Math.abs(g),Math.abs(Ve))&&Math.abs(x-dt)<=oi*Math.max(1,Math.abs(x),Math.abs(dt))&&Math.abs(S-Lt)<=oi*Math.max(1,Math.abs(S),Math.abs(Lt))&&Math.abs(P-ht)<=oi*Math.max(1,Math.abs(P),Math.abs(ht))&&Math.abs(z-lt)<=oi*Math.max(1,Math.abs(z),Math.abs(lt))&&Math.abs(L-kt)<=oi*Math.max(1,Math.abs(L),Math.abs(kt))&&Math.abs(O-vt)<=oi*Math.max(1,Math.abs(O),Math.abs(vt))&&Math.abs(V-yt)<=oi*Math.max(1,Math.abs(V),Math.abs(yt))&&Math.abs(q-Be)<=oi*Math.max(1,Math.abs(q),Math.abs(Be))&&Math.abs(K-It)<=oi*Math.max(1,Math.abs(K),Math.abs(It))&&Math.abs(re-St)<=oi*Math.max(1,Math.abs(re),Math.abs(St))&&Math.abs(oe-Ut)<=oi*Math.max(1,Math.abs(oe),Math.abs(Ut))},T.a0=rr,T.a1=We,T.a2=Ke,T.a3=r=>{const t=window.document.createElement("video");return t.muted=!0,new Promise((n=>{t.onloadstart=()=>{n(t)};for(const o of r){const c=window.document.createElement("source");mn(o)||(t.crossOrigin="Anonymous"),c.src=o,t.appendChild(c)}}))},T.a4=function(){return pt++},T.a5=st,T.a6=Su,T.a7=fl,T.a8=No,T.a9=Se,T.aA=function(r){if(r.type==="custom")return new Fh(r);switch(r.type){case"background":return new Bh(r);case"circle":return new Ef(r);case"fill":return new Cf(r);case"fill-extrusion":return new Ep(r);case"heatmap":return new Pf(r);case"hillshade":return new dp(r);case"line":return new xu(r);case"raster":return new Of(r);case"symbol":return new Dl(r)}},T.aB=xt,T.aC=function(r,t){if(!r)return[{command:"setStyle",args:[t]}];let n=[];try{if(!pr(r.version,t.version))return[{command:"setStyle",args:[t]}];pr(r.center,t.center)||n.push({command:"setCenter",args:[t.center]}),pr(r.zoom,t.zoom)||n.push({command:"setZoom",args:[t.zoom]}),pr(r.bearing,t.bearing)||n.push({command:"setBearing",args:[t.bearing]}),pr(r.pitch,t.pitch)||n.push({command:"setPitch",args:[t.pitch]}),pr(r.sprite,t.sprite)||n.push({command:"setSprite",args:[t.sprite]}),pr(r.glyphs,t.glyphs)||n.push({command:"setGlyphs",args:[t.glyphs]}),pr(r.transition,t.transition)||n.push({command:"setTransition",args:[t.transition]}),pr(r.light,t.light)||n.push({command:"setLight",args:[t.light]}),pr(r.terrain,t.terrain)||n.push({command:"setTerrain",args:[t.terrain]}),pr(r.sky,t.sky)||n.push({command:"setSky",args:[t.sky]}),pr(r.projection,t.projection)||n.push({command:"setProjection",args:[t.projection]});const o={},c=[];(function(g,x,S,P){let z;for(z in x=x||{},g=g||{})Object.prototype.hasOwnProperty.call(g,z)&&(Object.prototype.hasOwnProperty.call(x,z)||ks(z,S,P));for(z in x)Object.prototype.hasOwnProperty.call(x,z)&&(Object.prototype.hasOwnProperty.call(g,z)?pr(g[z],x[z])||(g[z].type==="geojson"&&x[z].type==="geojson"&&Ba(g,x,z)?Rr(S,{command:"setGeoJSONSourceData",args:[z,x[z].data]}):Ts(z,x,S,P)):Ss(z,x,S))})(r.sources,t.sources,c,o);const m=[];r.layers&&r.layers.forEach((g=>{"source"in g&&o[g.source]?n.push({command:"removeLayer",args:[g.id]}):m.push(g)})),n=n.concat(c),(function(g,x,S){x=x||[];const P=(g=g||[]).map(ho),z=x.map(ho),L=g.reduce(Fa,{}),O=x.reduce(Fa,{}),V=P.slice(),q=Object.create(null);let K,re,oe,we,de;for(let _e=0,Ae=0;_e<P.length;_e++)K=P[_e],Object.prototype.hasOwnProperty.call(O,K)?Ae++:(Rr(S,{command:"removeLayer",args:[K]}),V.splice(V.indexOf(K,Ae),1));for(let _e=0,Ae=0;_e<z.length;_e++)K=z[z.length-1-_e],V[V.length-1-_e]!==K&&(Object.prototype.hasOwnProperty.call(L,K)?(Rr(S,{command:"removeLayer",args:[K]}),V.splice(V.lastIndexOf(K,V.length-Ae),1)):Ae++,we=V[V.length-_e],Rr(S,{command:"addLayer",args:[O[K],we]}),V.splice(V.length-_e,0,K),q[K]=!0);for(let _e=0;_e<z.length;_e++)if(K=z[_e],re=L[K],oe=O[K],!q[K]&&!pr(re,oe))if(pr(re.source,oe.source)&&pr(re["source-layer"],oe["source-layer"])&&pr(re.type,oe.type)){for(de in mi(re.layout,oe.layout,S,K,null,"setLayoutProperty"),mi(re.paint,oe.paint,S,K,null,"setPaintProperty"),pr(re.filter,oe.filter)||Rr(S,{command:"setFilter",args:[K,oe.filter]}),pr(re.minzoom,oe.minzoom)&&pr(re.maxzoom,oe.maxzoom)||Rr(S,{command:"setLayerZoomRange",args:[K,oe.minzoom,oe.maxzoom]}),re)Object.prototype.hasOwnProperty.call(re,de)&&de!=="layout"&&de!=="paint"&&de!=="filter"&&de!=="metadata"&&de!=="minzoom"&&de!=="maxzoom"&&(de.indexOf("paint.")===0?mi(re[de],oe[de],S,K,de.slice(6),"setPaintProperty"):pr(re[de],oe[de])||Rr(S,{command:"setLayerProperty",args:[K,de,oe[de]]}));for(de in oe)Object.prototype.hasOwnProperty.call(oe,de)&&!Object.prototype.hasOwnProperty.call(re,de)&&de!=="layout"&&de!=="paint"&&de!=="filter"&&de!=="metadata"&&de!=="minzoom"&&de!=="maxzoom"&&(de.indexOf("paint.")===0?mi(re[de],oe[de],S,K,de.slice(6),"setPaintProperty"):pr(re[de],oe[de])||Rr(S,{command:"setLayerProperty",args:[K,de,oe[de]]}))}else Rr(S,{command:"removeLayer",args:[K]}),we=V[V.lastIndexOf(K)+1],Rr(S,{command:"addLayer",args:[oe,we]})})(m,t.layers,n)}catch(o){console.warn("Unable to compute style diff:",o),n=[{command:"setStyle",args:[t]}]}return n},T.aD=function(r){const t=[],n=r.id;return n===void 0&&t.push({message:`layers.${n}: missing required property "id"`}),r.render===void 0&&t.push({message:`layers.${n}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},T.aE=function r(t,n){if(Array.isArray(t)){if(!Array.isArray(n)||t.length!==n.length)return!1;for(let o=0;o<t.length;o++)if(!r(t[o],n[o]))return!1;return!0}if(typeof t=="object"&&t!==null&&n!==null){if(typeof n!="object"||Object.keys(t).length!==Object.keys(n).length)return!1;for(const o in t)if(!r(t[o],n[o]))return!1;return!0}return t===n},T.aF=$e,T.aG=ar,T.aH=class extends Jr{constructor(r,t){super(r,t),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},T.aI=vn,T.aJ=class extends Jr{constructor(r,t){super(r,t),this.current=sc}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let t=1;t<16;t++)if(r[t]!==this.current[t]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},T.aK=ic,T.aL=pu,T.aM=Vt,T.aN=class extends Jr{constructor(r,t){super(r,t),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},T.aO=class extends Jr{constructor(r,t){super(r,t),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},T.aP=function(r,t,n,o,c,m,g){var x=1/(t-n),S=1/(o-c),P=1/(m-g);return r[0]=-2*x,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*S,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*P,r[11]=0,r[12]=(t+n)*x,r[13]=(c+o)*S,r[14]=(g+m)*P,r[15]=1,r},T.aQ=hh,T.aR=class extends fe{},T.aS=xc,T.aT=class extends be{},T.aU=hc,T.aV=function(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))},T.aW=yh,T.aX=rn,T.aY=Ni,T.aZ=class extends _t{},T.a_=function(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]&&r[4]===t[4]&&r[5]===t[5]&&r[6]===t[6]&&r[7]===t[7]&&r[8]===t[8]&&r[9]===t[9]&&r[10]===t[10]&&r[11]===t[11]&&r[12]===t[12]&&r[13]===t[13]&&r[14]===t[14]&&r[15]===t[15]},T.aa=function(r){const t={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((n,o,c,m)=>{const g=c||m;return t[o]=!g||g.toLowerCase(),""})),t["max-age"]){const n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t},T.ab=function(r,t){const n=[];for(const o in r)o in t||n.push(o);return n},T.ac=Je,T.ad=function(r,t,n){var o=Math.sin(n),c=Math.cos(n),m=t[0],g=t[1],x=t[2],S=t[3],P=t[4],z=t[5],L=t[6],O=t[7];return t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=m*c+P*o,r[1]=g*c+z*o,r[2]=x*c+L*o,r[3]=S*c+O*o,r[4]=P*c-m*o,r[5]=z*c-g*o,r[6]=L*c-x*o,r[7]=O*c-S*o,r},T.ae=function(r){var t=new mu(16);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t},T.af=dh,T.ag=function(r,t){let n=0,o=0;if(r.kind==="constant")o=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:c,minZoom:m,maxZoom:g}=r,x=c?Je(kn.interpolationFactor(c,t,m,g),0,1):0;r.kind==="camera"?o=on.number(r.minSize,r.maxSize,x):n=x}return{uSizeT:n,uSize:o}},T.ai=function(r,{uSize:t,uSizeT:n},{lowerSize:o,upperSize:c}){return r.kind==="source"?o/Rs:r.kind==="composite"?on.number(o/Rs,c/Rs,n):t},T.aj=bu,T.ak=function(r,t,n,o){const c=t.y-r.y,m=t.x-r.x,g=o.y-n.y,x=o.x-n.x,S=g*m-x*c;if(S===0)return null;const P=(x*(r.y-n.y)-g*(r.x-n.x))/S;return new Y(r.x+P*m,r.y+P*c)},T.al=Ot,T.am=hd,T.an=ch,T.ao=function(r){let t=1/0,n=1/0,o=-1/0,c=-1/0;for(const m of r)t=Math.min(t,m.x),n=Math.min(n,m.y),o=Math.max(o,m.x),c=Math.max(c,m.y);return[t,n,o,c]},T.ap=Kr,T.ar=Mc,T.as=function(r,t){var n=t[0],o=t[1],c=t[2],m=t[3],g=t[4],x=t[5],S=t[6],P=t[7],z=t[8],L=t[9],O=t[10],V=t[11],q=t[12],K=t[13],re=t[14],oe=t[15],we=n*x-o*g,de=n*S-c*g,_e=n*P-m*g,Ae=o*S-c*x,Ve=o*P-m*x,dt=c*P-m*S,Lt=z*K-L*q,ht=z*re-O*q,lt=z*oe-V*q,kt=L*re-O*K,vt=L*oe-V*K,yt=O*oe-V*re,Be=we*yt-de*vt+_e*kt+Ae*lt-Ve*ht+dt*Lt;return Be?(r[0]=(x*yt-S*vt+P*kt)*(Be=1/Be),r[1]=(c*vt-o*yt-m*kt)*Be,r[2]=(K*dt-re*Ve+oe*Ae)*Be,r[3]=(O*Ve-L*dt-V*Ae)*Be,r[4]=(S*lt-g*yt-P*ht)*Be,r[5]=(n*yt-c*lt+m*ht)*Be,r[6]=(re*_e-q*dt-oe*de)*Be,r[7]=(z*dt-O*_e+V*de)*Be,r[8]=(g*vt-x*lt+P*Lt)*Be,r[9]=(o*lt-n*vt-m*Lt)*Be,r[10]=(q*Ve-K*_e+oe*we)*Be,r[11]=(L*_e-z*Ve-V*we)*Be,r[12]=(x*ht-g*kt-S*Lt)*Be,r[13]=(n*kt-o*ht+c*Lt)*Be,r[14]=(K*de-q*Ae-re*we)*Be,r[15]=(z*Ae-L*de+O*we)*Be,r):null},T.at=Vf,T.au=Pc,T.av=Uf,T.aw=function(){const r={},t=Ee.$version;for(const n in Ee.$root){const o=Ee.$root[n];if(o.required){let c=null;c=n==="version"?t:o.type==="array"?[]:{},c!=null&&(r[n]=c)}}return r},T.ax=as,T.ay=or,T.az=function(r){r=r.slice();const t=Object.create(null);for(let n=0;n<r.length;n++)t[r[n].id]=r[n];for(let n=0;n<r.length;n++)"ref"in r[n]&&(r[n]=co(r[n],t[r[n].ref]));return r},T.b=$t,T.b0=function(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},T.b1=function(r,t,n){return r[0]=t[0]*n[0],r[1]=t[1]*n[1],r[2]=t[2]*n[2],r[3]=t[3]*n[3],r},T.b2=function(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]*t[3]},T.b3=He,T.b4=qe,T.b5=ae,T.b6=function(r,t,n,o,c){var m,g=1/Math.tan(t/2);return r[0]=g/n,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=g,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,c!=null&&c!==1/0?(r[10]=(c+o)*(m=1/(o-c)),r[14]=2*c*o*m):(r[10]=-1,r[14]=-2*o),r},T.b7=function(r,t,n){var o=Math.sin(n),c=Math.cos(n),m=t[4],g=t[5],x=t[6],S=t[7],P=t[8],z=t[9],L=t[10],O=t[11];return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[4]=m*c+P*o,r[5]=g*c+z*o,r[6]=x*c+L*o,r[7]=S*c+O*o,r[8]=P*c-m*o,r[9]=z*c-g*o,r[10]=L*c-x*o,r[11]=O*c-S*o,r},T.b8=Ue,T.b9=et,T.bA=Aa,T.bB=function(r){return r.message===Ne},T.bC=Ka,T.bD=Ar,T.ba=function(r){return r*Math.PI/180},T.bb=function(r,t){const{x:n,y:o}=Ce.fromLngLat(t);return!(r<0||r>25||o<0||o>=1||n<0||n>=1)},T.bc=function(r,t){return r[0]=t[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=t[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=t[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},T.bd=class extends A{},T.be=a,T.bf=My,T.bh=ur,T.bi=function(r,t){Yt.REGISTERED_PROTOCOLS[r]=t},T.bj=function(r){delete Yt.REGISTERED_PROTOCOLS[r]},T.bk=function(r,t){const n={};for(let c=0;c<r.length;c++){const m=t&&t[r[c].id]||Ku(r[c]);t&&(t[r[c].id]=m);let g=n[m];g||(g=n[m]=[]),g.push(r[c])}const o=[];for(const c in n)o.push(n[c]);return o},T.bl=mt,T.bm=dn,T.bn=ge,T.bo=Md,T.bp=function(r){r.bucket.createArrays(),r.bucket.tilePixelRatio=un/(512*r.bucket.overscaling),r.bucket.compareText={},r.bucket.iconsNeedLinear=!1;const t=r.bucket.layers[0],n=t.layout,o=t._unevaluatedLayout._values,c={layoutIconSize:o["icon-size"].possiblyEvaluate(new lr(r.bucket.zoom+1),r.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new lr(r.bucket.zoom+1),r.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new lr(18))};if(r.bucket.textSizeData.kind==="composite"){const{minZoom:P,maxZoom:z}=r.bucket.textSizeData;c.compositeTextSizes=[o["text-size"].possiblyEvaluate(new lr(P),r.canonical),o["text-size"].possiblyEvaluate(new lr(z),r.canonical)]}if(r.bucket.iconSizeData.kind==="composite"){const{minZoom:P,maxZoom:z}=r.bucket.iconSizeData;c.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new lr(P),r.canonical),o["icon-size"].possiblyEvaluate(new lr(z),r.canonical)]}const m=n.get("text-line-height")*Kr,g=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",x=n.get("text-keep-upright"),S=n.get("text-size");for(const P of r.bucket.features){const z=n.get("text-font").evaluate(P,{},r.canonical).join(","),L=S.evaluate(P,{},r.canonical),O=c.layoutTextSize.evaluate(P,{},r.canonical),V=c.layoutIconSize.evaluate(P,{},r.canonical),q={horizontal:{},vertical:void 0},K=P.text;let re,oe=[0,0];if(K){const _e=K.toString(),Ae=n.get("text-letter-spacing").evaluate(P,{},r.canonical)*Kr,Ve=od(_e)?Ae:0,dt=n.get("text-anchor").evaluate(P,{},r.canonical),Lt=rg(t,P,r.canonical);if(!Lt){const vt=n.get("text-radial-offset").evaluate(P,{},r.canonical);oe=vt?tg(dt,[vt*Kr,jf]):n.get("text-offset").evaluate(P,{},r.canonical).map((yt=>yt*Kr))}let ht=g?"center":n.get("text-justify").evaluate(P,{},r.canonical);const lt=n.get("symbol-placement")==="point"?n.get("text-max-width").evaluate(P,{},r.canonical)*Kr:1/0,kt=()=>{r.bucket.allowVerticalPlacement&&ec(_e)&&(q.vertical=Ec(K,r.glyphMap,r.glyphPositions,r.imagePositions,z,lt,m,dt,"left",Ve,oe,T.ah.vertical,!0,O,L))};if(!g&&Lt){const vt=new Set;if(ht==="auto")for(let Be=0;Be<Lt.values.length;Be+=2)vt.add(Vf(Lt.values[Be]));else vt.add(ht);let yt=!1;for(const Be of vt)if(!q.horizontal[Be])if(yt)q.horizontal[Be]=q.horizontal[0];else{const It=Ec(K,r.glyphMap,r.glyphPositions,r.imagePositions,z,lt,m,"center",Be,Ve,oe,T.ah.horizontal,!1,O,L);It&&(q.horizontal[Be]=It,yt=It.positionedLines.length===1)}kt()}else{ht==="auto"&&(ht=Vf(dt));const vt=Ec(K,r.glyphMap,r.glyphPositions,r.imagePositions,z,lt,m,dt,ht,Ve,oe,T.ah.horizontal,!1,O,L);vt&&(q.horizontal[ht]=vt),kt(),ec(_e)&&g&&x&&(q.vertical=Ec(K,r.glyphMap,r.glyphPositions,r.imagePositions,z,lt,m,dt,ht,Ve,oe,T.ah.vertical,!1,O,L))}}let we=!1;if(P.icon&&P.icon.name){const _e=r.imageMap[P.icon.name];_e&&(re=Go(r.imagePositions[P.icon.name],n.get("icon-offset").evaluate(P,{},r.canonical),n.get("icon-anchor").evaluate(P,{},r.canonical)),we=!!_e.sdf,r.bucket.sdfIcons===void 0?r.bucket.sdfIcons=we:r.bucket.sdfIcons!==we&&Zt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(_e.pixelRatio!==r.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(r.bucket.iconsNeedLinear=!0))}const de=ig(q.horizontal)||q.vertical;r.bucket.iconsInText=!!de&&de.iconsInText,(de||re)&&Py(r.bucket,P,q,re,r.imageMap,c,O,V,oe,we,r.canonical)}r.showCollisionBoxes&&r.bucket.generateCollisionDebugBuffers()},T.bq=Vi,T.br=wh,T.bs=gs,T.bt=Vo,T.bu=no,T.bv=class{constructor(r){this._marks={start:[r.url,"start"].join("#"),end:[r.url,"end"].join("#"),measure:r.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let r=performance.getEntriesByName(this._marks.measure);return r.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),r=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),r}},T.bw=function(r,t,n,o,c){return h(this,void 0,void 0,(function*(){if(ze())try{return yield Pt(r,t,n,o,c)}catch{}return(function(m,g,x,S,P){const z=m.width,L=m.height;ft&&xe||(ft=new OffscreenCanvas(z,L),xe=ft.getContext("2d",{willReadFrequently:!0})),ft.width=z,ft.height=L,xe.drawImage(m,0,0,z,L);const O=xe.getImageData(g,x,S,P);return xe.clearRect(0,0,z,L),O.data})(r,t,n,o,c)}))},T.bx=Mt,T.by=W,T.bz=ue,T.c=Xt,T.d=r=>h(void 0,void 0,void 0,(function*(){if(r.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(r)],{type:"image/png"});try{return createImageBitmap(t)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),T.e=je,T.f=r=>new Promise(((t,n)=>{const o=new Image;o.onload=()=>{t(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame((()=>{o.src=ot}))},o.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const c=new Blob([new Uint8Array(r)],{type:"image/png"});o.src=r.byteLength?URL.createObjectURL(c):ot})),T.g=nr,T.h=(r,t)=>Ir(je(r,{type:"json"}),t),T.i=Mr,T.j=bs,T.k=Yi,T.l=(r,t)=>Ir(je(r,{type:"arrayBuffer"}),t),T.m=Ir,T.n=function(r){return new no(r).readFields(zl,[])},T.o=Il,T.p=Tc,T.q=f,T.r=Ju,T.s=mn,T.t=cu,T.u=Js,T.v=Ee,T.w=Zt,T.x=function([r,t,n]){return t+=90,t*=Math.PI/180,n*=Math.PI/180,{x:r*Math.cos(t)*Math.sin(n),y:r*Math.sin(t)*Math.sin(n),z:r*Math.cos(n)}},T.y=on,T.z=lr})),D("worker",["./shared"],(function(T){class h{constructor(j){this.keyCache={},j&&this.replace(j)}replace(j){this._layerConfigs={},this._layers={},this.update(j,[])}update(j,N){for(const ee of j){this._layerConfigs[ee.id]=ee;const he=this._layers[ee.id]=T.aA(ee);he._featureFilter=T.a7(he.filter),this.keyCache[ee.id]&&delete this.keyCache[ee.id]}for(const ee of N)delete this.keyCache[ee],delete this._layerConfigs[ee],delete this._layers[ee];this.familiesBySource={};const H=T.bk(Object.values(this._layerConfigs),this.keyCache);for(const ee of H){const he=ee.map((ke=>this._layers[ke.id])),me=he[0];if(me.visibility==="none")continue;const ve=me.source||"";let le=this.familiesBySource[ve];le||(le=this.familiesBySource[ve]={});const Me=me.sourceLayer||"_geojsonTileLayer";let Oe=le[Me];Oe||(Oe=le[Me]=[]),Oe.push(he)}}}class W{constructor(j){const N={},H=[];for(const ve in j){const le=j[ve],Me=N[ve]={};for(const Oe in le){const ke=le[+Oe];if(!ke||ke.bitmap.width===0||ke.bitmap.height===0)continue;const Ye={x:0,y:0,w:ke.bitmap.width+2,h:ke.bitmap.height+2};H.push(Ye),Me[Oe]={rect:Ye,metrics:ke.metrics}}}const{w:ee,h:he}=T.p(H),me=new T.o({width:ee||1,height:he||1});for(const ve in j){const le=j[ve];for(const Me in le){const Oe=le[+Me];if(!Oe||Oe.bitmap.width===0||Oe.bitmap.height===0)continue;const ke=N[ve][Me].rect;T.o.copy(Oe.bitmap,me,{x:0,y:0},{x:ke.x+1,y:ke.y+1},Oe.bitmap)}}this.image=me,this.positions=N}}T.bl("GlyphAtlas",W);class ue{constructor(j){this.tileID=new T.S(j.tileID.overscaledZ,j.tileID.wrap,j.tileID.canonical.z,j.tileID.canonical.x,j.tileID.canonical.y),this.uid=j.uid,this.zoom=j.zoom,this.pixelRatio=j.pixelRatio,this.tileSize=j.tileSize,this.source=j.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=j.showCollisionBoxes,this.collectResourceTiming=!!j.collectResourceTiming,this.returnDependencies=!!j.returnDependencies,this.promoteId=j.promoteId,this.inFlightDependencies=[]}parse(j,N,H,ee){return T._(this,void 0,void 0,(function*(){this.status="parsing",this.data=j,this.collisionBoxArray=new T.a5;const he=new T.bm(Object.keys(j.layers).sort()),me=new T.bn(this.tileID,this.promoteId);me.bucketLayerIDs=[];const ve={},le={featureIndex:me,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:H},Me=N.familiesBySource[this.source];for(const tr in Me){const br=j.layers[tr];if(!br)continue;br.version===1&&T.w(`Vector tile source "${this.source}" layer "${tr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const jr=he.encode(tr),yn=[];for(let Sn=0;Sn<br.length;Sn++){const $n=br.feature(Sn),po=me.getId($n,tr);yn.push({feature:$n,id:po,index:Sn,sourceLayerIndex:jr})}for(const Sn of Me[tr]){const $n=Sn[0];$n.source!==this.source&&T.w(`layer.source = ${$n.source} does not equal this.source = ${this.source}`),$n.minzoom&&this.zoom<Math.floor($n.minzoom)||$n.maxzoom&&this.zoom>=$n.maxzoom||$n.visibility!=="none"&&(ne(Sn,this.zoom,H),(ve[$n.id]=$n.createBucket({index:me.bucketLayerIDs.length,layers:Sn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:jr,sourceID:this.source})).populate(yn,le,this.tileID.canonical),me.bucketLayerIDs.push(Sn.map((po=>po.id))))}}const Oe=T.aF(le.glyphDependencies,(tr=>Object.keys(tr).map(Number)));this.inFlightDependencies.forEach((tr=>tr==null?void 0:tr.abort())),this.inFlightDependencies=[];let ke=Promise.resolve({});if(Object.keys(Oe).length){const tr=new AbortController;this.inFlightDependencies.push(tr),ke=ee.sendAsync({type:"GG",data:{stacks:Oe,source:this.source,tileID:this.tileID,type:"glyphs"}},tr)}const Ye=Object.keys(le.iconDependencies);let wt=Promise.resolve({});if(Ye.length){const tr=new AbortController;this.inFlightDependencies.push(tr),wt=ee.sendAsync({type:"GI",data:{icons:Ye,source:this.source,tileID:this.tileID,type:"icons"}},tr)}const Ct=Object.keys(le.patternDependencies);let fr=Promise.resolve({});if(Ct.length){const tr=new AbortController;this.inFlightDependencies.push(tr),fr=ee.sendAsync({type:"GI",data:{icons:Ct,source:this.source,tileID:this.tileID,type:"patterns"}},tr)}const[Gt,mr,Wt]=yield Promise.all([ke,wt,fr]),sn=new W(Gt),Gr=new T.bo(mr,Wt);for(const tr in ve){const br=ve[tr];br instanceof T.a6?(ne(br.layers,this.zoom,H),T.bp({bucket:br,glyphMap:Gt,glyphPositions:sn.positions,imageMap:mr,imagePositions:Gr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):br.hasPattern&&(br instanceof T.bq||br instanceof T.br||br instanceof T.bs)&&(ne(br.layers,this.zoom,H),br.addFeatures(le,this.tileID.canonical,Gr.patternPositions))}return this.status="done",{buckets:Object.values(ve).filter((tr=>!tr.isEmpty())),featureIndex:me,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:sn.image,imageAtlas:Gr,glyphMap:this.returnDependencies?Gt:null,iconMap:this.returnDependencies?mr:null,glyphPositions:this.returnDependencies?sn.positions:null}}))}}function ne(ie,j,N){const H=new T.z(j);for(const ee of ie)ee.recalculate(H,N)}class Y{constructor(j,N,H){this.actor=j,this.layerIndex=N,this.availableImages=H,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(j,N){return T._(this,void 0,void 0,(function*(){const H=yield T.l(j.request,N);try{return{vectorTile:new T.bt.VectorTile(new T.bu(H.data)),rawData:H.data,cacheControl:H.cacheControl,expires:H.expires}}catch(ee){const he=new Uint8Array(H.data);let me=`Unable to parse the tile at ${j.request.url}, `;throw me+=he[0]===31&&he[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ee.message}`,new Error(me)}}))}loadTile(j){return T._(this,void 0,void 0,(function*(){const N=j.uid,H=!!(j&&j.request&&j.request.collectResourceTiming)&&new T.bv(j.request),ee=new ue(j);this.loading[N]=ee;const he=new AbortController;ee.abort=he;try{const me=yield this.loadVectorTile(j,he);if(delete this.loading[N],!me)return null;const ve=me.rawData,le={};me.expires&&(le.expires=me.expires),me.cacheControl&&(le.cacheControl=me.cacheControl);const Me={};if(H){const ke=H.finish();ke&&(Me.resourceTiming=JSON.parse(JSON.stringify(ke)))}ee.vectorTile=me.vectorTile;const Oe=ee.parse(me.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[N]=ee,this.fetching[N]={rawTileData:ve,cacheControl:le,resourceTiming:Me};try{const ke=yield Oe;return T.e({rawTileData:ve.slice(0)},ke,le,Me)}finally{delete this.fetching[N]}}catch(me){throw delete this.loading[N],ee.status="done",this.loaded[N]=ee,me}}))}reloadTile(j){return T._(this,void 0,void 0,(function*(){const N=j.uid;if(!this.loaded||!this.loaded[N])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const H=this.loaded[N];if(H.showCollisionBoxes=j.showCollisionBoxes,H.status==="parsing"){const ee=yield H.parse(H.vectorTile,this.layerIndex,this.availableImages,this.actor);let he;if(this.fetching[N]){const{rawTileData:me,cacheControl:ve,resourceTiming:le}=this.fetching[N];delete this.fetching[N],he=T.e({rawTileData:me.slice(0)},ee,ve,le)}else he=ee;return he}if(H.status==="done"&&H.vectorTile)return H.parse(H.vectorTile,this.layerIndex,this.availableImages,this.actor)}))}abortTile(j){return T._(this,void 0,void 0,(function*(){const N=this.loading,H=j.uid;N&&N[H]&&N[H].abort&&(N[H].abort.abort(),delete N[H])}))}removeTile(j){return T._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[j.uid]&&delete this.loaded[j.uid]}))}}class Z{constructor(){this.loaded={}}loadTile(j){return T._(this,void 0,void 0,(function*(){const{uid:N,encoding:H,rawImageData:ee,redFactor:he,greenFactor:me,blueFactor:ve,baseShift:le}=j,Me=ee.width+2,Oe=ee.height+2,ke=T.b(ee)?new T.R({width:Me,height:Oe},yield T.bw(ee,-1,-1,Me,Oe)):ee,Ye=new T.bx(N,ke,H,he,me,ve,le);return this.loaded=this.loaded||{},this.loaded[N]=Ye,Ye}))}removeTile(j){const N=this.loaded,H=j.uid;N&&N[H]&&delete N[H]}}function Ie(ie,j){if(ie.length!==0){Re(ie[0],j);for(var N=1;N<ie.length;N++)Re(ie[N],!j)}}function Re(ie,j){for(var N=0,H=0,ee=0,he=ie.length,me=he-1;ee<he;me=ee++){var ve=(ie[ee][0]-ie[me][0])*(ie[me][1]+ie[ee][1]),le=N+ve;H+=Math.abs(N)>=Math.abs(ve)?N-le+ve:ve-le+N,N=le}N+H>=0!=!!j&&ie.reverse()}var Pe=T.by((function ie(j,N){var H,ee=j&&j.type;if(ee==="FeatureCollection")for(H=0;H<j.features.length;H++)ie(j.features[H],N);else if(ee==="GeometryCollection")for(H=0;H<j.geometries.length;H++)ie(j.geometries[H],N);else if(ee==="Feature")ie(j.geometry,N);else if(ee==="Polygon")Ie(j.coordinates,N);else if(ee==="MultiPolygon")for(H=0;H<j.coordinates.length;H++)Ie(j.coordinates[H],N);return j}));const Le=T.bt.VectorTileFeature.prototype.toGeoJSON;var De={exports:{}},ze=T.bz,Ue=T.bt.VectorTileFeature,et=Je;function Je(ie,j){this.options=j||{},this.features=ie,this.length=ie.length}function He(ie,j){this.id=typeof ie.id=="number"?ie.id:void 0,this.type=ie.type,this.rawGeometry=ie.type===1?[ie.geometry]:ie.geometry,this.properties=ie.tags,this.extent=j||4096}Je.prototype.feature=function(ie){return new He(this.features[ie],this.options.extent)},He.prototype.loadGeometry=function(){var ie=this.rawGeometry;this.geometry=[];for(var j=0;j<ie.length;j++){for(var N=ie[j],H=[],ee=0;ee<N.length;ee++)H.push(new ze(N[ee][0],N[ee][1]));this.geometry.push(H)}return this.geometry},He.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ie=this.geometry,j=1/0,N=-1/0,H=1/0,ee=-1/0,he=0;he<ie.length;he++)for(var me=ie[he],ve=0;ve<me.length;ve++){var le=me[ve];j=Math.min(j,le.x),N=Math.max(N,le.x),H=Math.min(H,le.y),ee=Math.max(ee,le.y)}return[j,H,N,ee]},He.prototype.toGeoJSON=Ue.prototype.toGeoJSON;var je=T.bA,pt=et;function $e(ie){var j=new je;return(function(N,H){for(var ee in N.layers)H.writeMessage(3,ar,N.layers[ee])})(ie,j),j.finish()}function ar(ie,j){var N;j.writeVarintField(15,ie.version||1),j.writeStringField(1,ie.name||""),j.writeVarintField(5,ie.extent||4096);var H={keys:[],values:[],keycache:{},valuecache:{}};for(N=0;N<ie.length;N++)H.feature=ie.feature(N),j.writeMessage(2,xt,H);var ee=H.keys;for(N=0;N<ee.length;N++)j.writeStringField(3,ee[N]);var he=H.values;for(N=0;N<he.length;N++)j.writeMessage(4,Pr,he[N])}function xt(ie,j){var N=ie.feature;N.id!==void 0&&j.writeVarintField(1,N.id),j.writeMessage(2,wr,ie),j.writeVarintField(3,N.type),j.writeMessage(4,Mr,N)}function wr(ie,j){var N=ie.feature,H=ie.keys,ee=ie.values,he=ie.keycache,me=ie.valuecache;for(var ve in N.properties){var le=N.properties[ve],Me=he[ve];if(le!==null){Me===void 0&&(H.push(ve),he[ve]=Me=H.length-1),j.writeVarint(Me);var Oe=typeof le;Oe!=="string"&&Oe!=="boolean"&&Oe!=="number"&&(le=JSON.stringify(le));var ke=Oe+":"+le,Ye=me[ke];Ye===void 0&&(ee.push(le),me[ke]=Ye=ee.length-1),j.writeVarint(Ye)}}}function Zt(ie,j){return(j<<3)+(7&ie)}function Nt(ie){return ie<<1^ie>>31}function Mr(ie,j){for(var N=ie.loadGeometry(),H=ie.type,ee=0,he=0,me=N.length,ve=0;ve<me;ve++){var le=N[ve],Me=1;H===1&&(Me=le.length),j.writeVarint(Zt(1,Me));for(var Oe=H===3?le.length-1:le.length,ke=0;ke<Oe;ke++){ke===1&&H!==1&&j.writeVarint(Zt(2,Oe-1));var Ye=le[ke].x-ee,wt=le[ke].y-he;j.writeVarint(Nt(Ye)),j.writeVarint(Nt(wt)),ee+=Ye,he+=wt}H===3&&j.writeVarint(Zt(7,1))}}function Pr(ie,j){var N=typeof ie;N==="string"?j.writeStringField(1,ie):N==="boolean"?j.writeBooleanField(7,ie):N==="number"&&(ie%1!=0?j.writeDoubleField(3,ie):ie<0?j.writeSVarintField(6,ie):j.writeVarintField(5,ie))}De.exports=$e,De.exports.fromVectorTileJs=$e,De.exports.fromGeojsonVt=function(ie,j){j=j||{};var N={};for(var H in ie)N[H]=new pt(ie[H].features,j),N[H].name=H,N[H].version=j.version,N[H].extent=j.extent;return $e({layers:N})},De.exports.GeoJSONWrapper=pt;var $t=T.by(De.exports);const ot={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ie=>ie},Pt=Math.fround||(ft=new Float32Array(1),ie=>(ft[0]=+ie,ft[0]));var ft;const xe=3,Ne=5,Xt=6;class Yt{constructor(j){this.options=Object.assign(Object.create(ot),j),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(j){const{log:N,minZoom:H,maxZoom:ee}=this.options;N&&console.time("total time");const he=`prepare ${j.length} points`;N&&console.time(he),this.points=j;const me=[];for(let le=0;le<j.length;le++){const Me=j[le];if(!Me.geometry)continue;const[Oe,ke]=Me.geometry.coordinates,Ye=Pt(ur(Oe)),wt=Pt(or(ke));me.push(Ye,wt,1/0,le,-1,1),this.options.reduce&&me.push(0)}let ve=this.trees[ee+1]=this._createTree(me);N&&console.timeEnd(he);for(let le=ee;le>=H;le--){const Me=+Date.now();ve=this.trees[le]=this._createTree(this._cluster(ve,le)),N&&console.log("z%d: %d clusters in %dms",le,ve.numItems,+Date.now()-Me)}return N&&console.timeEnd("total time"),this}getClusters(j,N){let H=((j[0]+180)%360+360)%360-180;const ee=Math.max(-90,Math.min(90,j[1]));let he=j[2]===180?180:((j[2]+180)%360+360)%360-180;const me=Math.max(-90,Math.min(90,j[3]));if(j[2]-j[0]>=360)H=-180,he=180;else if(H>he){const ke=this.getClusters([H,ee,180,me],N),Ye=this.getClusters([-180,ee,he,me],N);return ke.concat(Ye)}const ve=this.trees[this._limitZoom(N)],le=ve.range(ur(H),or(me),ur(he),or(ee)),Me=ve.data,Oe=[];for(const ke of le){const Ye=this.stride*ke;Oe.push(Me[Ye+Ne]>1?nr(Me,Ye,this.clusterProps):this.points[Me[Ye+xe]])}return Oe}getChildren(j){const N=this._getOriginId(j),H=this._getOriginZoom(j),ee="No cluster with the specified id.",he=this.trees[H];if(!he)throw new Error(ee);const me=he.data;if(N*this.stride>=me.length)throw new Error(ee);const ve=this.options.radius/(this.options.extent*Math.pow(2,H-1)),le=he.within(me[N*this.stride],me[N*this.stride+1],ve),Me=[];for(const Oe of le){const ke=Oe*this.stride;me[ke+4]===j&&Me.push(me[ke+Ne]>1?nr(me,ke,this.clusterProps):this.points[me[ke+xe]])}if(Me.length===0)throw new Error(ee);return Me}getLeaves(j,N,H){const ee=[];return this._appendLeaves(ee,j,N=N||10,H=H||0,0),ee}getTile(j,N,H){const ee=this.trees[this._limitZoom(j)],he=Math.pow(2,j),{extent:me,radius:ve}=this.options,le=ve/me,Me=(H-le)/he,Oe=(H+1+le)/he,ke={features:[]};return this._addTileFeatures(ee.range((N-le)/he,Me,(N+1+le)/he,Oe),ee.data,N,H,he,ke),N===0&&this._addTileFeatures(ee.range(1-le/he,Me,1,Oe),ee.data,he,H,he,ke),N===he-1&&this._addTileFeatures(ee.range(0,Me,le/he,Oe),ee.data,-1,H,he,ke),ke.features.length?ke:null}getClusterExpansionZoom(j){let N=this._getOriginZoom(j)-1;for(;N<=this.options.maxZoom;){const H=this.getChildren(j);if(N++,H.length!==1)break;j=H[0].properties.cluster_id}return N}_appendLeaves(j,N,H,ee,he){const me=this.getChildren(N);for(const ve of me){const le=ve.properties;if(le&&le.cluster?he+le.point_count<=ee?he+=le.point_count:he=this._appendLeaves(j,le.cluster_id,H,ee,he):he<ee?he++:j.push(ve),j.length===H)break}return he}_createTree(j){const N=new T.av(j.length/this.stride|0,this.options.nodeSize,Float32Array);for(let H=0;H<j.length;H+=this.stride)N.add(j[H],j[H+1]);return N.finish(),N.data=j,N}_addTileFeatures(j,N,H,ee,he,me){for(const ve of j){const le=ve*this.stride,Me=N[le+Ne]>1;let Oe,ke,Ye;if(Me)Oe=cr(N,le,this.clusterProps),ke=N[le],Ye=N[le+1];else{const fr=this.points[N[le+xe]];Oe=fr.properties;const[Gt,mr]=fr.geometry.coordinates;ke=ur(Gt),Ye=or(mr)}const wt={type:1,geometry:[[Math.round(this.options.extent*(ke*he-H)),Math.round(this.options.extent*(Ye*he-ee))]],tags:Oe};let Ct;Ct=Me||this.options.generateId?N[le+xe]:this.points[N[le+xe]].id,Ct!==void 0&&(wt.id=Ct),me.features.push(wt)}}_limitZoom(j){return Math.max(this.options.minZoom,Math.min(Math.floor(+j),this.options.maxZoom+1))}_cluster(j,N){const{radius:H,extent:ee,reduce:he,minPoints:me}=this.options,ve=H/(ee*Math.pow(2,N)),le=j.data,Me=[],Oe=this.stride;for(let ke=0;ke<le.length;ke+=Oe){if(le[ke+2]<=N)continue;le[ke+2]=N;const Ye=le[ke],wt=le[ke+1],Ct=j.within(le[ke],le[ke+1],ve),fr=le[ke+Ne];let Gt=fr;for(const mr of Ct){const Wt=mr*Oe;le[Wt+2]>N&&(Gt+=le[Wt+Ne])}if(Gt>fr&&Gt>=me){let mr,Wt=Ye*fr,sn=wt*fr,Gr=-1;const tr=((ke/Oe|0)<<5)+(N+1)+this.points.length;for(const br of Ct){const jr=br*Oe;if(le[jr+2]<=N)continue;le[jr+2]=N;const yn=le[jr+Ne];Wt+=le[jr]*yn,sn+=le[jr+1]*yn,le[jr+4]=tr,he&&(mr||(mr=this._map(le,ke,!0),Gr=this.clusterProps.length,this.clusterProps.push(mr)),he(mr,this._map(le,jr)))}le[ke+4]=tr,Me.push(Wt/Gt,sn/Gt,1/0,tr,-1,Gt),he&&Me.push(Gr)}else{for(let mr=0;mr<Oe;mr++)Me.push(le[ke+mr]);if(Gt>1)for(const mr of Ct){const Wt=mr*Oe;if(!(le[Wt+2]<=N)){le[Wt+2]=N;for(let sn=0;sn<Oe;sn++)Me.push(le[Wt+sn])}}}}return Me}_getOriginId(j){return j-this.points.length>>5}_getOriginZoom(j){return(j-this.points.length)%32}_map(j,N,H){if(j[N+Ne]>1){const me=this.clusterProps[j[N+Xt]];return H?Object.assign({},me):me}const ee=this.points[j[N+xe]].properties,he=this.options.map(ee);return H&&he===ee?Object.assign({},he):he}}function nr(ie,j,N){return{type:"Feature",id:ie[j+xe],properties:cr(ie,j,N),geometry:{type:"Point",coordinates:[(H=ie[j],360*(H-.5)),Ir(ie[j+1])]}};var H}function cr(ie,j,N){const H=ie[j+Ne],ee=H>=1e4?`${Math.round(H/1e3)}k`:H>=1e3?Math.round(H/100)/10+"k":H,he=ie[j+Xt],me=he===-1?{}:Object.assign({},N[he]);return Object.assign(me,{cluster:!0,cluster_id:ie[j+xe],point_count:H,point_count_abbreviated:ee})}function ur(ie){return ie/360+.5}function or(ie){const j=Math.sin(ie*Math.PI/180),N=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return N<0?0:N>1?1:N}function Ir(ie){const j=(180-360*ie)*Math.PI/180;return 360*Math.atan(Math.exp(j))/Math.PI-90}function mn(ie,j,N,H){let ee=H;const he=j+(N-j>>1);let me,ve=N-j;const le=ie[j],Me=ie[j+1],Oe=ie[N],ke=ie[N+1];for(let Ye=j+3;Ye<N;Ye+=3){const wt=pa(ie[Ye],ie[Ye+1],le,Me,Oe,ke);if(wt>ee)me=Ye,ee=wt;else if(wt===ee){const Ct=Math.abs(Ye-he);Ct<ve&&(me=Ye,ve=Ct)}}ee>H&&(me-j>3&&mn(ie,j,me,H),ie[me+2]=ee,N-me>3&&mn(ie,me,N,H))}function pa(ie,j,N,H,ee,he){let me=ee-N,ve=he-H;if(me!==0||ve!==0){const le=((ie-N)*me+(j-H)*ve)/(me*me+ve*ve);le>1?(N=ee,H=he):le>0&&(N+=me*le,H+=ve*le)}return me=ie-N,ve=j-H,me*me+ve*ve}function ws(ie,j,N,H){const ee={id:ie??null,type:j,geometry:N,tags:H,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(j==="Point"||j==="MultiPoint"||j==="LineString")Yi(ee,N);else if(j==="Polygon")Yi(ee,N[0]);else if(j==="MultiLineString")for(const he of N)Yi(ee,he);else if(j==="MultiPolygon")for(const he of N)Yi(ee,he[0]);return ee}function Yi(ie,j){for(let N=0;N<j.length;N+=3)ie.minX=Math.min(ie.minX,j[N]),ie.minY=Math.min(ie.minY,j[N+1]),ie.maxX=Math.max(ie.maxX,j[N]),ie.maxY=Math.max(ie.maxY,j[N+1])}function bs(ie,j,N,H){if(!j.geometry)return;const ee=j.geometry.coordinates;if(ee&&ee.length===0)return;const he=j.geometry.type,me=Math.pow(N.tolerance/((1<<N.maxZoom)*N.extent),2);let ve=[],le=j.id;if(N.promoteId?le=j.properties[N.promoteId]:N.generateId&&(le=H||0),he==="Point")Ra(ee,ve);else if(he==="MultiPoint")for(const Me of ee)Ra(Me,ve);else if(he==="LineString")Ee(ee,ve,me,!1);else if(he==="MultiLineString"){if(N.lineMetrics){for(const Me of ee)ve=[],Ee(Me,ve,me,!1),ie.push(ws(le,"LineString",ve,j.properties));return}Ns(ee,ve,me,!1)}else if(he==="Polygon")Ns(ee,ve,me,!0);else{if(he!=="MultiPolygon"){if(he==="GeometryCollection"){for(const Me of j.geometry.geometries)bs(ie,{id:le,geometry:Me,properties:j.properties},N,H);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Me of ee){const Oe=[];Ns(Me,Oe,me,!0),ve.push(Oe)}}ie.push(ws(le,he,ve,j.properties))}function Ra(ie,j){j.push(co(ie[0]),pr(ie[1]),0)}function Ee(ie,j,N,H){let ee,he,me=0;for(let le=0;le<ie.length;le++){const Me=co(ie[le][0]),Oe=pr(ie[le][1]);j.push(Me,Oe,0),le>0&&(me+=H?(ee*Oe-Me*he)/2:Math.sqrt(Math.pow(Me-ee,2)+Math.pow(Oe-he,2))),ee=Me,he=Oe}const ve=j.length-3;j[2]=1,mn(j,0,ve,N),j[ve+2]=1,j.size=Math.abs(me),j.start=0,j.end=j.size}function Ns(ie,j,N,H){for(let ee=0;ee<ie.length;ee++){const he=[];Ee(ie[ee],he,N,H),j.push(he)}}function co(ie){return ie/360+.5}function pr(ie){const j=Math.sin(ie*Math.PI/180),N=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return N<0?0:N>1?1:N}function Rr(ie,j,N,H,ee,he,me,ve){if(H/=j,he>=(N/=j)&&me<H)return ie;if(me<N||he>=H)return null;const le=[];for(const Me of ie){const Oe=Me.geometry;let ke=Me.type;const Ye=ee===0?Me.minX:Me.minY,wt=ee===0?Me.maxX:Me.maxY;if(Ye>=N&&wt<H){le.push(Me);continue}if(wt<N||Ye>=H)continue;let Ct=[];if(ke==="Point"||ke==="MultiPoint")Ss(Oe,Ct,N,H,ee);else if(ke==="LineString")ks(Oe,Ct,N,H,ee,!1,ve.lineMetrics);else if(ke==="MultiLineString")Ba(Oe,Ct,N,H,ee,!1);else if(ke==="Polygon")Ba(Oe,Ct,N,H,ee,!0);else if(ke==="MultiPolygon")for(const fr of Oe){const Gt=[];Ba(fr,Gt,N,H,ee,!0),Gt.length&&Ct.push(Gt)}if(Ct.length){if(ve.lineMetrics&&ke==="LineString"){for(const fr of Ct)le.push(ws(Me.id,ke,fr,Me.tags));continue}ke!=="LineString"&&ke!=="MultiLineString"||(Ct.length===1?(ke="LineString",Ct=Ct[0]):ke="MultiLineString"),ke!=="Point"&&ke!=="MultiPoint"||(ke=Ct.length===3?"Point":"MultiPoint"),le.push(ws(Me.id,ke,Ct,Me.tags))}}return le.length?le:null}function Ss(ie,j,N,H,ee){for(let he=0;he<ie.length;he+=3){const me=ie[he+ee];me>=N&&me<=H&&mi(j,ie[he],ie[he+1],ie[he+2])}}function ks(ie,j,N,H,ee,he,me){let ve=Ts(ie);const le=ee===0?ho:Fa;let Me,Oe,ke=ie.start;for(let Gt=0;Gt<ie.length-3;Gt+=3){const mr=ie[Gt],Wt=ie[Gt+1],sn=ie[Gt+2],Gr=ie[Gt+3],tr=ie[Gt+4],br=ee===0?mr:Wt,jr=ee===0?Gr:tr;let yn=!1;me&&(Me=Math.sqrt(Math.pow(mr-Gr,2)+Math.pow(Wt-tr,2))),br<N?jr>N&&(Oe=le(ve,mr,Wt,Gr,tr,N),me&&(ve.start=ke+Me*Oe)):br>H?jr<H&&(Oe=le(ve,mr,Wt,Gr,tr,H),me&&(ve.start=ke+Me*Oe)):mi(ve,mr,Wt,sn),jr<N&&br>=N&&(Oe=le(ve,mr,Wt,Gr,tr,N),yn=!0),jr>H&&br<=H&&(Oe=le(ve,mr,Wt,Gr,tr,H),yn=!0),!he&&yn&&(me&&(ve.end=ke+Me*Oe),j.push(ve),ve=Ts(ie)),me&&(ke+=Me)}let Ye=ie.length-3;const wt=ie[Ye],Ct=ie[Ye+1],fr=ee===0?wt:Ct;fr>=N&&fr<=H&&mi(ve,wt,Ct,ie[Ye+2]),Ye=ve.length-3,he&&Ye>=3&&(ve[Ye]!==ve[0]||ve[Ye+1]!==ve[1])&&mi(ve,ve[0],ve[1],ve[2]),ve.length&&j.push(ve)}function Ts(ie){const j=[];return j.size=ie.size,j.start=ie.start,j.end=ie.end,j}function Ba(ie,j,N,H,ee,he){for(const me of ie)ks(me,j,N,H,ee,he,!1)}function mi(ie,j,N,H){ie.push(j,N,H)}function ho(ie,j,N,H,ee,he){const me=(he-j)/(H-j);return mi(ie,he,N+(ee-N)*me,1),me}function Fa(ie,j,N,H,ee,he){const me=(he-N)/(ee-N);return mi(ie,j+(H-j)*me,he,1),me}function Ke(ie,j){const N=[];for(let H=0;H<ie.length;H++){const ee=ie[H],he=ee.type;let me;if(he==="Point"||he==="MultiPoint"||he==="LineString")me=Ji(ee.geometry,j);else if(he==="MultiLineString"||he==="Polygon"){me=[];for(const ve of ee.geometry)me.push(Ji(ve,j))}else if(he==="MultiPolygon"){me=[];for(const ve of ee.geometry){const le=[];for(const Me of ve)le.push(Ji(Me,j));me.push(le)}}N.push(ws(ee.id,he,me,ee.tags))}return N}function Ji(ie,j){const N=[];N.size=ie.size,ie.start!==void 0&&(N.start=ie.start,N.end=ie.end);for(let H=0;H<ie.length;H+=3)N.push(ie[H]+j,ie[H+1],ie[H+2]);return N}function gn(ie,j){if(ie.transformed)return ie;const N=1<<ie.z,H=ie.x,ee=ie.y;for(const he of ie.features){const me=he.geometry,ve=he.type;if(he.geometry=[],ve===1)for(let le=0;le<me.length;le+=2)he.geometry.push(Jn(me[le],me[le+1],j,N,H,ee));else for(let le=0;le<me.length;le++){const Me=[];for(let Oe=0;Oe<me[le].length;Oe+=2)Me.push(Jn(me[le][Oe],me[le][Oe+1],j,N,H,ee));he.geometry.push(Me)}}return ie.transformed=!0,ie}function Jn(ie,j,N,H,ee,he){return[Math.round(N*(ie*H-ee)),Math.round(N*(j*H-he))]}function fa(ie,j,N,H,ee){const he=j===ee.maxZoom?0:ee.tolerance/((1<<j)*ee.extent),me={features:[],numPoints:0,numSimplified:0,numFeatures:ie.length,source:null,x:N,y:H,z:j,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ve of ie)rt(me,ve,he,ee);return me}function rt(ie,j,N,H){const ee=j.geometry,he=j.type,me=[];if(ie.minX=Math.min(ie.minX,j.minX),ie.minY=Math.min(ie.minY,j.minY),ie.maxX=Math.max(ie.maxX,j.maxX),ie.maxY=Math.max(ie.maxY,j.maxY),he==="Point"||he==="MultiPoint")for(let ve=0;ve<ee.length;ve+=3)me.push(ee[ve],ee[ve+1]),ie.numPoints++,ie.numSimplified++;else if(he==="LineString")Jt(me,ee,ie,N,!1,!1);else if(he==="MultiLineString"||he==="Polygon")for(let ve=0;ve<ee.length;ve++)Jt(me,ee[ve],ie,N,he==="Polygon",ve===0);else if(he==="MultiPolygon")for(let ve=0;ve<ee.length;ve++){const le=ee[ve];for(let Me=0;Me<le.length;Me++)Jt(me,le[Me],ie,N,!0,Me===0)}if(me.length){let ve=j.tags||null;if(he==="LineString"&&H.lineMetrics){ve={};for(const Me in j.tags)ve[Me]=j.tags[Me];ve.mapbox_clip_start=ee.start/ee.size,ve.mapbox_clip_end=ee.end/ee.size}const le={geometry:me,type:he==="Polygon"||he==="MultiPolygon"?3:he==="LineString"||he==="MultiLineString"?2:1,tags:ve};j.id!==null&&(le.id=j.id),ie.features.push(le)}}function Jt(ie,j,N,H,ee,he){const me=H*H;if(H>0&&j.size<(ee?me:H))return void(N.numPoints+=j.length/3);const ve=[];for(let le=0;le<j.length;le+=3)(H===0||j[le+2]>me)&&(N.numSimplified++,ve.push(j[le],j[le+1])),N.numPoints++;ee&&(function(le,Me){let Oe=0;for(let ke=0,Ye=le.length,wt=Ye-2;ke<Ye;wt=ke,ke+=2)Oe+=(le[ke]-le[wt])*(le[ke+1]+le[wt+1]);if(Oe>0===Me)for(let ke=0,Ye=le.length;ke<Ye/2;ke+=2){const wt=le[ke],Ct=le[ke+1];le[ke]=le[Ye-2-ke],le[ke+1]=le[Ye-1-ke],le[Ye-2-ke]=wt,le[Ye-1-ke]=Ct}})(ve,he),ie.push(ve)}const Rt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ln{constructor(j,N){const H=(N=this.options=(function(he,me){for(const ve in me)he[ve]=me[ve];return he})(Object.create(Rt),N)).debug;if(H&&console.time("preprocess data"),N.maxZoom<0||N.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(N.promoteId&&N.generateId)throw new Error("promoteId and generateId cannot be used together.");let ee=(function(he,me){const ve=[];if(he.type==="FeatureCollection")for(let le=0;le<he.features.length;le++)bs(ve,he.features[le],me,le);else bs(ve,he.type==="Feature"?he:{geometry:he},me);return ve})(j,N);this.tiles={},this.tileCoords=[],H&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",N.indexMaxZoom,N.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ee=(function(he,me){const ve=me.buffer/me.extent;let le=he;const Me=Rr(he,1,-1-ve,ve,0,-1,2,me),Oe=Rr(he,1,1-ve,2+ve,0,-1,2,me);return(Me||Oe)&&(le=Rr(he,1,-ve,1+ve,0,-1,2,me)||[],Me&&(le=Ke(Me,1).concat(le)),Oe&&(le=le.concat(Ke(Oe,-1)))),le})(ee,N),ee.length&&this.splitTile(ee,0,0,0),H&&(ee.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(j,N,H,ee,he,me,ve){const le=[j,N,H,ee],Me=this.options,Oe=Me.debug;for(;le.length;){ee=le.pop(),H=le.pop(),N=le.pop(),j=le.pop();const ke=1<<N,Ye=gi(N,H,ee);let wt=this.tiles[Ye];if(!wt&&(Oe>1&&console.time("creation"),wt=this.tiles[Ye]=fa(j,N,H,ee,Me),this.tileCoords.push({z:N,x:H,y:ee}),Oe)){Oe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",N,H,ee,wt.numFeatures,wt.numPoints,wt.numSimplified),console.timeEnd("creation"));const yn=`z${N}`;this.stats[yn]=(this.stats[yn]||0)+1,this.total++}if(wt.source=j,he==null){if(N===Me.indexMaxZoom||wt.numPoints<=Me.indexMaxPoints)continue}else{if(N===Me.maxZoom||N===he)continue;if(he!=null){const yn=he-N;if(H!==me>>yn||ee!==ve>>yn)continue}}if(wt.source=null,j.length===0)continue;Oe>1&&console.time("clipping");const Ct=.5*Me.buffer/Me.extent,fr=.5-Ct,Gt=.5+Ct,mr=1+Ct;let Wt=null,sn=null,Gr=null,tr=null,br=Rr(j,ke,H-Ct,H+Gt,0,wt.minX,wt.maxX,Me),jr=Rr(j,ke,H+fr,H+mr,0,wt.minX,wt.maxX,Me);j=null,br&&(Wt=Rr(br,ke,ee-Ct,ee+Gt,1,wt.minY,wt.maxY,Me),sn=Rr(br,ke,ee+fr,ee+mr,1,wt.minY,wt.maxY,Me),br=null),jr&&(Gr=Rr(jr,ke,ee-Ct,ee+Gt,1,wt.minY,wt.maxY,Me),tr=Rr(jr,ke,ee+fr,ee+mr,1,wt.minY,wt.maxY,Me),jr=null),Oe>1&&console.timeEnd("clipping"),le.push(Wt||[],N+1,2*H,2*ee),le.push(sn||[],N+1,2*H,2*ee+1),le.push(Gr||[],N+1,2*H+1,2*ee),le.push(tr||[],N+1,2*H+1,2*ee+1)}}getTile(j,N,H){j=+j,N=+N,H=+H;const ee=this.options,{extent:he,debug:me}=ee;if(j<0||j>24)return null;const ve=1<<j,le=gi(j,N=N+ve&ve-1,H);if(this.tiles[le])return gn(this.tiles[le],he);me>1&&console.log("drilling down to z%d-%d-%d",j,N,H);let Me,Oe=j,ke=N,Ye=H;for(;!Me&&Oe>0;)Oe--,ke>>=1,Ye>>=1,Me=this.tiles[gi(Oe,ke,Ye)];return Me&&Me.source?(me>1&&(console.log("found parent tile z%d-%d-%d",Oe,ke,Ye),console.time("drilling down")),this.splitTile(Me.source,Oe,ke,Ye,j,N,H),me>1&&console.timeEnd("drilling down"),this.tiles[le]?gn(this.tiles[le],he):null):null}}function gi(ie,j,N){return 32*((1<<ie)*N+j)+ie}function jt(ie,j){return j?ie.properties[j]:ie.id}function Ai(ie,j){if(ie==null)return!0;if(ie.type==="Feature")return jt(ie,j)!=null;if(ie.type==="FeatureCollection"){const N=new Set;for(const H of ie.features){const ee=jt(H,j);if(ee==null||N.has(ee))return!1;N.add(ee)}return!0}return!1}function Qi(ie,j){const N=new Map;if(ie!=null)if(ie.type==="Feature")N.set(jt(ie,j),ie);else for(const H of ie.features)N.set(jt(H,j),H);return N}class yi extends Y{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(j,N){return T._(this,void 0,void 0,(function*(){const H=j.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ee=this._geoJSONIndex.getTile(H.z,H.x,H.y);if(!ee)return null;const he=new class{constructor(ve){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=T.X,this.length=ve.length,this._features=ve}feature(ve){return new class{constructor(le){this._feature=le,this.extent=T.X,this.type=le.type,this.properties=le.tags,"id"in le&&!isNaN(le.id)&&(this.id=parseInt(le.id,10))}loadGeometry(){if(this._feature.type===1){const le=[];for(const Me of this._feature.geometry)le.push([new T.P(Me[0],Me[1])]);return le}{const le=[];for(const Me of this._feature.geometry){const Oe=[];for(const ke of Me)Oe.push(new T.P(ke[0],ke[1]));le.push(Oe)}return le}}toGeoJSON(le,Me,Oe){return Le.call(this,le,Me,Oe)}}(this._features[ve])}}(ee.features);let me=$t(he);return me.byteOffset===0&&me.byteLength===me.buffer.byteLength||(me=new Uint8Array(me)),{vectorTile:he,rawData:me.buffer}}))}loadData(j){return T._(this,void 0,void 0,(function*(){var N;(N=this._pendingRequest)===null||N===void 0||N.abort();const H=!!(j&&j.request&&j.request.collectResourceTiming)&&new T.bv(j.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(j,this._pendingRequest),this._geoJSONIndex=j.cluster?new Yt((function({superclusterOptions:me,clusterProperties:ve}){if(!ve||!me)return me;const le={},Me={},Oe={accumulated:null,zoom:0},ke={properties:null},Ye=Object.keys(ve);for(const wt of Ye){const[Ct,fr]=ve[wt],Gt=T.bC(fr),mr=T.bC(typeof Ct=="string"?[Ct,["accumulated"],["get",wt]]:Ct);le[wt]=Gt.value,Me[wt]=mr.value}return me.map=wt=>{ke.properties=wt;const Ct={};for(const fr of Ye)Ct[fr]=le[fr].evaluate(Oe,ke);return Ct},me.reduce=(wt,Ct)=>{ke.properties=Ct;for(const fr of Ye)Oe.accumulated=wt[fr],wt[fr]=Me[fr].evaluate(Oe,ke)},me})(j)).load((yield this._pendingData).features):(ee=yield this._pendingData,new Ln(ee,j.geojsonVtOptions)),this.loaded={};const he={};if(H){const me=H.finish();me&&(he.resourceTiming={},he.resourceTiming[j.source]=JSON.parse(JSON.stringify(me)))}return he}catch(he){if(delete this._pendingRequest,T.bB(he))return{abandoned:!0};throw he}var ee}))}getData(){return T._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(j){const N=this.loaded;return N&&N[j.uid]?super.reloadTile(j):this.loadTile(j)}loadAndProcessGeoJSON(j,N){return T._(this,void 0,void 0,(function*(){let H=yield this.loadGeoJSON(j,N);if(delete this._pendingRequest,typeof H!="object")throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`);if(Pe(H,!0),j.filter){const ee=T.bC(j.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ee.result==="error")throw new Error(ee.value.map((me=>`${me.key}: ${me.message}`)).join(", "));H={type:"FeatureCollection",features:H.features.filter((me=>ee.value.evaluate({zoom:0},me)))}}return H}))}loadGeoJSON(j,N){return T._(this,void 0,void 0,(function*(){const{promoteId:H}=j;if(j.request){const ee=yield T.h(j.request,N);return this._dataUpdateable=Ai(ee.data,H)?Qi(ee.data,H):void 0,ee.data}if(typeof j.data=="string")try{const ee=JSON.parse(j.data);return this._dataUpdateable=Ai(ee,H)?Qi(ee,H):void 0,ee}catch{throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`)}if(!j.dataDiff)throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${j.source}`);return(function(ee,he,me){var ve,le,Me,Oe;if(he.removeAll&&ee.clear(),he.remove)for(const ke of he.remove)ee.delete(ke);if(he.add)for(const ke of he.add){const Ye=jt(ke,me);Ye!=null&&ee.set(Ye,ke)}if(he.update)for(const ke of he.update){let Ye=ee.get(ke.id);if(Ye==null)continue;const wt=!ke.removeAllProperties&&(((ve=ke.removeProperties)===null||ve===void 0?void 0:ve.length)>0||((le=ke.addOrUpdateProperties)===null||le===void 0?void 0:le.length)>0);if((ke.newGeometry||ke.removeAllProperties||wt)&&(Ye=Object.assign({},Ye),ee.set(ke.id,Ye),wt&&(Ye.properties=Object.assign({},Ye.properties))),ke.newGeometry&&(Ye.geometry=ke.newGeometry),ke.removeAllProperties)Ye.properties={};else if(((Me=ke.removeProperties)===null||Me===void 0?void 0:Me.length)>0)for(const Ct of ke.removeProperties)Object.prototype.hasOwnProperty.call(Ye.properties,Ct)&&delete Ye.properties[Ct];if(((Oe=ke.addOrUpdateProperties)===null||Oe===void 0?void 0:Oe.length)>0)for(const{key:Ct,value:fr}of ke.addOrUpdateProperties)Ye.properties[Ct]=fr}})(this._dataUpdateable,j.dataDiff,H),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(j){return T._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(j){return this._geoJSONIndex.getClusterExpansionZoom(j.clusterId)}getClusterChildren(j){return this._geoJSONIndex.getChildren(j.clusterId)}getClusterLeaves(j){return this._geoJSONIndex.getLeaves(j.clusterId,j.limit,j.offset)}}class Un{constructor(j){this.self=j,this.actor=new T.F(j),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(N,H)=>{if(this.externalWorkerSourceTypes[N])throw new Error(`Worker source with name "${N}" already registered.`);this.externalWorkerSourceTypes[N]=H},this.self.addProtocol=T.bi,this.self.removeProtocol=T.bj,this.self.registerRTLTextPlugin=N=>{if(T.bD.isParsed())throw new Error("RTL text plugin already registered.");T.bD.setMethods(N)},this.actor.registerMessageHandler("LDT",((N,H)=>this._getDEMWorkerSource(N,H.source).loadTile(H))),this.actor.registerMessageHandler("RDT",((N,H)=>T._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(N,H.source).removeTile(H)})))),this.actor.registerMessageHandler("GCEZ",((N,H)=>T._(this,void 0,void 0,(function*(){return this._getWorkerSource(N,H.type,H.source).getClusterExpansionZoom(H)})))),this.actor.registerMessageHandler("GCC",((N,H)=>T._(this,void 0,void 0,(function*(){return this._getWorkerSource(N,H.type,H.source).getClusterChildren(H)})))),this.actor.registerMessageHandler("GCL",((N,H)=>T._(this,void 0,void 0,(function*(){return this._getWorkerSource(N,H.type,H.source).getClusterLeaves(H)})))),this.actor.registerMessageHandler("LD",((N,H)=>this._getWorkerSource(N,H.type,H.source).loadData(H))),this.actor.registerMessageHandler("GD",((N,H)=>this._getWorkerSource(N,H.type,H.source).getData())),this.actor.registerMessageHandler("LT",((N,H)=>this._getWorkerSource(N,H.type,H.source).loadTile(H))),this.actor.registerMessageHandler("RT",((N,H)=>this._getWorkerSource(N,H.type,H.source).reloadTile(H))),this.actor.registerMessageHandler("AT",((N,H)=>this._getWorkerSource(N,H.type,H.source).abortTile(H))),this.actor.registerMessageHandler("RMT",((N,H)=>this._getWorkerSource(N,H.type,H.source).removeTile(H))),this.actor.registerMessageHandler("RS",((N,H)=>T._(this,void 0,void 0,(function*(){if(!this.workerSources[N]||!this.workerSources[N][H.type]||!this.workerSources[N][H.type][H.source])return;const ee=this.workerSources[N][H.type][H.source];delete this.workerSources[N][H.type][H.source],ee.removeSource!==void 0&&ee.removeSource(H)})))),this.actor.registerMessageHandler("RM",(N=>T._(this,void 0,void 0,(function*(){delete this.layerIndexes[N],delete this.availableImages[N],delete this.workerSources[N],delete this.demWorkerSources[N]})))),this.actor.registerMessageHandler("SR",((N,H)=>T._(this,void 0,void 0,(function*(){this.referrer=H})))),this.actor.registerMessageHandler("SRPS",((N,H)=>this._syncRTLPluginState(N,H))),this.actor.registerMessageHandler("IS",((N,H)=>T._(this,void 0,void 0,(function*(){this.self.importScripts(H)})))),this.actor.registerMessageHandler("SI",((N,H)=>this._setImages(N,H))),this.actor.registerMessageHandler("UL",((N,H)=>T._(this,void 0,void 0,(function*(){this._getLayerIndex(N).update(H.layers,H.removedIds)})))),this.actor.registerMessageHandler("SL",((N,H)=>T._(this,void 0,void 0,(function*(){this._getLayerIndex(N).replace(H)}))))}_setImages(j,N){return T._(this,void 0,void 0,(function*(){this.availableImages[j]=N;for(const H in this.workerSources[j]){const ee=this.workerSources[j][H];for(const he in ee)ee[he].availableImages=N}}))}_syncRTLPluginState(j,N){return T._(this,void 0,void 0,(function*(){if(T.bD.isParsed())return T.bD.getState();if(N.pluginStatus!=="loading")return T.bD.setState(N),N;const H=N.pluginURL;if(this.self.importScripts(H),T.bD.isParsed()){const ee={pluginStatus:"loaded",pluginURL:H};return T.bD.setState(ee),ee}throw T.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${H}`)}))}_getAvailableImages(j){let N=this.availableImages[j];return N||(N=[]),N}_getLayerIndex(j){let N=this.layerIndexes[j];return N||(N=this.layerIndexes[j]=new h),N}_getWorkerSource(j,N,H){if(this.workerSources[j]||(this.workerSources[j]={}),this.workerSources[j][N]||(this.workerSources[j][N]={}),!this.workerSources[j][N][H]){const ee={sendAsync:(he,me)=>(he.targetMapId=j,this.actor.sendAsync(he,me))};switch(N){case"vector":this.workerSources[j][N][H]=new Y(ee,this._getLayerIndex(j),this._getAvailableImages(j));break;case"geojson":this.workerSources[j][N][H]=new yi(ee,this._getLayerIndex(j),this._getAvailableImages(j));break;default:this.workerSources[j][N][H]=new this.externalWorkerSourceTypes[N](ee,this._getLayerIndex(j),this._getAvailableImages(j))}}return this.workerSources[j][N][H]}_getDEMWorkerSource(j,N){return this.demWorkerSources[j]||(this.demWorkerSources[j]={}),this.demWorkerSources[j][N]||(this.demWorkerSources[j][N]=new Z),this.demWorkerSources[j][N]}}return T.i(self)&&(self.worker=new Un(self)),Un})),D("index",["exports","./shared"],(function(T,h){var W="4.7.1";let ue,ne;const Y={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:f=>new Promise(((e,s)=>{const l=requestAnimationFrame(e);f.signal.addEventListener("abort",(()=>{cancelAnimationFrame(l),s(h.c())}))})),getImageData(f,e=0){return this.getImageCanvasContext(f).getImageData(-e,-e,f.width+2*e,f.height+2*e)},getImageCanvasContext(f){const e=window.document.createElement("canvas"),s=e.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return e.width=f.width,e.height=f.height,s.drawImage(f,0,0,f.width,f.height),s},resolveURL:f=>(ue||(ue=document.createElement("a")),ue.href=f,ue.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(ne==null&&(ne=matchMedia("(prefers-reduced-motion: reduce)")),ne.matches)}};class Z{static testProp(e){if(!Z.docStyle)return e[0];for(let s=0;s<e.length;s++)if(e[s]in Z.docStyle)return e[s];return e[0]}static create(e,s,l){const u=window.document.createElement(e);return s!==void 0&&(u.className=s),l&&l.appendChild(u),u}static createNS(e,s){return window.document.createElementNS(e,s)}static disableDrag(){Z.docStyle&&Z.selectProp&&(Z.userSelect=Z.docStyle[Z.selectProp],Z.docStyle[Z.selectProp]="none")}static enableDrag(){Z.docStyle&&Z.selectProp&&(Z.docStyle[Z.selectProp]=Z.userSelect)}static setTransform(e,s){e.style[Z.transformProp]=s}static addEventListener(e,s,l,u={}){e.addEventListener(s,l,"passive"in u?u:u.capture)}static removeEventListener(e,s,l,u={}){e.removeEventListener(s,l,"passive"in u?u:u.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",Z.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Z.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",Z.suppressClickInternal,!0)}),0)}static getScale(e){const s=e.getBoundingClientRect();return{x:s.width/e.offsetWidth||1,y:s.height/e.offsetHeight||1,boundingClientRect:s}}static getPoint(e,s,l){const u=s.boundingClientRect;return new h.P((l.clientX-u.left)/s.x-e.clientLeft,(l.clientY-u.top)/s.y-e.clientTop)}static mousePos(e,s){const l=Z.getScale(e);return Z.getPoint(e,l,s)}static touchPos(e,s){const l=[],u=Z.getScale(e);for(let p=0;p<s.length;p++)l.push(Z.getPoint(e,u,s[p]));return l}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}Z.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,Z.selectProp=Z.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),Z.transformProp=Z.testProp(["transform","WebkitTransform"]);const Ie={supported:!1,testSupport:function(f){!Le&&Pe&&(De?ze(f):Re=f)}};let Re,Pe,Le=!1,De=!1;function ze(f){const e=f.createTexture();f.bindTexture(f.TEXTURE_2D,e);try{if(f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,Pe),f.isContextLost())return;Ie.supported=!0}catch{}f.deleteTexture(e),Le=!0}var Ue;typeof document<"u"&&(Pe=document.createElement("img"),Pe.onload=()=>{Re&&ze(Re),Re=null,De=!0},Pe.onerror=()=>{Le=!0,Re=null},Pe.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(f){let e,s,l,u;f.resetRequestQueue=()=>{e=[],s=0,l=0,u={}},f.addThrottleControl=E=>{const A=l++;return u[A]=E,A},f.removeThrottleControl=E=>{delete u[E],w()},f.getImage=(E,A,R=!0)=>new Promise(((B,U)=>{Ie.supported&&(E.headers||(E.headers={}),E.headers.accept="image/webp,*/*"),h.e(E,{type:"image"}),e.push({abortController:A,requestParameters:E,supportImageRefresh:R,state:"queued",onError:G=>{U(G)},onSuccess:G=>{B(G)}}),w()}));const p=E=>h._(this,void 0,void 0,(function*(){E.state="running";const{requestParameters:A,supportImageRefresh:R,onError:B,onSuccess:U,abortController:G}=E,X=R===!1&&!h.i(self)&&!h.g(A.url)&&(!A.headers||Object.keys(A.headers).reduce(((se,ce)=>se&&ce==="accept"),!0));s++;const J=X?k(A,G):h.m(A,G);try{const se=yield J;delete E.abortController,E.state="completed",se.data instanceof HTMLImageElement||h.b(se.data)?U(se):se.data&&U({data:yield(te=se.data,typeof createImageBitmap=="function"?h.d(te):h.f(te)),cacheControl:se.cacheControl,expires:se.expires})}catch(se){delete E.abortController,B(se)}finally{s--,w()}var te})),w=()=>{const E=(()=>{for(const A of Object.keys(u))if(u[A]())return!0;return!1})()?h.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:h.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let A=s;A<E&&e.length>0;A++){const R=e.shift();R.abortController.signal.aborted?A--:p(R)}},k=(E,A)=>new Promise(((R,B)=>{const U=new Image,G=E.url,X=E.credentials;X&&X==="include"?U.crossOrigin="use-credentials":(X&&X==="same-origin"||!h.s(G))&&(U.crossOrigin="anonymous"),A.signal.addEventListener("abort",(()=>{U.src="",B(h.c())})),U.fetchPriority="high",U.onload=()=>{U.onerror=U.onload=null,R({data:U})},U.onerror=()=>{U.onerror=U.onload=null,A.signal.aborted||B(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},U.src=G}))})(Ue||(Ue={})),Ue.resetRequestQueue();class et{constructor(e){this._transformRequestFn=e}transformRequest(e,s){return this._transformRequestFn&&this._transformRequestFn(e,s)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function Je(f){var e=new h.A(3);return e[0]=f[0],e[1]=f[1],e[2]=f[2],e}var He,je=function(f,e,s){return f[0]=e[0]-s[0],f[1]=e[1]-s[1],f[2]=e[2]-s[2],f};He=new h.A(3),h.A!=Float32Array&&(He[0]=0,He[1]=0,He[2]=0);var pt=function(f){var e=f[0],s=f[1];return e*e+s*s};function $e(f){const e=[];if(typeof f=="string")e.push({id:"default",url:f});else if(f&&f.length>0){const s=[];for(const{id:l,url:u}of f){const p=`${l}${u}`;s.indexOf(p)===-1&&(s.push(p),e.push({id:l,url:u}))}}return e}function ar(f,e,s){const l=f.split("?");return l[0]+=`${e}${s}`,l.join("?")}(function(){var f=new h.A(2);h.A!=Float32Array&&(f[0]=0,f[1]=0)})();class xt{constructor(e,s,l,u){this.context=e,this.format=l,this.texture=e.gl.createTexture(),this.update(s,u)}update(e,s,l){const{width:u,height:p}=e,w=!(this.size&&this.size[0]===u&&this.size[1]===p||l),{context:k}=this,{gl:E}=k;if(this.useMipmap=!!(s&&s.useMipmap),E.bindTexture(E.TEXTURE_2D,this.texture),k.pixelStoreUnpackFlipY.set(!1),k.pixelStoreUnpack.set(1),k.pixelStoreUnpackPremultiplyAlpha.set(this.format===E.RGBA&&(!s||s.premultiply!==!1)),w)this.size=[u,p],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||h.b(e)?E.texImage2D(E.TEXTURE_2D,0,this.format,this.format,E.UNSIGNED_BYTE,e):E.texImage2D(E.TEXTURE_2D,0,this.format,u,p,0,this.format,E.UNSIGNED_BYTE,e.data);else{const{x:A,y:R}=l||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||h.b(e)?E.texSubImage2D(E.TEXTURE_2D,0,A,R,E.RGBA,E.UNSIGNED_BYTE,e):E.texSubImage2D(E.TEXTURE_2D,0,A,R,u,p,E.RGBA,E.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&E.generateMipmap(E.TEXTURE_2D)}bind(e,s,l){const{context:u}=this,{gl:p}=u;p.bindTexture(p.TEXTURE_2D,this.texture),l!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=p.LINEAR),e!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,l||e),this.filter=e),s!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,s),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function wr(f){const{userImage:e}=f;return!!(e&&e.render&&e.render())&&(f.data.replace(new Uint8Array(e.data.buffer)),!0)}class Zt extends h.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new h.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:s,promiseResolve:l}of this.requestors)l(this._getImagesForIds(s));this.requestors=[]}}getImage(e){const s=this.images[e];if(s&&!s.data&&s.spriteData){const l=s.spriteData;s.data=new h.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),s.spriteData=null}return s}addImage(e,s){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,s)&&(this.images[e]=s)}_validate(e,s){let l=!0;const u=s.data||s.spriteData;return this._validateStretch(s.stretchX,u&&u.width)||(this.fire(new h.j(new Error(`Image "${e}" has invalid "stretchX" value`))),l=!1),this._validateStretch(s.stretchY,u&&u.height)||(this.fire(new h.j(new Error(`Image "${e}" has invalid "stretchY" value`))),l=!1),this._validateContent(s.content,s)||(this.fire(new h.j(new Error(`Image "${e}" has invalid "content" value`))),l=!1),l}_validateStretch(e,s){if(!e)return!0;let l=0;for(const u of e){if(u[0]<l||u[1]<u[0]||s<u[1])return!1;l=u[1]}return!0}_validateContent(e,s){if(!e)return!0;if(e.length!==4)return!1;const l=s.spriteData,u=l&&l.width||s.data.width,p=l&&l.height||s.data.height;return!(e[0]<0||u<e[0]||e[1]<0||p<e[1]||e[2]<0||u<e[2]||e[3]<0||p<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,s,l=!0){const u=this.getImage(e);if(l&&(u.data.width!==s.data.width||u.data.height!==s.data.height))throw new Error(`size mismatch between old image (${u.data.width}x${u.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=u.version+1,this.images[e]=s,this.updatedImages[e]=!0}removeImage(e){const s=this.images[e];delete this.images[e],delete this.patterns[e],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise(((s,l)=>{let u=!0;if(!this.isLoaded())for(const p of e)this.images[p]||(u=!1);this.isLoaded()||u?s(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:s})}))}_getImagesForIds(e){const s={};for(const l of e){let u=this.getImage(l);u||(this.fire(new h.k("styleimagemissing",{id:l})),u=this.getImage(l)),u?s[l]={data:u.data.clone(),pixelRatio:u.pixelRatio,sdf:u.sdf,version:u.version,stretchX:u.stretchX,stretchY:u.stretchY,content:u.content,textFitWidth:u.textFitWidth,textFitHeight:u.textFitHeight,hasRenderCallback:!!(u.userImage&&u.userImage.render)}:h.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return s}getPixelSize(){const{width:e,height:s}=this.atlasImage;return{width:e,height:s}}getPattern(e){const s=this.patterns[e],l=this.getImage(e);if(!l)return null;if(s&&s.position.version===l.version)return s.position;if(s)s.position.version=l.version;else{const u={w:l.data.width+2,h:l.data.height+2,x:0,y:0},p=new h.I(u,l);this.patterns[e]={bin:u,position:p}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const s=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new xt(e,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const p in this.patterns)e.push(this.patterns[p].bin);const{w:s,h:l}=h.p(e),u=this.atlasImage;u.resize({width:s||1,height:l||1});for(const p in this.patterns){const{bin:w}=this.patterns[p],k=w.x+1,E=w.y+1,A=this.getImage(p).data,R=A.width,B=A.height;h.R.copy(A,u,{x:0,y:0},{x:k,y:E},{width:R,height:B}),h.R.copy(A,u,{x:0,y:B-1},{x:k,y:E-1},{width:R,height:1}),h.R.copy(A,u,{x:0,y:0},{x:k,y:E+B},{width:R,height:1}),h.R.copy(A,u,{x:R-1,y:0},{x:k-1,y:E},{width:1,height:B}),h.R.copy(A,u,{x:0,y:0},{x:k+R,y:E},{width:1,height:B})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const s of e){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const l=this.getImage(s);l||h.w(`Image with ID: "${s}" was not found`),wr(l)&&this.updateImage(s,l)}}}const Nt=1e20;function Mr(f,e,s,l,u,p,w,k,E){for(let A=e;A<e+l;A++)Pr(f,s*p+A,p,u,w,k,E);for(let A=s;A<s+u;A++)Pr(f,A*p+e,1,l,w,k,E)}function Pr(f,e,s,l,u,p,w){p[0]=0,w[0]=-Nt,w[1]=Nt,u[0]=f[e];for(let k=1,E=0,A=0;k<l;k++){u[k]=f[e+k*s];const R=k*k;do{const B=p[E];A=(u[k]-u[B]+R-B*B)/(k-B)/2}while(A<=w[E]&&--E>-1);E++,p[E]=k,w[E]=A,w[E+1]=Nt}for(let k=0,E=0;k<l;k++){for(;w[E+1]<k;)E++;const A=p[E],R=k-A;f[e+k*s]=u[A]+R*R}}class $t{constructor(e,s){this.requestManager=e,this.localIdeographFontFamily=s,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return h._(this,void 0,void 0,(function*(){const s=[];for(const p in e)for(const w of e[p])s.push(this._getAndCacheGlyphsPromise(p,w));const l=yield Promise.all(s),u={};for(const{stack:p,id:w,glyph:k}of l)u[p]||(u[p]={}),u[p][w]=k&&{id:k.id,bitmap:k.bitmap.clone(),metrics:k.metrics};return u}))}_getAndCacheGlyphsPromise(e,s){return h._(this,void 0,void 0,(function*(){let l=this.entries[e];l||(l=this.entries[e]={glyphs:{},requests:{},ranges:{}});let u=l.glyphs[s];if(u!==void 0)return{stack:e,id:s,glyph:u};if(u=this._tinySDF(l,e,s),u)return l.glyphs[s]=u,{stack:e,id:s,glyph:u};const p=Math.floor(s/256);if(256*p>65535)throw new Error("glyphs > 65535 not supported");if(l.ranges[p])return{stack:e,id:s,glyph:u};if(!this.url)throw new Error("glyphsUrl is not set");if(!l.requests[p]){const k=$t.loadGlyphRange(e,p,this.url,this.requestManager);l.requests[p]=k}const w=yield l.requests[p];for(const k in w)this._doesCharSupportLocalGlyph(+k)||(l.glyphs[+k]=w[+k]);return l.ranges[p]=!0,{stack:e,id:s,glyph:w[s]||null}}))}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))}_tinySDF(e,s,l){const u=this.localIdeographFontFamily;if(!u||!this._doesCharSupportLocalGlyph(l))return;let p=e.tinySDF;if(!p){let k="400";/bold/i.test(s)?k="900":/medium/i.test(s)?k="500":/light/i.test(s)&&(k="200"),p=e.tinySDF=new $t.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:u,fontWeight:k})}const w=p.draw(String.fromCharCode(l));return{id:l,bitmap:new h.o({width:w.width||60,height:w.height||60},w.data),metrics:{width:w.glyphWidth/2||24,height:w.glyphHeight/2||24,left:w.glyphLeft/2+.5||0,top:w.glyphTop/2-27.5||-8,advance:w.glyphAdvance/2||24,isDoubleResolution:!0}}}}$t.loadGlyphRange=function(f,e,s,l){return h._(this,void 0,void 0,(function*(){const u=256*e,p=u+255,w=l.transformRequest(s.replace("{fontstack}",f).replace("{range}",`${u}-${p}`),"Glyphs"),k=yield h.l(w,new AbortController);if(!k||!k.data)throw new Error(`Could not load glyph range. range: ${e}, ${u}-${p}`);const E={};for(const A of h.n(k.data))E[A.id]=A;return E}))},$t.TinySDF=class{constructor({fontSize:f=24,buffer:e=3,radius:s=8,cutoff:l=.25,fontFamily:u="sans-serif",fontWeight:p="normal",fontStyle:w="normal"}={}){this.buffer=e,this.cutoff=l,this.radius=s;const k=this.size=f+4*e,E=this._createCanvas(k),A=this.ctx=E.getContext("2d",{willReadFrequently:!0});A.font=`${w} ${p} ${f}px ${u}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(k*k),this.gridInner=new Float64Array(k*k),this.f=new Float64Array(k),this.z=new Float64Array(k+1),this.v=new Uint16Array(k)}_createCanvas(f){const e=document.createElement("canvas");return e.width=e.height=f,e}draw(f){const{width:e,actualBoundingBoxAscent:s,actualBoundingBoxDescent:l,actualBoundingBoxLeft:u,actualBoundingBoxRight:p}=this.ctx.measureText(f),w=Math.ceil(s),k=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-u))),E=Math.min(this.size-this.buffer,w+Math.ceil(l)),A=k+2*this.buffer,R=E+2*this.buffer,B=Math.max(A*R,0),U=new Uint8ClampedArray(B),G={data:U,width:A,height:R,glyphWidth:k,glyphHeight:E,glyphTop:w,glyphLeft:0,glyphAdvance:e};if(k===0||E===0)return G;const{ctx:X,buffer:J,gridInner:te,gridOuter:se}=this;X.clearRect(J,J,k,E),X.fillText(f,J,J+w);const ce=X.getImageData(J,J,k,E);se.fill(Nt,0,B),te.fill(0,0,B);for(let Q=0;Q<E;Q++)for(let fe=0;fe<k;fe++){const ye=ce.data[4*(Q*k+fe)+3]/255;if(ye===0)continue;const be=(Q+J)*A+fe+J;if(ye===1)se[be]=0,te[be]=Nt;else{const Fe=.5-ye;se[be]=Fe>0?Fe*Fe:0,te[be]=Fe<0?Fe*Fe:0}}Mr(se,0,0,A,R,A,this.f,this.v,this.z),Mr(te,J,J,k,E,A,this.f,this.v,this.z);for(let Q=0;Q<B;Q++){const fe=Math.sqrt(se[Q])-Math.sqrt(te[Q]);U[Q]=Math.round(255-255*(fe/this.radius+this.cutoff))}return G}};class ot{constructor(){this.specification=h.v.light.position}possiblyEvaluate(e,s){return h.x(e.expression.evaluate(s))}interpolate(e,s,l){return{x:h.y.number(e.x,s.x,l),y:h.y.number(e.y,s.y,l),z:h.y.number(e.z,s.z,l)}}}let Pt;class ft extends h.E{constructor(e){super(),Pt=Pt||new h.q({anchor:new h.D(h.v.light.anchor),position:new ot,color:new h.D(h.v.light.color),intensity:new h.D(h.v.light.intensity)}),this._transitionable=new h.T(Pt),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,s={}){if(!this._validate(h.r,e,s))for(const l in e){const u=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),u):this._transitionable.setValue(l,u)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,s,l){return(!l||l.validate!==!1)&&h.t(this,e.call(h.u,{value:s,style:{glyphs:!0,sprite:!0},styleSpec:h.v}))}}const xe=new h.q({"sky-color":new h.D(h.v.sky["sky-color"]),"horizon-color":new h.D(h.v.sky["horizon-color"]),"fog-color":new h.D(h.v.sky["fog-color"]),"fog-ground-blend":new h.D(h.v.sky["fog-ground-blend"]),"horizon-fog-blend":new h.D(h.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new h.D(h.v.sky["sky-horizon-blend"]),"atmosphere-blend":new h.D(h.v.sky["atmosphere-blend"])});class Ne extends h.E{constructor(e){super(),this._transitionable=new h.T(xe),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new h.z(0))}setSky(e,s={}){if(!this._validate(h.B,e,s)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const l in e){const u=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),u):this._transitionable.setValue(l,u)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,s,l={}){return(l==null?void 0:l.validate)!==!1&&h.t(this,e.call(h.u,h.e({value:s,style:{glyphs:!0,sprite:!0},styleSpec:h.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class Xt{constructor(e,s){this.width=e,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,s){const l=e.join(",")+String(s);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(e,s)),this.dashEntry[l]}getDashRanges(e,s,l){const u=[];let p=e.length%2==1?-e[e.length-1]*l:0,w=e[0]*l,k=!0;u.push({left:p,right:w,isDash:k,zeroLength:e[0]===0});let E=e[0];for(let A=1;A<e.length;A++){k=!k;const R=e[A];p=E*l,E+=R,w=E*l,u.push({left:p,right:w,isDash:k,zeroLength:R===0})}return u}addRoundDash(e,s,l){const u=s/2;for(let p=-l;p<=l;p++){const w=this.width*(this.nextRow+l+p);let k=0,E=e[k];for(let A=0;A<this.width;A++){A/E.right>1&&(E=e[++k]);const R=Math.abs(A-E.left),B=Math.abs(A-E.right),U=Math.min(R,B);let G;const X=p/l*(u+1);if(E.isDash){const J=u-Math.abs(X);G=Math.sqrt(U*U+J*J)}else G=u-Math.sqrt(U*U+X*X);this.data[w+A]=Math.max(0,Math.min(255,G+128))}}}addRegularDash(e){for(let k=e.length-1;k>=0;--k){const E=e[k],A=e[k+1];E.zeroLength?e.splice(k,1):A&&A.isDash===E.isDash&&(A.left=E.left,e.splice(k,1))}const s=e[0],l=e[e.length-1];s.isDash===l.isDash&&(s.left=l.left-this.width,l.right=s.right+this.width);const u=this.width*this.nextRow;let p=0,w=e[p];for(let k=0;k<this.width;k++){k/w.right>1&&(w=e[++p]);const E=Math.abs(k-w.left),A=Math.abs(k-w.right),R=Math.min(E,A);this.data[u+k]=Math.max(0,Math.min(255,(w.isDash?R:-R)+128))}}addDash(e,s){const l=s?7:0,u=2*l+1;if(this.nextRow+u>this.height)return h.w("LineAtlas out of space"),null;let p=0;for(let k=0;k<e.length;k++)p+=e[k];if(p!==0){const k=this.width/p,E=this.getDashRanges(e,this.width,k);s?this.addRoundDash(E,k,l):this.addRegularDash(E)}const w={y:(this.nextRow+l+.5)/this.height,height:2*l/this.height,width:p};return this.nextRow+=u,this.dirty=!0,w}bind(e){const s=e.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}const Yt="maplibre_preloaded_worker_pool";class nr{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<nr.workerCount;)this.workers.push(new Worker(h.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach((s=>{s.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Yt]}numActive(){return Object.keys(this.active).length}}const cr=Math.floor(Y.hardwareConcurrency/2);let ur,or;function Ir(){return ur||(ur=new nr),ur}nr.workerCount=h.C(globalThis)?Math.max(Math.min(cr,3),1):1;class mn{constructor(e,s){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=s;const l=this.workerPool.acquire(s);for(let u=0;u<l.length;u++){const p=new h.F(l[u],s);p.name=`Worker ${u}`,this.actors.push(p)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,s){const l=[];for(const u of this.actors)l.push(u.sendAsync({type:e,data:s}));return Promise.all(l)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach((s=>{s.remove()})),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,s){for(const l of this.actors)l.registerMessageHandler(e,s)}}function pa(){return or||(or=new mn(Ir(),h.G),or.registerMessageHandler("GR",((f,e,s)=>h.m(e,s)))),or}function ws(f,e){const s=h.H();return h.J(s,s,[1,1,0]),h.K(s,s,[.5*f.width,.5*f.height,1]),h.L(s,s,f.calculatePosMatrix(e.toUnwrapped()))}function Yi(f,e,s,l,u,p){const w=(function(B,U,G){if(B)for(const X of B){const J=U[X];if(J&&J.source===G&&J.type==="fill-extrusion")return!0}else for(const X in U){const J=U[X];if(J.source===G&&J.type==="fill-extrusion")return!0}return!1})(u&&u.layers,e,f.id),k=p.maxPitchScaleFactor(),E=f.tilesIn(l,k,w);E.sort(bs);const A=[];for(const B of E)A.push({wrappedTileID:B.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(e,s,f._state,B.queryGeometry,B.cameraQueryGeometry,B.scale,u,p,k,ws(f.transform,B.tileID))});const R=(function(B){const U={},G={};for(const X of B){const J=X.queryResults,te=X.wrappedTileID,se=G[te]=G[te]||{};for(const ce in J){const Q=J[ce],fe=se[ce]=se[ce]||{},ye=U[ce]=U[ce]||[];for(const be of Q)fe[be.featureIndex]||(fe[be.featureIndex]=!0,ye.push(be))}}return U})(A);for(const B in R)R[B].forEach((U=>{const G=U.feature,X=f.getFeatureState(G.layer["source-layer"],G.id);G.source=G.layer.source,G.layer["source-layer"]&&(G.sourceLayer=G.layer["source-layer"]),G.state=X}));return R}function bs(f,e){const s=f.tileID,l=e.tileID;return s.overscaledZ-l.overscaledZ||s.canonical.y-l.canonical.y||s.wrap-l.wrap||s.canonical.x-l.canonical.x}function Ra(f,e,s){return h._(this,void 0,void 0,(function*(){let l=f;if(f.url?l=(yield h.h(e.transformRequest(f.url,"Source"),s)).data:yield Y.frameAsync(s),!l)return null;const u=h.M(h.e(l,f),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in l&&l.vector_layers&&(u.vectorLayerIds=l.vector_layers.map((p=>p.id))),u}))}class Ee{constructor(e,s){e&&(s?this.setSouthWest(e).setNorthEast(s):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof h.N?new h.N(e.lng,e.lat):h.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof h.N?new h.N(e.lng,e.lat):h.N.convert(e),this}extend(e){const s=this._sw,l=this._ne;let u,p;if(e instanceof h.N)u=e,p=e;else{if(!(e instanceof Ee))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Ee.convert(e)):this.extend(h.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(h.N.convert(e)):this;if(u=e._sw,p=e._ne,!u||!p)return this}return s||l?(s.lng=Math.min(u.lng,s.lng),s.lat=Math.min(u.lat,s.lat),l.lng=Math.max(p.lng,l.lng),l.lat=Math.max(p.lat,l.lat)):(this._sw=new h.N(u.lng,u.lat),this._ne=new h.N(p.lng,p.lat)),this}getCenter(){return new h.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new h.N(this.getWest(),this.getNorth())}getSouthEast(){return new h.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:s,lat:l}=h.N.convert(e);let u=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&u}static convert(e){return e instanceof Ee?e:e&&new Ee(e)}static fromLngLat(e,s=0){const l=360*s/40075017,u=l/Math.cos(Math.PI/180*e.lat);return new Ee(new h.N(e.lng-u,e.lat-l),new h.N(e.lng+u,e.lat+l))}adjustAntiMeridian(){const e=new h.N(this._sw.lng,this._sw.lat),s=new h.N(this._ne.lng,this._ne.lat);return new Ee(e,e.lng>s.lng?new h.N(s.lng+360,s.lat):s)}}class Ns{constructor(e,s,l){this.bounds=Ee.convert(this.validateBounds(e)),this.minzoom=s||0,this.maxzoom=l||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const s=Math.pow(2,e.z),l=Math.floor(h.O(this.bounds.getWest())*s),u=Math.floor(h.Q(this.bounds.getNorth())*s),p=Math.ceil(h.O(this.bounds.getEast())*s),w=Math.ceil(h.Q(this.bounds.getSouth())*s);return e.x>=l&&e.x<p&&e.y>=u&&e.y<w}}class co extends h.E{constructor(e,s,l,u){if(super(),this.id=e,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,h.e(this,h.M(s,["url","scheme","tileSize","promoteId"])),this._options=h.e({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(u)}load(){return h._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new h.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Ra(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(h.e(this,e),e.bounds&&(this.tileBounds=new Ns(e.bounds,this.minzoom,this.maxzoom)),this.fire(new h.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new h.j(e))}}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return h.e({},this._options)}loadTile(e){return h._(this,void 0,void 0,(function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(s,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};l.request.collectResourceTiming=this._collectResourceTiming;let u="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise(((p,w)=>{e.reloadPromise={resolve:p,reject:w}}))}else e.actor=this.dispatcher.getActor(),u="LT";e.abortController=new AbortController;try{const p=yield e.actor.sendAsync({type:u,data:l},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,p)}catch(p){if(delete e.abortController,e.aborted)return;if(p&&p.status!==404)throw p;this._afterTileLoadWorkerResponse(e,null)}}))}_afterTileLoadWorkerResponse(e,s){if(s&&s.resourceTiming&&(e.resourceTiming=s.resourceTiming),s&&this.map._refreshExpiredTiles&&e.setExpiryData(s),e.loadVectorData(s,this.map.painter),e.reloadPromise){const l=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(l.resolve).catch(l.reject)}}abortTile(e){return h._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}unloadTile(e){return h._(this,void 0,void 0,(function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class pr extends h.E{constructor(e,s,l,u){super(),this.id=e,this.dispatcher=l,this.setEventedParent(u),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=h.e({type:"raster"},s),h.e(this,h.M(s,["url","scheme","tileSize"]))}load(){return h._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new h.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Ra(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(h.e(this,e),e.bounds&&(this.tileBounds=new Ns(e.bounds,this.minzoom,this.maxzoom)),this.fire(new h.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new h.j(e))}}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}serialize(){return h.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return h._(this,void 0,void 0,(function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const l=yield Ue.getImage(this.map._requestManager.transformRequest(s,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(l&&l.data){this.map._refreshExpiredTiles&&l.cacheControl&&l.expires&&e.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const u=this.map.painter.context,p=u.gl,w=l.data;e.texture=this.map.painter.getTileTexture(w.width),e.texture?e.texture.update(w,{useMipmap:!0}):(e.texture=new xt(u,w,p.RGBA,{useMipmap:!0}),e.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE,p.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(l){if(delete e.abortController,e.aborted)e.state="unloaded";else if(l)throw e.state="errored",l}}))}abortTile(e){return h._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)}))}unloadTile(e){return h._(this,void 0,void 0,(function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)}))}hasTransition(){return!1}}class Rr extends pr{constructor(e,s,l,u){super(e,s,l,u),this.type="raster-dem",this.maxzoom=22,this._options=h.e({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox",this.redFactor=s.redFactor,this.greenFactor=s.greenFactor,this.blueFactor=s.blueFactor,this.baseShift=s.baseShift}loadTile(e){return h._(this,void 0,void 0,(function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(s,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const u=yield Ue.getImage(l,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(u&&u.data){const p=u.data;this.map._refreshExpiredTiles&&u.cacheControl&&u.expires&&e.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const w=h.b(p)&&h.U()?p:yield this.readImageNow(p),k={type:this.type,uid:e.uid,source:this.id,rawImageData:w,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const E=yield e.actor.sendAsync({type:"LDT",data:k});e.dem=E,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(u){if(delete e.abortController,e.aborted)e.state="unloaded";else if(u)throw e.state="errored",u}}))}readImageNow(e){return h._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&h.V()){const s=e.width+2,l=e.height+2;try{return new h.R({width:s,height:l},yield h.W(e,-1,-1,s,l))}catch{}}return Y.getImageData(e,1)}))}_getNeighboringTiles(e){const s=e.canonical,l=Math.pow(2,s.z),u=(s.x-1+l)%l,p=s.x===0?e.wrap-1:e.wrap,w=(s.x+1+l)%l,k=s.x+1===l?e.wrap+1:e.wrap,E={};return E[new h.S(e.overscaledZ,p,s.z,u,s.y).key]={backfilled:!1},E[new h.S(e.overscaledZ,k,s.z,w,s.y).key]={backfilled:!1},s.y>0&&(E[new h.S(e.overscaledZ,p,s.z,u,s.y-1).key]={backfilled:!1},E[new h.S(e.overscaledZ,e.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},E[new h.S(e.overscaledZ,k,s.z,w,s.y-1).key]={backfilled:!1}),s.y+1<l&&(E[new h.S(e.overscaledZ,p,s.z,u,s.y+1).key]={backfilled:!1},E[new h.S(e.overscaledZ,e.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},E[new h.S(e.overscaledZ,k,s.z,w,s.y+1).key]={backfilled:!1}),E}unloadTile(e){return h._(this,void 0,void 0,(function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))}))}}class Ss extends h.E{constructor(e,s,l,u){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=l.getActor(),this.setEventedParent(u),this._data=s.data,this._options=h.e({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const p=h.X/this.tileSize;s.clusterMaxZoom!==void 0&&this.maxzoom<=s.clusterMaxZoom&&h.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${s.clusterMaxZoom}".`),this.workerOptions=h.e({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*p,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*p,extent:h.X,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:h.X,radius:(s.clusterRadius||50)*p,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return h._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return h._(this,void 0,void 0,(function*(){const e=h.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})}))}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,s,l){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:s,offset:l}})}_updateWorkerData(e){return h._(this,void 0,void 0,(function*(){const s=h.e({type:this.type},this.workerOptions);e?s.dataDiff=e:typeof this._data=="string"?(s.request=this.map._requestManager.transformRequest(Y.resolveURL(this._data),"Source"),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new h.k("dataloading",{dataType:"source"}));try{const l=yield this.actor.sendAsync({type:"LD",data:s});if(this._pendingLoads--,this._removed||l.abandoned)return void this.fire(new h.k("dataabort",{dataType:"source"}));let u=null;l.resourceTiming&&l.resourceTiming[this.id]&&(u=l.resourceTiming[this.id].slice(0));const p={dataType:"source"};this._collectResourceTiming&&u&&u.length>0&&h.e(p,{resourceTiming:u}),this.fire(new h.k("data",Object.assign(Object.assign({},p),{sourceDataType:"metadata"}))),this.fire(new h.k("data",Object.assign(Object.assign({},p),{sourceDataType:"content"})))}catch(l){if(this._pendingLoads--,this._removed)return void this.fire(new h.k("dataabort",{dataType:"source"}));this.fire(new h.j(l))}}))}loaded(){return this._pendingLoads===0}loadTile(e){return h._(this,void 0,void 0,(function*(){const s=e.actor?"RT":"LT";e.actor=this.actor;const l={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;const u=yield this.actor.sendAsync({type:s,data:l},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(u,this.map.painter,s==="RT")}))}abortTile(e){return h._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0}))}unloadTile(e){return h._(this,void 0,void 0,(function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return h.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var ks=h.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ts extends h.E{constructor(e,s,l,u){super(),this.id=e,this.dispatcher=l,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(u),this.options=s}load(e){return h._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new h.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const s=yield Ue.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,s&&s.data&&(this.image=s.data,e&&(this.coordinates=e),this._finishLoading())}catch(s){this._request=null,this._loaded=!0,this.fire(new h.j(s))}}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new h.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const s=e.map(h.Z.fromLngLat);this.tileID=(function(u){let p=1/0,w=1/0,k=-1/0,E=-1/0;for(const U of u)p=Math.min(p,U.x),w=Math.min(w,U.y),k=Math.max(k,U.x),E=Math.max(E,U.y);const A=Math.max(k-p,E-w),R=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),B=Math.pow(2,R);return new h.a1(R,Math.floor((p+k)/2*B),Math.floor((w+E)/2*B))})(s),this.minzoom=this.maxzoom=this.tileID.z;const l=s.map((u=>this.tileID.getTilePoint(u)._round()));return this._boundsArray=new h.$,this._boundsArray.emplaceBack(l[0].x,l[0].y,0,0),this._boundsArray.emplaceBack(l[1].x,l[1].y,h.X,0),this._boundsArray.emplaceBack(l[3].x,l[3].y,0,h.X),this._boundsArray.emplaceBack(l[2].x,l[2].y,h.X,h.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new h.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,s=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,ks.members)),this.boundsSegments||(this.boundsSegments=h.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new xt(e,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let l=!1;for(const u in this.tiles){const p=this.tiles[u];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture,l=!0)}l&&this.fire(new h.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return h._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Ba extends Ts{constructor(e,s,l,u){super(e,s,l,u),this.roundZoom=!0,this.type="video",this.options=s}load(){return h._(this,void 0,void 0,(function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const s of e.urls)this.urls.push(this.map._requestManager.transformRequest(s,"Source").url);try{const s=yield h.a3(this.urls);if(this._loaded=!0,!s)return;this.video=s,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(s){this.fire(new h.j(s))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const s=this.video.seekable;e<s.start(0)||e>s.end(0)?this.fire(new h.j(new h.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,s=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,ks.members)),this.boundsSegments||(this.boundsSegments=h.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new xt(e,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let l=!1;for(const u in this.tiles){const p=this.tiles[u];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture,l=!0)}l&&this.fire(new h.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class mi extends Ts{constructor(e,s,l,u){super(e,s,l,u),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some((p=>!Array.isArray(p)||p.length!==2||p.some((w=>typeof w!="number"))))||this.fire(new h.j(new h.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new h.j(new h.a2(`sources.${e}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new h.j(new h.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new h.j(new h.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new h.j(new h.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){return h._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new h.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context,l=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,ks.members)),this.boundsSegments||(this.boundsSegments=h.a0.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new xt(s,this.canvas,l.RGBA,{premultiply:!0});let u=!1;for(const p in this.tiles){const w=this.tiles[p];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,u=!0)}u&&this.fire(new h.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const ho={},Fa=f=>{switch(f){case"geojson":return Ss;case"image":return Ts;case"raster":return pr;case"raster-dem":return Rr;case"vector":return co;case"video":return Ba;case"canvas":return mi}return ho[f]},Ke="RTLPluginLoaded";class Ji extends h.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=pa()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch((s=>{throw this.status="error",s}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return h._(this,arguments,void 0,(function*(s,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=Y.resolveURL(s),!this.url)throw new Error(`requested url ${s} is invalid`);if(this.status==="unavailable"){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return h._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new h.k(Ke))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let gn=null;function Jn(){return gn||(gn=new Ji),gn}class fa{constructor(e,s){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=h.a4(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const s=e+this.timeAdded;s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,s,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=(function(u,p){const w={};if(!p)return w;for(const k of u){const E=k.layerIds.map((A=>p.getLayer(A))).filter(Boolean);if(E.length!==0){k.layers=E,k.stateDependentLayerIds&&(k.stateDependentLayers=k.stateDependentLayerIds.map((A=>E.filter((R=>R.id===A))[0])));for(const A of E)w[A.id]=k}}return w})(e.buckets,s.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const p=this.buckets[u];if(p instanceof h.a6){if(this.hasSymbolBuckets=!0,!l)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const p=this.buckets[u];if(p instanceof h.a6&&p.hasRTLText){this.hasRTLText=!0,Jn().lazyLoad();break}}this.queryPadding=0;for(const u in this.buckets){const p=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(u).queryRadius(p))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new h.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const l in this.buckets){const u=this.buckets[l];u.uploadPending()&&u.upload(e)}const s=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new xt(e,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new xt(e,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,s,l,u,p,w,k,E,A,R){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:u,cameraQueryGeometry:p,scale:w,tileSize:this.tileSize,pixelPosMatrix:R,transform:E,params:k,queryPadding:this.queryPadding*A},e,s,l):{}}querySourceFeatures(e,s){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const u=l.loadVTLayers(),p=s&&s.sourceLayer?s.sourceLayer:"",w=u._geojsonTileLayer||u[p];if(!w)return;const k=h.a7(s&&s.filter),{z:E,x:A,y:R}=this.tileID.canonical,B={z:E,x:A,y:R};for(let U=0;U<w.length;U++){const G=w.feature(U);if(k.needGeometry){const te=h.a8(G,!0);if(!k.filter(new h.z(this.tileID.overscaledZ),te,this.tileID.canonical))continue}else if(!k.filter(new h.z(this.tileID.overscaledZ),G))continue;const X=l.getId(G,p),J=new h.a9(G,E,A,R,X);J.tile=B,e.push(J)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const s=this.expirationTime;if(e.cacheControl){const l=h.aa(e.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const l=Date.now();let u=!1;if(this.expirationTime>l)u=!1;else if(s)if(this.expirationTime<s)u=!0;else{const p=this.expirationTime-s;p?this.expirationTime=l+Math.max(p,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const u in this.buckets){if(!s.style.hasLayer(u))continue;const p=this.buckets[u],w=p.layers[0].sourceLayer||"_geojsonTileLayer",k=l[w],E=e[w];if(!k||!E||Object.keys(E).length===0)continue;p.update(E,k,this.imageAtlas&&this.imageAtlas.patternPositions||{});const A=s&&s.style&&s.style.getLayer(u);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(p)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Y.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Y.now()+e}setDependencies(e,s){const l={};for(const u of s)l[u]=!0;this.dependencies[e]=l}hasDependency(e,s){for(const l of e){const u=this.dependencies[l];if(u){for(const p of s)if(u[p])return!0}}return!1}}class rt{constructor(e,s){this.max=e,this.onRemove=s,this.reset()}reset(){for(const e in this.data)for(const s of this.data[e])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(e,s,l){const u=e.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const p={value:s,timeout:void 0};if(l!==void 0&&(p.timeout=setTimeout((()=>{this.remove(e,p)}),l)),this.data[u].push(p),this.order.push(u),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const s=this.data[e].shift();return s.timeout&&clearTimeout(s.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),s.value}getByKey(e){const s=this.data[e];return s?s[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,s){if(!this.has(e))return this;const l=e.wrapped().key,u=s===void 0?0:this.data[l].indexOf(s),p=this.data[l][u];return this.data[l].splice(u,1),p.timeout&&clearTimeout(p.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(p.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(e){const s=[];for(const l in this.data)for(const u of this.data[l])e(u.value)||s.push(u);for(const l of s)this.remove(l.value.tileID,l)}}class Jt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,s,l){const u=String(s);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},h.e(this.stateChanges[e][u],l),this.deletedStates[e]===null){this.deletedStates[e]={};for(const p in this.state[e])p!==u&&(this.deletedStates[e][p]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][u]===null){this.deletedStates[e][u]={};for(const p in this.state[e][u])l[p]||(this.deletedStates[e][u][p]=null)}else for(const p in l)this.deletedStates[e]&&this.deletedStates[e][u]&&this.deletedStates[e][u][p]===null&&delete this.deletedStates[e][u][p]}removeFeatureState(e,s,l){if(this.deletedStates[e]===null)return;const u=String(s);if(this.deletedStates[e]=this.deletedStates[e]||{},l&&s!==void 0)this.deletedStates[e][u]!==null&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][l]=null);else if(s!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][u])for(l in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][l]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,s){const l=String(s),u=h.e({},(this.state[e]||{})[l],(this.stateChanges[e]||{})[l]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const p=this.deletedStates[e][s];if(p===null)return{};for(const w in p)delete u[w]}return u}initializeTileState(e,s){e.setFeatureState(this.state,s)}coalesceChanges(e,s){const l={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const p={};for(const w in this.stateChanges[u])this.state[u][w]||(this.state[u][w]={}),h.e(this.state[u][w],this.stateChanges[u][w]),p[w]=this.state[u][w];l[u]=p}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const p={};if(this.deletedStates[u]===null)for(const w in this.state[u])p[w]={},this.state[u][w]={};else for(const w in this.deletedStates[u]){if(this.deletedStates[u][w]===null)this.state[u][w]={};else for(const k of Object.keys(this.deletedStates[u][w]))delete this.state[u][w][k];p[w]=this.state[u][w]}l[u]=l[u]||{},h.e(l[u],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const u in e)e[u].setFeatureState(l,s)}}class Rt extends h.E{constructor(e,s,l){super(),this.id=e,this.dispatcher=l,this.on("data",(u=>this._dataHandler(u))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((u,p,w,k)=>{const E=new(Fa(p.type))(u,p,w,k);if(E.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${E.id}`);return E})(e,s,l,this),this._tiles={},this._cache=new rt(0,(u=>this._unloadTile(u))),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Jt,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const s=this._tiles[e];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,s,l){return h._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,s,l)}catch(u){e.state="errored",u.status!==404?this._source.fire(new h.j(u,{tile:e})):this.update(this.transform,this.terrain)}}))}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new h.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const l=this._tiles[s];l.upload(e),l.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((e=>e.tileID)).sort(Ln).map((e=>e.key))}getRenderableIds(e){const s=[];for(const l in this._tiles)this._isIdRenderable(l,e)&&s.push(this._tiles[l]);return e?s.sort(((l,u)=>{const p=l.tileID,w=u.tileID,k=new h.P(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),E=new h.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-w.overscaledZ||E.y-k.y||E.x-k.x})).map((l=>l.tileID.key)):s.map((l=>l.tileID)).sort(Ln).map((l=>l.key))}hasRenderableParent(e){const s=this.findLoadedParent(e,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(e,s){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(s||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,s){return h._(this,void 0,void 0,(function*(){const l=this._tiles[e];l&&(l.state!=="loading"&&(l.state=s),yield this._loadTile(l,e,s))}))}_tileLoaded(e,s,l){e.timeAdded=Y.now(),l==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(s,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new h.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const s=this.getRenderableIds();for(let u=0;u<s.length;u++){const p=s[u];if(e.neighboringTiles&&e.neighboringTiles[p]){const w=this.getTileByID(p);l(e,w),l(w,e)}}function l(u,p){u.needsHillshadePrepare=!0,u.needsTerrainPrepare=!0;let w=p.tileID.canonical.x-u.tileID.canonical.x;const k=p.tileID.canonical.y-u.tileID.canonical.y,E=Math.pow(2,u.tileID.canonical.z),A=p.tileID.key;w===0&&k===0||Math.abs(k)>1||(Math.abs(w)>1&&(Math.abs(w+E)===1?w+=E:Math.abs(w-E)===1&&(w-=E)),p.dem&&u.dem&&(u.dem.backfillBorder(p.dem,w,k),u.neighboringTiles&&u.neighboringTiles[A]&&(u.neighboringTiles[A].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,s,l,u){for(const p in this._tiles){let w=this._tiles[p];if(u[p]||!w.hasData()||w.tileID.overscaledZ<=s||w.tileID.overscaledZ>l)continue;let k=w.tileID;for(;w&&w.tileID.overscaledZ>s+1;){const A=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[A.key],w&&w.hasData()&&(k=A)}let E=k;for(;E.overscaledZ>s;)if(E=E.scaledTo(E.overscaledZ-1),e[E.key]){u[k.key]=k;break}}}findLoadedParent(e,s){if(e.key in this._loadedParentTiles){const l=this._loadedParentTiles[e.key];return l&&l.tileID.overscaledZ>=s?l:null}for(let l=e.overscaledZ-1;l>=s;l--){const u=e.scaledTo(l),p=this._getLoadedTile(u);if(p)return p}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const s=this._tiles[e.key];return s&&s.hasData()?s:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const s=Math.ceil(e.width/this._source.tileSize)+1,l=Math.ceil(e.height/this._source.tileSize)+1,u=Math.floor(s*l*(this._maxTileCacheZoomLevels===null?h.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),p=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,u):u;this._cache.setMaxSize(p)}handleWrapJump(e){const s=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,s){const l={};for(const u in this._tiles){const p=this._tiles[u];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+s),l[p.tileID.key]=p}this._tiles=l;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(u,this._tiles[u])}}_updateCoveredAndRetainedTiles(e,s,l,u,p,w){const k={},E={},A=Object.keys(e),R=Y.now();for(const B of A){const U=e[B],G=this._tiles[B];if(!G||G.fadeEndTime!==0&&G.fadeEndTime<=R)continue;const X=this.findLoadedParent(U,s),J=this.findLoadedSibling(U),te=X||J||null;te&&(this._addTile(te.tileID),k[te.tileID.key]=te.tileID),E[B]=U}this._retainLoadedChildren(E,u,l,e);for(const B in k)e[B]||(this._coveredTiles[B]=!0,e[B]=k[B]);if(w){const B={},U={};for(const G of p)this._tiles[G.key].hasData()?B[G.key]=G:U[G.key]=G;for(const G in U){const X=U[G].children(this._source.maxzoom);this._tiles[X[0].key]&&this._tiles[X[1].key]&&this._tiles[X[2].key]&&this._tiles[X[3].key]&&(B[X[0].key]=e[X[0].key]=X[0],B[X[1].key]=e[X[1].key]=X[1],B[X[2].key]=e[X[2].key]=X[2],B[X[3].key]=e[X[3].key]=X[3],delete U[G])}for(const G in U){const X=U[G],J=this.findLoadedParent(X,this._source.minzoom),te=this.findLoadedSibling(X),se=J||te||null;if(se){B[se.tileID.key]=e[se.tileID.key]=se.tileID;for(const ce in B)B[ce].isChildOf(se.tileID)&&delete B[ce]}}for(const G in this._tiles)B[G]||(this._coveredTiles[G]=!0)}}update(e,s){if(!this._sourceLoaded||this._paused)return;let l;this.transform=e,this.terrain=s,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((R=>new h.S(R.canonical.z,R.wrap,R.canonical.z,R.canonical.x,R.canonical.y))):(l=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s}),this._source.hasTile&&(l=l.filter((R=>this._source.hasTile(R))))):l=[];const u=e.coveringZoomLevel(this._source),p=Math.max(u-Rt.maxOverzooming,this._source.minzoom),w=Math.max(u+Rt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const R={};for(const B of l)if(B.canonical.z>this._source.minzoom){const U=B.scaledTo(B.canonical.z-1);R[U.key]=U;const G=B.scaledTo(Math.max(this._source.minzoom,Math.min(B.canonical.z,5)));R[G.key]=G}l=l.concat(Object.values(R))}const k=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,k&&this.fire(new h.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const E=this._updateRetainedTiles(l,u);gi(this._source.type)&&this._updateCoveredAndRetainedTiles(E,p,w,u,l,s);for(const R in E)this._tiles[R].clearFadeHold();const A=h.ab(this._tiles,E);for(const R of A){const B=this._tiles[R];B.hasSymbolBuckets&&!B.holdingForFade()?B.setHoldDuration(this.map._fadeDuration):B.hasSymbolBuckets&&!B.symbolFadeFinished()||this._removeTile(R)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,s){var l;const u={},p={},w=Math.max(s-Rt.maxOverzooming,this._source.minzoom),k=Math.max(s+Rt.maxUnderzooming,this._source.minzoom),E={};for(const A of e){const R=this._addTile(A);u[A.key]=A,R.hasData()||s<this._source.maxzoom&&(E[A.key]=A)}this._retainLoadedChildren(E,s,k,u);for(const A of e){let R=this._tiles[A.key];if(R.hasData())continue;if(s+1>this._source.maxzoom){const U=A.children(this._source.maxzoom)[0],G=this.getTile(U);if(G&&G.hasData()){u[U.key]=U;continue}}else{const U=A.children(this._source.maxzoom);if(u[U[0].key]&&u[U[1].key]&&u[U[2].key]&&u[U[3].key])continue}let B=R.wasRequested();for(let U=A.overscaledZ-1;U>=w;--U){const G=A.scaledTo(U);if(p[G.key])break;if(p[G.key]=!0,R=this.getTile(G),!R&&B&&(R=this._addTile(G)),R){const X=R.hasData();if((X||!(!((l=this.map)===null||l===void 0)&&l.cancelPendingTileRequestsWhileZooming)||B)&&(u[G.key]=G),B=R.wasRequested(),X)break}}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const s=[];let l,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){l=this._loadedParentTiles[u.key];break}s.push(u.key);const p=u.scaledTo(u.overscaledZ-1);if(l=this._getLoadedTile(p),l)break;u=p}for(const p of s)this._loadedParentTiles[p]=l}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const s=this._tiles[e].tileID,l=this._getLoadedTile(s);this._loadedSiblingTiles[s.key]=l}}_addTile(e){let s=this._tiles[e.key];if(s)return s;s=this._cache.getAndRemove(e),s&&(this._setTileReloadTimer(e.key,s),s.tileID=e,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,s)));const l=s;return s||(s=new fa(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(s,e.key,s.state)),s.uses++,this._tiles[e.key]=s,l||this._source.fire(new h.k("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(e,s){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const l=s.getExpiryTimeout();l&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),l))}_removeTile(e){const s=this._tiles[e];s&&(s.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}_dataHandler(e){const s=e.sourceDataType;e.dataType==="source"&&s==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&s==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,s,l){const u=[],p=this.transform;if(!p)return u;const w=l?p.getCameraQueryGeometry(e):e,k=e.map((X=>p.pointCoordinate(X,this.terrain))),E=w.map((X=>p.pointCoordinate(X,this.terrain))),A=this.getIds();let R=1/0,B=1/0,U=-1/0,G=-1/0;for(const X of E)R=Math.min(R,X.x),B=Math.min(B,X.y),U=Math.max(U,X.x),G=Math.max(G,X.y);for(let X=0;X<A.length;X++){const J=this._tiles[A[X]];if(J.holdingForFade())continue;const te=J.tileID,se=Math.pow(2,p.zoom-J.tileID.overscaledZ),ce=s*J.queryPadding*h.X/J.tileSize/se,Q=[te.getTilePoint(new h.Z(R,B)),te.getTilePoint(new h.Z(U,G))];if(Q[0].x-ce<h.X&&Q[0].y-ce<h.X&&Q[1].x+ce>=0&&Q[1].y+ce>=0){const fe=k.map((be=>te.getTilePoint(be))),ye=E.map((be=>te.getTilePoint(be)));u.push({tile:J,tileID:te,queryGeometry:fe,cameraQueryGeometry:ye,scale:se})}}return u}getVisibleCoordinates(e){const s=this.getRenderableIds(e).map((l=>this._tiles[l].tileID));for(const l of s)l.posMatrix=this.transform.calculatePosMatrix(l.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(gi(this._source.type)){const e=Y.now();for(const s in this._tiles)if(this._tiles[s].fadeEndTime>=e)return!0}return!1}setFeatureState(e,s,l){this._state.updateState(e=e||"_geojsonTileLayer",s,l)}removeFeatureState(e,s,l){this._state.removeFeatureState(e=e||"_geojsonTileLayer",s,l)}getFeatureState(e,s){return this._state.getState(e=e||"_geojsonTileLayer",s)}setDependencies(e,s,l){const u=this._tiles[e];u&&u.setDependencies(s,l)}reloadTilesForDependencies(e,s){for(const l in this._tiles)this._tiles[l].hasDependency(e,s)&&this._reloadTile(l,"reloading");this._cache.filter((l=>!l.hasDependency(e,s)))}}function Ln(f,e){const s=Math.abs(2*f.wrap)-+(f.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return f.overscaledZ-e.overscaledZ||l-s||e.canonical.y-f.canonical.y||e.canonical.x-f.canonical.x}function gi(f){return f==="raster"||f==="image"||f==="video"}Rt.maxOverzooming=10,Rt.maxUnderzooming=3;class jt{constructor(e,s){this.reset(e,s)}reset(e,s){this.points=e||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=h.ac(e,0,1);let s=1,l=this._distances[s];const u=e*this.paddedLength+this.padding;for(;l<u&&s<this._distances.length;)l=this._distances[++s];const p=s-1,w=this._distances[p],k=l-w,E=k>0?(u-w)/k:0;return this.points[p].mult(1-E).add(this.points[s].mult(E))}}function Ai(f,e){let s=!0;return f==="always"||f!=="never"&&e!=="never"||(s=!1),s}class Qi{constructor(e,s,l){const u=this.boxCells=[],p=this.circleCells=[];this.xCellCount=Math.ceil(e/l),this.yCellCount=Math.ceil(s/l);for(let w=0;w<this.xCellCount*this.yCellCount;w++)u.push([]),p.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=s,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,s,l,u,p){this._forEachCell(s,l,u,p,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(u),this.bboxes.push(p)}insertCircle(e,s,l,u){this._forEachCell(s-u,l-u,s+u,l+u,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(s),this.circles.push(l),this.circles.push(u)}_insertBoxCell(e,s,l,u,p,w){this.boxCells[p].push(w)}_insertCircleCell(e,s,l,u,p,w){this.circleCells[p].push(w)}_query(e,s,l,u,p,w,k){if(l<0||e>this.width||u<0||s>this.height)return[];const E=[];if(e<=0&&s<=0&&this.width<=l&&this.height<=u){if(p)return[{key:null,x1:e,y1:s,x2:l,y2:u}];for(let A=0;A<this.boxKeys.length;A++)E.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const R=this.circles[3*A],B=this.circles[3*A+1],U=this.circles[3*A+2];E.push({key:this.circleKeys[A],x1:R-U,y1:B-U,x2:R+U,y2:B+U})}}else this._forEachCell(e,s,l,u,this._queryCell,E,{hitTest:p,overlapMode:w,seenUids:{box:{},circle:{}}},k);return E}query(e,s,l,u){return this._query(e,s,l,u,!1,null)}hitTest(e,s,l,u,p,w){return this._query(e,s,l,u,!0,p,w).length>0}hitTestCircle(e,s,l,u,p){const w=e-l,k=e+l,E=s-l,A=s+l;if(k<0||w>this.width||A<0||E>this.height)return!1;const R=[];return this._forEachCell(w,E,k,A,this._queryCellCircle,R,{hitTest:!0,overlapMode:u,circle:{x:e,y:s,radius:l},seenUids:{box:{},circle:{}}},p),R.length>0}_queryCell(e,s,l,u,p,w,k,E){const{seenUids:A,hitTest:R,overlapMode:B}=k,U=this.boxCells[p];if(U!==null){const X=this.bboxes;for(const J of U)if(!A.box[J]){A.box[J]=!0;const te=4*J,se=this.boxKeys[J];if(e<=X[te+2]&&s<=X[te+3]&&l>=X[te+0]&&u>=X[te+1]&&(!E||E(se))&&(!R||!Ai(B,se.overlapMode))&&(w.push({key:se,x1:X[te],y1:X[te+1],x2:X[te+2],y2:X[te+3]}),R))return!0}}const G=this.circleCells[p];if(G!==null){const X=this.circles;for(const J of G)if(!A.circle[J]){A.circle[J]=!0;const te=3*J,se=this.circleKeys[J];if(this._circleAndRectCollide(X[te],X[te+1],X[te+2],e,s,l,u)&&(!E||E(se))&&(!R||!Ai(B,se.overlapMode))){const ce=X[te],Q=X[te+1],fe=X[te+2];if(w.push({key:se,x1:ce-fe,y1:Q-fe,x2:ce+fe,y2:Q+fe}),R)return!0}}}return!1}_queryCellCircle(e,s,l,u,p,w,k,E){const{circle:A,seenUids:R,overlapMode:B}=k,U=this.boxCells[p];if(U!==null){const X=this.bboxes;for(const J of U)if(!R.box[J]){R.box[J]=!0;const te=4*J,se=this.boxKeys[J];if(this._circleAndRectCollide(A.x,A.y,A.radius,X[te+0],X[te+1],X[te+2],X[te+3])&&(!E||E(se))&&!Ai(B,se.overlapMode))return w.push(!0),!0}}const G=this.circleCells[p];if(G!==null){const X=this.circles;for(const J of G)if(!R.circle[J]){R.circle[J]=!0;const te=3*J,se=this.circleKeys[J];if(this._circlesCollide(X[te],X[te+1],X[te+2],A.x,A.y,A.radius)&&(!E||E(se))&&!Ai(B,se.overlapMode))return w.push(!0),!0}}}_forEachCell(e,s,l,u,p,w,k,E){const A=this._convertToXCellCoord(e),R=this._convertToYCellCoord(s),B=this._convertToXCellCoord(l),U=this._convertToYCellCoord(u);for(let G=A;G<=B;G++)for(let X=R;X<=U;X++)if(p.call(this,e,s,l,u,this.xCellCount*X+G,w,k,E))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,s,l,u,p,w){const k=u-e,E=p-s,A=l+w;return A*A>k*k+E*E}_circleAndRectCollide(e,s,l,u,p,w,k){const E=(w-u)/2,A=Math.abs(e-(u+E));if(A>E+l)return!1;const R=(k-p)/2,B=Math.abs(s-(p+R));if(B>R+l)return!1;if(A<=E||B<=R)return!0;const U=A-E,G=B-R;return U*U+G*G<=l*l}}function yi(f,e,s,l,u){const p=h.H();return e?(h.K(p,p,[1/u,1/u,1]),s||h.ad(p,p,l.angle)):h.L(p,l.labelPlaneMatrix,f),p}function Un(f,e,s,l,u){if(e){const p=h.ae(f);return h.K(p,p,[u,u,1]),s||h.ad(p,p,-l.angle),p}return l.glCoordMatrix}function ie(f,e,s,l){let u;l?(u=[f,e,l(f,e),1],h.af(u,u,s)):(u=[f,e,0,1],fr(u,u,s));const p=u[3];return{point:new h.P(u[0]/p,u[1]/p),signedDistanceFromCamera:p,isOccluded:!1}}function j(f,e){return .5+f/e*.5}function N(f,e){return f.x>=-e[0]&&f.x<=e[0]&&f.y>=-e[1]&&f.y<=e[1]}function H(f,e,s,l,u,p,w,k,E,A,R,B,U,G,X){const J=l?f.textSizeData:f.iconSizeData,te=h.ag(J,s.transform.zoom),se=[256/s.width*2+1,256/s.height*2+1],ce=l?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;ce.clear();const Q=f.lineVertexArray,fe=l?f.text.placedSymbolArray:f.icon.placedSymbolArray,ye=s.transform.width/s.transform.height;let be=!1;for(let Fe=0;Fe<fe.length;Fe++){const Ge=fe.get(Fe);if(Ge.hidden||Ge.writingMode===h.ah.vertical&&!be){Ct(Ge.numGlyphs,ce);continue}be=!1;const Qe=ie(Ge.anchorX,Ge.anchorY,e,X);if(!N(Qe.point,se)){Ct(Ge.numGlyphs,ce);continue}const ut=j(s.transform.cameraToCenterDistance,Qe.signedDistanceFromCamera),tt=h.ai(J,te,Ge),Xe=w?tt/ut:tt*ut,_t={getElevation:X,labelPlaneMatrix:u,lineVertexArray:Q,pitchWithMap:w,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:A,tileAnchorPoint:new h.P(Ge.anchorX,Ge.anchorY),unwrappedTileID:R,width:B,height:U,translation:G},Ft=me(_t,Ge,Xe,!1,k,e,p,f.glyphOffsetArray,ce,ye,E);be=Ft.useVertical,(Ft.notEnoughRoom||be||Ft.needsFlipping&&me(_t,Ge,Xe,!0,k,e,p,f.glyphOffsetArray,ce,ye,E).notEnoughRoom)&&Ct(Ge.numGlyphs,ce)}l?f.text.dynamicLayoutVertexBuffer.updateData(ce):f.icon.dynamicLayoutVertexBuffer.updateData(ce)}function ee(f,e,s,l,u,p,w,k){const E=p.glyphStartIndex+p.numGlyphs,A=p.lineStartIndex,R=p.lineStartIndex+p.lineLength,B=e.getoffsetX(p.glyphStartIndex),U=e.getoffsetX(E-1),G=Ye(f*B,s,l,u,p.segment,A,R,k,w);if(!G)return null;const X=Ye(f*U,s,l,u,p.segment,A,R,k,w);return X?k.projectionCache.anyProjectionOccluded?null:{first:G,last:X}:null}function he(f,e,s,l){return f===h.ah.horizontal&&Math.abs(s.y-e.y)>Math.abs(s.x-e.x)*l?{useVertical:!0}:(f===h.ah.vertical?e.y<s.y:e.x>s.x)?{needsFlipping:!0}:null}function me(f,e,s,l,u,p,w,k,E,A,R){const B=s/24,U=e.lineOffsetX*B,G=e.lineOffsetY*B;let X;if(e.numGlyphs>1){const J=e.glyphStartIndex+e.numGlyphs,te=e.lineStartIndex,se=e.lineStartIndex+e.lineLength,ce=ee(B,k,U,G,l,e,R,f);if(!ce)return{notEnoughRoom:!0};const Q=ie(ce.first.point.x,ce.first.point.y,w,f.getElevation).point,fe=ie(ce.last.point.x,ce.last.point.y,w,f.getElevation).point;if(u&&!l){const ye=he(e.writingMode,Q,fe,A);if(ye)return ye}X=[ce.first];for(let ye=e.glyphStartIndex+1;ye<J-1;ye++)X.push(Ye(B*k.getoffsetX(ye),U,G,l,e.segment,te,se,f,R));X.push(ce.last)}else{if(u&&!l){const te=ie(f.tileAnchorPoint.x,f.tileAnchorPoint.y,p,f.getElevation).point,se=e.lineStartIndex+e.segment+1,ce=new h.P(f.lineVertexArray.getx(se),f.lineVertexArray.gety(se)),Q=ie(ce.x,ce.y,p,f.getElevation),fe=Q.signedDistanceFromCamera>0?Q.point:(function(be,Fe,Ge,Qe,ut,tt){return ve(be,Fe,Ge,1,ut,tt)})(f.tileAnchorPoint,ce,te,0,p,f),ye=he(e.writingMode,te,fe,A);if(ye)return ye}const J=Ye(B*k.getoffsetX(e.glyphStartIndex),U,G,l,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,f,R);if(!J||f.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};X=[J]}for(const J of X)h.aj(E,J.point,J.angle);return{}}function ve(f,e,s,l,u,p){const w=f.add(f.sub(e)._unit()),k=u!==void 0?ie(w.x,w.y,u,p.getElevation).point:Me(w.x,w.y,p).point,E=s.sub(k);return s.add(E._mult(l/E.mag()))}function le(f,e,s){const l=e.projectionCache;if(l.projections[f])return l.projections[f];const u=new h.P(e.lineVertexArray.getx(f),e.lineVertexArray.gety(f)),p=Me(u.x,u.y,e);if(p.signedDistanceFromCamera>0)return l.projections[f]=p.point,l.anyProjectionOccluded=l.anyProjectionOccluded||p.isOccluded,p.point;const w=f-s.direction;return(function(k,E,A,R,B){return ve(k,E,A,R,void 0,B)})(s.distanceFromAnchor===0?e.tileAnchorPoint:new h.P(e.lineVertexArray.getx(w),e.lineVertexArray.gety(w)),u,s.previousVertex,s.absOffsetX-s.distanceFromAnchor+1,e)}function Me(f,e,s){const l=f+s.translation[0],u=e+s.translation[1];let p;return!s.pitchWithMap&&s.projection.useSpecialProjectionForSymbols?(p=s.projection.projectTileCoordinates(l,u,s.unwrappedTileID,s.getElevation),p.point.x=(.5*p.point.x+.5)*s.width,p.point.y=(.5*-p.point.y+.5)*s.height):(p=ie(l,u,s.labelPlaneMatrix,s.getElevation),p.isOccluded=!1),p}function Oe(f,e,s){return f._unit()._perp()._mult(e*s)}function ke(f,e,s,l,u,p,w,k,E){if(k.projectionCache.offsets[f])return k.projectionCache.offsets[f];const A=s.add(e);if(f+E.direction<l||f+E.direction>=u)return k.projectionCache.offsets[f]=A,A;const R=le(f+E.direction,k,E),B=Oe(R.sub(s),w,E.direction),U=s.add(B),G=R.add(B);return k.projectionCache.offsets[f]=h.ak(p,A,U,G)||A,k.projectionCache.offsets[f]}function Ye(f,e,s,l,u,p,w,k,E){const A=l?f-e:f+e;let R=A>0?1:-1,B=0;l&&(R*=-1,B=Math.PI),R<0&&(B+=Math.PI);let U,G=R>0?p+u:p+u+1;k.projectionCache.cachedAnchorPoint?U=k.projectionCache.cachedAnchorPoint:(U=Me(k.tileAnchorPoint.x,k.tileAnchorPoint.y,k).point,k.projectionCache.cachedAnchorPoint=U);let X,J,te=U,se=U,ce=0,Q=0;const fe=Math.abs(A),ye=[];let be;for(;ce+Q<=fe;){if(G+=R,G<p||G>=w)return null;ce+=Q,se=te,J=X;const Qe={absOffsetX:fe,direction:R,distanceFromAnchor:ce,previousVertex:se};if(te=le(G,k,Qe),s===0)ye.push(se),be=te.sub(se);else{let ut;const tt=te.sub(se);ut=tt.mag()===0?Oe(le(G+R,k,Qe).sub(te),s,R):Oe(tt,s,R),J||(J=se.add(ut)),X=ke(G,ut,te,p,w,J,s,k,Qe),ye.push(J),be=X.sub(J)}Q=be.mag()}const Fe=be._mult((fe-ce)/Q)._add(J||se),Ge=B+Math.atan2(te.y-se.y,te.x-se.x);return ye.push(Fe),{point:Fe,angle:E?Ge:0,path:ye}}const wt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ct(f,e){for(let s=0;s<f;s++){const l=e.length;e.resize(l+4),e.float32.set(wt,3*l)}}function fr(f,e,s){const l=e[0],u=e[1];return f[0]=s[0]*l+s[4]*u+s[12],f[1]=s[1]*l+s[5]*u+s[13],f[3]=s[3]*l+s[7]*u+s[15],f}const Gt=100;class mr{constructor(e,s,l=new Qi(e.width+200,e.height+200,25),u=new Qi(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=s,this.grid=l,this.ignoredGrid=u,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Gt,this.screenBottomBoundary=e.height+Gt,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,s,l,u,p,w,k,E,A,R,B){const U=e.anchorPointX+E[0],G=e.anchorPointY+E[1],X=this.projectAndGetPerspectiveRatio(u,U,G,p,R),J=l*X.perspectiveRatio;let te;if(w||k)te=this._projectCollisionBox(e,J,u,p,w,k,E,X,R,B);else{const ye=X.point.x+(B?B.x*J:0),be=X.point.y+(B?B.y*J:0);te={allPointsOccluded:!1,box:[ye+e.x1*J,be+e.y1*J,ye+e.x2*J,be+e.y2*J]}}const[se,ce,Q,fe]=te.box;return this.mapProjection.useSpecialProjectionForSymbols&&(w?te.allPointsOccluded:this.mapProjection.isOccluded(U,G,p))||X.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(se,ce,Q,fe)||s!=="always"&&this.grid.hitTest(se,ce,Q,fe,s,A)?{box:[se,ce,Q,fe],placeable:!1,offscreen:!1}:{box:[se,ce,Q,fe],placeable:!0,offscreen:this.isOffscreen(se,ce,Q,fe)}}placeCollisionCircles(e,s,l,u,p,w,k,E,A,R,B,U,G,X,J,te){const se=[],ce=new h.P(s.anchorX,s.anchorY),Q=this.getPerspectiveRatio(w,ce.x,ce.y,k,te),fe=(B?p/Q:p*Q)/h.ap,ye={getElevation:te,labelPlaneMatrix:E,lineVertexArray:l,pitchWithMap:B,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:ce,unwrappedTileID:k,width:this.transform.width,height:this.transform.height,translation:J},be=ee(fe,u,s.lineOffsetX*fe,s.lineOffsetY*fe,!1,s,!1,ye);let Fe=!1,Ge=!1,Qe=!0;if(be){const ut=.5*G*Q+X,tt=new h.P(-100,-100),Xe=new h.P(this.screenRightBoundary,this.screenBottomBoundary),_t=new jt,Ft=be.first,nt=be.last;let st=[];for(let Ht=Ft.path.length-1;Ht>=1;Ht--)st.push(Ft.path[Ht]);for(let Ht=1;Ht<nt.path.length;Ht++)st.push(nt.path[Ht]);const Bt=2.5*ut;if(A){const Ht=this.projectPathToScreenSpace(st,ye,A);st=Ht.some((Qt=>Qt.signedDistanceFromCamera<=0))?[]:Ht.map((Qt=>Qt.point))}let Cr=[];if(st.length>0){const Ht=st[0].clone(),Qt=st[0].clone();for(let zr=1;zr<st.length;zr++)Ht.x=Math.min(Ht.x,st[zr].x),Ht.y=Math.min(Ht.y,st[zr].y),Qt.x=Math.max(Qt.x,st[zr].x),Qt.y=Math.max(Qt.y,st[zr].y);Cr=Ht.x>=tt.x&&Qt.x<=Xe.x&&Ht.y>=tt.y&&Qt.y<=Xe.y?[st]:Qt.x<tt.x||Ht.x>Xe.x||Qt.y<tt.y||Ht.y>Xe.y?[]:h.al([st],tt.x,tt.y,Xe.x,Xe.y)}for(const Ht of Cr){_t.reset(Ht,.25*ut);let Qt=0;Qt=_t.length<=.5*ut?1:Math.ceil(_t.paddedLength/Bt)+1;for(let zr=0;zr<Qt;zr++){const Tn=zr/Math.max(Qt-1,1),bi=_t.lerp(Tn),Dr=bi.x+Gt,_n=bi.y+Gt;se.push(Dr,_n,ut,0);const Ur=Dr-ut,rn=_n-ut,Mn=Dr+ut,ls=_n+ut;if(Qe=Qe&&this.isOffscreen(Ur,rn,Mn,ls),Ge=Ge||this.isInsideGrid(Ur,rn,Mn,ls),e!=="always"&&this.grid.hitTestCircle(Dr,_n,ut,e,U)&&(Fe=!0,!R))return{circles:[],offscreen:!1,collisionDetected:Fe}}}}return{circles:!R&&Fe||!Ge||Q<this.perspectiveRatioCutoff?[]:se,offscreen:Qe,collisionDetected:Fe}}projectPathToScreenSpace(e,s,l){return e.map((u=>ie(u.x,u.y,l,s.getElevation)))}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let l=1/0,u=1/0,p=-1/0,w=-1/0;for(const R of e){const B=new h.P(R.x+Gt,R.y+Gt);l=Math.min(l,B.x),u=Math.min(u,B.y),p=Math.max(p,B.x),w=Math.max(w,B.y),s.push(B)}const k=this.grid.query(l,u,p,w).concat(this.ignoredGrid.query(l,u,p,w)),E={},A={};for(const R of k){const B=R.key;if(E[B.bucketInstanceId]===void 0&&(E[B.bucketInstanceId]={}),E[B.bucketInstanceId][B.featureIndex])continue;const U=[new h.P(R.x1,R.y1),new h.P(R.x2,R.y1),new h.P(R.x2,R.y2),new h.P(R.x1,R.y2)];h.am(s,U)&&(E[B.bucketInstanceId][B.featureIndex]=!0,A[B.bucketInstanceId]===void 0&&(A[B.bucketInstanceId]=[]),A[B.bucketInstanceId].push(B.featureIndex))}return A}insertCollisionBox(e,s,l,u,p,w){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:p,collisionGroupID:w,overlapMode:s},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,s,l,u,p,w){const k=l?this.ignoredGrid:this.grid,E={bucketInstanceId:u,featureIndex:p,collisionGroupID:w,overlapMode:s};for(let A=0;A<e.length;A+=4)k.insertCircle(E,e[A],e[A+1],e[A+2])}projectAndGetPerspectiveRatio(e,s,l,u,p){let w;p?(w=[s,l,p(s,l),1],h.af(w,w,e)):(w=[s,l,0,1],fr(w,w,e));const k=w[3];return{point:new h.P((w[0]/k+1)/2*this.transform.width+Gt,(-w[1]/k+1)/2*this.transform.height+Gt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/k*.5,isOccluded:!1,signedDistanceFromCamera:k}}getPerspectiveRatio(e,s,l,u,p){const w=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(s,l,u,p):ie(s,l,e,p);return .5+this.transform.cameraToCenterDistance/w.signedDistanceFromCamera*.5}isOffscreen(e,s,l,u){return l<Gt||e>=this.screenRightBoundary||u<Gt||s>this.screenBottomBoundary}isInsideGrid(e,s,l,u){return l>=0&&e<this.gridRightBoundary&&u>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const e=h.an([]);return h.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,s,l,u,p,w,k,E,A,R){let B=new h.P(1,0),U=new h.P(0,1);const G=new h.P(e.anchorPointX+k[0],e.anchorPointY+k[1]);if(w&&!p){const Qe=this.projectAndGetPerspectiveRatio(l,G.x+1,G.y,u,A).point.sub(E.point).unit(),ut=Math.atan(Qe.y/Qe.x)+(Qe.x<0?Math.PI:0),tt=Math.sin(ut),Xe=Math.cos(ut);B=new h.P(Xe,tt),U=new h.P(-tt,Xe)}else if(!w&&p){const Qe=-this.transform.angle,ut=Math.sin(Qe),tt=Math.cos(Qe);B=new h.P(tt,ut),U=new h.P(-ut,tt)}let X=E.point,J=s;if(p){X=G;const Qe=this.transform.zoom-Math.floor(this.transform.zoom);J=Math.pow(2,-Qe),J*=this.mapProjection.getPitchedTextCorrection(this.transform,G,u),R||(J*=h.ac(.5+E.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}R&&(X=X.add(B.mult(R.x*J)).add(U.mult(R.y*J)));const te=e.x1*J,se=e.x2*J,ce=(te+se)/2,Q=e.y1*J,fe=e.y2*J,ye=(Q+fe)/2,be=[{offsetX:te,offsetY:Q},{offsetX:ce,offsetY:Q},{offsetX:se,offsetY:Q},{offsetX:se,offsetY:ye},{offsetX:se,offsetY:fe},{offsetX:ce,offsetY:fe},{offsetX:te,offsetY:fe},{offsetX:te,offsetY:ye}];let Fe=[];for(const{offsetX:Qe,offsetY:ut}of be)Fe.push(new h.P(X.x+B.x*Qe+U.x*ut,X.y+B.y*Qe+U.y*ut));let Ge=!1;if(p){const Qe=Fe.map((ut=>this.projectAndGetPerspectiveRatio(l,ut.x,ut.y,u,A)));Ge=Qe.some((ut=>!ut.isOccluded)),Fe=Qe.map((ut=>ut.point))}else Ge=!0;return{box:h.ao(Fe),allPointsOccluded:!Ge}}}function Wt(f,e,s){return e*(h.X/(f.tileSize*Math.pow(2,s-f.tileID.overscaledZ)))}class sn{constructor(e,s,l,u){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?s:-s))):u&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class Gr{constructor(e,s,l,u,p){this.text=new sn(e?e.text:null,s,l,p),this.icon=new sn(e?e.icon:null,s,u,p)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class tr{constructor(e,s,l){this.text=e,this.icon=s,this.skipFade=l}}class br{constructor(){this.invProjMatrix=h.H(),this.viewportMatrix=h.H(),this.circles=[]}}class jr{constructor(e,s,l,u,p){this.bucketInstanceId=e,this.featureIndex=s,this.sourceLayerIndex=l,this.bucketIndex=u,this.tileID=p}}class yn{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const s=++this.maxGroupID;this.collisionGroups[e]={ID:s,predicate:l=>l.collisionGroupID===s}}return this.collisionGroups[e]}}function Sn(f,e,s,l,u){const{horizontalAlign:p,verticalAlign:w}=h.au(f);return new h.P(-(p-.5)*e+l[0]*u,-(w-.5)*s+l[1]*u)}class $n{constructor(e,s,l,u,p,w){this.transform=e.clone(),this.terrain=l,this.collisionIndex=new mr(this.transform,s),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new yn(p),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=w,w&&(w.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const s=this.terrain;return s?(l,u)=>s.getElevation(e,l,u):null}getBucketParts(e,s,l,u){const p=l.getBucket(s),w=l.latestFeatureIndex;if(!p||!w||s.id!==p.layerIds[0])return;const k=l.collisionBoxArray,E=p.layers[0].layout,A=p.layers[0].paint,R=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),B=l.tileSize/h.X,U=l.tileID.toUnwrapped(),G=this.transform.calculatePosMatrix(U),X=E.get("text-pitch-alignment")==="map",J=E.get("text-rotation-alignment")==="map",te=Wt(l,1,this.transform.zoom),se=this.collisionIndex.mapProjection.translatePosition(this.transform,l,A.get("text-translate"),A.get("text-translate-anchor")),ce=this.collisionIndex.mapProjection.translatePosition(this.transform,l,A.get("icon-translate"),A.get("icon-translate-anchor")),Q=yi(G,X,J,this.transform,te);let fe=null;if(X){const be=Un(G,X,J,this.transform,te);fe=h.L([],this.transform.labelPlaneMatrix,be)}this.retainedQueryData[p.bucketInstanceId]=new jr(p.bucketInstanceId,w,p.sourceLayerIndex,p.index,l.tileID);const ye={bucket:p,layout:E,translationText:se,translationIcon:ce,posMatrix:G,unwrappedTileID:U,textLabelPlaneMatrix:Q,labelToScreenMatrix:fe,scale:R,textPixelRatio:B,holdingForFade:l.holdingForFade(),collisionBoxArray:k,partiallyEvaluatedTextSize:h.ag(p.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(p.sourceID)};if(u)for(const be of p.sortKeyRanges){const{sortKey:Fe,symbolInstanceStart:Ge,symbolInstanceEnd:Qe}=be;e.push({sortKey:Fe,symbolInstanceStart:Ge,symbolInstanceEnd:Qe,parameters:ye})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:p.symbolInstances.length,parameters:ye})}attemptAnchorPlacement(e,s,l,u,p,w,k,E,A,R,B,U,G,X,J,te,se,ce,Q){const fe=h.aq[e.textAnchor],ye=[e.textOffset0,e.textOffset1],be=Sn(fe,l,u,ye,p),Fe=this.collisionIndex.placeCollisionBox(s,U,E,A,R,k,w,te,B.predicate,Q,be);if((!ce||this.collisionIndex.placeCollisionBox(ce,U,E,A,R,k,w,se,B.predicate,Q,be).placeable)&&Fe.placeable){let Ge;if(this.prevPlacement&&this.prevPlacement.variableOffsets[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID].text&&(Ge=this.prevPlacement.variableOffsets[G.crossTileID].anchor),G.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[G.crossTileID]={textOffset:ye,width:l,height:u,anchor:fe,textBoxScale:p,prevAnchor:Ge},this.markUsedJustification(X,fe,G,J),X.allowVerticalPlacement&&(this.markUsedOrientation(X,J,G),this.placedOrientations[G.crossTileID]=J),{shift:be,placedGlyphBoxes:Fe}}}placeLayerBucketPart(e,s,l){const{bucket:u,layout:p,translationText:w,translationIcon:k,posMatrix:E,unwrappedTileID:A,textLabelPlaneMatrix:R,labelToScreenMatrix:B,textPixelRatio:U,holdingForFade:G,collisionBoxArray:X,partiallyEvaluatedTextSize:J,collisionGroup:te}=e.parameters,se=p.get("text-optional"),ce=p.get("icon-optional"),Q=h.ar(p,"text-overlap","text-allow-overlap"),fe=Q==="always",ye=h.ar(p,"icon-overlap","icon-allow-overlap"),be=ye==="always",Fe=p.get("text-rotation-alignment")==="map",Ge=p.get("text-pitch-alignment")==="map",Qe=p.get("icon-text-fit")!=="none",ut=p.get("symbol-z-order")==="viewport-y",tt=fe&&(be||!u.hasIconData()||ce),Xe=be&&(fe||!u.hasTextData()||se);!u.collisionArrays&&X&&u.deserializeCollisionBoxes(X);const _t=this._getTerrainElevationFunc(this.retainedQueryData[u.bucketInstanceId].tileID),Ft=(nt,st,Bt)=>{var Cr,Ht;if(s[nt.crossTileID])return;if(G)return void(this.placements[nt.crossTileID]=new tr(!1,!1,!1));let Qt=!1,zr=!1,Tn=!0,bi=null,Dr={box:null,placeable:!1,offscreen:null},_n={placeable:!1},Ur=null,rn=null,Mn=null,ls=0,ai=0,us=0;st.textFeatureIndex?ls=st.textFeatureIndex:nt.useRuntimeCollisionCircles&&(ls=nt.featureIndex),st.verticalTextFeatureIndex&&(ai=st.verticalTextFeatureIndex);const Pa=st.textBox;if(Pa){const Hn=ln=>{let qr=h.ah.horizontal;if(u.allowVerticalPlacement&&!ln&&this.prevPlacement){const An=this.prevPlacement.placedOrientations[nt.crossTileID];An&&(this.placedOrientations[nt.crossTileID]=An,qr=An,this.markUsedOrientation(u,qr,nt))}return qr},ki=(ln,qr)=>{if(u.allowVerticalPlacement&&nt.numVerticalGlyphVertices>0&&st.verticalTextBox){for(const An of u.writingModes)if(An===h.ah.vertical?(Dr=qr(),_n=Dr):Dr=ln(),Dr&&Dr.placeable)break}else Dr=ln()},cs=nt.textAnchorOffsetStartIndex,Ni=nt.textAnchorOffsetEndIndex;if(Ni===cs){const ln=(qr,An)=>{const rr=this.collisionIndex.placeCollisionBox(qr,Q,U,E,A,Ge,Fe,w,te.predicate,_t);return rr&&rr.placeable&&(this.markUsedOrientation(u,An,nt),this.placedOrientations[nt.crossTileID]=An),rr};ki((()=>ln(Pa,h.ah.horizontal)),(()=>{const qr=st.verticalTextBox;return u.allowVerticalPlacement&&nt.numVerticalGlyphVertices>0&&qr?ln(qr,h.ah.vertical):{box:null,offscreen:null}})),Hn(Dr&&Dr.placeable)}else{let ln=h.aq[(Ht=(Cr=this.prevPlacement)===null||Cr===void 0?void 0:Cr.variableOffsets[nt.crossTileID])===null||Ht===void 0?void 0:Ht.anchor];const qr=(rr,Ti,Ca)=>{const hs=rr.x2-rr.x1,rc=rr.y2-rr.y1,nc=nt.textBoxScale,Hr=Qe&&ye==="never"?Ti:null;let ds=null,du=Q==="never"?1:2,Ro="never";ln&&du++;for(let Ma=0;Ma<du;Ma++){for(let Bo=cs;Bo<Ni;Bo++){const Ds=u.textAnchorOffsets.get(Bo);if(ln&&Ds.textAnchor!==ln)continue;const Lr=this.attemptAnchorPlacement(Ds,rr,hs,rc,nc,Fe,Ge,U,E,A,te,Ro,nt,u,Ca,w,k,Hr,_t);if(Lr&&(ds=Lr.placedGlyphBoxes,ds&&ds.placeable))return Qt=!0,bi=Lr.shift,ds}ln?ln=null:Ro=Q}return l&&!ds&&(ds={box:this.collisionIndex.placeCollisionBox(Pa,"always",U,E,A,Ge,Fe,w,te.predicate,_t,new h.P(0,0)).box,offscreen:!1,placeable:!1}),ds};ki((()=>qr(Pa,st.iconBox,h.ah.horizontal)),(()=>{const rr=st.verticalTextBox;return u.allowVerticalPlacement&&(!Dr||!Dr.placeable)&&nt.numVerticalGlyphVertices>0&&rr?qr(rr,st.verticalIconBox,h.ah.vertical):{box:null,occluded:!0,offscreen:null}})),Dr&&(Qt=Dr.placeable,Tn=Dr.offscreen);const An=Hn(Dr&&Dr.placeable);if(!Qt&&this.prevPlacement){const rr=this.prevPlacement.variableOffsets[nt.crossTileID];rr&&(this.variableOffsets[nt.crossTileID]=rr,this.markUsedJustification(u,rr.anchor,nt,An))}}}if(Ur=Dr,Qt=Ur&&Ur.placeable,Tn=Ur&&Ur.offscreen,nt.useRuntimeCollisionCircles){const Hn=u.text.placedSymbolArray.get(nt.centerJustifiedTextSymbolIndex),ki=h.ai(u.textSizeData,J,Hn),cs=p.get("text-padding");rn=this.collisionIndex.placeCollisionCircles(Q,Hn,u.lineVertexArray,u.glyphOffsetArray,ki,E,A,R,B,l,Ge,te.predicate,nt.collisionCircleDiameter,cs,w,_t),rn.circles.length&&rn.collisionDetected&&!l&&h.w("Collisions detected, but collision boxes are not shown"),Qt=fe||rn.circles.length>0&&!rn.collisionDetected,Tn=Tn&&rn.offscreen}if(st.iconFeatureIndex&&(us=st.iconFeatureIndex),st.iconBox){const Hn=ki=>this.collisionIndex.placeCollisionBox(ki,ye,U,E,A,Ge,Fe,k,te.predicate,_t,Qe&&bi?bi:void 0);_n&&_n.placeable&&st.verticalIconBox?(Mn=Hn(st.verticalIconBox),zr=Mn.placeable):(Mn=Hn(st.iconBox),zr=Mn.placeable),Tn=Tn&&Mn.offscreen}const Si=se||nt.numHorizontalGlyphVertices===0&&nt.numVerticalGlyphVertices===0,Oi=ce||nt.numIconVertices===0;Si||Oi?Oi?Si||(zr=zr&&Qt):Qt=zr&&Qt:zr=Qt=zr&&Qt;const zs=zr&&Mn.placeable;if(Qt&&Ur.placeable&&this.collisionIndex.insertCollisionBox(Ur.box,Q,p.get("text-ignore-placement"),u.bucketInstanceId,_n&&_n.placeable&&ai?ai:ls,te.ID),zs&&this.collisionIndex.insertCollisionBox(Mn.box,ye,p.get("icon-ignore-placement"),u.bucketInstanceId,us,te.ID),rn&&Qt&&this.collisionIndex.insertCollisionCircles(rn.circles,Q,p.get("text-ignore-placement"),u.bucketInstanceId,ls,te.ID),l&&this.storeCollisionData(u.bucketInstanceId,Bt,st,Ur,Mn,rn),nt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(u.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[nt.crossTileID]=new tr(Qt||tt,zr||Xe,Tn||u.justReloaded),s[nt.crossTileID]=!0};if(ut){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const nt=u.getSortedSymbolIndexes(this.transform.angle);for(let st=nt.length-1;st>=0;--st){const Bt=nt[st];Ft(u.symbolInstances.get(Bt),u.collisionArrays[Bt],Bt)}}else for(let nt=e.symbolInstanceStart;nt<e.symbolInstanceEnd;nt++)Ft(u.symbolInstances.get(nt),u.collisionArrays[nt],nt);if(l&&u.bucketInstanceId in this.collisionCircleArrays){const nt=this.collisionCircleArrays[u.bucketInstanceId];h.as(nt.invProjMatrix,E),nt.viewportMatrix=this.collisionIndex.getViewportMatrix()}u.justReloaded=!1}storeCollisionData(e,s,l,u,p,w){if(l.textBox||l.iconBox){let k,E;this.collisionBoxArrays.has(e)?k=this.collisionBoxArrays.get(e):(k=new Map,this.collisionBoxArrays.set(e,k)),k.has(s)?E=k.get(s):(E={text:null,icon:null},k.set(s,E)),l.textBox&&(E.text=u.box),l.iconBox&&(E.icon=p.box)}if(w){let k=this.collisionCircleArrays[e];k===void 0&&(k=this.collisionCircleArrays[e]=new br);for(let E=0;E<w.circles.length;E+=4)k.circles.push(w.circles[E+0]),k.circles.push(w.circles[E+1]),k.circles.push(w.circles[E+2]),k.circles.push(w.collisionDetected?1:0)}}markUsedJustification(e,s,l,u){let p;p=u===h.ah.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[h.at(s)];const w=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const k of w)k>=0&&(e.text.placedSymbolArray.get(k).crossTileID=p>=0&&k!==p?0:l.crossTileID)}markUsedOrientation(e,s,l){const u=s===h.ah.horizontal||s===h.ah.horizontalOnly?s:0,p=s===h.ah.vertical?s:0,w=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const k of w)e.text.placedSymbolArray.get(k).placedOrientation=u;l.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=p)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let l=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const u=s?s.symbolFadeChange(e):1,p=s?s.opacities:{},w=s?s.variableOffsets:{},k=s?s.placedOrientations:{};for(const E in this.placements){const A=this.placements[E],R=p[E];R?(this.opacities[E]=new Gr(R,u,A.text,A.icon),l=l||A.text!==R.text.placed||A.icon!==R.icon.placed):(this.opacities[E]=new Gr(null,u,A.text,A.icon,A.skipFade),l=l||A.text||A.icon)}for(const E in p){const A=p[E];if(!this.opacities[E]){const R=new Gr(A,u,!1,!1);R.isHidden()||(this.opacities[E]=R,l=l||A.text.placed||A.icon.placed)}}for(const E in w)this.variableOffsets[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.variableOffsets[E]=w[E]);for(const E in k)this.placedOrientations[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.placedOrientations[E]=k[E]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:e)}updateLayerOpacities(e,s){const l={};for(const u of s){const p=u.getBucket(e);p&&u.latestFeatureIndex&&e.id===p.layerIds[0]&&this.updateBucketOpacities(p,u.tileID,l,u.collisionBoxArray)}}updateBucketOpacities(e,s,l,u){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const p=e.layers[0],w=p.layout,k=new Gr(null,0,!1,!1,!0),E=w.get("text-allow-overlap"),A=w.get("icon-allow-overlap"),R=p._unevaluatedLayout.hasValue("text-variable-anchor")||p._unevaluatedLayout.hasValue("text-variable-anchor-offset"),B=w.get("text-rotation-alignment")==="map",U=w.get("text-pitch-alignment")==="map",G=w.get("icon-text-fit")!=="none",X=new Gr(null,0,E&&(A||!e.hasIconData()||w.get("icon-optional")),A&&(E||!e.hasTextData()||w.get("text-optional")),!0);!e.collisionArrays&&u&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(u);const J=(se,ce,Q)=>{for(let fe=0;fe<ce/4;fe++)se.opacityVertexArray.emplaceBack(Q);se.hasVisibleVertices=se.hasVisibleVertices||Q!==qn},te=this.collisionBoxArrays.get(e.bucketInstanceId);for(let se=0;se<e.symbolInstances.length;se++){const ce=e.symbolInstances.get(se),{numHorizontalGlyphVertices:Q,numVerticalGlyphVertices:fe,crossTileID:ye}=ce;let be=this.opacities[ye];l[ye]?be=k:be||(be=X,this.opacities[ye]=be),l[ye]=!0;const Fe=ce.numIconVertices>0,Ge=this.placedOrientations[ce.crossTileID],Qe=Ge===h.ah.vertical,ut=Ge===h.ah.horizontal||Ge===h.ah.horizontalOnly;if(Q>0||fe>0){const Xe=Bn(be.text);J(e.text,Q,Qe?qn:Xe),J(e.text,fe,ut?qn:Xe);const _t=be.text.isHidden();[ce.rightJustifiedTextSymbolIndex,ce.centerJustifiedTextSymbolIndex,ce.leftJustifiedTextSymbolIndex].forEach((st=>{st>=0&&(e.text.placedSymbolArray.get(st).hidden=_t||Qe?1:0)})),ce.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(ce.verticalPlacedTextSymbolIndex).hidden=_t||ut?1:0);const Ft=this.variableOffsets[ce.crossTileID];Ft&&this.markUsedJustification(e,Ft.anchor,ce,Ge);const nt=this.placedOrientations[ce.crossTileID];nt&&(this.markUsedJustification(e,"left",ce,nt),this.markUsedOrientation(e,nt,ce))}if(Fe){const Xe=Bn(be.icon),_t=!(G&&ce.verticalPlacedIconSymbolIndex&&Qe);ce.placedIconSymbolIndex>=0&&(J(e.icon,ce.numIconVertices,_t?Xe:qn),e.icon.placedSymbolArray.get(ce.placedIconSymbolIndex).hidden=be.icon.isHidden()),ce.verticalPlacedIconSymbolIndex>=0&&(J(e.icon,ce.numVerticalIconVertices,_t?qn:Xe),e.icon.placedSymbolArray.get(ce.verticalPlacedIconSymbolIndex).hidden=be.icon.isHidden())}const tt=te&&te.has(se)?te.get(se):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Xe=e.collisionArrays[se];if(Xe){let _t=new h.P(0,0);if(Xe.textBox||Xe.verticalTextBox){let Ft=!0;if(R){const nt=this.variableOffsets[ye];nt?(_t=Sn(nt.anchor,nt.width,nt.height,nt.textOffset,nt.textBoxScale),B&&_t._rotate(U?this.transform.angle:-this.transform.angle)):Ft=!1}if(Xe.textBox||Xe.verticalTextBox){let nt;Xe.textBox&&(nt=Qe),Xe.verticalTextBox&&(nt=ut),po(e.textCollisionBox.collisionVertexArray,be.text.placed,!Ft||nt,tt.text,_t.x,_t.y)}}if(Xe.iconBox||Xe.verticalIconBox){const Ft=!!(!ut&&Xe.verticalIconBox);let nt;Xe.iconBox&&(nt=Ft),Xe.verticalIconBox&&(nt=!Ft),po(e.iconCollisionBox.collisionVertexArray,be.icon.placed,nt,tt.icon,G?_t.x:0,G?_t.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const se=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=se.invProjMatrix,e.placementViewportMatrix=se.viewportMatrix,e.collisionCircleArray=se.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,s){const l=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*l>e}setStale(){this.stale=!0}}function po(f,e,s,l,u,p){l&&l.length!==0||(l=[0,0,0,0]);const w=l[0]-Gt,k=l[1]-Gt,E=l[2]-Gt,A=l[3]-Gt;f.emplaceBack(e?1:0,s?1:0,u||0,p||0,w,k),f.emplaceBack(e?1:0,s?1:0,u||0,p||0,E,k),f.emplaceBack(e?1:0,s?1:0,u||0,p||0,E,A),f.emplaceBack(e?1:0,s?1:0,u||0,p||0,w,A)}const Vt=Math.pow(2,25),zu=Math.pow(2,24),tl=Math.pow(2,17),Qn=Math.pow(2,16),Rn=Math.pow(2,9),Jh=Math.pow(2,8),_i=Math.pow(2,1);function Bn(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const e=f.placed?1:0,s=Math.floor(127*f.opacity);return s*Vt+e*zu+s*tl+e*Qn+s*Rn+e*Jh+s*_i+e}const qn=0;function Oa(){return{isOccluded:(f,e,s)=>!1,getPitchedTextCorrection:(f,e,s)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(f,e,s,l){throw new Error("Not implemented.")},translatePosition:(f,e,s,l)=>(function(u,p,w,k,E=!1){if(!w[0]&&!w[1])return[0,0];const A=E?k==="map"?u.angle:0:k==="viewport"?-u.angle:0;if(A){const R=Math.sin(A),B=Math.cos(A);w=[w[0]*B-w[1]*R,w[0]*R+w[1]*B]}return[E?w[0]:Wt(p,w[0],u.zoom),E?w[1]:Wt(p,w[1],u.zoom)]})(f,e,s,l),getCircleRadiusCorrection:f=>1}}class Er{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,s,l,u,p){const w=this._bucketParts;for(;this._currentTileIndex<e.length;)if(s.getBucketParts(w,u,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,p())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort(((k,E)=>k.sortKey-E.sortKey)));this._currentPartIndex<w.length;)if(s.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,p())return!0;return!1}}class rl{constructor(e,s,l,u,p,w,k,E){this.placement=new $n(e,Oa(),s,w,k,E),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(e,s,l){const u=Y.now(),p=()=>!this._forceFullPlacement&&Y.now()-u>2;for(;this._currentPlacementIndex>=0;){const w=s[e[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if(w.type==="symbol"&&(!w.minzoom||w.minzoom<=k)&&(!w.maxzoom||w.maxzoom>k)){if(this._inProgressLayer||(this._inProgressLayer=new Er(w)),this._inProgressLayer.continuePlacement(l[w.source],this.placement,this._showCollisionBoxes,w,p))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const es=512/h.X/2;class an{constructor(e,s,l){this.tileID=e,this.bucketInstanceId=l,this._symbolsByKey={};const u=new Map;for(let p=0;p<s.length;p++){const w=s.get(p),k=w.key,E=u.get(k);E?E.push(w):u.set(k,[w])}for(const[p,w]of u){const k={positions:w.map((E=>({x:Math.floor(E.anchorX*es),y:Math.floor(E.anchorY*es)}))),crossTileIDs:w.map((E=>E.crossTileID))};if(k.positions.length>128){const E=new h.av(k.positions.length,16,Uint16Array);for(const{x:A,y:R}of k.positions)E.add(A,R);E.finish(),delete k.positions,k.index=E}this._symbolsByKey[p]=k}}getScaledCoordinates(e,s){const{x:l,y:u,z:p}=this.tileID.canonical,{x:w,y:k,z:E}=s.canonical,A=es/Math.pow(2,E-p),R=(k*h.X+e.anchorY)*A,B=u*h.X*es;return{x:Math.floor((w*h.X+e.anchorX)*A-l*h.X*es),y:Math.floor(R-B)}}findMatches(e,s,l){const u=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let p=0;p<e.length;p++){const w=e.get(p);if(w.crossTileID)continue;const k=this._symbolsByKey[w.key];if(!k)continue;const E=this.getScaledCoordinates(w,s);if(k.index){const A=k.index.range(E.x-u,E.y-u,E.x+u,E.y+u).sort();for(const R of A){const B=k.crossTileIDs[R];if(!l[B]){l[B]=!0,w.crossTileID=B;break}}}else if(k.positions)for(let A=0;A<k.positions.length;A++){const R=k.positions[A],B=k.crossTileIDs[A];if(Math.abs(R.x-E.x)<=u&&Math.abs(R.y-E.y)<=u&&!l[B]){l[B]=!0,w.crossTileID=B;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:e})=>e))}}class Na{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ei{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const s=Math.round((e-this.lng)/360);if(s!==0)for(const l in this.indexes){const u=this.indexes[l],p={};for(const w in u){const k=u[w];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+s),p[k.tileID.key]=k}this.indexes[l]=p}this.lng=e}addBucket(e,s,l){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let p=0;p<s.symbolInstances.length;p++)s.symbolInstances.get(p).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const u=this.usedCrossTileIDs[e.overscaledZ];for(const p in this.indexes){const w=this.indexes[p];if(Number(p)>e.overscaledZ)for(const k in w){const E=w[k];E.tileID.isChildOf(e)&&E.findMatches(s.symbolInstances,e,u)}else{const k=w[e.scaledTo(Number(p)).key];k&&k.findMatches(s.symbolInstances,e,u)}}for(let p=0;p<s.symbolInstances.length;p++){const w=s.symbolInstances.get(p);w.crossTileID||(w.crossTileID=l.generate(),u[w.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new an(e,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(e,s){for(const l of s.getCrossTileIDsLists())for(const u of l)delete this.usedCrossTileIDs[e][u]}removeStaleBuckets(e){let s=!1;for(const l in this.indexes){const u=this.indexes[l];for(const p in u)e[u[p].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,u[p]),delete u[p],s=!0)}return s}}class ja{constructor(){this.layerIndexes={},this.crossTileIDs=new Na,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,s,l){let u=this.layerIndexes[e.id];u===void 0&&(u=this.layerIndexes[e.id]=new ei);let p=!1;const w={};u.handleWrapJump(l);for(const k of s){const E=k.getBucket(e);E&&e.id===E.layerIds[0]&&(E.bucketInstanceId||(E.bucketInstanceId=++this.maxBucketInstanceId),u.addBucket(k.tileID,E,this.crossTileIDs)&&(p=!0),w[E.bucketInstanceId]=!0)}return u.removeStaleBuckets(w)&&(p=!0),p}pruneUnusedLayers(e){const s={};e.forEach((l=>{s[l]=!0}));for(const l in this.layerIndexes)s[l]||delete this.layerIndexes[l]}}const ti=(f,e)=>h.t(f,e&&e.filter((s=>s.identifier!=="source.canvas"))),Qh=h.aw();class $l extends h.E{constructor(e,s={}){super(),this._rtlPluginLoaded=()=>{for(const l in this.sourceCaches){const u=this.sourceCaches[l].getSource().type;u!=="vector"&&u!=="geojson"||this.sourceCaches[l].reload()}},this.map=e,this.dispatcher=new mn(Ir(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",((l,u)=>this.getGlyphs(l,u))),this.dispatcher.registerMessageHandler("GI",((l,u)=>this.getImages(l,u))),this.imageManager=new Zt,this.imageManager.setEventedParent(this),this.glyphManager=new $t(e._requestManager,s.localIdeographFontFamily),this.lineAtlas=new Xt(256,512),this.crossTileSymbolIndex=new ja,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new h.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",h.ay()),Jn().on(Ke,this._rtlPluginLoaded),this.on("data",(l=>{if(l.dataType!=="source"||l.sourceDataType!=="metadata")return;const u=this.sourceCaches[l.sourceId];if(!u)return;const p=u.getSource();if(p&&p.vectorLayerIds)for(const w in this._layers){const k=this._layers[w];k.source===p.id&&this._validateLayer(k)}}))}loadURL(e,s={},l){this.fire(new h.k("dataloading",{dataType:"style"})),s.validate=typeof s.validate!="boolean"||s.validate;const u=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const p=this._loadStyleRequest;h.h(u,this._loadStyleRequest).then((w=>{this._loadStyleRequest=null,this._load(w.data,s,l)})).catch((w=>{this._loadStyleRequest=null,w&&!p.signal.aborted&&this.fire(new h.j(w))}))}loadJSON(e,s={},l){this.fire(new h.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,Y.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,s.validate=s.validate!==!1,this._load(e,s,l)})).catch((()=>{}))}loadEmpty(){this.fire(new h.k("dataloading",{dataType:"style"})),this._load(Qh,{validate:!1})}_load(e,s,l){var u;const p=s.transformStyle?s.transformStyle(l,e):e;if(!s.validate||!ti(this,h.u(p))){this._loaded=!0,this.stylesheet=p;for(const w in p.sources)this.addSource(w,p.sources[w],{validate:!1});p.sprite?this._loadSprite(p.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(p.glyphs),this._createLayers(),this.light=new ft(this.stylesheet.light),this.sky=new Ne(this.stylesheet.sky),this.map.setTerrain((u=this.stylesheet.terrain)!==null&&u!==void 0?u:null),this.fire(new h.k("data",{dataType:"style"})),this.fire(new h.k("style.load"))}}_createLayers(){const e=h.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map((s=>s.id)),this._layers={},this._serializedLayers=null;for(const s of e){const l=h.aA(s);l.setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=l}}_loadSprite(e,s=!1,l=void 0){let u;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(p,w,k,E){return h._(this,void 0,void 0,(function*(){const A=$e(p),R=k>1?"@2x":"",B={},U={};for(const{id:G,url:X}of A){const J=w.transformRequest(ar(X,R,".json"),"SpriteJSON");B[G]=h.h(J,E);const te=w.transformRequest(ar(X,R,".png"),"SpriteImage");U[G]=Ue.getImage(te,E)}return yield Promise.all([...Object.values(B),...Object.values(U)]),(function(G,X){return h._(this,void 0,void 0,(function*(){const J={};for(const te in G){J[te]={};const se=Y.getImageCanvasContext((yield X[te]).data),ce=(yield G[te]).data;for(const Q in ce){const{width:fe,height:ye,x:be,y:Fe,sdf:Ge,pixelRatio:Qe,stretchX:ut,stretchY:tt,content:Xe,textFitWidth:_t,textFitHeight:Ft}=ce[Q];J[te][Q]={data:null,pixelRatio:Qe,sdf:Ge,stretchX:ut,stretchY:tt,content:Xe,textFitWidth:_t,textFitHeight:Ft,spriteData:{width:fe,height:ye,x:be,y:Fe,context:se}}}}return J}))})(B,U)}))})(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((p=>{if(this._spriteRequest=null,p)for(const w in p){this._spritesImagesIds[w]=[];const k=this._spritesImagesIds[w]?this._spritesImagesIds[w].filter((E=>!(E in p))):[];for(const E of k)this.imageManager.removeImage(E),this._changedImages[E]=!0;for(const E in p[w]){const A=w==="default"?E:`${w}:${E}`;this._spritesImagesIds[w].push(A),A in this.imageManager.images?this.imageManager.updateImage(A,p[w][E],!1):this.imageManager.addImage(A,p[w][E]),s&&(this._changedImages[A]=!0)}}})).catch((p=>{this._spriteRequest=null,u=p,this.fire(new h.j(u))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),s&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.k("data",{dataType:"style"})),l&&l(u)}))}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.k("data",{dataType:"style"}))}_validateLayer(e){const s=this.sourceCaches[e.source];if(!s)return;const l=e.sourceLayer;if(!l)return;const u=s.getSource();(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(l)===-1)&&this.fire(new h.j(new Error(`Source layer "${l}" does not exist on source "${u.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,s=!1){const l=this._serializedAllLayers();if(!e||e.length===0)return Object.values(s?h.aB(l):l);const u=[];for(const p of e)if(l[p]){const w=s?h.aB(l[p]):l[p];u.push(w)}return u}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const s=Object.keys(this._layers);for(const l of s){const u=this._layers[l];u.type!=="custom"&&(e[l]=u.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const s=this._changed;if(s){const u=Object.keys(this._updatedLayers),p=Object.keys(this._removedLayers);(u.length||p.length)&&this._updateWorkerLayers(u,p);for(const w in this._updatedSources){const k=this._updatedSources[w];if(k==="reload")this._reloadSource(w);else{if(k!=="clear")throw new Error(`Invalid action ${k}`);this._clearSource(w)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const w in this._updatedPaintProps)this._layers[w].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const l={};for(const u in this.sourceCaches){const p=this.sourceCaches[u];l[u]=p.used,p.used=!1}for(const u of this._order){const p=this._layers[u];p.recalculate(e,this._availableImages),!p.isHidden(e.zoom)&&p.source&&(this.sourceCaches[p.source].used=!0)}for(const u in l){const p=this.sourceCaches[u];!!l[u]!=!!p.used&&p.fire(new h.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:u}))}this.light.recalculate(e),this.sky.recalculate(e),this.z=e.zoom,s&&this.fire(new h.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,s){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,s={}){var l;this._checkLoaded();const u=this.serialize();if(e=s.transformStyle?s.transformStyle(u,e):e,((l=s.validate)===null||l===void 0||l)&&ti(this,h.u(e)))return!1;(e=h.aB(e)).layers=h.az(e.layers);const p=h.aC(u,e),w=this._getOperationsToPerform(p);if(w.unimplemented.length>0)throw new Error(`Unimplemented: ${w.unimplemented.join(", ")}.`);if(w.operations.length===0)return!1;for(const k of w.operations)k();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const s=[],l=[];for(const u of e)switch(u.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":s.push((()=>this.addLayer.apply(this,u.args)));break;case"removeLayer":s.push((()=>this.removeLayer.apply(this,u.args)));break;case"setPaintProperty":s.push((()=>this.setPaintProperty.apply(this,u.args)));break;case"setLayoutProperty":s.push((()=>this.setLayoutProperty.apply(this,u.args)));break;case"setFilter":s.push((()=>this.setFilter.apply(this,u.args)));break;case"addSource":s.push((()=>this.addSource.apply(this,u.args)));break;case"removeSource":s.push((()=>this.removeSource.apply(this,u.args)));break;case"setLayerZoomRange":s.push((()=>this.setLayerZoomRange.apply(this,u.args)));break;case"setLight":s.push((()=>this.setLight.apply(this,u.args)));break;case"setGeoJSONSourceData":s.push((()=>this.setGeoJSONSourceData.apply(this,u.args)));break;case"setGlyphs":s.push((()=>this.setGlyphs.apply(this,u.args)));break;case"setSprite":s.push((()=>this.setSprite.apply(this,u.args)));break;case"setSky":s.push((()=>this.setSky.apply(this,u.args)));break;case"setTerrain":s.push((()=>this.map.setTerrain.apply(this,u.args)));break;case"setTransition":s.push((()=>{}));break;default:l.push(u.command)}return{operations:s,unimplemented:l}}addImage(e,s){if(this.getImage(e))return this.fire(new h.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,s),this._afterImageUpdated(e)}updateImage(e,s){this.imageManager.updateImage(e,s)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new h.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,s,l={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(h.u.source,`sources.${e}`,s,null,l))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const u=this.sourceCaches[e]=new Rt(e,s,this.dispatcher);u.style=this,u.setEventedParent(this,(()=>({isSourceLoaded:u.loaded(),source:u.serialize(),sourceId:e}))),u.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===e)return this.fire(new h.j(new Error(`Source "${e}" cannot be removed while layer "${l}" is using it.`)));const s=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],s.fire(new h.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,s){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const l=this.sourceCaches[e].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(s),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,s,l={}){this._checkLoaded();const u=e.id;if(this.getLayer(u))return void this.fire(new h.j(new Error(`Layer "${u}" already exists on this map.`)));let p;if(e.type==="custom"){if(ti(this,h.aD(e)))return;p=h.aA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(u,e.source),e=h.aB(e),e=h.e(e,{source:u})),this._validate(h.u.layer,`layers.${u}`,e,{arrayIndex:-1},l))return;p=h.aA(e),this._validateLayer(p),p.setEventedParent(this,{layer:{id:u}})}const w=s?this._order.indexOf(s):this._order.length;if(s&&w===-1)this.fire(new h.j(new Error(`Cannot add layer "${u}" before non-existing layer "${s}".`)));else{if(this._order.splice(w,0,u),this._layerOrderChanged=!0,this._layers[u]=p,this._removedLayers[u]&&p.source&&p.type!=="custom"){const k=this._removedLayers[u];delete this._removedLayers[u],k.type!==p.type?this._updatedSources[p.source]="clear":(this._updatedSources[p.source]="reload",this.sourceCaches[p.source].pause())}this._updateLayer(p),p.onAdd&&p.onAdd(this.map)}}moveLayer(e,s){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new h.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===s)return;const l=this._order.indexOf(e);this._order.splice(l,1);const u=s?this._order.indexOf(s):this._order.length;s&&u===-1?this.fire(new h.j(new Error(`Cannot move layer "${e}" before non-existing layer "${s}".`))):(this._order.splice(u,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const s=this._layers[e];if(!s)return void this.fire(new h.j(new Error(`Cannot remove non-existing layer "${e}".`)));s.setEventedParent(null);const l=this._order.indexOf(e);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=s,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],s.onRemove&&s.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,s,l){this._checkLoaded();const u=this.getLayer(e);u?u.minzoom===s&&u.maxzoom===l||(s!=null&&(u.minzoom=s),l!=null&&(u.maxzoom=l),this._updateLayer(u)):this.fire(new h.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,s,l={}){this._checkLoaded();const u=this.getLayer(e);if(u){if(!h.aE(u.filter,s))return s==null?(u.filter=void 0,void this._updateLayer(u)):void(this._validate(h.u.filter,`layers.${u.id}.filter`,s,null,l)||(u.filter=h.aB(s),this._updateLayer(u)))}else this.fire(new h.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return h.aB(this.getLayer(e).filter)}setLayoutProperty(e,s,l,u={}){this._checkLoaded();const p=this.getLayer(e);p?h.aE(p.getLayoutProperty(s),l)||(p.setLayoutProperty(s,l,u),this._updateLayer(p)):this.fire(new h.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,s){const l=this.getLayer(e);if(l)return l.getLayoutProperty(s);this.fire(new h.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,s,l,u={}){this._checkLoaded();const p=this.getLayer(e);p?h.aE(p.getPaintProperty(s),l)||(p.setPaintProperty(s,l,u)&&this._updateLayer(p),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new h.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,s){return this.getLayer(e).getPaintProperty(s)}setFeatureState(e,s){this._checkLoaded();const l=e.source,u=e.sourceLayer,p=this.sourceCaches[l];if(p===void 0)return void this.fire(new h.j(new Error(`The source '${l}' does not exist in the map's style.`)));const w=p.getSource().type;w==="geojson"&&u?this.fire(new h.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):w!=="vector"||u?(e.id===void 0&&this.fire(new h.j(new Error("The feature id parameter must be provided."))),p.setFeatureState(u,e.id,s)):this.fire(new h.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,s){this._checkLoaded();const l=e.source,u=this.sourceCaches[l];if(u===void 0)return void this.fire(new h.j(new Error(`The source '${l}' does not exist in the map's style.`)));const p=u.getSource().type,w=p==="vector"?e.sourceLayer:void 0;p!=="vector"||w?s&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new h.j(new Error("A feature id is required to remove its specific state property."))):u.removeFeatureState(w,e.id,s):this.fire(new h.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const s=e.source,l=e.sourceLayer,u=this.sourceCaches[s];if(u!==void 0)return u.getSource().type!=="vector"||l?(e.id===void 0&&this.fire(new h.j(new Error("The feature id parameter must be provided."))),u.getFeatureState(l,e.id)):void this.fire(new h.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new h.j(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return h.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=h.aF(this.sourceCaches,(p=>p.serialize())),s=this._serializeByIds(this._order,!0),l=this.map.getTerrain()||void 0,u=this.stylesheet;return h.aG({version:u.version,name:u.name,metadata:u.metadata,light:u.light,sky:u.sky,center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch,sprite:u.sprite,glyphs:u.glyphs,transition:u.transition,sources:e,layers:s,terrain:l},(p=>p!==void 0))}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const s=w=>this._layers[w].type==="fill-extrusion",l={},u=[];for(let w=this._order.length-1;w>=0;w--){const k=this._order[w];if(s(k)){l[k]=w;for(const E of e){const A=E[k];if(A)for(const R of A)u.push(R)}}}u.sort(((w,k)=>k.intersectionZ-w.intersectionZ));const p=[];for(let w=this._order.length-1;w>=0;w--){const k=this._order[w];if(s(k))for(let E=u.length-1;E>=0;E--){const A=u[E].feature;if(l[A.layer.id]<w)break;p.push(A),u.pop()}else for(const E of e){const A=E[k];if(A)for(const R of A)p.push(R.feature)}}return p}queryRenderedFeatures(e,s,l){s&&s.filter&&this._validate(h.u.filter,"queryRenderedFeatures.filter",s.filter,null,s);const u={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new h.j(new Error("parameters.layers must be an Array."))),[];for(const k of s.layers){const E=this._layers[k];if(!E)return this.fire(new h.j(new Error(`The layer '${k}' does not exist in the map's style and cannot be queried for features.`))),[];u[E.source]=!0}}const p=[];s.availableImages=this._availableImages;const w=this._serializedAllLayers();for(const k in this.sourceCaches)s.layers&&!u[k]||p.push(Yi(this.sourceCaches[k],this._layers,w,e,s,l));return this.placement&&p.push((function(k,E,A,R,B,U,G){const X={},J=U.queryRenderedSymbols(R),te=[];for(const se of Object.keys(J).map(Number))te.push(G[se]);te.sort(bs);for(const se of te){const ce=se.featureIndex.lookupSymbolFeatures(J[se.bucketInstanceId],E,se.bucketIndex,se.sourceLayerIndex,B.filter,B.layers,B.availableImages,k);for(const Q in ce){const fe=X[Q]=X[Q]||[],ye=ce[Q];ye.sort(((be,Fe)=>{const Ge=se.featureSortOrder;if(Ge){const Qe=Ge.indexOf(be.featureIndex);return Ge.indexOf(Fe.featureIndex)-Qe}return Fe.featureIndex-be.featureIndex}));for(const be of ye)fe.push(be)}}for(const se in X)X[se].forEach((ce=>{const Q=ce.feature,fe=A[k[se].source].getFeatureState(Q.layer["source-layer"],Q.id);Q.source=Q.layer.source,Q.layer["source-layer"]&&(Q.sourceLayer=Q.layer["source-layer"]),Q.state=fe}));return X})(this._layers,w,this.sourceCaches,e,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(p)}querySourceFeatures(e,s){s&&s.filter&&this._validate(h.u.filter,"querySourceFeatures.filter",s.filter,null,s);const l=this.sourceCaches[e];return l?(function(u,p){const w=u.getRenderableIds().map((A=>u.getTileByID(A))),k=[],E={};for(let A=0;A<w.length;A++){const R=w[A],B=R.tileID.canonical.key;E[B]||(E[B]=!0,R.querySourceFeatures(k,p))}return k})(l,s):[]}getLight(){return this.light.getLight()}setLight(e,s={}){this._checkLoaded();const l=this.light.getLight();let u=!1;for(const w in e)if(!h.aE(e[w],l[w])){u=!0;break}if(!u)return;const p={now:Y.now(),transition:h.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,s),this.light.updateTransitions(p)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,s={}){const l=this.getSky();let u=!1;if(!e&&!l)return;if(e&&!l)u=!0;else if(!e&&l)u=!0;else for(const w in e)if(!h.aE(e[w],l[w])){u=!0;break}if(!u)return;const p={now:Y.now(),transition:h.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,s),this.sky.updateTransitions(p)}_validate(e,s,l,u,p={}){return(!p||p.validate!==!1)&&ti(this,e.call(h.u,h.e({key:s,style:this.serialize(),value:l,styleSpec:h.v},u)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Jn().off(Ke,this._rtlPluginLoaded);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.sourceCaches){const l=this.sourceCaches[s];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const s in this.sourceCaches)this.sourceCaches[s].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,s,l,u,p=!1){let w=!1,k=!1;const E={};for(const A of this._order){const R=this._layers[A];if(R.type!=="symbol")continue;if(!E[R.source]){const U=this.sourceCaches[R.source];E[R.source]=U.getRenderableIds(!0).map((G=>U.getTileByID(G))).sort(((G,X)=>X.tileID.overscaledZ-G.tileID.overscaledZ||(G.tileID.isLessThan(X.tileID)?-1:1)))}const B=this.crossTileSymbolIndex.addLayer(R,E[R.source],e.center.lng);w=w||B}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((p=p||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(Y.now(),e.zoom))&&(this.pauseablePlacement=new rl(e,this.map.terrain,this._order,p,s,l,u,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,E),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(Y.now()),k=!0),w&&this.pauseablePlacement.placement.setStale()),k||w)for(const A of this._order){const R=this._layers[A];R.type==="symbol"&&this.placement.updateLayerOpacities(R,E[R.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(Y.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,s){return h._(this,void 0,void 0,(function*(){const l=yield this.imageManager.getImages(s.icons);this._updateTilesForChangedImages();const u=this.sourceCaches[s.source];return u&&u.setDependencies(s.tileID.key,s.type,s.icons),l}))}getGlyphs(e,s){return h._(this,void 0,void 0,(function*(){const l=yield this.glyphManager.getGlyphs(s.stacks),u=this.sourceCaches[s.source];return u&&u.setDependencies(s.tileID.key,s.type,[""]),l}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,s={}){this._checkLoaded(),e&&this._validate(h.u.glyphs,"glyphs",e,null,s)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,s,l={},u){this._checkLoaded();const p=[{id:e,url:s}],w=[...$e(this.stylesheet.sprite),...p];this._validate(h.u.sprite,"sprite",w,null,l)||(this.stylesheet.sprite=w,this._loadSprite(p,!0,u))}removeSprite(e){this._checkLoaded();const s=$e(this.stylesheet.sprite);if(s.find((l=>l.id===e))){if(this._spritesImagesIds[e])for(const l of this._spritesImagesIds[e])this.imageManager.removeImage(l),this._changedImages[l]=!0;s.splice(s.findIndex((l=>l.id===e)),1),this.stylesheet.sprite=s.length>0?s:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.k("data",{dataType:"style"}))}else this.fire(new h.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return $e(this.stylesheet.sprite)}setSprite(e,s={},l){this._checkLoaded(),e&&this._validate(h.u.sprite,"sprite",e,null,s)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,l):(this._unloadSprite(),l&&l(null)))}}var js=h.Y([{name:"a_pos",type:"Int16",components:2}]);const Vs={prelude:gr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:gr(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:gr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:gr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:gr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:gr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:gr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:gr("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:gr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:gr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:gr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:gr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:gr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:gr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:gr(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:gr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:gr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:gr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:gr(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:gr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:gr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:gr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:gr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:gr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:gr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:gr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:gr("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:gr("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:gr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:gr("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function gr(f,e){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=e.match(/attribute ([\w]+) ([\w]+)/g),u=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),p=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=p?p.concat(u):u,k={};return{fragmentSource:f=f.replace(s,((E,A,R,B,U)=>(k[U]=!0,A==="define"?`
#ifndef HAS_UNIFORM_u_${U}
varying ${R} ${B} ${U};
#else
uniform ${R} ${B} u_${U};
#endif
`:`
#ifdef HAS_UNIFORM_u_${U}
    ${R} ${B} ${U} = u_${U};
#endif
`))),vertexSource:e=e.replace(s,((E,A,R,B,U)=>{const G=B==="float"?"vec2":"vec4",X=U.match(/color/)?"color":G;return k[U]?A==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
attribute ${R} ${G} a_${U};
varying ${R} ${B} ${U};
#else
uniform ${R} ${B} u_${U};
#endif
`:X==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = a_${U};
#else
    ${R} ${B} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = unpack_mix_${X}(a_${U}, u_${U}_t);
#else
    ${R} ${B} ${U} = u_${U};
#endif
`:A==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
attribute ${R} ${G} a_${U};
#else
uniform ${R} ${B} u_${U};
#endif
`:X==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${R} ${B} ${U} = a_${U};
#else
    ${R} ${B} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    ${R} ${B} ${U} = unpack_mix_${X}(a_${U}, u_${U}_t);
#else
    ${R} ${B} ${U} = u_${U};
#endif
`})),staticAttributes:l,staticUniforms:w}}class Va{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,s,l,u,p,w,k,E,A){this.context=e;let R=this.boundPaintVertexBuffers.length!==u.length;for(let B=0;!R&&B<u.length;B++)this.boundPaintVertexBuffers[B]!==u[B]&&(R=!0);!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==l||R||this.boundIndexBuffer!==p||this.boundVertexOffset!==w||this.boundDynamicVertexBuffer!==k||this.boundDynamicVertexBuffer2!==E||this.boundDynamicVertexBuffer3!==A?this.freshBind(s,l,u,p,w,k,E,A):(e.bindVertexArray.set(this.vao),k&&k.bind(),p&&p.dynamicDraw&&p.bind(),E&&E.bind(),A&&A.bind())}freshBind(e,s,l,u,p,w,k,E){const A=e.numAttributes,R=this.context,B=R.gl;this.vao&&this.destroy(),this.vao=R.createVertexArray(),R.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=u,this.boundVertexOffset=p,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=k,this.boundDynamicVertexBuffer3=E,s.enableAttributes(B,e);for(const U of l)U.enableAttributes(B,e);w&&w.enableAttributes(B,e),k&&k.enableAttributes(B,e),E&&E.enableAttributes(B,e),s.bind(),s.setVertexAttribPointers(B,e,p);for(const U of l)U.bind(),U.setVertexAttribPointers(B,e,p);w&&(w.bind(),w.setVertexAttribPointers(B,e,p)),u&&u.bind(),k&&(k.bind(),k.setVertexAttribPointers(B,e,p)),E&&(E.bind(),E.setVertexAttribPointers(B,e,p)),R.currentNumAttributes=A}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Du=(f,e,s,l,u)=>({u_matrix:f,u_texture:0,u_ele_delta:e,u_fog_matrix:s,u_fog_color:l?l.properties.get("fog-color"):h.aM.white,u_fog_ground_blend:l?l.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:l?l.calculateFogBlendOpacity(u):0,u_horizon_color:l?l.properties.get("horizon-color"):h.aM.white,u_horizon_fog_blend:l?l.properties.get("horizon-fog-blend"):1});function ma(f){const e=[];for(let s=0;s<f.length;s++){if(f[s]===null)continue;const l=f[s].split(" ");e.push(l.pop())}return e}class Sr{constructor(e,s,l,u,p,w){const k=e.gl;this.program=k.createProgram();const E=ma(s.staticAttributes),A=l?l.getBinderAttributes():[],R=E.concat(A),B=Vs.prelude.staticUniforms?ma(Vs.prelude.staticUniforms):[],U=s.staticUniforms?ma(s.staticUniforms):[],G=l?l.getBinderUniforms():[],X=B.concat(U).concat(G),J=[];for(const be of X)J.indexOf(be)<0&&J.push(be);const te=l?l.defines():[];p&&te.push("#define OVERDRAW_INSPECTOR;"),w&&te.push("#define TERRAIN3D;");const se=te.concat(Vs.prelude.fragmentSource,s.fragmentSource).join(`
`),ce=te.concat(Vs.prelude.vertexSource,s.vertexSource).join(`
`),Q=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);if(k.shaderSource(Q,se),k.compileShader(Q),!k.getShaderParameter(Q,k.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${k.getShaderInfoLog(Q)}`);k.attachShader(this.program,Q);const fe=k.createShader(k.VERTEX_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);if(k.shaderSource(fe,ce),k.compileShader(fe),!k.getShaderParameter(fe,k.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${k.getShaderInfoLog(fe)}`);k.attachShader(this.program,fe),this.attributes={};const ye={};this.numAttributes=R.length;for(let be=0;be<this.numAttributes;be++)R[be]&&(k.bindAttribLocation(this.program,be,R[be]),this.attributes[R[be]]=be);if(k.linkProgram(this.program),!k.getProgramParameter(this.program,k.LINK_STATUS))throw new Error(`Program failed to link: ${k.getProgramInfoLog(this.program)}`);k.deleteShader(fe),k.deleteShader(Q);for(let be=0;be<J.length;be++){const Fe=J[be];if(Fe&&!ye[Fe]){const Ge=k.getUniformLocation(this.program,Fe);Ge&&(ye[Fe]=Ge)}}this.fixedUniforms=u(e,ye),this.terrainUniforms=((be,Fe)=>({u_depth:new h.aH(be,Fe.u_depth),u_terrain:new h.aH(be,Fe.u_terrain),u_terrain_dim:new h.aI(be,Fe.u_terrain_dim),u_terrain_matrix:new h.aJ(be,Fe.u_terrain_matrix),u_terrain_unpack:new h.aK(be,Fe.u_terrain_unpack),u_terrain_exaggeration:new h.aI(be,Fe.u_terrain_exaggeration)}))(e,ye),this.binderUniforms=l?l.getUniforms(e,ye):[]}draw(e,s,l,u,p,w,k,E,A,R,B,U,G,X,J,te,se,ce){const Q=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(l),e.setStencilMode(u),e.setColorMode(p),e.setCullFace(w),E){e.activeTexture.set(Q.TEXTURE2),Q.bindTexture(Q.TEXTURE_2D,E.depthTexture),e.activeTexture.set(Q.TEXTURE3),Q.bindTexture(Q.TEXTURE_2D,E.texture);for(const ye in this.terrainUniforms)this.terrainUniforms[ye].set(E[ye])}for(const ye in this.fixedUniforms)this.fixedUniforms[ye].set(k[ye]);J&&J.setUniforms(e,this.binderUniforms,G,{zoom:X});let fe=0;switch(s){case Q.LINES:fe=2;break;case Q.TRIANGLES:fe=3;break;case Q.LINE_STRIP:fe=1}for(const ye of U.get()){const be=ye.vaos||(ye.vaos={});(be[A]||(be[A]=new Va)).bind(e,this,R,J?J.getPaintVertexBuffers():[],B,ye.vertexOffset,te,se,ce),Q.drawElements(s,ye.primitiveLength*fe,Q.UNSIGNED_SHORT,ye.primitiveOffset*fe*2)}}}function nl(f,e,s){const l=1/Wt(s,1,e.transform.tileZoom),u=Math.pow(2,s.tileID.overscaledZ),p=s.tileSize*Math.pow(2,e.transform.tileZoom)/u,w=p*(s.tileID.canonical.x+s.tileID.wrap*u),k=p*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[l,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[w>>16,k>>16],u_pixel_coord_lower:[65535&w,65535&k]}}const fo=(f,e,s,l)=>{const u=e.style.light,p=u.properties.get("position"),w=[p.x,p.y,p.z],k=(function(){var A=new h.A(9);return h.A!=Float32Array&&(A[1]=0,A[2]=0,A[3]=0,A[5]=0,A[6]=0,A[7]=0),A[0]=1,A[4]=1,A[8]=1,A})();u.properties.get("anchor")==="viewport"&&(function(A,R){var B=Math.sin(R),U=Math.cos(R);A[0]=U,A[1]=B,A[2]=0,A[3]=-B,A[4]=U,A[5]=0,A[6]=0,A[7]=0,A[8]=1})(k,-e.transform.angle),(function(A,R,B){var U=R[0],G=R[1],X=R[2];A[0]=U*B[0]+G*B[3]+X*B[6],A[1]=U*B[1]+G*B[4]+X*B[7],A[2]=U*B[2]+G*B[5]+X*B[8]})(w,w,k);const E=u.properties.get("color");return{u_matrix:f,u_lightpos:w,u_lightintensity:u.properties.get("intensity"),u_lightcolor:[E.r,E.g,E.b],u_vertical_gradient:+s,u_opacity:l}},mo=(f,e,s,l,u,p,w)=>h.e(fo(f,e,s,l),nl(p,e,w),{u_height_factor:-Math.pow(2,u.overscaledZ)/w.tileSize/8}),Ua=f=>({u_matrix:f}),Lu=(f,e,s,l)=>h.e(Ua(f),nl(s,e,l)),qc=(f,e)=>({u_matrix:f,u_world:e}),ql=(f,e,s,l,u)=>h.e(Lu(f,e,s,l),{u_world:u}),Zl=(f,e,s,l)=>{const u=f.transform;let p,w;if(l.paint.get("circle-pitch-alignment")==="map"){const k=Wt(s,1,u.zoom);p=!0,w=[k,k]}else p=!1,w=u.pixelsToGLUnits;return{u_camera_to_center_distance:u.cameraToCenterDistance,u_scale_with_map:+(l.paint.get("circle-pitch-scale")==="map"),u_matrix:f.translatePosMatrix(e.posMatrix,s,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_pitch_with_map:+p,u_device_pixel_ratio:f.pixelRatio,u_extrude_scale:w}},ri=(f,e,s)=>({u_matrix:f,u_inv_matrix:e,u_camera_to_center_distance:s.cameraToCenterDistance,u_viewport_size:[s.width,s.height]}),zi=(f,e,s=1)=>({u_matrix:f,u_color:e,u_overlay:0,u_overlay_scale:s}),on=f=>({u_matrix:f}),kn=(f,e,s,l)=>({u_matrix:f,u_extrude_scale:Wt(e,1,s),u_intensity:l}),ga=(f,e,s,l)=>{const u=h.H();h.aP(u,0,f.width,f.height,0,0,1);const p=f.context.gl;return{u_matrix:u,u_world:[p.drawingBufferWidth,p.drawingBufferHeight],u_image:s,u_color_ramp:l,u_opacity:e.paint.get("heatmap-opacity")}};function ts(f,e){const s=Math.pow(2,e.canonical.z),l=e.canonical.y;return[new h.Z(0,l/s).toLngLat().lat,new h.Z(0,(l+1)/s).toLngLat().lat]}const Gl=(f,e,s,l)=>{const u=f.transform;return{u_matrix:il(f,e,s,l),u_ratio:1/Wt(e,1,u.zoom),u_device_pixel_ratio:f.pixelRatio,u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]]}},Ru=(f,e,s,l,u)=>h.e(Gl(f,e,s,u),{u_image:0,u_image_height:l}),Is=(f,e,s,l,u)=>{const p=f.transform,w=Bu(e,p);return{u_matrix:il(f,e,s,u),u_texsize:e.imageAtlasTexture.size,u_ratio:1/Wt(e,1,p.zoom),u_device_pixel_ratio:f.pixelRatio,u_image:0,u_scale:[w,l.fromScale,l.toScale],u_fade:l.t,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},ed=(f,e,s,l,u,p)=>{const w=f.lineAtlas,k=Bu(e,f.transform),E=s.layout.get("line-cap")==="round",A=w.getDash(l.from,E),R=w.getDash(l.to,E),B=A.width*u.fromScale,U=R.width*u.toScale;return h.e(Gl(f,e,s,p),{u_patternscale_a:[k/B,-A.height/2],u_patternscale_b:[k/U,-R.height/2],u_sdfgamma:w.width/(256*Math.min(B,U)*f.pixelRatio)/2,u_image:0,u_tex_y_a:A.y,u_tex_y_b:R.y,u_mix:u.t})};function Bu(f,e){return 1/Wt(f,1,e.tileZoom)}function il(f,e,s,l){return f.translatePosMatrix(l?l.posMatrix:e.tileID.posMatrix,e,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const Zc=(f,e,s,l,u)=>{return{u_matrix:f,u_tl_parent:e,u_scale_parent:s,u_buffer_scale:1,u_fade_t:l.mix,u_opacity:l.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:(w=u.paint.get("raster-saturation"),w>0?1-1/(1.001-w):-w),u_contrast_factor:(p=u.paint.get("raster-contrast"),p>0?1/(1-p):1+p),u_spin_weights:td(u.paint.get("raster-hue-rotate"))};var p,w};function td(f){f*=Math.PI/180;const e=Math.sin(f),s=Math.cos(f);return[(2*s+1)/3,(-Math.sqrt(3)*e-s+1)/3,(Math.sqrt(3)*e-s+1)/3]}const go=(f,e,s,l,u,p,w,k,E,A,R,B,U,G)=>{const X=w.transform;return{u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:X.cameraToCenterDistance,u_pitch:X.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:X.width/X.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_matrix:k,u_label_plane_matrix:E,u_coord_matrix:A,u_is_text:+B,u_pitch_with_map:+l,u_is_along_line:u,u_is_variable_anchor:p,u_texsize:U,u_texture:0,u_translation:R,u_pitched_scale:G}},Us=(f,e,s,l,u,p,w,k,E,A,R,B,U,G,X)=>{const J=w.transform;return h.e(go(f,e,s,l,u,p,w,k,E,A,R,B,U,X),{u_gamma_scale:l?Math.cos(J._pitch)*J.cameraToCenterDistance:1,u_device_pixel_ratio:w.pixelRatio,u_is_halo:1})},ya=(f,e,s,l,u,p,w,k,E,A,R,B,U,G)=>h.e(Us(f,e,s,l,u,p,w,k,E,A,R,!0,B,!0,G),{u_texsize_icon:U,u_texture_icon:1}),$a=(f,e,s)=>({u_matrix:f,u_opacity:e,u_color:s}),Fu=(f,e,s,l,u,p)=>h.e((function(w,k,E,A){const R=E.imageManager.getPattern(w.from.toString()),B=E.imageManager.getPattern(w.to.toString()),{width:U,height:G}=E.imageManager.getPixelSize(),X=Math.pow(2,A.tileID.overscaledZ),J=A.tileSize*Math.pow(2,E.transform.tileZoom)/X,te=J*(A.tileID.canonical.x+A.tileID.wrap*X),se=J*A.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:R.tl,u_pattern_br_a:R.br,u_pattern_tl_b:B.tl,u_pattern_br_b:B.br,u_texsize:[U,G],u_mix:k.t,u_pattern_size_a:R.displaySize,u_pattern_size_b:B.displaySize,u_scale_a:k.fromScale,u_scale_b:k.toScale,u_tile_units_to_pixels:1/Wt(A,1,E.transform.tileZoom),u_pixel_coord_upper:[te>>16,se>>16],u_pixel_coord_lower:[65535&te,65535&se]}})(l,p,s,u),{u_matrix:f,u_opacity:e}),Ou={fillExtrusion:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_lightpos:new h.aN(f,e.u_lightpos),u_lightintensity:new h.aI(f,e.u_lightintensity),u_lightcolor:new h.aN(f,e.u_lightcolor),u_vertical_gradient:new h.aI(f,e.u_vertical_gradient),u_opacity:new h.aI(f,e.u_opacity)}),fillExtrusionPattern:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_lightpos:new h.aN(f,e.u_lightpos),u_lightintensity:new h.aI(f,e.u_lightintensity),u_lightcolor:new h.aN(f,e.u_lightcolor),u_vertical_gradient:new h.aI(f,e.u_vertical_gradient),u_height_factor:new h.aI(f,e.u_height_factor),u_image:new h.aH(f,e.u_image),u_texsize:new h.aO(f,e.u_texsize),u_pixel_coord_upper:new h.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new h.aO(f,e.u_pixel_coord_lower),u_scale:new h.aN(f,e.u_scale),u_fade:new h.aI(f,e.u_fade),u_opacity:new h.aI(f,e.u_opacity)}),fill:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix)}),fillPattern:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_image:new h.aH(f,e.u_image),u_texsize:new h.aO(f,e.u_texsize),u_pixel_coord_upper:new h.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new h.aO(f,e.u_pixel_coord_lower),u_scale:new h.aN(f,e.u_scale),u_fade:new h.aI(f,e.u_fade)}),fillOutline:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_world:new h.aO(f,e.u_world)}),fillOutlinePattern:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_world:new h.aO(f,e.u_world),u_image:new h.aH(f,e.u_image),u_texsize:new h.aO(f,e.u_texsize),u_pixel_coord_upper:new h.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new h.aO(f,e.u_pixel_coord_lower),u_scale:new h.aN(f,e.u_scale),u_fade:new h.aI(f,e.u_fade)}),circle:(f,e)=>({u_camera_to_center_distance:new h.aI(f,e.u_camera_to_center_distance),u_scale_with_map:new h.aH(f,e.u_scale_with_map),u_pitch_with_map:new h.aH(f,e.u_pitch_with_map),u_extrude_scale:new h.aO(f,e.u_extrude_scale),u_device_pixel_ratio:new h.aI(f,e.u_device_pixel_ratio),u_matrix:new h.aJ(f,e.u_matrix)}),collisionBox:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_pixel_extrude_scale:new h.aO(f,e.u_pixel_extrude_scale)}),collisionCircle:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_inv_matrix:new h.aJ(f,e.u_inv_matrix),u_camera_to_center_distance:new h.aI(f,e.u_camera_to_center_distance),u_viewport_size:new h.aO(f,e.u_viewport_size)}),debug:(f,e)=>({u_color:new h.aL(f,e.u_color),u_matrix:new h.aJ(f,e.u_matrix),u_overlay:new h.aH(f,e.u_overlay),u_overlay_scale:new h.aI(f,e.u_overlay_scale)}),clippingMask:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix)}),heatmap:(f,e)=>({u_extrude_scale:new h.aI(f,e.u_extrude_scale),u_intensity:new h.aI(f,e.u_intensity),u_matrix:new h.aJ(f,e.u_matrix)}),heatmapTexture:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_world:new h.aO(f,e.u_world),u_image:new h.aH(f,e.u_image),u_color_ramp:new h.aH(f,e.u_color_ramp),u_opacity:new h.aI(f,e.u_opacity)}),hillshade:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_image:new h.aH(f,e.u_image),u_latrange:new h.aO(f,e.u_latrange),u_light:new h.aO(f,e.u_light),u_shadow:new h.aL(f,e.u_shadow),u_highlight:new h.aL(f,e.u_highlight),u_accent:new h.aL(f,e.u_accent)}),hillshadePrepare:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_image:new h.aH(f,e.u_image),u_dimension:new h.aO(f,e.u_dimension),u_zoom:new h.aI(f,e.u_zoom),u_unpack:new h.aK(f,e.u_unpack)}),line:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_ratio:new h.aI(f,e.u_ratio),u_device_pixel_ratio:new h.aI(f,e.u_device_pixel_ratio),u_units_to_pixels:new h.aO(f,e.u_units_to_pixels)}),lineGradient:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_ratio:new h.aI(f,e.u_ratio),u_device_pixel_ratio:new h.aI(f,e.u_device_pixel_ratio),u_units_to_pixels:new h.aO(f,e.u_units_to_pixels),u_image:new h.aH(f,e.u_image),u_image_height:new h.aI(f,e.u_image_height)}),linePattern:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_texsize:new h.aO(f,e.u_texsize),u_ratio:new h.aI(f,e.u_ratio),u_device_pixel_ratio:new h.aI(f,e.u_device_pixel_ratio),u_image:new h.aH(f,e.u_image),u_units_to_pixels:new h.aO(f,e.u_units_to_pixels),u_scale:new h.aN(f,e.u_scale),u_fade:new h.aI(f,e.u_fade)}),lineSDF:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_ratio:new h.aI(f,e.u_ratio),u_device_pixel_ratio:new h.aI(f,e.u_device_pixel_ratio),u_units_to_pixels:new h.aO(f,e.u_units_to_pixels),u_patternscale_a:new h.aO(f,e.u_patternscale_a),u_patternscale_b:new h.aO(f,e.u_patternscale_b),u_sdfgamma:new h.aI(f,e.u_sdfgamma),u_image:new h.aH(f,e.u_image),u_tex_y_a:new h.aI(f,e.u_tex_y_a),u_tex_y_b:new h.aI(f,e.u_tex_y_b),u_mix:new h.aI(f,e.u_mix)}),raster:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_tl_parent:new h.aO(f,e.u_tl_parent),u_scale_parent:new h.aI(f,e.u_scale_parent),u_buffer_scale:new h.aI(f,e.u_buffer_scale),u_fade_t:new h.aI(f,e.u_fade_t),u_opacity:new h.aI(f,e.u_opacity),u_image0:new h.aH(f,e.u_image0),u_image1:new h.aH(f,e.u_image1),u_brightness_low:new h.aI(f,e.u_brightness_low),u_brightness_high:new h.aI(f,e.u_brightness_high),u_saturation_factor:new h.aI(f,e.u_saturation_factor),u_contrast_factor:new h.aI(f,e.u_contrast_factor),u_spin_weights:new h.aN(f,e.u_spin_weights)}),symbolIcon:(f,e)=>({u_is_size_zoom_constant:new h.aH(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new h.aH(f,e.u_is_size_feature_constant),u_size_t:new h.aI(f,e.u_size_t),u_size:new h.aI(f,e.u_size),u_camera_to_center_distance:new h.aI(f,e.u_camera_to_center_distance),u_pitch:new h.aI(f,e.u_pitch),u_rotate_symbol:new h.aH(f,e.u_rotate_symbol),u_aspect_ratio:new h.aI(f,e.u_aspect_ratio),u_fade_change:new h.aI(f,e.u_fade_change),u_matrix:new h.aJ(f,e.u_matrix),u_label_plane_matrix:new h.aJ(f,e.u_label_plane_matrix),u_coord_matrix:new h.aJ(f,e.u_coord_matrix),u_is_text:new h.aH(f,e.u_is_text),u_pitch_with_map:new h.aH(f,e.u_pitch_with_map),u_is_along_line:new h.aH(f,e.u_is_along_line),u_is_variable_anchor:new h.aH(f,e.u_is_variable_anchor),u_texsize:new h.aO(f,e.u_texsize),u_texture:new h.aH(f,e.u_texture),u_translation:new h.aO(f,e.u_translation),u_pitched_scale:new h.aI(f,e.u_pitched_scale)}),symbolSDF:(f,e)=>({u_is_size_zoom_constant:new h.aH(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new h.aH(f,e.u_is_size_feature_constant),u_size_t:new h.aI(f,e.u_size_t),u_size:new h.aI(f,e.u_size),u_camera_to_center_distance:new h.aI(f,e.u_camera_to_center_distance),u_pitch:new h.aI(f,e.u_pitch),u_rotate_symbol:new h.aH(f,e.u_rotate_symbol),u_aspect_ratio:new h.aI(f,e.u_aspect_ratio),u_fade_change:new h.aI(f,e.u_fade_change),u_matrix:new h.aJ(f,e.u_matrix),u_label_plane_matrix:new h.aJ(f,e.u_label_plane_matrix),u_coord_matrix:new h.aJ(f,e.u_coord_matrix),u_is_text:new h.aH(f,e.u_is_text),u_pitch_with_map:new h.aH(f,e.u_pitch_with_map),u_is_along_line:new h.aH(f,e.u_is_along_line),u_is_variable_anchor:new h.aH(f,e.u_is_variable_anchor),u_texsize:new h.aO(f,e.u_texsize),u_texture:new h.aH(f,e.u_texture),u_gamma_scale:new h.aI(f,e.u_gamma_scale),u_device_pixel_ratio:new h.aI(f,e.u_device_pixel_ratio),u_is_halo:new h.aH(f,e.u_is_halo),u_translation:new h.aO(f,e.u_translation),u_pitched_scale:new h.aI(f,e.u_pitched_scale)}),symbolTextAndIcon:(f,e)=>({u_is_size_zoom_constant:new h.aH(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new h.aH(f,e.u_is_size_feature_constant),u_size_t:new h.aI(f,e.u_size_t),u_size:new h.aI(f,e.u_size),u_camera_to_center_distance:new h.aI(f,e.u_camera_to_center_distance),u_pitch:new h.aI(f,e.u_pitch),u_rotate_symbol:new h.aH(f,e.u_rotate_symbol),u_aspect_ratio:new h.aI(f,e.u_aspect_ratio),u_fade_change:new h.aI(f,e.u_fade_change),u_matrix:new h.aJ(f,e.u_matrix),u_label_plane_matrix:new h.aJ(f,e.u_label_plane_matrix),u_coord_matrix:new h.aJ(f,e.u_coord_matrix),u_is_text:new h.aH(f,e.u_is_text),u_pitch_with_map:new h.aH(f,e.u_pitch_with_map),u_is_along_line:new h.aH(f,e.u_is_along_line),u_is_variable_anchor:new h.aH(f,e.u_is_variable_anchor),u_texsize:new h.aO(f,e.u_texsize),u_texsize_icon:new h.aO(f,e.u_texsize_icon),u_texture:new h.aH(f,e.u_texture),u_texture_icon:new h.aH(f,e.u_texture_icon),u_gamma_scale:new h.aI(f,e.u_gamma_scale),u_device_pixel_ratio:new h.aI(f,e.u_device_pixel_ratio),u_is_halo:new h.aH(f,e.u_is_halo),u_translation:new h.aO(f,e.u_translation),u_pitched_scale:new h.aI(f,e.u_pitched_scale)}),background:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_opacity:new h.aI(f,e.u_opacity),u_color:new h.aL(f,e.u_color)}),backgroundPattern:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_opacity:new h.aI(f,e.u_opacity),u_image:new h.aH(f,e.u_image),u_pattern_tl_a:new h.aO(f,e.u_pattern_tl_a),u_pattern_br_a:new h.aO(f,e.u_pattern_br_a),u_pattern_tl_b:new h.aO(f,e.u_pattern_tl_b),u_pattern_br_b:new h.aO(f,e.u_pattern_br_b),u_texsize:new h.aO(f,e.u_texsize),u_mix:new h.aI(f,e.u_mix),u_pattern_size_a:new h.aO(f,e.u_pattern_size_a),u_pattern_size_b:new h.aO(f,e.u_pattern_size_b),u_scale_a:new h.aI(f,e.u_scale_a),u_scale_b:new h.aI(f,e.u_scale_b),u_pixel_coord_upper:new h.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new h.aO(f,e.u_pixel_coord_lower),u_tile_units_to_pixels:new h.aI(f,e.u_tile_units_to_pixels)}),terrain:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_texture:new h.aH(f,e.u_texture),u_ele_delta:new h.aI(f,e.u_ele_delta),u_fog_matrix:new h.aJ(f,e.u_fog_matrix),u_fog_color:new h.aL(f,e.u_fog_color),u_fog_ground_blend:new h.aI(f,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new h.aI(f,e.u_fog_ground_blend_opacity),u_horizon_color:new h.aL(f,e.u_horizon_color),u_horizon_fog_blend:new h.aI(f,e.u_horizon_fog_blend)}),terrainDepth:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_ele_delta:new h.aI(f,e.u_ele_delta)}),terrainCoords:(f,e)=>({u_matrix:new h.aJ(f,e.u_matrix),u_texture:new h.aH(f,e.u_texture),u_terrain_coords_id:new h.aI(f,e.u_terrain_coords_id),u_ele_delta:new h.aI(f,e.u_ele_delta)}),sky:(f,e)=>({u_sky_color:new h.aL(f,e.u_sky_color),u_horizon_color:new h.aL(f,e.u_horizon_color),u_horizon:new h.aI(f,e.u_horizon),u_sky_horizon_blend:new h.aI(f,e.u_sky_horizon_blend)})};class Di{constructor(e,s,l){this.context=e;const u=e.gl;this.buffer=u.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?u.DYNAMIC_DRAW:u.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Hl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class sl{constructor(e,s,l,u){this.length=s.length,this.attributes=l,this.itemSize=s.bytesPerElement,this.dynamicDraw=u,this.context=e;const p=e.gl;this.buffer=p.createBuffer(),e.bindVertexBuffer.set(this.buffer),p.bufferData(p.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,s){for(let l=0;l<this.attributes.length;l++){const u=s.attributes[this.attributes[l].name];u!==void 0&&e.enableVertexAttribArray(u)}}setVertexAttribPointers(e,s,l){for(let u=0;u<this.attributes.length;u++){const p=this.attributes[u],w=s.attributes[p.name];w!==void 0&&e.vertexAttribPointer(w,p.components,e[Hl[p.type]],!1,this.itemSize,p.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const _a=new WeakMap;function Zn(f){var e;if(_a.has(f))return _a.get(f);{const s=(e=f.getParameter(f.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return _a.set(f,s),s}}class yr{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class qa extends yr{getDefault(){return h.aM.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Gc extends yr{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class $s extends yr{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Kl extends yr{getDefault(){return[!0,!0,!0,!0]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Nu extends yr{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class vi extends yr{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Za extends yr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const s=this.current;(e.func!==s.func||e.ref!==s.ref||e.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class al extends yr{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class yo extends yr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=e,this.dirty=!1}}class Hc extends yr{getDefault(){return[0,1]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Wl extends yr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=e,this.dirty=!1}}class Xl extends yr{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class rs extends yr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.BLEND):s.disable(s.BLEND),this.current=e,this.dirty=!1}}class ol extends yr{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Kc extends yr{getDefault(){return h.aM.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Wc extends yr{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class ll extends yr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=e,this.dirty=!1}}class rd extends yr{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class _o extends yr{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class nd extends yr{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class id extends yr{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Xc extends yr{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Yc extends yr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Jc extends yr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Yl extends yr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Qc extends yr{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Jl extends yr{getDefault(){return null}set(e){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class qs extends yr{getDefault(){return null}set(e){var s;if(e===this.current&&!this.dirty)return;const l=this.gl;Zn(l)?l.bindVertexArray(e):(s=l.getExtension("OES_vertex_array_object"))===null||s===void 0||s.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class ju extends yr{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class ul extends yr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Vu extends yr{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Ql extends yr{constructor(e,s){super(e),this.context=e,this.parent=s}getDefault(){return null}}class Uu extends Ql{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class va extends Ql{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class $u extends Ql{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class sd{constructor(e,s,l,u,p){this.context=e,this.width=s,this.height=l;const w=e.gl,k=this.framebuffer=w.createFramebuffer();if(this.colorAttachment=new Uu(e,k),u)this.depthAttachment=p?new $u(e,k):new va(e,k);else if(p)throw new Error("Stencil cannot be set without depth");if(w.checkFramebufferStatus(w.FRAMEBUFFER)!==w.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,s=this.colorAttachment.get();if(s&&e.deleteTexture(s),this.depthAttachment){const l=this.depthAttachment.get();l&&e.deleteRenderbuffer(l)}e.deleteFramebuffer(this.framebuffer)}}class tn{constructor(e,s,l){this.blendFunction=e,this.blendColor=s,this.mask=l}}tn.Replace=[1,0],tn.disabled=new tn(tn.Replace,h.aM.transparent,[!1,!1,!1,!1]),tn.unblended=new tn(tn.Replace,h.aM.transparent,[!0,!0,!0,!0]),tn.alphaBlended=new tn([1,771],h.aM.transparent,[!0,!0,!0,!0]);class ad{constructor(e){var s,l;if(this.gl=e,this.clearColor=new qa(this),this.clearDepth=new Gc(this),this.clearStencil=new $s(this),this.colorMask=new Kl(this),this.depthMask=new Nu(this),this.stencilMask=new vi(this),this.stencilFunc=new Za(this),this.stencilOp=new al(this),this.stencilTest=new yo(this),this.depthRange=new Hc(this),this.depthTest=new Wl(this),this.depthFunc=new Xl(this),this.blend=new rs(this),this.blendFunc=new ol(this),this.blendColor=new Kc(this),this.blendEquation=new Wc(this),this.cullFace=new ll(this),this.cullFaceSide=new rd(this),this.frontFace=new _o(this),this.program=new nd(this),this.activeTexture=new id(this),this.viewport=new Xc(this),this.bindFramebuffer=new Yc(this),this.bindRenderbuffer=new Jc(this),this.bindTexture=new Yl(this),this.bindVertexBuffer=new Qc(this),this.bindElementBuffer=new Jl(this),this.bindVertexArray=new qs(this),this.pixelStoreUnpack=new ju(this),this.pixelStoreUnpackPremultiplyAlpha=new ul(this),this.pixelStoreUnpackFlipY=new Vu(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),Zn(e)){this.HALF_FLOAT=e.HALF_FLOAT;const u=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(s=e.RGBA16F)!==null&&s!==void 0?s:u==null?void 0:u.RGBA16F_EXT,this.RGB16F=(l=e.RGB16F)!==null&&l!==void 0?l:u==null?void 0:u.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const u=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=u==null?void 0:u.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,s){return new Di(this,e,s)}createVertexBuffer(e,s,l){return new sl(this,e,s,l)}createRenderbuffer(e,s,l){const u=this.gl,p=u.createRenderbuffer();return this.bindRenderbuffer.set(p),u.renderbufferStorage(u.RENDERBUFFER,e,s,l),this.bindRenderbuffer.set(null),p}createFramebuffer(e,s,l,u){return new sd(this,e,s,l,u)}clear({color:e,depth:s,stencil:l}){const u=this.gl;let p=0;e&&(p|=u.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(p|=u.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),l!==void 0&&(p|=u.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),u.clear(p)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){h.aE(e.blendFunction,tn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return Zn(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var s;return Zn(this.gl)?this.gl.deleteVertexArray(e):(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class ir{constructor(e,s,l){this.func=e,this.mask=s,this.range=l}}ir.ReadOnly=!1,ir.ReadWrite=!0,ir.disabled=new ir(519,ir.ReadOnly,[0,1]);const eu=7680;class Br{constructor(e,s,l,u,p,w){this.test=e,this.ref=s,this.mask=l,this.fail=u,this.depthFail=p,this.pass=w}}Br.disabled=new Br({func:519,mask:0},0,0,eu,eu,eu);class kr{constructor(e,s,l){this.enable=e,this.mode=s,this.frontFace=l}}let ns;function cl(f,e,s,l,u){const p=f.context,w=p.gl,k=f.useProgram("collisionBox"),E=[];let A=0,R=0;for(let se=0;se<l.length;se++){const ce=l[se],Q=e.getTile(ce).getBucket(s);if(!Q)continue;const fe=u?Q.textCollisionBox:Q.iconCollisionBox,ye=Q.collisionCircleArray;if(ye.length>0){const be=h.H();h.aQ(be,Q.placementInvProjMatrix,f.transform.glCoordMatrix),h.aQ(be,be,Q.placementViewportMatrix),E.push({circleArray:ye,circleOffset:R,transform:ce.posMatrix,invTransform:be,coord:ce}),A+=ye.length/4,R=A}fe&&k.draw(p,w.LINES,ir.disabled,Br.disabled,f.colorModeForRenderPass(),kr.disabled,{u_matrix:ce.posMatrix,u_pixel_extrude_scale:[1/(B=f.transform).width,1/B.height]},f.style.map.terrain&&f.style.map.terrain.getTerrainData(ce),s.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,null,f.transform.zoom,null,null,fe.collisionVertexBuffer)}var B;if(!u||!E.length)return;const U=f.useProgram("collisionCircle"),G=new h.aR;G.resize(4*A),G._trim();let X=0;for(const se of E)for(let ce=0;ce<se.circleArray.length/4;ce++){const Q=4*ce,fe=se.circleArray[Q+0],ye=se.circleArray[Q+1],be=se.circleArray[Q+2],Fe=se.circleArray[Q+3];G.emplace(X++,fe,ye,be,Fe,0),G.emplace(X++,fe,ye,be,Fe,1),G.emplace(X++,fe,ye,be,Fe,2),G.emplace(X++,fe,ye,be,Fe,3)}(!ns||ns.length<2*A)&&(ns=(function(se){const ce=2*se,Q=new h.aT;Q.resize(ce),Q._trim();for(let fe=0;fe<ce;fe++){const ye=6*fe;Q.uint16[ye+0]=4*fe+0,Q.uint16[ye+1]=4*fe+1,Q.uint16[ye+2]=4*fe+2,Q.uint16[ye+3]=4*fe+2,Q.uint16[ye+4]=4*fe+3,Q.uint16[ye+5]=4*fe+0}return Q})(A));const J=p.createIndexBuffer(ns,!0),te=p.createVertexBuffer(G,h.aS.members,!0);for(const se of E){const ce=ri(se.transform,se.invTransform,f.transform);U.draw(p,w.TRIANGLES,ir.disabled,Br.disabled,f.colorModeForRenderPass(),kr.disabled,ce,f.style.map.terrain&&f.style.map.terrain.getTerrainData(se.coord),s.id,te,J,h.a0.simpleSegment(0,2*se.circleOffset,se.circleArray.length,se.circleArray.length/2),null,f.transform.zoom,null,null,null)}te.destroy(),J.destroy()}kr.disabled=new kr(!1,1029,2305),kr.backCCW=new kr(!0,1029,2305);const vo=h.an(new Float32Array(16));function tu(f,e,s,l,u,p){const{horizontalAlign:w,verticalAlign:k}=h.au(f);return new h.P((-(w-.5)*e/u+l[0])*p,(-(k-.5)*s/u+l[1])*p)}function xa(f,e,s,l,u,p){const w=e.tileAnchorPoint.add(new h.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let k=l.mult(p);s||(k=k.rotate(-u));const E=w.add(k);return ie(E.x,E.y,e.labelPlaneMatrix,e.getElevation).point}if(s){const k=Me(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(f),E=Math.atan(k.y/k.x)+(k.x<0?Math.PI:0);return f.add(l.rotate(E))}return f.add(l)}function Ga(f,e,s,l,u,p,w,k,E,A,R,B,U,G){const X=f.text.placedSymbolArray,J=f.text.dynamicLayoutVertexArray,te=f.icon.dynamicLayoutVertexArray,se={};J.clear();for(let ce=0;ce<X.length;ce++){const Q=X.get(ce),fe=Q.hidden||!Q.crossTileID||f.allowVerticalPlacement&&!Q.placedOrientation?null:l[Q.crossTileID];if(fe){const ye=new h.P(Q.anchorX,Q.anchorY),be={getElevation:G,width:u.width,height:u.height,labelPlaneMatrix:p,pitchWithMap:s,projection:R,tileAnchorPoint:ye,translation:B,unwrappedTileID:U},Fe=s?ie(ye.x,ye.y,w,G):Me(ye.x,ye.y,be),Ge=j(u.cameraToCenterDistance,Fe.signedDistanceFromCamera);let Qe=h.ai(f.textSizeData,E,Q)*Ge/h.ap;s&&(Qe*=f.tilePixelRatio/k);const{width:ut,height:tt,anchor:Xe,textOffset:_t,textBoxScale:Ft}=fe,nt=tu(Xe,ut,tt,_t,Ft,Qe),st=R.getPitchedTextCorrection(u,ye.add(new h.P(B[0],B[1])),U),Bt=xa(Fe.point,be,e,nt,u.angle,st),Cr=f.allowVerticalPlacement&&Q.placedOrientation===h.ah.vertical?Math.PI/2:0;for(let Ht=0;Ht<Q.numGlyphs;Ht++)h.aj(J,Bt,Cr);A&&Q.associatedIconIndex>=0&&(se[Q.associatedIconIndex]={shiftedAnchor:Bt,angle:Cr})}else Ct(Q.numGlyphs,J)}if(A){te.clear();const ce=f.icon.placedSymbolArray;for(let Q=0;Q<ce.length;Q++){const fe=ce.get(Q);if(fe.hidden)Ct(fe.numGlyphs,te);else{const ye=se[Q];if(ye)for(let be=0;be<fe.numGlyphs;be++)h.aj(te,ye.shiftedAnchor,ye.angle);else Ct(fe.numGlyphs,te)}}f.icon.dynamicLayoutVertexBuffer.updateData(te)}f.text.dynamicLayoutVertexBuffer.updateData(J)}function xi(f,e,s){return s.iconsInText&&e?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function wa(f,e,s,l,u,p,w,k,E,A,R,B){const U=f.context,G=U.gl,X=f.transform,J=Oa(),te=k==="map",se=E==="map",ce=k!=="viewport"&&s.layout.get("symbol-placement")!=="point",Q=te&&!se&&!ce,fe=!se&&ce,ye=!s.layout.get("symbol-sort-key").isConstant();let be=!1;const Fe=f.depthModeForSublayer(0,ir.ReadOnly),Ge=s._unevaluatedLayout.hasValue("text-variable-anchor")||s._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Qe=[],ut=J.getCircleRadiusCorrection(X);for(const tt of l){const Xe=e.getTile(tt),_t=Xe.getBucket(s);if(!_t)continue;const Ft=u?_t.text:_t.icon;if(!Ft||!Ft.segments.get().length||!Ft.hasVisibleVertices)continue;const nt=Ft.programConfigurations.get(s.id),st=u||_t.sdfIcons,Bt=u?_t.textSizeData:_t.iconSizeData,Cr=se||X.pitch!==0,Ht=f.useProgram(xi(st,u,_t),nt),Qt=h.ag(Bt,X.zoom),zr=f.style.map.terrain&&f.style.map.terrain.getTerrainData(tt);let Tn,bi,Dr,_n,Ur=[0,0],rn=null;if(u)bi=Xe.glyphAtlasTexture,Dr=G.LINEAR,Tn=Xe.glyphAtlasTexture.size,_t.iconsInText&&(Ur=Xe.imageAtlasTexture.size,rn=Xe.imageAtlasTexture,_n=Cr||f.options.rotating||f.options.zooming||Bt.kind==="composite"||Bt.kind==="camera"?G.LINEAR:G.NEAREST);else{const rr=s.layout.get("icon-size").constantOr(0)!==1||_t.iconsNeedLinear;bi=Xe.imageAtlasTexture,Dr=st||f.options.rotating||f.options.zooming||rr||Cr?G.LINEAR:G.NEAREST,Tn=Xe.imageAtlasTexture.size}const Mn=Wt(Xe,1,f.transform.zoom),ls=fe?tt.posMatrix:vo,ai=yi(ls,se,te,f.transform,Mn),us=Un(ls,se,te,f.transform,Mn),Pa=Un(tt.posMatrix,se,te,f.transform,Mn),Si=J.translatePosition(f.transform,Xe,p,w),Oi=Ge&&_t.hasTextData(),zs=s.layout.get("icon-text-fit")!=="none"&&Oi&&_t.hasIconData();if(ce){const rr=f.style.map.terrain?(Ca,hs)=>f.style.map.terrain.getElevation(tt,Ca,hs):null,Ti=s.layout.get("text-rotation-alignment")==="map";H(_t,tt.posMatrix,f,u,ai,Pa,se,A,Ti,J,tt.toUnwrapped(),X.width,X.height,Si,rr)}const Hn=tt.posMatrix,ki=u&&Ge||zs,cs=ce||ki?vo:ai,Ni=us,ln=st&&s.paint.get(u?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let qr;qr=st?_t.iconsInText?ya(Bt.kind,Qt,Q,se,ce,ki,f,Hn,cs,Ni,Si,Tn,Ur,ut):Us(Bt.kind,Qt,Q,se,ce,ki,f,Hn,cs,Ni,Si,u,Tn,!0,ut):go(Bt.kind,Qt,Q,se,ce,ki,f,Hn,cs,Ni,Si,u,Tn,ut);const An={program:Ht,buffers:Ft,uniformValues:qr,atlasTexture:bi,atlasTextureIcon:rn,atlasInterpolation:Dr,atlasInterpolationIcon:_n,isSDF:st,hasHalo:ln};if(ye&&_t.canOverlap){be=!0;const rr=Ft.segments.get();for(const Ti of rr)Qe.push({segments:new h.a0([Ti]),sortKey:Ti.sortKey,state:An,terrainData:zr})}else Qe.push({segments:Ft.segments,sortKey:0,state:An,terrainData:zr})}be&&Qe.sort(((tt,Xe)=>tt.sortKey-Xe.sortKey));for(const tt of Qe){const Xe=tt.state;if(U.activeTexture.set(G.TEXTURE0),Xe.atlasTexture.bind(Xe.atlasInterpolation,G.CLAMP_TO_EDGE),Xe.atlasTextureIcon&&(U.activeTexture.set(G.TEXTURE1),Xe.atlasTextureIcon&&Xe.atlasTextureIcon.bind(Xe.atlasInterpolationIcon,G.CLAMP_TO_EDGE)),Xe.isSDF){const _t=Xe.uniformValues;Xe.hasHalo&&(_t.u_is_halo=1,qu(Xe.buffers,tt.segments,s,f,Xe.program,Fe,R,B,_t,tt.terrainData)),_t.u_is_halo=0}qu(Xe.buffers,tt.segments,s,f,Xe.program,Fe,R,B,Xe.uniformValues,tt.terrainData)}}function qu(f,e,s,l,u,p,w,k,E,A){const R=l.context;u.draw(R,R.gl.TRIANGLES,p,w,k,kr.disabled,E,A,s.id,f.layoutVertexBuffer,f.indexBuffer,e,s.paint,l.transform.zoom,f.programConfigurations.get(s.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function Zu(f,e,s,l){const u=f.context,p=u.gl,w=Br.disabled,k=new tn([p.ONE,p.ONE],h.aM.transparent,[!0,!0,!0,!0]),E=e.getBucket(s);if(!E)return;const A=l.key;let R=s.heatmapFbos.get(A);R||(R=xo(u,e.tileSize,e.tileSize),s.heatmapFbos.set(A,R)),u.bindFramebuffer.set(R.framebuffer),u.viewport.set([0,0,e.tileSize,e.tileSize]),u.clear({color:h.aM.transparent});const B=E.programConfigurations.get(s.id),U=f.useProgram("heatmap",B),G=f.style.map.terrain.getTerrainData(l);U.draw(u,p.TRIANGLES,ir.disabled,w,k,kr.disabled,kn(l.posMatrix,e,f.transform.zoom,s.paint.get("heatmap-intensity")),G,s.id,E.layoutVertexBuffer,E.indexBuffer,E.segments,s.paint,f.transform.zoom,B)}function Ha(f,e,s){const l=f.context,u=l.gl;l.setColorMode(f.colorModeForRenderPass());const p=wo(l,e),w=s.key,k=e.heatmapFbos.get(w);k&&(l.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,k.colorAttachment.get()),l.activeTexture.set(u.TEXTURE1),p.bind(u.LINEAR,u.CLAMP_TO_EDGE),f.useProgram("heatmapTexture").draw(l,u.TRIANGLES,ir.disabled,Br.disabled,f.colorModeForRenderPass(),kr.disabled,ga(f,e,0,1),null,e.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments,e.paint,f.transform.zoom),k.destroy(),e.heatmapFbos.delete(w))}function xo(f,e,s){var l,u;const p=f.gl,w=p.createTexture();p.bindTexture(p.TEXTURE_2D,w),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.LINEAR),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.LINEAR);const k=(l=f.HALF_FLOAT)!==null&&l!==void 0?l:p.UNSIGNED_BYTE,E=(u=f.RGBA16F)!==null&&u!==void 0?u:p.RGBA;p.texImage2D(p.TEXTURE_2D,0,E,e,s,0,p.RGBA,k,null);const A=f.createFramebuffer(e,s,!1,!1);return A.colorAttachment.set(w),A}function wo(f,e){return e.colorRampTexture||(e.colorRampTexture=new xt(f,e.colorRamp,f.gl.RGBA)),e.colorRampTexture}function Es(f,e,s,l,u){if(!s||!l||!l.imageAtlas)return;const p=l.imageAtlas.patternPositions;let w=p[s.to.toString()],k=p[s.from.toString()];if(!w&&k&&(w=k),!k&&w&&(k=w),!w||!k){const E=u.getPaintProperty(e);w=p[E],k=p[E]}w&&k&&f.setConstantPatternPositions(w,k)}function Zs(f,e,s,l,u,p,w){const k=f.context.gl,E="fill-pattern",A=s.paint.get(E),R=A&&A.constantOr(1),B=s.getCrossfadeParameters();let U,G,X,J,te;w?(G=R&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",U=k.LINES):(G=R?"fillPattern":"fill",U=k.TRIANGLES);const se=A.constantOr(null);for(const ce of l){const Q=e.getTile(ce);if(R&&!Q.patternsLoaded())continue;const fe=Q.getBucket(s);if(!fe)continue;const ye=fe.programConfigurations.get(s.id),be=f.useProgram(G,ye),Fe=f.style.map.terrain&&f.style.map.terrain.getTerrainData(ce);R&&(f.context.activeTexture.set(k.TEXTURE0),Q.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),ye.updatePaintBuffers(B)),Es(ye,E,se,Q,s);const Ge=Fe?ce:null,Qe=f.translatePosMatrix(Ge?Ge.posMatrix:ce.posMatrix,Q,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(w){J=fe.indexBuffer2,te=fe.segments2;const ut=[k.drawingBufferWidth,k.drawingBufferHeight];X=G==="fillOutlinePattern"&&R?ql(Qe,f,B,Q,ut):qc(Qe,ut)}else J=fe.indexBuffer,te=fe.segments,X=R?Lu(Qe,f,B,Q):Ua(Qe);be.draw(f.context,U,u,f.stencilModeForClipping(ce),p,kr.disabled,X,Fe,s.id,fe.layoutVertexBuffer,J,te,s.paint,f.transform.zoom,ye)}}function ru(f,e,s,l,u,p,w){const k=f.context,E=k.gl,A="fill-extrusion-pattern",R=s.paint.get(A),B=R.constantOr(1),U=s.getCrossfadeParameters(),G=s.paint.get("fill-extrusion-opacity"),X=R.constantOr(null);for(const J of l){const te=e.getTile(J),se=te.getBucket(s);if(!se)continue;const ce=f.style.map.terrain&&f.style.map.terrain.getTerrainData(J),Q=se.programConfigurations.get(s.id),fe=f.useProgram(B?"fillExtrusionPattern":"fillExtrusion",Q);B&&(f.context.activeTexture.set(E.TEXTURE0),te.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),Q.updatePaintBuffers(U)),Es(Q,A,X,te,s);const ye=f.translatePosMatrix(J.posMatrix,te,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),be=s.paint.get("fill-extrusion-vertical-gradient"),Fe=B?mo(ye,f,be,G,J,U,te):fo(ye,f,be,G);fe.draw(k,k.gl.TRIANGLES,u,p,w,kr.backCCW,Fe,ce,s.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,s.paint,f.transform.zoom,Q,f.style.map.terrain&&se.centroidVertexBuffer)}}function Gs(f,e,s,l,u,p,w){const k=f.context,E=k.gl,A=s.fbo;if(!A)return;const R=f.useProgram("hillshade"),B=f.style.map.terrain&&f.style.map.terrain.getTerrainData(e);k.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,A.colorAttachment.get()),R.draw(k,E.TRIANGLES,u,p,w,kr.disabled,((U,G,X,J)=>{const te=X.paint.get("hillshade-shadow-color"),se=X.paint.get("hillshade-highlight-color"),ce=X.paint.get("hillshade-accent-color");let Q=X.paint.get("hillshade-illumination-direction")*(Math.PI/180);X.paint.get("hillshade-illumination-anchor")==="viewport"&&(Q-=U.transform.angle);const fe=!U.options.moving;return{u_matrix:J?J.posMatrix:U.transform.calculatePosMatrix(G.tileID.toUnwrapped(),fe),u_image:0,u_latrange:ts(0,G.tileID),u_light:[X.paint.get("hillshade-exaggeration"),Q],u_shadow:te,u_highlight:se,u_accent:ce}})(f,s,l,B?e:null),B,l.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}function bo(f,e,s,l,u,p){const w=f.context,k=w.gl,E=e.dem;if(E&&E.data){const A=E.dim,R=E.stride,B=E.getPixels();if(w.activeTexture.set(k.TEXTURE1),w.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||f.getTileTexture(R),e.demTexture){const G=e.demTexture;G.update(B,{premultiply:!1}),G.bind(k.NEAREST,k.CLAMP_TO_EDGE)}else e.demTexture=new xt(w,B,k.RGBA,{premultiply:!1}),e.demTexture.bind(k.NEAREST,k.CLAMP_TO_EDGE);w.activeTexture.set(k.TEXTURE0);let U=e.fbo;if(!U){const G=new xt(w,{width:A,height:A,data:null},k.RGBA);G.bind(k.LINEAR,k.CLAMP_TO_EDGE),U=e.fbo=w.createFramebuffer(A,A,!0,!1),U.colorAttachment.set(G.texture)}w.bindFramebuffer.set(U.framebuffer),w.viewport.set([0,0,A,A]),f.useProgram("hillshadePrepare").draw(w,k.TRIANGLES,l,u,p,kr.disabled,((G,X)=>{const J=X.stride,te=h.H();return h.aP(te,0,h.X,-h.X,0,0,1),h.J(te,te,[0,-h.X,0]),{u_matrix:te,u_image:1,u_dimension:[J,J],u_zoom:G.overscaledZ,u_unpack:X.getUnpackVector()}})(e.tileID,E),null,s.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function Gu(f,e,s,l,u,p){const w=l.paint.get("raster-fade-duration");if(!p&&w>0){const k=Y.now(),E=(k-f.timeAdded)/w,A=e?(k-e.timeAdded)/w:-1,R=s.getSource(),B=u.coveringZoomLevel({tileSize:R.tileSize,roundZoom:R.roundZoom}),U=!e||Math.abs(e.tileID.overscaledZ-B)>Math.abs(f.tileID.overscaledZ-B),G=U&&f.refreshedUponExpiration?1:h.ac(U?E:1-A,0,1);return f.refreshedUponExpiration&&E>=1&&(f.refreshedUponExpiration=!1),e?{opacity:1,mix:1-G}:{opacity:G,mix:0}}return{opacity:1,mix:0}}const hl=new h.aM(1,0,0,1),hr=new h.aM(0,1,0,1),dl=new h.aM(0,0,1,1),eh=new h.aM(1,0,1,1),Hu=new h.aM(0,1,1,1);function So(f,e,s,l){nu(f,0,e+s/2,f.transform.width,s,l)}function th(f,e,s,l){nu(f,e-s/2,0,s,f.transform.height,l)}function nu(f,e,s,l,u,p){const w=f.context,k=w.gl;k.enable(k.SCISSOR_TEST),k.scissor(e*f.pixelRatio,s*f.pixelRatio,l*f.pixelRatio,u*f.pixelRatio),w.clear({color:p}),k.disable(k.SCISSOR_TEST)}function rh(f,e,s){const l=f.context,u=l.gl,p=s.posMatrix,w=f.useProgram("debug"),k=ir.disabled,E=Br.disabled,A=f.colorModeForRenderPass(),R="$debug",B=f.style.map.terrain&&f.style.map.terrain.getTerrainData(s);l.activeTexture.set(u.TEXTURE0);const U=e.getTileByID(s.key).latestRawTileData,G=Math.floor((U&&U.byteLength||0)/1024),X=e.getTile(s).tileSize,J=512/Math.min(X,512)*(s.overscaledZ/f.transform.zoom)*.5;let te=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(te+=` => ${s.overscaledZ}`),(function(se,ce){se.initDebugOverlayCanvas();const Q=se.debugOverlayCanvas,fe=se.context.gl,ye=se.debugOverlayCanvas.getContext("2d");ye.clearRect(0,0,Q.width,Q.height),ye.shadowColor="white",ye.shadowBlur=2,ye.lineWidth=1.5,ye.strokeStyle="white",ye.textBaseline="top",ye.font="bold 36px Open Sans, sans-serif",ye.fillText(ce,5,5),ye.strokeText(ce,5,5),se.debugOverlayTexture.update(Q),se.debugOverlayTexture.bind(fe.LINEAR,fe.CLAMP_TO_EDGE)})(f,`${te} ${G}kB`),w.draw(l,u.TRIANGLES,k,E,tn.alphaBlended,kr.disabled,zi(p,h.aM.transparent,J),null,R,f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments),w.draw(l,u.LINE_STRIP,k,E,A,kr.disabled,zi(p,h.aM.red),B,R,f.debugBuffer,f.tileBorderIndexBuffer,f.debugSegments)}function nh(f,e,s){const l=f.context,u=l.gl,p=f.colorModeForRenderPass(),w=new ir(u.LEQUAL,ir.ReadWrite,f.depthRangeFor3D),k=f.useProgram("terrain"),E=e.getTerrainMesh();l.bindFramebuffer.set(null),l.viewport.set([0,0,f.width,f.height]);for(const A of s){const R=f.renderToTexture.getTexture(A),B=e.getTerrainData(A.tileID);l.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,R.texture);const U=f.transform.calculatePosMatrix(A.tileID.toUnwrapped()),G=e.getMeshFrameDelta(f.transform.zoom),X=f.transform.calculateFogMatrix(A.tileID.toUnwrapped()),J=Du(U,G,X,f.style.sky,f.transform.pitch);k.draw(l,u.TRIANGLES,w,Br.disabled,p,kr.backCCW,J,B,"terrain",E.vertexBuffer,E.indexBuffer,E.segments)}}class ni{constructor(e,s,l){this.vertexBuffer=e,this.indexBuffer=s,this.segments=l}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class ba{constructor(e,s){this.context=new ad(e),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:h.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Rt.maxUnderzooming+Rt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ja}resize(e,s,l){if(this.width=Math.floor(e*l),this.height=Math.floor(s*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style._order)this.style._layers[u].resize()}setup(){const e=this.context,s=new h.aX;s.emplaceBack(0,0),s.emplaceBack(h.X,0),s.emplaceBack(0,h.X),s.emplaceBack(h.X,h.X),this.tileExtentBuffer=e.createVertexBuffer(s,js.members),this.tileExtentSegments=h.a0.simpleSegment(0,0,4,2);const l=new h.aX;l.emplaceBack(0,0),l.emplaceBack(h.X,0),l.emplaceBack(0,h.X),l.emplaceBack(h.X,h.X),this.debugBuffer=e.createVertexBuffer(l,js.members),this.debugSegments=h.a0.simpleSegment(0,0,4,5);const u=new h.$;u.emplaceBack(0,0,0,0),u.emplaceBack(h.X,0,h.X,0),u.emplaceBack(0,h.X,0,h.X),u.emplaceBack(h.X,h.X,h.X,h.X),this.rasterBoundsBuffer=e.createVertexBuffer(u,ks.members),this.rasterBoundsSegments=h.a0.simpleSegment(0,0,4,2);const p=new h.aX;p.emplaceBack(0,0),p.emplaceBack(1,0),p.emplaceBack(0,1),p.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(p,js.members),this.viewportSegments=h.a0.simpleSegment(0,0,4,2);const w=new h.aZ;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(w);const k=new h.aY;k.emplaceBack(0,1,2),k.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(k);const E=this.context.gl;this.stencilClearMode=new Br({func:E.ALWAYS,mask:0},0,255,E.ZERO,E.ZERO,E.ZERO)}clearStencil(){const e=this.context,s=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=h.H();h.aP(l,0,this.width,this.height,0,0,1),h.K(l,l,[s.drawingBufferWidth,s.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,s.TRIANGLES,ir.disabled,this.stencilClearMode,tn.disabled,kr.disabled,on(l),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,s){if(this.currentStencilSource===e.source||!e.isTileClipped()||!s||!s.length)return;this.currentStencilSource=e.source;const l=this.context,u=l.gl;this.nextStencilID+s.length>256&&this.clearStencil(),l.setColorMode(tn.disabled),l.setDepthMode(ir.disabled);const p=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const w of s){const k=this._tileClippingMaskIDs[w.key]=this.nextStencilID++,E=this.style.map.terrain&&this.style.map.terrain.getTerrainData(w);p.draw(l,u.TRIANGLES,ir.disabled,new Br({func:u.ALWAYS,mask:0},k,255,u.KEEP,u.KEEP,u.REPLACE),tn.disabled,kr.disabled,on(w.posMatrix),E,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,s=this.context.gl;return new Br({func:s.NOTEQUAL,mask:255},e,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(e){const s=this.context.gl;return new Br({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(e){const s=this.context.gl,l=e.sort(((w,k)=>k.overscaledZ-w.overscaledZ)),u=l[l.length-1].overscaledZ,p=l[0].overscaledZ-u+1;if(p>1){this.currentStencilSource=void 0,this.nextStencilID+p>256&&this.clearStencil();const w={};for(let k=0;k<p;k++)w[k+u]=new Br({func:s.GEQUAL,mask:255},k+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=p,[w,l]}return[{[u]:Br.disabled},l]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new tn([e.CONSTANT_COLOR,e.ONE],new h.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?tn.unblended:tn.alphaBlended}depthModeForSublayer(e,s,l){if(!this.opaquePassEnabledForLayer())return ir.disabled;const u=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new ir(l||this.context.gl.LEQUAL,s,[u,u])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,s){this.style=e,this.options=s,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(Y.now()),this.imageManager.beginFrame();const l=this.style._order,u=this.style.sourceCaches,p={},w={},k={};for(const E in u){const A=u[E];A.used&&A.prepare(this.context),p[E]=A.getVisibleCoordinates(),w[E]=p[E].slice().reverse(),k[E]=A.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let E=0;E<l.length;E++)if(this.style._layers[l[E]].is3D()){this.opaquePassCutoff=E;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const E of l){const A=this.style._layers[E];if(!A.hasOffscreenPass()||A.isHidden(this.transform.zoom))continue;const R=w[A.source];(A.type==="custom"||R.length)&&this.renderLayer(this,u[A.source],A,R)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?h.aM.black:h.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(E,A){const R=E.context,B=R.gl,U=((se,ce,Q)=>({u_sky_color:se.properties.get("sky-color"),u_horizon_color:se.properties.get("horizon-color"),u_horizon:(ce.height/2+ce.getHorizon())*Q,u_sky_horizon_blend:se.properties.get("sky-horizon-blend")*ce.height/2*Q}))(A,E.style.map.transform,E.pixelRatio),G=new ir(B.LEQUAL,ir.ReadWrite,[0,1]),X=Br.disabled,J=E.colorModeForRenderPass(),te=E.useProgram("sky");if(!A.mesh){const se=new h.aX;se.emplaceBack(-1,-1),se.emplaceBack(1,-1),se.emplaceBack(1,1),se.emplaceBack(-1,1);const ce=new h.aY;ce.emplaceBack(0,1,2),ce.emplaceBack(0,2,3),A.mesh=new ni(R.createVertexBuffer(se,js.members),R.createIndexBuffer(ce),h.a0.simpleSegment(0,0,se.length,ce.length))}te.draw(R,B.TRIANGLES,G,X,J,kr.disabled,U,void 0,"sky",A.mesh.vertexBuffer,A.mesh.indexBuffer,A.mesh.segments)})(this,this.style.sky),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=l.length-1;this.currentLayer>=0;this.currentLayer--){const E=this.style._layers[l[this.currentLayer]],A=u[E.source],R=p[E.source];this._renderTileClippingMasks(E,R),this.renderLayer(this,A,E,R)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<l.length;this.currentLayer++){const E=this.style._layers[l[this.currentLayer]],A=u[E.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(E))continue;const R=(E.type==="symbol"?k:w)[E.source];this._renderTileClippingMasks(E,p[E.source]),this.renderLayer(this,A,E,R)}if(this.options.showTileBoundaries){const E=(function(A,R){let B=null;const U=Object.values(A._layers).flatMap((te=>te.source&&!te.isHidden(R)?[A.sourceCaches[te.source]]:[])),G=U.filter((te=>te.getSource().type==="vector")),X=U.filter((te=>te.getSource().type!=="vector")),J=te=>{(!B||B.getSource().maxzoom<te.getSource().maxzoom)&&(B=te)};return G.forEach((te=>J(te))),B||X.forEach((te=>J(te))),B})(this.style,this.transform.zoom);E&&(function(A,R,B){for(let U=0;U<B.length;U++)rh(A,R,B[U])})(this,E,E.getVisibleCoordinates())}this.options.showPadding&&(function(E){const A=E.transform.padding;So(E,E.transform.height-(A.top||0),3,hl),So(E,A.bottom||0,3,hr),th(E,A.left||0,3,dl),th(E,E.transform.width-(A.right||0),3,eh);const R=E.transform.centerPoint;(function(B,U,G,X){nu(B,U-1,G-10,2,20,X),nu(B,U-10,G-1,20,2,X)})(E,R.x,E.transform.height-R.y,Hu)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const s=this.terrainFacilitator.matrix,l=this.transform.modelViewProjectionMatrix;let u=this.terrainFacilitator.dirty;u||(u=e?!h.a_(s,l):!h.a$(s,l)),u||(u=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),u&&(h.b0(s,l),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(p,w){const k=p.context,E=k.gl,A=tn.unblended,R=new ir(E.LEQUAL,ir.ReadWrite,[0,1]),B=w.getTerrainMesh(),U=w.sourceCache.getRenderableTiles(),G=p.useProgram("terrainDepth");k.bindFramebuffer.set(w.getFramebuffer("depth").framebuffer),k.viewport.set([0,0,p.width/devicePixelRatio,p.height/devicePixelRatio]),k.clear({color:h.aM.transparent,depth:1});for(const X of U){const J=w.getTerrainData(X.tileID),te={u_matrix:p.transform.calculatePosMatrix(X.tileID.toUnwrapped()),u_ele_delta:w.getMeshFrameDelta(p.transform.zoom)};G.draw(k,E.TRIANGLES,R,Br.disabled,A,kr.backCCW,te,J,"terrain",B.vertexBuffer,B.indexBuffer,B.segments)}k.bindFramebuffer.set(null),k.viewport.set([0,0,p.width,p.height])})(this,this.style.map.terrain),(function(p,w){const k=p.context,E=k.gl,A=tn.unblended,R=new ir(E.LEQUAL,ir.ReadWrite,[0,1]),B=w.getTerrainMesh(),U=w.getCoordsTexture(),G=w.sourceCache.getRenderableTiles(),X=p.useProgram("terrainCoords");k.bindFramebuffer.set(w.getFramebuffer("coords").framebuffer),k.viewport.set([0,0,p.width/devicePixelRatio,p.height/devicePixelRatio]),k.clear({color:h.aM.transparent,depth:1}),w.coordsIndex=[];for(const J of G){const te=w.getTerrainData(J.tileID);k.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,U.texture);const se={u_matrix:p.transform.calculatePosMatrix(J.tileID.toUnwrapped()),u_terrain_coords_id:(255-w.coordsIndex.length)/255,u_texture:0,u_ele_delta:w.getMeshFrameDelta(p.transform.zoom)};X.draw(k,E.TRIANGLES,R,Br.disabled,A,kr.backCCW,se,te,"terrain",B.vertexBuffer,B.indexBuffer,B.segments),w.coordsIndex.push(J.tileID.key)}k.bindFramebuffer.set(null),k.viewport.set([0,0,p.width,p.height])})(this,this.style.map.terrain))}renderLayer(e,s,l,u){if(!l.isHidden(this.transform.zoom)&&(l.type==="background"||l.type==="custom"||(u||[]).length))switch(this.id=l.id,l.type){case"symbol":(function(p,w,k,E,A){if(p.renderPass!=="translucent")return;const R=Br.disabled,B=p.colorModeForRenderPass();(k._unevaluatedLayout.hasValue("text-variable-anchor")||k._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(U,G,X,J,te,se,ce,Q,fe){const ye=G.transform,be=Oa(),Fe=te==="map",Ge=se==="map";for(const Qe of U){const ut=J.getTile(Qe),tt=ut.getBucket(X);if(!tt||!tt.text||!tt.text.segments.get().length)continue;const Xe=h.ag(tt.textSizeData,ye.zoom),_t=Wt(ut,1,G.transform.zoom),Ft=yi(Qe.posMatrix,Ge,Fe,G.transform,_t),nt=X.layout.get("icon-text-fit")!=="none"&&tt.hasIconData();if(Xe){const st=Math.pow(2,ye.zoom-ut.tileID.overscaledZ),Bt=G.style.map.terrain?(Ht,Qt)=>G.style.map.terrain.getElevation(Qe,Ht,Qt):null,Cr=be.translatePosition(ye,ut,ce,Q);Ga(tt,Fe,Ge,fe,ye,Ft,Qe.posMatrix,st,Xe,nt,be,Cr,Qe.toUnwrapped(),Bt)}}})(E,p,k,w,k.layout.get("text-rotation-alignment"),k.layout.get("text-pitch-alignment"),k.paint.get("text-translate"),k.paint.get("text-translate-anchor"),A),k.paint.get("icon-opacity").constantOr(1)!==0&&wa(p,w,k,E,!1,k.paint.get("icon-translate"),k.paint.get("icon-translate-anchor"),k.layout.get("icon-rotation-alignment"),k.layout.get("icon-pitch-alignment"),k.layout.get("icon-keep-upright"),R,B),k.paint.get("text-opacity").constantOr(1)!==0&&wa(p,w,k,E,!0,k.paint.get("text-translate"),k.paint.get("text-translate-anchor"),k.layout.get("text-rotation-alignment"),k.layout.get("text-pitch-alignment"),k.layout.get("text-keep-upright"),R,B),w.map.showCollisionBoxes&&(cl(p,w,k,E,!0),cl(p,w,k,E,!1))})(e,s,l,u,this.style.placement.variableOffsets);break;case"circle":(function(p,w,k,E){if(p.renderPass!=="translucent")return;const A=k.paint.get("circle-opacity"),R=k.paint.get("circle-stroke-width"),B=k.paint.get("circle-stroke-opacity"),U=!k.layout.get("circle-sort-key").isConstant();if(A.constantOr(1)===0&&(R.constantOr(1)===0||B.constantOr(1)===0))return;const G=p.context,X=G.gl,J=p.depthModeForSublayer(0,ir.ReadOnly),te=Br.disabled,se=p.colorModeForRenderPass(),ce=[];for(let Q=0;Q<E.length;Q++){const fe=E[Q],ye=w.getTile(fe),be=ye.getBucket(k);if(!be)continue;const Fe=be.programConfigurations.get(k.id),Ge=p.useProgram("circle",Fe),Qe=be.layoutVertexBuffer,ut=be.indexBuffer,tt=p.style.map.terrain&&p.style.map.terrain.getTerrainData(fe),Xe={programConfiguration:Fe,program:Ge,layoutVertexBuffer:Qe,indexBuffer:ut,uniformValues:Zl(p,fe,ye,k),terrainData:tt};if(U){const _t=be.segments.get();for(const Ft of _t)ce.push({segments:new h.a0([Ft]),sortKey:Ft.sortKey,state:Xe})}else ce.push({segments:be.segments,sortKey:0,state:Xe})}U&&ce.sort(((Q,fe)=>Q.sortKey-fe.sortKey));for(const Q of ce){const{programConfiguration:fe,program:ye,layoutVertexBuffer:be,indexBuffer:Fe,uniformValues:Ge,terrainData:Qe}=Q.state;ye.draw(G,X.TRIANGLES,J,te,se,kr.disabled,Ge,Qe,k.id,be,Fe,Q.segments,k.paint,p.transform.zoom,fe)}})(e,s,l,u);break;case"heatmap":(function(p,w,k,E){if(k.paint.get("heatmap-opacity")===0)return;const A=p.context;if(p.style.map.terrain){for(const R of E){const B=w.getTile(R);w.hasRenderableParent(R)||(p.renderPass==="offscreen"?Zu(p,B,k,R):p.renderPass==="translucent"&&Ha(p,k,R))}A.viewport.set([0,0,p.width,p.height])}else p.renderPass==="offscreen"?(function(R,B,U,G){const X=R.context,J=X.gl,te=Br.disabled,se=new tn([J.ONE,J.ONE],h.aM.transparent,[!0,!0,!0,!0]);(function(ce,Q,fe){const ye=ce.gl;ce.activeTexture.set(ye.TEXTURE1),ce.viewport.set([0,0,Q.width/4,Q.height/4]);let be=fe.heatmapFbos.get(h.aU);be?(ye.bindTexture(ye.TEXTURE_2D,be.colorAttachment.get()),ce.bindFramebuffer.set(be.framebuffer)):(be=xo(ce,Q.width/4,Q.height/4),fe.heatmapFbos.set(h.aU,be))})(X,R,U),X.clear({color:h.aM.transparent});for(let ce=0;ce<G.length;ce++){const Q=G[ce];if(B.hasRenderableParent(Q))continue;const fe=B.getTile(Q),ye=fe.getBucket(U);if(!ye)continue;const be=ye.programConfigurations.get(U.id),Fe=R.useProgram("heatmap",be),{zoom:Ge}=R.transform;Fe.draw(X,J.TRIANGLES,ir.disabled,te,se,kr.disabled,kn(Q.posMatrix,fe,Ge,U.paint.get("heatmap-intensity")),null,U.id,ye.layoutVertexBuffer,ye.indexBuffer,ye.segments,U.paint,R.transform.zoom,be)}X.viewport.set([0,0,R.width,R.height])})(p,w,k,E):p.renderPass==="translucent"&&(function(R,B){const U=R.context,G=U.gl;U.setColorMode(R.colorModeForRenderPass());const X=B.heatmapFbos.get(h.aU);X&&(U.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_2D,X.colorAttachment.get()),U.activeTexture.set(G.TEXTURE1),wo(U,B).bind(G.LINEAR,G.CLAMP_TO_EDGE),R.useProgram("heatmapTexture").draw(U,G.TRIANGLES,ir.disabled,Br.disabled,R.colorModeForRenderPass(),kr.disabled,ga(R,B,0,1),null,B.id,R.viewportBuffer,R.quadTriangleIndexBuffer,R.viewportSegments,B.paint,R.transform.zoom))})(p,k)})(e,s,l,u);break;case"line":(function(p,w,k,E){if(p.renderPass!=="translucent")return;const A=k.paint.get("line-opacity"),R=k.paint.get("line-width");if(A.constantOr(1)===0||R.constantOr(1)===0)return;const B=p.depthModeForSublayer(0,ir.ReadOnly),U=p.colorModeForRenderPass(),G=k.paint.get("line-dasharray"),X=k.paint.get("line-pattern"),J=X.constantOr(1),te=k.paint.get("line-gradient"),se=k.getCrossfadeParameters(),ce=J?"linePattern":G?"lineSDF":te?"lineGradient":"line",Q=p.context,fe=Q.gl;let ye=!0;for(const be of E){const Fe=w.getTile(be);if(J&&!Fe.patternsLoaded())continue;const Ge=Fe.getBucket(k);if(!Ge)continue;const Qe=Ge.programConfigurations.get(k.id),ut=p.context.program.get(),tt=p.useProgram(ce,Qe),Xe=ye||tt.program!==ut,_t=p.style.map.terrain&&p.style.map.terrain.getTerrainData(be),Ft=X.constantOr(null);if(Ft&&Fe.imageAtlas){const Bt=Fe.imageAtlas,Cr=Bt.patternPositions[Ft.to.toString()],Ht=Bt.patternPositions[Ft.from.toString()];Cr&&Ht&&Qe.setConstantPatternPositions(Cr,Ht)}const nt=_t?be:null,st=J?Is(p,Fe,k,se,nt):G?ed(p,Fe,k,G,se,nt):te?Ru(p,Fe,k,Ge.lineClipsArray.length,nt):Gl(p,Fe,k,nt);if(J)Q.activeTexture.set(fe.TEXTURE0),Fe.imageAtlasTexture.bind(fe.LINEAR,fe.CLAMP_TO_EDGE),Qe.updatePaintBuffers(se);else if(G&&(Xe||p.lineAtlas.dirty))Q.activeTexture.set(fe.TEXTURE0),p.lineAtlas.bind(Q);else if(te){const Bt=Ge.gradients[k.id];let Cr=Bt.texture;if(k.gradientVersion!==Bt.version){let Ht=256;if(k.stepInterpolant){const Qt=w.getSource().maxzoom,zr=be.canonical.z===Qt?Math.ceil(1<<p.transform.maxZoom-be.canonical.z):1;Ht=h.ac(h.aV(Ge.maxLineLength/h.X*1024*zr),256,Q.maxTextureSize)}Bt.gradient=h.aW({expression:k.gradientExpression(),evaluationKey:"lineProgress",resolution:Ht,image:Bt.gradient||void 0,clips:Ge.lineClipsArray}),Bt.texture?Bt.texture.update(Bt.gradient):Bt.texture=new xt(Q,Bt.gradient,fe.RGBA),Bt.version=k.gradientVersion,Cr=Bt.texture}Q.activeTexture.set(fe.TEXTURE0),Cr.bind(k.stepInterpolant?fe.NEAREST:fe.LINEAR,fe.CLAMP_TO_EDGE)}tt.draw(Q,fe.TRIANGLES,B,p.stencilModeForClipping(be),U,kr.disabled,st,_t,k.id,Ge.layoutVertexBuffer,Ge.indexBuffer,Ge.segments,k.paint,p.transform.zoom,Qe,Ge.layoutVertexBuffer2),ye=!1}})(e,s,l,u);break;case"fill":(function(p,w,k,E){const A=k.paint.get("fill-color"),R=k.paint.get("fill-opacity");if(R.constantOr(1)===0)return;const B=p.colorModeForRenderPass(),U=k.paint.get("fill-pattern"),G=p.opaquePassEnabledForLayer()&&!U.constantOr(1)&&A.constantOr(h.aM.transparent).a===1&&R.constantOr(0)===1?"opaque":"translucent";if(p.renderPass===G){const X=p.depthModeForSublayer(1,p.renderPass==="opaque"?ir.ReadWrite:ir.ReadOnly);Zs(p,w,k,E,X,B,!1)}if(p.renderPass==="translucent"&&k.paint.get("fill-antialias")){const X=p.depthModeForSublayer(k.getPaintProperty("fill-outline-color")?2:0,ir.ReadOnly);Zs(p,w,k,E,X,B,!0)}})(e,s,l,u);break;case"fill-extrusion":(function(p,w,k,E){const A=k.paint.get("fill-extrusion-opacity");if(A!==0&&p.renderPass==="translucent"){const R=new ir(p.context.gl.LEQUAL,ir.ReadWrite,p.depthRangeFor3D);if(A!==1||k.paint.get("fill-extrusion-pattern").constantOr(1))ru(p,w,k,E,R,Br.disabled,tn.disabled),ru(p,w,k,E,R,p.stencilModeFor3D(),p.colorModeForRenderPass());else{const B=p.colorModeForRenderPass();ru(p,w,k,E,R,Br.disabled,B)}}})(e,s,l,u);break;case"hillshade":(function(p,w,k,E){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent")return;const A=p.context,R=p.depthModeForSublayer(0,ir.ReadOnly),B=p.colorModeForRenderPass(),[U,G]=p.renderPass==="translucent"?p.stencilConfigForOverlap(E):[{},E];for(const X of G){const J=w.getTile(X);J.needsHillshadePrepare!==void 0&&J.needsHillshadePrepare&&p.renderPass==="offscreen"?bo(p,J,k,R,Br.disabled,B):p.renderPass==="translucent"&&Gs(p,X,J,k,R,U[X.overscaledZ],B)}A.viewport.set([0,0,p.width,p.height])})(e,s,l,u);break;case"raster":(function(p,w,k,E){if(p.renderPass!=="translucent"||k.paint.get("raster-opacity")===0||!E.length)return;const A=p.context,R=A.gl,B=w.getSource(),U=p.useProgram("raster"),G=p.colorModeForRenderPass(),[X,J]=B instanceof Ts?[{},E]:p.stencilConfigForOverlap(E),te=J[J.length-1].overscaledZ,se=!p.options.moving;for(const ce of J){const Q=p.depthModeForSublayer(ce.overscaledZ-te,k.paint.get("raster-opacity")===1?ir.ReadWrite:ir.ReadOnly,R.LESS),fe=w.getTile(ce);fe.registerFadeDuration(k.paint.get("raster-fade-duration"));const ye=w.findLoadedParent(ce,0),be=w.findLoadedSibling(ce),Fe=Gu(fe,ye||be||null,w,k,p.transform,p.style.map.terrain);let Ge,Qe;const ut=k.paint.get("raster-resampling")==="nearest"?R.NEAREST:R.LINEAR;A.activeTexture.set(R.TEXTURE0),fe.texture.bind(ut,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST),A.activeTexture.set(R.TEXTURE1),ye?(ye.texture.bind(ut,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST),Ge=Math.pow(2,ye.tileID.overscaledZ-fe.tileID.overscaledZ),Qe=[fe.tileID.canonical.x*Ge%1,fe.tileID.canonical.y*Ge%1]):fe.texture.bind(ut,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST),fe.texture.useMipmap&&A.extTextureFilterAnisotropic&&p.transform.pitch>20&&R.texParameterf(R.TEXTURE_2D,A.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,A.extTextureFilterAnisotropicMax);const tt=p.style.map.terrain&&p.style.map.terrain.getTerrainData(ce),Xe=tt?ce:null,_t=Xe?Xe.posMatrix:p.transform.calculatePosMatrix(ce.toUnwrapped(),se),Ft=Zc(_t,Qe||[0,0],Ge||1,Fe,k);B instanceof Ts?U.draw(A,R.TRIANGLES,Q,Br.disabled,G,kr.disabled,Ft,tt,k.id,B.boundsBuffer,p.quadTriangleIndexBuffer,B.boundsSegments):U.draw(A,R.TRIANGLES,Q,X[ce.overscaledZ],G,kr.disabled,Ft,tt,k.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}})(e,s,l,u);break;case"background":(function(p,w,k,E){const A=k.paint.get("background-color"),R=k.paint.get("background-opacity");if(R===0)return;const B=p.context,U=B.gl,G=p.transform,X=G.tileSize,J=k.paint.get("background-pattern");if(p.isPatternMissing(J))return;const te=!J&&A.a===1&&R===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==te)return;const se=Br.disabled,ce=p.depthModeForSublayer(0,te==="opaque"?ir.ReadWrite:ir.ReadOnly),Q=p.colorModeForRenderPass(),fe=p.useProgram(J?"backgroundPattern":"background"),ye=E||G.coveringTiles({tileSize:X,terrain:p.style.map.terrain});J&&(B.activeTexture.set(U.TEXTURE0),p.imageManager.bind(p.context));const be=k.getCrossfadeParameters();for(const Fe of ye){const Ge=E?Fe.posMatrix:p.transform.calculatePosMatrix(Fe.toUnwrapped()),Qe=J?Fu(Ge,R,p,J,{tileID:Fe,tileSize:X},be):$a(Ge,R,A),ut=p.style.map.terrain&&p.style.map.terrain.getTerrainData(Fe);fe.draw(B,U.TRIANGLES,ce,se,Q,kr.disabled,Qe,ut,k.id,p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}})(e,0,l,u);break;case"custom":(function(p,w,k){const E=p.context,A=k.implementation;if(p.renderPass==="offscreen"){const R=A.prerender;R&&(p.setCustomLayerDefaults(),E.setColorMode(p.colorModeForRenderPass()),R.call(A,E.gl,p.transform.customLayerMatrix()),E.setDirty(),p.setBaseState())}else if(p.renderPass==="translucent"){p.setCustomLayerDefaults(),E.setColorMode(p.colorModeForRenderPass()),E.setStencilMode(Br.disabled);const R=A.renderingMode==="3d"?new ir(p.context.gl.LEQUAL,ir.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,ir.ReadOnly);E.setDepthMode(R),A.render(E.gl,p.transform.customLayerMatrix(),{farZ:p.transform.farZ,nearZ:p.transform.nearZ,fov:p.transform._fov,modelViewProjectionMatrix:p.transform.modelViewProjectionMatrix,projectionMatrix:p.transform.projectionMatrix}),E.setDirty(),p.setBaseState(),E.bindFramebuffer.set(null)}})(e,0,l)}}translatePosMatrix(e,s,l,u,p){if(!l[0]&&!l[1])return e;const w=p?u==="map"?this.transform.angle:0:u==="viewport"?-this.transform.angle:0;if(w){const A=Math.sin(w),R=Math.cos(w);l=[l[0]*R-l[1]*A,l[0]*A+l[1]*R]}const k=[p?l[0]:Wt(s,l[0],this.transform.zoom),p?l[1]:Wt(s,l[1],this.transform.zoom),0],E=new Float32Array(16);return h.J(E,e,k),E}saveTileTexture(e){const s=this._tileTextures[e.size[0]];s?s.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const s=this._tileTextures[e];return s&&s.length>0?s.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const s=this.imageManager.getPattern(e.from.toString()),l=this.imageManager.getPattern(e.to.toString());return!s||!l}useProgram(e,s){this.cache=this.cache||{};const l=e+(s?s.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[l]||(this.cache[l]=new Sr(this.context,Vs[e],s,Ou[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[l]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new xt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:s}=this.context.gl;return this.width!==e||this.height!==s}}class Ka{constructor(e,s){this.points=e,this.planes=s}static fromInvProjectionMatrix(e,s,l){const u=Math.pow(2,l),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((k=>{const E=1/(k=h.af([],k,e))[3]/s*u;return h.b1(k,k,[E,E,1/k[3],E])})),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((k=>{const E=(function(U,G){var X=G[0],J=G[1],te=G[2],se=X*X+J*J+te*te;return se>0&&(se=1/Math.sqrt(se)),U[0]=G[0]*se,U[1]=G[1]*se,U[2]=G[2]*se,U})([],(function(U,G,X){var J=G[0],te=G[1],se=G[2],ce=X[0],Q=X[1],fe=X[2];return U[0]=te*fe-se*Q,U[1]=se*ce-J*fe,U[2]=J*Q-te*ce,U})([],je([],p[k[0]],p[k[1]]),je([],p[k[2]],p[k[1]]))),A=-((R=E)[0]*(B=p[k[1]])[0]+R[1]*B[1]+R[2]*B[2]);var R,B;return E.concat(A)}));return new Ka(p,w)}}class Wa{constructor(e,s){this.min=e,this.max=s,this.center=(function(l,u,p){return l[0]=.5*u[0],l[1]=.5*u[1],l[2]=.5*u[2],l})([],(function(l,u,p){return l[0]=u[0]+p[0],l[1]=u[1]+p[1],l[2]=u[2]+p[2],l})([],this.min,this.max))}quadrant(e){const s=[e%2==0,e<2],l=Je(this.min),u=Je(this.max);for(let p=0;p<s.length;p++)l[p]=s[p]?this.min[p]:this.center[p],u[p]=s[p]?this.center[p]:this.max[p];return u[2]=this.max[2],new Wa(l,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const s=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let l=!0;for(let u=0;u<e.planes.length;u++){const p=e.planes[u];let w=0;for(let k=0;k<s.length;k++)h.b2(p,s[k])>=0&&w++;if(w===0)return 0;w!==s.length&&(l=!1)}if(l)return 2;for(let u=0;u<3;u++){let p=Number.MAX_VALUE,w=-Number.MAX_VALUE;for(let k=0;k<e.points.length;k++){const E=e.points[k][u]-this.min[u];p=Math.min(p,E),w=Math.max(w,E)}if(w<0||p>this.max[u]-this.min[u])return 0}return 1}}class Xa{constructor(e=0,s=0,l=0,u=0){if(isNaN(e)||e<0||isNaN(s)||s<0||isNaN(l)||l<0||isNaN(u)||u<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=s,this.left=l,this.right=u}interpolate(e,s,l){return s.top!=null&&e.top!=null&&(this.top=h.y.number(e.top,s.top,l)),s.bottom!=null&&e.bottom!=null&&(this.bottom=h.y.number(e.bottom,s.bottom,l)),s.left!=null&&e.left!=null&&(this.left=h.y.number(e.left,s.left,l)),s.right!=null&&e.right!=null&&(this.right=h.y.number(e.right,s.right,l)),this}getCenter(e,s){const l=h.ac((this.left+e-this.right)/2,0,e),u=h.ac((this.top+s-this.bottom)/2,0,s);return new h.P(l,u)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Xa(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const iu=85.051129;class Sa{constructor(e,s,l,u,p){this.tileSize=512,this._renderWorldCopies=p===void 0||!!p,this._minZoom=e||0,this._maxZoom=s||22,this._minPitch=l??0,this._maxPitch=u??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new h.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Xa,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const e=new Sa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.lngRange=e.lngRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new h.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const s=-h.b3(e,-180,180)*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=(function(){var l=new h.A(4);return h.A!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l})(),(function(l,u,p){var w=u[0],k=u[1],E=u[2],A=u[3],R=Math.sin(p),B=Math.cos(p);l[0]=w*B+E*R,l[1]=k*B+A*R,l[2]=w*-R+E*B,l[3]=k*-R+A*B})(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const s=h.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const s=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this.tileZoom=Math.max(0,Math.floor(s)),this.scale=this.zoomScale(s),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,s,l){this._unmodified=!1,this._edgeInsets.interpolate(e,s,l),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const s=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(e){const s=[new h.b4(0,e)];if(this._renderWorldCopies){const l=this.pointCoordinate(new h.P(0,0)),u=this.pointCoordinate(new h.P(this.width,0)),p=this.pointCoordinate(new h.P(this.width,this.height)),w=this.pointCoordinate(new h.P(0,this.height)),k=Math.floor(Math.min(l.x,u.x,p.x,w.x)),E=Math.floor(Math.max(l.x,u.x,p.x,w.x)),A=1;for(let R=k-A;R<=E+A;R++)R!==0&&s.push(new h.b4(R,e))}return s}coveringTiles(e){var s,l;let u=this.coveringZoomLevel(e);const p=u;if(e.minzoom!==void 0&&u<e.minzoom)return[];e.maxzoom!==void 0&&u>e.maxzoom&&(u=e.maxzoom);const w=this.pointCoordinate(this.getCameraPoint()),k=h.Z.fromLngLat(this.center),E=Math.pow(2,u),A=[E*w.x,E*w.y,0],R=[E*k.x,E*k.y,0],B=Ka.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,u);let U=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(U=u);const G=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,X=Q=>({aabb:new Wa([Q*E,0,0],[(Q+1)*E,E,0]),zoom:0,x:0,y:0,wrap:Q,fullyVisible:!1}),J=[],te=[],se=u,ce=e.reparseOverscaled?p:u;if(this._renderWorldCopies)for(let Q=1;Q<=3;Q++)J.push(X(-Q)),J.push(X(Q));for(J.push(X(0));J.length>0;){const Q=J.pop(),fe=Q.x,ye=Q.y;let be=Q.fullyVisible;if(!be){const tt=Q.aabb.intersects(B);if(tt===0)continue;be=tt===2}const Fe=e.terrain?A:R,Ge=Q.aabb.distanceX(Fe),Qe=Q.aabb.distanceY(Fe),ut=Math.max(Math.abs(Ge),Math.abs(Qe));if(Q.zoom===se||ut>G+(1<<se-Q.zoom)-2&&Q.zoom>=U){const tt=se-Q.zoom,Xe=A[0]-.5-(fe<<tt),_t=A[1]-.5-(ye<<tt);te.push({tileID:new h.S(Q.zoom===se?ce:Q.zoom,Q.wrap,Q.zoom,fe,ye),distanceSq:pt([R[0]-.5-fe,R[1]-.5-ye]),tileDistanceToCamera:Math.sqrt(Xe*Xe+_t*_t)})}else for(let tt=0;tt<4;tt++){const Xe=(fe<<1)+tt%2,_t=(ye<<1)+(tt>>1),Ft=Q.zoom+1;let nt=Q.aabb.quadrant(tt);if(e.terrain){const st=new h.S(Ft,Q.wrap,Ft,Xe,_t),Bt=e.terrain.getMinMaxElevation(st),Cr=(s=Bt.minElevation)!==null&&s!==void 0?s:this.elevation,Ht=(l=Bt.maxElevation)!==null&&l!==void 0?l:this.elevation;nt=new Wa([nt.min[0],nt.min[1],Cr],[nt.max[0],nt.max[1],Ht])}J.push({aabb:nt,zoom:Ft,x:Xe,y:_t,wrap:Q.wrap,fullyVisible:be})}}return te.sort(((Q,fe)=>Q.distanceSq-fe.distanceSq)).map((Q=>Q.tileID))}resize(e,s){this.width=e,this.height=s,this.pixelsToGLUnits=[2/e,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const s=h.ac(e.lat,-85.051129,iu);return new h.P(h.O(e.lng)*this.worldSize,h.Q(s)*this.worldSize)}unproject(e){return new h.Z(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const s=this.elevation,l=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,u=this.pointLocation(this.centerPoint,e),p=e.getElevationForLngLatZoom(u,this.tileZoom);if(!(this.elevation-p))return;const w=l+s-p,k=Math.cos(this._pitch)*this.cameraToCenterDistance/w/h.b5(1,u.lat),E=this.scaleZoom(k/this.tileSize);this._elevation=p,this._center=u,this.zoom=E}setLocationAtPoint(e,s){const l=this.pointCoordinate(s),u=this.pointCoordinate(this.centerPoint),p=this.locationCoordinate(e),w=new h.Z(p.x-(l.x-u.x),p.y-(l.y-u.y));this.center=this.coordinateLocation(w),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,s){return s?this.coordinatePoint(this.locationCoordinate(e),s.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,s){return this.coordinateLocation(this.pointCoordinate(e,s))}locationCoordinate(e){return h.Z.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,s){if(s){const U=s.pointCoordinate(e);if(U!=null)return U}const l=[e.x,e.y,0,1],u=[e.x,e.y,1,1];h.af(l,l,this.pixelMatrixInverse),h.af(u,u,this.pixelMatrixInverse);const p=l[3],w=u[3],k=l[1]/p,E=u[1]/w,A=l[2]/p,R=u[2]/w,B=A===R?0:(0-A)/(R-A);return new h.Z(h.y.number(l[0]/p,u[0]/w,B)/this.worldSize,h.y.number(k,E,B)/this.worldSize)}coordinatePoint(e,s=0,l=this.pixelMatrix){const u=[e.x*this.worldSize,e.y*this.worldSize,s,1];return h.af(u,u,l),new h.P(u[0]/u[3],u[1]/u[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new Ee().extend(this.pointLocation(new h.P(0,e))).extend(this.pointLocation(new h.P(this.width,e))).extend(this.pointLocation(new h.P(this.width,this.height))).extend(this.pointLocation(new h.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Ee([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,iu])}calculateTileMatrix(e){const s=e.canonical,l=this.worldSize/this.zoomScale(s.z),u=s.x+Math.pow(2,s.z)*e.wrap,p=h.an(new Float64Array(16));return h.J(p,p,[u*l,s.y*l,0]),h.K(p,p,[l/h.X,l/h.X,1]),p}calculatePosMatrix(e,s=!1){const l=e.key,u=s?this._alignedPosMatrixCache:this._posMatrixCache;if(u[l])return u[l];const p=this.calculateTileMatrix(e);return h.L(p,s?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,p),u[l]=new Float32Array(p),u[l]}calculateFogMatrix(e){const s=e.key,l=this._fogMatrixCache;if(l[s])return l[s];const u=this.calculateTileMatrix(e);return h.L(u,this.fogMatrix,u),l[s]=new Float32Array(u),l[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,s){s=h.ac(+s,this.minZoom,this.maxZoom);const l={center:new h.N(e.lng,e.lat),zoom:s};let u=this.lngRange;if(!this._renderWorldCopies&&u===null){const Q=179.9999999999;u=[-Q,Q]}const p=this.tileSize*this.zoomScale(l.zoom);let w=0,k=p,E=0,A=p,R=0,B=0;const{x:U,y:G}=this.size;if(this.latRange){const Q=this.latRange;w=h.Q(Q[1])*p,k=h.Q(Q[0])*p,k-w<G&&(R=G/(k-w))}u&&(E=h.b3(h.O(u[0])*p,0,p),A=h.b3(h.O(u[1])*p,0,p),A<E&&(A+=p),A-E<U&&(B=U/(A-E)));const{x:X,y:J}=this.project.call({worldSize:p},e);let te,se;const ce=Math.max(B||0,R||0);if(ce){const Q=new h.P(B?(A+E)/2:X,R?(k+w)/2:J);return l.center=this.unproject.call({worldSize:p},Q).wrap(),l.zoom+=this.scaleZoom(ce),l}if(this.latRange){const Q=G/2;J-Q<w&&(se=w+Q),J+Q>k&&(se=k-Q)}if(u){const Q=(E+A)/2;let fe=X;this._renderWorldCopies&&(fe=h.b3(X,Q-p/2,Q+p/2));const ye=U/2;fe-ye<E&&(te=E+ye),fe+ye>A&&(te=A-ye)}if(te!==void 0||se!==void 0){const Q=new h.P(te??X,se??J);l.center=this.unproject.call({worldSize:p},Q).wrap()}return l}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:s,zoom:l}=this.getConstrained(this.center,this.zoom);this.center=s,this.zoom=l,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,s=this.point.x,l=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=h.b5(1,this.center.lat)*this.worldSize;let u=h.an(new Float64Array(16));h.K(u,u,[this.width/2,-this.height/2,1]),h.J(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=h.an(new Float64Array(16)),h.K(u,u,[1,-1,1]),h.J(u,u,[-1,-1,0]),h.K(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u;const p=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),w=Math.min(this.elevation,this.minElevationForCurrentTile),k=p-w*this._pixelPerMeter/Math.cos(this._pitch),E=w<0?k:p,A=Math.PI/2+this._pitch,R=this._fov*(.5+e.y/this.height),B=Math.sin(R)*E/Math.sin(h.ac(Math.PI-A-R,.01,Math.PI-.01)),U=this.getHorizon(),G=2*Math.atan(U/this.cameraToCenterDistance)*(.5+e.y/(2*U)),X=Math.sin(G)*E/Math.sin(h.ac(Math.PI-A-G,.01,Math.PI-.01)),J=Math.min(B,X);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*J+E),this.nearZ=this.height/50,u=new Float64Array(16),h.b6(u,this._fov,this.width/this.height,this.nearZ,this.farZ),u[8]=2*-e.x/this.width,u[9]=2*e.y/this.height,this.projectionMatrix=h.ae(u),h.K(u,u,[1,-1,1]),h.J(u,u,[0,0,-this.cameraToCenterDistance]),h.b7(u,u,this._pitch),h.ad(u,u,this.angle),h.J(u,u,[-s,-l,0]),this.mercatorMatrix=h.K([],u,[this.worldSize,this.worldSize,this.worldSize]),h.K(u,u,[1,1,this._pixelPerMeter]),this.pixelMatrix=h.L(new Float64Array(16),this.labelPlaneMatrix,u),h.J(u,u,[0,0,-this.elevation]),this.modelViewProjectionMatrix=u,this.invModelViewProjectionMatrix=h.as([],u),this.fogMatrix=new Float64Array(16),h.b6(this.fogMatrix,this._fov,this.width/this.height,p,this.farZ),this.fogMatrix[8]=2*-e.x/this.width,this.fogMatrix[9]=2*e.y/this.height,h.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),h.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),h.b7(this.fogMatrix,this.fogMatrix,this._pitch),h.ad(this.fogMatrix,this.fogMatrix,this.angle),h.J(this.fogMatrix,this.fogMatrix,[-s,-l,0]),h.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),h.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=h.L(new Float64Array(16),this.labelPlaneMatrix,u);const te=this.width%2/2,se=this.height%2/2,ce=Math.cos(this.angle),Q=Math.sin(this.angle),fe=s-Math.round(s)+ce*te+Q*se,ye=l-Math.round(l)+ce*se+Q*te,be=new Float64Array(u);if(h.J(be,be,[fe>.5?fe-1:fe,ye>.5?ye-1:ye,0]),this.alignedModelViewProjectionMatrix=be,u=h.as(new Float64Array(16),this.pixelMatrix),!u)throw new Error("failed to invert matrix");this.pixelMatrixInverse=u,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new h.P(0,0)),s=[e.x*this.worldSize,e.y*this.worldSize,0,1];return h.af(s,s,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new h.P(0,e))}getCameraQueryGeometry(e){const s=this.getCameraPoint();if(e.length===1)return[e[0],s];{let l=s.x,u=s.y,p=s.x,w=s.y;for(const k of e)l=Math.min(l,k.x),u=Math.min(u,k.y),p=Math.max(p,k.x),w=Math.max(w,k.y);return[new h.P(l,u),new h.P(p,u),new h.P(p,w),new h.P(l,w),new h.P(l,u)]}}lngLatToCameraDepth(e,s){const l=this.locationCoordinate(e),u=[l.x*this.worldSize,l.y*this.worldSize,s,1];return h.af(u,u,this.modelViewProjectionMatrix),u[2]/u[3]}}function pl(f,e){let s,l=!1,u=null,p=null;const w=()=>{u=null,l&&(f.apply(p,s),u=setTimeout(w,e),l=!1)};return(...k)=>(l=!0,p=this,s=k,u||w(),u)}class su{constructor(e){this._getCurrentHash=()=>{const s=window.location.hash.replace("#","");if(this._hashName){let l;return s.split("&").map((u=>u.split("="))).forEach((u=>{u[0]===this._hashName&&(l=u)})),(l&&l[1]||"").split("/")}return s.split("/")},this._onHashChange=()=>{const s=this._getCurrentHash();if(s.length>=3&&!s.some((l=>isNaN(l)))){const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:l,pitch:+(s[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const s=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,s)},this._removeHash=()=>{const s=this._getCurrentHash();if(s.length===0)return;const l=s.join("/");let u=l;u.split("&").length>0&&(u=u.split("&")[0]),this._hashName&&(u=`${this._hashName}=${l}`);let p=window.location.hash.replace(u,"");p.startsWith("#&")?p=p.slice(0,1)+p.slice(2):p==="#"&&(p="");let w=window.location.href.replace(/(#.+)?$/,p);w=w.replace("&&","&"),window.history.replaceState(window.history.state,null,w)},this._updateHash=pl(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const s=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,u=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),p=Math.pow(10,u),w=Math.round(s.lng*p)/p,k=Math.round(s.lat*p)/p,E=this._map.getBearing(),A=this._map.getPitch();let R="";if(R+=e?`/${w}/${k}/${l}`:`${l}/${k}/${w}`,(E||A)&&(R+="/"+Math.round(10*E)/10),A&&(R+=`/${Math.round(A)}`),this._hashName){const B=this._hashName;let U=!1;const G=window.location.hash.slice(1).split("&").map((X=>{const J=X.split("=")[0];return J===B?(U=!0,`${J}=${R}`):X})).filter((X=>X));return U||G.push(`${B}=${R}`),`#${G.join("&")}`}return`#${R}`}}const Hs={linearity:.3,easing:h.b8(0,0,.3,1)},fl=h.e({deceleration:2500,maxSpeed:1400},Hs),ml=h.e({deceleration:20,maxSpeed:1400},Hs),au=h.e({deceleration:1e3,maxSpeed:360},Hs),gl=h.e({deceleration:1e3,maxSpeed:90},Hs);class ko{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Y.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,s=Y.now();for(;e.length>0&&s-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new h.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:p}of this._inertiaBuffer)s.zoom+=p.zoomDelta||0,s.bearing+=p.bearingDelta||0,s.pitch+=p.pitchDelta||0,p.panDelta&&s.pan._add(p.panDelta),p.around&&(s.around=p.around),p.pinchAround&&(s.pinchAround=p.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,u={};if(s.pan.mag()){const p=Ya(s.pan.mag(),l,h.e({},fl,e||{}));u.offset=s.pan.mult(p.amount/s.pan.mag()),u.center=this._map.transform.center,Ps(u,p)}if(s.zoom){const p=Ya(s.zoom,l,ml);u.zoom=this._map.transform.zoom+p.amount,Ps(u,p)}if(s.bearing){const p=Ya(s.bearing,l,au);u.bearing=this._map.transform.bearing+h.ac(p.amount,-179,179),Ps(u,p)}if(s.pitch){const p=Ya(s.pitch,l,gl);u.pitch=this._map.transform.pitch+p.amount,Ps(u,p)}if(u.zoom||u.bearing){const p=s.pinchAround===void 0?s.around:s.pinchAround;u.around=p?this._map.unproject(p):this._map.getCenter()}return this.clear(),h.e(u,{noMoveStart:!0})}}function Ps(f,e){(!f.duration||f.duration<e.duration)&&(f.duration=e.duration,f.easing=e.easing)}function Ya(f,e,s){const{maxSpeed:l,linearity:u,deceleration:p}=s,w=h.ac(f*u/(e/1e3),-l,l),k=Math.abs(w)/(p*u);return{easing:s.easing,duration:1e3*k,amount:w*(k/2)}}class Pn extends h.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,l,u={}){const p=Z.mousePos(s.getCanvas(),l),w=s.unproject(p);super(e,h.e({point:p,lngLat:w,originalEvent:l},u)),this._defaultPrevented=!1,this.target=s}}class Cs extends h.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,l){const u=e==="touchend"?l.changedTouches:l.touches,p=Z.touchPos(s.getCanvasContainer(),u),w=p.map((E=>s.unproject(E))),k=p.reduce(((E,A,R,B)=>E.add(A.div(B.length))),new h.P(0,0));super(e,{points:p,point:k,lngLats:w,lngLat:s.unproject(k),originalEvent:l}),this._defaultPrevented=!1}}class Ku extends h.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,l){super(e,{originalEvent:l}),this._defaultPrevented=!1}}class Wu{constructor(e,s){this._map=e,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Ku(e.type,this._map,e))}mousedown(e,s){return this._mousedownPos=s,this._firePreventable(new Pn(e.type,this._map,e))}mouseup(e){this._map.fire(new Pn(e.type,this._map,e))}click(e,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new Pn(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Pn(e.type,this._map,e))}mouseover(e){this._map.fire(new Pn(e.type,this._map,e))}mouseout(e){this._map.fire(new Pn(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Cs(e.type,this._map,e))}touchmove(e){this._map.fire(new Cs(e.type,this._map,e))}touchend(e){this._map.fire(new Cs(e.type,this._map,e))}touchcancel(e){this._map.fire(new Cs(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Yr{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Pn(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Pn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Pn(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Li{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(h.P.convert(e),this._map.terrain)}}class ii{constructor(e,s){this._map=e,this._tr=new Li(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,s){this.isEnabled()&&e.shiftKey&&e.button===0&&(Z.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(e,s){if(!this._active)return;const l=s;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const u=this._startPos;this._lastPos=l,this._box||(this._box=Z.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const p=Math.min(u.x,l.x),w=Math.max(u.x,l.x),k=Math.min(u.y,l.y),E=Math.max(u.y,l.y);Z.setTransform(this._box,`translate(${p}px,${k}px)`),this._box.style.width=w-p+"px",this._box.style.height=E-k+"px"}mouseupWindow(e,s){if(!this._active||e.button!==0)return;const l=this._startPos,u=s;if(this.reset(),Z.suppressClick(),l.x!==u.x||l.y!==u.y)return this._map.fire(new h.k("boxzoomend",{originalEvent:e})),{cameraAnimation:p=>p.fitScreenCoordinates(l,u,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(Z.remove(this._box),this._box=null),Z.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,s){return this._map.fire(new h.k(e,{originalEvent:s}))}}function To(f,e){if(f.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${f.length}, points ${e.length}`);const s={};for(let l=0;l<f.length;l++)s[f[l].identifier]=e[l];return s}class Ms{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,s,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),l.length===this.numTouches&&(this.centroid=(function(u){const p=new h.P(0,0);for(const w of u)p._add(w);return p.div(u.length)})(s),this.touches=To(l,s)))}touchmove(e,s,l){if(this.aborted||!this.centroid)return;const u=To(l,s);for(const p in this.touches){const w=u[p];(!w||w.dist(this.touches[p])>30)&&(this.aborted=!0)}}touchend(e,s,l){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const u=!this.aborted&&this.centroid;if(this.reset(),u)return u}}}class Io{constructor(e){this.singleTap=new Ms(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,s,l){this.singleTap.touchstart(e,s,l)}touchmove(e,s,l){this.singleTap.touchmove(e,s,l)}touchend(e,s,l){const u=this.singleTap.touchend(e,s,l);if(u){const p=e.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(u)<30;if(p&&w||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=u,this.count===this.numTaps)return this.reset(),u}}}class ka{constructor(e){this._tr=new Li(e),this._zoomIn=new Io({numTouches:1,numTaps:2}),this._zoomOut=new Io({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,s,l){this._zoomIn.touchstart(e,s,l),this._zoomOut.touchstart(e,s,l)}touchmove(e,s,l){this._zoomIn.touchmove(e,s,l),this._zoomOut.touchmove(e,s,l)}touchend(e,s,l){const u=this._zoomIn.touchend(e,s,l),p=this._zoomOut.touchend(e,s,l),w=this._tr;return u?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:k=>k.easeTo({duration:300,zoom:w.zoom+1,around:w.unproject(u)},{originalEvent:e})}):p?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:k=>k.easeTo({duration:300,zoom:w.zoom-1,around:w.unproject(p)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ks{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const s=this._moveFunction(...e);if(s.bearingDelta||s.pitchDelta||s.around||s.panDelta)return this._active=!0,s}dragStart(e,s){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=s.length?s[0]:s,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,s){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const u=s.length?s[0]:s;return!this._moved&&u.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=u,this._move(l,u))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&Z.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Xu={0:1,2:2};class Ta{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const s=Z.mouseButton(e);this._eventButton=s}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!(function(s,l){const u=Xu[l];return s.buttons===void 0||(s.buttons&u)!==u})(e,this._eventButton)}isValidEndEvent(e){return Z.mouseButton(e)===this._eventButton}}class Yu{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}const yl=f=>{f.mousedown=f.dragStart,f.mousemoveWindow=f.dragMove,f.mouseup=f.dragEnd,f.contextmenu=e=>{e.preventDefault()}},ou=({enable:f,clickTolerance:e,bearingDegreesPerPixelMoved:s=.8})=>{const l=new Ta({checkCorrectEvent:u=>Z.mouseButton(u)===0&&u.ctrlKey||Z.mouseButton(u)===2});return new Ks({clickTolerance:e,move:(u,p)=>({bearingDelta:(p.x-u.x)*s}),moveStateManager:l,enable:f,assignEvents:yl})},Fr=({enable:f,clickTolerance:e,pitchDegreesPerPixelMoved:s=-.5})=>{const l=new Ta({checkCorrectEvent:u=>Z.mouseButton(u)===0&&u.ctrlKey||Z.mouseButton(u)===2});return new Ks({clickTolerance:e,move:(u,p)=>({pitchDelta:(p.y-u.y)*s}),moveStateManager:l,enable:f,assignEvents:yl})};class Ws{constructor(e,s){this._clickTolerance=e.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new h.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,s,l){return this._calculateTransform(e,s,l)}touchmove(e,s,l){if(this._active){if(!this._shouldBePrevented(l.length))return e.preventDefault(),this._calculateTransform(e,s,l);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,s,l){this._calculateTransform(e,s,l),this._active&&this._shouldBePrevented(l.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,s,l){l.length>0&&(this._active=!0);const u=To(l,s),p=new h.P(0,0),w=new h.P(0,0);let k=0;for(const A in u){const R=u[A],B=this._touches[A];B&&(p._add(R),w._add(R.sub(B)),k++,u[A]=R)}if(this._touches=u,this._shouldBePrevented(k)||!w.mag())return;const E=w.div(k);return this._sum._add(E),this._sum.mag()<this._clickTolerance?void 0:{around:p.div(k),panDelta:E}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ja{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,s,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([s[0],s[1]]))}touchmove(e,s,l){if(!this._firstTwoTouches)return;e.preventDefault();const[u,p]=this._firstTwoTouches,w=Xs(l,s,u),k=Xs(l,s,p);if(!w||!k)return;const E=this._aroundCenter?null:w.add(k).div(2);return this._move([w,k],E,e)}touchend(e,s,l){if(!this._firstTwoTouches)return;const[u,p]=this._firstTwoTouches,w=Xs(l,s,u),k=Xs(l,s,p);w&&k||(this._active&&Z.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Xs(f,e,s){for(let l=0;l<f.length;l++)if(f[l].identifier===s)return e[l]}function lu(f,e){return Math.log(f/e)/Math.LN2}class _l extends Ja{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,s){const l=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(lu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:lu(this._distance,l),pinchAround:s}}}function Qa(f,e){return 180*f.angleWith(e)/Math.PI}class Eo extends Ja{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,s,l){const u=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Qa(this._vector,u),pinchAround:s}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const s=25/(Math.PI*this._minDiameter)*360,l=Qa(e,this._startVector);return Math.abs(l)<s}}function Ys(f){return Math.abs(f.y)>Math.abs(f.x)}class Po extends Ja{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,s,l){super.touchstart(e,s,l),this._currentTouchCount=l.length}_start(e){this._lastPoints=e,Ys(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,s,l){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const u=e[0].sub(this._lastPoints[0]),p=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(u,p,l.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(u.y+p.y)/2*-.5}):void 0}gestureBeginsVertically(e,s,l){if(this._valid!==void 0)return this._valid;const u=e.mag()>=2,p=s.mag()>=2;if(!u&&!p)return;if(!u||!p)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const w=e.y>0==s.y>0;return Ys(e)&&Ys(s)&&w}}const ih={panStep:100,bearingStep:15,pitchStep:10};class Ri{constructor(e){this._tr=new Li(e);const s=ih;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let s=0,l=0,u=0,p=0,w=0;switch(e.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:e.shiftKey?l=-1:(e.preventDefault(),p=-1);break;case 39:e.shiftKey?l=1:(e.preventDefault(),p=1);break;case 38:e.shiftKey?u=1:(e.preventDefault(),w=-1);break;case 40:e.shiftKey?u=-1:(e.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(l=0,u=0),{cameraAnimation:k=>{const E=this._tr;k.easeTo({duration:300,easeId:"keyboardHandler",easing:is,zoom:s?Math.round(E.zoom)+s*(e.shiftKey?2:1):E.zoom,bearing:E.bearing+l*this._bearingStep,pitch:E.pitch+u*this._pitchStep,offset:[-p*this._panStep,-w*this._panStep],center:E.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function is(f){return f*(2-f)}const Co=4.000244140625;class si{constructor(e,s){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=e,this._tr=new Li(e),this._triggerRenderFrame=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let s=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const l=Y.now(),u=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,s!==0&&s%Co==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":u>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(u*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),e.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=e,this._delta-=s,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=Z.mousePos(this._map.getCanvas(),e),l=this._tr;this._around=s.y>l.transform.height/2-l.transform.getHorizon()?h.N.convert(this._aroundCenter?l.center:l.unproject(s)):h.N.convert(l.center),this._aroundPoint=l.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(this._delta!==0){const E=this._type==="wheel"&&Math.abs(this._delta)>Co?this._wheelZoomRate:this._defaultZoomRate;let A=2/(1+Math.exp(-Math.abs(this._delta*E)));this._delta<0&&A!==0&&(A=1/A);const R=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(R*A))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,l=this._startZoom,u=this._easing;let p,w=!1;const k=Y.now()-this._lastWheelEventTime;if(this._type==="wheel"&&l&&u&&k){const E=Math.min(k/200,1),A=u(E);p=h.y.number(l,s,A),E<1?this._frameId||(this._frameId=!0):w=!0}else p=s,w=!0;return this._active=!0,w&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!w,zoomDelta:p-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let s=h.b9;if(this._prevEase){const l=this._prevEase,u=(Y.now()-l.start)/l.duration,p=l.easing(u+.01)-l.easing(u),w=.27/Math.sqrt(p*p+1e-4)*.01,k=Math.sqrt(.0729-w*w);s=h.b8(w,k,.25,1)}return this._prevEase={start:Y.now(),duration:e,easing:s},s}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Js{constructor(e,s){this._clickZoom=e,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ju{constructor(e){this._tr=new Li(e),this.reset()}reset(){this._active=!1}dblclick(e,s){return e.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(s)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qu{constructor(){this._tap=new Io({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,s,l){if(!this._swipePoint)if(this._tapTime){const u=s[0],p=e.timeStamp-this._tapTime<500,w=this._tapPoint.dist(u)<30;p&&w?l.length>0&&(this._swipePoint=u,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(e,s,l)}touchmove(e,s,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const u=s[0],p=u.y-this._swipePoint.y;return this._swipePoint=u,e.preventDefault(),this._active=!0,{zoomDelta:p/128}}}else this._tap.touchmove(e,s,l)}touchend(e,s,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const u=this._tap.touchend(e,s,l);u&&(this._tapTime=e.timeStamp,this._tapPoint=u)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class uu{constructor(e,s,l){this._el=e,this._mousePan=s,this._touchPan=l}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class sh{constructor(e,s,l){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=s,this._mousePitch=l}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class cu{constructor(e,s,l,u){this._el=e,this._touchZoom=s,this._touchRotate=l,this._tapDragZoom=u,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Mo{constructor(e,s){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=s,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=Z.create("div","maplibregl-cooperative-gesture-screen",e);let s=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(s=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const l=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),u=document.createElement("div");u.className="maplibregl-desktop-message",u.textContent=s,this._container.appendChild(u);const p=document.createElement("div");p.className="maplibregl-mobile-message",p.textContent=l,this._container.appendChild(p),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(Z.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,s){this._enabled&&(this._map.fire(new h.k("cooperativegestureprevented",{gestureType:e,originalEvent:s})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const Bi=f=>f.zoom||f.drag||f.pitch||f.rotate;class mt extends h.k{}function ss(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class hu{constructor(e,s){this.handleWindowEvent=u=>{this.handleEvent(u,`${u.type}Window`)},this.handleEvent=(u,p)=>{if(u.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const w=u.type==="renderFrame"?void 0:u,k={needsRenderFrame:!1},E={},A={},R=u.touches,B=R?this._getMapTouches(R):void 0,U=B?Z.touchPos(this._map.getCanvas(),B):Z.mousePos(this._map.getCanvas(),u);for(const{handlerName:J,handler:te,allowed:se}of this._handlers){if(!te.isEnabled())continue;let ce;this._blockedByActive(A,se,J)?te.reset():te[p||u.type]&&(ce=te[p||u.type](u,U,B),this.mergeHandlerResult(k,E,ce,J,w),ce&&ce.needsRenderFrame&&this._triggerRenderFrame()),(ce||te.isActive())&&(A[J]=te)}const G={};for(const J in this._previousActiveHandlers)A[J]||(G[J]=w);this._previousActiveHandlers=A,(Object.keys(G).length||ss(k))&&(this._changes.push([k,E,G]),this._triggerRenderFrame()),(Object.keys(A).length||ss(k))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:X}=k;X&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],X(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ko(e),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[u,p,w]of this._listeners)Z.addEventListener(u,p,u===document?this.handleWindowEvent:this.handleEvent,w)}destroy(){for(const[e,s,l]of this._listeners)Z.removeEventListener(e,s,e===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(e){const s=this._map,l=s.getCanvasContainer();this._add("mapEvent",new Wu(s,e));const u=s.boxZoom=new ii(s,e);this._add("boxZoom",u),e.interactive&&e.boxZoom&&u.enable();const p=s.cooperativeGestures=new Mo(s,e.cooperativeGestures);this._add("cooperativeGestures",p),e.cooperativeGestures&&p.enable();const w=new ka(s),k=new Ju(s);s.doubleClickZoom=new Js(k,w),this._add("tapZoom",w),this._add("clickZoom",k),e.interactive&&e.doubleClickZoom&&s.doubleClickZoom.enable();const E=new Qu;this._add("tapDragZoom",E);const A=s.touchPitch=new Po(s);this._add("touchPitch",A),e.interactive&&e.touchPitch&&s.touchPitch.enable(e.touchPitch);const R=ou(e),B=Fr(e);s.dragRotate=new sh(e,R,B),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",B,["mouseRotate"]),e.interactive&&e.dragRotate&&s.dragRotate.enable();const U=(({enable:ce,clickTolerance:Q})=>{const fe=new Ta({checkCorrectEvent:ye=>Z.mouseButton(ye)===0&&!ye.ctrlKey});return new Ks({clickTolerance:Q,move:(ye,be)=>({around:be,panDelta:be.sub(ye)}),activateOnStart:!0,moveStateManager:fe,enable:ce,assignEvents:yl})})(e),G=new Ws(e,s);s.dragPan=new uu(l,U,G),this._add("mousePan",U),this._add("touchPan",G,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&s.dragPan.enable(e.dragPan);const X=new Eo,J=new _l;s.touchZoomRotate=new cu(l,J,X,E),this._add("touchRotate",X,["touchPan","touchZoom"]),this._add("touchZoom",J,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&s.touchZoomRotate.enable(e.touchZoomRotate);const te=s.scrollZoom=new si(s,(()=>this._triggerRenderFrame()));this._add("scrollZoom",te,["mousePan"]),e.interactive&&e.scrollZoom&&s.scrollZoom.enable(e.scrollZoom);const se=s.keyboard=new Ri(s);this._add("keyboard",se),e.interactive&&e.keyboard&&s.keyboard.enable(),this._add("blockableMapEvent",new Yr(s))}_add(e,s,l){this._handlers.push({handlerName:e,handler:s,allowed:l}),this._handlersById[e]=s}stop(e){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Bi(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,s,l){for(const u in e)if(u!==l&&(!s||s.indexOf(u)<0))return!0;return!1}_getMapTouches(e){const s=[];for(const l of e)this._el.contains(l.target)&&s.push(l);return s}mergeHandlerResult(e,s,l,u,p){if(!l)return;h.e(e,l);const w={handlerName:u,originalEvent:l.originalEvent||p};l.zoomDelta!==void 0&&(s.zoom=w),l.panDelta!==void 0&&(s.drag=w),l.pitchDelta!==void 0&&(s.pitch=w),l.bearingDelta!==void 0&&(s.rotate=w)}_applyChanges(){const e={},s={},l={};for(const[u,p,w]of this._changes)u.panDelta&&(e.panDelta=(e.panDelta||new h.P(0,0))._add(u.panDelta)),u.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+u.zoomDelta),u.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+u.bearingDelta),u.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+u.pitchDelta),u.around!==void 0&&(e.around=u.around),u.pinchAround!==void 0&&(e.pinchAround=u.pinchAround),u.noInertia&&(e.noInertia=u.noInertia),h.e(s,p),h.e(l,w);this._updateMapTransform(e,s,l),this._changes=[]}_updateMapTransform(e,s,l){const u=this._map,p=u._getTransformForUpdate(),w=u.terrain;if(!(ss(e)||w&&this._terrainMovement))return this._fireEvents(s,l,!0);let{panDelta:k,zoomDelta:E,bearingDelta:A,pitchDelta:R,around:B,pinchAround:U}=e;U!==void 0&&(B=U),u._stop(!0),B=B||u.transform.centerPoint;const G=p.pointLocation(k?B.sub(k):B);A&&(p.bearing+=A),R&&(p.pitch+=R),E&&(p.zoom+=E),w?this._terrainMovement||!s.drag&&!s.zoom?s.drag&&this._terrainMovement?p.center=p.pointLocation(p.centerPoint.sub(k)):p.setLocationAtPoint(G,B):(this._terrainMovement=!0,this._map._elevationFreeze=!0,p.setLocationAtPoint(G,B)):p.setLocationAtPoint(G,B),u._applyUpdatedTransform(p),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(s,l,!0)}_fireEvents(e,s,l){const u=Bi(this._eventsInProgress),p=Bi(e),w={};for(const B in e){const{originalEvent:U}=e[B];this._eventsInProgress[B]||(w[`${B}start`]=U),this._eventsInProgress[B]=e[B]}!u&&p&&this._fireEvent("movestart",p.originalEvent);for(const B in w)this._fireEvent(B,w[B]);p&&this._fireEvent("move",p.originalEvent);for(const B in e){const{originalEvent:U}=e[B];this._fireEvent(B,U)}const k={};let E;for(const B in this._eventsInProgress){const{handlerName:U,originalEvent:G}=this._eventsInProgress[B];this._handlersById[U].isActive()||(delete this._eventsInProgress[B],E=s[U]||G,k[`${B}end`]=E)}for(const B in k)this._fireEvent(B,k[B]);const A=Bi(this._eventsInProgress),R=(u||p)&&!A;if(R&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const B=this._map._getTransformForUpdate();B.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(B)}if(l&&R){this._updatingCamera=!0;const B=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=G=>G!==0&&-this._bearingSnap<G&&G<this._bearingSnap;!B||!B.essential&&Y.prefersReducedMotion?(this._map.fire(new h.k("moveend",{originalEvent:E})),U(this._map.getBearing())&&this._map.resetNorth()):(U(B.bearing||this._map.getBearing())&&(B.bearing=0),B.freezeElevation=!0,this._map.easeTo(B,{originalEvent:E})),this._updatingCamera=!1}}_fireEvent(e,s){this._map.fire(new h.k(e,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{delete this._frameId,this.handleEvent(new mt("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class eo extends h.E{constructor(e,s){super(),this._renderFrameCallback=()=>{const l=Math.min((Y.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(l)),l<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=s.bearingSnap,this.on("moveend",(()=>{delete this._requestedCameraState}))}getCenter(){return new h.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,s){return this.jumpTo({center:e},s)}panBy(e,s,l){return e=h.P.convert(e).mult(-1),this.panTo(this.transform.center,h.e({offset:e},s),l)}panTo(e,s,l){return this.easeTo(h.e({center:e},s),l)}getZoom(){return this.transform.zoom}setZoom(e,s){return this.jumpTo({zoom:e},s),this}zoomTo(e,s,l){return this.easeTo(h.e({zoom:e},s),l)}zoomIn(e,s){return this.zoomTo(this.getZoom()+1,e,s),this}zoomOut(e,s){return this.zoomTo(this.getZoom()-1,e,s),this}getBearing(){return this.transform.bearing}setBearing(e,s){return this.jumpTo({bearing:e},s),this}getPadding(){return this.transform.padding}setPadding(e,s){return this.jumpTo({padding:e},s),this}rotateTo(e,s,l){return this.easeTo(h.e({bearing:e},s),l)}resetNorth(e,s){return this.rotateTo(0,h.e({duration:1e3},e),s),this}resetNorthPitch(e,s){return this.easeTo(h.e({bearing:0,pitch:0,duration:1e3},e),s),this}snapToNorth(e,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,s):this}getPitch(){return this.transform.pitch}setPitch(e,s){return this.jumpTo({pitch:e},s),this}cameraForBounds(e,s){e=Ee.convert(e).adjustAntiMeridian();const l=s&&s.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),l,s)}_cameraForBoxAndBearing(e,s,l,u){const p={top:0,bottom:0,right:0,left:0};if(typeof(u=h.e({padding:p,offset:[0,0],maxZoom:this.transform.maxZoom},u)).padding=="number"){const tt=u.padding;u.padding={top:tt,bottom:tt,right:tt,left:tt}}u.padding=h.e(p,u.padding);const w=this.transform,k=w.padding,E=new Ee(e,s),A=w.project(E.getNorthWest()),R=w.project(E.getNorthEast()),B=w.project(E.getSouthEast()),U=w.project(E.getSouthWest()),G=h.ba(-l),X=A.rotate(G),J=R.rotate(G),te=B.rotate(G),se=U.rotate(G),ce=new h.P(Math.max(X.x,J.x,se.x,te.x),Math.max(X.y,J.y,se.y,te.y)),Q=new h.P(Math.min(X.x,J.x,se.x,te.x),Math.min(X.y,J.y,se.y,te.y)),fe=ce.sub(Q),ye=(w.width-(k.left+k.right+u.padding.left+u.padding.right))/fe.x,be=(w.height-(k.top+k.bottom+u.padding.top+u.padding.bottom))/fe.y;if(be<0||ye<0)return void h.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Fe=Math.min(w.scaleZoom(w.scale*Math.min(ye,be)),u.maxZoom),Ge=h.P.convert(u.offset),Qe=new h.P((u.padding.left-u.padding.right)/2,(u.padding.top-u.padding.bottom)/2).rotate(h.ba(l)),ut=Ge.add(Qe).mult(w.scale/w.zoomScale(Fe));return{center:w.unproject(A.add(B).div(2).sub(ut)),zoom:Fe,bearing:l}}fitBounds(e,s,l){return this._fitInternal(this.cameraForBounds(e,s),s,l)}fitScreenCoordinates(e,s,l,u,p){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(h.P.convert(e)),this.transform.pointLocation(h.P.convert(s)),l,u),u,p)}_fitInternal(e,s,l){return e?(delete(s=h.e(e,s)).padding,s.linear?this.easeTo(s,l):this.flyTo(s,l)):this}jumpTo(e,s){this.stop();const l=this._getTransformForUpdate();let u=!1,p=!1,w=!1;return"zoom"in e&&l.zoom!==+e.zoom&&(u=!0,l.zoom=+e.zoom),e.center!==void 0&&(l.center=h.N.convert(e.center)),"bearing"in e&&l.bearing!==+e.bearing&&(p=!0,l.bearing=+e.bearing),"pitch"in e&&l.pitch!==+e.pitch&&(w=!0,l.pitch=+e.pitch),e.padding==null||l.isPaddingEqual(e.padding)||(l.padding=e.padding),this._applyUpdatedTransform(l),this.fire(new h.k("movestart",s)).fire(new h.k("move",s)),u&&this.fire(new h.k("zoomstart",s)).fire(new h.k("zoom",s)).fire(new h.k("zoomend",s)),p&&this.fire(new h.k("rotatestart",s)).fire(new h.k("rotate",s)).fire(new h.k("rotateend",s)),w&&this.fire(new h.k("pitchstart",s)).fire(new h.k("pitch",s)).fire(new h.k("pitchend",s)),this.fire(new h.k("moveend",s))}calculateCameraOptionsFromTo(e,s,l,u=0){const p=h.Z.fromLngLat(e,s),w=h.Z.fromLngLat(l,u),k=w.x-p.x,E=w.y-p.y,A=w.z-p.z,R=Math.hypot(k,E,A);if(R===0)throw new Error("Can't calculate camera options with same From and To");const B=Math.hypot(k,E),U=this.transform.scaleZoom(this.transform.cameraToCenterDistance/R/this.transform.tileSize),G=180*Math.atan2(k,-E)/Math.PI;let X=180*Math.acos(B/R)/Math.PI;return X=A<0?90-X:90+X,{center:w.toLngLat(),zoom:U,pitch:X,bearing:G}}easeTo(e,s){var l;this._stop(!1,e.easeId),((e=h.e({offset:[0,0],duration:500,easing:h.b9},e)).animate===!1||!e.essential&&Y.prefersReducedMotion)&&(e.duration=0);const u=this._getTransformForUpdate(),p=u.zoom,w=u.bearing,k=u.pitch,E=u.padding,A="bearing"in e?this._normalizeBearing(e.bearing,w):w,R="pitch"in e?+e.pitch:k,B="padding"in e?e.padding:u.padding,U=h.P.convert(e.offset);let G=u.centerPoint.add(U);const X=u.pointLocation(G),{center:J,zoom:te}=u.getConstrained(h.N.convert(e.center||X),(l=e.zoom)!==null&&l!==void 0?l:p);this._normalizeCenter(J,u);const se=u.project(X),ce=u.project(J).sub(se),Q=u.zoomScale(te-p);let fe,ye;e.around&&(fe=h.N.convert(e.around),ye=u.locationPoint(fe));const be={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||te!==p,this._rotating=this._rotating||w!==A,this._pitching=this._pitching||R!==k,this._padding=!u.isPaddingEqual(B),this._easeId=e.easeId,this._prepareEase(s,e.noMoveStart,be),this.terrain&&this._prepareElevation(J),this._ease((Fe=>{if(this._zooming&&(u.zoom=h.y.number(p,te,Fe)),this._rotating&&(u.bearing=h.y.number(w,A,Fe)),this._pitching&&(u.pitch=h.y.number(k,R,Fe)),this._padding&&(u.interpolatePadding(E,B,Fe),G=u.centerPoint.add(U)),this.terrain&&!e.freezeElevation&&this._updateElevation(Fe),fe)u.setLocationAtPoint(fe,ye);else{const Ge=u.zoomScale(u.zoom-p),Qe=te>p?Math.min(2,Q):Math.max(.5,Q),ut=Math.pow(Qe,1-Fe),tt=u.unproject(se.add(ce.mult(Fe*ut)).mult(Ge));u.setLocationAtPoint(u.renderWorldCopies?tt.wrap():tt,G)}this._applyUpdatedTransform(u),this._fireMoveEvents(s)}),(Fe=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(s,Fe)}),e),this}_prepareEase(e,s,l={}){this._moving=!0,s||l.moving||this.fire(new h.k("movestart",e)),this._zooming&&!l.zooming&&this.fire(new h.k("zoomstart",e)),this._rotating&&!l.rotating&&this.fire(new h.k("rotatestart",e)),this._pitching&&!l.pitching&&this.fire(new h.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const s=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&s!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(l-(s-(l*e+this._elevationStart))/(1-e)),this._elevationTarget=s}this.transform.elevation=h.y.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){const s=e.getCameraPosition(),l=this.terrain.getElevationForLngLatZoom(s.lngLat,e.zoom);if(s.altitude<l){const u=this.calculateCameraOptionsFromTo(s.lngLat,l,e.center,e.elevation);return{pitch:u.pitch,zoom:u.zoom}}return{}}_applyUpdatedTransform(e){const s=[];if(this.terrain&&s.push((u=>this._elevateCameraIfInsideTerrain(u))),this.transformCameraUpdate&&s.push((u=>this.transformCameraUpdate(u))),!s.length)return;const l=e.clone();for(const u of s){const p=l.clone(),{center:w,zoom:k,pitch:E,bearing:A,elevation:R}=u(p);w&&(p.center=w),k!==void 0&&(p.zoom=k),E!==void 0&&(p.pitch=E),A!==void 0&&(p.bearing=A),R!==void 0&&(p.elevation=R),l.apply(p)}this.transform.apply(l)}_fireMoveEvents(e){this.fire(new h.k("move",e)),this._zooming&&this.fire(new h.k("zoom",e)),this._rotating&&this.fire(new h.k("rotate",e)),this._pitching&&this.fire(new h.k("pitch",e))}_afterEase(e,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId;const l=this._zooming,u=this._rotating,p=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,l&&this.fire(new h.k("zoomend",e)),u&&this.fire(new h.k("rotateend",e)),p&&this.fire(new h.k("pitchend",e)),this.fire(new h.k("moveend",e))}flyTo(e,s){var l;if(!e.essential&&Y.prefersReducedMotion){const st=h.M(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(st,s)}this.stop(),e=h.e({offset:[0,0],speed:1.2,curve:1.42,easing:h.b9},e);const u=this._getTransformForUpdate(),p=u.zoom,w=u.bearing,k=u.pitch,E=u.padding,A="bearing"in e?this._normalizeBearing(e.bearing,w):w,R="pitch"in e?+e.pitch:k,B="padding"in e?e.padding:u.padding,U=h.P.convert(e.offset);let G=u.centerPoint.add(U);const X=u.pointLocation(G),{center:J,zoom:te}=u.getConstrained(h.N.convert(e.center||X),(l=e.zoom)!==null&&l!==void 0?l:p);this._normalizeCenter(J,u);const se=u.zoomScale(te-p),ce=u.project(X),Q=u.project(J).sub(ce);let fe=e.curve;const ye=Math.max(u.width,u.height),be=ye/se,Fe=Q.mag();if("minZoom"in e){const st=h.ac(Math.min(e.minZoom,p,te),u.minZoom,u.maxZoom),Bt=ye/u.zoomScale(st-p);fe=Math.sqrt(Bt/Fe*2)}const Ge=fe*fe;function Qe(st){const Bt=(be*be-ye*ye+(st?-1:1)*Ge*Ge*Fe*Fe)/(2*(st?be:ye)*Ge*Fe);return Math.log(Math.sqrt(Bt*Bt+1)-Bt)}function ut(st){return(Math.exp(st)-Math.exp(-st))/2}function tt(st){return(Math.exp(st)+Math.exp(-st))/2}const Xe=Qe(!1);let _t=function(st){return tt(Xe)/tt(Xe+fe*st)},Ft=function(st){return ye*((tt(Xe)*(ut(Bt=Xe+fe*st)/tt(Bt))-ut(Xe))/Ge)/Fe;var Bt},nt=(Qe(!0)-Xe)/fe;if(Math.abs(Fe)<1e-6||!isFinite(nt)){if(Math.abs(ye-be)<1e-6)return this.easeTo(e,s);const st=be<ye?-1:1;nt=Math.abs(Math.log(be/ye))/fe,Ft=()=>0,_t=Bt=>Math.exp(st*fe*Bt)}return e.duration="duration"in e?+e.duration:1e3*nt/("screenSpeed"in e?+e.screenSpeed/fe:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=w!==A,this._pitching=R!==k,this._padding=!u.isPaddingEqual(B),this._prepareEase(s,!1),this.terrain&&this._prepareElevation(J),this._ease((st=>{const Bt=st*nt,Cr=1/_t(Bt);u.zoom=st===1?te:p+u.scaleZoom(Cr),this._rotating&&(u.bearing=h.y.number(w,A,st)),this._pitching&&(u.pitch=h.y.number(k,R,st)),this._padding&&(u.interpolatePadding(E,B,st),G=u.centerPoint.add(U)),this.terrain&&!e.freezeElevation&&this._updateElevation(st);const Ht=st===1?J:u.unproject(ce.add(Q.mult(Ft(Bt))).mult(Cr));u.setLocationAtPoint(u.renderWorldCopies?Ht.wrap():Ht,G),this._applyUpdatedTransform(u),this._fireMoveEvents(s)}),(()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(s)}),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,s){var l;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const u=this._onEaseEnd;delete this._onEaseEnd,u.call(this,s)}return e||(l=this.handlers)===null||l===void 0||l.stop(!1),this}_ease(e,s,l){l.animate===!1||l.duration===0?(e(1),s()):(this._easeStart=Y.now(),this._easeOptions=l,this._onEaseFrame=e,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,s){e=h.b3(e,-180,180);const l=Math.abs(e-s);return Math.abs(e-360-s)<l&&(e-=360),Math.abs(e+360-s)<l&&(e+=360),e}_normalizeCenter(e,s){if(!s.renderWorldCopies||s.lngRange)return;const l=e.lng-s.center.lng;e.lng+=l>180?-360:l<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(h.N.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}const Gn={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class As{constructor(e=Gn){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=s=>{!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"&&s.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=Z.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=Z.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Z.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){Z.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,s){const l=this._map._getUIString(`AttributionControl.${s}`);e.title=l,e.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map((u=>typeof u!="string"?"":u))):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}const s=this._map.style.sourceCaches;for(const u in s){const p=s[u];if(p.used||p.usedForTerrain){const w=p.getSource();w.attribution&&e.indexOf(w.attribution)<0&&e.push(w.attribution)}}e=e.filter((u=>String(u).trim())),e.sort(((u,p)=>u.length-p.length)),e=e.filter(((u,p)=>{for(let w=p+1;w<e.length;w++)if(e[w].indexOf(u)>=0)return!1;return!0}));const l=e.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,e.length?(this._innerContainer.innerHTML=l,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class as{constructor(e={}){this._updateCompact=()=>{const s=this._container.children;if(s.length){const l=s[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=Z.create("div","maplibregl-ctrl");const s=Z.create("a","maplibregl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){Z.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class sr{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const s=++this._id;return this._queue.push({callback:e,id:s,cancelled:!1}),s}remove(e){const s=this._currentlyRunning,l=s?this._queue.concat(s):this._queue;for(const u of l)if(u.id===e)return void(u.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const l of s)if(!l.cancelled&&(l.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var ec=h.Y([{name:"a_pos3d",type:"Int16",components:3}]);class od extends h.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,s){this.sourceCache.update(e,s),this._renderableTilesKeys=[];const l={};for(const u of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s}))l[u.key]=!0,this._renderableTilesKeys.push(u.key),this._tiles[u.key]||(u.posMatrix=new Float64Array(16),h.aP(u.posMatrix,0,h.X,0,h.X,0,1),this._tiles[u.key]=new fa(u,this.tileSize));for(const u in this._tiles)l[u]||delete this._tiles[u]}freeRtt(e){for(const s in this._tiles){const l=this._tiles[s];(!e||l.tileID.equals(e)||l.tileID.isChildOf(e)||e.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((e=>this.getTileByID(e)))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const s={};for(const l of this._renderableTilesKeys){const u=this._tiles[l].tileID;if(u.canonical.equals(e.canonical)){const p=e.clone();p.posMatrix=new Float64Array(16),h.aP(p.posMatrix,0,h.X,0,h.X,0,1),s[l]=p}else if(u.canonical.isChildOf(e.canonical)){const p=e.clone();p.posMatrix=new Float64Array(16);const w=u.canonical.z-e.canonical.z,k=u.canonical.x-(u.canonical.x>>w<<w),E=u.canonical.y-(u.canonical.y>>w<<w),A=h.X>>w;h.aP(p.posMatrix,0,A,0,A,0,1),h.J(p.posMatrix,p.posMatrix,[-k*A,-E*A,0]),s[l]=p}else if(e.canonical.isChildOf(u.canonical)){const p=e.clone();p.posMatrix=new Float64Array(16);const w=e.canonical.z-u.canonical.z,k=e.canonical.x-(e.canonical.x>>w<<w),E=e.canonical.y-(e.canonical.y>>w<<w),A=h.X>>w;h.aP(p.posMatrix,0,h.X,0,h.X,0,1),h.J(p.posMatrix,p.posMatrix,[k*A,E*A,0]),h.K(p.posMatrix,p.posMatrix,[1/2**w,1/2**w,0]),s[l]=p}}return s}getSourceTile(e,s){const l=this.sourceCache._source;let u=e.overscaledZ-this.deltaZoom;if(u>l.maxzoom&&(u=l.maxzoom),u<l.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(u).key);let p=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!p||!p.dem)&&s)for(;u>=l.minzoom&&(!p||!p.dem);)p=this.sourceCache.getTileByID(e.scaledTo(u--).key);return p}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter((s=>s.timeAdded>=e))}}class Qs{constructor(e,s,l){this.painter=e,this.sourceCache=new od(s),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,s,l,u=h.X){var p;if(!(s>=0&&s<u&&l>=0&&l<u))return 0;const w=this.getTerrainData(e),k=(p=w.tile)===null||p===void 0?void 0:p.dem;if(!k)return 0;const E=(function(X,J,te){var se=J[0],ce=J[1];return X[0]=te[0]*se+te[4]*ce+te[12],X[1]=te[1]*se+te[5]*ce+te[13],X})([],[s/u*h.X,l/u*h.X],w.u_terrain_matrix),A=[E[0]*k.dim,E[1]*k.dim],R=Math.floor(A[0]),B=Math.floor(A[1]),U=A[0]-R,G=A[1]-B;return k.get(R,B)*(1-U)*(1-G)+k.get(R+1,B)*U*(1-G)+k.get(R,B+1)*(1-U)*G+k.get(R+1,B+1)*U*G}getElevationForLngLatZoom(e,s){if(!h.bb(s,e.wrap()))return 0;const{tileID:l,mercatorX:u,mercatorY:p}=this._getOverscaledTileIDFromLngLatZoom(e,s);return this.getElevation(l,u%h.X,p%h.X,h.X)}getElevation(e,s,l,u=h.X){return this.getDEMElevation(e,s,l,u)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const u=this.painter.context,p=new h.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new xt(u,p,u.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new xt(u,new h.R({width:1,height:1}),u.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=h.an([])}const s=this.sourceCache.getSourceTile(e,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const u=this.painter.context;s.demTexture=this.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new xt(u,s.dem.getPixels(),u.gl.RGBA,{premultiply:!1}),s.demTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const l=s&&s+s.tileID.key+e.key;if(l&&!this._demMatrixCache[l]){const u=this.sourceCache.sourceCache._source.maxzoom;let p=e.canonical.z-s.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=u?p=e.canonical.z-u:h.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const w=e.canonical.x-(e.canonical.x>>p<<p),k=e.canonical.y-(e.canonical.y>>p<<p),E=h.bc(new Float64Array(16),[1/(h.X<<p),1/(h.X<<p),0]);h.J(E,E,[w*h.X,k*h.X,0]),this._demMatrixCache[e.key]={matrix:E,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getFramebuffer(e){const s=this.painter,l=s.width/devicePixelRatio,u=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===u||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new xt(s.context,{width:l,height:u,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new xt(s.context,{width:l,height:u,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(l,u,!0,!1),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,l,u))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let p=0,w=0;p<this._coordsTextureSize;p++)for(let k=0;k<this._coordsTextureSize;k++,w+=4)s[w+0]=255&k,s[w+1]=255&p,s[w+2]=k>>8<<4|p>>8,s[w+3]=0;const l=new h.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),u=new xt(e,l,e.gl.RGBA,{premultiply:!1});return u.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=u,u}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const s=new Uint8Array(4),l=this.painter.context,u=l.gl,p=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),w=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),k=Math.round(this.painter.height/devicePixelRatio);l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),u.readPixels(p,k-w-1,1,1,u.RGBA,u.UNSIGNED_BYTE,s),l.bindFramebuffer.set(null);const E=s[0]+(s[2]>>4<<8),A=s[1]+((15&s[2])<<8),R=this.coordsIndex[255-s[3]],B=R&&this.sourceCache.getTileByID(R);if(!B)return null;const U=this._coordsTextureSize,G=(1<<B.tileID.canonical.z)*U;return new h.Z((B.tileID.canonical.x*U+E)/G+B.tileID.wrap,(B.tileID.canonical.y*U+A)/G,this.getElevation(B.tileID,E,A,U))}depthAtPoint(e){const s=new Uint8Array(4),l=this.painter.context,u=l.gl;return l.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),u.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,u.RGBA,u.UNSIGNED_BYTE,s),l.bindFramebuffer.set(null),(s[0]/16777216+s[1]/65536+s[2]/256+s[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,s=new h.bd,l=new h.aY,u=this.meshSize,p=h.X/u,w=u*u;for(let B=0;B<=u;B++)for(let U=0;U<=u;U++)s.emplaceBack(U*p,B*p,0);for(let B=0;B<w;B+=u+1)for(let U=0;U<u;U++)l.emplaceBack(U+B,u+U+B+1,u+U+B+2),l.emplaceBack(U+B,u+U+B+2,U+B+1);const k=s.length,E=k+2*(u+1);for(const B of[0,1])for(let U=0;U<=u;U++)for(const G of[0,1])s.emplaceBack(U*p,B*h.X,G);for(let B=0;B<2*u;B+=2)l.emplaceBack(E+B,E+B+1,E+B+3),l.emplaceBack(E+B,E+B+3,E+B+2),l.emplaceBack(k+B,k+B+3,k+B+1),l.emplaceBack(k+B,k+B+2,k+B+3);const A=s.length,R=A+2*(u+1);for(const B of[0,1])for(let U=0;U<=u;U++)for(const G of[0,1])s.emplaceBack(B*h.X,U*p,G);for(let B=0;B<2*u;B+=2)l.emplaceBack(A+B,A+B+1,A+B+3),l.emplaceBack(A+B,A+B+3,A+B+2),l.emplaceBack(R+B,R+B+3,R+B+1),l.emplaceBack(R+B,R+B+2,R+B+3);return this._mesh=new ni(e.createVertexBuffer(s,ec.members),e.createIndexBuffer(l),h.a0.simpleSegment(0,0,s.length,l.length)),this._mesh}getMeshFrameDelta(e){return 2*Math.PI*h.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,s){var l;const{tileID:u}=this._getOverscaledTileIDFromLngLatZoom(e,s);return(l=this.getMinMaxElevation(u).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(e){const s=this.getTerrainData(e).tile,l={minElevation:null,maxElevation:null};return s&&s.dem&&(l.minElevation=s.dem.min*this.exaggeration,l.maxElevation=s.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(e,s){const l=h.Z.fromLngLat(e.wrap()),u=(1<<s)*h.X,p=l.x*u,w=l.y*u,k=Math.floor(p/h.X),E=Math.floor(w/h.X);return{tileID:new h.S(s,0,s,k,E),mercatorX:p,mercatorY:w}}}class vl{constructor(e,s,l){this._context=e,this._size=s,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const s=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new xt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),s.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),s.colorAttachment.set(l.texture),{id:e,fbo:s,texture:l,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((s=>e.id!==s)),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const s of this._recentlyUsed)if(!this._objects[s].inUse)return this._objects[s];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((e=>!e.inUse))===!1}}const os={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class xl{constructor(e,s){this.painter=e,this.terrain=s,this.pool=new vl(e.context,30,s.sourceCache.tileSize*s.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,s){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter((l=>!e._layers[l].isHidden(s))),this._coordsDescendingInv={};for(const l in e.sourceCaches){this._coordsDescendingInv[l]={};const u=e.sourceCaches[l].getVisibleCoordinates();for(const p of u){const w=this.terrain.sourceCache.getTerrainCoords(p);for(const k in w)this._coordsDescendingInv[l][k]||(this._coordsDescendingInv[l][k]=[]),this._coordsDescendingInv[l][k].push(w[k])}}this._coordsDescendingInvStr={};for(const l of e._order){const u=e._layers[l],p=u.source;if(os[u.type]&&!this._coordsDescendingInvStr[p]){this._coordsDescendingInvStr[p]={};for(const w in this._coordsDescendingInv[p])this._coordsDescendingInvStr[p][w]=this._coordsDescendingInv[p][w].map((k=>k.key)).sort().join()}}for(const l of this._renderableTiles)for(const u in this._coordsDescendingInvStr){const p=this._coordsDescendingInvStr[u][l.tileID.key];p&&p!==l.rttCoords[u]&&(l.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const s=e.type,l=this.painter,u=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(os[s]&&(this._prevType&&os[this._prevType]||this._stacks.push([]),this._prevType=s,this._stacks[this._stacks.length-1].push(e.id),!u))return!0;if(os[this._prevType]||os[s]&&u){this._prevType=s;const p=this._stacks.length-1,w=this._stacks[p]||[];for(const k of this._renderableTiles){if(this.pool.isFull()&&(nh(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(k),k.rtt[p]){const A=this.pool.getObjectForId(k.rtt[p].id);if(A.stamp===k.rtt[p].stamp){this.pool.useObject(A);continue}}const E=this.pool.getOrCreateFreeObject();this.pool.useObject(E),this.pool.stampObject(E),k.rtt[p]={id:E.id,stamp:E.stamp},l.context.bindFramebuffer.set(E.fbo.framebuffer),l.context.clear({color:h.aM.transparent,stencil:0}),l.currentStencilSource=void 0;for(let A=0;A<w.length;A++){const R=l.style._layers[w[A]],B=R.source?this._coordsDescendingInv[R.source][k.tileID.key]:[k.tileID];l.context.viewport.set([0,0,E.fbo.width,E.fbo.height]),l._renderTileClippingMasks(R,B),l.renderLayer(l,l.style.sourceCaches[R.source],R,B),R.source&&(k.rttCoords[R.source]=this._coordsDescendingInvStr[R.source][k.tileID.key])}}return nh(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),os[s]}return!1}}const wl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},to=W,Ia={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Gn,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:h.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},Or=f=>{f.touchstart=f.dragStart,f.touchmoveWindow=f.dragMove,f.touchend=f.dragEnd},Vr={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ea{constructor(e,s,l=!1){this.mousedown=w=>{this.startMouse(h.e({},w,{ctrlKey:!0,preventDefault:()=>w.preventDefault()}),Z.mousePos(this.element,w)),Z.addEventListener(window,"mousemove",this.mousemove),Z.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=w=>{this.moveMouse(w,Z.mousePos(this.element,w))},this.mouseup=w=>{this.mouseRotate.dragEnd(w),this.mousePitch&&this.mousePitch.dragEnd(w),this.offTemp()},this.touchstart=w=>{w.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Z.touchPos(this.element,w.targetTouches)[0],this.startTouch(w,this._startPos),Z.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),Z.addEventListener(window,"touchend",this.touchend))},this.touchmove=w=>{w.targetTouches.length!==1?this.reset():(this._lastPos=Z.touchPos(this.element,w.targetTouches)[0],this.moveTouch(w,this._lastPos))},this.touchend=w=>{w.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const u=e.dragRotate._mouseRotate.getClickTolerance(),p=e.dragRotate._mousePitch.getClickTolerance();this.element=s,this.mouseRotate=ou({clickTolerance:u,enable:!0}),this.touchRotate=(({enable:w,clickTolerance:k,bearingDegreesPerPixelMoved:E=.8})=>{const A=new Yu;return new Ks({clickTolerance:k,move:(R,B)=>({bearingDelta:(B.x-R.x)*E}),moveStateManager:A,enable:w,assignEvents:Or})})({clickTolerance:u,enable:!0}),this.map=e,l&&(this.mousePitch=Fr({clickTolerance:p,enable:!0}),this.touchPitch=(({enable:w,clickTolerance:k,pitchDegreesPerPixelMoved:E=-.5})=>{const A=new Yu;return new Ks({clickTolerance:k,move:(R,B)=>({pitchDelta:(B.y-R.y)*E}),moveStateManager:A,enable:w,assignEvents:Or})})({clickTolerance:p,enable:!0})),Z.addEventListener(s,"mousedown",this.mousedown),Z.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),Z.addEventListener(s,"touchcancel",this.reset)}startMouse(e,s){this.mouseRotate.dragStart(e,s),this.mousePitch&&this.mousePitch.dragStart(e,s),Z.disableDrag()}startTouch(e,s){this.touchRotate.dragStart(e,s),this.touchPitch&&this.touchPitch.dragStart(e,s),Z.disableDrag()}moveMouse(e,s){const l=this.map,{bearingDelta:u}=this.mouseRotate.dragMove(e,s)||{};if(u&&l.setBearing(l.getBearing()+u),this.mousePitch){const{pitchDelta:p}=this.mousePitch.dragMove(e,s)||{};p&&l.setPitch(l.getPitch()+p)}}moveTouch(e,s){const l=this.map,{bearingDelta:u}=this.touchRotate.dragMove(e,s)||{};if(u&&l.setBearing(l.getBearing()+u),this.touchPitch){const{pitchDelta:p}=this.touchPitch.dragMove(e,s)||{};p&&l.setPitch(l.getPitch()+p)}}off(){const e=this.element;Z.removeEventListener(e,"mousedown",this.mousedown),Z.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),Z.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Z.removeEventListener(window,"touchend",this.touchend),Z.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){Z.enableDrag(),Z.removeEventListener(window,"mousemove",this.mousemove),Z.removeEventListener(window,"mouseup",this.mouseup),Z.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Z.removeEventListener(window,"touchend",this.touchend)}}let Ar;function lr(f,e,s){const l=new h.N(f.lng,f.lat);if(f=new h.N(f.lng,f.lat),e){const u=new h.N(f.lng-360,f.lat),p=new h.N(f.lng+360,f.lat),w=s.locationPoint(f).distSqr(e);s.locationPoint(u).distSqr(e)<w?f=u:s.locationPoint(p).distSqr(e)<w&&(f=p)}for(;Math.abs(f.lng-s.center.lng)>180;){const u=s.locationPoint(f);if(u.x>=0&&u.y>=0&&u.x<=s.width&&u.y<=s.height)break;f.lng>s.center.lng?f.lng-=360:f.lng+=360}return f.lng!==l.lng&&s.locationPoint(f).y>s.height/2-s.getHorizon()?f:l}const Fi={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ea(f,e,s){const l=f.classList;for(const u in Fi)l.remove(`maplibregl-${s}-anchor-${u}`);l.add(`maplibregl-${s}-anchor-${e}`)}class Cn extends h.E{constructor(e){if(super(),this._onKeyPress=s=>{const l=s.code,u=s.charCode||s.keyCode;l!=="Space"&&l!=="Enter"&&u!==32&&u!==13||this.togglePopup()},this._onMapClick=s=>{const l=s.originalEvent.target,u=this._element;this._popup&&(l===u||u.contains(l))&&this.togglePopup()},this._update=s=>{var l;if(!this._map)return;const u=this._map.loaded()&&!this._map.isMoving();((s==null?void 0:s.type)==="terrain"||(s==null?void 0:s.type)==="render"&&!u)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?lr(this._lngLat,this._flatPos,this._map.transform):(l=this._lngLat)===null||l===void 0?void 0:l.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let p="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?p=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(p=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let w="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?w="rotateX(0deg)":this._pitchAlignment==="map"&&(w=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||s&&s.type!=="moveend"||(this._pos=this._pos.round()),Z.setTransform(this._element,`${Fi[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${w} ${p}`),Y.frameAsync(new AbortController).then((()=>{this._updateOpacity(s&&s.type==="moveend")})).catch((()=>{}))},this._onMove=s=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new h.k("dragstart"))),this.fire(new h.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new h.k("dragend")),this._state="inactive"},this._addDragHandler=s=>{this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=h.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=Z.create("div");const s=Z.createNS("http://www.w3.org/2000/svg","svg"),l=41,u=27;s.setAttributeNS(null,"display","block"),s.setAttributeNS(null,"height",`${l}px`),s.setAttributeNS(null,"width",`${u}px`),s.setAttributeNS(null,"viewBox",`0 0 ${u} ${l}`);const p=Z.createNS("http://www.w3.org/2000/svg","g");p.setAttributeNS(null,"stroke","none"),p.setAttributeNS(null,"stroke-width","1"),p.setAttributeNS(null,"fill","none"),p.setAttributeNS(null,"fill-rule","evenodd");const w=Z.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"fill-rule","nonzero");const k=Z.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"transform","translate(3.0, 29.0)"),k.setAttributeNS(null,"fill","#000000");const E=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const se of E){const ce=Z.createNS("http://www.w3.org/2000/svg","ellipse");ce.setAttributeNS(null,"opacity","0.04"),ce.setAttributeNS(null,"cx","10.5"),ce.setAttributeNS(null,"cy","5.80029008"),ce.setAttributeNS(null,"rx",se.rx),ce.setAttributeNS(null,"ry",se.ry),k.appendChild(ce)}const A=Z.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill",this._color);const R=Z.createNS("http://www.w3.org/2000/svg","path");R.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),A.appendChild(R);const B=Z.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"opacity","0.25"),B.setAttributeNS(null,"fill","#000000");const U=Z.createNS("http://www.w3.org/2000/svg","path");U.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),B.appendChild(U);const G=Z.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"transform","translate(6.0, 7.0)"),G.setAttributeNS(null,"fill","#FFFFFF");const X=Z.createNS("http://www.w3.org/2000/svg","g");X.setAttributeNS(null,"transform","translate(8.0, 8.0)");const J=Z.createNS("http://www.w3.org/2000/svg","circle");J.setAttributeNS(null,"fill","#000000"),J.setAttributeNS(null,"opacity","0.25"),J.setAttributeNS(null,"cx","5.5"),J.setAttributeNS(null,"cy","5.5"),J.setAttributeNS(null,"r","5.4999962");const te=Z.createNS("http://www.w3.org/2000/svg","circle");te.setAttributeNS(null,"fill","#FFFFFF"),te.setAttributeNS(null,"cx","5.5"),te.setAttributeNS(null,"cy","5.5"),te.setAttributeNS(null,"r","5.4999962"),X.appendChild(J),X.appendChild(te),w.appendChild(k),w.appendChild(A),w.appendChild(B),w.appendChild(G),w.appendChild(X),s.appendChild(w),s.setAttributeNS(null,"height",l*this._scale+"px"),s.setAttributeNS(null,"width",u*this._scale+"px"),this._element.appendChild(s),this._offset=h.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(s=>{s.preventDefault()})),this._element.addEventListener("mousedown",(s=>{s.preventDefault()})),ea(this._element,this._anchor,"marker"),e&&e.className)for(const s of e.className.split(" "))this._element.classList.add(s);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Z.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=h.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const u=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[u,-1*(38.1-13.5+u)],"bottom-right":[-u,-1*(38.1-13.5+u)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var s,l;if(!(!((s=this._map)===null||s===void 0)&&s.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const u=this._map,p=u.terrain.depthAtPoint(this._pos),w=u.terrain.getElevationForLngLatZoom(this._lngLat,u.transform.tileZoom);if(u.transform.lngLatToCameraDepth(this._lngLat,w)-p<.006)return void(this._element.style.opacity=this._opacity);const k=-this._offset.y/u.transform._pixelPerMeter,E=Math.sin(u.getPitch()*Math.PI/180)*k,A=u.terrain.depthAtPoint(new h.P(this._pos.x,this._pos.y-this._offset.y)),R=u.transform.lngLatToCameraDepth(this._lngLat,w+E)-A>.006;!((l=this._popup)===null||l===void 0)&&l.isOpen()&&R&&this._popup.remove(),this._element.style.opacity=R?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=h.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,s){return e===void 0&&s===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),s!==void 0&&(this._opacityWhenCovered=s),this._map&&this._updateOpacity(!0),this}}const bl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ao=0,zo=!1;const wi={maxWidth:100,unit:"metric"};function Do(f,e,s){const l=s&&s.maxWidth||100,u=f._container.clientHeight/2,p=f.unproject([0,u]),w=f.unproject([l,u]),k=p.distanceTo(w);if(s&&s.unit==="imperial"){const E=3.2808*k;E>5280?gt(e,l,E/5280,f._getUIString("ScaleControl.Miles")):gt(e,l,E,f._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?gt(e,l,k/1852,f._getUIString("ScaleControl.NauticalMiles")):k>=1e3?gt(e,l,k/1e3,f._getUIString("ScaleControl.Kilometers")):gt(e,l,k,f._getUIString("ScaleControl.Meters"))}function gt(f,e,s,l){const u=(function(p){const w=Math.pow(10,`${Math.floor(p)}`.length-1);let k=p/w;return k=k>=10?10:k>=5?5:k>=3?3:k>=2?2:k>=1?1:(function(E){const A=Math.pow(10,Math.ceil(-Math.log(E)/Math.LN10));return Math.round(E*A)/A})(k),w*k})(s);f.style.width=e*(u/s)+"px",f.innerHTML=`${u}&nbsp;${l}`}const At={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Lo=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Sl(f){if(f){if(typeof f=="number"){const e=Math.round(Math.abs(f)/Math.SQRT2);return{center:new h.P(0,0),top:new h.P(0,f),"top-left":new h.P(e,e),"top-right":new h.P(-e,e),bottom:new h.P(0,-f),"bottom-left":new h.P(e,-e),"bottom-right":new h.P(-e,-e),left:new h.P(f,0),right:new h.P(-f,0)}}if(f instanceof h.P||Array.isArray(f)){const e=h.P.convert(f);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:h.P.convert(f.center||[0,0]),top:h.P.convert(f.top||[0,0]),"top-left":h.P.convert(f["top-left"]||[0,0]),"top-right":h.P.convert(f["top-right"]||[0,0]),bottom:h.P.convert(f.bottom||[0,0]),"bottom-left":h.P.convert(f["bottom-left"]||[0,0]),"bottom-right":h.P.convert(f["bottom-right"]||[0,0]),left:h.P.convert(f.left||[0,0]),right:h.P.convert(f.right||[0,0])}}return Sl(new h.P(0,0))}const tc=W;T.AJAXError=h.bh,T.Evented=h.E,T.LngLat=h.N,T.MercatorCoordinate=h.Z,T.Point=h.P,T.addProtocol=h.bi,T.config=h.a,T.removeProtocol=h.bj,T.AttributionControl=As,T.BoxZoomHandler=ii,T.CanvasSource=mi,T.CooperativeGesturesHandler=Mo,T.DoubleClickZoomHandler=Js,T.DragPanHandler=uu,T.DragRotateHandler=sh,T.EdgeInsets=Xa,T.FullscreenControl=class extends h.E{constructor(f={}){super(),this._onFullscreenChange=()=>{var e;let s=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=s==null?void 0:s.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)s=s.shadowRoot.fullscreenElement;s===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:h.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=Z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){Z.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const f=this._fullscreenButton=Z.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);Z.create("span","maplibregl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.title=f}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new h.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new h.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},T.GeoJSONSource=Ss,T.GeolocateControl=class extends h.E{constructor(f){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new h.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new h.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const s=new h.N(e.coords.longitude,e.coords.latitude),l=e.coords.accuracy,u=this._map.getBearing(),p=h.e({bearing:u},this.options.fitBoundsOptions),w=Ee.fromLngLat(s,l);this._map.fitBounds(w,p,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const s=new h.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&zo)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new h.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=Z.create("button","maplibregl-ctrl-geolocate",this._container),Z.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){h.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Z.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Cn({element:this._dotElement}),this._circleElement=Z.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Cn({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new h.k("trackuserlocationend")),this.fire(new h.k("userlocationlostfocus")))}))}},this.options=h.e({},bl,f)}onAdd(f){return this._map=f,this._container=Z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return h._(this,arguments,void 0,(function*(e=!1){if(Ar!==void 0&&!e)return Ar;if(window.navigator.permissions===void 0)return Ar=!!window.navigator.geolocation,Ar;try{Ar=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Ar=!!window.navigator.geolocation}return Ar}))})().then((e=>this._finishSetupUI(e))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Z.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ao=0,zo=!1}_isOutOfMapMaxBounds(f){const e=this._map.getMaxBounds(),s=f.coords;return e&&(s.longitude<e.getWest()||s.longitude>e.getEast()||s.latitude<e.getSouth()||s.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const f=this._map.getBounds(),e=f.getSouthEast(),s=f.getNorthEast(),l=e.distanceTo(s),u=Math.ceil(this._accuracy/(l/this._map._container.clientHeight)*2);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}trigger(){if(!this._setup)return h.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new h.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ao--,zo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new h.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new h.k("trackuserlocationstart")),this.fire(new h.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ao++,Ao>1?(f={maximumAge:6e5,timeout:0},zo=!0):(f=this.options.positionOptions,zo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},T.Hash=su,T.ImageSource=Ts,T.KeyboardHandler=Ri,T.LngLatBounds=Ee,T.LogoControl=as,T.Map=class extends eo{constructor(f){h.bf.mark(h.bg.create);const e=Object.assign(Object.assign({},Ia),f);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Sa(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new sr,this._controls=[],this._mapId=h.a4(),this._contextLost=s=>{s.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new h.k("webglcontextlost",{originalEvent:s}))},this._contextRestored=s=>{this._setupPainter(),this.resize(),this._update(),this.fire(new h.k("webglcontextrestored",{originalEvent:s}))},this._onMapScroll=s=>{if(s.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer===!0,this._antialias=e.antialias===!0,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles===!0,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions===!0,this._collectResourceTiming=e.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},wl),e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Ue.addThrottleControl((()=>this.isMoving())),this._requestManager=new et(e.transformRequest),typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))).on("moveend",(()=>this._update(!1))).on("zoom",(()=>this._update(!0))).on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})).once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let s=!1;const l=pl((u=>{this._trackResize&&!this._removed&&(this.resize(u),this.redraw())}),50);this._resizeObserver=new ResizeObserver((u=>{s?l(u):s=!0})),this._resizeObserver.observe(this._container)}this.handlers=new hu(this,e),this._hash=e.hash&&new su(typeof e.hash=="string"&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,h.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new As(typeof e.attributionControl=="boolean"?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new as,e.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(s=>{this._update(s.dataType==="style"),this.fire(new h.k(`${s.dataType}data`,s))})),this.on("dataloading",(s=>{this.fire(new h.k(`${s.dataType}dataloading`,s))})),this.on("dataabort",(s=>{this.fire(new h.k("sourcedataabort",s))}))}_getMapId(){return this._mapId}addControl(f,e){if(e===void 0&&(e=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new h.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=f.onAdd(this);this._controls.push(f);const l=this._controlPositions[e];return e.indexOf("bottom")!==-1?l.insertBefore(s,l.firstChild):l.appendChild(s),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new h.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(f);return e>-1&&this._controls.splice(e,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}calculateCameraOptionsFromTo(f,e,s,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(f,e,s,l)}resize(f){var e;const s=this._containerDimensions(),l=s[0],u=s[1],p=this._getClampedPixelRatio(l,u);if(this._resizeCanvas(l,u,p),this.painter.resize(l,u,p),this.painter.overLimit()){const k=this.painter.context.gl;this._maxCanvasSize=[k.drawingBufferWidth,k.drawingBufferHeight];const E=this._getClampedPixelRatio(l,u);this._resizeCanvas(l,u,E),this.painter.resize(l,u,E)}this.transform.resize(l,u),(e=this._requestedCameraState)===null||e===void 0||e.resize(l,u);const w=!this._moving;return w&&(this.stop(),this.fire(new h.k("movestart",f)).fire(new h.k("move",f))),this.fire(new h.k("resize",f)),w&&this.fire(new h.k("moveend",f)),this}_getClampedPixelRatio(f,e){const{0:s,1:l}=this._maxCanvasSize,u=this.getPixelRatio(),p=f*u,w=e*u;return Math.min(p>s?s/p:1,w>l?l/w:1)*u}getPixelRatio(){var f;return(f=this._overridePixelRatio)!==null&&f!==void 0?f:devicePixelRatio}setPixelRatio(f){this._overridePixelRatio=f,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(f){return this.transform.setMaxBounds(Ee.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f&&this.setZoom(f),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f&&this.setZoom(f),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f&&this.setPitch(f),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f&&this.setPitch(f),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this._update()}project(f){return this.transform.locationPoint(h.N.convert(f),this.style&&this.terrain)}unproject(f){return this.transform.pointLocation(h.P.convert(f),this.terrain)}isMoving(){var f;return this._moving||((f=this.handlers)===null||f===void 0?void 0:f.isMoving())}isZooming(){var f;return this._zooming||((f=this.handlers)===null||f===void 0?void 0:f.isZooming())}isRotating(){var f;return this._rotating||((f=this.handlers)===null||f===void 0?void 0:f.isRotating())}_createDelegatedListener(f,e,s){if(f==="mouseenter"||f==="mouseover"){let l=!1;return{layers:e,listener:s,delegates:{mousemove:p=>{const w=e.filter((E=>this.getLayer(E))),k=w.length!==0?this.queryRenderedFeatures(p.point,{layers:w}):[];k.length?l||(l=!0,s.call(this,new Pn(f,this,p.originalEvent,{features:k}))):l=!1},mouseout:()=>{l=!1}}}}if(f==="mouseleave"||f==="mouseout"){let l=!1;return{layers:e,listener:s,delegates:{mousemove:w=>{const k=e.filter((E=>this.getLayer(E)));(k.length!==0?this.queryRenderedFeatures(w.point,{layers:k}):[]).length?l=!0:l&&(l=!1,s.call(this,new Pn(f,this,w.originalEvent)))},mouseout:w=>{l&&(l=!1,s.call(this,new Pn(f,this,w.originalEvent)))}}}}{const l=u=>{const p=e.filter((k=>this.getLayer(k))),w=p.length!==0?this.queryRenderedFeatures(u.point,{layers:p}):[];w.length&&(u.features=w,s.call(this,u),delete u.features)};return{layers:e,listener:s,delegates:{[f]:l}}}}_saveDelegatedListener(f,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(e)}_removeDelegatedListener(f,e,s){if(!this._delegatedListeners||!this._delegatedListeners[f])return;const l=this._delegatedListeners[f];for(let u=0;u<l.length;u++){const p=l[u];if(p.listener===s&&p.layers.length===e.length&&p.layers.every((w=>e.includes(w)))){for(const w in p.delegates)this.off(w,p.delegates[w]);return void l.splice(u,1)}}}on(f,e,s){if(s===void 0)return super.on(f,e);const l=this._createDelegatedListener(f,typeof e=="string"?[e]:e,s);this._saveDelegatedListener(f,l);for(const u in l.delegates)this.on(u,l.delegates[u]);return this}once(f,e,s){if(s===void 0)return super.once(f,e);const l=typeof e=="string"?[e]:e,u=this._createDelegatedListener(f,l,s);for(const p in u.delegates){const w=u.delegates[p];u.delegates[p]=(...k)=>{this._removeDelegatedListener(f,l,s),w(...k)}}this._saveDelegatedListener(f,u);for(const p in u.delegates)this.once(p,u.delegates[p]);return this}off(f,e,s){return s===void 0?super.off(f,e):(this._removeDelegatedListener(f,typeof e=="string"?[e]:e,s),this)}queryRenderedFeatures(f,e){if(!this.style)return[];let s;const l=f instanceof h.P||Array.isArray(f),u=l?f:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(l?{}:f)||{},u instanceof h.P||typeof u[0]=="number")s=[h.P.convert(u)];else{const p=h.P.convert(u[0]),w=h.P.convert(u[1]);s=[p,new h.P(w.x,p.y),w,new h.P(p.x,w.y),p]}return this.style.queryRenderedFeatures(s,e,this.transform)}querySourceFeatures(f,e){return this.style.querySourceFeatures(f,e)}setStyle(f,e){return(e=h.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&f?(this._diffStyle(f,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(f,e))}setTransformRequest(f){return this._requestManager.setTransformRequest(f),this}_getUIString(f){const e=this._locale[f];if(e==null)throw new Error(`Missing UI string '${f}'`);return e}_updateStyle(f,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(f,e)));const s=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!f)),f?(this.style=new $l(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof f=="string"?this.style.loadURL(f,e,s):this.style.loadJSON(f,e,s),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new $l(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,e){if(typeof f=="string"){const s=this._requestManager.transformRequest(f,"Style");h.h(s,new AbortController).then((l=>{this._updateDiff(l.data,e)})).catch((l=>{l&&this.fire(new h.j(l))}))}else typeof f=="object"&&this._updateDiff(f,e)}_updateDiff(f,e){try{this.style.setState(f,e)&&this._update(!0)}catch(s){h.w(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(f,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():h.w("There is no style added to the map.")}addSource(f,e){return this._lazyInitEmptyStyle(),this.style.addSource(f,e),this._update(!0)}isSourceLoaded(f){const e=this.style&&this.style.sourceCaches[f];if(e!==void 0)return e.loaded();this.fire(new h.j(new Error(`There is no source with ID '${f}'`)))}setTerrain(f){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),f){const e=this.style.sourceCaches[f.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${f.source}`);this.terrain===null&&e.reload();for(const s in this.style._layers){const l=this.style._layers[s];l.type==="hillshade"&&l.source===f.source&&h.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Qs(this.painter,e,f),this.painter.renderToTexture=new xl(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=s=>{s.dataType==="style"?this.terrain.sourceCache.freeRtt():s.dataType==="source"&&s.tile&&(s.sourceId!==f.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(s.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new h.k("terrain",{terrain:f})),this}getTerrain(){var f,e;return(e=(f=this.terrain)===null||f===void 0?void 0:f.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const f=this.style&&this.style.sourceCaches;for(const e in f){const s=f[e]._tiles;for(const l in s){const u=s[l];if(u.state!=="loaded"&&u.state!=="errored")return!1}}return!0}removeSource(f){return this.style.removeSource(f),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,e,s={}){const{pixelRatio:l=1,sdf:u=!1,stretchX:p,stretchY:w,content:k,textFitWidth:E,textFitHeight:A}=s;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||h.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new h.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:R,height:B,data:U}=e,G=e;return this.style.addImage(f,{data:new h.R({width:R,height:B},new Uint8Array(U)),pixelRatio:l,stretchX:p,stretchY:w,content:k,textFitWidth:E,textFitHeight:A,sdf:u,version:0,userImage:G}),G.onAdd&&G.onAdd(this,f),this}}{const{width:R,height:B,data:U}=Y.getImageData(e);this.style.addImage(f,{data:new h.R({width:R,height:B},U),pixelRatio:l,stretchX:p,stretchY:w,content:k,textFitWidth:E,textFitHeight:A,sdf:u,version:0})}}updateImage(f,e){const s=this.style.getImage(f);if(!s)return this.fire(new h.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=e instanceof HTMLImageElement||h.b(e)?Y.getImageData(e):e,{width:u,height:p,data:w}=l;if(u===void 0||p===void 0)return this.fire(new h.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(u!==s.data.width||p!==s.data.height)return this.fire(new h.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const k=!(e instanceof HTMLImageElement||h.b(e));return s.data.replace(w,k),this.style.updateImage(f,s),this}getImage(f){return this.style.getImage(f)}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new h.j(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f){return Ue.getImage(this._requestManager.transformRequest(f,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(f,e){return this._lazyInitEmptyStyle(),this.style.addLayer(f,e),this._update(!0)}moveLayer(f,e){return this.style.moveLayer(f,e),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(f,e,s){return this.style.setLayerZoomRange(f,e,s),this._update(!0)}setFilter(f,e,s={}){return this.style.setFilter(f,e,s),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,e,s,l={}){return this.style.setPaintProperty(f,e,s,l),this._update(!0)}getPaintProperty(f,e){return this.style.getPaintProperty(f,e)}setLayoutProperty(f,e,s,l={}){return this.style.setLayoutProperty(f,e,s,l),this._update(!0)}getLayoutProperty(f,e){return this.style.getLayoutProperty(f,e)}setGlyphs(f,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(f,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(f,e,s={}){return this._lazyInitEmptyStyle(),this.style.addSprite(f,e,s,(l=>{l||this._update(!0)})),this}removeSprite(f){return this._lazyInitEmptyStyle(),this.style.removeSprite(f),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(f,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(f,e,(s=>{s||this._update(!0)})),this}setLight(f,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(f){return this._lazyInitEmptyStyle(),this.style.setSky(f),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(f,e){return this.style.setFeatureState(f,e),this._update()}removeFeatureState(f,e){return this.style.removeFeatureState(f,e),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let f=0,e=0;return this._container&&(f=this._container.clientWidth||400,e=this._container.clientHeight||300),[f,e]}_setupContainer(){const f=this._container;f.classList.add("maplibregl-map");const e=this._canvasContainer=Z.create("div","maplibregl-canvas-container",f);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=Z.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const s=this._containerDimensions(),l=this._getClampedPixelRatio(s[0],s[1]);this._resizeCanvas(s[0],s[1],l);const u=this._controlContainer=Z.create("div","maplibregl-control-container",f),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((w=>{p[w]=Z.create("div",`maplibregl-ctrl-${w} `,u)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,e,s){this._canvas.width=Math.floor(s*f),this._canvas.height=Math.floor(s*e),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const f={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",(l=>{e={requestedAttributes:f},l&&(e.statusMessage=l.statusMessage,e.type=l.type)}),{once:!0});const s=this._canvas.getContext("webgl2",f)||this._canvas.getContext("webgl",f);if(!s){const l="Failed to initialize WebGL";throw e?(e.message=l,new Error(JSON.stringify(e))):new Error(l)}this.painter=new ba(s,this.transform),Ie.testSupport(s)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_render(f){const e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),this._removed)return;let s=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const u=this.transform.zoom,p=Y.now();this.style.zoomHistory.update(u,p);const w=new h.z(u,{now:p,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),k=w.crossFadingFactor();k===1&&k===this._crossFadingFactor||(s=!0,this._crossFadingFactor=k),this.style.update(w)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new h.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,h.bf.mark(h.bg.load),this.fire(new h.k("load"))),this.style&&(this.style.hasTransitions()||s)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const l=this._sourcesDirty||this._styleDirty||this._placementDirty;return l||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new h.k("idle")),!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,h.bf.mark(h.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var f;this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Ue.removeThrottleControl(this._imageQueueHandle),(f=this._resizeObserver)===null||f===void 0||f.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),Z.remove(this._canvasContainer),Z.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),h.bf.clearMetrics(),this._removed=!0,this.fire(new h.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,Y.frameAsync(this._frameRequest).then((f=>{h.bf.frame(f),this._frameRequest=null,this._render(f)})).catch((()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get version(){return to}getCameraTargetElevation(){return this.transform.elevation}},T.MapMouseEvent=Pn,T.MapTouchEvent=Cs,T.MapWheelEvent=Ku,T.Marker=Cn,T.NavigationControl=class{constructor(f){this._updateZoomButtons=()=>{const e=this._map.getZoom(),s=e===this._map.getMaxZoom(),l=e===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,s)=>{const l=this._map._getUIString(`NavigationControl.${s}`);e.title=l,e.setAttribute("aria-label",l)},this.options=h.e({},Vr,f),this._container=Z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(e=>this._map.zoomIn({},{originalEvent:e}))),Z.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(e=>this._map.zoomOut({},{originalEvent:e}))),Z.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})})),this._compassIcon=Z.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ea(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){Z.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(f,e){const s=Z.create("button",f,this._container);return s.type="button",s.addEventListener("click",e),s}},T.Popup=class extends h.E{constructor(f){super(),this.remove=()=>(this._content&&Z.remove(this._content),this._container&&(Z.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new h.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var s;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=Z.create("div","maplibregl-popup",this._map.getContainer()),this._tip=Z.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const k of this.options.className.split(" "))this._container.classList.add(k);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?lr(this._lngLat,this._flatPos,this._map.transform):(s=this._lngLat)===null||s===void 0?void 0:s.wrap(),this._trackPointer&&!e)return;const l=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let u=this.options.anchor;const p=Sl(this.options.offset);if(!u){const k=this._container.offsetWidth,E=this._container.offsetHeight;let A;A=l.y+p.bottom.y<E?["top"]:l.y>this._map.transform.height-E?["bottom"]:[],l.x<k/2?A.push("left"):l.x>this._map.transform.width-k/2&&A.push("right"),u=A.length===0?"bottom":A.join("-")}let w=l.add(p[u]);this.options.subpixelPositioning||(w=w.round()),Z.setTransform(this._container,`${Fi[u]} translate(${w.x}px,${w.y}px)`),ea(this._container,u,"popup")},this._onClose=()=>{this.remove()},this.options=h.e(Object.create(At),f)}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new h.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(f){return this._lngLat=h.N.convert(f),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const e=document.createDocumentFragment(),s=document.createElement("body");let l;for(s.innerHTML=f;l=s.firstChild,l;)e.appendChild(l);return this.setDOMContent(e)}getMaxWidth(){var f;return(f=this._container)===null||f===void 0?void 0:f.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Z.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(f){return this._container&&this._container.classList.add(f),this}removeClassName(f){return this._container&&this._container.classList.remove(f),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){if(this._container)return this._container.classList.toggle(f)}setSubpixelPositioning(f){this.options.subpixelPositioning=f}_createCloseButton(){this.options.closeButton&&(this._closeButton=Z.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(Lo);f&&f.focus()}},T.RasterDEMTileSource=Rr,T.RasterTileSource=pr,T.ScaleControl=class{constructor(f){this._onMove=()=>{Do(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Do(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},wi),f)}getDefaultPosition(){return"bottom-left"}onAdd(f){return this._map=f,this._container=Z.create("div","maplibregl-ctrl maplibregl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){Z.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},T.ScrollZoomHandler=si,T.Style=$l,T.TerrainControl=class{constructor(f){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=f}onAdd(f){return this._map=f,this._container=Z.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Z.create("button","maplibregl-ctrl-terrain",this._container),Z.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){Z.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},T.TwoFingersTouchPitchHandler=Po,T.TwoFingersTouchRotateHandler=Eo,T.TwoFingersTouchZoomHandler=_l,T.TwoFingersTouchZoomRotateHandler=cu,T.VectorTileSource=co,T.VideoSource=Ba,T.addSourceType=(f,e)=>h._(void 0,void 0,void 0,(function*(){if(Fa(f))throw new Error(`A source type called "${f}" already exists.`);((s,l)=>{ho[s]=l})(f,e)})),T.clearPrewarmedResources=function(){const f=ur;f&&(f.isPreloaded()&&f.numActive()===1?(f.release(Yt),ur=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},T.getMaxParallelImageRequests=function(){return h.a.MAX_PARALLEL_IMAGE_REQUESTS},T.getRTLTextPluginStatus=function(){return Jn().getRTLTextPluginStatus()},T.getVersion=function(){return tc},T.getWorkerCount=function(){return nr.workerCount},T.getWorkerUrl=function(){return h.a.WORKER_URL},T.importScriptInWorkers=function(f){return pa().broadcast("IS",f)},T.prewarm=function(){Ir().acquire(Yt)},T.setMaxParallelImageRequests=function(f){h.a.MAX_PARALLEL_IMAGE_REQUESTS=f},T.setRTLTextPlugin=function(f,e){return Jn().setRTLTextPlugin(f,e)},T.setWorkerCount=function(f){nr.workerCount=f},T.setWorkerUrl=function(f){h.a.WORKER_URL=f}}));var F=b;return F}))})(gf)),gf.exports}var vv=_v();const jd=Om(vv);function xv({boatPosition:_,restrictions:y,signs:b}){const C=Xr.useRef(null),D=Xr.useRef(null),F=Xr.useRef(null),T=Xr.useRef([]);return Xr.useEffect(()=>{if(!C.current)return;const h=new jd.Map({container:C.current,style:{version:8,sources:{osm:{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:" OpenStreetMap contributors"}},layers:[{id:"osm",type:"raster",source:"osm",minzoom:0,maxzoom:19}]},center:[25,60.5],zoom:8,attributionControl:!0});return h.addControl(new jd.NavigationControl,"top-right"),D.current=h,()=>{h.remove()}},[]),Xr.useEffect(()=>{if(!D.current||!_)return;const h=D.current;if(F.current)F.current.setLngLat([_.lng,_.lat]);else{const W=document.createElement("div");W.className="boat-marker",W.innerHTML="",F.current=new jd.Marker({element:W}).setLngLat([_.lng,_.lat]).addTo(h),h.flyTo({center:[_.lng,_.lat],zoom:13,duration:1e3})}if(_.heading!=null&&F.current){const W=F.current.getElement();W.style.transform=`rotate(${_.heading}deg)`}},[_]),Xr.useEffect(()=>{if(!D.current)return;const h=D.current;T.current.forEach(W=>W.remove()),T.current=[],b.forEach(W=>{const ue=document.createElement("div");ue.className="sign-marker";const ne=document.createElement("img");ne.src=W.iconUrl,ne.alt=W.nimiFi||"Merkki",ne.onerror=()=>{const Z=W.iconKey.split("_")[0];ne.src=`/icons/${Z}.png`,ne.onerror=()=>{ne.src="/icons/merkki_default.png"}},ue.appendChild(ne);const Y=new jd.Marker({element:ue}).setLngLat(W.geometry.coordinates).setPopup(new jd.Popup({offset:25}).setHTML(`
              <div class="sign-popup">
                <strong>${W.nimiFi||W.nimiSv||"Merkki"}</strong>
                ${W.lisakilmentekstiFi?`<p>${W.lisakilmentekstiFi}</p>`:""}
                <p class="distance">${W.distance} m</p>
              </div>
            `)).addTo(h);T.current.push(Y)})},[b]),Xr.useEffect(()=>{if(!D.current)return;const h=D.current;if(h.getLayer("restrictions-fill")&&h.removeLayer("restrictions-fill"),h.getLayer("restrictions-line")&&h.removeLayer("restrictions-line"),h.getSource("restrictions")&&h.removeSource("restrictions"),y.length===0)return;const W={type:"FeatureCollection",features:y.map(ue=>({type:"Feature",properties:{id:ue.id,isPrimary:ue.isPrimary||!1,suuruusKmh:ue.suuruusKmh},geometry:ue.geometry}))};h.addSource("restrictions",{type:"geojson",data:W}),h.addLayer({id:"restrictions-fill",type:"fill",source:"restrictions",paint:{"fill-color":["case",["get","isPrimary"],"#ef4444","#f97316"],"fill-opacity":.3}}),h.addLayer({id:"restrictions-line",type:"line",source:"restrictions",paint:{"line-color":["case",["get","isPrimary"],"#dc2626","#ea580c"],"line-width":2}})},[y]),at.jsx("div",{ref:C,className:"map-container"})}function wv({restrictions:_,signs:y}){const[b,C]=Xr.useState(!1),D=_.length>0||y.length>0;return at.jsxs("div",{className:`bottom-sheet ${b?"expanded":""} ${D?"":"empty"}`,children:[at.jsxs("div",{className:"bottom-sheet-header",onClick:()=>C(!b),children:[at.jsx("div",{className:"drag-handle"}),at.jsxs("div",{className:"header-content",children:[_.length>0&&at.jsx("div",{className:"primary-info",children:jg(_[0])}),_.length===0&&y.length===0&&at.jsx("div",{className:"no-data",children:"Ei rajoituksia tai merkkej lhistll"})]})]}),at.jsxs("div",{className:"bottom-sheet-content",children:[_.length>0&&at.jsxs("section",{className:"restrictions-section",children:[at.jsx("h3",{children:"Voimassa olevat rajoitukset"}),at.jsx("div",{className:"restrictions-list",children:_.map((F,T)=>at.jsxs("div",{className:`restriction-item ${F.isPrimary?"primary":""}`,children:[at.jsxs("div",{className:"restriction-title",children:[jg(F),F.isPrimary&&at.jsx("span",{className:"badge",children:"Trkein"})]}),F.poikkeus&&at.jsxs("div",{className:"restriction-detail",children:[at.jsx("strong",{children:"Poikkeus:"})," ",F.poikkeus]}),F.lisatieto&&at.jsxs("div",{className:"restriction-detail",children:[at.jsx("strong",{children:"Listieto:"})," ",F.lisatieto]}),F.alkuPvm&&at.jsxs("div",{className:"restriction-meta",children:["Voimassa: ",new Date(F.alkuPvm).toLocaleDateString("fi-FI"),F.loppuPvm&&` - ${new Date(F.loppuPvm).toLocaleDateString("fi-FI")}`]})]},F.id))})]}),y.length>0&&at.jsxs("section",{className:"signs-section",children:[at.jsx("h3",{children:"Lhell olevat merkit"}),at.jsx("div",{className:"signs-list",children:y.map(F=>at.jsxs("div",{className:"sign-item",children:[at.jsx("div",{className:"sign-icon",children:at.jsx("img",{src:F.iconUrl,alt:Vg(F),onError:T=>{const h=T.target,W=F.iconKey.split("_")[0];h.src.includes("_")?h.src=`/icons/${W}.png`:h.src.includes("default")||(h.src="/icons/merkki_default.png")}})}),at.jsxs("div",{className:"sign-info",children:[at.jsx("div",{className:"sign-name",children:Vg(F)}),F.lisakilmentekstiFi&&at.jsx("div",{className:"sign-detail",children:F.lisakilmentekstiFi}),at.jsx("div",{className:"sign-distance",children:mv(F.distance)})]})]},F.id))})]})]})]})}function bv({filters:_,availableVlmtyyppi:y,onFilterChange:b,onClose:C}){const D=h=>{const W=new Set(_.selectedVlmtyyppi);W.has(h)?W.delete(h):W.add(h),b("selectedVlmtyyppi",W)},F=()=>{b("selectedVlmtyyppi",new Set(y))},T=()=>{b("selectedVlmtyyppi",new Set)};return at.jsx("div",{className:"settings-overlay",onClick:C,children:at.jsxs("div",{className:"settings-panel",onClick:h=>h.stopPropagation(),children:[at.jsxs("div",{className:"settings-header",children:[at.jsx("h2",{children:"Asetukset"}),at.jsx("button",{className:"close-btn",onClick:C,children:""})]}),at.jsxs("div",{className:"settings-content",children:[at.jsxs("section",{className:"settings-section",children:[at.jsx("h3",{children:"Rajoitussuodattimet"}),at.jsxs("div",{className:"setting-item",children:[at.jsxs("label",{className:"switch-label",children:[at.jsx("input",{type:"checkbox",checked:_.ammattiliikenne,onChange:h=>b("ammattiliikenne",h.target.checked)}),at.jsx("span",{className:"switch"}),at.jsx("span",{className:"label-text",children:"Ammattiliikenne"})]}),at.jsx("p",{className:"setting-description",children:'Kun pois plt, piilotetaan rajoitukset joissa poikkeus sislt "huvi"'})]}),at.jsxs("div",{className:"setting-item",children:[at.jsxs("label",{className:"switch-label",children:[at.jsx("input",{type:"checkbox",checked:_.vesiskootteri,onChange:h=>b("vesiskootteri",h.target.checked)}),at.jsx("span",{className:"switch"}),at.jsx("span",{className:"label-text",children:"Vesiskootteri"})]}),at.jsx("p",{className:"setting-description",children:"Kun pois plt, piilotetaan vesiskootteri-rajoitukset"})]})]}),at.jsxs("section",{className:"settings-section",children:[at.jsx("h3",{children:"Lheisten merkkien sde"}),at.jsx("div",{className:"setting-item",children:at.jsxs("label",{children:[at.jsxs("span",{className:"label-text",children:["Sde: ",_.nearbyRadius," m"]}),at.jsx("input",{type:"range",min:"50",max:"1000",step:"50",value:_.nearbyRadius,onChange:h=>b("nearbyRadius",parseInt(h.target.value)),className:"radius-slider"})]})})]}),at.jsxs("section",{className:"settings-section",children:[at.jsxs("div",{className:"section-header",children:[at.jsx("h3",{children:"Merkkityypit"}),at.jsxs("div",{className:"bulk-actions",children:[at.jsx("button",{onClick:F,className:"text-btn",children:"Valitse kaikki"}),at.jsx("button",{onClick:T,className:"text-btn",children:"Tyhjenn"})]})]}),at.jsx("p",{className:"setting-description",children:_.selectedVlmtyyppi.size===0?"Nytetn kaikki merkit":`Valittu ${_.selectedVlmtyyppi.size} tyyppi`}),at.jsx("div",{className:"vlmtyyppi-grid",children:y.map(h=>at.jsxs("label",{className:"checkbox-label",children:[at.jsx("input",{type:"checkbox",checked:_.selectedVlmtyyppi.has(h),onChange:()=>D(h)}),at.jsx("span",{className:"checkbox-custom"}),at.jsxs("span",{className:"label-text",children:["Tyyppi ",h]})]},h))})]})]})]})})}function Sv({onUpdate:_,status:y}){const[b,C]=Xr.useState("");Xr.useEffect(()=>{D()},[y.isUpdating]);const D=async()=>{const F=await Lg("rajoitus"),T=await Lg("vesiliikenne");if(F||T){const h=new Date(F||T||"");C(h.toLocaleString("fi-FI"))}};return at.jsxs("div",{className:"update-button-container",children:[at.jsx("button",{className:"update-btn",onClick:_,disabled:y.isUpdating,children:y.isUpdating?at.jsxs(at.Fragment,{children:[at.jsx("span",{className:"spinner"}),"Pivitetn..."]}):at.jsxs(at.Fragment,{children:[at.jsx("span",{children:""}),"Pivit aineisto"]})}),y.message&&at.jsxs("div",{className:`update-message ${y.isUpdating?"active":""}`,children:[y.message,y.isUpdating&&y.progress>0&&at.jsx("div",{className:"progress-bar",children:at.jsx("div",{className:"progress-fill",style:{width:`${y.progress}%`}})})]}),b&&!y.isUpdating&&at.jsxs("div",{className:"last-update",children:["Viimeksi pivitetty: ",b]})]})}function kv(){const[_,y]=Xr.useState({isUpdating:!1,progress:0,message:""}),[b,C]=Xr.useState({ammattiliikenne:!0,vesiskootteri:!0,selectedVlmtyyppi:new Set,nearbyRadius:250}),[D,F]=Xr.useState(null),[T,h]=Xr.useState([]),[W,ue]=Xr.useState([]),[ne,Y]=Xr.useState(!1),[Z,Ie]=Xr.useState(!1),[Re,Pe]=Xr.useState([]),Le=Xr.useRef(null),De=Xr.useRef(null),ze=Xr.useRef(0),Ue=Xr.useRef(null);Xr.useEffect(()=>(Le.current=new W_(y),()=>{Le.current&&Le.current.cleanup()}),[]),Xr.useEffect(()=>{et()},[]);const et=async()=>{try{const pt=await lo.restriction_areas.toArray(),$e=await lo.traffic_signs.toArray();pt.length>0&&$e.length>0&&(of.buildAreaIndex(pt),of.buildSignIndex($e),Pe(gv($e)),Ie(!0))}catch(pt){console.error("Failed to load data from IndexedDB:",pt)}},Je=async()=>{Le.current&&(await Le.current.updateData(),await et())};Xr.useEffect(()=>{if(!navigator.geolocation){console.error("Geolocation not supported");return}return De.current=navigator.geolocation.watchPosition(pt=>{const $e={lat:pt.coords.latitude,lng:pt.coords.longitude,accuracy:pt.coords.accuracy,heading:pt.coords.heading??void 0,speed:pt.coords.speed??void 0,timestamp:pt.timestamp};F($e),Ue.current=$e,He($e)},pt=>{console.error("Geolocation error:",pt)},{enableHighAccuracy:!0,maximumAge:1e3,timeout:1e4}),()=>{De.current!==null&&navigator.geolocation.clearWatch(De.current)}},[b,Z]);const He=Xr.useCallback(pt=>{if(!Z)return;const $e=Date.now();if($e-ze.current<1e3)return;if(Ue.current){const Mr=Ue.current,Pr=Math.abs(pt.lat-Mr.lat),$t=Math.abs(pt.lng-Mr.lng);if(Math.sqrt(Pr*Pr+$t*$t)*111e3<10)return}ze.current=$e;const xt=of.getCandidateAreas(pt.lng,pt.lat,.05),wr=hv(xt,pt,b);h(wr);const Zt=of.getNearbySignsInRadius(pt.lng,pt.lat,b.nearbyRadius),Nt=pv(Zt,pt,b);ue(Nt.slice(0,10))},[b,Z]),je=(pt,$e)=>{C(ar=>({...ar,[pt]:$e}))};return at.jsxs("div",{className:"app",children:[at.jsx(xv,{boatPosition:D,restrictions:T,signs:W}),at.jsxs("div",{className:"controls",children:[at.jsx(Sv,{onUpdate:Je,status:_}),at.jsx("button",{className:"settings-btn",onClick:()=>Y(!ne),"aria-label":"Asetukset",children:""})]}),at.jsx(wv,{restrictions:T,signs:W}),ne&&at.jsx(bv,{filters:b,availableVlmtyyppi:Re,onFilterChange:je,onClose:()=>Y(!1)}),_.error&&at.jsx("div",{className:"error-toast",children:_.error})]})}e_.createRoot(document.getElementById("root")).render(at.jsx(Hy.StrictMode,{children:at.jsx(kv,{})}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").catch(()=>{})});
