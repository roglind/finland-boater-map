var Ak=Object.defineProperty;var zk=(r,n,o)=>n in r?Ak(r,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[n]=o;var vs=(r,n,o)=>zk(r,typeof n!="symbol"?n+"":n,o);(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const g of document.querySelectorAll('link[rel="modulepreload"]'))h(g);new MutationObserver(g=>{for(const x of g)if(x.type==="childList")for(const v of x.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&h(v)}).observe(document,{childList:!0,subtree:!0});function o(g){const x={};return g.integrity&&(x.integrity=g.integrity),g.referrerPolicy&&(x.referrerPolicy=g.referrerPolicy),g.crossOrigin==="use-credentials"?x.credentials="include":g.crossOrigin==="anonymous"?x.credentials="omit":x.credentials="same-origin",x}function h(g){if(g.ep)return;g.ep=!0;const x=o(g);fetch(g.href,x)}})();var Dk=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function qw(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Zw={exports:{}},Zf={},Gw={exports:{}},Lt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ud=Symbol.for("react.element"),Lk=Symbol.for("react.portal"),Rk=Symbol.for("react.fragment"),Bk=Symbol.for("react.strict_mode"),Fk=Symbol.for("react.profiler"),Ok=Symbol.for("react.provider"),Nk=Symbol.for("react.context"),jk=Symbol.for("react.forward_ref"),Vk=Symbol.for("react.suspense"),Uk=Symbol.for("react.memo"),$k=Symbol.for("react.lazy"),f0=Symbol.iterator;function qk(r){return r===null||typeof r!="object"?null:(r=f0&&r[f0]||r["@@iterator"],typeof r=="function"?r:null)}var Hw={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Kw=Object.assign,Ww={};function Hu(r,n,o){this.props=r,this.context=n,this.refs=Ww,this.updater=o||Hw}Hu.prototype.isReactComponent={};Hu.prototype.setState=function(r,n){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,n,"setState")};Hu.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function Xw(){}Xw.prototype=Hu.prototype;function T_(r,n,o){this.props=r,this.context=n,this.refs=Ww,this.updater=o||Hw}var I_=T_.prototype=new Xw;I_.constructor=T_;Kw(I_,Hu.prototype);I_.isPureReactComponent=!0;var m0=Array.isArray,Yw=Object.prototype.hasOwnProperty,E_={current:null},Jw={key:!0,ref:!0,__self:!0,__source:!0};function Qw(r,n,o){var h,g={},x=null,v=null;if(n!=null)for(h in n.ref!==void 0&&(v=n.ref),n.key!==void 0&&(x=""+n.key),n)Yw.call(n,h)&&!Jw.hasOwnProperty(h)&&(g[h]=n[h]);var u=arguments.length-2;if(u===1)g.children=o;else if(1<u){for(var C=Array(u),O=0;O<u;O++)C[O]=arguments[O+2];g.children=C}if(r&&r.defaultProps)for(h in u=r.defaultProps,u)g[h]===void 0&&(g[h]=u[h]);return{$$typeof:ud,type:r,key:x,ref:v,props:g,_owner:E_.current}}function Zk(r,n){return{$$typeof:ud,type:r.type,key:n,ref:r.ref,props:r.props,_owner:r._owner}}function P_(r){return typeof r=="object"&&r!==null&&r.$$typeof===ud}function Gk(r){var n={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(o){return n[o]})}var g0=/\/+/g;function kg(r,n){return typeof r=="object"&&r!==null&&r.key!=null?Gk(""+r.key):n.toString(36)}function Hp(r,n,o,h,g){var x=typeof r;(x==="undefined"||x==="boolean")&&(r=null);var v=!1;if(r===null)v=!0;else switch(x){case"string":case"number":v=!0;break;case"object":switch(r.$$typeof){case ud:case Lk:v=!0}}if(v)return v=r,g=g(v),r=h===""?"."+kg(v,0):h,m0(g)?(o="",r!=null&&(o=r.replace(g0,"$&/")+"/"),Hp(g,n,o,"",function(O){return O})):g!=null&&(P_(g)&&(g=Zk(g,o+(!g.key||v&&v.key===g.key?"":(""+g.key).replace(g0,"$&/")+"/")+r)),n.push(g)),1;if(v=0,h=h===""?".":h+":",m0(r))for(var u=0;u<r.length;u++){x=r[u];var C=h+kg(x,u);v+=Hp(x,n,o,C,g)}else if(C=qk(r),typeof C=="function")for(r=C.call(r),u=0;!(x=r.next()).done;)x=x.value,C=h+kg(x,u++),v+=Hp(x,n,o,C,g);else if(x==="object")throw n=String(r),Error("Objects are not valid as a React child (found: "+(n==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":n)+"). If you meant to render a collection of children, use an array instead.");return v}function vp(r,n,o){if(r==null)return r;var h=[],g=0;return Hp(r,h,"","",function(x){return n.call(o,x,g++)}),h}function Hk(r){if(r._status===-1){var n=r._result;n=n(),n.then(function(o){(r._status===0||r._status===-1)&&(r._status=1,r._result=o)},function(o){(r._status===0||r._status===-1)&&(r._status=2,r._result=o)}),r._status===-1&&(r._status=0,r._result=n)}if(r._status===1)return r._result.default;throw r._result}var Vn={current:null},Kp={transition:null},Kk={ReactCurrentDispatcher:Vn,ReactCurrentBatchConfig:Kp,ReactCurrentOwner:E_};function e1(){throw Error("act(...) is not supported in production builds of React.")}Lt.Children={map:vp,forEach:function(r,n,o){vp(r,function(){n.apply(this,arguments)},o)},count:function(r){var n=0;return vp(r,function(){n++}),n},toArray:function(r){return vp(r,function(n){return n})||[]},only:function(r){if(!P_(r))throw Error("React.Children.only expected to receive a single React element child.");return r}};Lt.Component=Hu;Lt.Fragment=Rk;Lt.Profiler=Fk;Lt.PureComponent=T_;Lt.StrictMode=Bk;Lt.Suspense=Vk;Lt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Kk;Lt.act=e1;Lt.cloneElement=function(r,n,o){if(r==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+r+".");var h=Kw({},r.props),g=r.key,x=r.ref,v=r._owner;if(n!=null){if(n.ref!==void 0&&(x=n.ref,v=E_.current),n.key!==void 0&&(g=""+n.key),r.type&&r.type.defaultProps)var u=r.type.defaultProps;for(C in n)Yw.call(n,C)&&!Jw.hasOwnProperty(C)&&(h[C]=n[C]===void 0&&u!==void 0?u[C]:n[C])}var C=arguments.length-2;if(C===1)h.children=o;else if(1<C){u=Array(C);for(var O=0;O<C;O++)u[O]=arguments[O+2];h.children=u}return{$$typeof:ud,type:r.type,key:g,ref:x,props:h,_owner:v}};Lt.createContext=function(r){return r={$$typeof:Nk,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},r.Provider={$$typeof:Ok,_context:r},r.Consumer=r};Lt.createElement=Qw;Lt.createFactory=function(r){var n=Qw.bind(null,r);return n.type=r,n};Lt.createRef=function(){return{current:null}};Lt.forwardRef=function(r){return{$$typeof:jk,render:r}};Lt.isValidElement=P_;Lt.lazy=function(r){return{$$typeof:$k,_payload:{_status:-1,_result:r},_init:Hk}};Lt.memo=function(r,n){return{$$typeof:Uk,type:r,compare:n===void 0?null:n}};Lt.startTransition=function(r){var n=Kp.transition;Kp.transition={};try{r()}finally{Kp.transition=n}};Lt.unstable_act=e1;Lt.useCallback=function(r,n){return Vn.current.useCallback(r,n)};Lt.useContext=function(r){return Vn.current.useContext(r)};Lt.useDebugValue=function(){};Lt.useDeferredValue=function(r){return Vn.current.useDeferredValue(r)};Lt.useEffect=function(r,n){return Vn.current.useEffect(r,n)};Lt.useId=function(){return Vn.current.useId()};Lt.useImperativeHandle=function(r,n,o){return Vn.current.useImperativeHandle(r,n,o)};Lt.useInsertionEffect=function(r,n){return Vn.current.useInsertionEffect(r,n)};Lt.useLayoutEffect=function(r,n){return Vn.current.useLayoutEffect(r,n)};Lt.useMemo=function(r,n){return Vn.current.useMemo(r,n)};Lt.useReducer=function(r,n,o){return Vn.current.useReducer(r,n,o)};Lt.useRef=function(r){return Vn.current.useRef(r)};Lt.useState=function(r){return Vn.current.useState(r)};Lt.useSyncExternalStore=function(r,n,o){return Vn.current.useSyncExternalStore(r,n,o)};Lt.useTransition=function(){return Vn.current.useTransition()};Lt.version="18.3.1";Gw.exports=Lt;var Kt=Gw.exports;const Wk=qw(Kt);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xk=Kt,Yk=Symbol.for("react.element"),Jk=Symbol.for("react.fragment"),Qk=Object.prototype.hasOwnProperty,eT=Xk.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,tT={key:!0,ref:!0,__self:!0,__source:!0};function t1(r,n,o){var h,g={},x=null,v=null;o!==void 0&&(x=""+o),n.key!==void 0&&(x=""+n.key),n.ref!==void 0&&(v=n.ref);for(h in n)Qk.call(n,h)&&!tT.hasOwnProperty(h)&&(g[h]=n[h]);if(r&&r.defaultProps)for(h in n=r.defaultProps,n)g[h]===void 0&&(g[h]=n[h]);return{$$typeof:Yk,type:r,key:x,ref:v,props:g,_owner:eT.current}}Zf.Fragment=Jk;Zf.jsx=t1;Zf.jsxs=t1;Zw.exports=Zf;var Ve=Zw.exports,sy={},r1={exports:{}},Ii={},n1={exports:{}},i1={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(r){function n(He,ht){var pt=He.length;He.push(ht);e:for(;0<pt;){var At=pt-1>>>1,Ut=He[At];if(0<g(Ut,ht))He[At]=ht,He[pt]=Ut,pt=At;else break e}}function o(He){return He.length===0?null:He[0]}function h(He){if(He.length===0)return null;var ht=He[0],pt=He.pop();if(pt!==ht){He[0]=pt;e:for(var At=0,Ut=He.length,ii=Ut>>>1;At<ii;){var Zr=2*(At+1)-1,dn=He[Zr],pn=Zr+1,zr=He[pn];if(0>g(dn,pt))pn<Ut&&0>g(zr,dn)?(He[At]=zr,He[pn]=pt,At=pn):(He[At]=dn,He[Zr]=pt,At=Zr);else if(pn<Ut&&0>g(zr,pt))He[At]=zr,He[pn]=pt,At=pn;else break e}}return ht}function g(He,ht){var pt=He.sortIndex-ht.sortIndex;return pt!==0?pt:He.id-ht.id}if(typeof performance=="object"&&typeof performance.now=="function"){var x=performance;r.unstable_now=function(){return x.now()}}else{var v=Date,u=v.now();r.unstable_now=function(){return v.now()-u}}var C=[],O=[],U=1,j=null,L=3,oe=!1,de=!1,he=!1,Ie=typeof setTimeout=="function"?setTimeout:null,K=typeof clearTimeout=="function"?clearTimeout:null,G=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ee(He){for(var ht=o(O);ht!==null;){if(ht.callback===null)h(O);else if(ht.startTime<=He)h(O),ht.sortIndex=ht.expirationTime,n(C,ht);else break;ht=o(O)}}function _e(He){if(he=!1,ee(He),!de)if(o(C)!==null)de=!0,Tr(Se);else{var ht=o(O);ht!==null&&Nt(_e,ht.startTime-He)}}function Se(He,ht){de=!1,he&&(he=!1,K(Pe),Pe=-1),oe=!0;var pt=L;try{for(ee(ht),j=o(C);j!==null&&(!(j.expirationTime>ht)||He&&!Ye());){var At=j.callback;if(typeof At=="function"){j.callback=null,L=j.priorityLevel;var Ut=At(j.expirationTime<=ht);ht=r.unstable_now(),typeof Ut=="function"?j.callback=Ut:j===o(C)&&h(C),ee(ht)}else h(C);j=o(C)}if(j!==null)var ii=!0;else{var Zr=o(O);Zr!==null&&Nt(_e,Zr.startTime-ht),ii=!1}return ii}finally{j=null,L=pt,oe=!1}}var Te=!1,xe=null,Pe=-1,Ce=5,rt=-1;function Ye(){return!(r.unstable_now()-rt<Ce)}function Wt(){if(xe!==null){var He=r.unstable_now();rt=He;var ht=!0;try{ht=xe(!0,He)}finally{ht?Tt():(Te=!1,xe=null)}}else Te=!1}var Tt;if(typeof G=="function")Tt=function(){G(Wt)};else if(typeof MessageChannel<"u"){var bt=new MessageChannel,vr=bt.port2;bt.port1.onmessage=Wt,Tt=function(){vr.postMessage(null)}}else Tt=function(){Ie(Wt,0)};function Tr(He){xe=He,Te||(Te=!0,Tt())}function Nt(He,ht){Pe=Ie(function(){He(r.unstable_now())},ht)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(He){He.callback=null},r.unstable_continueExecution=function(){de||oe||(de=!0,Tr(Se))},r.unstable_forceFrameRate=function(He){0>He||125<He?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ce=0<He?Math.floor(1e3/He):5},r.unstable_getCurrentPriorityLevel=function(){return L},r.unstable_getFirstCallbackNode=function(){return o(C)},r.unstable_next=function(He){switch(L){case 1:case 2:case 3:var ht=3;break;default:ht=L}var pt=L;L=ht;try{return He()}finally{L=pt}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(He,ht){switch(He){case 1:case 2:case 3:case 4:case 5:break;default:He=3}var pt=L;L=He;try{return ht()}finally{L=pt}},r.unstable_scheduleCallback=function(He,ht,pt){var At=r.unstable_now();switch(typeof pt=="object"&&pt!==null?(pt=pt.delay,pt=typeof pt=="number"&&0<pt?At+pt:At):pt=At,He){case 1:var Ut=-1;break;case 2:Ut=250;break;case 5:Ut=1073741823;break;case 4:Ut=1e4;break;default:Ut=5e3}return Ut=pt+Ut,He={id:U++,callback:ht,priorityLevel:He,startTime:pt,expirationTime:Ut,sortIndex:-1},pt>At?(He.sortIndex=pt,n(O,He),o(C)===null&&He===o(O)&&(he?(K(Pe),Pe=-1):he=!0,Nt(_e,pt-At))):(He.sortIndex=Ut,n(C,He),de||oe||(de=!0,Tr(Se))),He},r.unstable_shouldYield=Ye,r.unstable_wrapCallback=function(He){var ht=L;return function(){var pt=L;L=ht;try{return He.apply(this,arguments)}finally{L=pt}}}})(i1);n1.exports=i1;var rT=n1.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nT=Kt,ki=rT;function Re(r){for(var n="https://reactjs.org/docs/error-decoder.html?invariant="+r,o=1;o<arguments.length;o++)n+="&args[]="+encodeURIComponent(arguments[o]);return"Minified React error #"+r+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s1=new Set,Nh={};function ml(r,n){Nu(r,n),Nu(r+"Capture",n)}function Nu(r,n){for(Nh[r]=n,r=0;r<n.length;r++)s1.add(n[r])}var ia=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ay=Object.prototype.hasOwnProperty,iT=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,y0={},_0={};function sT(r){return ay.call(_0,r)?!0:ay.call(y0,r)?!1:iT.test(r)?_0[r]=!0:(y0[r]=!0,!1)}function aT(r,n,o,h){if(o!==null&&o.type===0)return!1;switch(typeof n){case"function":case"symbol":return!0;case"boolean":return h?!1:o!==null?!o.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function oT(r,n,o,h){if(n===null||typeof n>"u"||aT(r,n,o,h))return!0;if(h)return!1;if(o!==null)switch(o.type){case 3:return!n;case 4:return n===!1;case 5:return isNaN(n);case 6:return isNaN(n)||1>n}return!1}function Un(r,n,o,h,g,x,v){this.acceptsBooleans=n===2||n===3||n===4,this.attributeName=h,this.attributeNamespace=g,this.mustUseProperty=o,this.propertyName=r,this.type=n,this.sanitizeURL=x,this.removeEmptyString=v}var hn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){hn[r]=new Un(r,0,!1,r,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var n=r[0];hn[n]=new Un(n,1,!1,r[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(r){hn[r]=new Un(r,2,!1,r.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){hn[r]=new Un(r,2,!1,r,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){hn[r]=new Un(r,3,!1,r.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(r){hn[r]=new Un(r,3,!0,r,null,!1,!1)});["capture","download"].forEach(function(r){hn[r]=new Un(r,4,!1,r,null,!1,!1)});["cols","rows","size","span"].forEach(function(r){hn[r]=new Un(r,6,!1,r,null,!1,!1)});["rowSpan","start"].forEach(function(r){hn[r]=new Un(r,5,!1,r.toLowerCase(),null,!1,!1)});var C_=/[\-:]([a-z])/g;function M_(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var n=r.replace(C_,M_);hn[n]=new Un(n,1,!1,r,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var n=r.replace(C_,M_);hn[n]=new Un(n,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(r){var n=r.replace(C_,M_);hn[n]=new Un(n,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(r){hn[r]=new Un(r,1,!1,r.toLowerCase(),null,!1,!1)});hn.xlinkHref=new Un("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(r){hn[r]=new Un(r,1,!1,r.toLowerCase(),null,!0,!0)});function A_(r,n,o,h){var g=hn.hasOwnProperty(n)?hn[n]:null;(g!==null?g.type!==0:h||!(2<n.length)||n[0]!=="o"&&n[0]!=="O"||n[1]!=="n"&&n[1]!=="N")&&(oT(n,o,g,h)&&(o=null),h||g===null?sT(n)&&(o===null?r.removeAttribute(n):r.setAttribute(n,""+o)):g.mustUseProperty?r[g.propertyName]=o===null?g.type===3?!1:"":o:(n=g.attributeName,h=g.attributeNamespace,o===null?r.removeAttribute(n):(g=g.type,o=g===3||g===4&&o===!0?"":""+o,h?r.setAttributeNS(h,n,o):r.setAttribute(n,o))))}var ua=nT.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,xp=Symbol.for("react.element"),_u=Symbol.for("react.portal"),vu=Symbol.for("react.fragment"),z_=Symbol.for("react.strict_mode"),oy=Symbol.for("react.profiler"),a1=Symbol.for("react.provider"),o1=Symbol.for("react.context"),D_=Symbol.for("react.forward_ref"),ly=Symbol.for("react.suspense"),uy=Symbol.for("react.suspense_list"),L_=Symbol.for("react.memo"),Ha=Symbol.for("react.lazy"),l1=Symbol.for("react.offscreen"),v0=Symbol.iterator;function ah(r){return r===null||typeof r!="object"?null:(r=v0&&r[v0]||r["@@iterator"],typeof r=="function"?r:null)}var kr=Object.assign,Tg;function yh(r){if(Tg===void 0)try{throw Error()}catch(o){var n=o.stack.trim().match(/\n( *(at )?)/);Tg=n&&n[1]||""}return`
`+Tg+r}var Ig=!1;function Eg(r,n){if(!r||Ig)return"";Ig=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(n)if(n=function(){throw Error()},Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(n,[])}catch(O){var h=O}Reflect.construct(r,[],n)}else{try{n.call()}catch(O){h=O}r.call(n.prototype)}else{try{throw Error()}catch(O){h=O}r()}}catch(O){if(O&&h&&typeof O.stack=="string"){for(var g=O.stack.split(`
`),x=h.stack.split(`
`),v=g.length-1,u=x.length-1;1<=v&&0<=u&&g[v]!==x[u];)u--;for(;1<=v&&0<=u;v--,u--)if(g[v]!==x[u]){if(v!==1||u!==1)do if(v--,u--,0>u||g[v]!==x[u]){var C=`
`+g[v].replace(" at new "," at ");return r.displayName&&C.includes("<anonymous>")&&(C=C.replace("<anonymous>",r.displayName)),C}while(1<=v&&0<=u);break}}}finally{Ig=!1,Error.prepareStackTrace=o}return(r=r?r.displayName||r.name:"")?yh(r):""}function lT(r){switch(r.tag){case 5:return yh(r.type);case 16:return yh("Lazy");case 13:return yh("Suspense");case 19:return yh("SuspenseList");case 0:case 2:case 15:return r=Eg(r.type,!1),r;case 11:return r=Eg(r.type.render,!1),r;case 1:return r=Eg(r.type,!0),r;default:return""}}function cy(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case vu:return"Fragment";case _u:return"Portal";case oy:return"Profiler";case z_:return"StrictMode";case ly:return"Suspense";case uy:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case o1:return(r.displayName||"Context")+".Consumer";case a1:return(r._context.displayName||"Context")+".Provider";case D_:var n=r.render;return r=r.displayName,r||(r=n.displayName||n.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case L_:return n=r.displayName||null,n!==null?n:cy(r.type)||"Memo";case Ha:n=r._payload,r=r._init;try{return cy(r(n))}catch{}}return null}function uT(r){var n=r.type;switch(r.tag){case 24:return"Cache";case 9:return(n.displayName||"Context")+".Consumer";case 10:return(n._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return r=n.render,r=r.displayName||r.name||"",n.displayName||(r!==""?"ForwardRef("+r+")":"ForwardRef");case 7:return"Fragment";case 5:return n;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return cy(n);case 8:return n===z_?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n}return null}function uo(r){switch(typeof r){case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function u1(r){var n=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function cT(r){var n=u1(r)?"checked":"value",o=Object.getOwnPropertyDescriptor(r.constructor.prototype,n),h=""+r[n];if(!r.hasOwnProperty(n)&&typeof o<"u"&&typeof o.get=="function"&&typeof o.set=="function"){var g=o.get,x=o.set;return Object.defineProperty(r,n,{configurable:!0,get:function(){return g.call(this)},set:function(v){h=""+v,x.call(this,v)}}),Object.defineProperty(r,n,{enumerable:o.enumerable}),{getValue:function(){return h},setValue:function(v){h=""+v},stopTracking:function(){r._valueTracker=null,delete r[n]}}}}function wp(r){r._valueTracker||(r._valueTracker=cT(r))}function c1(r){if(!r)return!1;var n=r._valueTracker;if(!n)return!0;var o=n.getValue(),h="";return r&&(h=u1(r)?r.checked?"true":"false":r.value),r=h,r!==o?(n.setValue(r),!0):!1}function pf(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}function hy(r,n){var o=n.checked;return kr({},n,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:o??r._wrapperState.initialChecked})}function x0(r,n){var o=n.defaultValue==null?"":n.defaultValue,h=n.checked!=null?n.checked:n.defaultChecked;o=uo(n.value!=null?n.value:o),r._wrapperState={initialChecked:h,initialValue:o,controlled:n.type==="checkbox"||n.type==="radio"?n.checked!=null:n.value!=null}}function h1(r,n){n=n.checked,n!=null&&A_(r,"checked",n,!1)}function dy(r,n){h1(r,n);var o=uo(n.value),h=n.type;if(o!=null)h==="number"?(o===0&&r.value===""||r.value!=o)&&(r.value=""+o):r.value!==""+o&&(r.value=""+o);else if(h==="submit"||h==="reset"){r.removeAttribute("value");return}n.hasOwnProperty("value")?py(r,n.type,o):n.hasOwnProperty("defaultValue")&&py(r,n.type,uo(n.defaultValue)),n.checked==null&&n.defaultChecked!=null&&(r.defaultChecked=!!n.defaultChecked)}function w0(r,n,o){if(n.hasOwnProperty("value")||n.hasOwnProperty("defaultValue")){var h=n.type;if(!(h!=="submit"&&h!=="reset"||n.value!==void 0&&n.value!==null))return;n=""+r._wrapperState.initialValue,o||n===r.value||(r.value=n),r.defaultValue=n}o=r.name,o!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,o!==""&&(r.name=o)}function py(r,n,o){(n!=="number"||pf(r.ownerDocument)!==r)&&(o==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+o&&(r.defaultValue=""+o))}var _h=Array.isArray;function Mu(r,n,o,h){if(r=r.options,n){n={};for(var g=0;g<o.length;g++)n["$"+o[g]]=!0;for(o=0;o<r.length;o++)g=n.hasOwnProperty("$"+r[o].value),r[o].selected!==g&&(r[o].selected=g),g&&h&&(r[o].defaultSelected=!0)}else{for(o=""+uo(o),n=null,g=0;g<r.length;g++){if(r[g].value===o){r[g].selected=!0,h&&(r[g].defaultSelected=!0);return}n!==null||r[g].disabled||(n=r[g])}n!==null&&(n.selected=!0)}}function fy(r,n){if(n.dangerouslySetInnerHTML!=null)throw Error(Re(91));return kr({},n,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function b0(r,n){var o=n.value;if(o==null){if(o=n.children,n=n.defaultValue,o!=null){if(n!=null)throw Error(Re(92));if(_h(o)){if(1<o.length)throw Error(Re(93));o=o[0]}n=o}n==null&&(n=""),o=n}r._wrapperState={initialValue:uo(o)}}function d1(r,n){var o=uo(n.value),h=uo(n.defaultValue);o!=null&&(o=""+o,o!==r.value&&(r.value=o),n.defaultValue==null&&r.defaultValue!==o&&(r.defaultValue=o)),h!=null&&(r.defaultValue=""+h)}function S0(r){var n=r.textContent;n===r._wrapperState.initialValue&&n!==""&&n!==null&&(r.value=n)}function p1(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function my(r,n){return r==null||r==="http://www.w3.org/1999/xhtml"?p1(n):r==="http://www.w3.org/2000/svg"&&n==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var bp,f1=function(r){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(n,o,h,g){MSApp.execUnsafeLocalFunction(function(){return r(n,o,h,g)})}:r}(function(r,n){if(r.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in r)r.innerHTML=n;else{for(bp=bp||document.createElement("div"),bp.innerHTML="<svg>"+n.valueOf().toString()+"</svg>",n=bp.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;n.firstChild;)r.appendChild(n.firstChild)}});function jh(r,n){if(n){var o=r.firstChild;if(o&&o===r.lastChild&&o.nodeType===3){o.nodeValue=n;return}}r.textContent=n}var Th={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},hT=["Webkit","ms","Moz","O"];Object.keys(Th).forEach(function(r){hT.forEach(function(n){n=n+r.charAt(0).toUpperCase()+r.substring(1),Th[n]=Th[r]})});function m1(r,n,o){return n==null||typeof n=="boolean"||n===""?"":o||typeof n!="number"||n===0||Th.hasOwnProperty(r)&&Th[r]?(""+n).trim():n+"px"}function g1(r,n){r=r.style;for(var o in n)if(n.hasOwnProperty(o)){var h=o.indexOf("--")===0,g=m1(o,n[o],h);o==="float"&&(o="cssFloat"),h?r.setProperty(o,g):r[o]=g}}var dT=kr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function gy(r,n){if(n){if(dT[r]&&(n.children!=null||n.dangerouslySetInnerHTML!=null))throw Error(Re(137,r));if(n.dangerouslySetInnerHTML!=null){if(n.children!=null)throw Error(Re(60));if(typeof n.dangerouslySetInnerHTML!="object"||!("__html"in n.dangerouslySetInnerHTML))throw Error(Re(61))}if(n.style!=null&&typeof n.style!="object")throw Error(Re(62))}}function yy(r,n){if(r.indexOf("-")===-1)return typeof n.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var _y=null;function R_(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var vy=null,Au=null,zu=null;function k0(r){if(r=dd(r)){if(typeof vy!="function")throw Error(Re(280));var n=r.stateNode;n&&(n=Xf(n),vy(r.stateNode,r.type,n))}}function y1(r){Au?zu?zu.push(r):zu=[r]:Au=r}function _1(){if(Au){var r=Au,n=zu;if(zu=Au=null,k0(r),n)for(r=0;r<n.length;r++)k0(n[r])}}function v1(r,n){return r(n)}function x1(){}var Pg=!1;function w1(r,n,o){if(Pg)return r(n,o);Pg=!0;try{return v1(r,n,o)}finally{Pg=!1,(Au!==null||zu!==null)&&(x1(),_1())}}function Vh(r,n){var o=r.stateNode;if(o===null)return null;var h=Xf(o);if(h===null)return null;o=h[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(h=!h.disabled)||(r=r.type,h=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!h;break e;default:r=!1}if(r)return null;if(o&&typeof o!="function")throw Error(Re(231,n,typeof o));return o}var xy=!1;if(ia)try{var oh={};Object.defineProperty(oh,"passive",{get:function(){xy=!0}}),window.addEventListener("test",oh,oh),window.removeEventListener("test",oh,oh)}catch{xy=!1}function pT(r,n,o,h,g,x,v,u,C){var O=Array.prototype.slice.call(arguments,3);try{n.apply(o,O)}catch(U){this.onError(U)}}var Ih=!1,ff=null,mf=!1,wy=null,fT={onError:function(r){Ih=!0,ff=r}};function mT(r,n,o,h,g,x,v,u,C){Ih=!1,ff=null,pT.apply(fT,arguments)}function gT(r,n,o,h,g,x,v,u,C){if(mT.apply(this,arguments),Ih){if(Ih){var O=ff;Ih=!1,ff=null}else throw Error(Re(198));mf||(mf=!0,wy=O)}}function gl(r){var n=r,o=r;if(r.alternate)for(;n.return;)n=n.return;else{r=n;do n=r,n.flags&4098&&(o=n.return),r=n.return;while(r)}return n.tag===3?o:null}function b1(r){if(r.tag===13){var n=r.memoizedState;if(n===null&&(r=r.alternate,r!==null&&(n=r.memoizedState)),n!==null)return n.dehydrated}return null}function T0(r){if(gl(r)!==r)throw Error(Re(188))}function yT(r){var n=r.alternate;if(!n){if(n=gl(r),n===null)throw Error(Re(188));return n!==r?null:r}for(var o=r,h=n;;){var g=o.return;if(g===null)break;var x=g.alternate;if(x===null){if(h=g.return,h!==null){o=h;continue}break}if(g.child===x.child){for(x=g.child;x;){if(x===o)return T0(g),r;if(x===h)return T0(g),n;x=x.sibling}throw Error(Re(188))}if(o.return!==h.return)o=g,h=x;else{for(var v=!1,u=g.child;u;){if(u===o){v=!0,o=g,h=x;break}if(u===h){v=!0,h=g,o=x;break}u=u.sibling}if(!v){for(u=x.child;u;){if(u===o){v=!0,o=x,h=g;break}if(u===h){v=!0,h=x,o=g;break}u=u.sibling}if(!v)throw Error(Re(189))}}if(o.alternate!==h)throw Error(Re(190))}if(o.tag!==3)throw Error(Re(188));return o.stateNode.current===o?r:n}function S1(r){return r=yT(r),r!==null?k1(r):null}function k1(r){if(r.tag===5||r.tag===6)return r;for(r=r.child;r!==null;){var n=k1(r);if(n!==null)return n;r=r.sibling}return null}var T1=ki.unstable_scheduleCallback,I0=ki.unstable_cancelCallback,_T=ki.unstable_shouldYield,vT=ki.unstable_requestPaint,Ar=ki.unstable_now,xT=ki.unstable_getCurrentPriorityLevel,B_=ki.unstable_ImmediatePriority,I1=ki.unstable_UserBlockingPriority,gf=ki.unstable_NormalPriority,wT=ki.unstable_LowPriority,E1=ki.unstable_IdlePriority,Gf=null,ks=null;function bT(r){if(ks&&typeof ks.onCommitFiberRoot=="function")try{ks.onCommitFiberRoot(Gf,r,void 0,(r.current.flags&128)===128)}catch{}}var rs=Math.clz32?Math.clz32:TT,ST=Math.log,kT=Math.LN2;function TT(r){return r>>>=0,r===0?32:31-(ST(r)/kT|0)|0}var Sp=64,kp=4194304;function vh(r){switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return r&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return r}}function yf(r,n){var o=r.pendingLanes;if(o===0)return 0;var h=0,g=r.suspendedLanes,x=r.pingedLanes,v=o&268435455;if(v!==0){var u=v&~g;u!==0?h=vh(u):(x&=v,x!==0&&(h=vh(x)))}else v=o&~g,v!==0?h=vh(v):x!==0&&(h=vh(x));if(h===0)return 0;if(n!==0&&n!==h&&!(n&g)&&(g=h&-h,x=n&-n,g>=x||g===16&&(x&4194240)!==0))return n;if(h&4&&(h|=o&16),n=r.entangledLanes,n!==0)for(r=r.entanglements,n&=h;0<n;)o=31-rs(n),g=1<<o,h|=r[o],n&=~g;return h}function IT(r,n){switch(r){case 1:case 2:case 4:return n+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ET(r,n){for(var o=r.suspendedLanes,h=r.pingedLanes,g=r.expirationTimes,x=r.pendingLanes;0<x;){var v=31-rs(x),u=1<<v,C=g[v];C===-1?(!(u&o)||u&h)&&(g[v]=IT(u,n)):C<=n&&(r.expiredLanes|=u),x&=~u}}function by(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function P1(){var r=Sp;return Sp<<=1,!(Sp&4194240)&&(Sp=64),r}function Cg(r){for(var n=[],o=0;31>o;o++)n.push(r);return n}function cd(r,n,o){r.pendingLanes|=n,n!==536870912&&(r.suspendedLanes=0,r.pingedLanes=0),r=r.eventTimes,n=31-rs(n),r[n]=o}function PT(r,n){var o=r.pendingLanes&~n;r.pendingLanes=n,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=n,r.mutableReadLanes&=n,r.entangledLanes&=n,n=r.entanglements;var h=r.eventTimes;for(r=r.expirationTimes;0<o;){var g=31-rs(o),x=1<<g;n[g]=0,h[g]=-1,r[g]=-1,o&=~x}}function F_(r,n){var o=r.entangledLanes|=n;for(r=r.entanglements;o;){var h=31-rs(o),g=1<<h;g&n|r[h]&n&&(r[h]|=n),o&=~g}}var Qt=0;function C1(r){return r&=-r,1<r?4<r?r&268435455?16:536870912:4:1}var M1,O_,A1,z1,D1,Sy=!1,Tp=[],to=null,ro=null,no=null,Uh=new Map,$h=new Map,Xa=[],CT="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function E0(r,n){switch(r){case"focusin":case"focusout":to=null;break;case"dragenter":case"dragleave":ro=null;break;case"mouseover":case"mouseout":no=null;break;case"pointerover":case"pointerout":Uh.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":$h.delete(n.pointerId)}}function lh(r,n,o,h,g,x){return r===null||r.nativeEvent!==x?(r={blockedOn:n,domEventName:o,eventSystemFlags:h,nativeEvent:x,targetContainers:[g]},n!==null&&(n=dd(n),n!==null&&O_(n)),r):(r.eventSystemFlags|=h,n=r.targetContainers,g!==null&&n.indexOf(g)===-1&&n.push(g),r)}function MT(r,n,o,h,g){switch(n){case"focusin":return to=lh(to,r,n,o,h,g),!0;case"dragenter":return ro=lh(ro,r,n,o,h,g),!0;case"mouseover":return no=lh(no,r,n,o,h,g),!0;case"pointerover":var x=g.pointerId;return Uh.set(x,lh(Uh.get(x)||null,r,n,o,h,g)),!0;case"gotpointercapture":return x=g.pointerId,$h.set(x,lh($h.get(x)||null,r,n,o,h,g)),!0}return!1}function L1(r){var n=Qo(r.target);if(n!==null){var o=gl(n);if(o!==null){if(n=o.tag,n===13){if(n=b1(o),n!==null){r.blockedOn=n,D1(r.priority,function(){A1(o)});return}}else if(n===3&&o.stateNode.current.memoizedState.isDehydrated){r.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}r.blockedOn=null}function Wp(r){if(r.blockedOn!==null)return!1;for(var n=r.targetContainers;0<n.length;){var o=ky(r.domEventName,r.eventSystemFlags,n[0],r.nativeEvent);if(o===null){o=r.nativeEvent;var h=new o.constructor(o.type,o);_y=h,o.target.dispatchEvent(h),_y=null}else return n=dd(o),n!==null&&O_(n),r.blockedOn=o,!1;n.shift()}return!0}function P0(r,n,o){Wp(r)&&o.delete(n)}function AT(){Sy=!1,to!==null&&Wp(to)&&(to=null),ro!==null&&Wp(ro)&&(ro=null),no!==null&&Wp(no)&&(no=null),Uh.forEach(P0),$h.forEach(P0)}function uh(r,n){r.blockedOn===n&&(r.blockedOn=null,Sy||(Sy=!0,ki.unstable_scheduleCallback(ki.unstable_NormalPriority,AT)))}function qh(r){function n(g){return uh(g,r)}if(0<Tp.length){uh(Tp[0],r);for(var o=1;o<Tp.length;o++){var h=Tp[o];h.blockedOn===r&&(h.blockedOn=null)}}for(to!==null&&uh(to,r),ro!==null&&uh(ro,r),no!==null&&uh(no,r),Uh.forEach(n),$h.forEach(n),o=0;o<Xa.length;o++)h=Xa[o],h.blockedOn===r&&(h.blockedOn=null);for(;0<Xa.length&&(o=Xa[0],o.blockedOn===null);)L1(o),o.blockedOn===null&&Xa.shift()}var Du=ua.ReactCurrentBatchConfig,_f=!0;function zT(r,n,o,h){var g=Qt,x=Du.transition;Du.transition=null;try{Qt=1,N_(r,n,o,h)}finally{Qt=g,Du.transition=x}}function DT(r,n,o,h){var g=Qt,x=Du.transition;Du.transition=null;try{Qt=4,N_(r,n,o,h)}finally{Qt=g,Du.transition=x}}function N_(r,n,o,h){if(_f){var g=ky(r,n,o,h);if(g===null)Ng(r,n,h,vf,o),E0(r,h);else if(MT(g,r,n,o,h))h.stopPropagation();else if(E0(r,h),n&4&&-1<CT.indexOf(r)){for(;g!==null;){var x=dd(g);if(x!==null&&M1(x),x=ky(r,n,o,h),x===null&&Ng(r,n,h,vf,o),x===g)break;g=x}g!==null&&h.stopPropagation()}else Ng(r,n,h,null,o)}}var vf=null;function ky(r,n,o,h){if(vf=null,r=R_(h),r=Qo(r),r!==null)if(n=gl(r),n===null)r=null;else if(o=n.tag,o===13){if(r=b1(n),r!==null)return r;r=null}else if(o===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;r=null}else n!==r&&(r=null);return vf=r,null}function R1(r){switch(r){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(xT()){case B_:return 1;case I1:return 4;case gf:case wT:return 16;case E1:return 536870912;default:return 16}default:return 16}}var Qa=null,j_=null,Xp=null;function B1(){if(Xp)return Xp;var r,n=j_,o=n.length,h,g="value"in Qa?Qa.value:Qa.textContent,x=g.length;for(r=0;r<o&&n[r]===g[r];r++);var v=o-r;for(h=1;h<=v&&n[o-h]===g[x-h];h++);return Xp=g.slice(r,1<h?1-h:void 0)}function Yp(r){var n=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&n===13&&(r=13)):r=n,r===10&&(r=13),32<=r||r===13?r:0}function Ip(){return!0}function C0(){return!1}function Ei(r){function n(o,h,g,x,v){this._reactName=o,this._targetInst=g,this.type=h,this.nativeEvent=x,this.target=v,this.currentTarget=null;for(var u in r)r.hasOwnProperty(u)&&(o=r[u],this[u]=o?o(x):x[u]);return this.isDefaultPrevented=(x.defaultPrevented!=null?x.defaultPrevented:x.returnValue===!1)?Ip:C0,this.isPropagationStopped=C0,this}return kr(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=Ip)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=Ip)},persist:function(){},isPersistent:Ip}),n}var Ku={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},V_=Ei(Ku),hd=kr({},Ku,{view:0,detail:0}),LT=Ei(hd),Mg,Ag,ch,Hf=kr({},hd,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:U_,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==ch&&(ch&&r.type==="mousemove"?(Mg=r.screenX-ch.screenX,Ag=r.screenY-ch.screenY):Ag=Mg=0,ch=r),Mg)},movementY:function(r){return"movementY"in r?r.movementY:Ag}}),M0=Ei(Hf),RT=kr({},Hf,{dataTransfer:0}),BT=Ei(RT),FT=kr({},hd,{relatedTarget:0}),zg=Ei(FT),OT=kr({},Ku,{animationName:0,elapsedTime:0,pseudoElement:0}),NT=Ei(OT),jT=kr({},Ku,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),VT=Ei(jT),UT=kr({},Ku,{data:0}),A0=Ei(UT),$T={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},qT={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ZT={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function GT(r){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(r):(r=ZT[r])?!!n[r]:!1}function U_(){return GT}var HT=kr({},hd,{key:function(r){if(r.key){var n=$T[r.key]||r.key;if(n!=="Unidentified")return n}return r.type==="keypress"?(r=Yp(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?qT[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:U_,charCode:function(r){return r.type==="keypress"?Yp(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?Yp(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),KT=Ei(HT),WT=kr({},Hf,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),z0=Ei(WT),XT=kr({},hd,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:U_}),YT=Ei(XT),JT=kr({},Ku,{propertyName:0,elapsedTime:0,pseudoElement:0}),QT=Ei(JT),eI=kr({},Hf,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),tI=Ei(eI),rI=[9,13,27,32],$_=ia&&"CompositionEvent"in window,Eh=null;ia&&"documentMode"in document&&(Eh=document.documentMode);var nI=ia&&"TextEvent"in window&&!Eh,F1=ia&&(!$_||Eh&&8<Eh&&11>=Eh),D0=" ",L0=!1;function O1(r,n){switch(r){case"keyup":return rI.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function N1(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var xu=!1;function iI(r,n){switch(r){case"compositionend":return N1(n);case"keypress":return n.which!==32?null:(L0=!0,D0);case"textInput":return r=n.data,r===D0&&L0?null:r;default:return null}}function sI(r,n){if(xu)return r==="compositionend"||!$_&&O1(r,n)?(r=B1(),Xp=j_=Qa=null,xu=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return F1&&n.locale!=="ko"?null:n.data;default:return null}}var aI={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function R0(r){var n=r&&r.nodeName&&r.nodeName.toLowerCase();return n==="input"?!!aI[r.type]:n==="textarea"}function j1(r,n,o,h){y1(h),n=xf(n,"onChange"),0<n.length&&(o=new V_("onChange","change",null,o,h),r.push({event:o,listeners:n}))}var Ph=null,Zh=null;function oI(r){Y1(r,0)}function Kf(r){var n=Su(r);if(c1(n))return r}function lI(r,n){if(r==="change")return n}var V1=!1;if(ia){var Dg;if(ia){var Lg="oninput"in document;if(!Lg){var B0=document.createElement("div");B0.setAttribute("oninput","return;"),Lg=typeof B0.oninput=="function"}Dg=Lg}else Dg=!1;V1=Dg&&(!document.documentMode||9<document.documentMode)}function F0(){Ph&&(Ph.detachEvent("onpropertychange",U1),Zh=Ph=null)}function U1(r){if(r.propertyName==="value"&&Kf(Zh)){var n=[];j1(n,Zh,r,R_(r)),w1(oI,n)}}function uI(r,n,o){r==="focusin"?(F0(),Ph=n,Zh=o,Ph.attachEvent("onpropertychange",U1)):r==="focusout"&&F0()}function cI(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return Kf(Zh)}function hI(r,n){if(r==="click")return Kf(n)}function dI(r,n){if(r==="input"||r==="change")return Kf(n)}function pI(r,n){return r===n&&(r!==0||1/r===1/n)||r!==r&&n!==n}var ss=typeof Object.is=="function"?Object.is:pI;function Gh(r,n){if(ss(r,n))return!0;if(typeof r!="object"||r===null||typeof n!="object"||n===null)return!1;var o=Object.keys(r),h=Object.keys(n);if(o.length!==h.length)return!1;for(h=0;h<o.length;h++){var g=o[h];if(!ay.call(n,g)||!ss(r[g],n[g]))return!1}return!0}function O0(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function N0(r,n){var o=O0(r);r=0;for(var h;o;){if(o.nodeType===3){if(h=r+o.textContent.length,r<=n&&h>=n)return{node:o,offset:n-r};r=h}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=O0(o)}}function $1(r,n){return r&&n?r===n?!0:r&&r.nodeType===3?!1:n&&n.nodeType===3?$1(r,n.parentNode):"contains"in r?r.contains(n):r.compareDocumentPosition?!!(r.compareDocumentPosition(n)&16):!1:!1}function q1(){for(var r=window,n=pf();n instanceof r.HTMLIFrameElement;){try{var o=typeof n.contentWindow.location.href=="string"}catch{o=!1}if(o)r=n.contentWindow;else break;n=pf(r.document)}return n}function q_(r){var n=r&&r.nodeName&&r.nodeName.toLowerCase();return n&&(n==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||n==="textarea"||r.contentEditable==="true")}function fI(r){var n=q1(),o=r.focusedElem,h=r.selectionRange;if(n!==o&&o&&o.ownerDocument&&$1(o.ownerDocument.documentElement,o)){if(h!==null&&q_(o)){if(n=h.start,r=h.end,r===void 0&&(r=n),"selectionStart"in o)o.selectionStart=n,o.selectionEnd=Math.min(r,o.value.length);else if(r=(n=o.ownerDocument||document)&&n.defaultView||window,r.getSelection){r=r.getSelection();var g=o.textContent.length,x=Math.min(h.start,g);h=h.end===void 0?x:Math.min(h.end,g),!r.extend&&x>h&&(g=h,h=x,x=g),g=N0(o,x);var v=N0(o,h);g&&v&&(r.rangeCount!==1||r.anchorNode!==g.node||r.anchorOffset!==g.offset||r.focusNode!==v.node||r.focusOffset!==v.offset)&&(n=n.createRange(),n.setStart(g.node,g.offset),r.removeAllRanges(),x>h?(r.addRange(n),r.extend(v.node,v.offset)):(n.setEnd(v.node,v.offset),r.addRange(n)))}}for(n=[],r=o;r=r.parentNode;)r.nodeType===1&&n.push({element:r,left:r.scrollLeft,top:r.scrollTop});for(typeof o.focus=="function"&&o.focus(),o=0;o<n.length;o++)r=n[o],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}}var mI=ia&&"documentMode"in document&&11>=document.documentMode,wu=null,Ty=null,Ch=null,Iy=!1;function j0(r,n,o){var h=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;Iy||wu==null||wu!==pf(h)||(h=wu,"selectionStart"in h&&q_(h)?h={start:h.selectionStart,end:h.selectionEnd}:(h=(h.ownerDocument&&h.ownerDocument.defaultView||window).getSelection(),h={anchorNode:h.anchorNode,anchorOffset:h.anchorOffset,focusNode:h.focusNode,focusOffset:h.focusOffset}),Ch&&Gh(Ch,h)||(Ch=h,h=xf(Ty,"onSelect"),0<h.length&&(n=new V_("onSelect","select",null,n,o),r.push({event:n,listeners:h}),n.target=wu)))}function Ep(r,n){var o={};return o[r.toLowerCase()]=n.toLowerCase(),o["Webkit"+r]="webkit"+n,o["Moz"+r]="moz"+n,o}var bu={animationend:Ep("Animation","AnimationEnd"),animationiteration:Ep("Animation","AnimationIteration"),animationstart:Ep("Animation","AnimationStart"),transitionend:Ep("Transition","TransitionEnd")},Rg={},Z1={};ia&&(Z1=document.createElement("div").style,"AnimationEvent"in window||(delete bu.animationend.animation,delete bu.animationiteration.animation,delete bu.animationstart.animation),"TransitionEvent"in window||delete bu.transitionend.transition);function Wf(r){if(Rg[r])return Rg[r];if(!bu[r])return r;var n=bu[r],o;for(o in n)if(n.hasOwnProperty(o)&&o in Z1)return Rg[r]=n[o];return r}var G1=Wf("animationend"),H1=Wf("animationiteration"),K1=Wf("animationstart"),W1=Wf("transitionend"),X1=new Map,V0="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function mo(r,n){X1.set(r,n),ml(n,[r])}for(var Bg=0;Bg<V0.length;Bg++){var Fg=V0[Bg],gI=Fg.toLowerCase(),yI=Fg[0].toUpperCase()+Fg.slice(1);mo(gI,"on"+yI)}mo(G1,"onAnimationEnd");mo(H1,"onAnimationIteration");mo(K1,"onAnimationStart");mo("dblclick","onDoubleClick");mo("focusin","onFocus");mo("focusout","onBlur");mo(W1,"onTransitionEnd");Nu("onMouseEnter",["mouseout","mouseover"]);Nu("onMouseLeave",["mouseout","mouseover"]);Nu("onPointerEnter",["pointerout","pointerover"]);Nu("onPointerLeave",["pointerout","pointerover"]);ml("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ml("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ml("onBeforeInput",["compositionend","keypress","textInput","paste"]);ml("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ml("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ml("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var xh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),_I=new Set("cancel close invalid load scroll toggle".split(" ").concat(xh));function U0(r,n,o){var h=r.type||"unknown-event";r.currentTarget=o,gT(h,n,void 0,r),r.currentTarget=null}function Y1(r,n){n=(n&4)!==0;for(var o=0;o<r.length;o++){var h=r[o],g=h.event;h=h.listeners;e:{var x=void 0;if(n)for(var v=h.length-1;0<=v;v--){var u=h[v],C=u.instance,O=u.currentTarget;if(u=u.listener,C!==x&&g.isPropagationStopped())break e;U0(g,u,O),x=C}else for(v=0;v<h.length;v++){if(u=h[v],C=u.instance,O=u.currentTarget,u=u.listener,C!==x&&g.isPropagationStopped())break e;U0(g,u,O),x=C}}}if(mf)throw r=wy,mf=!1,wy=null,r}function hr(r,n){var o=n[Ay];o===void 0&&(o=n[Ay]=new Set);var h=r+"__bubble";o.has(h)||(J1(n,r,2,!1),o.add(h))}function Og(r,n,o){var h=0;n&&(h|=4),J1(o,r,h,n)}var Pp="_reactListening"+Math.random().toString(36).slice(2);function Hh(r){if(!r[Pp]){r[Pp]=!0,s1.forEach(function(o){o!=="selectionchange"&&(_I.has(o)||Og(o,!1,r),Og(o,!0,r))});var n=r.nodeType===9?r:r.ownerDocument;n===null||n[Pp]||(n[Pp]=!0,Og("selectionchange",!1,n))}}function J1(r,n,o,h){switch(R1(n)){case 1:var g=zT;break;case 4:g=DT;break;default:g=N_}o=g.bind(null,n,o,r),g=void 0,!xy||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(g=!0),h?g!==void 0?r.addEventListener(n,o,{capture:!0,passive:g}):r.addEventListener(n,o,!0):g!==void 0?r.addEventListener(n,o,{passive:g}):r.addEventListener(n,o,!1)}function Ng(r,n,o,h,g){var x=h;if(!(n&1)&&!(n&2)&&h!==null)e:for(;;){if(h===null)return;var v=h.tag;if(v===3||v===4){var u=h.stateNode.containerInfo;if(u===g||u.nodeType===8&&u.parentNode===g)break;if(v===4)for(v=h.return;v!==null;){var C=v.tag;if((C===3||C===4)&&(C=v.stateNode.containerInfo,C===g||C.nodeType===8&&C.parentNode===g))return;v=v.return}for(;u!==null;){if(v=Qo(u),v===null)return;if(C=v.tag,C===5||C===6){h=x=v;continue e}u=u.parentNode}}h=h.return}w1(function(){var O=x,U=R_(o),j=[];e:{var L=X1.get(r);if(L!==void 0){var oe=V_,de=r;switch(r){case"keypress":if(Yp(o)===0)break e;case"keydown":case"keyup":oe=KT;break;case"focusin":de="focus",oe=zg;break;case"focusout":de="blur",oe=zg;break;case"beforeblur":case"afterblur":oe=zg;break;case"click":if(o.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":oe=M0;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":oe=BT;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":oe=YT;break;case G1:case H1:case K1:oe=NT;break;case W1:oe=QT;break;case"scroll":oe=LT;break;case"wheel":oe=tI;break;case"copy":case"cut":case"paste":oe=VT;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":oe=z0}var he=(n&4)!==0,Ie=!he&&r==="scroll",K=he?L!==null?L+"Capture":null:L;he=[];for(var G=O,ee;G!==null;){ee=G;var _e=ee.stateNode;if(ee.tag===5&&_e!==null&&(ee=_e,K!==null&&(_e=Vh(G,K),_e!=null&&he.push(Kh(G,_e,ee)))),Ie)break;G=G.return}0<he.length&&(L=new oe(L,de,null,o,U),j.push({event:L,listeners:he}))}}if(!(n&7)){e:{if(L=r==="mouseover"||r==="pointerover",oe=r==="mouseout"||r==="pointerout",L&&o!==_y&&(de=o.relatedTarget||o.fromElement)&&(Qo(de)||de[sa]))break e;if((oe||L)&&(L=U.window===U?U:(L=U.ownerDocument)?L.defaultView||L.parentWindow:window,oe?(de=o.relatedTarget||o.toElement,oe=O,de=de?Qo(de):null,de!==null&&(Ie=gl(de),de!==Ie||de.tag!==5&&de.tag!==6)&&(de=null)):(oe=null,de=O),oe!==de)){if(he=M0,_e="onMouseLeave",K="onMouseEnter",G="mouse",(r==="pointerout"||r==="pointerover")&&(he=z0,_e="onPointerLeave",K="onPointerEnter",G="pointer"),Ie=oe==null?L:Su(oe),ee=de==null?L:Su(de),L=new he(_e,G+"leave",oe,o,U),L.target=Ie,L.relatedTarget=ee,_e=null,Qo(U)===O&&(he=new he(K,G+"enter",de,o,U),he.target=ee,he.relatedTarget=Ie,_e=he),Ie=_e,oe&&de)t:{for(he=oe,K=de,G=0,ee=he;ee;ee=du(ee))G++;for(ee=0,_e=K;_e;_e=du(_e))ee++;for(;0<G-ee;)he=du(he),G--;for(;0<ee-G;)K=du(K),ee--;for(;G--;){if(he===K||K!==null&&he===K.alternate)break t;he=du(he),K=du(K)}he=null}else he=null;oe!==null&&$0(j,L,oe,he,!1),de!==null&&Ie!==null&&$0(j,Ie,de,he,!0)}}e:{if(L=O?Su(O):window,oe=L.nodeName&&L.nodeName.toLowerCase(),oe==="select"||oe==="input"&&L.type==="file")var Se=lI;else if(R0(L))if(V1)Se=dI;else{Se=cI;var Te=uI}else(oe=L.nodeName)&&oe.toLowerCase()==="input"&&(L.type==="checkbox"||L.type==="radio")&&(Se=hI);if(Se&&(Se=Se(r,O))){j1(j,Se,o,U);break e}Te&&Te(r,L,O),r==="focusout"&&(Te=L._wrapperState)&&Te.controlled&&L.type==="number"&&py(L,"number",L.value)}switch(Te=O?Su(O):window,r){case"focusin":(R0(Te)||Te.contentEditable==="true")&&(wu=Te,Ty=O,Ch=null);break;case"focusout":Ch=Ty=wu=null;break;case"mousedown":Iy=!0;break;case"contextmenu":case"mouseup":case"dragend":Iy=!1,j0(j,o,U);break;case"selectionchange":if(mI)break;case"keydown":case"keyup":j0(j,o,U)}var xe;if($_)e:{switch(r){case"compositionstart":var Pe="onCompositionStart";break e;case"compositionend":Pe="onCompositionEnd";break e;case"compositionupdate":Pe="onCompositionUpdate";break e}Pe=void 0}else xu?O1(r,o)&&(Pe="onCompositionEnd"):r==="keydown"&&o.keyCode===229&&(Pe="onCompositionStart");Pe&&(F1&&o.locale!=="ko"&&(xu||Pe!=="onCompositionStart"?Pe==="onCompositionEnd"&&xu&&(xe=B1()):(Qa=U,j_="value"in Qa?Qa.value:Qa.textContent,xu=!0)),Te=xf(O,Pe),0<Te.length&&(Pe=new A0(Pe,r,null,o,U),j.push({event:Pe,listeners:Te}),xe?Pe.data=xe:(xe=N1(o),xe!==null&&(Pe.data=xe)))),(xe=nI?iI(r,o):sI(r,o))&&(O=xf(O,"onBeforeInput"),0<O.length&&(U=new A0("onBeforeInput","beforeinput",null,o,U),j.push({event:U,listeners:O}),U.data=xe))}Y1(j,n)})}function Kh(r,n,o){return{instance:r,listener:n,currentTarget:o}}function xf(r,n){for(var o=n+"Capture",h=[];r!==null;){var g=r,x=g.stateNode;g.tag===5&&x!==null&&(g=x,x=Vh(r,o),x!=null&&h.unshift(Kh(r,x,g)),x=Vh(r,n),x!=null&&h.push(Kh(r,x,g))),r=r.return}return h}function du(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function $0(r,n,o,h,g){for(var x=n._reactName,v=[];o!==null&&o!==h;){var u=o,C=u.alternate,O=u.stateNode;if(C!==null&&C===h)break;u.tag===5&&O!==null&&(u=O,g?(C=Vh(o,x),C!=null&&v.unshift(Kh(o,C,u))):g||(C=Vh(o,x),C!=null&&v.push(Kh(o,C,u)))),o=o.return}v.length!==0&&r.push({event:n,listeners:v})}var vI=/\r\n?/g,xI=/\u0000|\uFFFD/g;function q0(r){return(typeof r=="string"?r:""+r).replace(vI,`
`).replace(xI,"")}function Cp(r,n,o){if(n=q0(n),q0(r)!==n&&o)throw Error(Re(425))}function wf(){}var Ey=null,Py=null;function Cy(r,n){return r==="textarea"||r==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var My=typeof setTimeout=="function"?setTimeout:void 0,wI=typeof clearTimeout=="function"?clearTimeout:void 0,Z0=typeof Promise=="function"?Promise:void 0,bI=typeof queueMicrotask=="function"?queueMicrotask:typeof Z0<"u"?function(r){return Z0.resolve(null).then(r).catch(SI)}:My;function SI(r){setTimeout(function(){throw r})}function jg(r,n){var o=n,h=0;do{var g=o.nextSibling;if(r.removeChild(o),g&&g.nodeType===8)if(o=g.data,o==="/$"){if(h===0){r.removeChild(g),qh(n);return}h--}else o!=="$"&&o!=="$?"&&o!=="$!"||h++;o=g}while(o);qh(n)}function io(r){for(;r!=null;r=r.nextSibling){var n=r.nodeType;if(n===1||n===3)break;if(n===8){if(n=r.data,n==="$"||n==="$!"||n==="$?")break;if(n==="/$")return null}}return r}function G0(r){r=r.previousSibling;for(var n=0;r;){if(r.nodeType===8){var o=r.data;if(o==="$"||o==="$!"||o==="$?"){if(n===0)return r;n--}else o==="/$"&&n++}r=r.previousSibling}return null}var Wu=Math.random().toString(36).slice(2),Ss="__reactFiber$"+Wu,Wh="__reactProps$"+Wu,sa="__reactContainer$"+Wu,Ay="__reactEvents$"+Wu,kI="__reactListeners$"+Wu,TI="__reactHandles$"+Wu;function Qo(r){var n=r[Ss];if(n)return n;for(var o=r.parentNode;o;){if(n=o[sa]||o[Ss]){if(o=n.alternate,n.child!==null||o!==null&&o.child!==null)for(r=G0(r);r!==null;){if(o=r[Ss])return o;r=G0(r)}return n}r=o,o=r.parentNode}return null}function dd(r){return r=r[Ss]||r[sa],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function Su(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(Re(33))}function Xf(r){return r[Wh]||null}var zy=[],ku=-1;function go(r){return{current:r}}function pr(r){0>ku||(r.current=zy[ku],zy[ku]=null,ku--)}function or(r,n){ku++,zy[ku]=r.current,r.current=n}var co={},Pn=go(co),ti=go(!1),ll=co;function ju(r,n){var o=r.type.contextTypes;if(!o)return co;var h=r.stateNode;if(h&&h.__reactInternalMemoizedUnmaskedChildContext===n)return h.__reactInternalMemoizedMaskedChildContext;var g={},x;for(x in o)g[x]=n[x];return h&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=n,r.__reactInternalMemoizedMaskedChildContext=g),g}function ri(r){return r=r.childContextTypes,r!=null}function bf(){pr(ti),pr(Pn)}function H0(r,n,o){if(Pn.current!==co)throw Error(Re(168));or(Pn,n),or(ti,o)}function Q1(r,n,o){var h=r.stateNode;if(n=n.childContextTypes,typeof h.getChildContext!="function")return o;h=h.getChildContext();for(var g in h)if(!(g in n))throw Error(Re(108,uT(r)||"Unknown",g));return kr({},o,h)}function Sf(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||co,ll=Pn.current,or(Pn,r),or(ti,ti.current),!0}function K0(r,n,o){var h=r.stateNode;if(!h)throw Error(Re(169));o?(r=Q1(r,n,ll),h.__reactInternalMemoizedMergedChildContext=r,pr(ti),pr(Pn),or(Pn,r)):pr(ti),or(ti,o)}var Ws=null,Yf=!1,Vg=!1;function eb(r){Ws===null?Ws=[r]:Ws.push(r)}function II(r){Yf=!0,eb(r)}function yo(){if(!Vg&&Ws!==null){Vg=!0;var r=0,n=Qt;try{var o=Ws;for(Qt=1;r<o.length;r++){var h=o[r];do h=h(!0);while(h!==null)}Ws=null,Yf=!1}catch(g){throw Ws!==null&&(Ws=Ws.slice(r+1)),T1(B_,yo),g}finally{Qt=n,Vg=!1}}return null}var Tu=[],Iu=0,kf=null,Tf=0,Oi=[],Ni=0,ul=null,Js=1,Qs="";function Yo(r,n){Tu[Iu++]=Tf,Tu[Iu++]=kf,kf=r,Tf=n}function tb(r,n,o){Oi[Ni++]=Js,Oi[Ni++]=Qs,Oi[Ni++]=ul,ul=r;var h=Js;r=Qs;var g=32-rs(h)-1;h&=~(1<<g),o+=1;var x=32-rs(n)+g;if(30<x){var v=g-g%5;x=(h&(1<<v)-1).toString(32),h>>=v,g-=v,Js=1<<32-rs(n)+g|o<<g|h,Qs=x+r}else Js=1<<x|o<<g|h,Qs=r}function Z_(r){r.return!==null&&(Yo(r,1),tb(r,1,0))}function G_(r){for(;r===kf;)kf=Tu[--Iu],Tu[Iu]=null,Tf=Tu[--Iu],Tu[Iu]=null;for(;r===ul;)ul=Oi[--Ni],Oi[Ni]=null,Qs=Oi[--Ni],Oi[Ni]=null,Js=Oi[--Ni],Oi[Ni]=null}var Si=null,bi=null,_r=!1,ts=null;function rb(r,n){var o=ji(5,null,null,0);o.elementType="DELETED",o.stateNode=n,o.return=r,n=r.deletions,n===null?(r.deletions=[o],r.flags|=16):n.push(o)}function W0(r,n){switch(r.tag){case 5:var o=r.type;return n=n.nodeType!==1||o.toLowerCase()!==n.nodeName.toLowerCase()?null:n,n!==null?(r.stateNode=n,Si=r,bi=io(n.firstChild),!0):!1;case 6:return n=r.pendingProps===""||n.nodeType!==3?null:n,n!==null?(r.stateNode=n,Si=r,bi=null,!0):!1;case 13:return n=n.nodeType!==8?null:n,n!==null?(o=ul!==null?{id:Js,overflow:Qs}:null,r.memoizedState={dehydrated:n,treeContext:o,retryLane:1073741824},o=ji(18,null,null,0),o.stateNode=n,o.return=r,r.child=o,Si=r,bi=null,!0):!1;default:return!1}}function Dy(r){return(r.mode&1)!==0&&(r.flags&128)===0}function Ly(r){if(_r){var n=bi;if(n){var o=n;if(!W0(r,n)){if(Dy(r))throw Error(Re(418));n=io(o.nextSibling);var h=Si;n&&W0(r,n)?rb(h,o):(r.flags=r.flags&-4097|2,_r=!1,Si=r)}}else{if(Dy(r))throw Error(Re(418));r.flags=r.flags&-4097|2,_r=!1,Si=r}}}function X0(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;Si=r}function Mp(r){if(r!==Si)return!1;if(!_r)return X0(r),_r=!0,!1;var n;if((n=r.tag!==3)&&!(n=r.tag!==5)&&(n=r.type,n=n!=="head"&&n!=="body"&&!Cy(r.type,r.memoizedProps)),n&&(n=bi)){if(Dy(r))throw nb(),Error(Re(418));for(;n;)rb(r,n),n=io(n.nextSibling)}if(X0(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(Re(317));e:{for(r=r.nextSibling,n=0;r;){if(r.nodeType===8){var o=r.data;if(o==="/$"){if(n===0){bi=io(r.nextSibling);break e}n--}else o!=="$"&&o!=="$!"&&o!=="$?"||n++}r=r.nextSibling}bi=null}}else bi=Si?io(r.stateNode.nextSibling):null;return!0}function nb(){for(var r=bi;r;)r=io(r.nextSibling)}function Vu(){bi=Si=null,_r=!1}function H_(r){ts===null?ts=[r]:ts.push(r)}var EI=ua.ReactCurrentBatchConfig;function hh(r,n,o){if(r=o.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(o._owner){if(o=o._owner,o){if(o.tag!==1)throw Error(Re(309));var h=o.stateNode}if(!h)throw Error(Re(147,r));var g=h,x=""+r;return n!==null&&n.ref!==null&&typeof n.ref=="function"&&n.ref._stringRef===x?n.ref:(n=function(v){var u=g.refs;v===null?delete u[x]:u[x]=v},n._stringRef=x,n)}if(typeof r!="string")throw Error(Re(284));if(!o._owner)throw Error(Re(290,r))}return r}function Ap(r,n){throw r=Object.prototype.toString.call(n),Error(Re(31,r==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":r))}function Y0(r){var n=r._init;return n(r._payload)}function ib(r){function n(K,G){if(r){var ee=K.deletions;ee===null?(K.deletions=[G],K.flags|=16):ee.push(G)}}function o(K,G){if(!r)return null;for(;G!==null;)n(K,G),G=G.sibling;return null}function h(K,G){for(K=new Map;G!==null;)G.key!==null?K.set(G.key,G):K.set(G.index,G),G=G.sibling;return K}function g(K,G){return K=lo(K,G),K.index=0,K.sibling=null,K}function x(K,G,ee){return K.index=ee,r?(ee=K.alternate,ee!==null?(ee=ee.index,ee<G?(K.flags|=2,G):ee):(K.flags|=2,G)):(K.flags|=1048576,G)}function v(K){return r&&K.alternate===null&&(K.flags|=2),K}function u(K,G,ee,_e){return G===null||G.tag!==6?(G=Kg(ee,K.mode,_e),G.return=K,G):(G=g(G,ee),G.return=K,G)}function C(K,G,ee,_e){var Se=ee.type;return Se===vu?U(K,G,ee.props.children,_e,ee.key):G!==null&&(G.elementType===Se||typeof Se=="object"&&Se!==null&&Se.$$typeof===Ha&&Y0(Se)===G.type)?(_e=g(G,ee.props),_e.ref=hh(K,G,ee),_e.return=K,_e):(_e=sf(ee.type,ee.key,ee.props,null,K.mode,_e),_e.ref=hh(K,G,ee),_e.return=K,_e)}function O(K,G,ee,_e){return G===null||G.tag!==4||G.stateNode.containerInfo!==ee.containerInfo||G.stateNode.implementation!==ee.implementation?(G=Wg(ee,K.mode,_e),G.return=K,G):(G=g(G,ee.children||[]),G.return=K,G)}function U(K,G,ee,_e,Se){return G===null||G.tag!==7?(G=il(ee,K.mode,_e,Se),G.return=K,G):(G=g(G,ee),G.return=K,G)}function j(K,G,ee){if(typeof G=="string"&&G!==""||typeof G=="number")return G=Kg(""+G,K.mode,ee),G.return=K,G;if(typeof G=="object"&&G!==null){switch(G.$$typeof){case xp:return ee=sf(G.type,G.key,G.props,null,K.mode,ee),ee.ref=hh(K,null,G),ee.return=K,ee;case _u:return G=Wg(G,K.mode,ee),G.return=K,G;case Ha:var _e=G._init;return j(K,_e(G._payload),ee)}if(_h(G)||ah(G))return G=il(G,K.mode,ee,null),G.return=K,G;Ap(K,G)}return null}function L(K,G,ee,_e){var Se=G!==null?G.key:null;if(typeof ee=="string"&&ee!==""||typeof ee=="number")return Se!==null?null:u(K,G,""+ee,_e);if(typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case xp:return ee.key===Se?C(K,G,ee,_e):null;case _u:return ee.key===Se?O(K,G,ee,_e):null;case Ha:return Se=ee._init,L(K,G,Se(ee._payload),_e)}if(_h(ee)||ah(ee))return Se!==null?null:U(K,G,ee,_e,null);Ap(K,ee)}return null}function oe(K,G,ee,_e,Se){if(typeof _e=="string"&&_e!==""||typeof _e=="number")return K=K.get(ee)||null,u(G,K,""+_e,Se);if(typeof _e=="object"&&_e!==null){switch(_e.$$typeof){case xp:return K=K.get(_e.key===null?ee:_e.key)||null,C(G,K,_e,Se);case _u:return K=K.get(_e.key===null?ee:_e.key)||null,O(G,K,_e,Se);case Ha:var Te=_e._init;return oe(K,G,ee,Te(_e._payload),Se)}if(_h(_e)||ah(_e))return K=K.get(ee)||null,U(G,K,_e,Se,null);Ap(G,_e)}return null}function de(K,G,ee,_e){for(var Se=null,Te=null,xe=G,Pe=G=0,Ce=null;xe!==null&&Pe<ee.length;Pe++){xe.index>Pe?(Ce=xe,xe=null):Ce=xe.sibling;var rt=L(K,xe,ee[Pe],_e);if(rt===null){xe===null&&(xe=Ce);break}r&&xe&&rt.alternate===null&&n(K,xe),G=x(rt,G,Pe),Te===null?Se=rt:Te.sibling=rt,Te=rt,xe=Ce}if(Pe===ee.length)return o(K,xe),_r&&Yo(K,Pe),Se;if(xe===null){for(;Pe<ee.length;Pe++)xe=j(K,ee[Pe],_e),xe!==null&&(G=x(xe,G,Pe),Te===null?Se=xe:Te.sibling=xe,Te=xe);return _r&&Yo(K,Pe),Se}for(xe=h(K,xe);Pe<ee.length;Pe++)Ce=oe(xe,K,Pe,ee[Pe],_e),Ce!==null&&(r&&Ce.alternate!==null&&xe.delete(Ce.key===null?Pe:Ce.key),G=x(Ce,G,Pe),Te===null?Se=Ce:Te.sibling=Ce,Te=Ce);return r&&xe.forEach(function(Ye){return n(K,Ye)}),_r&&Yo(K,Pe),Se}function he(K,G,ee,_e){var Se=ah(ee);if(typeof Se!="function")throw Error(Re(150));if(ee=Se.call(ee),ee==null)throw Error(Re(151));for(var Te=Se=null,xe=G,Pe=G=0,Ce=null,rt=ee.next();xe!==null&&!rt.done;Pe++,rt=ee.next()){xe.index>Pe?(Ce=xe,xe=null):Ce=xe.sibling;var Ye=L(K,xe,rt.value,_e);if(Ye===null){xe===null&&(xe=Ce);break}r&&xe&&Ye.alternate===null&&n(K,xe),G=x(Ye,G,Pe),Te===null?Se=Ye:Te.sibling=Ye,Te=Ye,xe=Ce}if(rt.done)return o(K,xe),_r&&Yo(K,Pe),Se;if(xe===null){for(;!rt.done;Pe++,rt=ee.next())rt=j(K,rt.value,_e),rt!==null&&(G=x(rt,G,Pe),Te===null?Se=rt:Te.sibling=rt,Te=rt);return _r&&Yo(K,Pe),Se}for(xe=h(K,xe);!rt.done;Pe++,rt=ee.next())rt=oe(xe,K,Pe,rt.value,_e),rt!==null&&(r&&rt.alternate!==null&&xe.delete(rt.key===null?Pe:rt.key),G=x(rt,G,Pe),Te===null?Se=rt:Te.sibling=rt,Te=rt);return r&&xe.forEach(function(Wt){return n(K,Wt)}),_r&&Yo(K,Pe),Se}function Ie(K,G,ee,_e){if(typeof ee=="object"&&ee!==null&&ee.type===vu&&ee.key===null&&(ee=ee.props.children),typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case xp:e:{for(var Se=ee.key,Te=G;Te!==null;){if(Te.key===Se){if(Se=ee.type,Se===vu){if(Te.tag===7){o(K,Te.sibling),G=g(Te,ee.props.children),G.return=K,K=G;break e}}else if(Te.elementType===Se||typeof Se=="object"&&Se!==null&&Se.$$typeof===Ha&&Y0(Se)===Te.type){o(K,Te.sibling),G=g(Te,ee.props),G.ref=hh(K,Te,ee),G.return=K,K=G;break e}o(K,Te);break}else n(K,Te);Te=Te.sibling}ee.type===vu?(G=il(ee.props.children,K.mode,_e,ee.key),G.return=K,K=G):(_e=sf(ee.type,ee.key,ee.props,null,K.mode,_e),_e.ref=hh(K,G,ee),_e.return=K,K=_e)}return v(K);case _u:e:{for(Te=ee.key;G!==null;){if(G.key===Te)if(G.tag===4&&G.stateNode.containerInfo===ee.containerInfo&&G.stateNode.implementation===ee.implementation){o(K,G.sibling),G=g(G,ee.children||[]),G.return=K,K=G;break e}else{o(K,G);break}else n(K,G);G=G.sibling}G=Wg(ee,K.mode,_e),G.return=K,K=G}return v(K);case Ha:return Te=ee._init,Ie(K,G,Te(ee._payload),_e)}if(_h(ee))return de(K,G,ee,_e);if(ah(ee))return he(K,G,ee,_e);Ap(K,ee)}return typeof ee=="string"&&ee!==""||typeof ee=="number"?(ee=""+ee,G!==null&&G.tag===6?(o(K,G.sibling),G=g(G,ee),G.return=K,K=G):(o(K,G),G=Kg(ee,K.mode,_e),G.return=K,K=G),v(K)):o(K,G)}return Ie}var Uu=ib(!0),sb=ib(!1),If=go(null),Ef=null,Eu=null,K_=null;function W_(){K_=Eu=Ef=null}function X_(r){var n=If.current;pr(If),r._currentValue=n}function Ry(r,n,o){for(;r!==null;){var h=r.alternate;if((r.childLanes&n)!==n?(r.childLanes|=n,h!==null&&(h.childLanes|=n)):h!==null&&(h.childLanes&n)!==n&&(h.childLanes|=n),r===o)break;r=r.return}}function Lu(r,n){Ef=r,K_=Eu=null,r=r.dependencies,r!==null&&r.firstContext!==null&&(r.lanes&n&&(ei=!0),r.firstContext=null)}function Ui(r){var n=r._currentValue;if(K_!==r)if(r={context:r,memoizedValue:n,next:null},Eu===null){if(Ef===null)throw Error(Re(308));Eu=r,Ef.dependencies={lanes:0,firstContext:r}}else Eu=Eu.next=r;return n}var el=null;function Y_(r){el===null?el=[r]:el.push(r)}function ab(r,n,o,h){var g=n.interleaved;return g===null?(o.next=o,Y_(n)):(o.next=g.next,g.next=o),n.interleaved=o,aa(r,h)}function aa(r,n){r.lanes|=n;var o=r.alternate;for(o!==null&&(o.lanes|=n),o=r,r=r.return;r!==null;)r.childLanes|=n,o=r.alternate,o!==null&&(o.childLanes|=n),o=r,r=r.return;return o.tag===3?o.stateNode:null}var Ka=!1;function J_(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function ob(r,n){r=r.updateQueue,n.updateQueue===r&&(n.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function ta(r,n){return{eventTime:r,lane:n,tag:0,payload:null,callback:null,next:null}}function so(r,n,o){var h=r.updateQueue;if(h===null)return null;if(h=h.shared,Vt&2){var g=h.pending;return g===null?n.next=n:(n.next=g.next,g.next=n),h.pending=n,aa(r,o)}return g=h.interleaved,g===null?(n.next=n,Y_(h)):(n.next=g.next,g.next=n),h.interleaved=n,aa(r,o)}function Jp(r,n,o){if(n=n.updateQueue,n!==null&&(n=n.shared,(o&4194240)!==0)){var h=n.lanes;h&=r.pendingLanes,o|=h,n.lanes=o,F_(r,o)}}function J0(r,n){var o=r.updateQueue,h=r.alternate;if(h!==null&&(h=h.updateQueue,o===h)){var g=null,x=null;if(o=o.firstBaseUpdate,o!==null){do{var v={eventTime:o.eventTime,lane:o.lane,tag:o.tag,payload:o.payload,callback:o.callback,next:null};x===null?g=x=v:x=x.next=v,o=o.next}while(o!==null);x===null?g=x=n:x=x.next=n}else g=x=n;o={baseState:h.baseState,firstBaseUpdate:g,lastBaseUpdate:x,shared:h.shared,effects:h.effects},r.updateQueue=o;return}r=o.lastBaseUpdate,r===null?o.firstBaseUpdate=n:r.next=n,o.lastBaseUpdate=n}function Pf(r,n,o,h){var g=r.updateQueue;Ka=!1;var x=g.firstBaseUpdate,v=g.lastBaseUpdate,u=g.shared.pending;if(u!==null){g.shared.pending=null;var C=u,O=C.next;C.next=null,v===null?x=O:v.next=O,v=C;var U=r.alternate;U!==null&&(U=U.updateQueue,u=U.lastBaseUpdate,u!==v&&(u===null?U.firstBaseUpdate=O:u.next=O,U.lastBaseUpdate=C))}if(x!==null){var j=g.baseState;v=0,U=O=C=null,u=x;do{var L=u.lane,oe=u.eventTime;if((h&L)===L){U!==null&&(U=U.next={eventTime:oe,lane:0,tag:u.tag,payload:u.payload,callback:u.callback,next:null});e:{var de=r,he=u;switch(L=n,oe=o,he.tag){case 1:if(de=he.payload,typeof de=="function"){j=de.call(oe,j,L);break e}j=de;break e;case 3:de.flags=de.flags&-65537|128;case 0:if(de=he.payload,L=typeof de=="function"?de.call(oe,j,L):de,L==null)break e;j=kr({},j,L);break e;case 2:Ka=!0}}u.callback!==null&&u.lane!==0&&(r.flags|=64,L=g.effects,L===null?g.effects=[u]:L.push(u))}else oe={eventTime:oe,lane:L,tag:u.tag,payload:u.payload,callback:u.callback,next:null},U===null?(O=U=oe,C=j):U=U.next=oe,v|=L;if(u=u.next,u===null){if(u=g.shared.pending,u===null)break;L=u,u=L.next,L.next=null,g.lastBaseUpdate=L,g.shared.pending=null}}while(!0);if(U===null&&(C=j),g.baseState=C,g.firstBaseUpdate=O,g.lastBaseUpdate=U,n=g.shared.interleaved,n!==null){g=n;do v|=g.lane,g=g.next;while(g!==n)}else x===null&&(g.shared.lanes=0);hl|=v,r.lanes=v,r.memoizedState=j}}function Q0(r,n,o){if(r=n.effects,n.effects=null,r!==null)for(n=0;n<r.length;n++){var h=r[n],g=h.callback;if(g!==null){if(h.callback=null,h=o,typeof g!="function")throw Error(Re(191,g));g.call(h)}}}var pd={},Ts=go(pd),Xh=go(pd),Yh=go(pd);function tl(r){if(r===pd)throw Error(Re(174));return r}function Q_(r,n){switch(or(Yh,n),or(Xh,r),or(Ts,pd),r=n.nodeType,r){case 9:case 11:n=(n=n.documentElement)?n.namespaceURI:my(null,"");break;default:r=r===8?n.parentNode:n,n=r.namespaceURI||null,r=r.tagName,n=my(n,r)}pr(Ts),or(Ts,n)}function $u(){pr(Ts),pr(Xh),pr(Yh)}function lb(r){tl(Yh.current);var n=tl(Ts.current),o=my(n,r.type);n!==o&&(or(Xh,r),or(Ts,o))}function ev(r){Xh.current===r&&(pr(Ts),pr(Xh))}var br=go(0);function Cf(r){for(var n=r;n!==null;){if(n.tag===13){var o=n.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||o.data==="$?"||o.data==="$!"))return n}else if(n.tag===19&&n.memoizedProps.revealOrder!==void 0){if(n.flags&128)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===r)break;for(;n.sibling===null;){if(n.return===null||n.return===r)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var Ug=[];function tv(){for(var r=0;r<Ug.length;r++)Ug[r]._workInProgressVersionPrimary=null;Ug.length=0}var Qp=ua.ReactCurrentDispatcher,$g=ua.ReactCurrentBatchConfig,cl=0,Sr=null,Ur=null,en=null,Mf=!1,Mh=!1,Jh=0,PI=0;function Sn(){throw Error(Re(321))}function rv(r,n){if(n===null)return!1;for(var o=0;o<n.length&&o<r.length;o++)if(!ss(r[o],n[o]))return!1;return!0}function nv(r,n,o,h,g,x){if(cl=x,Sr=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,Qp.current=r===null||r.memoizedState===null?zI:DI,r=o(h,g),Mh){x=0;do{if(Mh=!1,Jh=0,25<=x)throw Error(Re(301));x+=1,en=Ur=null,n.updateQueue=null,Qp.current=LI,r=o(h,g)}while(Mh)}if(Qp.current=Af,n=Ur!==null&&Ur.next!==null,cl=0,en=Ur=Sr=null,Mf=!1,n)throw Error(Re(300));return r}function iv(){var r=Jh!==0;return Jh=0,r}function ws(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return en===null?Sr.memoizedState=en=r:en=en.next=r,en}function $i(){if(Ur===null){var r=Sr.alternate;r=r!==null?r.memoizedState:null}else r=Ur.next;var n=en===null?Sr.memoizedState:en.next;if(n!==null)en=n,Ur=r;else{if(r===null)throw Error(Re(310));Ur=r,r={memoizedState:Ur.memoizedState,baseState:Ur.baseState,baseQueue:Ur.baseQueue,queue:Ur.queue,next:null},en===null?Sr.memoizedState=en=r:en=en.next=r}return en}function Qh(r,n){return typeof n=="function"?n(r):n}function qg(r){var n=$i(),o=n.queue;if(o===null)throw Error(Re(311));o.lastRenderedReducer=r;var h=Ur,g=h.baseQueue,x=o.pending;if(x!==null){if(g!==null){var v=g.next;g.next=x.next,x.next=v}h.baseQueue=g=x,o.pending=null}if(g!==null){x=g.next,h=h.baseState;var u=v=null,C=null,O=x;do{var U=O.lane;if((cl&U)===U)C!==null&&(C=C.next={lane:0,action:O.action,hasEagerState:O.hasEagerState,eagerState:O.eagerState,next:null}),h=O.hasEagerState?O.eagerState:r(h,O.action);else{var j={lane:U,action:O.action,hasEagerState:O.hasEagerState,eagerState:O.eagerState,next:null};C===null?(u=C=j,v=h):C=C.next=j,Sr.lanes|=U,hl|=U}O=O.next}while(O!==null&&O!==x);C===null?v=h:C.next=u,ss(h,n.memoizedState)||(ei=!0),n.memoizedState=h,n.baseState=v,n.baseQueue=C,o.lastRenderedState=h}if(r=o.interleaved,r!==null){g=r;do x=g.lane,Sr.lanes|=x,hl|=x,g=g.next;while(g!==r)}else g===null&&(o.lanes=0);return[n.memoizedState,o.dispatch]}function Zg(r){var n=$i(),o=n.queue;if(o===null)throw Error(Re(311));o.lastRenderedReducer=r;var h=o.dispatch,g=o.pending,x=n.memoizedState;if(g!==null){o.pending=null;var v=g=g.next;do x=r(x,v.action),v=v.next;while(v!==g);ss(x,n.memoizedState)||(ei=!0),n.memoizedState=x,n.baseQueue===null&&(n.baseState=x),o.lastRenderedState=x}return[x,h]}function ub(){}function cb(r,n){var o=Sr,h=$i(),g=n(),x=!ss(h.memoizedState,g);if(x&&(h.memoizedState=g,ei=!0),h=h.queue,sv(pb.bind(null,o,h,r),[r]),h.getSnapshot!==n||x||en!==null&&en.memoizedState.tag&1){if(o.flags|=2048,ed(9,db.bind(null,o,h,g,n),void 0,null),tn===null)throw Error(Re(349));cl&30||hb(o,n,g)}return g}function hb(r,n,o){r.flags|=16384,r={getSnapshot:n,value:o},n=Sr.updateQueue,n===null?(n={lastEffect:null,stores:null},Sr.updateQueue=n,n.stores=[r]):(o=n.stores,o===null?n.stores=[r]:o.push(r))}function db(r,n,o,h){n.value=o,n.getSnapshot=h,fb(n)&&mb(r)}function pb(r,n,o){return o(function(){fb(n)&&mb(r)})}function fb(r){var n=r.getSnapshot;r=r.value;try{var o=n();return!ss(r,o)}catch{return!0}}function mb(r){var n=aa(r,1);n!==null&&ns(n,r,1,-1)}function ew(r){var n=ws();return typeof r=="function"&&(r=r()),n.memoizedState=n.baseState=r,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Qh,lastRenderedState:r},n.queue=r,r=r.dispatch=AI.bind(null,Sr,r),[n.memoizedState,r]}function ed(r,n,o,h){return r={tag:r,create:n,destroy:o,deps:h,next:null},n=Sr.updateQueue,n===null?(n={lastEffect:null,stores:null},Sr.updateQueue=n,n.lastEffect=r.next=r):(o=n.lastEffect,o===null?n.lastEffect=r.next=r:(h=o.next,o.next=r,r.next=h,n.lastEffect=r)),r}function gb(){return $i().memoizedState}function ef(r,n,o,h){var g=ws();Sr.flags|=r,g.memoizedState=ed(1|n,o,void 0,h===void 0?null:h)}function Jf(r,n,o,h){var g=$i();h=h===void 0?null:h;var x=void 0;if(Ur!==null){var v=Ur.memoizedState;if(x=v.destroy,h!==null&&rv(h,v.deps)){g.memoizedState=ed(n,o,x,h);return}}Sr.flags|=r,g.memoizedState=ed(1|n,o,x,h)}function tw(r,n){return ef(8390656,8,r,n)}function sv(r,n){return Jf(2048,8,r,n)}function yb(r,n){return Jf(4,2,r,n)}function _b(r,n){return Jf(4,4,r,n)}function vb(r,n){if(typeof n=="function")return r=r(),n(r),function(){n(null)};if(n!=null)return r=r(),n.current=r,function(){n.current=null}}function xb(r,n,o){return o=o!=null?o.concat([r]):null,Jf(4,4,vb.bind(null,n,r),o)}function av(){}function wb(r,n){var o=$i();n=n===void 0?null:n;var h=o.memoizedState;return h!==null&&n!==null&&rv(n,h[1])?h[0]:(o.memoizedState=[r,n],r)}function bb(r,n){var o=$i();n=n===void 0?null:n;var h=o.memoizedState;return h!==null&&n!==null&&rv(n,h[1])?h[0]:(r=r(),o.memoizedState=[r,n],r)}function Sb(r,n,o){return cl&21?(ss(o,n)||(o=P1(),Sr.lanes|=o,hl|=o,r.baseState=!0),n):(r.baseState&&(r.baseState=!1,ei=!0),r.memoizedState=o)}function CI(r,n){var o=Qt;Qt=o!==0&&4>o?o:4,r(!0);var h=$g.transition;$g.transition={};try{r(!1),n()}finally{Qt=o,$g.transition=h}}function kb(){return $i().memoizedState}function MI(r,n,o){var h=oo(r);if(o={lane:h,action:o,hasEagerState:!1,eagerState:null,next:null},Tb(r))Ib(n,o);else if(o=ab(r,n,o,h),o!==null){var g=Nn();ns(o,r,h,g),Eb(o,n,h)}}function AI(r,n,o){var h=oo(r),g={lane:h,action:o,hasEagerState:!1,eagerState:null,next:null};if(Tb(r))Ib(n,g);else{var x=r.alternate;if(r.lanes===0&&(x===null||x.lanes===0)&&(x=n.lastRenderedReducer,x!==null))try{var v=n.lastRenderedState,u=x(v,o);if(g.hasEagerState=!0,g.eagerState=u,ss(u,v)){var C=n.interleaved;C===null?(g.next=g,Y_(n)):(g.next=C.next,C.next=g),n.interleaved=g;return}}catch{}finally{}o=ab(r,n,g,h),o!==null&&(g=Nn(),ns(o,r,h,g),Eb(o,n,h))}}function Tb(r){var n=r.alternate;return r===Sr||n!==null&&n===Sr}function Ib(r,n){Mh=Mf=!0;var o=r.pending;o===null?n.next=n:(n.next=o.next,o.next=n),r.pending=n}function Eb(r,n,o){if(o&4194240){var h=n.lanes;h&=r.pendingLanes,o|=h,n.lanes=o,F_(r,o)}}var Af={readContext:Ui,useCallback:Sn,useContext:Sn,useEffect:Sn,useImperativeHandle:Sn,useInsertionEffect:Sn,useLayoutEffect:Sn,useMemo:Sn,useReducer:Sn,useRef:Sn,useState:Sn,useDebugValue:Sn,useDeferredValue:Sn,useTransition:Sn,useMutableSource:Sn,useSyncExternalStore:Sn,useId:Sn,unstable_isNewReconciler:!1},zI={readContext:Ui,useCallback:function(r,n){return ws().memoizedState=[r,n===void 0?null:n],r},useContext:Ui,useEffect:tw,useImperativeHandle:function(r,n,o){return o=o!=null?o.concat([r]):null,ef(4194308,4,vb.bind(null,n,r),o)},useLayoutEffect:function(r,n){return ef(4194308,4,r,n)},useInsertionEffect:function(r,n){return ef(4,2,r,n)},useMemo:function(r,n){var o=ws();return n=n===void 0?null:n,r=r(),o.memoizedState=[r,n],r},useReducer:function(r,n,o){var h=ws();return n=o!==void 0?o(n):n,h.memoizedState=h.baseState=n,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:n},h.queue=r,r=r.dispatch=MI.bind(null,Sr,r),[h.memoizedState,r]},useRef:function(r){var n=ws();return r={current:r},n.memoizedState=r},useState:ew,useDebugValue:av,useDeferredValue:function(r){return ws().memoizedState=r},useTransition:function(){var r=ew(!1),n=r[0];return r=CI.bind(null,r[1]),ws().memoizedState=r,[n,r]},useMutableSource:function(){},useSyncExternalStore:function(r,n,o){var h=Sr,g=ws();if(_r){if(o===void 0)throw Error(Re(407));o=o()}else{if(o=n(),tn===null)throw Error(Re(349));cl&30||hb(h,n,o)}g.memoizedState=o;var x={value:o,getSnapshot:n};return g.queue=x,tw(pb.bind(null,h,x,r),[r]),h.flags|=2048,ed(9,db.bind(null,h,x,o,n),void 0,null),o},useId:function(){var r=ws(),n=tn.identifierPrefix;if(_r){var o=Qs,h=Js;o=(h&~(1<<32-rs(h)-1)).toString(32)+o,n=":"+n+"R"+o,o=Jh++,0<o&&(n+="H"+o.toString(32)),n+=":"}else o=PI++,n=":"+n+"r"+o.toString(32)+":";return r.memoizedState=n},unstable_isNewReconciler:!1},DI={readContext:Ui,useCallback:wb,useContext:Ui,useEffect:sv,useImperativeHandle:xb,useInsertionEffect:yb,useLayoutEffect:_b,useMemo:bb,useReducer:qg,useRef:gb,useState:function(){return qg(Qh)},useDebugValue:av,useDeferredValue:function(r){var n=$i();return Sb(n,Ur.memoizedState,r)},useTransition:function(){var r=qg(Qh)[0],n=$i().memoizedState;return[r,n]},useMutableSource:ub,useSyncExternalStore:cb,useId:kb,unstable_isNewReconciler:!1},LI={readContext:Ui,useCallback:wb,useContext:Ui,useEffect:sv,useImperativeHandle:xb,useInsertionEffect:yb,useLayoutEffect:_b,useMemo:bb,useReducer:Zg,useRef:gb,useState:function(){return Zg(Qh)},useDebugValue:av,useDeferredValue:function(r){var n=$i();return Ur===null?n.memoizedState=r:Sb(n,Ur.memoizedState,r)},useTransition:function(){var r=Zg(Qh)[0],n=$i().memoizedState;return[r,n]},useMutableSource:ub,useSyncExternalStore:cb,useId:kb,unstable_isNewReconciler:!1};function Qi(r,n){if(r&&r.defaultProps){n=kr({},n),r=r.defaultProps;for(var o in r)n[o]===void 0&&(n[o]=r[o]);return n}return n}function By(r,n,o,h){n=r.memoizedState,o=o(h,n),o=o==null?n:kr({},n,o),r.memoizedState=o,r.lanes===0&&(r.updateQueue.baseState=o)}var Qf={isMounted:function(r){return(r=r._reactInternals)?gl(r)===r:!1},enqueueSetState:function(r,n,o){r=r._reactInternals;var h=Nn(),g=oo(r),x=ta(h,g);x.payload=n,o!=null&&(x.callback=o),n=so(r,x,g),n!==null&&(ns(n,r,g,h),Jp(n,r,g))},enqueueReplaceState:function(r,n,o){r=r._reactInternals;var h=Nn(),g=oo(r),x=ta(h,g);x.tag=1,x.payload=n,o!=null&&(x.callback=o),n=so(r,x,g),n!==null&&(ns(n,r,g,h),Jp(n,r,g))},enqueueForceUpdate:function(r,n){r=r._reactInternals;var o=Nn(),h=oo(r),g=ta(o,h);g.tag=2,n!=null&&(g.callback=n),n=so(r,g,h),n!==null&&(ns(n,r,h,o),Jp(n,r,h))}};function rw(r,n,o,h,g,x,v){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(h,x,v):n.prototype&&n.prototype.isPureReactComponent?!Gh(o,h)||!Gh(g,x):!0}function Pb(r,n,o){var h=!1,g=co,x=n.contextType;return typeof x=="object"&&x!==null?x=Ui(x):(g=ri(n)?ll:Pn.current,h=n.contextTypes,x=(h=h!=null)?ju(r,g):co),n=new n(o,x),r.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,n.updater=Qf,r.stateNode=n,n._reactInternals=r,h&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=g,r.__reactInternalMemoizedMaskedChildContext=x),n}function nw(r,n,o,h){r=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(o,h),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(o,h),n.state!==r&&Qf.enqueueReplaceState(n,n.state,null)}function Fy(r,n,o,h){var g=r.stateNode;g.props=o,g.state=r.memoizedState,g.refs={},J_(r);var x=n.contextType;typeof x=="object"&&x!==null?g.context=Ui(x):(x=ri(n)?ll:Pn.current,g.context=ju(r,x)),g.state=r.memoizedState,x=n.getDerivedStateFromProps,typeof x=="function"&&(By(r,n,x,o),g.state=r.memoizedState),typeof n.getDerivedStateFromProps=="function"||typeof g.getSnapshotBeforeUpdate=="function"||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(n=g.state,typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount(),n!==g.state&&Qf.enqueueReplaceState(g,g.state,null),Pf(r,o,g,h),g.state=r.memoizedState),typeof g.componentDidMount=="function"&&(r.flags|=4194308)}function qu(r,n){try{var o="",h=n;do o+=lT(h),h=h.return;while(h);var g=o}catch(x){g=`
Error generating stack: `+x.message+`
`+x.stack}return{value:r,source:n,stack:g,digest:null}}function Gg(r,n,o){return{value:r,source:null,stack:o??null,digest:n??null}}function Oy(r,n){try{console.error(n.value)}catch(o){setTimeout(function(){throw o})}}var RI=typeof WeakMap=="function"?WeakMap:Map;function Cb(r,n,o){o=ta(-1,o),o.tag=3,o.payload={element:null};var h=n.value;return o.callback=function(){Df||(Df=!0,Ky=h),Oy(r,n)},o}function Mb(r,n,o){o=ta(-1,o),o.tag=3;var h=r.type.getDerivedStateFromError;if(typeof h=="function"){var g=n.value;o.payload=function(){return h(g)},o.callback=function(){Oy(r,n)}}var x=r.stateNode;return x!==null&&typeof x.componentDidCatch=="function"&&(o.callback=function(){Oy(r,n),typeof h!="function"&&(ao===null?ao=new Set([this]):ao.add(this));var v=n.stack;this.componentDidCatch(n.value,{componentStack:v!==null?v:""})}),o}function iw(r,n,o){var h=r.pingCache;if(h===null){h=r.pingCache=new RI;var g=new Set;h.set(n,g)}else g=h.get(n),g===void 0&&(g=new Set,h.set(n,g));g.has(o)||(g.add(o),r=WI.bind(null,r,n,o),n.then(r,r))}function sw(r){do{var n;if((n=r.tag===13)&&(n=r.memoizedState,n=n!==null?n.dehydrated!==null:!0),n)return r;r=r.return}while(r!==null);return null}function aw(r,n,o,h,g){return r.mode&1?(r.flags|=65536,r.lanes=g,r):(r===n?r.flags|=65536:(r.flags|=128,o.flags|=131072,o.flags&=-52805,o.tag===1&&(o.alternate===null?o.tag=17:(n=ta(-1,1),n.tag=2,so(o,n,1))),o.lanes|=1),r)}var BI=ua.ReactCurrentOwner,ei=!1;function Fn(r,n,o,h){n.child=r===null?sb(n,null,o,h):Uu(n,r.child,o,h)}function ow(r,n,o,h,g){o=o.render;var x=n.ref;return Lu(n,g),h=nv(r,n,o,h,x,g),o=iv(),r!==null&&!ei?(n.updateQueue=r.updateQueue,n.flags&=-2053,r.lanes&=~g,oa(r,n,g)):(_r&&o&&Z_(n),n.flags|=1,Fn(r,n,h,g),n.child)}function lw(r,n,o,h,g){if(r===null){var x=o.type;return typeof x=="function"&&!fv(x)&&x.defaultProps===void 0&&o.compare===null&&o.defaultProps===void 0?(n.tag=15,n.type=x,Ab(r,n,x,h,g)):(r=sf(o.type,null,h,n,n.mode,g),r.ref=n.ref,r.return=n,n.child=r)}if(x=r.child,!(r.lanes&g)){var v=x.memoizedProps;if(o=o.compare,o=o!==null?o:Gh,o(v,h)&&r.ref===n.ref)return oa(r,n,g)}return n.flags|=1,r=lo(x,h),r.ref=n.ref,r.return=n,n.child=r}function Ab(r,n,o,h,g){if(r!==null){var x=r.memoizedProps;if(Gh(x,h)&&r.ref===n.ref)if(ei=!1,n.pendingProps=h=x,(r.lanes&g)!==0)r.flags&131072&&(ei=!0);else return n.lanes=r.lanes,oa(r,n,g)}return Ny(r,n,o,h,g)}function zb(r,n,o){var h=n.pendingProps,g=h.children,x=r!==null?r.memoizedState:null;if(h.mode==="hidden")if(!(n.mode&1))n.memoizedState={baseLanes:0,cachePool:null,transitions:null},or(Cu,xi),xi|=o;else{if(!(o&1073741824))return r=x!==null?x.baseLanes|o:o,n.lanes=n.childLanes=1073741824,n.memoizedState={baseLanes:r,cachePool:null,transitions:null},n.updateQueue=null,or(Cu,xi),xi|=r,null;n.memoizedState={baseLanes:0,cachePool:null,transitions:null},h=x!==null?x.baseLanes:o,or(Cu,xi),xi|=h}else x!==null?(h=x.baseLanes|o,n.memoizedState=null):h=o,or(Cu,xi),xi|=h;return Fn(r,n,g,o),n.child}function Db(r,n){var o=n.ref;(r===null&&o!==null||r!==null&&r.ref!==o)&&(n.flags|=512,n.flags|=2097152)}function Ny(r,n,o,h,g){var x=ri(o)?ll:Pn.current;return x=ju(n,x),Lu(n,g),o=nv(r,n,o,h,x,g),h=iv(),r!==null&&!ei?(n.updateQueue=r.updateQueue,n.flags&=-2053,r.lanes&=~g,oa(r,n,g)):(_r&&h&&Z_(n),n.flags|=1,Fn(r,n,o,g),n.child)}function uw(r,n,o,h,g){if(ri(o)){var x=!0;Sf(n)}else x=!1;if(Lu(n,g),n.stateNode===null)tf(r,n),Pb(n,o,h),Fy(n,o,h,g),h=!0;else if(r===null){var v=n.stateNode,u=n.memoizedProps;v.props=u;var C=v.context,O=o.contextType;typeof O=="object"&&O!==null?O=Ui(O):(O=ri(o)?ll:Pn.current,O=ju(n,O));var U=o.getDerivedStateFromProps,j=typeof U=="function"||typeof v.getSnapshotBeforeUpdate=="function";j||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(u!==h||C!==O)&&nw(n,v,h,O),Ka=!1;var L=n.memoizedState;v.state=L,Pf(n,h,v,g),C=n.memoizedState,u!==h||L!==C||ti.current||Ka?(typeof U=="function"&&(By(n,o,U,h),C=n.memoizedState),(u=Ka||rw(n,o,u,h,L,C,O))?(j||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount()),typeof v.componentDidMount=="function"&&(n.flags|=4194308)):(typeof v.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=h,n.memoizedState=C),v.props=h,v.state=C,v.context=O,h=u):(typeof v.componentDidMount=="function"&&(n.flags|=4194308),h=!1)}else{v=n.stateNode,ob(r,n),u=n.memoizedProps,O=n.type===n.elementType?u:Qi(n.type,u),v.props=O,j=n.pendingProps,L=v.context,C=o.contextType,typeof C=="object"&&C!==null?C=Ui(C):(C=ri(o)?ll:Pn.current,C=ju(n,C));var oe=o.getDerivedStateFromProps;(U=typeof oe=="function"||typeof v.getSnapshotBeforeUpdate=="function")||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(u!==j||L!==C)&&nw(n,v,h,C),Ka=!1,L=n.memoizedState,v.state=L,Pf(n,h,v,g);var de=n.memoizedState;u!==j||L!==de||ti.current||Ka?(typeof oe=="function"&&(By(n,o,oe,h),de=n.memoizedState),(O=Ka||rw(n,o,O,h,L,de,C)||!1)?(U||typeof v.UNSAFE_componentWillUpdate!="function"&&typeof v.componentWillUpdate!="function"||(typeof v.componentWillUpdate=="function"&&v.componentWillUpdate(h,de,C),typeof v.UNSAFE_componentWillUpdate=="function"&&v.UNSAFE_componentWillUpdate(h,de,C)),typeof v.componentDidUpdate=="function"&&(n.flags|=4),typeof v.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof v.componentDidUpdate!="function"||u===r.memoizedProps&&L===r.memoizedState||(n.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||u===r.memoizedProps&&L===r.memoizedState||(n.flags|=1024),n.memoizedProps=h,n.memoizedState=de),v.props=h,v.state=de,v.context=C,h=O):(typeof v.componentDidUpdate!="function"||u===r.memoizedProps&&L===r.memoizedState||(n.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||u===r.memoizedProps&&L===r.memoizedState||(n.flags|=1024),h=!1)}return jy(r,n,o,h,x,g)}function jy(r,n,o,h,g,x){Db(r,n);var v=(n.flags&128)!==0;if(!h&&!v)return g&&K0(n,o,!1),oa(r,n,x);h=n.stateNode,BI.current=n;var u=v&&typeof o.getDerivedStateFromError!="function"?null:h.render();return n.flags|=1,r!==null&&v?(n.child=Uu(n,r.child,null,x),n.child=Uu(n,null,u,x)):Fn(r,n,u,x),n.memoizedState=h.state,g&&K0(n,o,!0),n.child}function Lb(r){var n=r.stateNode;n.pendingContext?H0(r,n.pendingContext,n.pendingContext!==n.context):n.context&&H0(r,n.context,!1),Q_(r,n.containerInfo)}function cw(r,n,o,h,g){return Vu(),H_(g),n.flags|=256,Fn(r,n,o,h),n.child}var Vy={dehydrated:null,treeContext:null,retryLane:0};function Uy(r){return{baseLanes:r,cachePool:null,transitions:null}}function Rb(r,n,o){var h=n.pendingProps,g=br.current,x=!1,v=(n.flags&128)!==0,u;if((u=v)||(u=r!==null&&r.memoizedState===null?!1:(g&2)!==0),u?(x=!0,n.flags&=-129):(r===null||r.memoizedState!==null)&&(g|=1),or(br,g&1),r===null)return Ly(n),r=n.memoizedState,r!==null&&(r=r.dehydrated,r!==null)?(n.mode&1?r.data==="$!"?n.lanes=8:n.lanes=1073741824:n.lanes=1,null):(v=h.children,r=h.fallback,x?(h=n.mode,x=n.child,v={mode:"hidden",children:v},!(h&1)&&x!==null?(x.childLanes=0,x.pendingProps=v):x=rm(v,h,0,null),r=il(r,h,o,null),x.return=n,r.return=n,x.sibling=r,n.child=x,n.child.memoizedState=Uy(o),n.memoizedState=Vy,r):ov(n,v));if(g=r.memoizedState,g!==null&&(u=g.dehydrated,u!==null))return FI(r,n,v,h,u,g,o);if(x){x=h.fallback,v=n.mode,g=r.child,u=g.sibling;var C={mode:"hidden",children:h.children};return!(v&1)&&n.child!==g?(h=n.child,h.childLanes=0,h.pendingProps=C,n.deletions=null):(h=lo(g,C),h.subtreeFlags=g.subtreeFlags&14680064),u!==null?x=lo(u,x):(x=il(x,v,o,null),x.flags|=2),x.return=n,h.return=n,h.sibling=x,n.child=h,h=x,x=n.child,v=r.child.memoizedState,v=v===null?Uy(o):{baseLanes:v.baseLanes|o,cachePool:null,transitions:v.transitions},x.memoizedState=v,x.childLanes=r.childLanes&~o,n.memoizedState=Vy,h}return x=r.child,r=x.sibling,h=lo(x,{mode:"visible",children:h.children}),!(n.mode&1)&&(h.lanes=o),h.return=n,h.sibling=null,r!==null&&(o=n.deletions,o===null?(n.deletions=[r],n.flags|=16):o.push(r)),n.child=h,n.memoizedState=null,h}function ov(r,n){return n=rm({mode:"visible",children:n},r.mode,0,null),n.return=r,r.child=n}function zp(r,n,o,h){return h!==null&&H_(h),Uu(n,r.child,null,o),r=ov(n,n.pendingProps.children),r.flags|=2,n.memoizedState=null,r}function FI(r,n,o,h,g,x,v){if(o)return n.flags&256?(n.flags&=-257,h=Gg(Error(Re(422))),zp(r,n,v,h)):n.memoizedState!==null?(n.child=r.child,n.flags|=128,null):(x=h.fallback,g=n.mode,h=rm({mode:"visible",children:h.children},g,0,null),x=il(x,g,v,null),x.flags|=2,h.return=n,x.return=n,h.sibling=x,n.child=h,n.mode&1&&Uu(n,r.child,null,v),n.child.memoizedState=Uy(v),n.memoizedState=Vy,x);if(!(n.mode&1))return zp(r,n,v,null);if(g.data==="$!"){if(h=g.nextSibling&&g.nextSibling.dataset,h)var u=h.dgst;return h=u,x=Error(Re(419)),h=Gg(x,h,void 0),zp(r,n,v,h)}if(u=(v&r.childLanes)!==0,ei||u){if(h=tn,h!==null){switch(v&-v){case 4:g=2;break;case 16:g=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:g=32;break;case 536870912:g=268435456;break;default:g=0}g=g&(h.suspendedLanes|v)?0:g,g!==0&&g!==x.retryLane&&(x.retryLane=g,aa(r,g),ns(h,r,g,-1))}return pv(),h=Gg(Error(Re(421))),zp(r,n,v,h)}return g.data==="$?"?(n.flags|=128,n.child=r.child,n=XI.bind(null,r),g._reactRetry=n,null):(r=x.treeContext,bi=io(g.nextSibling),Si=n,_r=!0,ts=null,r!==null&&(Oi[Ni++]=Js,Oi[Ni++]=Qs,Oi[Ni++]=ul,Js=r.id,Qs=r.overflow,ul=n),n=ov(n,h.children),n.flags|=4096,n)}function hw(r,n,o){r.lanes|=n;var h=r.alternate;h!==null&&(h.lanes|=n),Ry(r.return,n,o)}function Hg(r,n,o,h,g){var x=r.memoizedState;x===null?r.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:h,tail:o,tailMode:g}:(x.isBackwards=n,x.rendering=null,x.renderingStartTime=0,x.last=h,x.tail=o,x.tailMode=g)}function Bb(r,n,o){var h=n.pendingProps,g=h.revealOrder,x=h.tail;if(Fn(r,n,h.children,o),h=br.current,h&2)h=h&1|2,n.flags|=128;else{if(r!==null&&r.flags&128)e:for(r=n.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&hw(r,o,n);else if(r.tag===19)hw(r,o,n);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===n)break e;for(;r.sibling===null;){if(r.return===null||r.return===n)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}h&=1}if(or(br,h),!(n.mode&1))n.memoizedState=null;else switch(g){case"forwards":for(o=n.child,g=null;o!==null;)r=o.alternate,r!==null&&Cf(r)===null&&(g=o),o=o.sibling;o=g,o===null?(g=n.child,n.child=null):(g=o.sibling,o.sibling=null),Hg(n,!1,g,o,x);break;case"backwards":for(o=null,g=n.child,n.child=null;g!==null;){if(r=g.alternate,r!==null&&Cf(r)===null){n.child=g;break}r=g.sibling,g.sibling=o,o=g,g=r}Hg(n,!0,o,null,x);break;case"together":Hg(n,!1,null,null,void 0);break;default:n.memoizedState=null}return n.child}function tf(r,n){!(n.mode&1)&&r!==null&&(r.alternate=null,n.alternate=null,n.flags|=2)}function oa(r,n,o){if(r!==null&&(n.dependencies=r.dependencies),hl|=n.lanes,!(o&n.childLanes))return null;if(r!==null&&n.child!==r.child)throw Error(Re(153));if(n.child!==null){for(r=n.child,o=lo(r,r.pendingProps),n.child=o,o.return=n;r.sibling!==null;)r=r.sibling,o=o.sibling=lo(r,r.pendingProps),o.return=n;o.sibling=null}return n.child}function OI(r,n,o){switch(n.tag){case 3:Lb(n),Vu();break;case 5:lb(n);break;case 1:ri(n.type)&&Sf(n);break;case 4:Q_(n,n.stateNode.containerInfo);break;case 10:var h=n.type._context,g=n.memoizedProps.value;or(If,h._currentValue),h._currentValue=g;break;case 13:if(h=n.memoizedState,h!==null)return h.dehydrated!==null?(or(br,br.current&1),n.flags|=128,null):o&n.child.childLanes?Rb(r,n,o):(or(br,br.current&1),r=oa(r,n,o),r!==null?r.sibling:null);or(br,br.current&1);break;case 19:if(h=(o&n.childLanes)!==0,r.flags&128){if(h)return Bb(r,n,o);n.flags|=128}if(g=n.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),or(br,br.current),h)break;return null;case 22:case 23:return n.lanes=0,zb(r,n,o)}return oa(r,n,o)}var Fb,$y,Ob,Nb;Fb=function(r,n){for(var o=n.child;o!==null;){if(o.tag===5||o.tag===6)r.appendChild(o.stateNode);else if(o.tag!==4&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===n)break;for(;o.sibling===null;){if(o.return===null||o.return===n)return;o=o.return}o.sibling.return=o.return,o=o.sibling}};$y=function(){};Ob=function(r,n,o,h){var g=r.memoizedProps;if(g!==h){r=n.stateNode,tl(Ts.current);var x=null;switch(o){case"input":g=hy(r,g),h=hy(r,h),x=[];break;case"select":g=kr({},g,{value:void 0}),h=kr({},h,{value:void 0}),x=[];break;case"textarea":g=fy(r,g),h=fy(r,h),x=[];break;default:typeof g.onClick!="function"&&typeof h.onClick=="function"&&(r.onclick=wf)}gy(o,h);var v;o=null;for(O in g)if(!h.hasOwnProperty(O)&&g.hasOwnProperty(O)&&g[O]!=null)if(O==="style"){var u=g[O];for(v in u)u.hasOwnProperty(v)&&(o||(o={}),o[v]="")}else O!=="dangerouslySetInnerHTML"&&O!=="children"&&O!=="suppressContentEditableWarning"&&O!=="suppressHydrationWarning"&&O!=="autoFocus"&&(Nh.hasOwnProperty(O)?x||(x=[]):(x=x||[]).push(O,null));for(O in h){var C=h[O];if(u=g!=null?g[O]:void 0,h.hasOwnProperty(O)&&C!==u&&(C!=null||u!=null))if(O==="style")if(u){for(v in u)!u.hasOwnProperty(v)||C&&C.hasOwnProperty(v)||(o||(o={}),o[v]="");for(v in C)C.hasOwnProperty(v)&&u[v]!==C[v]&&(o||(o={}),o[v]=C[v])}else o||(x||(x=[]),x.push(O,o)),o=C;else O==="dangerouslySetInnerHTML"?(C=C?C.__html:void 0,u=u?u.__html:void 0,C!=null&&u!==C&&(x=x||[]).push(O,C)):O==="children"?typeof C!="string"&&typeof C!="number"||(x=x||[]).push(O,""+C):O!=="suppressContentEditableWarning"&&O!=="suppressHydrationWarning"&&(Nh.hasOwnProperty(O)?(C!=null&&O==="onScroll"&&hr("scroll",r),x||u===C||(x=[])):(x=x||[]).push(O,C))}o&&(x=x||[]).push("style",o);var O=x;(n.updateQueue=O)&&(n.flags|=4)}};Nb=function(r,n,o,h){o!==h&&(n.flags|=4)};function dh(r,n){if(!_r)switch(r.tailMode){case"hidden":n=r.tail;for(var o=null;n!==null;)n.alternate!==null&&(o=n),n=n.sibling;o===null?r.tail=null:o.sibling=null;break;case"collapsed":o=r.tail;for(var h=null;o!==null;)o.alternate!==null&&(h=o),o=o.sibling;h===null?n||r.tail===null?r.tail=null:r.tail.sibling=null:h.sibling=null}}function kn(r){var n=r.alternate!==null&&r.alternate.child===r.child,o=0,h=0;if(n)for(var g=r.child;g!==null;)o|=g.lanes|g.childLanes,h|=g.subtreeFlags&14680064,h|=g.flags&14680064,g.return=r,g=g.sibling;else for(g=r.child;g!==null;)o|=g.lanes|g.childLanes,h|=g.subtreeFlags,h|=g.flags,g.return=r,g=g.sibling;return r.subtreeFlags|=h,r.childLanes=o,n}function NI(r,n,o){var h=n.pendingProps;switch(G_(n),n.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return kn(n),null;case 1:return ri(n.type)&&bf(),kn(n),null;case 3:return h=n.stateNode,$u(),pr(ti),pr(Pn),tv(),h.pendingContext&&(h.context=h.pendingContext,h.pendingContext=null),(r===null||r.child===null)&&(Mp(n)?n.flags|=4:r===null||r.memoizedState.isDehydrated&&!(n.flags&256)||(n.flags|=1024,ts!==null&&(Yy(ts),ts=null))),$y(r,n),kn(n),null;case 5:ev(n);var g=tl(Yh.current);if(o=n.type,r!==null&&n.stateNode!=null)Ob(r,n,o,h,g),r.ref!==n.ref&&(n.flags|=512,n.flags|=2097152);else{if(!h){if(n.stateNode===null)throw Error(Re(166));return kn(n),null}if(r=tl(Ts.current),Mp(n)){h=n.stateNode,o=n.type;var x=n.memoizedProps;switch(h[Ss]=n,h[Wh]=x,r=(n.mode&1)!==0,o){case"dialog":hr("cancel",h),hr("close",h);break;case"iframe":case"object":case"embed":hr("load",h);break;case"video":case"audio":for(g=0;g<xh.length;g++)hr(xh[g],h);break;case"source":hr("error",h);break;case"img":case"image":case"link":hr("error",h),hr("load",h);break;case"details":hr("toggle",h);break;case"input":x0(h,x),hr("invalid",h);break;case"select":h._wrapperState={wasMultiple:!!x.multiple},hr("invalid",h);break;case"textarea":b0(h,x),hr("invalid",h)}gy(o,x),g=null;for(var v in x)if(x.hasOwnProperty(v)){var u=x[v];v==="children"?typeof u=="string"?h.textContent!==u&&(x.suppressHydrationWarning!==!0&&Cp(h.textContent,u,r),g=["children",u]):typeof u=="number"&&h.textContent!==""+u&&(x.suppressHydrationWarning!==!0&&Cp(h.textContent,u,r),g=["children",""+u]):Nh.hasOwnProperty(v)&&u!=null&&v==="onScroll"&&hr("scroll",h)}switch(o){case"input":wp(h),w0(h,x,!0);break;case"textarea":wp(h),S0(h);break;case"select":case"option":break;default:typeof x.onClick=="function"&&(h.onclick=wf)}h=g,n.updateQueue=h,h!==null&&(n.flags|=4)}else{v=g.nodeType===9?g:g.ownerDocument,r==="http://www.w3.org/1999/xhtml"&&(r=p1(o)),r==="http://www.w3.org/1999/xhtml"?o==="script"?(r=v.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof h.is=="string"?r=v.createElement(o,{is:h.is}):(r=v.createElement(o),o==="select"&&(v=r,h.multiple?v.multiple=!0:h.size&&(v.size=h.size))):r=v.createElementNS(r,o),r[Ss]=n,r[Wh]=h,Fb(r,n,!1,!1),n.stateNode=r;e:{switch(v=yy(o,h),o){case"dialog":hr("cancel",r),hr("close",r),g=h;break;case"iframe":case"object":case"embed":hr("load",r),g=h;break;case"video":case"audio":for(g=0;g<xh.length;g++)hr(xh[g],r);g=h;break;case"source":hr("error",r),g=h;break;case"img":case"image":case"link":hr("error",r),hr("load",r),g=h;break;case"details":hr("toggle",r),g=h;break;case"input":x0(r,h),g=hy(r,h),hr("invalid",r);break;case"option":g=h;break;case"select":r._wrapperState={wasMultiple:!!h.multiple},g=kr({},h,{value:void 0}),hr("invalid",r);break;case"textarea":b0(r,h),g=fy(r,h),hr("invalid",r);break;default:g=h}gy(o,g),u=g;for(x in u)if(u.hasOwnProperty(x)){var C=u[x];x==="style"?g1(r,C):x==="dangerouslySetInnerHTML"?(C=C?C.__html:void 0,C!=null&&f1(r,C)):x==="children"?typeof C=="string"?(o!=="textarea"||C!=="")&&jh(r,C):typeof C=="number"&&jh(r,""+C):x!=="suppressContentEditableWarning"&&x!=="suppressHydrationWarning"&&x!=="autoFocus"&&(Nh.hasOwnProperty(x)?C!=null&&x==="onScroll"&&hr("scroll",r):C!=null&&A_(r,x,C,v))}switch(o){case"input":wp(r),w0(r,h,!1);break;case"textarea":wp(r),S0(r);break;case"option":h.value!=null&&r.setAttribute("value",""+uo(h.value));break;case"select":r.multiple=!!h.multiple,x=h.value,x!=null?Mu(r,!!h.multiple,x,!1):h.defaultValue!=null&&Mu(r,!!h.multiple,h.defaultValue,!0);break;default:typeof g.onClick=="function"&&(r.onclick=wf)}switch(o){case"button":case"input":case"select":case"textarea":h=!!h.autoFocus;break e;case"img":h=!0;break e;default:h=!1}}h&&(n.flags|=4)}n.ref!==null&&(n.flags|=512,n.flags|=2097152)}return kn(n),null;case 6:if(r&&n.stateNode!=null)Nb(r,n,r.memoizedProps,h);else{if(typeof h!="string"&&n.stateNode===null)throw Error(Re(166));if(o=tl(Yh.current),tl(Ts.current),Mp(n)){if(h=n.stateNode,o=n.memoizedProps,h[Ss]=n,(x=h.nodeValue!==o)&&(r=Si,r!==null))switch(r.tag){case 3:Cp(h.nodeValue,o,(r.mode&1)!==0);break;case 5:r.memoizedProps.suppressHydrationWarning!==!0&&Cp(h.nodeValue,o,(r.mode&1)!==0)}x&&(n.flags|=4)}else h=(o.nodeType===9?o:o.ownerDocument).createTextNode(h),h[Ss]=n,n.stateNode=h}return kn(n),null;case 13:if(pr(br),h=n.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(_r&&bi!==null&&n.mode&1&&!(n.flags&128))nb(),Vu(),n.flags|=98560,x=!1;else if(x=Mp(n),h!==null&&h.dehydrated!==null){if(r===null){if(!x)throw Error(Re(318));if(x=n.memoizedState,x=x!==null?x.dehydrated:null,!x)throw Error(Re(317));x[Ss]=n}else Vu(),!(n.flags&128)&&(n.memoizedState=null),n.flags|=4;kn(n),x=!1}else ts!==null&&(Yy(ts),ts=null),x=!0;if(!x)return n.flags&65536?n:null}return n.flags&128?(n.lanes=o,n):(h=h!==null,h!==(r!==null&&r.memoizedState!==null)&&h&&(n.child.flags|=8192,n.mode&1&&(r===null||br.current&1?$r===0&&($r=3):pv())),n.updateQueue!==null&&(n.flags|=4),kn(n),null);case 4:return $u(),$y(r,n),r===null&&Hh(n.stateNode.containerInfo),kn(n),null;case 10:return X_(n.type._context),kn(n),null;case 17:return ri(n.type)&&bf(),kn(n),null;case 19:if(pr(br),x=n.memoizedState,x===null)return kn(n),null;if(h=(n.flags&128)!==0,v=x.rendering,v===null)if(h)dh(x,!1);else{if($r!==0||r!==null&&r.flags&128)for(r=n.child;r!==null;){if(v=Cf(r),v!==null){for(n.flags|=128,dh(x,!1),h=v.updateQueue,h!==null&&(n.updateQueue=h,n.flags|=4),n.subtreeFlags=0,h=o,o=n.child;o!==null;)x=o,r=h,x.flags&=14680066,v=x.alternate,v===null?(x.childLanes=0,x.lanes=r,x.child=null,x.subtreeFlags=0,x.memoizedProps=null,x.memoizedState=null,x.updateQueue=null,x.dependencies=null,x.stateNode=null):(x.childLanes=v.childLanes,x.lanes=v.lanes,x.child=v.child,x.subtreeFlags=0,x.deletions=null,x.memoizedProps=v.memoizedProps,x.memoizedState=v.memoizedState,x.updateQueue=v.updateQueue,x.type=v.type,r=v.dependencies,x.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),o=o.sibling;return or(br,br.current&1|2),n.child}r=r.sibling}x.tail!==null&&Ar()>Zu&&(n.flags|=128,h=!0,dh(x,!1),n.lanes=4194304)}else{if(!h)if(r=Cf(v),r!==null){if(n.flags|=128,h=!0,o=r.updateQueue,o!==null&&(n.updateQueue=o,n.flags|=4),dh(x,!0),x.tail===null&&x.tailMode==="hidden"&&!v.alternate&&!_r)return kn(n),null}else 2*Ar()-x.renderingStartTime>Zu&&o!==1073741824&&(n.flags|=128,h=!0,dh(x,!1),n.lanes=4194304);x.isBackwards?(v.sibling=n.child,n.child=v):(o=x.last,o!==null?o.sibling=v:n.child=v,x.last=v)}return x.tail!==null?(n=x.tail,x.rendering=n,x.tail=n.sibling,x.renderingStartTime=Ar(),n.sibling=null,o=br.current,or(br,h?o&1|2:o&1),n):(kn(n),null);case 22:case 23:return dv(),h=n.memoizedState!==null,r!==null&&r.memoizedState!==null!==h&&(n.flags|=8192),h&&n.mode&1?xi&1073741824&&(kn(n),n.subtreeFlags&6&&(n.flags|=8192)):kn(n),null;case 24:return null;case 25:return null}throw Error(Re(156,n.tag))}function jI(r,n){switch(G_(n),n.tag){case 1:return ri(n.type)&&bf(),r=n.flags,r&65536?(n.flags=r&-65537|128,n):null;case 3:return $u(),pr(ti),pr(Pn),tv(),r=n.flags,r&65536&&!(r&128)?(n.flags=r&-65537|128,n):null;case 5:return ev(n),null;case 13:if(pr(br),r=n.memoizedState,r!==null&&r.dehydrated!==null){if(n.alternate===null)throw Error(Re(340));Vu()}return r=n.flags,r&65536?(n.flags=r&-65537|128,n):null;case 19:return pr(br),null;case 4:return $u(),null;case 10:return X_(n.type._context),null;case 22:case 23:return dv(),null;case 24:return null;default:return null}}var Dp=!1,Tn=!1,VI=typeof WeakSet=="function"?WeakSet:Set,ot=null;function Pu(r,n){var o=r.ref;if(o!==null)if(typeof o=="function")try{o(null)}catch(h){Cr(r,n,h)}else o.current=null}function qy(r,n,o){try{o()}catch(h){Cr(r,n,h)}}var dw=!1;function UI(r,n){if(Ey=_f,r=q1(),q_(r)){if("selectionStart"in r)var o={start:r.selectionStart,end:r.selectionEnd};else e:{o=(o=r.ownerDocument)&&o.defaultView||window;var h=o.getSelection&&o.getSelection();if(h&&h.rangeCount!==0){o=h.anchorNode;var g=h.anchorOffset,x=h.focusNode;h=h.focusOffset;try{o.nodeType,x.nodeType}catch{o=null;break e}var v=0,u=-1,C=-1,O=0,U=0,j=r,L=null;t:for(;;){for(var oe;j!==o||g!==0&&j.nodeType!==3||(u=v+g),j!==x||h!==0&&j.nodeType!==3||(C=v+h),j.nodeType===3&&(v+=j.nodeValue.length),(oe=j.firstChild)!==null;)L=j,j=oe;for(;;){if(j===r)break t;if(L===o&&++O===g&&(u=v),L===x&&++U===h&&(C=v),(oe=j.nextSibling)!==null)break;j=L,L=j.parentNode}j=oe}o=u===-1||C===-1?null:{start:u,end:C}}else o=null}o=o||{start:0,end:0}}else o=null;for(Py={focusedElem:r,selectionRange:o},_f=!1,ot=n;ot!==null;)if(n=ot,r=n.child,(n.subtreeFlags&1028)!==0&&r!==null)r.return=n,ot=r;else for(;ot!==null;){n=ot;try{var de=n.alternate;if(n.flags&1024)switch(n.tag){case 0:case 11:case 15:break;case 1:if(de!==null){var he=de.memoizedProps,Ie=de.memoizedState,K=n.stateNode,G=K.getSnapshotBeforeUpdate(n.elementType===n.type?he:Qi(n.type,he),Ie);K.__reactInternalSnapshotBeforeUpdate=G}break;case 3:var ee=n.stateNode.containerInfo;ee.nodeType===1?ee.textContent="":ee.nodeType===9&&ee.documentElement&&ee.removeChild(ee.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Re(163))}}catch(_e){Cr(n,n.return,_e)}if(r=n.sibling,r!==null){r.return=n.return,ot=r;break}ot=n.return}return de=dw,dw=!1,de}function Ah(r,n,o){var h=n.updateQueue;if(h=h!==null?h.lastEffect:null,h!==null){var g=h=h.next;do{if((g.tag&r)===r){var x=g.destroy;g.destroy=void 0,x!==void 0&&qy(n,o,x)}g=g.next}while(g!==h)}}function em(r,n){if(n=n.updateQueue,n=n!==null?n.lastEffect:null,n!==null){var o=n=n.next;do{if((o.tag&r)===r){var h=o.create;o.destroy=h()}o=o.next}while(o!==n)}}function Zy(r){var n=r.ref;if(n!==null){var o=r.stateNode;switch(r.tag){case 5:r=o;break;default:r=o}typeof n=="function"?n(r):n.current=r}}function jb(r){var n=r.alternate;n!==null&&(r.alternate=null,jb(n)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(n=r.stateNode,n!==null&&(delete n[Ss],delete n[Wh],delete n[Ay],delete n[kI],delete n[TI])),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}function Vb(r){return r.tag===5||r.tag===3||r.tag===4}function pw(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||Vb(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function Gy(r,n,o){var h=r.tag;if(h===5||h===6)r=r.stateNode,n?o.nodeType===8?o.parentNode.insertBefore(r,n):o.insertBefore(r,n):(o.nodeType===8?(n=o.parentNode,n.insertBefore(r,o)):(n=o,n.appendChild(r)),o=o._reactRootContainer,o!=null||n.onclick!==null||(n.onclick=wf));else if(h!==4&&(r=r.child,r!==null))for(Gy(r,n,o),r=r.sibling;r!==null;)Gy(r,n,o),r=r.sibling}function Hy(r,n,o){var h=r.tag;if(h===5||h===6)r=r.stateNode,n?o.insertBefore(r,n):o.appendChild(r);else if(h!==4&&(r=r.child,r!==null))for(Hy(r,n,o),r=r.sibling;r!==null;)Hy(r,n,o),r=r.sibling}var un=null,es=!1;function Za(r,n,o){for(o=o.child;o!==null;)Ub(r,n,o),o=o.sibling}function Ub(r,n,o){if(ks&&typeof ks.onCommitFiberUnmount=="function")try{ks.onCommitFiberUnmount(Gf,o)}catch{}switch(o.tag){case 5:Tn||Pu(o,n);case 6:var h=un,g=es;un=null,Za(r,n,o),un=h,es=g,un!==null&&(es?(r=un,o=o.stateNode,r.nodeType===8?r.parentNode.removeChild(o):r.removeChild(o)):un.removeChild(o.stateNode));break;case 18:un!==null&&(es?(r=un,o=o.stateNode,r.nodeType===8?jg(r.parentNode,o):r.nodeType===1&&jg(r,o),qh(r)):jg(un,o.stateNode));break;case 4:h=un,g=es,un=o.stateNode.containerInfo,es=!0,Za(r,n,o),un=h,es=g;break;case 0:case 11:case 14:case 15:if(!Tn&&(h=o.updateQueue,h!==null&&(h=h.lastEffect,h!==null))){g=h=h.next;do{var x=g,v=x.destroy;x=x.tag,v!==void 0&&(x&2||x&4)&&qy(o,n,v),g=g.next}while(g!==h)}Za(r,n,o);break;case 1:if(!Tn&&(Pu(o,n),h=o.stateNode,typeof h.componentWillUnmount=="function"))try{h.props=o.memoizedProps,h.state=o.memoizedState,h.componentWillUnmount()}catch(u){Cr(o,n,u)}Za(r,n,o);break;case 21:Za(r,n,o);break;case 22:o.mode&1?(Tn=(h=Tn)||o.memoizedState!==null,Za(r,n,o),Tn=h):Za(r,n,o);break;default:Za(r,n,o)}}function fw(r){var n=r.updateQueue;if(n!==null){r.updateQueue=null;var o=r.stateNode;o===null&&(o=r.stateNode=new VI),n.forEach(function(h){var g=YI.bind(null,r,h);o.has(h)||(o.add(h),h.then(g,g))})}}function Ji(r,n){var o=n.deletions;if(o!==null)for(var h=0;h<o.length;h++){var g=o[h];try{var x=r,v=n,u=v;e:for(;u!==null;){switch(u.tag){case 5:un=u.stateNode,es=!1;break e;case 3:un=u.stateNode.containerInfo,es=!0;break e;case 4:un=u.stateNode.containerInfo,es=!0;break e}u=u.return}if(un===null)throw Error(Re(160));Ub(x,v,g),un=null,es=!1;var C=g.alternate;C!==null&&(C.return=null),g.return=null}catch(O){Cr(g,n,O)}}if(n.subtreeFlags&12854)for(n=n.child;n!==null;)$b(n,r),n=n.sibling}function $b(r,n){var o=r.alternate,h=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:if(Ji(n,r),xs(r),h&4){try{Ah(3,r,r.return),em(3,r)}catch(he){Cr(r,r.return,he)}try{Ah(5,r,r.return)}catch(he){Cr(r,r.return,he)}}break;case 1:Ji(n,r),xs(r),h&512&&o!==null&&Pu(o,o.return);break;case 5:if(Ji(n,r),xs(r),h&512&&o!==null&&Pu(o,o.return),r.flags&32){var g=r.stateNode;try{jh(g,"")}catch(he){Cr(r,r.return,he)}}if(h&4&&(g=r.stateNode,g!=null)){var x=r.memoizedProps,v=o!==null?o.memoizedProps:x,u=r.type,C=r.updateQueue;if(r.updateQueue=null,C!==null)try{u==="input"&&x.type==="radio"&&x.name!=null&&h1(g,x),yy(u,v);var O=yy(u,x);for(v=0;v<C.length;v+=2){var U=C[v],j=C[v+1];U==="style"?g1(g,j):U==="dangerouslySetInnerHTML"?f1(g,j):U==="children"?jh(g,j):A_(g,U,j,O)}switch(u){case"input":dy(g,x);break;case"textarea":d1(g,x);break;case"select":var L=g._wrapperState.wasMultiple;g._wrapperState.wasMultiple=!!x.multiple;var oe=x.value;oe!=null?Mu(g,!!x.multiple,oe,!1):L!==!!x.multiple&&(x.defaultValue!=null?Mu(g,!!x.multiple,x.defaultValue,!0):Mu(g,!!x.multiple,x.multiple?[]:"",!1))}g[Wh]=x}catch(he){Cr(r,r.return,he)}}break;case 6:if(Ji(n,r),xs(r),h&4){if(r.stateNode===null)throw Error(Re(162));g=r.stateNode,x=r.memoizedProps;try{g.nodeValue=x}catch(he){Cr(r,r.return,he)}}break;case 3:if(Ji(n,r),xs(r),h&4&&o!==null&&o.memoizedState.isDehydrated)try{qh(n.containerInfo)}catch(he){Cr(r,r.return,he)}break;case 4:Ji(n,r),xs(r);break;case 13:Ji(n,r),xs(r),g=r.child,g.flags&8192&&(x=g.memoizedState!==null,g.stateNode.isHidden=x,!x||g.alternate!==null&&g.alternate.memoizedState!==null||(cv=Ar())),h&4&&fw(r);break;case 22:if(U=o!==null&&o.memoizedState!==null,r.mode&1?(Tn=(O=Tn)||U,Ji(n,r),Tn=O):Ji(n,r),xs(r),h&8192){if(O=r.memoizedState!==null,(r.stateNode.isHidden=O)&&!U&&r.mode&1)for(ot=r,U=r.child;U!==null;){for(j=ot=U;ot!==null;){switch(L=ot,oe=L.child,L.tag){case 0:case 11:case 14:case 15:Ah(4,L,L.return);break;case 1:Pu(L,L.return);var de=L.stateNode;if(typeof de.componentWillUnmount=="function"){h=L,o=L.return;try{n=h,de.props=n.memoizedProps,de.state=n.memoizedState,de.componentWillUnmount()}catch(he){Cr(h,o,he)}}break;case 5:Pu(L,L.return);break;case 22:if(L.memoizedState!==null){gw(j);continue}}oe!==null?(oe.return=L,ot=oe):gw(j)}U=U.sibling}e:for(U=null,j=r;;){if(j.tag===5){if(U===null){U=j;try{g=j.stateNode,O?(x=g.style,typeof x.setProperty=="function"?x.setProperty("display","none","important"):x.display="none"):(u=j.stateNode,C=j.memoizedProps.style,v=C!=null&&C.hasOwnProperty("display")?C.display:null,u.style.display=m1("display",v))}catch(he){Cr(r,r.return,he)}}}else if(j.tag===6){if(U===null)try{j.stateNode.nodeValue=O?"":j.memoizedProps}catch(he){Cr(r,r.return,he)}}else if((j.tag!==22&&j.tag!==23||j.memoizedState===null||j===r)&&j.child!==null){j.child.return=j,j=j.child;continue}if(j===r)break e;for(;j.sibling===null;){if(j.return===null||j.return===r)break e;U===j&&(U=null),j=j.return}U===j&&(U=null),j.sibling.return=j.return,j=j.sibling}}break;case 19:Ji(n,r),xs(r),h&4&&fw(r);break;case 21:break;default:Ji(n,r),xs(r)}}function xs(r){var n=r.flags;if(n&2){try{e:{for(var o=r.return;o!==null;){if(Vb(o)){var h=o;break e}o=o.return}throw Error(Re(160))}switch(h.tag){case 5:var g=h.stateNode;h.flags&32&&(jh(g,""),h.flags&=-33);var x=pw(r);Hy(r,x,g);break;case 3:case 4:var v=h.stateNode.containerInfo,u=pw(r);Gy(r,u,v);break;default:throw Error(Re(161))}}catch(C){Cr(r,r.return,C)}r.flags&=-3}n&4096&&(r.flags&=-4097)}function $I(r,n,o){ot=r,qb(r)}function qb(r,n,o){for(var h=(r.mode&1)!==0;ot!==null;){var g=ot,x=g.child;if(g.tag===22&&h){var v=g.memoizedState!==null||Dp;if(!v){var u=g.alternate,C=u!==null&&u.memoizedState!==null||Tn;u=Dp;var O=Tn;if(Dp=v,(Tn=C)&&!O)for(ot=g;ot!==null;)v=ot,C=v.child,v.tag===22&&v.memoizedState!==null?yw(g):C!==null?(C.return=v,ot=C):yw(g);for(;x!==null;)ot=x,qb(x),x=x.sibling;ot=g,Dp=u,Tn=O}mw(r)}else g.subtreeFlags&8772&&x!==null?(x.return=g,ot=x):mw(r)}}function mw(r){for(;ot!==null;){var n=ot;if(n.flags&8772){var o=n.alternate;try{if(n.flags&8772)switch(n.tag){case 0:case 11:case 15:Tn||em(5,n);break;case 1:var h=n.stateNode;if(n.flags&4&&!Tn)if(o===null)h.componentDidMount();else{var g=n.elementType===n.type?o.memoizedProps:Qi(n.type,o.memoizedProps);h.componentDidUpdate(g,o.memoizedState,h.__reactInternalSnapshotBeforeUpdate)}var x=n.updateQueue;x!==null&&Q0(n,x,h);break;case 3:var v=n.updateQueue;if(v!==null){if(o=null,n.child!==null)switch(n.child.tag){case 5:o=n.child.stateNode;break;case 1:o=n.child.stateNode}Q0(n,v,o)}break;case 5:var u=n.stateNode;if(o===null&&n.flags&4){o=u;var C=n.memoizedProps;switch(n.type){case"button":case"input":case"select":case"textarea":C.autoFocus&&o.focus();break;case"img":C.src&&(o.src=C.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(n.memoizedState===null){var O=n.alternate;if(O!==null){var U=O.memoizedState;if(U!==null){var j=U.dehydrated;j!==null&&qh(j)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Re(163))}Tn||n.flags&512&&Zy(n)}catch(L){Cr(n,n.return,L)}}if(n===r){ot=null;break}if(o=n.sibling,o!==null){o.return=n.return,ot=o;break}ot=n.return}}function gw(r){for(;ot!==null;){var n=ot;if(n===r){ot=null;break}var o=n.sibling;if(o!==null){o.return=n.return,ot=o;break}ot=n.return}}function yw(r){for(;ot!==null;){var n=ot;try{switch(n.tag){case 0:case 11:case 15:var o=n.return;try{em(4,n)}catch(C){Cr(n,o,C)}break;case 1:var h=n.stateNode;if(typeof h.componentDidMount=="function"){var g=n.return;try{h.componentDidMount()}catch(C){Cr(n,g,C)}}var x=n.return;try{Zy(n)}catch(C){Cr(n,x,C)}break;case 5:var v=n.return;try{Zy(n)}catch(C){Cr(n,v,C)}}}catch(C){Cr(n,n.return,C)}if(n===r){ot=null;break}var u=n.sibling;if(u!==null){u.return=n.return,ot=u;break}ot=n.return}}var qI=Math.ceil,zf=ua.ReactCurrentDispatcher,lv=ua.ReactCurrentOwner,Vi=ua.ReactCurrentBatchConfig,Vt=0,tn=null,Fr=null,cn=0,xi=0,Cu=go(0),$r=0,td=null,hl=0,tm=0,uv=0,zh=null,Qn=null,cv=0,Zu=1/0,Ks=null,Df=!1,Ky=null,ao=null,Lp=!1,eo=null,Lf=0,Dh=0,Wy=null,rf=-1,nf=0;function Nn(){return Vt&6?Ar():rf!==-1?rf:rf=Ar()}function oo(r){return r.mode&1?Vt&2&&cn!==0?cn&-cn:EI.transition!==null?(nf===0&&(nf=P1()),nf):(r=Qt,r!==0||(r=window.event,r=r===void 0?16:R1(r.type)),r):1}function ns(r,n,o,h){if(50<Dh)throw Dh=0,Wy=null,Error(Re(185));cd(r,o,h),(!(Vt&2)||r!==tn)&&(r===tn&&(!(Vt&2)&&(tm|=o),$r===4&&Ya(r,cn)),ni(r,h),o===1&&Vt===0&&!(n.mode&1)&&(Zu=Ar()+500,Yf&&yo()))}function ni(r,n){var o=r.callbackNode;ET(r,n);var h=yf(r,r===tn?cn:0);if(h===0)o!==null&&I0(o),r.callbackNode=null,r.callbackPriority=0;else if(n=h&-h,r.callbackPriority!==n){if(o!=null&&I0(o),n===1)r.tag===0?II(_w.bind(null,r)):eb(_w.bind(null,r)),bI(function(){!(Vt&6)&&yo()}),o=null;else{switch(C1(h)){case 1:o=B_;break;case 4:o=I1;break;case 16:o=gf;break;case 536870912:o=E1;break;default:o=gf}o=Jb(o,Zb.bind(null,r))}r.callbackPriority=n,r.callbackNode=o}}function Zb(r,n){if(rf=-1,nf=0,Vt&6)throw Error(Re(327));var o=r.callbackNode;if(Ru()&&r.callbackNode!==o)return null;var h=yf(r,r===tn?cn:0);if(h===0)return null;if(h&30||h&r.expiredLanes||n)n=Rf(r,h);else{n=h;var g=Vt;Vt|=2;var x=Hb();(tn!==r||cn!==n)&&(Ks=null,Zu=Ar()+500,nl(r,n));do try{HI();break}catch(u){Gb(r,u)}while(!0);W_(),zf.current=x,Vt=g,Fr!==null?n=0:(tn=null,cn=0,n=$r)}if(n!==0){if(n===2&&(g=by(r),g!==0&&(h=g,n=Xy(r,g))),n===1)throw o=td,nl(r,0),Ya(r,h),ni(r,Ar()),o;if(n===6)Ya(r,h);else{if(g=r.current.alternate,!(h&30)&&!ZI(g)&&(n=Rf(r,h),n===2&&(x=by(r),x!==0&&(h=x,n=Xy(r,x))),n===1))throw o=td,nl(r,0),Ya(r,h),ni(r,Ar()),o;switch(r.finishedWork=g,r.finishedLanes=h,n){case 0:case 1:throw Error(Re(345));case 2:Jo(r,Qn,Ks);break;case 3:if(Ya(r,h),(h&130023424)===h&&(n=cv+500-Ar(),10<n)){if(yf(r,0)!==0)break;if(g=r.suspendedLanes,(g&h)!==h){Nn(),r.pingedLanes|=r.suspendedLanes&g;break}r.timeoutHandle=My(Jo.bind(null,r,Qn,Ks),n);break}Jo(r,Qn,Ks);break;case 4:if(Ya(r,h),(h&4194240)===h)break;for(n=r.eventTimes,g=-1;0<h;){var v=31-rs(h);x=1<<v,v=n[v],v>g&&(g=v),h&=~x}if(h=g,h=Ar()-h,h=(120>h?120:480>h?480:1080>h?1080:1920>h?1920:3e3>h?3e3:4320>h?4320:1960*qI(h/1960))-h,10<h){r.timeoutHandle=My(Jo.bind(null,r,Qn,Ks),h);break}Jo(r,Qn,Ks);break;case 5:Jo(r,Qn,Ks);break;default:throw Error(Re(329))}}}return ni(r,Ar()),r.callbackNode===o?Zb.bind(null,r):null}function Xy(r,n){var o=zh;return r.current.memoizedState.isDehydrated&&(nl(r,n).flags|=256),r=Rf(r,n),r!==2&&(n=Qn,Qn=o,n!==null&&Yy(n)),r}function Yy(r){Qn===null?Qn=r:Qn.push.apply(Qn,r)}function ZI(r){for(var n=r;;){if(n.flags&16384){var o=n.updateQueue;if(o!==null&&(o=o.stores,o!==null))for(var h=0;h<o.length;h++){var g=o[h],x=g.getSnapshot;g=g.value;try{if(!ss(x(),g))return!1}catch{return!1}}}if(o=n.child,n.subtreeFlags&16384&&o!==null)o.return=n,n=o;else{if(n===r)break;for(;n.sibling===null;){if(n.return===null||n.return===r)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function Ya(r,n){for(n&=~uv,n&=~tm,r.suspendedLanes|=n,r.pingedLanes&=~n,r=r.expirationTimes;0<n;){var o=31-rs(n),h=1<<o;r[o]=-1,n&=~h}}function _w(r){if(Vt&6)throw Error(Re(327));Ru();var n=yf(r,0);if(!(n&1))return ni(r,Ar()),null;var o=Rf(r,n);if(r.tag!==0&&o===2){var h=by(r);h!==0&&(n=h,o=Xy(r,h))}if(o===1)throw o=td,nl(r,0),Ya(r,n),ni(r,Ar()),o;if(o===6)throw Error(Re(345));return r.finishedWork=r.current.alternate,r.finishedLanes=n,Jo(r,Qn,Ks),ni(r,Ar()),null}function hv(r,n){var o=Vt;Vt|=1;try{return r(n)}finally{Vt=o,Vt===0&&(Zu=Ar()+500,Yf&&yo())}}function dl(r){eo!==null&&eo.tag===0&&!(Vt&6)&&Ru();var n=Vt;Vt|=1;var o=Vi.transition,h=Qt;try{if(Vi.transition=null,Qt=1,r)return r()}finally{Qt=h,Vi.transition=o,Vt=n,!(Vt&6)&&yo()}}function dv(){xi=Cu.current,pr(Cu)}function nl(r,n){r.finishedWork=null,r.finishedLanes=0;var o=r.timeoutHandle;if(o!==-1&&(r.timeoutHandle=-1,wI(o)),Fr!==null)for(o=Fr.return;o!==null;){var h=o;switch(G_(h),h.tag){case 1:h=h.type.childContextTypes,h!=null&&bf();break;case 3:$u(),pr(ti),pr(Pn),tv();break;case 5:ev(h);break;case 4:$u();break;case 13:pr(br);break;case 19:pr(br);break;case 10:X_(h.type._context);break;case 22:case 23:dv()}o=o.return}if(tn=r,Fr=r=lo(r.current,null),cn=xi=n,$r=0,td=null,uv=tm=hl=0,Qn=zh=null,el!==null){for(n=0;n<el.length;n++)if(o=el[n],h=o.interleaved,h!==null){o.interleaved=null;var g=h.next,x=o.pending;if(x!==null){var v=x.next;x.next=g,h.next=v}o.pending=h}el=null}return r}function Gb(r,n){do{var o=Fr;try{if(W_(),Qp.current=Af,Mf){for(var h=Sr.memoizedState;h!==null;){var g=h.queue;g!==null&&(g.pending=null),h=h.next}Mf=!1}if(cl=0,en=Ur=Sr=null,Mh=!1,Jh=0,lv.current=null,o===null||o.return===null){$r=1,td=n,Fr=null;break}e:{var x=r,v=o.return,u=o,C=n;if(n=cn,u.flags|=32768,C!==null&&typeof C=="object"&&typeof C.then=="function"){var O=C,U=u,j=U.tag;if(!(U.mode&1)&&(j===0||j===11||j===15)){var L=U.alternate;L?(U.updateQueue=L.updateQueue,U.memoizedState=L.memoizedState,U.lanes=L.lanes):(U.updateQueue=null,U.memoizedState=null)}var oe=sw(v);if(oe!==null){oe.flags&=-257,aw(oe,v,u,x,n),oe.mode&1&&iw(x,O,n),n=oe,C=O;var de=n.updateQueue;if(de===null){var he=new Set;he.add(C),n.updateQueue=he}else de.add(C);break e}else{if(!(n&1)){iw(x,O,n),pv();break e}C=Error(Re(426))}}else if(_r&&u.mode&1){var Ie=sw(v);if(Ie!==null){!(Ie.flags&65536)&&(Ie.flags|=256),aw(Ie,v,u,x,n),H_(qu(C,u));break e}}x=C=qu(C,u),$r!==4&&($r=2),zh===null?zh=[x]:zh.push(x),x=v;do{switch(x.tag){case 3:x.flags|=65536,n&=-n,x.lanes|=n;var K=Cb(x,C,n);J0(x,K);break e;case 1:u=C;var G=x.type,ee=x.stateNode;if(!(x.flags&128)&&(typeof G.getDerivedStateFromError=="function"||ee!==null&&typeof ee.componentDidCatch=="function"&&(ao===null||!ao.has(ee)))){x.flags|=65536,n&=-n,x.lanes|=n;var _e=Mb(x,u,n);J0(x,_e);break e}}x=x.return}while(x!==null)}Wb(o)}catch(Se){n=Se,Fr===o&&o!==null&&(Fr=o=o.return);continue}break}while(!0)}function Hb(){var r=zf.current;return zf.current=Af,r===null?Af:r}function pv(){($r===0||$r===3||$r===2)&&($r=4),tn===null||!(hl&268435455)&&!(tm&268435455)||Ya(tn,cn)}function Rf(r,n){var o=Vt;Vt|=2;var h=Hb();(tn!==r||cn!==n)&&(Ks=null,nl(r,n));do try{GI();break}catch(g){Gb(r,g)}while(!0);if(W_(),Vt=o,zf.current=h,Fr!==null)throw Error(Re(261));return tn=null,cn=0,$r}function GI(){for(;Fr!==null;)Kb(Fr)}function HI(){for(;Fr!==null&&!_T();)Kb(Fr)}function Kb(r){var n=Yb(r.alternate,r,xi);r.memoizedProps=r.pendingProps,n===null?Wb(r):Fr=n,lv.current=null}function Wb(r){var n=r;do{var o=n.alternate;if(r=n.return,n.flags&32768){if(o=jI(o,n),o!==null){o.flags&=32767,Fr=o;return}if(r!==null)r.flags|=32768,r.subtreeFlags=0,r.deletions=null;else{$r=6,Fr=null;return}}else if(o=NI(o,n,xi),o!==null){Fr=o;return}if(n=n.sibling,n!==null){Fr=n;return}Fr=n=r}while(n!==null);$r===0&&($r=5)}function Jo(r,n,o){var h=Qt,g=Vi.transition;try{Vi.transition=null,Qt=1,KI(r,n,o,h)}finally{Vi.transition=g,Qt=h}return null}function KI(r,n,o,h){do Ru();while(eo!==null);if(Vt&6)throw Error(Re(327));o=r.finishedWork;var g=r.finishedLanes;if(o===null)return null;if(r.finishedWork=null,r.finishedLanes=0,o===r.current)throw Error(Re(177));r.callbackNode=null,r.callbackPriority=0;var x=o.lanes|o.childLanes;if(PT(r,x),r===tn&&(Fr=tn=null,cn=0),!(o.subtreeFlags&2064)&&!(o.flags&2064)||Lp||(Lp=!0,Jb(gf,function(){return Ru(),null})),x=(o.flags&15990)!==0,o.subtreeFlags&15990||x){x=Vi.transition,Vi.transition=null;var v=Qt;Qt=1;var u=Vt;Vt|=4,lv.current=null,UI(r,o),$b(o,r),fI(Py),_f=!!Ey,Py=Ey=null,r.current=o,$I(o),vT(),Vt=u,Qt=v,Vi.transition=x}else r.current=o;if(Lp&&(Lp=!1,eo=r,Lf=g),x=r.pendingLanes,x===0&&(ao=null),bT(o.stateNode),ni(r,Ar()),n!==null)for(h=r.onRecoverableError,o=0;o<n.length;o++)g=n[o],h(g.value,{componentStack:g.stack,digest:g.digest});if(Df)throw Df=!1,r=Ky,Ky=null,r;return Lf&1&&r.tag!==0&&Ru(),x=r.pendingLanes,x&1?r===Wy?Dh++:(Dh=0,Wy=r):Dh=0,yo(),null}function Ru(){if(eo!==null){var r=C1(Lf),n=Vi.transition,o=Qt;try{if(Vi.transition=null,Qt=16>r?16:r,eo===null)var h=!1;else{if(r=eo,eo=null,Lf=0,Vt&6)throw Error(Re(331));var g=Vt;for(Vt|=4,ot=r.current;ot!==null;){var x=ot,v=x.child;if(ot.flags&16){var u=x.deletions;if(u!==null){for(var C=0;C<u.length;C++){var O=u[C];for(ot=O;ot!==null;){var U=ot;switch(U.tag){case 0:case 11:case 15:Ah(8,U,x)}var j=U.child;if(j!==null)j.return=U,ot=j;else for(;ot!==null;){U=ot;var L=U.sibling,oe=U.return;if(jb(U),U===O){ot=null;break}if(L!==null){L.return=oe,ot=L;break}ot=oe}}}var de=x.alternate;if(de!==null){var he=de.child;if(he!==null){de.child=null;do{var Ie=he.sibling;he.sibling=null,he=Ie}while(he!==null)}}ot=x}}if(x.subtreeFlags&2064&&v!==null)v.return=x,ot=v;else e:for(;ot!==null;){if(x=ot,x.flags&2048)switch(x.tag){case 0:case 11:case 15:Ah(9,x,x.return)}var K=x.sibling;if(K!==null){K.return=x.return,ot=K;break e}ot=x.return}}var G=r.current;for(ot=G;ot!==null;){v=ot;var ee=v.child;if(v.subtreeFlags&2064&&ee!==null)ee.return=v,ot=ee;else e:for(v=G;ot!==null;){if(u=ot,u.flags&2048)try{switch(u.tag){case 0:case 11:case 15:em(9,u)}}catch(Se){Cr(u,u.return,Se)}if(u===v){ot=null;break e}var _e=u.sibling;if(_e!==null){_e.return=u.return,ot=_e;break e}ot=u.return}}if(Vt=g,yo(),ks&&typeof ks.onPostCommitFiberRoot=="function")try{ks.onPostCommitFiberRoot(Gf,r)}catch{}h=!0}return h}finally{Qt=o,Vi.transition=n}}return!1}function vw(r,n,o){n=qu(o,n),n=Cb(r,n,1),r=so(r,n,1),n=Nn(),r!==null&&(cd(r,1,n),ni(r,n))}function Cr(r,n,o){if(r.tag===3)vw(r,r,o);else for(;n!==null;){if(n.tag===3){vw(n,r,o);break}else if(n.tag===1){var h=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof h.componentDidCatch=="function"&&(ao===null||!ao.has(h))){r=qu(o,r),r=Mb(n,r,1),n=so(n,r,1),r=Nn(),n!==null&&(cd(n,1,r),ni(n,r));break}}n=n.return}}function WI(r,n,o){var h=r.pingCache;h!==null&&h.delete(n),n=Nn(),r.pingedLanes|=r.suspendedLanes&o,tn===r&&(cn&o)===o&&($r===4||$r===3&&(cn&130023424)===cn&&500>Ar()-cv?nl(r,0):uv|=o),ni(r,n)}function Xb(r,n){n===0&&(r.mode&1?(n=kp,kp<<=1,!(kp&130023424)&&(kp=4194304)):n=1);var o=Nn();r=aa(r,n),r!==null&&(cd(r,n,o),ni(r,o))}function XI(r){var n=r.memoizedState,o=0;n!==null&&(o=n.retryLane),Xb(r,o)}function YI(r,n){var o=0;switch(r.tag){case 13:var h=r.stateNode,g=r.memoizedState;g!==null&&(o=g.retryLane);break;case 19:h=r.stateNode;break;default:throw Error(Re(314))}h!==null&&h.delete(n),Xb(r,o)}var Yb;Yb=function(r,n,o){if(r!==null)if(r.memoizedProps!==n.pendingProps||ti.current)ei=!0;else{if(!(r.lanes&o)&&!(n.flags&128))return ei=!1,OI(r,n,o);ei=!!(r.flags&131072)}else ei=!1,_r&&n.flags&1048576&&tb(n,Tf,n.index);switch(n.lanes=0,n.tag){case 2:var h=n.type;tf(r,n),r=n.pendingProps;var g=ju(n,Pn.current);Lu(n,o),g=nv(null,n,h,r,g,o);var x=iv();return n.flags|=1,typeof g=="object"&&g!==null&&typeof g.render=="function"&&g.$$typeof===void 0?(n.tag=1,n.memoizedState=null,n.updateQueue=null,ri(h)?(x=!0,Sf(n)):x=!1,n.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,J_(n),g.updater=Qf,n.stateNode=g,g._reactInternals=n,Fy(n,h,r,o),n=jy(null,n,h,!0,x,o)):(n.tag=0,_r&&x&&Z_(n),Fn(null,n,g,o),n=n.child),n;case 16:h=n.elementType;e:{switch(tf(r,n),r=n.pendingProps,g=h._init,h=g(h._payload),n.type=h,g=n.tag=QI(h),r=Qi(h,r),g){case 0:n=Ny(null,n,h,r,o);break e;case 1:n=uw(null,n,h,r,o);break e;case 11:n=ow(null,n,h,r,o);break e;case 14:n=lw(null,n,h,Qi(h.type,r),o);break e}throw Error(Re(306,h,""))}return n;case 0:return h=n.type,g=n.pendingProps,g=n.elementType===h?g:Qi(h,g),Ny(r,n,h,g,o);case 1:return h=n.type,g=n.pendingProps,g=n.elementType===h?g:Qi(h,g),uw(r,n,h,g,o);case 3:e:{if(Lb(n),r===null)throw Error(Re(387));h=n.pendingProps,x=n.memoizedState,g=x.element,ob(r,n),Pf(n,h,null,o);var v=n.memoizedState;if(h=v.element,x.isDehydrated)if(x={element:h,isDehydrated:!1,cache:v.cache,pendingSuspenseBoundaries:v.pendingSuspenseBoundaries,transitions:v.transitions},n.updateQueue.baseState=x,n.memoizedState=x,n.flags&256){g=qu(Error(Re(423)),n),n=cw(r,n,h,o,g);break e}else if(h!==g){g=qu(Error(Re(424)),n),n=cw(r,n,h,o,g);break e}else for(bi=io(n.stateNode.containerInfo.firstChild),Si=n,_r=!0,ts=null,o=sb(n,null,h,o),n.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling;else{if(Vu(),h===g){n=oa(r,n,o);break e}Fn(r,n,h,o)}n=n.child}return n;case 5:return lb(n),r===null&&Ly(n),h=n.type,g=n.pendingProps,x=r!==null?r.memoizedProps:null,v=g.children,Cy(h,g)?v=null:x!==null&&Cy(h,x)&&(n.flags|=32),Db(r,n),Fn(r,n,v,o),n.child;case 6:return r===null&&Ly(n),null;case 13:return Rb(r,n,o);case 4:return Q_(n,n.stateNode.containerInfo),h=n.pendingProps,r===null?n.child=Uu(n,null,h,o):Fn(r,n,h,o),n.child;case 11:return h=n.type,g=n.pendingProps,g=n.elementType===h?g:Qi(h,g),ow(r,n,h,g,o);case 7:return Fn(r,n,n.pendingProps,o),n.child;case 8:return Fn(r,n,n.pendingProps.children,o),n.child;case 12:return Fn(r,n,n.pendingProps.children,o),n.child;case 10:e:{if(h=n.type._context,g=n.pendingProps,x=n.memoizedProps,v=g.value,or(If,h._currentValue),h._currentValue=v,x!==null)if(ss(x.value,v)){if(x.children===g.children&&!ti.current){n=oa(r,n,o);break e}}else for(x=n.child,x!==null&&(x.return=n);x!==null;){var u=x.dependencies;if(u!==null){v=x.child;for(var C=u.firstContext;C!==null;){if(C.context===h){if(x.tag===1){C=ta(-1,o&-o),C.tag=2;var O=x.updateQueue;if(O!==null){O=O.shared;var U=O.pending;U===null?C.next=C:(C.next=U.next,U.next=C),O.pending=C}}x.lanes|=o,C=x.alternate,C!==null&&(C.lanes|=o),Ry(x.return,o,n),u.lanes|=o;break}C=C.next}}else if(x.tag===10)v=x.type===n.type?null:x.child;else if(x.tag===18){if(v=x.return,v===null)throw Error(Re(341));v.lanes|=o,u=v.alternate,u!==null&&(u.lanes|=o),Ry(v,o,n),v=x.sibling}else v=x.child;if(v!==null)v.return=x;else for(v=x;v!==null;){if(v===n){v=null;break}if(x=v.sibling,x!==null){x.return=v.return,v=x;break}v=v.return}x=v}Fn(r,n,g.children,o),n=n.child}return n;case 9:return g=n.type,h=n.pendingProps.children,Lu(n,o),g=Ui(g),h=h(g),n.flags|=1,Fn(r,n,h,o),n.child;case 14:return h=n.type,g=Qi(h,n.pendingProps),g=Qi(h.type,g),lw(r,n,h,g,o);case 15:return Ab(r,n,n.type,n.pendingProps,o);case 17:return h=n.type,g=n.pendingProps,g=n.elementType===h?g:Qi(h,g),tf(r,n),n.tag=1,ri(h)?(r=!0,Sf(n)):r=!1,Lu(n,o),Pb(n,h,g),Fy(n,h,g,o),jy(null,n,h,!0,r,o);case 19:return Bb(r,n,o);case 22:return zb(r,n,o)}throw Error(Re(156,n.tag))};function Jb(r,n){return T1(r,n)}function JI(r,n,o,h){this.tag=r,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=h,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ji(r,n,o,h){return new JI(r,n,o,h)}function fv(r){return r=r.prototype,!(!r||!r.isReactComponent)}function QI(r){if(typeof r=="function")return fv(r)?1:0;if(r!=null){if(r=r.$$typeof,r===D_)return 11;if(r===L_)return 14}return 2}function lo(r,n){var o=r.alternate;return o===null?(o=ji(r.tag,n,r.key,r.mode),o.elementType=r.elementType,o.type=r.type,o.stateNode=r.stateNode,o.alternate=r,r.alternate=o):(o.pendingProps=n,o.type=r.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=r.flags&14680064,o.childLanes=r.childLanes,o.lanes=r.lanes,o.child=r.child,o.memoizedProps=r.memoizedProps,o.memoizedState=r.memoizedState,o.updateQueue=r.updateQueue,n=r.dependencies,o.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},o.sibling=r.sibling,o.index=r.index,o.ref=r.ref,o}function sf(r,n,o,h,g,x){var v=2;if(h=r,typeof r=="function")fv(r)&&(v=1);else if(typeof r=="string")v=5;else e:switch(r){case vu:return il(o.children,g,x,n);case z_:v=8,g|=8;break;case oy:return r=ji(12,o,n,g|2),r.elementType=oy,r.lanes=x,r;case ly:return r=ji(13,o,n,g),r.elementType=ly,r.lanes=x,r;case uy:return r=ji(19,o,n,g),r.elementType=uy,r.lanes=x,r;case l1:return rm(o,g,x,n);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case a1:v=10;break e;case o1:v=9;break e;case D_:v=11;break e;case L_:v=14;break e;case Ha:v=16,h=null;break e}throw Error(Re(130,r==null?r:typeof r,""))}return n=ji(v,o,n,g),n.elementType=r,n.type=h,n.lanes=x,n}function il(r,n,o,h){return r=ji(7,r,h,n),r.lanes=o,r}function rm(r,n,o,h){return r=ji(22,r,h,n),r.elementType=l1,r.lanes=o,r.stateNode={isHidden:!1},r}function Kg(r,n,o){return r=ji(6,r,null,n),r.lanes=o,r}function Wg(r,n,o){return n=ji(4,r.children!==null?r.children:[],r.key,n),n.lanes=o,n.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},n}function eE(r,n,o,h,g){this.tag=n,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Cg(0),this.expirationTimes=Cg(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Cg(0),this.identifierPrefix=h,this.onRecoverableError=g,this.mutableSourceEagerHydrationData=null}function mv(r,n,o,h,g,x,v,u,C){return r=new eE(r,n,o,u,C),n===1?(n=1,x===!0&&(n|=8)):n=0,x=ji(3,null,null,n),r.current=x,x.stateNode=r,x.memoizedState={element:h,isDehydrated:o,cache:null,transitions:null,pendingSuspenseBoundaries:null},J_(x),r}function tE(r,n,o){var h=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:_u,key:h==null?null:""+h,children:r,containerInfo:n,implementation:o}}function Qb(r){if(!r)return co;r=r._reactInternals;e:{if(gl(r)!==r||r.tag!==1)throw Error(Re(170));var n=r;do{switch(n.tag){case 3:n=n.stateNode.context;break e;case 1:if(ri(n.type)){n=n.stateNode.__reactInternalMemoizedMergedChildContext;break e}}n=n.return}while(n!==null);throw Error(Re(171))}if(r.tag===1){var o=r.type;if(ri(o))return Q1(r,o,n)}return n}function e2(r,n,o,h,g,x,v,u,C){return r=mv(o,h,!0,r,g,x,v,u,C),r.context=Qb(null),o=r.current,h=Nn(),g=oo(o),x=ta(h,g),x.callback=n??null,so(o,x,g),r.current.lanes=g,cd(r,g,h),ni(r,h),r}function nm(r,n,o,h){var g=n.current,x=Nn(),v=oo(g);return o=Qb(o),n.context===null?n.context=o:n.pendingContext=o,n=ta(x,v),n.payload={element:r},h=h===void 0?null:h,h!==null&&(n.callback=h),r=so(g,n,v),r!==null&&(ns(r,g,v,x),Jp(r,g,v)),v}function Bf(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function xw(r,n){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var o=r.retryLane;r.retryLane=o!==0&&o<n?o:n}}function gv(r,n){xw(r,n),(r=r.alternate)&&xw(r,n)}function rE(){return null}var t2=typeof reportError=="function"?reportError:function(r){console.error(r)};function yv(r){this._internalRoot=r}im.prototype.render=yv.prototype.render=function(r){var n=this._internalRoot;if(n===null)throw Error(Re(409));nm(r,n,null,null)};im.prototype.unmount=yv.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var n=r.containerInfo;dl(function(){nm(null,r,null,null)}),n[sa]=null}};function im(r){this._internalRoot=r}im.prototype.unstable_scheduleHydration=function(r){if(r){var n=z1();r={blockedOn:null,target:r,priority:n};for(var o=0;o<Xa.length&&n!==0&&n<Xa[o].priority;o++);Xa.splice(o,0,r),o===0&&L1(r)}};function _v(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function sm(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function ww(){}function nE(r,n,o,h,g){if(g){if(typeof h=="function"){var x=h;h=function(){var O=Bf(v);x.call(O)}}var v=e2(n,h,r,0,null,!1,!1,"",ww);return r._reactRootContainer=v,r[sa]=v.current,Hh(r.nodeType===8?r.parentNode:r),dl(),v}for(;g=r.lastChild;)r.removeChild(g);if(typeof h=="function"){var u=h;h=function(){var O=Bf(C);u.call(O)}}var C=mv(r,0,!1,null,null,!1,!1,"",ww);return r._reactRootContainer=C,r[sa]=C.current,Hh(r.nodeType===8?r.parentNode:r),dl(function(){nm(n,C,o,h)}),C}function am(r,n,o,h,g){var x=o._reactRootContainer;if(x){var v=x;if(typeof g=="function"){var u=g;g=function(){var C=Bf(v);u.call(C)}}nm(n,v,r,g)}else v=nE(o,n,r,g,h);return Bf(v)}M1=function(r){switch(r.tag){case 3:var n=r.stateNode;if(n.current.memoizedState.isDehydrated){var o=vh(n.pendingLanes);o!==0&&(F_(n,o|1),ni(n,Ar()),!(Vt&6)&&(Zu=Ar()+500,yo()))}break;case 13:dl(function(){var h=aa(r,1);if(h!==null){var g=Nn();ns(h,r,1,g)}}),gv(r,1)}};O_=function(r){if(r.tag===13){var n=aa(r,134217728);if(n!==null){var o=Nn();ns(n,r,134217728,o)}gv(r,134217728)}};A1=function(r){if(r.tag===13){var n=oo(r),o=aa(r,n);if(o!==null){var h=Nn();ns(o,r,n,h)}gv(r,n)}};z1=function(){return Qt};D1=function(r,n){var o=Qt;try{return Qt=r,n()}finally{Qt=o}};vy=function(r,n,o){switch(n){case"input":if(dy(r,o),n=o.name,o.type==="radio"&&n!=null){for(o=r;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll("input[name="+JSON.stringify(""+n)+'][type="radio"]'),n=0;n<o.length;n++){var h=o[n];if(h!==r&&h.form===r.form){var g=Xf(h);if(!g)throw Error(Re(90));c1(h),dy(h,g)}}}break;case"textarea":d1(r,o);break;case"select":n=o.value,n!=null&&Mu(r,!!o.multiple,n,!1)}};v1=hv;x1=dl;var iE={usingClientEntryPoint:!1,Events:[dd,Su,Xf,y1,_1,hv]},ph={findFiberByHostInstance:Qo,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},sE={bundleType:ph.bundleType,version:ph.version,rendererPackageName:ph.rendererPackageName,rendererConfig:ph.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ua.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=S1(r),r===null?null:r.stateNode},findFiberByHostInstance:ph.findFiberByHostInstance||rE,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Rp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Rp.isDisabled&&Rp.supportsFiber)try{Gf=Rp.inject(sE),ks=Rp}catch{}}Ii.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=iE;Ii.createPortal=function(r,n){var o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!_v(n))throw Error(Re(200));return tE(r,n,null,o)};Ii.createRoot=function(r,n){if(!_v(r))throw Error(Re(299));var o=!1,h="",g=t2;return n!=null&&(n.unstable_strictMode===!0&&(o=!0),n.identifierPrefix!==void 0&&(h=n.identifierPrefix),n.onRecoverableError!==void 0&&(g=n.onRecoverableError)),n=mv(r,1,!1,null,null,o,!1,h,g),r[sa]=n.current,Hh(r.nodeType===8?r.parentNode:r),new yv(n)};Ii.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var n=r._reactInternals;if(n===void 0)throw typeof r.render=="function"?Error(Re(188)):(r=Object.keys(r).join(","),Error(Re(268,r)));return r=S1(n),r=r===null?null:r.stateNode,r};Ii.flushSync=function(r){return dl(r)};Ii.hydrate=function(r,n,o){if(!sm(n))throw Error(Re(200));return am(null,r,n,!0,o)};Ii.hydrateRoot=function(r,n,o){if(!_v(r))throw Error(Re(405));var h=o!=null&&o.hydratedSources||null,g=!1,x="",v=t2;if(o!=null&&(o.unstable_strictMode===!0&&(g=!0),o.identifierPrefix!==void 0&&(x=o.identifierPrefix),o.onRecoverableError!==void 0&&(v=o.onRecoverableError)),n=e2(n,null,r,1,o??null,g,!1,x,v),r[sa]=n.current,Hh(r),h)for(r=0;r<h.length;r++)o=h[r],g=o._getVersion,g=g(o._source),n.mutableSourceEagerHydrationData==null?n.mutableSourceEagerHydrationData=[o,g]:n.mutableSourceEagerHydrationData.push(o,g);return new im(n)};Ii.render=function(r,n,o){if(!sm(n))throw Error(Re(200));return am(null,r,n,!1,o)};Ii.unmountComponentAtNode=function(r){if(!sm(r))throw Error(Re(40));return r._reactRootContainer?(dl(function(){am(null,null,r,!1,function(){r._reactRootContainer=null,r[sa]=null})}),!0):!1};Ii.unstable_batchedUpdates=hv;Ii.unstable_renderSubtreeIntoContainer=function(r,n,o,h){if(!sm(o))throw Error(Re(200));if(r==null||r._reactInternals===void 0)throw Error(Re(38));return am(r,n,o,!1,h)};Ii.version="18.3.1-next-f1338f8080-20240426";function r2(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r2)}catch(r){console.error(r)}}r2(),r1.exports=Ii;var aE=r1.exports,bw=aE;sy.createRoot=bw.createRoot,sy.hydrateRoot=bw.hydrateRoot;const dr=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Or=Object.keys,En=Array.isArray;function jn(r,n){return typeof n!="object"||Or(n).forEach(function(o){r[o]=n[o]}),r}typeof Promise>"u"||dr.Promise||(dr.Promise=Promise);const rd=Object.getPrototypeOf,oE={}.hasOwnProperty;function Ti(r,n){return oE.call(r,n)}function Gu(r,n){typeof n=="function"&&(n=n(rd(r))),(typeof Reflect>"u"?Or:Reflect.ownKeys)(n).forEach(o=>{ra(r,o,n[o])})}const n2=Object.defineProperty;function ra(r,n,o,h){n2(r,n,jn(o&&Ti(o,"get")&&typeof o.get=="function"?{get:o.get,set:o.set,configurable:!0}:{value:o,configurable:!0,writable:!0},h))}function Bu(r){return{from:function(n){return r.prototype=Object.create(n.prototype),ra(r.prototype,"constructor",r),{extend:Gu.bind(null,r.prototype)}}}}const lE=Object.getOwnPropertyDescriptor;function vv(r,n){let o;return lE(r,n)||(o=rd(r))&&vv(o,n)}const uE=[].slice;function Ff(r,n,o){return uE.call(r,n,o)}function i2(r,n){return n(r)}function wh(r){if(!r)throw new Error("Assertion Failed")}function s2(r){dr.setImmediate?setImmediate(r):setTimeout(r,0)}function a2(r,n){return r.reduce((o,h,g)=>{var x=n(h,g);return x&&(o[x[0]]=x[1]),o},{})}function na(r,n){if(typeof n=="string"&&Ti(r,n))return r[n];if(!n)return r;if(typeof n!="string"){for(var o=[],h=0,g=n.length;h<g;++h){var x=na(r,n[h]);o.push(x)}return o}var v=n.indexOf(".");if(v!==-1){var u=r[n.substr(0,v)];return u==null?void 0:na(u,n.substr(v+1))}}function is(r,n,o){if(r&&n!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(r)))if(typeof n!="string"&&"length"in n){wh(typeof o!="string"&&"length"in o);for(var h=0,g=n.length;h<g;++h)is(r,n[h],o[h])}else{var x=n.indexOf(".");if(x!==-1){var v=n.substr(0,x),u=n.substr(x+1);if(u==="")o===void 0?En(r)&&!isNaN(parseInt(v))?r.splice(v,1):delete r[v]:r[v]=o;else{var C=r[v];C&&Ti(r,v)||(C=r[v]={}),is(C,u,o)}}else o===void 0?En(r)&&!isNaN(parseInt(n))?r.splice(n,1):delete r[n]:r[n]=o}}function o2(r){var n={};for(var o in r)Ti(r,o)&&(n[o]=r[o]);return n}const cE=[].concat;function l2(r){return cE.apply([],r)}const u2="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(l2([8,16,32,64].map(r=>["Int","Uint","Float"].map(n=>n+r+"Array")))).filter(r=>dr[r]),hE=u2.map(r=>dr[r]);a2(u2,r=>[r,!0]);let Wa=null;function fd(r){Wa=typeof WeakMap<"u"&&new WeakMap;const n=Jy(r);return Wa=null,n}function Jy(r){if(!r||typeof r!="object")return r;let n=Wa&&Wa.get(r);if(n)return n;if(En(r)){n=[],Wa&&Wa.set(r,n);for(var o=0,h=r.length;o<h;++o)n.push(Jy(r[o]))}else if(hE.indexOf(r.constructor)>=0)n=r;else{const x=rd(r);for(var g in n=x===Object.prototype?{}:Object.create(x),Wa&&Wa.set(r,n),r)Ti(r,g)&&(n[g]=Jy(r[g]))}return n}const{toString:dE}={};function Qy(r){return dE.call(r).slice(8,-1)}const e_=typeof Symbol<"u"?Symbol.iterator:"@@iterator",pE=typeof e_=="symbol"?function(r){var n;return r!=null&&(n=r[e_])&&n.apply(r)}:function(){return null},gu={};function Ys(r){var n,o,h,g;if(arguments.length===1){if(En(r))return r.slice();if(this===gu&&typeof r=="string")return[r];if(g=pE(r)){for(o=[];!(h=g.next()).done;)o.push(h.value);return o}if(r==null)return[r];if(typeof(n=r.length)=="number"){for(o=new Array(n);n--;)o[n]=r[n];return o}return[r]}for(n=arguments.length,o=new Array(n);n--;)o[n]=arguments[n];return o}const xv=typeof Symbol<"u"?r=>r[Symbol.toStringTag]==="AsyncFunction":()=>!1;var Is=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function c2(r,n){Is=r,h2=n}var h2=()=>!0;const fE=!new Error("").stack;function yl(){if(fE)try{throw yl.arguments,new Error}catch(r){return r}return new Error}function t_(r,n){var o=r.stack;return o?(n=n||0,o.indexOf(r.name)===0&&(n+=(r.name+r.message).split(`
`).length),o.split(`
`).slice(n).filter(h2).map(h=>`
`+h).join("")):""}var d2=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],wv=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(d2),mE={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Fu(r,n){this._e=yl(),this.name=r,this.message=n}function p2(r,n){return r+". Errors: "+Object.keys(n).map(o=>n[o].toString()).filter((o,h,g)=>g.indexOf(o)===h).join(`
`)}function Of(r,n,o,h){this._e=yl(),this.failures=n,this.failedKeys=h,this.successCount=o,this.message=p2(r,n)}function Lh(r,n){this._e=yl(),this.name="BulkError",this.failures=Object.keys(n).map(o=>n[o]),this.failuresByPos=n,this.message=p2(r,n)}Bu(Fu).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+t_(this._e,2))}},toString:function(){return this.name+": "+this.message}}),Bu(Of).from(Fu),Bu(Lh).from(Fu);var bv=wv.reduce((r,n)=>(r[n]=n+"Error",r),{});const gE=Fu;var xt=wv.reduce((r,n)=>{var o=n+"Error";function h(g,x){this._e=yl(),this.name=o,g?typeof g=="string"?(this.message=`${g}${x?`
 `+x:""}`,this.inner=x||null):typeof g=="object"&&(this.message=`${g.name} ${g.message}`,this.inner=g):(this.message=mE[n]||o,this.inner=null)}return Bu(h).from(gE),r[n]=h,r},{});xt.Syntax=SyntaxError,xt.Type=TypeError,xt.Range=RangeError;var Sw=d2.reduce((r,n)=>(r[n+"Error"]=xt[n],r),{}),af=wv.reduce((r,n)=>(["Syntax","Type","Range"].indexOf(n)===-1&&(r[n+"Error"]=xt[n]),r),{});function ar(){}function nd(r){return r}function yE(r,n){return r==null||r===nd?n:function(o){return n(r(o))}}function pl(r,n){return function(){r.apply(this,arguments),n.apply(this,arguments)}}function _E(r,n){return r===ar?n:function(){var o=r.apply(this,arguments);o!==void 0&&(arguments[0]=o);var h=this.onsuccess,g=this.onerror;this.onsuccess=null,this.onerror=null;var x=n.apply(this,arguments);return h&&(this.onsuccess=this.onsuccess?pl(h,this.onsuccess):h),g&&(this.onerror=this.onerror?pl(g,this.onerror):g),x!==void 0?x:o}}function vE(r,n){return r===ar?n:function(){r.apply(this,arguments);var o=this.onsuccess,h=this.onerror;this.onsuccess=this.onerror=null,n.apply(this,arguments),o&&(this.onsuccess=this.onsuccess?pl(o,this.onsuccess):o),h&&(this.onerror=this.onerror?pl(h,this.onerror):h)}}function xE(r,n){return r===ar?n:function(o){var h=r.apply(this,arguments);jn(o,h);var g=this.onsuccess,x=this.onerror;this.onsuccess=null,this.onerror=null;var v=n.apply(this,arguments);return g&&(this.onsuccess=this.onsuccess?pl(g,this.onsuccess):g),x&&(this.onerror=this.onerror?pl(x,this.onerror):x),h===void 0?v===void 0?void 0:v:jn(h,v)}}function wE(r,n){return r===ar?n:function(){return n.apply(this,arguments)!==!1&&r.apply(this,arguments)}}function Sv(r,n){return r===ar?n:function(){var o=r.apply(this,arguments);if(o&&typeof o.then=="function"){for(var h=this,g=arguments.length,x=new Array(g);g--;)x[g]=arguments[g];return o.then(function(){return n.apply(h,x)})}return n.apply(this,arguments)}}af.ModifyError=Of,af.DexieError=Fu,af.BulkError=Lh;var id={};const f2=100,[r_,Nf,n_]=typeof Promise>"u"?[]:(()=>{let r=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[r,rd(r),r];const n=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[n,rd(n),r]})(),m2=Nf&&Nf.then,of=r_&&r_.constructor,kv=!!n_;var i_=!1,bE=n_?()=>{n_.then(Bp)}:dr.setImmediate?setImmediate.bind(null,Bp):dr.MutationObserver?()=>{var r=document.createElement("div");new MutationObserver(()=>{Bp(),r=null}).observe(r,{attributes:!0}),r.setAttribute("i","1")}:()=>{setTimeout(Bp,0)},Rh=function(r,n){bh.push([r,n]),jf&&(bE(),jf=!1)},s_=!0,jf=!0,sl=[],lf=[],a_=null,o_=nd,Ou={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Iw,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(r=>{try{Iw(r[0],r[1])}catch{}})}},yt=Ou,bh=[],al=0,uf=[];function st(r){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=ar,this._lib=!1;var n=this._PSD=yt;if(Is&&(this._stackHolder=yl(),this._prev=null,this._numPrev=0),typeof r!="function"){if(r!==id)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&u_(this,this._value))}this._state=null,this._value=null,++n.ref,y2(this,r)}const l_={get:function(){var r=yt,n=Vf;function o(h,g){var x=!r.global&&(r!==yt||n!==Vf);const v=x&&!la();var u=new st((C,O)=>{Tv(this,new g2(Uf(h,r,x,v),Uf(g,r,x,v),C,O,r))});return Is&&x2(u,this),u}return o.prototype=id,o},set:function(r){ra(this,"then",r&&r.prototype===id?l_:{get:function(){return r},set:l_.set})}};function g2(r,n,o,h,g){this.onFulfilled=typeof r=="function"?r:null,this.onRejected=typeof n=="function"?n:null,this.resolve=o,this.reject=h,this.psd=g}function y2(r,n){try{n(o=>{if(r._state===null){if(o===r)throw new TypeError("A promise cannot be resolved with itself.");var h=r._lib&&md();o&&typeof o.then=="function"?y2(r,(g,x)=>{o instanceof st?o._then(g,x):o.then(g,x)}):(r._state=!0,r._value=o,_2(r)),h&&gd()}},u_.bind(null,r))}catch(o){u_(r,o)}}function u_(r,n){if(lf.push(n),r._state===null){var o=r._lib&&md();n=o_(n),r._state=!1,r._value=n,Is&&n!==null&&typeof n=="object"&&!n._promise&&function(h,g,x){try{h.apply(null,x)}catch{}}(()=>{var h=vv(n,"stack");n._promise=r,ra(n,"stack",{get:()=>i_?h&&(h.get?h.get.apply(n):h.value):r.stack})}),function(h){sl.some(g=>g._value===h._value)||sl.push(h)}(r),_2(r),o&&gd()}}function _2(r){var n=r._listeners;r._listeners=[];for(var o=0,h=n.length;o<h;++o)Tv(r,n[o]);var g=r._PSD;--g.ref||g.finalize(),al===0&&(++al,Rh(()=>{--al==0&&Iv()},[]))}function Tv(r,n){if(r._state!==null){var o=r._state?n.onFulfilled:n.onRejected;if(o===null)return(r._state?n.resolve:n.reject)(r._value);++n.psd.ref,++al,Rh(SE,[o,r,n])}else r._listeners.push(n)}function SE(r,n,o){try{a_=n;var h,g=n._value;n._state?h=r(g):(lf.length&&(lf=[]),h=r(g),lf.indexOf(g)===-1&&function(x){for(var v=sl.length;v;)if(sl[--v]._value===x._value)return void sl.splice(v,1)}(n)),o.resolve(h)}catch(x){o.reject(x)}finally{a_=null,--al==0&&Iv(),--o.psd.ref||o.psd.finalize()}}function v2(r,n,o){if(n.length===o)return n;var h="";if(r._state===!1){var g,x,v=r._value;v!=null?(g=v.name||"Error",x=v.message||v,h=t_(v,0)):(g=v,x=""),n.push(g+(x?": "+x:"")+h)}return Is&&((h=t_(r._stackHolder,2))&&n.indexOf(h)===-1&&n.push(h),r._prev&&v2(r._prev,n,o)),n}function x2(r,n){var o=n?n._numPrev+1:0;o<100&&(r._prev=n,r._numPrev=o)}function Bp(){md()&&gd()}function md(){var r=s_;return s_=!1,jf=!1,r}function gd(){var r,n,o;do for(;bh.length>0;)for(r=bh,bh=[],o=r.length,n=0;n<o;++n){var h=r[n];h[0].apply(null,h[1])}while(bh.length>0);s_=!0,jf=!0}function Iv(){var r=sl;sl=[],r.forEach(h=>{h._PSD.onunhandled.call(null,h._value,h)});for(var n=uf.slice(0),o=n.length;o;)n[--o]()}function Fp(r){return new st(id,!1,r)}function yr(r,n){var o=yt;return function(){var h=md(),g=yt;try{return po(o,!0),r.apply(this,arguments)}catch(x){n&&n(x)}finally{po(g,!1),h&&gd()}}}Gu(st.prototype,{then:l_,_then:function(r,n){Tv(this,new g2(null,null,r,n,yt))},catch:function(r){if(arguments.length===1)return this.then(null,r);var n=arguments[0],o=arguments[1];return typeof n=="function"?this.then(null,h=>h instanceof n?o(h):Fp(h)):this.then(null,h=>h&&h.name===n?o(h):Fp(h))},finally:function(r){return this.then(n=>(r(),n),n=>(r(),Fp(n)))},stack:{get:function(){if(this._stack)return this._stack;try{i_=!0;var r=v2(this,[],20).join(`
From previous: `);return this._state!==null&&(this._stack=r),r}finally{i_=!1}}},timeout:function(r,n){return r<1/0?new st((o,h)=>{var g=setTimeout(()=>h(new xt.Timeout(n)),r);this.then(o,h).finally(clearTimeout.bind(null,g))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&ra(st.prototype,Symbol.toStringTag,"Dexie.Promise"),Ou.env=w2(),Gu(st,{all:function(){var r=Ys.apply(null,arguments).map(Op);return new st(function(n,o){r.length===0&&n([]);var h=r.length;r.forEach((g,x)=>st.resolve(g).then(v=>{r[x]=v,--h||n(r)},o))})},resolve:r=>{if(r instanceof st)return r;if(r&&typeof r.then=="function")return new st((o,h)=>{r.then(o,h)});var n=new st(id,!0,r);return x2(n,a_),n},reject:Fp,race:function(){var r=Ys.apply(null,arguments).map(Op);return new st((n,o)=>{r.map(h=>st.resolve(h).then(n,o))})},PSD:{get:()=>yt,set:r=>yt=r},totalEchoes:{get:()=>Vf},newPSD:ho,usePSD:Yu,scheduler:{get:()=>Rh,set:r=>{Rh=r}},rejectionMapper:{get:()=>o_,set:r=>{o_=r}},follow:(r,n)=>new st((o,h)=>ho((g,x)=>{var v=yt;v.unhandleds=[],v.onunhandled=x,v.finalize=pl(function(){(function(u){function C(){u(),uf.splice(uf.indexOf(C),1)}uf.push(C),++al,Rh(()=>{--al==0&&Iv()},[])})(()=>{this.unhandleds.length===0?g():x(this.unhandleds[0])})},v.finalize),r()},n,o,h))}),of&&(of.allSettled&&ra(st,"allSettled",function(){const r=Ys.apply(null,arguments).map(Op);return new st(n=>{r.length===0&&n([]);let o=r.length;const h=new Array(o);r.forEach((g,x)=>st.resolve(g).then(v=>h[x]={status:"fulfilled",value:v},v=>h[x]={status:"rejected",reason:v}).then(()=>--o||n(h)))})}),of.any&&typeof AggregateError<"u"&&ra(st,"any",function(){const r=Ys.apply(null,arguments).map(Op);return new st((n,o)=>{r.length===0&&o(new AggregateError([]));let h=r.length;const g=new Array(h);r.forEach((x,v)=>st.resolve(x).then(u=>n(u),u=>{g[v]=u,--h||o(new AggregateError(g))}))})}));const In={awaits:0,echoes:0,id:0};var kE=0,cf=[],Xg=0,Vf=0,TE=0;function ho(r,n,o,h){var g=yt,x=Object.create(g);x.parent=g,x.ref=0,x.global=!1,x.id=++TE;var v=Ou.env;x.env=kv?{Promise:st,PromiseProp:{value:st,configurable:!0,writable:!0},all:st.all,race:st.race,allSettled:st.allSettled,any:st.any,resolve:st.resolve,reject:st.reject,nthen:kw(v.nthen,x),gthen:kw(v.gthen,x)}:{},n&&jn(x,n),++g.ref,x.finalize=function(){--this.parent.ref||this.parent.finalize()};var u=Yu(x,r,o,h);return x.ref===0&&x.finalize(),u}function Xu(){return In.id||(In.id=++kE),++In.awaits,In.echoes+=f2,In.id}function la(){return!!In.awaits&&(--In.awaits==0&&(In.id=0),In.echoes=In.awaits*f2,!0)}function Op(r){return In.echoes&&r&&r.constructor===of?(Xu(),r.then(n=>(la(),n),n=>(la(),qr(n)))):r}function IE(r){++Vf,In.echoes&&--In.echoes!=0||(In.echoes=In.id=0),cf.push(yt),po(r,!0)}function EE(){var r=cf[cf.length-1];cf.pop(),po(r,!1)}function po(r,n){var o=yt;if((n?!In.echoes||Xg++&&r===yt:!Xg||--Xg&&r===yt)||b2(n?IE.bind(null,r):EE),r!==yt&&(yt=r,o===Ou&&(Ou.env=w2()),kv)){var h=Ou.env.Promise,g=r.env;Nf.then=g.nthen,h.prototype.then=g.gthen,(o.global||r.global)&&(Object.defineProperty(dr,"Promise",g.PromiseProp),h.all=g.all,h.race=g.race,h.resolve=g.resolve,h.reject=g.reject,g.allSettled&&(h.allSettled=g.allSettled),g.any&&(h.any=g.any))}}function w2(){var r=dr.Promise;return kv?{Promise:r,PromiseProp:Object.getOwnPropertyDescriptor(dr,"Promise"),all:r.all,race:r.race,allSettled:r.allSettled,any:r.any,resolve:r.resolve,reject:r.reject,nthen:Nf.then,gthen:r.prototype.then}:{}}function Yu(r,n,o,h,g){var x=yt;try{return po(r,!0),n(o,h,g)}finally{po(x,!1)}}function b2(r){m2.call(r_,r)}function Uf(r,n,o,h){return typeof r!="function"?r:function(){var g=yt;o&&Xu(),po(n,!0);try{return r.apply(this,arguments)}finally{po(g,!1),h&&b2(la)}}}function kw(r,n){return function(o,h){return r.call(this,Uf(o,n),Uf(h,n))}}(""+m2).indexOf("[native code]")===-1&&(Xu=la=ar);const Tw="unhandledrejection";function Iw(r,n){var o;try{o=n.onuncatched(r)}catch{}if(o!==!1)try{var h,g={promise:n,reason:r};if(dr.document&&document.createEvent?((h=document.createEvent("Event")).initEvent(Tw,!0,!0),jn(h,g)):dr.CustomEvent&&jn(h=new CustomEvent(Tw,{detail:g}),g),h&&dr.dispatchEvent&&(dispatchEvent(h),!dr.PromiseRejectionEvent&&dr.onunhandledrejection))try{dr.onunhandledrejection(h)}catch{}Is&&h&&!h.defaultPrevented&&console.warn(`Unhandled rejection: ${r.stack||r}`)}catch{}}var qr=st.reject;function c_(r,n,o,h){if(r.idbdb&&(r._state.openComplete||yt.letThrough||r._vip)){var g=r._createTransaction(n,o,r._dbSchema);try{g.create(),r._state.PR1398_maxLoop=3}catch(x){return x.name===bv.InvalidState&&r.isOpen()&&--r._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),r._close(),r.open().then(()=>c_(r,n,o,h))):qr(x)}return g._promise(n,(x,v)=>ho(()=>(yt.trans=g,h(x,v,g)))).then(x=>g._completion.then(()=>x))}if(r._state.openComplete)return qr(new xt.DatabaseClosed(r._state.dbOpenError));if(!r._state.isBeingOpened){if(!r._options.autoOpen)return qr(new xt.DatabaseClosed);r.open().catch(ar)}return r._state.dbReadyPromise.then(()=>c_(r,n,o,h))}const Ew="3.2.7",rl="",h_=-1/0,Hs="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",S2="String expected.",Bh=[],om=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),PE=om,CE=om,k2=r=>!/(dexie\.js|dexie\.min\.js)/.test(r),lm="__dbnames",Yg="readonly",Jg="readwrite";function fl(r,n){return r?n?function(){return r.apply(this,arguments)&&n.apply(this,arguments)}:r:n}const T2={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Np(r){return typeof r!="string"||/\./.test(r)?n=>n:n=>(n[r]===void 0&&r in n&&delete(n=fd(n))[r],n)}class ME{_trans(n,o,h){const g=this._tx||yt.trans,x=this.name;function v(C,O,U){if(!U.schema[x])throw new xt.NotFound("Table "+x+" not part of transaction");return o(U.idbtrans,U)}const u=md();try{return g&&g.db===this.db?g===yt.trans?g._promise(n,v,h):ho(()=>g._promise(n,v,h),{trans:g,transless:yt.transless||yt}):c_(this.db,n,[this.name],v)}finally{u&&gd()}}get(n,o){return n&&n.constructor===Object?this.where(n).first(o):this._trans("readonly",h=>this.core.get({trans:h,key:n}).then(g=>this.hook.reading.fire(g))).then(o)}where(n){if(typeof n=="string")return new this.db.WhereClause(this,n);if(En(n))return new this.db.WhereClause(this,`[${n.join("+")}]`);const o=Or(n);if(o.length===1)return this.where(o[0]).equals(n[o[0]]);const h=this.schema.indexes.concat(this.schema.primKey).filter(O=>{if(O.compound&&o.every(U=>O.keyPath.indexOf(U)>=0)){for(let U=0;U<o.length;++U)if(o.indexOf(O.keyPath[U])===-1)return!1;return!0}return!1}).sort((O,U)=>O.keyPath.length-U.keyPath.length)[0];if(h&&this.db._maxKey!==rl){const O=h.keyPath.slice(0,o.length);return this.where(O).equals(O.map(U=>n[U]))}!h&&Is&&console.warn(`The query ${JSON.stringify(n)} on ${this.name} would benefit of a compound index [${o.join("+")}]`);const{idxByName:g}=this.schema,x=this.db._deps.indexedDB;function v(O,U){try{return x.cmp(O,U)===0}catch{return!1}}const[u,C]=o.reduce(([O,U],j)=>{const L=g[j],oe=n[j];return[O||L,O||!L?fl(U,L&&L.multi?de=>{const he=na(de,j);return En(he)&&he.some(Ie=>v(oe,Ie))}:de=>v(oe,na(de,j))):U]},[null,null]);return u?this.where(u.name).equals(n[u.keyPath]).filter(C):h?this.filter(C):this.where(o).equals("")}filter(n){return this.toCollection().and(n)}count(n){return this.toCollection().count(n)}offset(n){return this.toCollection().offset(n)}limit(n){return this.toCollection().limit(n)}each(n){return this.toCollection().each(n)}toArray(n){return this.toCollection().toArray(n)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(n){return new this.db.Collection(new this.db.WhereClause(this,En(n)?`[${n.join("+")}]`:n))}reverse(){return this.toCollection().reverse()}mapToClass(n){this.schema.mappedClass=n;const o=h=>{if(!h)return h;const g=Object.create(n.prototype);for(var x in h)if(Ti(h,x))try{g[x]=h[x]}catch{}return g};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=o,this.hook("reading",o),n}defineClass(){return this.mapToClass(function(n){jn(this,n)})}add(n,o){const{auto:h,keyPath:g}=this.schema.primKey;let x=n;return g&&h&&(x=Np(g)(n)),this._trans("readwrite",v=>this.core.mutate({trans:v,type:"add",keys:o!=null?[o]:null,values:[x]})).then(v=>v.numFailures?st.reject(v.failures[0]):v.lastResult).then(v=>{if(g)try{is(n,g,v)}catch{}return v})}update(n,o){if(typeof n!="object"||En(n))return this.where(":id").equals(n).modify(o);{const h=na(n,this.schema.primKey.keyPath);if(h===void 0)return qr(new xt.InvalidArgument("Given object does not contain its primary key"));try{typeof o!="function"?Or(o).forEach(g=>{is(n,g,o[g])}):o(n,{value:n,primKey:h})}catch{}return this.where(":id").equals(h).modify(o)}}put(n,o){const{auto:h,keyPath:g}=this.schema.primKey;let x=n;return g&&h&&(x=Np(g)(n)),this._trans("readwrite",v=>this.core.mutate({trans:v,type:"put",values:[x],keys:o!=null?[o]:null})).then(v=>v.numFailures?st.reject(v.failures[0]):v.lastResult).then(v=>{if(g)try{is(n,g,v)}catch{}return v})}delete(n){return this._trans("readwrite",o=>this.core.mutate({trans:o,type:"delete",keys:[n]})).then(o=>o.numFailures?st.reject(o.failures[0]):void 0)}clear(){return this._trans("readwrite",n=>this.core.mutate({trans:n,type:"deleteRange",range:T2})).then(n=>n.numFailures?st.reject(n.failures[0]):void 0)}bulkGet(n){return this._trans("readonly",o=>this.core.getMany({keys:n,trans:o}).then(h=>h.map(g=>this.hook.reading.fire(g))))}bulkAdd(n,o,h){const g=Array.isArray(o)?o:void 0,x=(h=h||(g?void 0:o))?h.allKeys:void 0;return this._trans("readwrite",v=>{const{auto:u,keyPath:C}=this.schema.primKey;if(C&&g)throw new xt.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(g&&g.length!==n.length)throw new xt.InvalidArgument("Arguments objects and keys must have the same length");const O=n.length;let U=C&&u?n.map(Np(C)):n;return this.core.mutate({trans:v,type:"add",keys:g,values:U,wantResults:x}).then(({numFailures:j,results:L,lastResult:oe,failures:de})=>{if(j===0)return x?L:oe;throw new Lh(`${this.name}.bulkAdd(): ${j} of ${O} operations failed`,de)})})}bulkPut(n,o,h){const g=Array.isArray(o)?o:void 0,x=(h=h||(g?void 0:o))?h.allKeys:void 0;return this._trans("readwrite",v=>{const{auto:u,keyPath:C}=this.schema.primKey;if(C&&g)throw new xt.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(g&&g.length!==n.length)throw new xt.InvalidArgument("Arguments objects and keys must have the same length");const O=n.length;let U=C&&u?n.map(Np(C)):n;return this.core.mutate({trans:v,type:"put",keys:g,values:U,wantResults:x}).then(({numFailures:j,results:L,lastResult:oe,failures:de})=>{if(j===0)return x?L:oe;throw new Lh(`${this.name}.bulkPut(): ${j} of ${O} operations failed`,de)})})}bulkDelete(n){const o=n.length;return this._trans("readwrite",h=>this.core.mutate({trans:h,type:"delete",keys:n})).then(({numFailures:h,lastResult:g,failures:x})=>{if(h===0)return g;throw new Lh(`${this.name}.bulkDelete(): ${h} of ${o} operations failed`,x)})}}function Fh(r){var n={},o=function(v,u){if(u){for(var C=arguments.length,O=new Array(C-1);--C;)O[C-1]=arguments[C];return n[v].subscribe.apply(null,O),r}if(typeof v=="string")return n[v]};o.addEventType=x;for(var h=1,g=arguments.length;h<g;++h)x(arguments[h]);return o;function x(v,u,C){if(typeof v!="object"){var O;u||(u=wE),C||(C=ar);var U={subscribers:[],fire:C,subscribe:function(j){U.subscribers.indexOf(j)===-1&&(U.subscribers.push(j),U.fire=u(U.fire,j))},unsubscribe:function(j){U.subscribers=U.subscribers.filter(function(L){return L!==j}),U.fire=U.subscribers.reduce(u,C)}};return n[v]=o[v]=U,U}Or(O=v).forEach(function(j){var L=O[j];if(En(L))x(j,O[j][0],O[j][1]);else{if(L!=="asap")throw new xt.InvalidArgument("Invalid event config");var oe=x(j,nd,function(){for(var de=arguments.length,he=new Array(de);de--;)he[de]=arguments[de];oe.subscribers.forEach(function(Ie){s2(function(){Ie.apply(null,he)})})})}})}}function fh(r,n){return Bu(n).from({prototype:r}),n}function pu(r,n){return!(r.filter||r.algorithm||r.or)&&(n?r.justLimit:!r.replayFilter)}function Qg(r,n){r.filter=fl(r.filter,n)}function ey(r,n,o){var h=r.replayFilter;r.replayFilter=h?()=>fl(h(),n()):n,r.justLimit=o&&!h}function hf(r,n){if(r.isPrimKey)return n.primaryKey;const o=n.getIndexByKeyPath(r.index);if(!o)throw new xt.Schema("KeyPath "+r.index+" on object store "+n.name+" is not indexed");return o}function Pw(r,n,o){const h=hf(r,n.schema);return n.openCursor({trans:o,values:!r.keysOnly,reverse:r.dir==="prev",unique:!!r.unique,query:{index:h,range:r.range}})}function jp(r,n,o,h){const g=r.replayFilter?fl(r.filter,r.replayFilter()):r.filter;if(r.or){const x={},v=(u,C,O)=>{if(!g||g(C,O,L=>C.stop(L),L=>C.fail(L))){var U=C.primaryKey,j=""+U;j==="[object ArrayBuffer]"&&(j=""+new Uint8Array(U)),Ti(x,j)||(x[j]=!0,n(u,C,O))}};return Promise.all([r.or._iterate(v,o),Cw(Pw(r,h,o),r.algorithm,v,!r.keysOnly&&r.valueMapper)])}return Cw(Pw(r,h,o),fl(r.algorithm,g),n,!r.keysOnly&&r.valueMapper)}function Cw(r,n,o,h){var g=yr(h?(x,v,u)=>o(h(x),v,u):o);return r.then(x=>{if(x)return x.start(()=>{var v=()=>x.continue();n&&!n(x,u=>v=u,u=>{x.stop(u),v=ar},u=>{x.fail(u),v=ar})||g(x.value,x,u=>v=u),v()})})}function On(r,n){try{const o=Mw(r),h=Mw(n);if(o!==h)return o==="Array"?1:h==="Array"?-1:o==="binary"?1:h==="binary"?-1:o==="string"?1:h==="string"?-1:o==="Date"?1:h!=="Date"?NaN:-1;switch(o){case"number":case"Date":case"string":return r>n?1:r<n?-1:0;case"binary":return function(g,x){const v=g.length,u=x.length,C=v<u?v:u;for(let O=0;O<C;++O)if(g[O]!==x[O])return g[O]<x[O]?-1:1;return v===u?0:v<u?-1:1}(Aw(r),Aw(n));case"Array":return function(g,x){const v=g.length,u=x.length,C=v<u?v:u;for(let O=0;O<C;++O){const U=On(g[O],x[O]);if(U!==0)return U}return v===u?0:v<u?-1:1}(r,n)}}catch{}return NaN}function Mw(r){const n=typeof r;if(n!=="object")return n;if(ArrayBuffer.isView(r))return"binary";const o=Qy(r);return o==="ArrayBuffer"?"binary":o}function Aw(r){return r instanceof Uint8Array?r:ArrayBuffer.isView(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r)}class AE{_read(n,o){var h=this._ctx;return h.error?h.table._trans(null,qr.bind(null,h.error)):h.table._trans("readonly",n).then(o)}_write(n){var o=this._ctx;return o.error?o.table._trans(null,qr.bind(null,o.error)):o.table._trans("readwrite",n,"locked")}_addAlgorithm(n){var o=this._ctx;o.algorithm=fl(o.algorithm,n)}_iterate(n,o){return jp(this._ctx,n,o,this._ctx.table.core)}clone(n){var o=Object.create(this.constructor.prototype),h=Object.create(this._ctx);return n&&jn(h,n),o._ctx=h,o}raw(){return this._ctx.valueMapper=null,this}each(n){var o=this._ctx;return this._read(h=>jp(o,n,h,o.table.core))}count(n){return this._read(o=>{const h=this._ctx,g=h.table.core;if(pu(h,!0))return g.count({trans:o,query:{index:hf(h,g.schema),range:h.range}}).then(v=>Math.min(v,h.limit));var x=0;return jp(h,()=>(++x,!1),o,g).then(()=>x)}).then(n)}sortBy(n,o){const h=n.split(".").reverse(),g=h[0],x=h.length-1;function v(O,U){return U?v(O[h[U]],U-1):O[g]}var u=this._ctx.dir==="next"?1:-1;function C(O,U){var j=v(O,x),L=v(U,x);return j<L?-u:j>L?u:0}return this.toArray(function(O){return O.sort(C)}).then(o)}toArray(n){return this._read(o=>{var h=this._ctx;if(h.dir==="next"&&pu(h,!0)&&h.limit>0){const{valueMapper:g}=h,x=hf(h,h.table.core.schema);return h.table.core.query({trans:o,limit:h.limit,values:!0,query:{index:x,range:h.range}}).then(({result:v})=>g?v.map(g):v)}{const g=[];return jp(h,x=>g.push(x),o,h.table.core).then(()=>g)}},n)}offset(n){var o=this._ctx;return n<=0||(o.offset+=n,pu(o)?ey(o,()=>{var h=n;return(g,x)=>h===0||(h===1?(--h,!1):(x(()=>{g.advance(h),h=0}),!1))}):ey(o,()=>{var h=n;return()=>--h<0})),this}limit(n){return this._ctx.limit=Math.min(this._ctx.limit,n),ey(this._ctx,()=>{var o=n;return function(h,g,x){return--o<=0&&g(x),o>=0}},!0),this}until(n,o){return Qg(this._ctx,function(h,g,x){return!n(h.value)||(g(x),o)}),this}first(n){return this.limit(1).toArray(function(o){return o[0]}).then(n)}last(n){return this.reverse().first(n)}filter(n){var o,h;return Qg(this._ctx,function(g){return n(g.value)}),o=this._ctx,h=n,o.isMatch=fl(o.isMatch,h),this}and(n){return this.filter(n)}or(n){return new this.db.WhereClause(this._ctx.table,n,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(n){var o=this._ctx;return o.keysOnly=!o.isMatch,this.each(function(h,g){n(g.key,g)})}eachUniqueKey(n){return this._ctx.unique="unique",this.eachKey(n)}eachPrimaryKey(n){var o=this._ctx;return o.keysOnly=!o.isMatch,this.each(function(h,g){n(g.primaryKey,g)})}keys(n){var o=this._ctx;o.keysOnly=!o.isMatch;var h=[];return this.each(function(g,x){h.push(x.key)}).then(function(){return h}).then(n)}primaryKeys(n){var o=this._ctx;if(o.dir==="next"&&pu(o,!0)&&o.limit>0)return this._read(g=>{var x=hf(o,o.table.core.schema);return o.table.core.query({trans:g,values:!1,limit:o.limit,query:{index:x,range:o.range}})}).then(({result:g})=>g).then(n);o.keysOnly=!o.isMatch;var h=[];return this.each(function(g,x){h.push(x.primaryKey)}).then(function(){return h}).then(n)}uniqueKeys(n){return this._ctx.unique="unique",this.keys(n)}firstKey(n){return this.limit(1).keys(function(o){return o[0]}).then(n)}lastKey(n){return this.reverse().firstKey(n)}distinct(){var n=this._ctx,o=n.index&&n.table.schema.idxByName[n.index];if(!o||!o.multi)return this;var h={};return Qg(this._ctx,function(g){var x=g.primaryKey.toString(),v=Ti(h,x);return h[x]=!0,!v}),this}modify(n){var o=this._ctx;return this._write(h=>{var g;if(typeof n=="function")g=n;else{var x=Or(n),v=x.length;g=function(he){for(var Ie=!1,K=0;K<v;++K){var G=x[K],ee=n[G];na(he,G)!==ee&&(is(he,G,ee),Ie=!0)}return Ie}}const u=o.table.core,{outbound:C,extractKey:O}=u.schema.primaryKey,U=this.db._options.modifyChunkSize||200,j=[];let L=0;const oe=[],de=(he,Ie)=>{const{failures:K,numFailures:G}=Ie;L+=he-G;for(let ee of Or(K))j.push(K[ee])};return this.clone().primaryKeys().then(he=>{const Ie=K=>{const G=Math.min(U,he.length-K);return u.getMany({trans:h,keys:he.slice(K,K+G),cache:"immutable"}).then(ee=>{const _e=[],Se=[],Te=C?[]:null,xe=[];for(let Ce=0;Ce<G;++Ce){const rt=ee[Ce],Ye={value:fd(rt),primKey:he[K+Ce]};g.call(Ye,Ye.value,Ye)!==!1&&(Ye.value==null?xe.push(he[K+Ce]):C||On(O(rt),O(Ye.value))===0?(Se.push(Ye.value),C&&Te.push(he[K+Ce])):(xe.push(he[K+Ce]),_e.push(Ye.value)))}const Pe=pu(o)&&o.limit===1/0&&(typeof n!="function"||n===ty)&&{index:o.index,range:o.range};return Promise.resolve(_e.length>0&&u.mutate({trans:h,type:"add",values:_e}).then(Ce=>{for(let rt in Ce.failures)xe.splice(parseInt(rt),1);de(_e.length,Ce)})).then(()=>(Se.length>0||Pe&&typeof n=="object")&&u.mutate({trans:h,type:"put",keys:Te,values:Se,criteria:Pe,changeSpec:typeof n!="function"&&n}).then(Ce=>de(Se.length,Ce))).then(()=>(xe.length>0||Pe&&n===ty)&&u.mutate({trans:h,type:"delete",keys:xe,criteria:Pe}).then(Ce=>de(xe.length,Ce))).then(()=>he.length>K+G&&Ie(K+U))})};return Ie(0).then(()=>{if(j.length>0)throw new Of("Error modifying one or more objects",j,L,oe);return he.length})})})}delete(){var n=this._ctx,o=n.range;return pu(n)&&(n.isPrimKey&&!CE||o.type===3)?this._write(h=>{const{primaryKey:g}=n.table.core.schema,x=o;return n.table.core.count({trans:h,query:{index:g,range:x}}).then(v=>n.table.core.mutate({trans:h,type:"deleteRange",range:x}).then(({failures:u,lastResult:C,results:O,numFailures:U})=>{if(U)throw new Of("Could not delete some values",Object.keys(u).map(j=>u[j]),v-U);return v-U}))}):this.modify(ty)}}const ty=(r,n)=>n.value=null;function zE(r,n){return r<n?-1:r===n?0:1}function DE(r,n){return r>n?-1:r===n?0:1}function vi(r,n,o){var h=r instanceof E2?new r.Collection(r):r;return h._ctx.error=o?new o(n):new TypeError(n),h}function fu(r){return new r.Collection(r,()=>I2("")).limit(0)}function LE(r,n,o,h,g,x){for(var v=Math.min(r.length,h.length),u=-1,C=0;C<v;++C){var O=n[C];if(O!==h[C])return g(r[C],o[C])<0?r.substr(0,C)+o[C]+o.substr(C+1):g(r[C],h[C])<0?r.substr(0,C)+h[C]+o.substr(C+1):u>=0?r.substr(0,u)+n[u]+o.substr(u+1):null;g(r[C],O)<0&&(u=C)}return v<h.length&&x==="next"?r+o.substr(r.length):v<r.length&&x==="prev"?r.substr(0,o.length):u<0?null:r.substr(0,u)+h[u]+o.substr(u+1)}function Vp(r,n,o,h){var g,x,v,u,C,O,U,j=o.length;if(!o.every(he=>typeof he=="string"))return vi(r,S2);function L(he){g=function(K){return K==="next"?G=>G.toUpperCase():G=>G.toLowerCase()}(he),x=function(K){return K==="next"?G=>G.toLowerCase():G=>G.toUpperCase()}(he),v=he==="next"?zE:DE;var Ie=o.map(function(K){return{lower:x(K),upper:g(K)}}).sort(function(K,G){return v(K.lower,G.lower)});u=Ie.map(function(K){return K.upper}),C=Ie.map(function(K){return K.lower}),O=he,U=he==="next"?"":h}L("next");var oe=new r.Collection(r,()=>Ga(u[0],C[j-1]+h));oe._ondirectionchange=function(he){L(he)};var de=0;return oe._addAlgorithm(function(he,Ie,K){var G=he.key;if(typeof G!="string")return!1;var ee=x(G);if(n(ee,C,de))return!0;for(var _e=null,Se=de;Se<j;++Se){var Te=LE(G,ee,u[Se],C[Se],v,O);Te===null&&_e===null?de=Se+1:(_e===null||v(_e,Te)>0)&&(_e=Te)}return Ie(_e!==null?function(){he.continue(_e+U)}:K),!1}),oe}function Ga(r,n,o,h){return{type:2,lower:r,upper:n,lowerOpen:o,upperOpen:h}}function I2(r){return{type:1,lower:r,upper:r}}class E2{get Collection(){return this._ctx.table.db.Collection}between(n,o,h,g){h=h!==!1,g=g===!0;try{return this._cmp(n,o)>0||this._cmp(n,o)===0&&(h||g)&&(!h||!g)?fu(this):new this.Collection(this,()=>Ga(n,o,!h,!g))}catch{return vi(this,Hs)}}equals(n){return n==null?vi(this,Hs):new this.Collection(this,()=>I2(n))}above(n){return n==null?vi(this,Hs):new this.Collection(this,()=>Ga(n,void 0,!0))}aboveOrEqual(n){return n==null?vi(this,Hs):new this.Collection(this,()=>Ga(n,void 0,!1))}below(n){return n==null?vi(this,Hs):new this.Collection(this,()=>Ga(void 0,n,!1,!0))}belowOrEqual(n){return n==null?vi(this,Hs):new this.Collection(this,()=>Ga(void 0,n))}startsWith(n){return typeof n!="string"?vi(this,S2):this.between(n,n+rl,!0,!0)}startsWithIgnoreCase(n){return n===""?this.startsWith(n):Vp(this,(o,h)=>o.indexOf(h[0])===0,[n],rl)}equalsIgnoreCase(n){return Vp(this,(o,h)=>o===h[0],[n],"")}anyOfIgnoreCase(){var n=Ys.apply(gu,arguments);return n.length===0?fu(this):Vp(this,(o,h)=>h.indexOf(o)!==-1,n,"")}startsWithAnyOfIgnoreCase(){var n=Ys.apply(gu,arguments);return n.length===0?fu(this):Vp(this,(o,h)=>h.some(g=>o.indexOf(g)===0),n,rl)}anyOf(){const n=Ys.apply(gu,arguments);let o=this._cmp;try{n.sort(o)}catch{return vi(this,Hs)}if(n.length===0)return fu(this);const h=new this.Collection(this,()=>Ga(n[0],n[n.length-1]));h._ondirectionchange=x=>{o=x==="next"?this._ascending:this._descending,n.sort(o)};let g=0;return h._addAlgorithm((x,v,u)=>{const C=x.key;for(;o(C,n[g])>0;)if(++g,g===n.length)return v(u),!1;return o(C,n[g])===0||(v(()=>{x.continue(n[g])}),!1)}),h}notEqual(n){return this.inAnyRange([[h_,n],[n,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const n=Ys.apply(gu,arguments);if(n.length===0)return new this.Collection(this);try{n.sort(this._ascending)}catch{return vi(this,Hs)}const o=n.reduce((h,g)=>h?h.concat([[h[h.length-1][1],g]]):[[h_,g]],null);return o.push([n[n.length-1],this.db._maxKey]),this.inAnyRange(o,{includeLowers:!1,includeUppers:!1})}inAnyRange(n,o){const h=this._cmp,g=this._ascending,x=this._descending,v=this._min,u=this._max;if(n.length===0)return fu(this);if(!n.every(G=>G[0]!==void 0&&G[1]!==void 0&&g(G[0],G[1])<=0))return vi(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",xt.InvalidArgument);const C=!o||o.includeLowers!==!1,O=o&&o.includeUppers===!0;let U,j=g;function L(G,ee){return j(G[0],ee[0])}try{U=n.reduce(function(G,ee){let _e=0,Se=G.length;for(;_e<Se;++_e){const Te=G[_e];if(h(ee[0],Te[1])<0&&h(ee[1],Te[0])>0){Te[0]=v(Te[0],ee[0]),Te[1]=u(Te[1],ee[1]);break}}return _e===Se&&G.push(ee),G},[]),U.sort(L)}catch{return vi(this,Hs)}let oe=0;const de=O?G=>g(G,U[oe][1])>0:G=>g(G,U[oe][1])>=0,he=C?G=>x(G,U[oe][0])>0:G=>x(G,U[oe][0])>=0;let Ie=de;const K=new this.Collection(this,()=>Ga(U[0][0],U[U.length-1][1],!C,!O));return K._ondirectionchange=G=>{G==="next"?(Ie=de,j=g):(Ie=he,j=x),U.sort(L)},K._addAlgorithm((G,ee,_e)=>{for(var Se=G.key;Ie(Se);)if(++oe,oe===U.length)return ee(_e),!1;return!!function(Te){return!de(Te)&&!he(Te)}(Se)||(this._cmp(Se,U[oe][1])===0||this._cmp(Se,U[oe][0])===0||ee(()=>{j===g?G.continue(U[oe][0]):G.continue(U[oe][1])}),!1)}),K}startsWithAnyOf(){const n=Ys.apply(gu,arguments);return n.every(o=>typeof o=="string")?n.length===0?fu(this):this.inAnyRange(n.map(o=>[o,o+rl])):vi(this,"startsWithAnyOf() only works with strings")}}function bs(r){return yr(function(n){return sd(n),r(n.target.error),!1})}function sd(r){r.stopPropagation&&r.stopPropagation(),r.preventDefault&&r.preventDefault()}const ad="storagemutated",Ja="x-storagemutated-1",fo=Fh(null,ad);class RE{_lock(){return wh(!yt.global),++this._reculock,this._reculock!==1||yt.global||(yt.lockOwnerFor=this),this}_unlock(){if(wh(!yt.global),--this._reculock==0)for(yt.global||(yt.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var n=this._blockedFuncs.shift();try{Yu(n[1],n[0])}catch{}}return this}_locked(){return this._reculock&&yt.lockOwnerFor!==this}create(n){if(!this.mode)return this;const o=this.db.idbdb,h=this.db._state.dbOpenError;if(wh(!this.idbtrans),!n&&!o)switch(h&&h.name){case"DatabaseClosedError":throw new xt.DatabaseClosed(h);case"MissingAPIError":throw new xt.MissingAPI(h.message,h);default:throw new xt.OpenFailed(h)}if(!this.active)throw new xt.TransactionInactive;return wh(this._completion._state===null),(n=this.idbtrans=n||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):o.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=yr(g=>{sd(g),this._reject(n.error)}),n.onabort=yr(g=>{sd(g),this.active&&this._reject(new xt.Abort(n.error)),this.active=!1,this.on("abort").fire(g)}),n.oncomplete=yr(()=>{this.active=!1,this._resolve(),"mutatedParts"in n&&fo.storagemutated.fire(n.mutatedParts)}),this}_promise(n,o,h){if(n==="readwrite"&&this.mode!=="readwrite")return qr(new xt.ReadOnly("Transaction is readonly"));if(!this.active)return qr(new xt.TransactionInactive);if(this._locked())return new st((x,v)=>{this._blockedFuncs.push([()=>{this._promise(n,o,h).then(x,v)},yt])});if(h)return ho(()=>{var x=new st((v,u)=>{this._lock();const C=o(v,u,this);C&&C.then&&C.then(v,u)});return x.finally(()=>this._unlock()),x._lib=!0,x});var g=new st((x,v)=>{var u=o(x,v,this);u&&u.then&&u.then(x,v)});return g._lib=!0,g}_root(){return this.parent?this.parent._root():this}waitFor(n){var o=this._root();const h=st.resolve(n);if(o._waitingFor)o._waitingFor=o._waitingFor.then(()=>h);else{o._waitingFor=h,o._waitingQueue=[];var g=o.idbtrans.objectStore(o.storeNames[0]);(function v(){for(++o._spinCount;o._waitingQueue.length;)o._waitingQueue.shift()();o._waitingFor&&(g.get(-1/0).onsuccess=v)})()}var x=o._waitingFor;return new st((v,u)=>{h.then(C=>o._waitingQueue.push(yr(v.bind(null,C))),C=>o._waitingQueue.push(yr(u.bind(null,C)))).finally(()=>{o._waitingFor===x&&(o._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new xt.Abort))}table(n){const o=this._memoizedTables||(this._memoizedTables={});if(Ti(o,n))return o[n];const h=this.schema[n];if(!h)throw new xt.NotFound("Table "+n+" not part of transaction");const g=new this.db.Table(n,h,this);return g.core=this.db.core.table(n),o[n]=g,g}}function d_(r,n,o,h,g,x,v){return{name:r,keyPath:n,unique:o,multi:h,auto:g,compound:x,src:(o&&!v?"&":"")+(h?"*":"")+(g?"++":"")+P2(n)}}function P2(r){return typeof r=="string"?r:r?"["+[].join.call(r,"+")+"]":""}function C2(r,n,o){return{name:r,primKey:n,indexes:o,mappedClass:null,idxByName:a2(o,h=>[h.name,h])}}let od=r=>{try{return r.only([[]]),od=()=>[[]],[[]]}catch{return od=()=>rl,rl}};function p_(r){return r==null?()=>{}:typeof r=="string"?function(n){return n.split(".").length===1?h=>h[n]:h=>na(h,n)}(r):n=>na(n,r)}function zw(r){return[].slice.call(r)}let BE=0;function Oh(r){return r==null?":id":typeof r=="string"?r:`[${r.join("+")}]`}function FE(r,n,o){function h(C){if(C.type===3)return null;if(C.type===4)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:O,upper:U,lowerOpen:j,upperOpen:L}=C;return O===void 0?U===void 0?null:n.upperBound(U,!!L):U===void 0?n.lowerBound(O,!!j):n.bound(O,U,!!j,!!L)}const{schema:g,hasGetAll:x}=function(C,O){const U=zw(C.objectStoreNames);return{schema:{name:C.name,tables:U.map(j=>O.objectStore(j)).map(j=>{const{keyPath:L,autoIncrement:oe}=j,de=En(L),he=L==null,Ie={},K={name:j.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:he,compound:de,keyPath:L,autoIncrement:oe,unique:!0,extractKey:p_(L)},indexes:zw(j.indexNames).map(G=>j.index(G)).map(G=>{const{name:ee,unique:_e,multiEntry:Se,keyPath:Te}=G,xe={name:ee,compound:En(Te),keyPath:Te,unique:_e,multiEntry:Se,extractKey:p_(Te)};return Ie[Oh(Te)]=xe,xe}),getIndexByKeyPath:G=>Ie[Oh(G)]};return Ie[":id"]=K.primaryKey,L!=null&&(Ie[Oh(L)]=K.primaryKey),K})},hasGetAll:U.length>0&&"getAll"in O.objectStore(U[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(r,o),v=g.tables.map(C=>function(O){const U=O.name;return{name:U,schema:O,mutate:function({trans:j,type:L,keys:oe,values:de,range:he}){return new Promise((Ie,K)=>{Ie=yr(Ie);const G=j.objectStore(U),ee=G.keyPath==null,_e=L==="put"||L==="add";if(!_e&&L!=="delete"&&L!=="deleteRange")throw new Error("Invalid operation type: "+L);const{length:Se}=oe||de||{length:1};if(oe&&de&&oe.length!==de.length)throw new Error("Given keys array must have same length as given values array.");if(Se===0)return Ie({numFailures:0,failures:{},results:[],lastResult:void 0});let Te;const xe=[],Pe=[];let Ce=0;const rt=Wt=>{++Ce,sd(Wt)};if(L==="deleteRange"){if(he.type===4)return Ie({numFailures:Ce,failures:Pe,results:[],lastResult:void 0});he.type===3?xe.push(Te=G.clear()):xe.push(Te=G.delete(h(he)))}else{const[Wt,Tt]=_e?ee?[de,oe]:[de,null]:[oe,null];if(_e)for(let bt=0;bt<Se;++bt)xe.push(Te=Tt&&Tt[bt]!==void 0?G[L](Wt[bt],Tt[bt]):G[L](Wt[bt])),Te.onerror=rt;else for(let bt=0;bt<Se;++bt)xe.push(Te=G[L](Wt[bt])),Te.onerror=rt}const Ye=Wt=>{const Tt=Wt.target.result;xe.forEach((bt,vr)=>bt.error!=null&&(Pe[vr]=bt.error)),Ie({numFailures:Ce,failures:Pe,results:L==="delete"?oe:xe.map(bt=>bt.result),lastResult:Tt})};Te.onerror=Wt=>{rt(Wt),Ye(Wt)},Te.onsuccess=Ye})},getMany:({trans:j,keys:L})=>new Promise((oe,de)=>{oe=yr(oe);const he=j.objectStore(U),Ie=L.length,K=new Array(Ie);let G,ee=0,_e=0;const Se=xe=>{const Pe=xe.target;K[Pe._pos]=Pe.result,++_e===ee&&oe(K)},Te=bs(de);for(let xe=0;xe<Ie;++xe)L[xe]!=null&&(G=he.get(L[xe]),G._pos=xe,G.onsuccess=Se,G.onerror=Te,++ee);ee===0&&oe(K)}),get:({trans:j,key:L})=>new Promise((oe,de)=>{oe=yr(oe);const he=j.objectStore(U).get(L);he.onsuccess=Ie=>oe(Ie.target.result),he.onerror=bs(de)}),query:function(j){return L=>new Promise((oe,de)=>{oe=yr(oe);const{trans:he,values:Ie,limit:K,query:G}=L,ee=K===1/0?void 0:K,{index:_e,range:Se}=G,Te=he.objectStore(U),xe=_e.isPrimaryKey?Te:Te.index(_e.name),Pe=h(Se);if(K===0)return oe({result:[]});if(j){const Ce=Ie?xe.getAll(Pe,ee):xe.getAllKeys(Pe,ee);Ce.onsuccess=rt=>oe({result:rt.target.result}),Ce.onerror=bs(de)}else{let Ce=0;const rt=Ie||!("openKeyCursor"in xe)?xe.openCursor(Pe):xe.openKeyCursor(Pe),Ye=[];rt.onsuccess=Wt=>{const Tt=rt.result;return Tt?(Ye.push(Ie?Tt.value:Tt.primaryKey),++Ce===K?oe({result:Ye}):void Tt.continue()):oe({result:Ye})},rt.onerror=bs(de)}})}(x),openCursor:function({trans:j,values:L,query:oe,reverse:de,unique:he}){return new Promise((Ie,K)=>{Ie=yr(Ie);const{index:G,range:ee}=oe,_e=j.objectStore(U),Se=G.isPrimaryKey?_e:_e.index(G.name),Te=de?he?"prevunique":"prev":he?"nextunique":"next",xe=L||!("openKeyCursor"in Se)?Se.openCursor(h(ee),Te):Se.openKeyCursor(h(ee),Te);xe.onerror=bs(K),xe.onsuccess=yr(Pe=>{const Ce=xe.result;if(!Ce)return void Ie(null);Ce.___id=++BE,Ce.done=!1;const rt=Ce.continue.bind(Ce);let Ye=Ce.continuePrimaryKey;Ye&&(Ye=Ye.bind(Ce));const Wt=Ce.advance.bind(Ce),Tt=()=>{throw new Error("Cursor not stopped")};Ce.trans=j,Ce.stop=Ce.continue=Ce.continuePrimaryKey=Ce.advance=()=>{throw new Error("Cursor not started")},Ce.fail=yr(K),Ce.next=function(){let bt=1;return this.start(()=>bt--?this.continue():this.stop()).then(()=>this)},Ce.start=bt=>{const vr=new Promise((Nt,He)=>{Nt=yr(Nt),xe.onerror=bs(He),Ce.fail=He,Ce.stop=ht=>{Ce.stop=Ce.continue=Ce.continuePrimaryKey=Ce.advance=Tt,Nt(ht)}}),Tr=()=>{if(xe.result)try{bt()}catch(Nt){Ce.fail(Nt)}else Ce.done=!0,Ce.start=()=>{throw new Error("Cursor behind last entry")},Ce.stop()};return xe.onsuccess=yr(Nt=>{xe.onsuccess=Tr,Tr()}),Ce.continue=rt,Ce.continuePrimaryKey=Ye,Ce.advance=Wt,Tr(),vr},Ie(Ce)},K)})},count({query:j,trans:L}){const{index:oe,range:de}=j;return new Promise((he,Ie)=>{const K=L.objectStore(U),G=oe.isPrimaryKey?K:K.index(oe.name),ee=h(de),_e=ee?G.count(ee):G.count();_e.onsuccess=yr(Se=>he(Se.target.result)),_e.onerror=bs(Ie)})}}}(C)),u={};return v.forEach(C=>u[C.name]=C),{stack:"dbcore",transaction:r.transaction.bind(r),table(C){if(!u[C])throw new Error(`Table '${C}' not found`);return u[C]},MIN_KEY:-1/0,MAX_KEY:od(n),schema:g}}function f_({_novip:r},n){const o=n.db,h=function(g,x,{IDBKeyRange:v,indexedDB:u},C){return{dbcore:function(U,j){return j.reduce((L,{create:oe})=>({...L,...oe(L)}),U)}(FE(x,v,C),g.dbcore)}}(r._middlewares,o,r._deps,n);r.core=h.dbcore,r.tables.forEach(g=>{const x=g.name;r.core.schema.tables.some(v=>v.name===x)&&(g.core=r.core.table(x),r[x]instanceof r.Table&&(r[x].core=g.core))})}function $f({_novip:r},n,o,h){o.forEach(g=>{const x=h[g];n.forEach(v=>{const u=vv(v,g);(!u||"value"in u&&u.value===void 0)&&(v===r.Transaction.prototype||v instanceof r.Transaction?ra(v,g,{get(){return this.table(g)},set(C){n2(this,g,{value:C,writable:!0,configurable:!0,enumerable:!0})}}):v[g]=new r.Table(g,x))})})}function m_({_novip:r},n){n.forEach(o=>{for(let h in o)o[h]instanceof r.Table&&delete o[h]})}function OE(r,n){return r._cfg.version-n._cfg.version}function NE(r,n,o,h){const g=r._dbSchema,x=r._createTransaction("readwrite",r._storeNames,g);x.create(o),x._completion.catch(h);const v=x._reject.bind(x),u=yt.transless||yt;ho(()=>{yt.trans=x,yt.transless=u,n===0?(Or(g).forEach(C=>{ry(o,C,g[C].primKey,g[C].indexes)}),f_(r,o),st.follow(()=>r.on.populate.fire(x)).catch(v)):function({_novip:C},O,U,j){const L=[],oe=C._versions;let de=C._dbSchema=y_(C,C.idbdb,j),he=!1;const Ie=oe.filter(G=>G._cfg.version>=O);function K(){return L.length?st.resolve(L.shift()(U.idbtrans)).then(K):st.resolve()}return Ie.forEach(G=>{L.push(()=>{const ee=de,_e=G._cfg.dbschema;__(C,ee,j),__(C,_e,j),de=C._dbSchema=_e;const Se=M2(ee,_e);Se.add.forEach(xe=>{ry(j,xe[0],xe[1].primKey,xe[1].indexes)}),Se.change.forEach(xe=>{if(xe.recreate)throw new xt.Upgrade("Not yet support for changing primary key");{const Pe=j.objectStore(xe.name);xe.add.forEach(Ce=>g_(Pe,Ce)),xe.change.forEach(Ce=>{Pe.deleteIndex(Ce.name),g_(Pe,Ce)}),xe.del.forEach(Ce=>Pe.deleteIndex(Ce))}});const Te=G._cfg.contentUpgrade;if(Te&&G._cfg.version>O){f_(C,j),U._memoizedTables={},he=!0;let xe=o2(_e);Se.del.forEach(Ye=>{xe[Ye]=ee[Ye]}),m_(C,[C.Transaction.prototype]),$f(C,[C.Transaction.prototype],Or(xe),xe),U.schema=xe;const Pe=xv(Te);let Ce;Pe&&Xu();const rt=st.follow(()=>{if(Ce=Te(U),Ce&&Pe){var Ye=la.bind(null,null);Ce.then(Ye,Ye)}});return Ce&&typeof Ce.then=="function"?st.resolve(Ce):rt.then(()=>Ce)}}),L.push(ee=>{(!he||!PE)&&function(_e,Se){[].slice.call(Se.db.objectStoreNames).forEach(Te=>_e[Te]==null&&Se.db.deleteObjectStore(Te))}(G._cfg.dbschema,ee),m_(C,[C.Transaction.prototype]),$f(C,[C.Transaction.prototype],C._storeNames,C._dbSchema),U.schema=C._dbSchema})}),K().then(()=>{var G,ee;ee=j,Or(G=de).forEach(_e=>{ee.db.objectStoreNames.contains(_e)||ry(ee,_e,G[_e].primKey,G[_e].indexes)})})}(r,n,x,o).catch(v)})}function M2(r,n){const o={del:[],add:[],change:[]};let h;for(h in r)n[h]||o.del.push(h);for(h in n){const g=r[h],x=n[h];if(g){const v={name:h,def:x,recreate:!1,del:[],add:[],change:[]};if(""+(g.primKey.keyPath||"")!=""+(x.primKey.keyPath||"")||g.primKey.auto!==x.primKey.auto&&!om)v.recreate=!0,o.change.push(v);else{const u=g.idxByName,C=x.idxByName;let O;for(O in u)C[O]||v.del.push(O);for(O in C){const U=u[O],j=C[O];U?U.src!==j.src&&v.change.push(j):v.add.push(j)}(v.del.length>0||v.add.length>0||v.change.length>0)&&o.change.push(v)}}else o.add.push([h,x])}return o}function ry(r,n,o,h){const g=r.db.createObjectStore(n,o.keyPath?{keyPath:o.keyPath,autoIncrement:o.auto}:{autoIncrement:o.auto});return h.forEach(x=>g_(g,x)),g}function g_(r,n){r.createIndex(n.name,n.keyPath,{unique:n.unique,multiEntry:n.multi})}function y_(r,n,o){const h={};return Ff(n.objectStoreNames,0).forEach(g=>{const x=o.objectStore(g);let v=x.keyPath;const u=d_(P2(v),v||"",!1,!1,!!x.autoIncrement,v&&typeof v!="string",!0),C=[];for(let U=0;U<x.indexNames.length;++U){const j=x.index(x.indexNames[U]);v=j.keyPath;var O=d_(j.name,v,!!j.unique,!!j.multiEntry,!1,v&&typeof v!="string",!1);C.push(O)}h[g]=C2(g,u,C)}),h}function __({_novip:r},n,o){const h=o.db.objectStoreNames;for(let g=0;g<h.length;++g){const x=h[g],v=o.objectStore(x);r._hasGetAll="getAll"in v;for(let u=0;u<v.indexNames.length;++u){const C=v.indexNames[u],O=v.index(C).keyPath,U=typeof O=="string"?O:"["+Ff(O).join("+")+"]";if(n[x]){const j=n[x].idxByName[U];j&&(j.name=C,delete n[x].idxByName[U],n[x].idxByName[C]=j)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&dr.WorkerGlobalScope&&dr instanceof dr.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(r._hasGetAll=!1)}class jE{_parseStoresSpec(n,o){Or(n).forEach(h=>{if(n[h]!==null){var g=n[h].split(",").map((v,u)=>{const C=(v=v.trim()).replace(/([&*]|\+\+)/g,""),O=/^\[/.test(C)?C.match(/^\[(.*)\]$/)[1].split("+"):C;return d_(C,O||null,/\&/.test(v),/\*/.test(v),/\+\+/.test(v),En(O),u===0)}),x=g.shift();if(x.multi)throw new xt.Schema("Primary key cannot be multi-valued");g.forEach(v=>{if(v.auto)throw new xt.Schema("Only primary key can be marked as autoIncrement (++)");if(!v.keyPath)throw new xt.Schema("Index must have a name and cannot be an empty string")}),o[h]=C2(h,x,g)}})}stores(n){const o=this.db;this._cfg.storesSource=this._cfg.storesSource?jn(this._cfg.storesSource,n):n;const h=o._versions,g={};let x={};return h.forEach(v=>{jn(g,v._cfg.storesSource),x=v._cfg.dbschema={},v._parseStoresSpec(g,x)}),o._dbSchema=x,m_(o,[o._allTables,o,o.Transaction.prototype]),$f(o,[o._allTables,o,o.Transaction.prototype,this._cfg.tables],Or(x),x),o._storeNames=Or(x),this}upgrade(n){return this._cfg.contentUpgrade=Sv(this._cfg.contentUpgrade||ar,n),this}}function Ev(r,n){let o=r._dbNamesDB;return o||(o=r._dbNamesDB=new ol(lm,{addons:[],indexedDB:r,IDBKeyRange:n}),o.version(1).stores({dbnames:"name"})),o.table("dbnames")}function Pv(r){return r&&typeof r.databases=="function"}function v_(r){return ho(function(){return yt.letThrough=!0,r()})}function VE(){var r;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(n){var o=function(){return indexedDB.databases().finally(n)};r=setInterval(o,100),o()}).finally(function(){return clearInterval(r)}):Promise.resolve()}function UE(r){const n=r._state,{indexedDB:o}=r._deps;if(n.isBeingOpened||r.idbdb)return n.dbReadyPromise.then(()=>n.dbOpenError?qr(n.dbOpenError):r);Is&&(n.openCanceller._stackHolder=yl()),n.isBeingOpened=!0,n.dbOpenError=null,n.openComplete=!1;const h=n.openCanceller;function g(){if(n.openCanceller!==h)throw new xt.DatabaseClosed("db.open() was cancelled")}let x=n.dbReadyResolve,v=null,u=!1;const C=()=>new st((O,U)=>{if(g(),!o)throw new xt.MissingAPI;const j=r.name,L=n.autoSchema?o.open(j):o.open(j,Math.round(10*r.verno));if(!L)throw new xt.MissingAPI;L.onerror=bs(U),L.onblocked=yr(r._fireOnBlocked),L.onupgradeneeded=yr(oe=>{if(v=L.transaction,n.autoSchema&&!r._options.allowEmptyDB){L.onerror=sd,v.abort(),L.result.close();const he=o.deleteDatabase(j);he.onsuccess=he.onerror=yr(()=>{U(new xt.NoSuchDatabase(`Database ${j} doesnt exist`))})}else{v.onerror=bs(U);var de=oe.oldVersion>Math.pow(2,62)?0:oe.oldVersion;u=de<1,r._novip.idbdb=L.result,NE(r,de/10,v,U)}},U),L.onsuccess=yr(()=>{v=null;const oe=r._novip.idbdb=L.result,de=Ff(oe.objectStoreNames);if(de.length>0)try{const Ie=oe.transaction((he=de).length===1?he[0]:he,"readonly");n.autoSchema?function({_novip:K},G,ee){K.verno=G.version/10;const _e=K._dbSchema=y_(0,G,ee);K._storeNames=Ff(G.objectStoreNames,0),$f(K,[K._allTables],Or(_e),_e)}(r,oe,Ie):(__(r,r._dbSchema,Ie),function(K,G){const ee=M2(y_(0,K.idbdb,G),K._dbSchema);return!(ee.add.length||ee.change.some(_e=>_e.add.length||_e.change.length))}(r,Ie)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),f_(r,Ie)}catch{}var he;Bh.push(r),oe.onversionchange=yr(Ie=>{n.vcFired=!0,r.on("versionchange").fire(Ie)}),oe.onclose=yr(Ie=>{r.on("close").fire(Ie)}),u&&function({indexedDB:Ie,IDBKeyRange:K},G){!Pv(Ie)&&G!==lm&&Ev(Ie,K).put({name:G}).catch(ar)}(r._deps,j),O()},U)}).catch(O=>O&&O.name==="UnknownError"&&n.PR1398_maxLoop>0?(n.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),C()):st.reject(O));return st.race([h,(typeof navigator>"u"?st.resolve():VE()).then(C)]).then(()=>(g(),n.onReadyBeingFired=[],st.resolve(v_(()=>r.on.ready.fire(r.vip))).then(function O(){if(n.onReadyBeingFired.length>0){let U=n.onReadyBeingFired.reduce(Sv,ar);return n.onReadyBeingFired=[],st.resolve(v_(()=>U(r.vip))).then(O)}}))).finally(()=>{n.onReadyBeingFired=null,n.isBeingOpened=!1}).then(()=>r).catch(O=>{n.dbOpenError=O;try{v&&v.abort()}catch{}return h===n.openCanceller&&r._close(),qr(O)}).finally(()=>{n.openComplete=!0,x()})}function x_(r){var n=x=>r.next(x),o=g(n),h=g(x=>r.throw(x));function g(x){return v=>{var u=x(v),C=u.value;return u.done?C:C&&typeof C.then=="function"?C.then(o,h):En(C)?Promise.all(C).then(o,h):o(C)}}return g(n)()}function $E(r,n,o){var h=arguments.length;if(h<2)throw new xt.InvalidArgument("Too few arguments");for(var g=new Array(h-1);--h;)g[h-1]=arguments[h];return o=g.pop(),[r,l2(g),o]}function A2(r,n,o,h,g){return st.resolve().then(()=>{const x=yt.transless||yt,v=r._createTransaction(n,o,r._dbSchema,h),u={trans:v,transless:x};if(h)v.idbtrans=h.idbtrans;else try{v.create(),r._state.PR1398_maxLoop=3}catch(j){return j.name===bv.InvalidState&&r.isOpen()&&--r._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),r._close(),r.open().then(()=>A2(r,n,o,null,g))):qr(j)}const C=xv(g);let O;C&&Xu();const U=st.follow(()=>{if(O=g.call(v,v),O)if(C){var j=la.bind(null,null);O.then(j,j)}else typeof O.next=="function"&&typeof O.throw=="function"&&(O=x_(O))},u);return(O&&typeof O.then=="function"?st.resolve(O).then(j=>v.active?j:qr(new xt.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):U.then(()=>O)).then(j=>(h&&v._resolve(),v._completion.then(()=>j))).catch(j=>(v._reject(j),qr(j)))})}function Up(r,n,o){const h=En(r)?r.slice():[r];for(let g=0;g<o;++g)h.push(n);return h}const qE={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(r){return{...r,table(n){const o=r.table(n),{schema:h}=o,g={},x=[];function v(U,j,L){const oe=Oh(U),de=g[oe]=g[oe]||[],he=U==null?0:typeof U=="string"?1:U.length,Ie=j>0,K={...L,isVirtual:Ie,keyTail:j,keyLength:he,extractKey:p_(U),unique:!Ie&&L.unique};return de.push(K),K.isPrimaryKey||x.push(K),he>1&&v(he===2?U[0]:U.slice(0,he-1),j+1,L),de.sort((G,ee)=>G.keyTail-ee.keyTail),K}const u=v(h.primaryKey.keyPath,0,h.primaryKey);g[":id"]=[u];for(const U of h.indexes)v(U.keyPath,0,U);function C(U){const j=U.query.index;return j.isVirtual?{...U,query:{index:j,range:(L=U.query.range,oe=j.keyTail,{type:L.type===1?2:L.type,lower:Up(L.lower,L.lowerOpen?r.MAX_KEY:r.MIN_KEY,oe),lowerOpen:!0,upper:Up(L.upper,L.upperOpen?r.MIN_KEY:r.MAX_KEY,oe),upperOpen:!0})}}:U;var L,oe}return{...o,schema:{...h,primaryKey:u,indexes:x,getIndexByKeyPath:function(U){const j=g[Oh(U)];return j&&j[0]}},count:U=>o.count(C(U)),query:U=>o.query(C(U)),openCursor(U){const{keyTail:j,isVirtual:L,keyLength:oe}=U.query.index;return L?o.openCursor(C(U)).then(de=>de&&function(he){return Object.create(he,{continue:{value:function(K){K!=null?he.continue(Up(K,U.reverse?r.MAX_KEY:r.MIN_KEY,j)):U.unique?he.continue(he.key.slice(0,oe).concat(U.reverse?r.MIN_KEY:r.MAX_KEY,j)):he.continue()}},continuePrimaryKey:{value(K,G){he.continuePrimaryKey(Up(K,r.MAX_KEY,j),G)}},primaryKey:{get:()=>he.primaryKey},key:{get(){const K=he.key;return oe===1?K[0]:K.slice(0,oe)}},value:{get:()=>he.value}})}(de)):o.openCursor(U)}}}}}};function Cv(r,n,o,h){return o=o||{},h=h||"",Or(r).forEach(g=>{if(Ti(n,g)){var x=r[g],v=n[g];if(typeof x=="object"&&typeof v=="object"&&x&&v){const u=Qy(x);u!==Qy(v)?o[h+g]=n[g]:u==="Object"?Cv(x,v,o,h+g+"."):x!==v&&(o[h+g]=n[g])}else x!==v&&(o[h+g]=n[g])}else o[h+g]=void 0}),Or(n).forEach(g=>{Ti(r,g)||(o[h+g]=n[g])}),o}const ZE={stack:"dbcore",name:"HooksMiddleware",level:2,create:r=>({...r,table(n){const o=r.table(n),{primaryKey:h}=o.schema;return{...o,mutate(x){const v=yt.trans,{deleting:u,creating:C,updating:O}=v.table(n).hook;switch(x.type){case"add":if(C.fire===ar)break;return v._promise("readwrite",()=>U(x),!0);case"put":if(C.fire===ar&&O.fire===ar)break;return v._promise("readwrite",()=>U(x),!0);case"delete":if(u.fire===ar)break;return v._promise("readwrite",()=>U(x),!0);case"deleteRange":if(u.fire===ar)break;return v._promise("readwrite",()=>function(L){return j(L.trans,L.range,1e4)}(x),!0)}return o.mutate(x);function U(L){const oe=yt.trans,de=L.keys||function(he,Ie){return Ie.type==="delete"?Ie.keys:Ie.keys||Ie.values.map(he.extractKey)}(h,L);if(!de)throw new Error("Keys missing");return(L=L.type==="add"||L.type==="put"?{...L,keys:de}:{...L}).type!=="delete"&&(L.values=[...L.values]),L.keys&&(L.keys=[...L.keys]),function(he,Ie,K){return Ie.type==="add"?Promise.resolve([]):he.getMany({trans:Ie.trans,keys:K,cache:"immutable"})}(o,L,de).then(he=>{const Ie=de.map((K,G)=>{const ee=he[G],_e={onerror:null,onsuccess:null};if(L.type==="delete")u.fire.call(_e,K,ee,oe);else if(L.type==="add"||ee===void 0){const Se=C.fire.call(_e,K,L.values[G],oe);K==null&&Se!=null&&(K=Se,L.keys[G]=K,h.outbound||is(L.values[G],h.keyPath,K))}else{const Se=Cv(ee,L.values[G]),Te=O.fire.call(_e,Se,K,ee,oe);if(Te){const xe=L.values[G];Object.keys(Te).forEach(Pe=>{Ti(xe,Pe)?xe[Pe]=Te[Pe]:is(xe,Pe,Te[Pe])})}}return _e});return o.mutate(L).then(({failures:K,results:G,numFailures:ee,lastResult:_e})=>{for(let Se=0;Se<de.length;++Se){const Te=G?G[Se]:de[Se],xe=Ie[Se];Te==null?xe.onerror&&xe.onerror(K[Se]):xe.onsuccess&&xe.onsuccess(L.type==="put"&&he[Se]?L.values[Se]:Te)}return{failures:K,results:G,numFailures:ee,lastResult:_e}}).catch(K=>(Ie.forEach(G=>G.onerror&&G.onerror(K)),Promise.reject(K)))})}function j(L,oe,de){return o.query({trans:L,values:!1,query:{index:h,range:oe},limit:de}).then(({result:he})=>U({type:"delete",keys:he,trans:L}).then(Ie=>Ie.numFailures>0?Promise.reject(Ie.failures[0]):he.length<de?{failures:[],numFailures:0,lastResult:void 0}:j(L,{...oe,lower:he[he.length-1],lowerOpen:!0},de)))}}}}})};function z2(r,n,o){try{if(!n||n.keys.length<r.length)return null;const h=[];for(let g=0,x=0;g<n.keys.length&&x<r.length;++g)On(n.keys[g],r[x])===0&&(h.push(o?fd(n.values[g]):n.values[g]),++x);return h.length===r.length?h:null}catch{return null}}const GE={stack:"dbcore",level:-1,create:r=>({table:n=>{const o=r.table(n);return{...o,getMany:h=>{if(!h.cache)return o.getMany(h);const g=z2(h.keys,h.trans._cache,h.cache==="clone");return g?st.resolve(g):o.getMany(h).then(x=>(h.trans._cache={keys:h.keys,values:h.cache==="clone"?fd(x):x},x))},mutate:h=>(h.type!=="add"&&(h.trans._cache=null),o.mutate(h))}}})};function Mv(r){return!("from"in r)}const Xs=function(r,n){if(!this){const o=new Xs;return r&&"d"in r&&jn(o,r),o}jn(this,arguments.length?{d:1,from:r,to:arguments.length>1?n:r}:{d:0})};function ld(r,n,o){const h=On(n,o);if(isNaN(h))return;if(h>0)throw RangeError();if(Mv(r))return jn(r,{from:n,to:o,d:1});const g=r.l,x=r.r;if(On(o,r.from)<0)return g?ld(g,n,o):r.l={from:n,to:o,d:1,l:null,r:null},Dw(r);if(On(n,r.to)>0)return x?ld(x,n,o):r.r={from:n,to:o,d:1,l:null,r:null},Dw(r);On(n,r.from)<0&&(r.from=n,r.l=null,r.d=x?x.d+1:1),On(o,r.to)>0&&(r.to=o,r.r=null,r.d=r.l?r.l.d+1:1);const v=!r.r;g&&!r.l&&qf(r,g),x&&v&&qf(r,x)}function qf(r,n){Mv(n)||function o(h,{from:g,to:x,l:v,r:u}){ld(h,g,x),v&&o(h,v),u&&o(h,u)}(r,n)}function HE(r,n){const o=w_(n);let h=o.next();if(h.done)return!1;let g=h.value;const x=w_(r);let v=x.next(g.from),u=v.value;for(;!h.done&&!v.done;){if(On(u.from,g.to)<=0&&On(u.to,g.from)>=0)return!0;On(g.from,u.from)<0?g=(h=o.next(u.from)).value:u=(v=x.next(g.from)).value}return!1}function w_(r){let n=Mv(r)?null:{s:0,n:r};return{next(o){const h=arguments.length>0;for(;n;)switch(n.s){case 0:if(n.s=1,h)for(;n.n.l&&On(o,n.n.from)<0;)n={up:n,n:n.n.l,s:1};else for(;n.n.l;)n={up:n,n:n.n.l,s:1};case 1:if(n.s=2,!h||On(o,n.n.to)<=0)return{value:n.n,done:!1};case 2:if(n.n.r){n.s=3,n={up:n,n:n.n.r,s:0};continue}case 3:n=n.up}return{done:!0}}}}function Dw(r){var n,o;const h=(((n=r.r)===null||n===void 0?void 0:n.d)||0)-(((o=r.l)===null||o===void 0?void 0:o.d)||0),g=h>1?"r":h<-1?"l":"";if(g){const x=g==="r"?"l":"r",v={...r},u=r[g];r.from=u.from,r.to=u.to,r[g]=u[g],v[g]=u[x],r[x]=v,v.d=Lw(v)}r.d=Lw(r)}function Lw({r,l:n}){return(r?n?Math.max(r.d,n.d):r.d:n?n.d:0)+1}Gu(Xs.prototype,{add(r){return qf(this,r),this},addKey(r){return ld(this,r,r),this},addKeys(r){return r.forEach(n=>ld(this,n,n)),this},[e_](){return w_(this)}});const KE={stack:"dbcore",level:0,create:r=>{const n=r.schema.name,o=new Xs(r.MIN_KEY,r.MAX_KEY);return{...r,table:h=>{const g=r.table(h),{schema:x}=g,{primaryKey:v}=x,{extractKey:u,outbound:C}=v,O={...g,mutate:L=>{const oe=L.trans,de=oe.mutatedParts||(oe.mutatedParts={}),he=Te=>{const xe=`idb://${n}/${h}/${Te}`;return de[xe]||(de[xe]=new Xs)},Ie=he(""),K=he(":dels"),{type:G}=L;let[ee,_e]=L.type==="deleteRange"?[L.range]:L.type==="delete"?[L.keys]:L.values.length<50?[[],L.values]:[];const Se=L.trans._cache;return g.mutate(L).then(Te=>{if(En(ee)){G!=="delete"&&(ee=Te.results),Ie.addKeys(ee);const xe=z2(ee,Se);xe||G==="add"||K.addKeys(ee),(xe||_e)&&function(Pe,Ce,rt,Ye){function Wt(Tt){const bt=Pe(Tt.name||"");function vr(Nt){return Nt!=null?Tt.extractKey(Nt):null}const Tr=Nt=>Tt.multiEntry&&En(Nt)?Nt.forEach(He=>bt.addKey(He)):bt.addKey(Nt);(rt||Ye).forEach((Nt,He)=>{const ht=rt&&vr(rt[He]),pt=Ye&&vr(Ye[He]);On(ht,pt)!==0&&(ht!=null&&Tr(ht),pt!=null&&Tr(pt))})}Ce.indexes.forEach(Wt)}(he,x,xe,_e)}else if(ee){const xe={from:ee.lower,to:ee.upper};K.add(xe),Ie.add(xe)}else Ie.add(o),K.add(o),x.indexes.forEach(xe=>he(xe.name).add(o));return Te})}},U=({query:{index:L,range:oe}})=>{var de,he;return[L,new Xs((de=oe.lower)!==null&&de!==void 0?de:r.MIN_KEY,(he=oe.upper)!==null&&he!==void 0?he:r.MAX_KEY)]},j={get:L=>[v,new Xs(L.key)],getMany:L=>[v,new Xs().addKeys(L.keys)],count:U,query:U,openCursor:U};return Or(j).forEach(L=>{O[L]=function(oe){const{subscr:de}=yt;if(de){const he=_e=>{const Se=`idb://${n}/${h}/${_e}`;return de[Se]||(de[Se]=new Xs)},Ie=he(""),K=he(":dels"),[G,ee]=j[L](oe);if(he(G.name||"").add(ee),!G.isPrimaryKey){if(L!=="count"){const _e=L==="query"&&C&&oe.values&&g.query({...oe,values:!1});return g[L].apply(this,arguments).then(Se=>{if(L==="query"){if(C&&oe.values)return _e.then(({result:xe})=>(Ie.addKeys(xe),Se));const Te=oe.values?Se.result.map(u):Se.result;oe.values?Ie.addKeys(Te):K.addKeys(Te)}else if(L==="openCursor"){const Te=Se,xe=oe.values;return Te&&Object.create(Te,{key:{get:()=>(K.addKey(Te.primaryKey),Te.key)},primaryKey:{get(){const Pe=Te.primaryKey;return K.addKey(Pe),Pe}},value:{get:()=>(xe&&Ie.addKey(Te.primaryKey),Te.value)}})}return Se})}K.add(o)}}return g[L].apply(this,arguments)}}),O}}}};class ol{constructor(n,o){this._middlewares={},this.verno=0;const h=ol.dependencies;this._options=o={addons:ol.addons,autoOpen:!0,indexedDB:h.indexedDB,IDBKeyRange:h.IDBKeyRange,...o},this._deps={indexedDB:o.indexedDB,IDBKeyRange:o.IDBKeyRange};const{addons:g}=o;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const x={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:ar,dbReadyPromise:null,cancelOpen:ar,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var v;x.dbReadyPromise=new st(u=>{x.dbReadyResolve=u}),x.openCanceller=new st((u,C)=>{x.cancelOpen=C}),this._state=x,this.name=n,this.on=Fh(this,"populate","blocked","versionchange","close",{ready:[Sv,ar]}),this.on.ready.subscribe=i2(this.on.ready.subscribe,u=>(C,O)=>{ol.vip(()=>{const U=this._state;if(U.openComplete)U.dbOpenError||st.resolve().then(C),O&&u(C);else if(U.onReadyBeingFired)U.onReadyBeingFired.push(C),O&&u(C);else{u(C);const j=this;O||u(function L(){j.on.ready.unsubscribe(C),j.on.ready.unsubscribe(L)})}})}),this.Collection=(v=this,fh(AE.prototype,function(u,C){this.db=v;let O=T2,U=null;if(C)try{O=C()}catch(de){U=de}const j=u._ctx,L=j.table,oe=L.hook.reading.fire;this._ctx={table:L,index:j.index,isPrimKey:!j.index||L.schema.primKey.keyPath&&j.index===L.schema.primKey.name,range:O,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:U,or:j.or,valueMapper:oe!==nd?oe:null}})),this.Table=function(u){return fh(ME.prototype,function(C,O,U){this.db=u,this._tx=U,this.name=C,this.schema=O,this.hook=u._allTables[C]?u._allTables[C].hook:Fh(null,{creating:[_E,ar],reading:[yE,nd],updating:[xE,ar],deleting:[vE,ar]})})}(this),this.Transaction=function(u){return fh(RE.prototype,function(C,O,U,j,L){this.db=u,this.mode=C,this.storeNames=O,this.schema=U,this.chromeTransactionDurability=j,this.idbtrans=null,this.on=Fh(this,"complete","error","abort"),this.parent=L||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new st((oe,de)=>{this._resolve=oe,this._reject=de}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},oe=>{var de=this.active;return this.active=!1,this.on.error.fire(oe),this.parent?this.parent._reject(oe):de&&this.idbtrans&&this.idbtrans.abort(),qr(oe)})})}(this),this.Version=function(u){return fh(jE.prototype,function(C){this.db=u,this._cfg={version:C,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}(this),this.WhereClause=function(u){return fh(E2.prototype,function(C,O,U){this.db=u,this._ctx={table:C,index:O===":id"?null:O,or:U};const j=u._deps.indexedDB;if(!j)throw new xt.MissingAPI;this._cmp=this._ascending=j.cmp.bind(j),this._descending=(L,oe)=>j.cmp(oe,L),this._max=(L,oe)=>j.cmp(L,oe)>0?L:oe,this._min=(L,oe)=>j.cmp(L,oe)<0?L:oe,this._IDBKeyRange=u._deps.IDBKeyRange})}(this),this.on("versionchange",u=>{u.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",u=>{!u.newVersion||u.newVersion<u.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${u.oldVersion/10}`)}),this._maxKey=od(o.IDBKeyRange),this._createTransaction=(u,C,O,U)=>new this.Transaction(u,C,O,this._options.chromeTransactionDurability,U),this._fireOnBlocked=u=>{this.on("blocked").fire(u),Bh.filter(C=>C.name===this.name&&C!==this&&!C._state.vcFired).map(C=>C.on("versionchange").fire(u))},this.use(qE),this.use(ZE),this.use(KE),this.use(GE),this.vip=Object.create(this,{_vip:{value:!0}}),g.forEach(u=>u(this))}version(n){if(isNaN(n)||n<.1)throw new xt.Type("Given version is not a positive number");if(n=Math.round(10*n)/10,this.idbdb||this._state.isBeingOpened)throw new xt.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,n);const o=this._versions;var h=o.filter(g=>g._cfg.version===n)[0];return h||(h=new this.Version(n),o.push(h),o.sort(OE),h.stores({}),this._state.autoSchema=!1,h)}_whenReady(n){return this.idbdb&&(this._state.openComplete||yt.letThrough||this._vip)?n():new st((o,h)=>{if(this._state.openComplete)return h(new xt.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void h(new xt.DatabaseClosed);this.open().catch(ar)}this._state.dbReadyPromise.then(o,h)}).then(n)}use({stack:n,create:o,level:h,name:g}){g&&this.unuse({stack:n,name:g});const x=this._middlewares[n]||(this._middlewares[n]=[]);return x.push({stack:n,create:o,level:h??10,name:g}),x.sort((v,u)=>v.level-u.level),this}unuse({stack:n,name:o,create:h}){return n&&this._middlewares[n]&&(this._middlewares[n]=this._middlewares[n].filter(g=>h?g.create!==h:!!o&&g.name!==o)),this}open(){return UE(this)}_close(){const n=this._state,o=Bh.indexOf(this);if(o>=0&&Bh.splice(o,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}n.dbReadyPromise=new st(h=>{n.dbReadyResolve=h}),n.openCanceller=new st((h,g)=>{n.cancelOpen=g})}close(){this._close();const n=this._state;this._options.autoOpen=!1,n.dbOpenError=new xt.DatabaseClosed,n.isBeingOpened&&n.cancelOpen(n.dbOpenError)}delete(){const n=arguments.length>0,o=this._state;return new st((h,g)=>{const x=()=>{this.close();var v=this._deps.indexedDB.deleteDatabase(this.name);v.onsuccess=yr(()=>{(function({indexedDB:u,IDBKeyRange:C},O){!Pv(u)&&O!==lm&&Ev(u,C).delete(O).catch(ar)})(this._deps,this.name),h()}),v.onerror=bs(g),v.onblocked=this._fireOnBlocked};if(n)throw new xt.InvalidArgument("Arguments not allowed in db.delete()");o.isBeingOpened?o.dbReadyPromise.then(x):x()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){const n=this._state.dbOpenError;return n&&n.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return Or(this._allTables).map(n=>this._allTables[n])}transaction(){const n=$E.apply(this,arguments);return this._transaction.apply(this,n)}_transaction(n,o,h){let g=yt.trans;g&&g.db===this&&n.indexOf("!")===-1||(g=null);const x=n.indexOf("?")!==-1;let v,u;n=n.replace("!","").replace("?","");try{if(u=o.map(O=>{var U=O instanceof this.Table?O.name:O;if(typeof U!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return U}),n=="r"||n===Yg)v=Yg;else{if(n!="rw"&&n!=Jg)throw new xt.InvalidArgument("Invalid transaction mode: "+n);v=Jg}if(g){if(g.mode===Yg&&v===Jg){if(!x)throw new xt.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");g=null}g&&u.forEach(O=>{if(g&&g.storeNames.indexOf(O)===-1){if(!x)throw new xt.SubTransaction("Table "+O+" not included in parent transaction.");g=null}}),x&&g&&!g.active&&(g=null)}}catch(O){return g?g._promise(null,(U,j)=>{j(O)}):qr(O)}const C=A2.bind(null,this,v,u,g,h);return g?g._promise(v,C,"lock"):yt.trans?Yu(yt.transless,()=>this._whenReady(C)):this._whenReady(C)}table(n){if(!Ti(this._allTables,n))throw new xt.InvalidTable(`Table ${n} does not exist`);return this._allTables[n]}}const WE=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable";class XE{constructor(n){this._subscribe=n}subscribe(n,o,h){return this._subscribe(n&&typeof n!="function"?n:{next:n,error:o,complete:h})}[WE](){return this}}function D2(r,n){return Or(n).forEach(o=>{qf(r[o]||(r[o]=new Xs),n[o])}),r}function YE(r){let n,o=!1;const h=new XE(g=>{const x=xv(r);let v=!1,u={},C={};const O={get closed(){return v},unsubscribe:()=>{v=!0,fo.storagemutated.unsubscribe(oe)}};g.start&&g.start(O);let U=!1,j=!1;function L(){return Or(C).some(he=>u[he]&&HE(u[he],C[he]))}const oe=he=>{D2(u,he),L()&&de()},de=()=>{if(U||v)return;u={};const he={},Ie=function(K){x&&Xu();const G=()=>ho(r,{subscr:K,trans:null}),ee=yt.trans?Yu(yt.transless,G):G();return x&&ee.then(la,la),ee}(he);j||(fo(ad,oe),j=!0),U=!0,Promise.resolve(Ie).then(K=>{o=!0,n=K,U=!1,v||(L()?de():(u={},C=he,g.next&&g.next(K)))},K=>{U=!1,o=!1,g.error&&g.error(K),O.unsubscribe()})};return de(),O});return h.hasValue=()=>o,h.getValue=()=>n,h}let b_;try{b_={indexedDB:dr.indexedDB||dr.mozIndexedDB||dr.webkitIndexedDB||dr.msIndexedDB,IDBKeyRange:dr.IDBKeyRange||dr.webkitIDBKeyRange}}catch{b_={indexedDB:null,IDBKeyRange:null}}const Xo=ol;function df(r){let n=ea;try{ea=!0,fo.storagemutated.fire(r)}finally{ea=n}}Gu(Xo,{...af,delete:r=>new Xo(r,{addons:[]}).delete(),exists:r=>new Xo(r,{addons:[]}).open().then(n=>(n.close(),!0)).catch("NoSuchDatabaseError",()=>!1),getDatabaseNames(r){try{return function({indexedDB:n,IDBKeyRange:o}){return Pv(n)?Promise.resolve(n.databases()).then(h=>h.map(g=>g.name).filter(g=>g!==lm)):Ev(n,o).toCollection().primaryKeys()}(Xo.dependencies).then(r)}catch{return qr(new xt.MissingAPI)}},defineClass:()=>function(r){jn(this,r)},ignoreTransaction:r=>yt.trans?Yu(yt.transless,r):r(),vip:v_,async:function(r){return function(){try{var n=x_(r.apply(this,arguments));return n&&typeof n.then=="function"?n:st.resolve(n)}catch(o){return qr(o)}}},spawn:function(r,n,o){try{var h=x_(r.apply(o,n||[]));return h&&typeof h.then=="function"?h:st.resolve(h)}catch(g){return qr(g)}},currentTransaction:{get:()=>yt.trans||null},waitFor:function(r,n){const o=st.resolve(typeof r=="function"?Xo.ignoreTransaction(r):r).timeout(n||6e4);return yt.trans?yt.trans.waitFor(o):o},Promise:st,debug:{get:()=>Is,set:r=>{c2(r,r==="dexie"?()=>!0:k2)}},derive:Bu,extend:jn,props:Gu,override:i2,Events:Fh,on:fo,liveQuery:YE,extendObservabilitySet:D2,getByKeyPath:na,setByKeyPath:is,delByKeyPath:function(r,n){typeof n=="string"?is(r,n,void 0):"length"in n&&[].map.call(n,function(o){is(r,o,void 0)})},shallowClone:o2,deepClone:fd,getObjectDiff:Cv,cmp:On,asap:s2,minKey:h_,addons:[],connections:Bh,errnames:bv,dependencies:b_,semVer:Ew,version:Ew.split(".").map(r=>parseInt(r)).reduce((r,n,o)=>r+n/Math.pow(10,2*o))}),Xo.maxKey=od(Xo.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(fo(ad,r=>{if(!ea){let n;om?(n=document.createEvent("CustomEvent"),n.initCustomEvent(Ja,!0,!0,r)):n=new CustomEvent(Ja,{detail:r}),ea=!0,dispatchEvent(n),ea=!1}}),addEventListener(Ja,({detail:r})=>{ea||df(r)}));let ea=!1;if(typeof BroadcastChannel<"u"){const r=new BroadcastChannel(Ja);typeof r.unref=="function"&&r.unref(),fo(ad,n=>{ea||r.postMessage(n)}),r.onmessage=n=>{n.data&&df(n.data)}}else if(typeof self<"u"&&typeof navigator<"u"){fo(ad,n=>{try{ea||(typeof localStorage<"u"&&localStorage.setItem(Ja,JSON.stringify({trig:Math.random(),changedParts:n})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(o=>o.postMessage({type:Ja,changedParts:n})))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",n=>{if(n.key===Ja){const o=JSON.parse(n.newValue);o&&df(o.changedParts)}});const r=self.document&&navigator.serviceWorker;r&&r.addEventListener("message",function({data:n}){n&&n.type===Ja&&df(n.changedParts)})}st.rejectionMapper=function(r,n){if(!r||r instanceof Fu||r instanceof TypeError||r instanceof SyntaxError||!r.name||!Sw[r.name])return r;var o=new Sw[r.name](n||r.message,r);return"stack"in r&&ra(o,"stack",{get:function(){return this.inner.stack}}),o},c2(Is,k2);class JE extends ol{constructor(){super("boater_map_db");vs(this,"meta");vs(this,"restriction_areas");vs(this,"traffic_signs");this.version(1).stores({meta:"key",restriction_areas:"id, bbox",traffic_signs:"id, vlmtyyppi"})}}const wi=new JE,L2=async r=>{const n=await wi.meta.get(r);return n==null?void 0:n.value},R2=async(r,n)=>{await wi.meta.put({key:r,value:n})},Rw=async r=>await L2(`${r}_lastUpdated`),Bw=async(r,n)=>{await R2(`${r}_lastUpdated`,n)},QE="/finland-boater-map/data/rajoitusalue_a.gpkg",eP="/finland-boater-map/data/vesiliikennemerkit.gpkg";class Fw{constructor(n){vs(this,"worker",null);vs(this,"onStatusChange");this.onStatusChange=n}updateStatus(n){this.onStatusChange({isUpdating:!1,progress:0,message:"",...n})}async updateData(){this.updateStatus({isUpdating:!0,progress:0,message:"Aloitetaan pivitys..."});try{this.updateStatus({progress:10,message:"Ladataan rajoitusalueet..."});const n=this.fetchFile(QE,"rajoitus");this.updateStatus({progress:30,message:"Ladataan liikennemerkit..."});const o=this.fetchFile(eP,"vesiliikenne"),[h,g]=await Promise.all([n,o]);if(console.log("Fetched buffers:",{rajoitus:h==null?void 0:h.byteLength,vesiliikenne:g==null?void 0:g.byteLength}),!h||!g){this.updateStatus({isUpdating:!1,progress:100,message:"Data jo ajan tasalla!"}),setTimeout(()=>{this.updateStatus({progress:0,message:""})},3e3);return}this.updateStatus({progress:50,message:"Ksitelln rajoitusalueet..."}),console.log("Parsing restriction areas...");const x=await this.parseInWorker(h,"rajoitus");console.log("Parsed restriction areas:",x.length),this.updateStatus({progress:70,message:"Ksitelln liikennemerkit..."});const v=await this.parseInWorker(g,"vesiliikenne");console.log("Parsed traffic signs:",v.length),this.updateStatus({progress:85,message:"Tallennetaan tietokantaan..."}),await this.storeData(x,v),console.log("Data stored successfully");const u=new Date().toISOString();await Bw("rajoitus",u),await Bw("vesiliikenne",u),this.updateStatus({isUpdating:!1,progress:100,message:"Pivitys valmis!"}),setTimeout(()=>{this.updateStatus({progress:0,message:""})},3e3)}catch(n){console.error("Update failed:",n),this.updateStatus({isUpdating:!1,progress:0,message:"",error:n instanceof Error?n.message:"Pivitys eponnistui"})}}async fetchFile(n,o){const h=await L2(`${o}_etag`),g={};h&&(g["If-None-Match"]=h);const x=await fetch(n,{headers:g});if(x.status===304)return console.log("Data not modified, using cached version"),null;if(!x.ok)throw new Error(`HTTP error! status: ${x.status}`);const v=x.headers.get("ETag");return v&&await R2(`${o}_etag`,v),await x.arrayBuffer()}async parseInWorker(n,o){return new Promise((h,g)=>{this.worker||(this.worker=new Worker(new URL("/finland-boater-map/assets/gpkgParser.worker-DYvnxJnm.js",import.meta.url),{type:"module"}));const x=v=>{var u,C;v.data.type==="result"?((u=this.worker)==null||u.removeEventListener("message",x),h(v.data.data)):v.data.type==="error"&&((C=this.worker)==null||C.removeEventListener("message",x),g(new Error(v.data.error)))};this.worker.addEventListener("message",x),this.worker.postMessage({type:"parse",dataType:o,arrayBuffer:n})})}async storeData(n,o){await wi.transaction("rw",[wi.restriction_areas,wi.traffic_signs],async()=>{await wi.restriction_areas.clear(),await wi.traffic_signs.clear(),await wi.restriction_areas.bulkAdd(n),await wi.traffic_signs.bulkAdd(o)})}cleanup(){this.worker&&(this.worker.terminate(),this.worker=null)}}function tP(r,n,o,h,g){B2(r,n,o||0,h||r.length-1,g||rP)}function B2(r,n,o,h,g){for(;h>o;){if(h-o>600){var x=h-o+1,v=n-o+1,u=Math.log(x),C=.5*Math.exp(2*u/3),O=.5*Math.sqrt(u*C*(x-C)/x)*(v-x/2<0?-1:1),U=Math.max(o,Math.floor(n-v*C/x+O)),j=Math.min(h,Math.floor(n+(x-v)*C/x+O));B2(r,n,U,j,g)}var L=r[n],oe=o,de=h;for(mh(r,o,n),g(r[h],L)>0&&mh(r,o,h);oe<de;){for(mh(r,oe,de),oe++,de--;g(r[oe],L)<0;)oe++;for(;g(r[de],L)>0;)de--}g(r[o],L)===0?mh(r,o,de):(de++,mh(r,de,h)),de<=n&&(o=de+1),n<=de&&(h=de-1)}}function mh(r,n,o){var h=r[n];r[n]=r[o],r[o]=h}function rP(r,n){return r<n?-1:r>n?1:0}class Ow{constructor(n=9){this._maxEntries=Math.max(4,n),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(n){let o=this.data;const h=[];if(!qp(n,o))return h;const g=this.toBBox,x=[];for(;o;){for(let v=0;v<o.children.length;v++){const u=o.children[v],C=o.leaf?g(u):u;qp(n,C)&&(o.leaf?h.push(u):iy(n,C)?this._all(u,h):x.push(u))}o=x.pop()}return h}collides(n){let o=this.data;if(!qp(n,o))return!1;const h=[];for(;o;){for(let g=0;g<o.children.length;g++){const x=o.children[g],v=o.leaf?this.toBBox(x):x;if(qp(n,v)){if(o.leaf||iy(n,v))return!0;h.push(x)}}o=h.pop()}return!1}load(n){if(!(n&&n.length))return this;if(n.length<this._minEntries){for(let h=0;h<n.length;h++)this.insert(n[h]);return this}let o=this._build(n.slice(),0,n.length-1,0);if(!this.data.children.length)this.data=o;else if(this.data.height===o.height)this._splitRoot(this.data,o);else{if(this.data.height<o.height){const h=this.data;this.data=o,o=h}this._insert(o,this.data.height-o.height-1,!0)}return this}insert(n){return n&&this._insert(n,this.data.height-1),this}clear(){return this.data=yu([]),this}remove(n,o){if(!n)return this;let h=this.data;const g=this.toBBox(n),x=[],v=[];let u,C,O;for(;h||x.length;){if(h||(h=x.pop(),C=x[x.length-1],u=v.pop(),O=!0),h.leaf){const U=nP(n,h.children,o);if(U!==-1)return h.children.splice(U,1),x.push(h),this._condense(x),this}!O&&!h.leaf&&iy(h,g)?(x.push(h),v.push(u),u=0,C=h,h=h.children[0]):C?(u++,h=C.children[u],O=!1):h=null}return this}toBBox(n){return n}compareMinX(n,o){return n.minX-o.minX}compareMinY(n,o){return n.minY-o.minY}toJSON(){return this.data}fromJSON(n){return this.data=n,this}_all(n,o){const h=[];for(;n;)n.leaf?o.push(...n.children):h.push(...n.children),n=h.pop();return o}_build(n,o,h,g){const x=h-o+1;let v=this._maxEntries,u;if(x<=v)return u=yu(n.slice(o,h+1)),mu(u,this.toBBox),u;g||(g=Math.ceil(Math.log(x)/Math.log(v)),v=Math.ceil(x/Math.pow(v,g-1))),u=yu([]),u.leaf=!1,u.height=g;const C=Math.ceil(x/v),O=C*Math.ceil(Math.sqrt(v));Nw(n,o,h,O,this.compareMinX);for(let U=o;U<=h;U+=O){const j=Math.min(U+O-1,h);Nw(n,U,j,C,this.compareMinY);for(let L=U;L<=j;L+=C){const oe=Math.min(L+C-1,j);u.children.push(this._build(n,L,oe,g-1))}}return mu(u,this.toBBox),u}_chooseSubtree(n,o,h,g){for(;g.push(o),!(o.leaf||g.length-1===h);){let x=1/0,v=1/0,u;for(let C=0;C<o.children.length;C++){const O=o.children[C],U=ny(O),j=aP(n,O)-U;j<v?(v=j,x=U<x?U:x,u=O):j===v&&U<x&&(x=U,u=O)}o=u||o.children[0]}return o}_insert(n,o,h){const g=h?n:this.toBBox(n),x=[],v=this._chooseSubtree(g,this.data,o,x);for(v.children.push(n),kh(v,g);o>=0&&x[o].children.length>this._maxEntries;)this._split(x,o),o--;this._adjustParentBBoxes(g,x,o)}_split(n,o){const h=n[o],g=h.children.length,x=this._minEntries;this._chooseSplitAxis(h,x,g);const v=this._chooseSplitIndex(h,x,g),u=yu(h.children.splice(v,h.children.length-v));u.height=h.height,u.leaf=h.leaf,mu(h,this.toBBox),mu(u,this.toBBox),o?n[o-1].children.push(u):this._splitRoot(h,u)}_splitRoot(n,o){this.data=yu([n,o]),this.data.height=n.height+1,this.data.leaf=!1,mu(this.data,this.toBBox)}_chooseSplitIndex(n,o,h){let g,x=1/0,v=1/0;for(let u=o;u<=h-o;u++){const C=Sh(n,0,u,this.toBBox),O=Sh(n,u,h,this.toBBox),U=oP(C,O),j=ny(C)+ny(O);U<x?(x=U,g=u,v=j<v?j:v):U===x&&j<v&&(v=j,g=u)}return g||h-o}_chooseSplitAxis(n,o,h){const g=n.leaf?this.compareMinX:iP,x=n.leaf?this.compareMinY:sP,v=this._allDistMargin(n,o,h,g),u=this._allDistMargin(n,o,h,x);v<u&&n.children.sort(g)}_allDistMargin(n,o,h,g){n.children.sort(g);const x=this.toBBox,v=Sh(n,0,o,x),u=Sh(n,h-o,h,x);let C=$p(v)+$p(u);for(let O=o;O<h-o;O++){const U=n.children[O];kh(v,n.leaf?x(U):U),C+=$p(v)}for(let O=h-o-1;O>=o;O--){const U=n.children[O];kh(u,n.leaf?x(U):U),C+=$p(u)}return C}_adjustParentBBoxes(n,o,h){for(let g=h;g>=0;g--)kh(o[g],n)}_condense(n){for(let o=n.length-1,h;o>=0;o--)n[o].children.length===0?o>0?(h=n[o-1].children,h.splice(h.indexOf(n[o]),1)):this.clear():mu(n[o],this.toBBox)}}function nP(r,n,o){if(!o)return n.indexOf(r);for(let h=0;h<n.length;h++)if(o(r,n[h]))return h;return-1}function mu(r,n){Sh(r,0,r.children.length,n,r)}function Sh(r,n,o,h,g){g||(g=yu(null)),g.minX=1/0,g.minY=1/0,g.maxX=-1/0,g.maxY=-1/0;for(let x=n;x<o;x++){const v=r.children[x];kh(g,r.leaf?h(v):v)}return g}function kh(r,n){return r.minX=Math.min(r.minX,n.minX),r.minY=Math.min(r.minY,n.minY),r.maxX=Math.max(r.maxX,n.maxX),r.maxY=Math.max(r.maxY,n.maxY),r}function iP(r,n){return r.minX-n.minX}function sP(r,n){return r.minY-n.minY}function ny(r){return(r.maxX-r.minX)*(r.maxY-r.minY)}function $p(r){return r.maxX-r.minX+(r.maxY-r.minY)}function aP(r,n){return(Math.max(n.maxX,r.maxX)-Math.min(n.minX,r.minX))*(Math.max(n.maxY,r.maxY)-Math.min(n.minY,r.minY))}function oP(r,n){const o=Math.max(r.minX,n.minX),h=Math.max(r.minY,n.minY),g=Math.min(r.maxX,n.maxX),x=Math.min(r.maxY,n.maxY);return Math.max(0,g-o)*Math.max(0,x-h)}function iy(r,n){return r.minX<=n.minX&&r.minY<=n.minY&&n.maxX<=r.maxX&&n.maxY<=r.maxY}function qp(r,n){return n.minX<=r.maxX&&n.minY<=r.maxY&&n.maxX>=r.minX&&n.maxY>=r.minY}function yu(r){return{children:r,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Nw(r,n,o,h,g){const x=[n,o];for(;x.length;){if(o=x.pop(),n=x.pop(),o-n<=h)continue;const v=n+Math.ceil((o-n)/h/2)*h;tP(r,v,n,o,g),x.push(n,v,v,o)}}class lP{constructor(){vs(this,"areaIndex");vs(this,"signIndex");vs(this,"areaMap");vs(this,"signMap");this.areaIndex=new Ow,this.signIndex=new Ow,this.areaMap=new Map,this.signMap=new Map}buildAreaIndex(n){this.areaMap.clear();const o=[];for(const h of n)this.areaMap.set(h.id,h),o.push({minX:h.bbox[0],minY:h.bbox[1],maxX:h.bbox[2],maxY:h.bbox[3],id:h.id});this.areaIndex.clear(),this.areaIndex.load(o)}buildSignIndex(n){this.signMap.clear();const o=[];for(const h of n){this.signMap.set(h.id,h);const[g,x]=h.geometry.coordinates;o.push({minX:g,minY:x,maxX:g,maxY:x,id:h.id})}this.signIndex.clear(),this.signIndex.load(o)}getCandidateAreas(n,o,h=.01){return this.areaIndex.search({minX:n-h,minY:o-h,maxX:n+h,maxY:o+h}).map(x=>this.areaMap.get(x.id)).filter(x=>x!=null)}getNearbySignsInRadius(n,o,h){const g=h/111e3,x=h/55e3;return this.signIndex.search({minX:n-x,minY:o-g,maxX:n+x,maxY:o+g}).map(u=>this.signMap.get(u.id)).filter(u=>u!=null)}getAllAreas(){return Array.from(this.areaMap.values())}getAllSigns(){return Array.from(this.signMap.values())}}const Zp=new lP;var Jn=63710088e-1,uP={centimeters:Jn*100,centimetres:Jn*100,degrees:Jn/111325,feet:Jn*3.28084,inches:Jn*39.37,kilometers:Jn/1e3,kilometres:Jn/1e3,meters:Jn,metres:Jn,miles:Jn/1609.344,millimeters:Jn*1e3,millimetres:Jn*1e3,nauticalmiles:Jn/1852,radians:1,yards:Jn*1.0936};function cP(r,n,o){o===void 0&&(o={});var h={type:"Feature"};return(o.id===0||o.id)&&(h.id=o.id),o.bbox&&(h.bbox=o.bbox),h.properties={},h.geometry=r,h}function S_(r,n,o){if(o===void 0&&(o={}),!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!jw(r[0])||!jw(r[1]))throw new Error("coordinates must contain numbers");var h={type:"Point",coordinates:r};return cP(h,n,o)}function hP(r,n){n===void 0&&(n="kilometers");var o=uP[n];if(!o)throw new Error(n+" units is invalid");return r*o}function Gp(r){var n=r%360;return n*Math.PI/180}function jw(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function k_(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function dP(r){return r.type==="Feature"?r.geometry:r}function pP(r,n,o){if(o===void 0&&(o={}),!r)throw new Error("point is required");if(!n)throw new Error("polygon is required");var h=k_(r),g=dP(n),x=g.type,v=n.bbox,u=g.coordinates;if(v&&fP(h,v)===!1)return!1;x==="Polygon"&&(u=[u]);for(var C=!1,O=0;O<u.length&&!C;O++)if(Vw(h,u[O][0],o.ignoreBoundary)){for(var U=!1,j=1;j<u[O].length&&!U;)Vw(h,u[O][j],!o.ignoreBoundary)&&(U=!0),j++;U||(C=!0)}return C}function Vw(r,n,o){var h=!1;n[0][0]===n[n.length-1][0]&&n[0][1]===n[n.length-1][1]&&(n=n.slice(0,n.length-1));for(var g=0,x=n.length-1;g<n.length;x=g++){var v=n[g][0],u=n[g][1],C=n[x][0],O=n[x][1],U=r[1]*(v-C)+u*(C-r[0])+O*(r[0]-v)===0&&(v-r[0])*(C-r[0])<=0&&(u-r[1])*(O-r[1])<=0;if(U)return!o;var j=u>r[1]!=O>r[1]&&r[0]<(C-v)*(r[1]-u)/(O-u)+v;j&&(h=!h)}return h}function fP(r,n){return n[0]<=r[0]&&n[1]<=r[1]&&n[2]>=r[0]&&n[3]>=r[1]}function mP(r,n,o,h=new Date){const g=S_([n.lng,n.lat]);if(!pP(g,r.geometry))return!1;if(r.alkuPvm){const v=new Date(r.alkuPvm);if(h<v)return!1}if(r.loppuPvm){const v=new Date(r.loppuPvm);if(h>v)return!1}return!(!o.ammattiliikenne&&r.poikkeus&&r.poikkeus.toLowerCase().includes("huvi")||!o.vesiskootteri&&r.rajoitustyyppi&&r.rajoitustyyppi.toLowerCase().includes("vesiskootterilla"))}function gP(r,n,o){const h=new Date,g=[];for(const v of r)mP(v,n,o,h)&&g.push({...v});const x=g.filter(v=>v.suuruusKmh!=null);if(x.length>0){const v=x.reduce((u,C)=>C.suuruusKmh<u.suuruusKmh?C:u);v.isPrimary=!0}return g.sort((v,u)=>v.isPrimary&&!u.isPrimary?-1:!v.isPrimary&&u.isPrimary?1:v.suuruusKmh!=null&&u.suuruusKmh!=null?v.suuruusKmh-u.suuruusKmh:v.suuruusKmh!=null?-1:u.suuruusKmh!=null?1:v.rajoitustyyppi.localeCompare(u.rajoitustyyppi,"fi")),g}function Uw(r){return r.suuruusKmh!=null?`Nopeusrajoitus ${r.suuruusKmh} km/h`:r.rajoitustyyppi||"Rajoitus"}function yP(r,n,o){o===void 0&&(o={});var h=k_(r),g=k_(n),x=Gp(g[1]-h[1]),v=Gp(g[0]-h[0]),u=Gp(h[1]),C=Gp(g[1]),O=Math.pow(Math.sin(x/2),2)+Math.pow(Math.sin(v/2),2)*Math.cos(u)*Math.cos(C);return hP(2*Math.atan2(Math.sqrt(O),Math.sqrt(1-O)),o.units)}function _P(r,n,o){const h=S_([n.lng,n.lat]),g=[];for(const x of r){if(o.selectedVlmtyyppi.size>0&&!o.selectedVlmtyyppi.has(x.vlmtyyppi))continue;const v=S_(x.geometry.coordinates),u=yP(h,v,{units:"meters"});u<=o.nearbyRadius&&g.push({...x,distance:Math.round(u),iconUrl:vP(x.iconKey)})}return g.sort((x,v)=>x.distance-v.distance),g}function vP(r){return`/icons/${r}.png`}function $w(r){return r.nimiFi||r.nimiSv||`Merkki ${r.vlmlajityyppi}`}function xP(r){return r<1e3?`${r} m`:`${(r/1e3).toFixed(1)} km`}function wP(r){const n=new Set;return r.forEach(o=>n.add(o.vlmtyyppi)),Array.from(n).sort((o,h)=>o-h)}var F2={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */(function(r,n){(function(o,h){r.exports=h()})(Dk,function(){var o={},h={};function g(v,u,C){if(h[v]=C,v==="index"){var O="var sharedModule = {}; ("+h.shared+")(sharedModule); ("+h.worker+")(sharedModule);",U={};return h.shared(U),h.index(o,U),typeof window<"u"&&o.setWorkerUrl(window.URL.createObjectURL(new Blob([O],{type:"text/javascript"}))),o}}g("shared",["exports"],function(v){function u(i,t,s,l){return new(s||(s=Promise))(function(p,y){function _(I){try{S(l.next(I))}catch(E){y(E)}}function w(I){try{S(l.throw(I))}catch(E){y(E)}}function S(I){var E;I.done?p(I.value):(E=I.value,E instanceof s?E:new s(function(M){M(E)})).then(_,w)}S((l=l.apply(i,t||[])).next())})}function C(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var O=U;function U(i,t){this.x=i,this.y=t}U.prototype={clone:function(){return new U(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,t){return this.clone()._rotateAround(i,t)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var t=i.x-this.x,s=i.y-this.y;return t*t+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,t){return Math.atan2(this.x*t-this.y*i,this.x*i+this.y*t)},_matMult:function(i){var t=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=t,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var t=Math.cos(i),s=Math.sin(i),l=s*this.x+t*this.y;return this.x=t*this.x-s*this.y,this.y=l,this},_rotateAround:function(i,t){var s=Math.cos(i),l=Math.sin(i),p=t.y+l*(this.x-t.x)+s*(this.y-t.y);return this.x=t.x+s*(this.x-t.x)-l*(this.y-t.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},U.convert=function(i){return i instanceof U?i:Array.isArray(i)?new U(i[0],i[1]):i};var j=C(O),L=oe;function oe(i,t,s,l){this.cx=3*i,this.bx=3*(s-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(l-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=s,this.p2y=l}oe.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var s=i,l=0;l<8;l++){var p=this.sampleCurveX(s)-i;if(Math.abs(p)<t)return s;var y=this.sampleCurveDerivativeX(s);if(Math.abs(y)<1e-6)break;s-=p/y}var _=0,w=1;for(s=i,l=0;l<20&&(p=this.sampleCurveX(s),!(Math.abs(p-i)<t));l++)i>p?_=s:w=s,s=.5*(w-_)+_;return s},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var de=C(L);let he,Ie;function K(){return he==null&&(he=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),he}function G(){if(Ie==null&&(Ie=!1,K())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let l=0;l<5*5;l++){const p=4*l;t.fillStyle=`rgb(${p},${p+1},${p+2})`,t.fillRect(l%5,Math.floor(l/5),1,1)}const s=t.getImageData(0,0,5,5).data;for(let l=0;l<5*5*4;l++)if(l%4!=3&&s[l]!==l){Ie=!0;break}}}return Ie||!1}function ee(i,t,s,l){const p=new de(i,t,s,l);return y=>p.solve(y)}const _e=ee(.25,.1,.25,1);function Se(i,t,s){return Math.min(s,Math.max(t,i))}function Te(i,t,s){const l=s-t,p=((i-t)%l+l)%l+t;return p===t?s:p}function xe(i,...t){for(const s of t)for(const l in s)i[l]=s[l];return i}let Pe=1;function Ce(i,t,s){const l={};for(const p in i)l[p]=t.call(this,i[p],p,i);return l}function rt(i,t,s){const l={};for(const p in i)t.call(this,i[p],p,i)&&(l[p]=i[p]);return l}function Ye(i){return Array.isArray(i)?i.map(Ye):typeof i=="object"&&i?Ce(i,Ye):i}const Wt={};function Tt(i){Wt[i]||(typeof console<"u"&&console.warn(i),Wt[i]=!0)}function bt(i,t,s){return(s.y-i.y)*(t.x-i.x)>(t.y-i.y)*(s.x-i.x)}function vr(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let Tr=null;function Nt(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const He="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ht(i,t,s,l,p){return u(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const y=new VideoFrame(i,{timestamp:0});try{const _=y==null?void 0:y.format;if(!_||!_.startsWith("BGR")&&!_.startsWith("RGB"))throw new Error(`Unrecognized format ${_}`);const w=_.startsWith("BGR"),S=new Uint8ClampedArray(l*p*4);if(yield y.copyTo(S,function(I,E,M,D,F){const V=4*Math.max(-E,0),$=(Math.max(0,M)-M)*D*4+V,X=4*D,te=Math.max(0,E),ge=Math.max(0,M);return{rect:{x:te,y:ge,width:Math.min(I.width,E+D)-te,height:Math.min(I.height,M+F)-ge},layout:[{offset:$,stride:X}]}}(i,t,s,l,p)),w)for(let I=0;I<S.length;I+=4){const E=S[I];S[I]=S[I+2],S[I+2]=E}return S}finally{y.close()}})}let pt,At;const Ut="AbortError";function ii(){return new Error(Ut)}const Zr={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function dn(i){return Zr.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const pn="global-dispatcher";class zr extends Error{constructor(t,s,l,p){super(`AJAXError: ${s} (${t}): ${l}`),this.status=t,this.statusText=s,this.url=l,this.body=p}}const si=()=>vr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Es=function(i,t){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const l=dn(i.url);if(l)return l(i,t);if(vr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:pn},t)}if(!(/^file:/.test(s=i.url)||/^file:/.test(si())&&!/^\w+:/.test(s))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(l,p){return u(this,void 0,void 0,function*(){const y=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,cache:l.cache,referrer:si(),signal:p.signal});l.type!=="json"||y.headers.has("Accept")||y.headers.set("Accept","application/json");const _=yield fetch(y);if(!_.ok){const I=yield _.blob();throw new zr(_.status,_.statusText,l.url,I)}let w;w=l.type==="arrayBuffer"||l.type==="image"?_.arrayBuffer():l.type==="json"?_.json():_.text();const S=yield w;if(p.signal.aborted)throw ii();return{data:S,cacheControl:_.headers.get("Cache-Control"),expires:_.headers.get("Expires")}})}(i,t);if(vr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:pn},t)}var s;return function(l,p){return new Promise((y,_)=>{var w;const S=new XMLHttpRequest;S.open(l.method||"GET",l.url,!0),l.type!=="arrayBuffer"&&l.type!=="image"||(S.responseType="arraybuffer");for(const I in l.headers)S.setRequestHeader(I,l.headers[I]);l.type==="json"&&(S.responseType="text",!((w=l.headers)===null||w===void 0)&&w.Accept||S.setRequestHeader("Accept","application/json")),S.withCredentials=l.credentials==="include",S.onerror=()=>{_(new Error(S.statusText))},S.onload=()=>{if(!p.signal.aborted)if((S.status>=200&&S.status<300||S.status===0)&&S.response!==null){let I=S.response;if(l.type==="json")try{I=JSON.parse(S.response)}catch(E){return void _(E)}y({data:I,cacheControl:S.getResponseHeader("Cache-Control"),expires:S.getResponseHeader("Expires")})}else{const I=new Blob([S.response],{type:S.getResponseHeader("Content-Type")});_(new zr(S.status,S.statusText,l.url,I))}},p.signal.addEventListener("abort",()=>{S.abort(),_(ii())}),S.send(l.body)})}(i,t)};function Ps(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const t=new URL(i),s=window.location;return t.protocol===s.protocol&&t.host===s.host}function _o(i,t,s){s[i]&&s[i].indexOf(t)!==-1||(s[i]=s[i]||[],s[i].push(t))}function qi(i,t,s){if(s&&s[i]){const l=s[i].indexOf(t);l!==-1&&s[i].splice(l,1)}}class as{constructor(t,s={}){xe(this,s),this.type=t}}class os extends as{constructor(t,s={}){super("error",xe({error:t},s))}}class ca{on(t,s){return this._listeners=this._listeners||{},_o(t,s,this._listeners),this}off(t,s){return qi(t,s,this._listeners),qi(t,s,this._oneTimeListeners),this}once(t,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},_o(t,s,this._oneTimeListeners),this):new Promise(l=>this.once(t,l))}fire(t,s){typeof t=="string"&&(t=new as(t,s||{}));const l=t.type;if(this.listens(l)){t.target=this;const p=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const w of p)w.call(this,t);const y=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const w of y)qi(l,w,this._oneTimeListeners),w.call(this,t);const _=this._eventedParent;_&&(xe(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),_.fire(t))}else t instanceof os&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,s){return this._eventedParent=t,this._eventedParentData=s,this}}var we={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Cs=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function vo(i,t){const s={};for(const l in i)l!=="ref"&&(s[l]=i[l]);return Cs.forEach(l=>{l in t&&(s[l]=t[l])}),s}function Ft(i,t){if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let s=0;s<i.length;s++)if(!Ft(i[s],t[s]))return!1;return!0}if(typeof i=="object"&&i!==null&&t!==null){if(typeof t!="object"||Object.keys(i).length!==Object.keys(t).length)return!1;for(const s in i)if(!Ft(i[s],t[s]))return!1;return!0}return i===t}function lr(i,t){i.push(t)}function xo(i,t,s){lr(s,{command:"addSource",args:[i,t[i]]})}function ls(i,t,s){lr(t,{command:"removeSource",args:[i]}),s[i]=!0}function Zi(i,t,s,l){ls(i,s,l),xo(i,t,s)}function ha(i,t,s){let l;for(l in i[s])if(Object.prototype.hasOwnProperty.call(i[s],l)&&l!=="data"&&!Ft(i[s][l],t[s][l]))return!1;for(l in t[s])if(Object.prototype.hasOwnProperty.call(t[s],l)&&l!=="data"&&!Ft(i[s][l],t[s][l]))return!1;return!0}function $n(i,t,s,l,p,y){i=i||{},t=t||{};for(const _ in i)Object.prototype.hasOwnProperty.call(i,_)&&(Ft(i[_],t[_])||s.push({command:y,args:[l,_,t[_],p]}));for(const _ in t)Object.prototype.hasOwnProperty.call(t,_)&&!Object.prototype.hasOwnProperty.call(i,_)&&(Ft(i[_],t[_])||s.push({command:y,args:[l,_,t[_],p]}))}function wo(i){return i.id}function bo(i,t){return i[t.id]=t,i}class Le{constructor(t,s,l,p){this.message=(t?`${t}: `:"")+l,p&&(this.identifier=p),s!=null&&s.__line__&&(this.line=s.__line__)}}function Pi(i,...t){for(const s of t)for(const l in s)i[l]=s[l];return i}class rn extends Error{constructor(t,s){super(s),this.message=s,this.key=t}}class Ci{constructor(t,s=[]){this.parent=t,this.bindings={};for(const[l,p]of s)this.bindings[l]=p}concat(t){return new Ci(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const us={kind:"null"},Ne={kind:"number"},St={kind:"string"},dt={kind:"boolean"},fn={kind:"color"},ai={kind:"object"},_t={kind:"value"},Mi={kind:"collator"},Gi={kind:"formatted"},cs={kind:"padding"},Ai={kind:"resolvedImage"},Q={kind:"variableAnchorOffsetCollection"};function B(i,t){return{kind:"array",itemType:i,N:t}}function R(i){if(i.kind==="array"){const t=R(i.itemType);return typeof i.N=="number"?`array<${t}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${t}>`}return i.kind}const q=[us,Ne,St,dt,fn,Gi,ai,B(_t),cs,Ai,Q];function Y(i,t){if(t.kind==="error")return null;if(i.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Y(i.itemType,t.itemType))&&(typeof i.N!="number"||i.N===t.N))return null}else{if(i.kind===t.kind)return null;if(i.kind==="value"){for(const s of q)if(!Y(s,t))return null}}return`Expected ${R(i)} but found ${R(t)} instead.`}function le(i,t){return t.some(s=>s.kind===i.kind)}function ce(i,t){return t.some(s=>s==="null"?i===null:s==="array"?Array.isArray(i):s==="object"?i&&!Array.isArray(i)&&typeof i=="object":s===typeof i)}function me(i,t){return i.kind==="array"&&t.kind==="array"?i.itemType.kind===t.itemType.kind&&typeof i.N=="number":i.kind===t.kind}const ie=.96422,ke=.82521,Ae=4/29,ve=6/29,Be=3*ve*ve,at=ve*ve*ve,lt=Math.PI/180,zt=180/Math.PI;function vt(i){return(i%=360)<0&&(i+=360),i}function Dt([i,t,s,l]){let p,y;const _=Ir((.2225045*(i=Et(i))+.7168786*(t=Et(t))+.0606169*(s=Et(s)))/1);i===t&&t===s?p=y=_:(p=Ir((.4360747*i+.3850649*t+.1430804*s)/ie),y=Ir((.0139322*i+.0971045*t+.7141733*s)/ke));const w=116*_-16;return[w<0?0:w,500*(p-_),200*(_-y),l]}function Et(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Ir(i){return i>at?Math.pow(i,1/3):i/Be+Ae}function ur([i,t,s,l]){let p=(i+16)/116,y=isNaN(t)?p:p+t/500,_=isNaN(s)?p:p-s/200;return p=1*$t(p),y=ie*$t(y),_=ke*$t(_),[kt(3.1338561*y-1.6168667*p-.4906146*_),kt(-.9787684*y+1.9161415*p+.033454*_),kt(.0719453*y-.2289914*p+1.4052427*_),l]}function kt(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function $t(i){return i>ve?i*i*i:Be*(i-Ae)}function sr(i){return parseInt(i.padEnd(2,i),16)/255}function Dr(i,t){return Nr(t?i/100:i,0,1)}function Nr(i,t,s){return Math.min(Math.max(t,i),s)}function nn(i){return!i.some(Number.isNaN)}const da={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class qt{constructor(t,s,l,p=1,y=!0){this.r=t,this.g=s,this.b=l,this.a=p,y||(this.r*=p,this.g*=p,this.b*=p,p||this.overwriteGetter("rgb",[t,s,l,p]))}static parse(t){if(t instanceof qt)return t;if(typeof t!="string")return;const s=function(l){if((l=l.toLowerCase().trim())==="transparent")return[0,0,0,0];const p=da[l];if(p){const[_,w,S]=p;return[_/255,w/255,S/255,1]}if(l.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(l)){const _=l.length<6?1:2;let w=1;return[sr(l.slice(w,w+=_)),sr(l.slice(w,w+=_)),sr(l.slice(w,w+=_)),sr(l.slice(w,w+_)||"ff")]}if(l.startsWith("rgb")){const _=l.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){const[w,S,I,E,M,D,F,V,$,X,te,ge]=_,ae=[E||" ",F||" ",X].join("");if(ae==="  "||ae==="  /"||ae===",,"||ae===",,,"){const fe=[I,D,$].join(""),be=fe==="%%%"?100:fe===""?255:0;if(be){const ze=[Nr(+S/be,0,1),Nr(+M/be,0,1),Nr(+V/be,0,1),te?Dr(+te,ge):1];if(nn(ze))return ze}}return}}const y=l.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(y){const[_,w,S,I,E,M,D,F,V]=y,$=[S||" ",E||" ",D].join("");if($==="  "||$==="  /"||$===",,"||$===",,,"){const X=[+w,Nr(+I,0,100),Nr(+M,0,100),F?Dr(+F,V):1];if(nn(X))return function([te,ge,ae,fe]){function be(ze){const Ge=(ze+te/30)%12,ut=ge*Math.min(ae,1-ae);return ae-ut*Math.max(-1,Math.min(Ge-3,9-Ge,1))}return te=vt(te),ge/=100,ae/=100,[be(0),be(8),be(4),fe]}(X)}}}(t);return s?new qt(...s,!1):void 0}get rgb(){const{r:t,g:s,b:l,a:p}=this,y=p||1/0;return this.overwriteGetter("rgb",[t/y,s/y,l/y,p])}get hcl(){return this.overwriteGetter("hcl",function(t){const[s,l,p,y]=Dt(t),_=Math.sqrt(l*l+p*p);return[Math.round(1e4*_)?vt(Math.atan2(p,l)*zt):NaN,_,s,y]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Dt(this.rgb))}overwriteGetter(t,s){return Object.defineProperty(this,t,{value:s}),s}toString(){const[t,s,l,p]=this.rgb;return`rgba(${[t,s,l].map(y=>Math.round(255*y)).join(",")},${p})`}}qt.black=new qt(0,0,0,1),qt.white=new qt(1,1,1,1),qt.transparent=new qt(0,0,0,0),qt.red=new qt(1,0,0,1);class Ju{constructor(t,s,l){this.sensitivity=t?s?"variant":"case":s?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,s){return this.collator.compare(t,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Qu{constructor(t,s,l,p,y){this.text=t,this.image=s,this.scale=l,this.fontStack=p,this.textColor=y}}class Cn{constructor(t){this.sections=t}static fromString(t){return new Cn([new Qu(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof Cn?t:Cn.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class Mn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Mn)return t;if(typeof t=="number")return new Mn([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const s of t)if(typeof s!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new Mn(t)}}toString(){return JSON.stringify(this.values)}}const um=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class qn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof qn)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let s=0;s<t.length;s+=2){const l=t[s],p=t[s+1];if(typeof l!="string"||!um.has(l)||!Array.isArray(p)||p.length!==2||typeof p[0]!="number"||typeof p[1]!="number")return}return new qn(t)}}toString(){return JSON.stringify(this.values)}}class An{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new An({name:t,available:!1}):null}}function pa(i,t,s,l){return typeof i=="number"&&i>=0&&i<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof s=="number"&&s>=0&&s<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[i,t,s,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[i,t,s,l]:[i,t,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ms(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof qt||i instanceof Ju||i instanceof Cn||i instanceof Mn||i instanceof qn||i instanceof An)return!0;if(Array.isArray(i)){for(const t of i)if(!Ms(t))return!1;return!0}if(typeof i=="object"){for(const t in i)if(!Ms(i[t]))return!1;return!0}return!1}function Er(i){if(i===null)return us;if(typeof i=="string")return St;if(typeof i=="boolean")return dt;if(typeof i=="number")return Ne;if(i instanceof qt)return fn;if(i instanceof Ju)return Mi;if(i instanceof Cn)return Gi;if(i instanceof Mn)return cs;if(i instanceof qn)return Q;if(i instanceof An)return Ai;if(Array.isArray(i)){const t=i.length;let s;for(const l of i){const p=Er(l);if(s){if(s===p)continue;s=_t;break}s=p}return B(s||_t,t)}return ai}function So(i){const t=typeof i;return i===null?"":t==="string"||t==="number"||t==="boolean"?String(i):i instanceof qt||i instanceof Cn||i instanceof Mn||i instanceof qn||i instanceof An?i.toString():JSON.stringify(i)}class oi{constructor(t,s){this.type=t,this.value=s}static parse(t,s){if(t.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Ms(t[1]))return s.error("invalid value");const l=t[1];let p=Er(l);const y=s.expectedType;return p.kind!=="array"||p.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(p=y),new oi(p,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class xr{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const _l={string:St,number:Ne,boolean:dt,object:ai};class li{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");let l,p=1;const y=t[0];if(y==="array"){let w,S;if(t.length>2){const I=t[1];if(typeof I!="string"||!(I in _l)||I==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);w=_l[I],p++}else w=_t;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return s.error('The length argument to "array" must be a positive integer literal',2);S=t[2],p++}l=B(w,S)}else{if(!_l[y])throw new Error(`Types doesn't contain name = ${y}`);l=_l[y]}const _=[];for(;p<t.length;p++){const w=s.parse(t[p],p,_t);if(!w)return null;_.push(w)}return new li(l,_)}evaluate(t){for(let s=0;s<this.args.length;s++){const l=this.args[s].evaluate(t);if(!Y(this.type,Er(l)))return l;if(s===this.args.length-1)throw new xr(`Expected value to be of type ${R(this.type)}, but found ${R(Er(l))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const ec={"to-boolean":dt,"to-color":fn,"to-number":Ne,"to-string":St};class ui{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const l=t[0];if(!ec[l])throw new Error(`Can't parse ${l} as it is not part of the known types`);if((l==="to-boolean"||l==="to-string")&&t.length!==2)return s.error("Expected one argument.");const p=ec[l],y=[];for(let _=1;_<t.length;_++){const w=s.parse(t[_],_,_t);if(!w)return null;y.push(w)}return new ui(p,y)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let s,l;for(const p of this.args){if(s=p.evaluate(t),l=null,s instanceof qt)return s;if(typeof s=="string"){const y=t.parseColor(s);if(y)return y}else if(Array.isArray(s)&&(l=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:pa(s[0],s[1],s[2],s[3]),!l))return new qt(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new xr(l||`Could not parse color from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"padding":{let s;for(const l of this.args){s=l.evaluate(t);const p=Mn.parse(s);if(p)return p}throw new xr(`Could not parse padding from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"variableAnchorOffsetCollection":{let s;for(const l of this.args){s=l.evaluate(t);const p=qn.parse(s);if(p)return p}throw new xr(`Could not parse variableAnchorOffsetCollection from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"number":{let s=null;for(const l of this.args){if(s=l.evaluate(t),s===null)return 0;const p=Number(s);if(!isNaN(p))return p}throw new xr(`Could not convert ${JSON.stringify(s)} to number.`)}case"formatted":return Cn.fromString(So(this.args[0].evaluate(t)));case"resolvedImage":return An.fromString(So(this.args[0].evaluate(t)));default:return So(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const cm=["Unknown","Point","LineString","Polygon"];class vl{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?cm[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let s=this._parseColorCache[t];return s||(s=this._parseColorCache[t]=qt.parse(t)),s}}class As{constructor(t,s,l=[],p,y=new Ci,_=[]){this.registry=t,this.path=l,this.key=l.map(w=>`[${w}]`).join(""),this.scope=y,this.errors=_,this.expectedType=p,this._isConstant=s}parse(t,s,l,p,y={}){return s?this.concat(s,l,p)._parse(t,y):this._parse(t,y)}_parse(t,s){function l(p,y,_){return _==="assert"?new li(y,[p]):_==="coerce"?new ui(y,[p]):p}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=t[0];if(typeof p!="string")return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const y=this.registry[p];if(y){let _=y.parse(t,this);if(!_)return null;if(this.expectedType){const w=this.expectedType,S=_.type;if(w.kind!=="string"&&w.kind!=="number"&&w.kind!=="boolean"&&w.kind!=="object"&&w.kind!=="array"||S.kind!=="value")if(w.kind!=="color"&&w.kind!=="formatted"&&w.kind!=="resolvedImage"||S.kind!=="value"&&S.kind!=="string")if(w.kind!=="padding"||S.kind!=="value"&&S.kind!=="number"&&S.kind!=="array")if(w.kind!=="variableAnchorOffsetCollection"||S.kind!=="value"&&S.kind!=="array"){if(this.checkSubtype(w,S))return null}else _=l(_,w,s.typeAnnotation||"coerce");else _=l(_,w,s.typeAnnotation||"coerce");else _=l(_,w,s.typeAnnotation||"coerce");else _=l(_,w,s.typeAnnotation||"assert")}if(!(_ instanceof oi)&&_.type.kind!=="resolvedImage"&&this._isConstant(_)){const w=new vl;try{_=new oi(_.type,_.evaluate(w))}catch(S){return this.error(S.message),null}}return _}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,s,l){const p=typeof t=="number"?this.path.concat(t):this.path,y=l?this.scope.concat(l):this.scope;return new As(this.registry,this._isConstant,p,s||null,y,this.errors)}error(t,...s){const l=`${this.key}${s.map(p=>`[${p}]`).join("")}`;this.errors.push(new rn(l,t))}checkSubtype(t,s){const l=Y(t,s);return l&&this.error(l),l}}class hs{constructor(t,s){this.type=s.type,this.bindings=[].concat(t),this.result=s}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const s of this.bindings)t(s[1]);t(this.result)}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const l=[];for(let y=1;y<t.length-1;y+=2){const _=t[y];if(typeof _!="string")return s.error(`Expected string, but found ${typeof _} instead.`,y);if(/[^a-zA-Z0-9_]/.test(_))return s.error("Variable names must contain only alphanumeric characters or '_'.",y);const w=s.parse(t[y+1],y+1);if(!w)return null;l.push([_,w])}const p=s.parse(t[t.length-1],t.length-1,s.expectedType,l);return p?new hs(l,p):null}outputDefined(){return this.result.outputDefined()}}class Ot{constructor(t,s){this.type=s.type,this.name=t,this.boundExpression=s}static parse(t,s){if(t.length!==2||typeof t[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const l=t[1];return s.scope.has(l)?new Ot(l,s.scope.get(l)):s.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class tc{constructor(t,s,l){this.type=t,this.index=s,this.input=l}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const l=s.parse(t[1],1,Ne),p=s.parse(t[2],2,B(s.expectedType||_t));return l&&p?new tc(p.type.itemType,l,p):null}evaluate(t){const s=this.index.evaluate(t),l=this.input.evaluate(t);if(s<0)throw new xr(`Array index out of bounds: ${s} < 0.`);if(s>=l.length)throw new xr(`Array index out of bounds: ${s} > ${l.length-1}.`);if(s!==Math.floor(s))throw new xr(`Array index must be an integer, but found ${s} instead.`);return l[s]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class rc{constructor(t,s){this.type=dt,this.needle=t,this.haystack=s}static parse(t,s){if(t.length!==3)return s.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const l=s.parse(t[1],1,_t),p=s.parse(t[2],2,_t);return l&&p?le(l.type,[dt,St,Ne,us,_t])?new rc(l,p):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${R(l.type)} instead`):null}evaluate(t){const s=this.needle.evaluate(t),l=this.haystack.evaluate(t);if(!l)return!1;if(!ce(s,["boolean","string","number","null"]))throw new xr(`Expected first argument to be of type boolean, string, number or null, but found ${R(Er(s))} instead.`);if(!ce(l,["string","array"]))throw new xr(`Expected second argument to be of type array or string, but found ${R(Er(l))} instead.`);return l.indexOf(s)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class fa{constructor(t,s,l){this.type=Ne,this.needle=t,this.haystack=s,this.fromIndex=l}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const l=s.parse(t[1],1,_t),p=s.parse(t[2],2,_t);if(!l||!p)return null;if(!le(l.type,[dt,St,Ne,us,_t]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${R(l.type)} instead`);if(t.length===4){const y=s.parse(t[3],3,Ne);return y?new fa(l,p,y):null}return new fa(l,p)}evaluate(t){const s=this.needle.evaluate(t),l=this.haystack.evaluate(t);if(!ce(s,["boolean","string","number","null"]))throw new xr(`Expected first argument to be of type boolean, string, number or null, but found ${R(Er(s))} instead.`);let p;if(this.fromIndex&&(p=this.fromIndex.evaluate(t)),ce(l,["string"])){const y=l.indexOf(s,p);return y===-1?-1:[...l.slice(0,y)].length}if(ce(l,["array"]))return l.indexOf(s,p);throw new xr(`Expected second argument to be of type array or string, but found ${R(Er(l))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class nc{constructor(t,s,l,p,y,_){this.inputType=t,this.type=s,this.input=l,this.cases=p,this.outputs=y,this.otherwise=_}static parse(t,s){if(t.length<5)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return s.error("Expected an even number of arguments.");let l,p;s.expectedType&&s.expectedType.kind!=="value"&&(p=s.expectedType);const y={},_=[];for(let I=2;I<t.length-1;I+=2){let E=t[I];const M=t[I+1];Array.isArray(E)||(E=[E]);const D=s.concat(I);if(E.length===0)return D.error("Expected at least one branch label.");for(const V of E){if(typeof V!="number"&&typeof V!="string")return D.error("Branch labels must be numbers or strings.");if(typeof V=="number"&&Math.abs(V)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof V=="number"&&Math.floor(V)!==V)return D.error("Numeric branch labels must be integer values.");if(l){if(D.checkSubtype(l,Er(V)))return null}else l=Er(V);if(y[String(V)]!==void 0)return D.error("Branch labels must be unique.");y[String(V)]=_.length}const F=s.parse(M,I,p);if(!F)return null;p=p||F.type,_.push(F)}const w=s.parse(t[1],1,_t);if(!w)return null;const S=s.parse(t[t.length-1],t.length-1,p);return S?w.type.kind!=="value"&&s.concat(1).checkSubtype(l,w.type)?null:new nc(l,p,w,y,_,S):null}evaluate(t){const s=this.input.evaluate(t);return(Er(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class xl{constructor(t,s,l){this.type=t,this.branches=s,this.otherwise=l}static parse(t,s){if(t.length<4)return s.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return s.error("Expected an odd number of arguments.");let l;s.expectedType&&s.expectedType.kind!=="value"&&(l=s.expectedType);const p=[];for(let _=1;_<t.length-1;_+=2){const w=s.parse(t[_],_,dt);if(!w)return null;const S=s.parse(t[_+1],_+1,l);if(!S)return null;p.push([w,S]),l=l||S.type}const y=s.parse(t[t.length-1],t.length-1,l);if(!y)return null;if(!l)throw new Error("Can't infer output type");return new xl(l,p,y)}evaluate(t){for(const[s,l]of this.branches)if(s.evaluate(t))return l.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[s,l]of this.branches)t(s),t(l);t(this.otherwise)}outputDefined(){return this.branches.every(([t,s])=>s.outputDefined())&&this.otherwise.outputDefined()}}class ko{constructor(t,s,l,p){this.type=t,this.input=s,this.beginIndex=l,this.endIndex=p}static parse(t,s){if(t.length<=2||t.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const l=s.parse(t[1],1,_t),p=s.parse(t[2],2,Ne);if(!l||!p)return null;if(!le(l.type,[B(_t),St,_t]))return s.error(`Expected first argument to be of type array or string, but found ${R(l.type)} instead`);if(t.length===4){const y=s.parse(t[3],3,Ne);return y?new ko(l.type,l,p,y):null}return new ko(l.type,l,p)}evaluate(t){const s=this.input.evaluate(t),l=this.beginIndex.evaluate(t);let p;if(this.endIndex&&(p=this.endIndex.evaluate(t)),ce(s,["string"]))return[...s].slice(l,p).join("");if(ce(s,["array"]))return s.slice(l,p);throw new xr(`Expected first argument to be of type array or string, but found ${R(Er(s))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function wl(i,t){const s=i.length-1;let l,p,y=0,_=s,w=0;for(;y<=_;)if(w=Math.floor((y+_)/2),l=i[w],p=i[w+1],l<=t){if(w===s||t<p)return w;y=w+1}else{if(!(l>t))throw new xr("Input is not a number.");_=w-1}return 0}class ma{constructor(t,s,l){this.type=t,this.input=s,this.labels=[],this.outputs=[];for(const[p,y]of l)this.labels.push(p),this.outputs.push(y)}static parse(t,s){if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");const l=s.parse(t[1],1,Ne);if(!l)return null;const p=[];let y=null;s.expectedType&&s.expectedType.kind!=="value"&&(y=s.expectedType);for(let _=1;_<t.length;_+=2){const w=_===1?-1/0:t[_],S=t[_+1],I=_,E=_+1;if(typeof w!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(p.length&&p[p.length-1][0]>=w)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);const M=s.parse(S,E,y);if(!M)return null;y=y||M.type,p.push([w,M])}return new ma(y,l,p)}evaluate(t){const s=this.labels,l=this.outputs;if(s.length===1)return l[0].evaluate(t);const p=this.input.evaluate(t);if(p<=s[0])return l[0].evaluate(t);const y=s.length;return p>=s[y-1]?l[y-1].evaluate(t):l[wl(s,p)].evaluate(t)}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function yd(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var hm=_d;function _d(i,t,s,l){this.cx=3*i,this.bx=3*(s-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(l-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=s,this.p2y=l}_d.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var s=i,l=0;l<8;l++){var p=this.sampleCurveX(s)-i;if(Math.abs(p)<t)return s;var y=this.sampleCurveDerivativeX(s);if(Math.abs(y)<1e-6)break;s-=p/y}var _=0,w=1;for(s=i,l=0;l<20&&(p=this.sampleCurveX(s),!(Math.abs(p-i)<t));l++)i>p?_=s:w=s,s=.5*(w-_)+_;return s},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var dm=yd(hm);function zs(i,t,s){return i+s*(t-i)}function To(i,t,s){return i.map((l,p)=>zs(l,t[p],s))}const mn={number:zs,color:function(i,t,s,l="rgb"){switch(l){case"rgb":{const[p,y,_,w]=To(i.rgb,t.rgb,s);return new qt(p,y,_,w,!1)}case"hcl":{const[p,y,_,w]=i.hcl,[S,I,E,M]=t.hcl;let D,F;if(isNaN(p)||isNaN(S))isNaN(p)?isNaN(S)?D=NaN:(D=S,_!==1&&_!==0||(F=I)):(D=p,E!==1&&E!==0||(F=y));else{let ge=S-p;S>p&&ge>180?ge-=360:S<p&&p-S>180&&(ge+=360),D=p+s*ge}const[V,$,X,te]=function([ge,ae,fe,be]){return ge=isNaN(ge)?0:ge*lt,ur([fe,Math.cos(ge)*ae,Math.sin(ge)*ae,be])}([D,F??zs(y,I,s),zs(_,E,s),zs(w,M,s)]);return new qt(V,$,X,te,!1)}case"lab":{const[p,y,_,w]=ur(To(i.lab,t.lab,s));return new qt(p,y,_,w,!1)}}},array:To,padding:function(i,t,s){return new Mn(To(i.values,t.values,s))},variableAnchorOffsetCollection:function(i,t,s){const l=i.values,p=t.values;if(l.length!==p.length)throw new xr(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${t.toString()}`);const y=[];for(let _=0;_<l.length;_+=2){if(l[_]!==p[_])throw new xr(`Cannot interpolate values containing mismatched anchors. from[${_}]: ${l[_]}, to[${_}]: ${p[_]}`);y.push(l[_]);const[w,S]=l[_+1],[I,E]=p[_+1];y.push([zs(w,I,s),zs(S,E,s)])}return new qn(y)}};class gn{constructor(t,s,l,p,y){this.type=t,this.operator=s,this.interpolation=l,this.input=p,this.labels=[],this.outputs=[];for(const[_,w]of y)this.labels.push(_),this.outputs.push(w)}static interpolationFactor(t,s,l,p){let y=0;if(t.name==="exponential")y=bl(s,t.base,l,p);else if(t.name==="linear")y=bl(s,1,l,p);else if(t.name==="cubic-bezier"){const _=t.controlPoints;y=new dm(_[0],_[1],_[2],_[3]).solve(bl(s,1,l,p))}return y}static parse(t,s){let[l,p,y,..._]=t;if(!Array.isArray(p)||p.length===0)return s.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const I=p[1];if(typeof I!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:I}}else{if(p[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const I=p.slice(1);if(I.length!==4||I.some(E=>typeof E!="number"||E<0||E>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:I}}}if(t.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(y=s.parse(y,2,Ne),!y)return null;const w=[];let S=null;l==="interpolate-hcl"||l==="interpolate-lab"?S=fn:s.expectedType&&s.expectedType.kind!=="value"&&(S=s.expectedType);for(let I=0;I<_.length;I+=2){const E=_[I],M=_[I+1],D=I+3,F=I+4;if(typeof E!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(w.length&&w[w.length-1][0]>=E)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);const V=s.parse(M,F,S);if(!V)return null;S=S||V.type,w.push([E,V])}return me(S,Ne)||me(S,fn)||me(S,cs)||me(S,Q)||me(S,B(Ne))?new gn(S,l,p,y,w):s.error(`Type ${R(S)} is not interpolatable.`)}evaluate(t){const s=this.labels,l=this.outputs;if(s.length===1)return l[0].evaluate(t);const p=this.input.evaluate(t);if(p<=s[0])return l[0].evaluate(t);const y=s.length;if(p>=s[y-1])return l[y-1].evaluate(t);const _=wl(s,p),w=gn.interpolationFactor(this.interpolation,p,s[_],s[_+1]),S=l[_].evaluate(t),I=l[_+1].evaluate(t);switch(this.operator){case"interpolate":return mn[this.type.kind](S,I,w);case"interpolate-hcl":return mn.color(S,I,w,"hcl");case"interpolate-lab":return mn.color(S,I,w,"lab")}}eachChild(t){t(this.input);for(const s of this.outputs)t(s)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function bl(i,t,s,l){const p=l-s,y=i-s;return p===0?0:t===1?y/p:(Math.pow(t,y)-1)/(Math.pow(t,p)-1)}class Sl{constructor(t,s){this.type=t,this.args=s}static parse(t,s){if(t.length<2)return s.error("Expectected at least one argument.");let l=null;const p=s.expectedType;p&&p.kind!=="value"&&(l=p);const y=[];for(const w of t.slice(1)){const S=s.parse(w,1+y.length,l,void 0,{typeAnnotation:"omit"});if(!S)return null;l=l||S.type,y.push(S)}if(!l)throw new Error("No output type");const _=p&&y.some(w=>Y(p,w.type));return new Sl(_?_t:l,y)}evaluate(t){let s,l=null,p=0;for(const y of this.args)if(p++,l=y.evaluate(t),l&&l instanceof An&&!l.available&&(s||(s=l.name),l=null,p===this.args.length&&(l=s)),l!==null)break;return l}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function kl(i,t){return i==="=="||i==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function vd(i,t,s,l){return l.compare(t,s)===0}function ga(i,t,s){const l=i!=="=="&&i!=="!=";return class O2{constructor(y,_,w){this.type=dt,this.lhs=y,this.rhs=_,this.collator=w,this.hasUntypedArgument=y.type.kind==="value"||_.type.kind==="value"}static parse(y,_){if(y.length!==3&&y.length!==4)return _.error("Expected two or three arguments.");const w=y[0];let S=_.parse(y[1],1,_t);if(!S)return null;if(!kl(w,S.type))return _.concat(1).error(`"${w}" comparisons are not supported for type '${R(S.type)}'.`);let I=_.parse(y[2],2,_t);if(!I)return null;if(!kl(w,I.type))return _.concat(2).error(`"${w}" comparisons are not supported for type '${R(I.type)}'.`);if(S.type.kind!==I.type.kind&&S.type.kind!=="value"&&I.type.kind!=="value")return _.error(`Cannot compare types '${R(S.type)}' and '${R(I.type)}'.`);l&&(S.type.kind==="value"&&I.type.kind!=="value"?S=new li(I.type,[S]):S.type.kind!=="value"&&I.type.kind==="value"&&(I=new li(S.type,[I])));let E=null;if(y.length===4){if(S.type.kind!=="string"&&I.type.kind!=="string"&&S.type.kind!=="value"&&I.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(E=_.parse(y[3],3,Mi),!E)return null}return new O2(S,I,E)}evaluate(y){const _=this.lhs.evaluate(y),w=this.rhs.evaluate(y);if(l&&this.hasUntypedArgument){const S=Er(_),I=Er(w);if(S.kind!==I.kind||S.kind!=="string"&&S.kind!=="number")throw new xr(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${S.kind}, ${I.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const S=Er(_),I=Er(w);if(S.kind!=="string"||I.kind!=="string")return t(y,_,w)}return this.collator?s(y,_,w,this.collator.evaluate(y)):t(y,_,w)}eachChild(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)}outputDefined(){return!0}}}const pm=ga("==",function(i,t,s){return t===s},vd),xd=ga("!=",function(i,t,s){return t!==s},function(i,t,s,l){return!vd(0,t,s,l)}),wd=ga("<",function(i,t,s){return t<s},function(i,t,s,l){return l.compare(t,s)<0}),fm=ga(">",function(i,t,s){return t>s},function(i,t,s,l){return l.compare(t,s)>0}),mm=ga("<=",function(i,t,s){return t<=s},function(i,t,s,l){return l.compare(t,s)<=0}),bd=ga(">=",function(i,t,s){return t>=s},function(i,t,s,l){return l.compare(t,s)>=0});class Io{constructor(t,s,l){this.type=Mi,this.locale=l,this.caseSensitive=t,this.diacriticSensitive=s}static parse(t,s){if(t.length!==2)return s.error("Expected one argument.");const l=t[1];if(typeof l!="object"||Array.isArray(l))return s.error("Collator options argument must be an object.");const p=s.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,dt);if(!p)return null;const y=s.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,dt);if(!y)return null;let _=null;return l.locale&&(_=s.parse(l.locale,1,St),!_)?null:new Io(p,y,_)}evaluate(t){return new Ju(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class ic{constructor(t,s,l,p,y){this.type=St,this.number=t,this.locale=s,this.currency=l,this.minFractionDigits=p,this.maxFractionDigits=y}static parse(t,s){if(t.length!==3)return s.error("Expected two arguments.");const l=s.parse(t[1],1,Ne);if(!l)return null;const p=t[2];if(typeof p!="object"||Array.isArray(p))return s.error("NumberFormat options argument must be an object.");let y=null;if(p.locale&&(y=s.parse(p.locale,1,St),!y))return null;let _=null;if(p.currency&&(_=s.parse(p.currency,1,St),!_))return null;let w=null;if(p["min-fraction-digits"]&&(w=s.parse(p["min-fraction-digits"],1,Ne),!w))return null;let S=null;return p["max-fraction-digits"]&&(S=s.parse(p["max-fraction-digits"],1,Ne),!S)?null:new ic(l,y,_,w,S)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Tl{constructor(t){this.type=Gi,this.sections=t}static parse(t,s){if(t.length<2)return s.error("Expected at least one argument.");const l=t[1];if(!Array.isArray(l)&&typeof l=="object")return s.error("First argument must be an image or text section.");const p=[];let y=!1;for(let _=1;_<=t.length-1;++_){const w=t[_];if(y&&typeof w=="object"&&!Array.isArray(w)){y=!1;let S=null;if(w["font-scale"]&&(S=s.parse(w["font-scale"],1,Ne),!S))return null;let I=null;if(w["text-font"]&&(I=s.parse(w["text-font"],1,B(St)),!I))return null;let E=null;if(w["text-color"]&&(E=s.parse(w["text-color"],1,fn),!E))return null;const M=p[p.length-1];M.scale=S,M.font=I,M.textColor=E}else{const S=s.parse(t[_],1,_t);if(!S)return null;const I=S.type.kind;if(I!=="string"&&I!=="value"&&I!=="null"&&I!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,p.push({content:S,scale:null,font:null,textColor:null})}}return new Tl(p)}evaluate(t){return new Cn(this.sections.map(s=>{const l=s.content.evaluate(t);return Er(l)===Ai?new Qu("",l,null,null,null):new Qu(So(l),null,s.scale?s.scale.evaluate(t):null,s.font?s.font.evaluate(t).join(","):null,s.textColor?s.textColor.evaluate(t):null)}))}eachChild(t){for(const s of this.sections)t(s.content),s.scale&&t(s.scale),s.font&&t(s.font),s.textColor&&t(s.textColor)}outputDefined(){return!1}}class sc{constructor(t){this.type=Ai,this.input=t}static parse(t,s){if(t.length!==2)return s.error("Expected two arguments.");const l=s.parse(t[1],1,St);return l?new sc(l):s.error("No image name provided.")}evaluate(t){const s=this.input.evaluate(t),l=An.fromString(s);return l&&t.availableImages&&(l.available=t.availableImages.indexOf(s)>-1),l}eachChild(t){t(this.input)}outputDefined(){return!1}}class ac{constructor(t){this.type=Ne,this.input=t}static parse(t,s){if(t.length!==2)return s.error(`Expected 1 argument, but found ${t.length-1} instead.`);const l=s.parse(t[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${R(l.type)} instead.`):new ac(l):null}evaluate(t){const s=this.input.evaluate(t);if(typeof s=="string")return[...s].length;if(Array.isArray(s))return s.length;throw new xr(`Expected value to be of type string or array, but found ${R(Er(s))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const zi=8192;function gm(i,t){const s=(180+i[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,p=Math.pow(2,t.z);return[Math.round(s*p*zi),Math.round(l*p*zi)]}function oc(i,t){const s=Math.pow(2,t.z);return[(p=(i[0]/zi+t.x)/s,360*p-180),(l=(i[1]/zi+t.y)/s,360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90)];var l,p}function Ds(i,t){i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]),i[3]=Math.max(i[3],t[1])}function ds(i,t){return!(i[0]<=t[0]||i[2]>=t[2]||i[1]<=t[1]||i[3]>=t[3])}function jt(i,t,s){const l=i[0]-t[0],p=i[1]-t[1],y=i[0]-s[0],_=i[1]-s[1];return l*_-y*p==0&&l*y<=0&&p*_<=0}function Il(i,t,s,l){return(p=[l[0]-s[0],l[1]-s[1]])[0]*(y=[t[0]-i[0],t[1]-i[1]])[1]-p[1]*y[0]!=0&&!(!kd(i,t,s,l)||!kd(s,l,i,t));var p,y}function ym(i,t,s){for(const l of s)for(let p=0;p<l.length-1;++p)if(Il(i,t,l[p],l[p+1]))return!0;return!1}function ya(i,t,s=!1){let l=!1;for(const w of t)for(let S=0;S<w.length-1;S++){if(jt(i,w[S],w[S+1]))return s;(y=w[S])[1]>(p=i)[1]!=(_=w[S+1])[1]>p[1]&&p[0]<(_[0]-y[0])*(p[1]-y[1])/(_[1]-y[1])+y[0]&&(l=!l)}var p,y,_;return l}function _m(i,t){for(const s of t)if(ya(i,s))return!0;return!1}function Sd(i,t){for(const s of i)if(!ya(s,t))return!1;for(let s=0;s<i.length-1;++s)if(ym(i[s],i[s+1],t))return!1;return!0}function vm(i,t){for(const s of t)if(Sd(i,s))return!0;return!1}function kd(i,t,s,l){const p=l[0]-s[0],y=l[1]-s[1],_=(i[0]-s[0])*y-p*(i[1]-s[1]),w=(t[0]-s[0])*y-p*(t[1]-s[1]);return _>0&&w<0||_<0&&w>0}function lc(i,t,s){const l=[];for(let p=0;p<i.length;p++){const y=[];for(let _=0;_<i[p].length;_++){const w=gm(i[p][_],s);Ds(t,w),y.push(w)}l.push(y)}return l}function Td(i,t,s){const l=[];for(let p=0;p<i.length;p++){const y=lc(i[p],t,s);l.push(y)}return l}function Id(i,t,s,l){if(i[0]<s[0]||i[0]>s[2]){const p=.5*l;let y=i[0]-s[0]>p?-l:s[0]-i[0]>p?l:0;y===0&&(y=i[0]-s[2]>p?-l:s[2]-i[0]>p?l:0),i[0]+=y}Ds(t,i)}function Ed(i,t,s,l){const p=Math.pow(2,l.z)*zi,y=[l.x*zi,l.y*zi],_=[];for(const w of i)for(const S of w){const I=[S.x+y[0],S.y+y[1]];Id(I,t,s,p),_.push(I)}return _}function Pd(i,t,s,l){const p=Math.pow(2,l.z)*zi,y=[l.x*zi,l.y*zi],_=[];for(const S of i){const I=[];for(const E of S){const M=[E.x+y[0],E.y+y[1]];Ds(t,M),I.push(M)}_.push(I)}if(t[2]-t[0]<=p/2){(w=t)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const S of _)for(const I of S)Id(I,t,s,p)}var w;return _}class Ls{constructor(t,s){this.type=dt,this.geojson=t,this.geometries=s}static parse(t,s){if(t.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ms(t[1])){const l=t[1];if(l.type==="FeatureCollection"){const p=[];for(const y of l.features){const{type:_,coordinates:w}=y.geometry;_==="Polygon"&&p.push(w),_==="MultiPolygon"&&p.push(...w)}if(p.length)return new Ls(l,{type:"MultiPolygon",coordinates:p})}else if(l.type==="Feature"){const p=l.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Ls(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new Ls(l,l)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(s,l){const p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],_=s.canonicalID();if(l.type==="Polygon"){const w=lc(l.coordinates,y,_),S=Ed(s.geometry(),p,y,_);if(!ds(p,y))return!1;for(const I of S)if(!ya(I,w))return!1}if(l.type==="MultiPolygon"){const w=Td(l.coordinates,y,_),S=Ed(s.geometry(),p,y,_);if(!ds(p,y))return!1;for(const I of S)if(!_m(I,w))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(s,l){const p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],_=s.canonicalID();if(l.type==="Polygon"){const w=lc(l.coordinates,y,_),S=Pd(s.geometry(),p,y,_);if(!ds(p,y))return!1;for(const I of S)if(!Sd(I,w))return!1}if(l.type==="MultiPolygon"){const w=Td(l.coordinates,y,_),S=Pd(s.geometry(),p,y,_);if(!ds(p,y))return!1;for(const I of S)if(!vm(I,w))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Cd=class{constructor(i=[],t=(s,l)=>s<l?-1:s>l?1:0){if(this.data=i,this.length=this.data.length,this.compare=t,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:t,compare:s}=this,l=t[i];for(;i>0;){const p=i-1>>1,y=t[p];if(s(l,y)>=0)break;t[i]=y,i=p}t[i]=l}_down(i){const{data:t,compare:s}=this,l=this.length>>1,p=t[i];for(;i<l;){let y=1+(i<<1);const _=y+1;if(_<this.length&&s(t[_],t[y])<0&&(y=_),s(t[y],p)>=0)break;t[i]=t[y],i=y}t[i]=p}};function xm(i,t,s,l,p){Md(i,t,s,l||i.length-1,p||wm)}function Md(i,t,s,l,p){for(;l>s;){if(l-s>600){var y=l-s+1,_=t-s+1,w=Math.log(y),S=.5*Math.exp(2*w/3),I=.5*Math.sqrt(w*S*(y-S)/y)*(_-y/2<0?-1:1);Md(i,t,Math.max(s,Math.floor(t-_*S/y+I)),Math.min(l,Math.floor(t+(y-_)*S/y+I)),p)}var E=i[t],M=s,D=l;for(Eo(i,s,t),p(i[l],E)>0&&Eo(i,s,l);M<D;){for(Eo(i,M,D),M++,D--;p(i[M],E)<0;)M++;for(;p(i[D],E)>0;)D--}p(i[s],E)===0?Eo(i,s,D):Eo(i,++D,l),D<=t&&(s=D+1),t<=D&&(l=D-1)}}function Eo(i,t,s){var l=i[t];i[t]=i[s],i[s]=l}function wm(i,t){return i<t?-1:i>t?1:0}function El(i,t){if(i.length<=1)return[i];const s=[];let l,p;for(const y of i){const _=Sm(y);_!==0&&(y.area=Math.abs(_),p===void 0&&(p=_<0),p===_<0?(l&&s.push(l),l=[y]):l.push(y))}if(l&&s.push(l),t>1)for(let y=0;y<s.length;y++)s[y].length<=t||(xm(s[y],t,1,s[y].length-1,bm),s[y]=s[y].slice(0,t));return s}function bm(i,t){return t.area-i.area}function Sm(i){let t=0;for(let s,l,p=0,y=i.length,_=y-1;p<y;_=p++)s=i[p],l=i[_],t+=(l.x-s.x)*(s.y+l.y);return t}const Ad=1/298.257223563,zd=Ad*(2-Ad),Dd=Math.PI/180;class uc{constructor(t){const s=6378.137*Dd*1e3,l=Math.cos(t*Dd),p=1/(1-zd*(1-l*l)),y=Math.sqrt(p);this.kx=s*y*l,this.ky=s*y*p*(1-zd)}distance(t,s){const l=this.wrap(t[0]-s[0])*this.kx,p=(t[1]-s[1])*this.ky;return Math.sqrt(l*l+p*p)}pointOnLine(t,s){let l,p,y,_,w=1/0;for(let S=0;S<t.length-1;S++){let I=t[S][0],E=t[S][1],M=this.wrap(t[S+1][0]-I)*this.kx,D=(t[S+1][1]-E)*this.ky,F=0;M===0&&D===0||(F=(this.wrap(s[0]-I)*this.kx*M+(s[1]-E)*this.ky*D)/(M*M+D*D),F>1?(I=t[S+1][0],E=t[S+1][1]):F>0&&(I+=M/this.kx*F,E+=D/this.ky*F)),M=this.wrap(s[0]-I)*this.kx,D=(s[1]-E)*this.ky;const V=M*M+D*D;V<w&&(w=V,l=I,p=E,y=S,_=F)}return{point:[l,p],index:y,t:Math.max(0,Math.min(1,_))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Ld(i,t){return t[0]-i[0]}function Pl(i){return i[1]-i[0]+1}function Hi(i,t){return i[1]>=i[0]&&i[1]<t}function cc(i,t){if(i[0]>i[1])return[null,null];const s=Pl(i);if(t){if(s===2)return[i,null];const p=Math.floor(s/2);return[[i[0],i[0]+p],[i[0]+p,i[1]]]}if(s===1)return[i,null];const l=Math.floor(s/2)-1;return[[i[0],i[0]+l],[i[0]+l+1,i[1]]]}function hc(i,t){if(!Hi(t,i.length))return[1/0,1/0,-1/0,-1/0];const s=[1/0,1/0,-1/0,-1/0];for(let l=t[0];l<=t[1];++l)Ds(s,i[l]);return s}function dc(i){const t=[1/0,1/0,-1/0,-1/0];for(const s of i)for(const l of s)Ds(t,l);return t}function Cl(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function pc(i,t,s){if(!Cl(i)||!Cl(t))return NaN;let l=0,p=0;return i[2]<t[0]&&(l=t[0]-i[2]),i[0]>t[2]&&(l=i[0]-t[2]),i[1]>t[3]&&(p=i[1]-t[3]),i[3]<t[1]&&(p=t[1]-i[3]),s.distance([0,0],[l,p])}function Rs(i,t,s){const l=s.pointOnLine(t,i);return s.distance(i,l.point)}function fc(i,t,s,l,p){const y=Math.min(Rs(i,[s,l],p),Rs(t,[s,l],p)),_=Math.min(Rs(s,[i,t],p),Rs(l,[i,t],p));return Math.min(y,_)}function km(i,t,s,l,p){if(!Hi(t,i.length)||!Hi(l,s.length))return 1/0;let y=1/0;for(let _=t[0];_<t[1];++_){const w=i[_],S=i[_+1];for(let I=l[0];I<l[1];++I){const E=s[I],M=s[I+1];if(Il(w,S,E,M))return 0;y=Math.min(y,fc(w,S,E,M,p))}}return y}function fr(i,t,s,l,p){if(!Hi(t,i.length)||!Hi(l,s.length))return NaN;let y=1/0;for(let _=t[0];_<=t[1];++_)for(let w=l[0];w<=l[1];++w)if(y=Math.min(y,p.distance(i[_],s[w])),y===0)return y;return y}function Tm(i,t,s){if(ya(i,t,!0))return 0;let l=1/0;for(const p of t){const y=p[0],_=p[p.length-1];if(y!==_&&(l=Math.min(l,Rs(i,[_,y],s)),l===0))return l;const w=s.pointOnLine(p,i);if(l=Math.min(l,s.distance(i,w.point)),l===0)return l}return l}function It(i,t,s,l){if(!Hi(t,i.length))return NaN;for(let y=t[0];y<=t[1];++y)if(ya(i[y],s,!0))return 0;let p=1/0;for(let y=t[0];y<t[1];++y){const _=i[y],w=i[y+1];for(const S of s)for(let I=0,E=S.length,M=E-1;I<E;M=I++){const D=S[M],F=S[I];if(Il(_,w,D,F))return 0;p=Math.min(p,fc(_,w,D,F,l))}}return p}function Ml(i,t){for(const s of i)for(const l of s)if(ya(l,t,!0))return!0;return!1}function Yt(i,t,s,l=1/0){const p=dc(i),y=dc(t);if(l!==1/0&&pc(p,y,s)>=l)return l;if(ds(p,y)){if(Ml(i,t))return 0}else if(Ml(t,i))return 0;let _=1/0;for(const w of i)for(let S=0,I=w.length,E=I-1;S<I;E=S++){const M=w[E],D=w[S];for(const F of t)for(let V=0,$=F.length,X=$-1;V<$;X=V++){const te=F[X],ge=F[V];if(Il(M,D,te,ge))return 0;_=Math.min(_,fc(M,D,te,ge,s))}}return _}function Zt(i,t,s,l,p,y){if(!y)return;const _=pc(hc(l,y),p,s);_<t&&i.push([_,y,[0,0]])}function Bs(i,t,s,l,p,y,_){if(!y||!_)return;const w=pc(hc(l,y),hc(p,_),s);w<t&&i.push([w,y,_])}function Po(i,t,s,l,p=1/0){let y=Math.min(l.distance(i[0],s[0][0]),p);if(y===0)return y;const _=new Cd([[0,[0,i.length-1],[0,0]]],Ld),w=dc(s);for(;_.length>0;){const S=_.pop();if(S[0]>=y)continue;const I=S[1],E=t?50:100;if(Pl(I)<=E){if(!Hi(I,i.length))return NaN;if(t){const M=It(i,I,s,l);if(isNaN(M)||M===0)return M;y=Math.min(y,M)}else for(let M=I[0];M<=I[1];++M){const D=Tm(i[M],s,l);if(y=Math.min(y,D),y===0)return 0}}else{const M=cc(I,t);Zt(_,y,l,i,w,M[0]),Zt(_,y,l,i,w,M[1])}}return y}function Co(i,t,s,l,p,y=1/0){let _=Math.min(y,p.distance(i[0],s[0]));if(_===0)return _;const w=new Cd([[0,[0,i.length-1],[0,s.length-1]]],Ld);for(;w.length>0;){const S=w.pop();if(S[0]>=_)continue;const I=S[1],E=S[2],M=t?50:100,D=l?50:100;if(Pl(I)<=M&&Pl(E)<=D){if(!Hi(I,i.length)&&Hi(E,s.length))return NaN;let F;if(t&&l)F=km(i,I,s,E,p),_=Math.min(_,F);else if(t&&!l){const V=i.slice(I[0],I[1]+1);for(let $=E[0];$<=E[1];++$)if(F=Rs(s[$],V,p),_=Math.min(_,F),_===0)return _}else if(!t&&l){const V=s.slice(E[0],E[1]+1);for(let $=I[0];$<=I[1];++$)if(F=Rs(i[$],V,p),_=Math.min(_,F),_===0)return _}else F=fr(i,I,s,E,p),_=Math.min(_,F)}else{const F=cc(I,t),V=cc(E,l);Bs(w,_,p,i,s,F[0],V[0]),Bs(w,_,p,i,s,F[0],V[1]),Bs(w,_,p,i,s,F[1],V[0]),Bs(w,_,p,i,s,F[1],V[1])}}return _}function mc(i){return i.type==="MultiPolygon"?i.coordinates.map(t=>({type:"Polygon",coordinates:t})):i.type==="MultiLineString"?i.coordinates.map(t=>({type:"LineString",coordinates:t})):i.type==="MultiPoint"?i.coordinates.map(t=>({type:"Point",coordinates:t})):[i]}class Fs{constructor(t,s){this.type=Ne,this.geojson=t,this.geometries=s}static parse(t,s){if(t.length!==2)return s.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ms(t[1])){const l=t[1];if(l.type==="FeatureCollection")return new Fs(l,l.features.map(p=>mc(p.geometry)).flat());if(l.type==="Feature")return new Fs(l,mc(l.geometry));if("type"in l&&"coordinates"in l)return new Fs(l,mc(l))}return s.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(s,l){const p=s.geometry(),y=p.flat().map(S=>oc([S.x,S.y],s.canonical));if(p.length===0)return NaN;const _=new uc(y[0][1]);let w=1/0;for(const S of l){switch(S.type){case"Point":w=Math.min(w,Co(y,!1,[S.coordinates],!1,_,w));break;case"LineString":w=Math.min(w,Co(y,!1,S.coordinates,!0,_,w));break;case"Polygon":w=Math.min(w,Po(y,!1,S.coordinates,_,w))}if(w===0)return w}return w}(t,this.geometries);if(t.geometryType()==="LineString")return function(s,l){const p=s.geometry(),y=p.flat().map(S=>oc([S.x,S.y],s.canonical));if(p.length===0)return NaN;const _=new uc(y[0][1]);let w=1/0;for(const S of l){switch(S.type){case"Point":w=Math.min(w,Co(y,!0,[S.coordinates],!1,_,w));break;case"LineString":w=Math.min(w,Co(y,!0,S.coordinates,!0,_,w));break;case"Polygon":w=Math.min(w,Po(y,!0,S.coordinates,_,w))}if(w===0)return w}return w}(t,this.geometries);if(t.geometryType()==="Polygon")return function(s,l){const p=s.geometry();if(p.length===0||p[0].length===0)return NaN;const y=El(p,0).map(S=>S.map(I=>I.map(E=>oc([E.x,E.y],s.canonical)))),_=new uc(y[0][0][0][1]);let w=1/0;for(const S of l)for(const I of y){switch(S.type){case"Point":w=Math.min(w,Po([S.coordinates],!1,I,_,w));break;case"LineString":w=Math.min(w,Po(S.coordinates,!0,I,_,w));break;case"Polygon":w=Math.min(w,Yt(I,S.coordinates,_,w))}if(w===0)return w}return w}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const _a={"==":pm,"!=":xd,">":fm,"<":wd,">=":bd,"<=":mm,array:li,at:tc,boolean:li,case:xl,coalesce:Sl,collator:Io,format:Tl,image:sc,in:rc,"index-of":fa,interpolate:gn,"interpolate-hcl":gn,"interpolate-lab":gn,length:ac,let:hs,literal:oi,match:nc,number:li,"number-format":ic,object:li,slice:ko,step:ma,string:li,"to-boolean":ui,"to-color":ui,"to-number":ui,"to-string":ui,var:Ot,within:Ls,distance:Fs};class Zn{constructor(t,s,l,p){this.name=t,this.type=s,this._evaluate=l,this.args=p}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,s){const l=t[0],p=Zn.definitions[l];if(!p)return s.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const y=Array.isArray(p)?p[0]:p.type,_=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,w=_.filter(([I])=>!Array.isArray(I)||I.length===t.length-1);let S=null;for(const[I,E]of w){S=new As(s.registry,Mo,s.path,null,s.scope);const M=[];let D=!1;for(let F=1;F<t.length;F++){const V=t[F],$=Array.isArray(I)?I[F-1]:I.type,X=S.parse(V,1+M.length,$);if(!X){D=!0;break}M.push(X)}if(!D)if(Array.isArray(I)&&I.length!==M.length)S.error(`Expected ${I.length} arguments, but found ${M.length} instead.`);else{for(let F=0;F<M.length;F++){const V=Array.isArray(I)?I[F]:I.type,$=M[F];S.concat(F+1).checkSubtype(V,$.type)}if(S.errors.length===0)return new Zn(l,y,E,M)}}if(w.length===1)s.errors.push(...S.errors);else{const I=(w.length?w:_).map(([M])=>{return D=M,Array.isArray(D)?`(${D.map(R).join(", ")})`:`(${R(D.type)}...)`;var D}).join(" | "),E=[];for(let M=1;M<t.length;M++){const D=s.parse(t[M],1+E.length);if(!D)return null;E.push(R(D.type))}s.error(`Expected arguments of type ${I}, but found (${E.join(", ")}) instead.`)}return null}static register(t,s){Zn.definitions=s;for(const l in s)t[l]=Zn}}function gc(i,[t,s,l,p]){t=t.evaluate(i),s=s.evaluate(i),l=l.evaluate(i);const y=p?p.evaluate(i):1,_=pa(t,s,l,y);if(_)throw new xr(_);return new qt(t/255,s/255,l/255,y,!1)}function yc(i,t){return i in t}function _c(i,t){const s=t[i];return s===void 0?null:s}function Os(i){return{type:i}}function Mo(i){if(i instanceof Ot)return Mo(i.boundExpression);if(i instanceof Zn&&i.name==="error"||i instanceof Io||i instanceof Ls||i instanceof Fs)return!1;const t=i instanceof ui||i instanceof li;let s=!0;return i.eachChild(l=>{s=t?s&&Mo(l):s&&l instanceof oi}),!!s&&Ao(i)&&zo(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Ao(i){if(i instanceof Zn&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Ls||i instanceof Fs)return!1;let t=!0;return i.eachChild(s=>{t&&!Ao(s)&&(t=!1)}),t}function va(i){if(i instanceof Zn&&i.name==="feature-state")return!1;let t=!0;return i.eachChild(s=>{t&&!va(s)&&(t=!1)}),t}function zo(i,t){if(i instanceof Zn&&t.indexOf(i.name)>=0)return!1;let s=!0;return i.eachChild(l=>{s&&!zo(l,t)&&(s=!1)}),s}function Al(i){return{result:"success",value:i}}function xa(i){return{result:"error",value:i}}function wa(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Rd(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function vc(i){return!!i.expression&&i.expression.interpolated}function Rt(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function zl(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function Im(i){return i}function Bd(i,t){const s=t.type==="color",l=i.stops&&typeof i.stops[0][0]=="object",p=l||!(l||i.property!==void 0),y=i.type||(vc(t)?"exponential":"interval");if(s||t.type==="padding"){const E=s?qt.parse:Mn.parse;(i=Pi({},i)).stops&&(i.stops=i.stops.map(M=>[M[0],E(M[1])])),i.default=E(i.default?i.default:t.default)}if(i.colorSpace&&(_=i.colorSpace)!=="rgb"&&_!=="hcl"&&_!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var _;let w,S,I;if(y==="exponential")w=Od;else if(y==="interval")w=Dl;else if(y==="categorical"){w=Fd,S=Object.create(null);for(const E of i.stops)S[E[0]]=E[1];I=typeof i.stops[0][0]}else{if(y!=="identity")throw new Error(`Unknown function type "${y}"`);w=Nd}if(l){const E={},M=[];for(let V=0;V<i.stops.length;V++){const $=i.stops[V],X=$[0].zoom;E[X]===void 0&&(E[X]={zoom:X,type:i.type,property:i.property,default:i.default,stops:[]},M.push(X)),E[X].stops.push([$[0].value,$[1]])}const D=[];for(const V of M)D.push([E[V].zoom,Bd(E[V],t)]);const F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:gn.interpolationFactor.bind(void 0,F),zoomStops:D.map(V=>V[0]),evaluate:({zoom:V},$)=>Od({stops:D,base:i.base},t,V).evaluate(V,$)}}if(p){const E=y==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:gn.interpolationFactor.bind(void 0,E),zoomStops:i.stops.map(M=>M[0]),evaluate:({zoom:M})=>w(i,t,M,S,I)}}return{kind:"source",evaluate(E,M){const D=M&&M.properties?M.properties[i.property]:void 0;return D===void 0?ba(i.default,t.default):w(i,t,D,S,I)}}}function ba(i,t,s){return i!==void 0?i:t!==void 0?t:s!==void 0?s:void 0}function Fd(i,t,s,l,p){return ba(typeof s===p?l[s]:void 0,i.default,t.default)}function Dl(i,t,s){if(Rt(s)!=="number")return ba(i.default,t.default);const l=i.stops.length;if(l===1||s<=i.stops[0][0])return i.stops[0][1];if(s>=i.stops[l-1][0])return i.stops[l-1][1];const p=wl(i.stops.map(y=>y[0]),s);return i.stops[p][1]}function Od(i,t,s){const l=i.base!==void 0?i.base:1;if(Rt(s)!=="number")return ba(i.default,t.default);const p=i.stops.length;if(p===1||s<=i.stops[0][0])return i.stops[0][1];if(s>=i.stops[p-1][0])return i.stops[p-1][1];const y=wl(i.stops.map(E=>E[0]),s),_=function(E,M,D,F){const V=F-D,$=E-D;return V===0?0:M===1?$/V:(Math.pow(M,$)-1)/(Math.pow(M,V)-1)}(s,l,i.stops[y][0],i.stops[y+1][0]),w=i.stops[y][1],S=i.stops[y+1][1],I=mn[t.type]||Im;return typeof w.evaluate=="function"?{evaluate(...E){const M=w.evaluate.apply(void 0,E),D=S.evaluate.apply(void 0,E);if(M!==void 0&&D!==void 0)return I(M,D,_,i.colorSpace)}}:I(w,S,_,i.colorSpace)}function Nd(i,t,s){switch(t.type){case"color":s=qt.parse(s);break;case"formatted":s=Cn.fromString(s.toString());break;case"resolvedImage":s=An.fromString(s.toString());break;case"padding":s=Mn.parse(s);break;default:Rt(s)===t.type||t.type==="enum"&&t.values[s]||(s=void 0)}return ba(s,i.default,t.default)}Zn.register(_a,{error:[{kind:"error"},[St],(i,[t])=>{throw new xr(t.evaluate(i))}],typeof:[St,[_t],(i,[t])=>R(Er(t.evaluate(i)))],"to-rgba":[B(Ne,4),[fn],(i,[t])=>{const[s,l,p,y]=t.evaluate(i).rgb;return[255*s,255*l,255*p,y]}],rgb:[fn,[Ne,Ne,Ne],gc],rgba:[fn,[Ne,Ne,Ne,Ne],gc],has:{type:dt,overloads:[[[St],(i,[t])=>yc(t.evaluate(i),i.properties())],[[St,ai],(i,[t,s])=>yc(t.evaluate(i),s.evaluate(i))]]},get:{type:_t,overloads:[[[St],(i,[t])=>_c(t.evaluate(i),i.properties())],[[St,ai],(i,[t,s])=>_c(t.evaluate(i),s.evaluate(i))]]},"feature-state":[_t,[St],(i,[t])=>_c(t.evaluate(i),i.featureState||{})],properties:[ai,[],i=>i.properties()],"geometry-type":[St,[],i=>i.geometryType()],id:[_t,[],i=>i.id()],zoom:[Ne,[],i=>i.globals.zoom],"heatmap-density":[Ne,[],i=>i.globals.heatmapDensity||0],"line-progress":[Ne,[],i=>i.globals.lineProgress||0],accumulated:[_t,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Ne,Os(Ne),(i,t)=>{let s=0;for(const l of t)s+=l.evaluate(i);return s}],"*":[Ne,Os(Ne),(i,t)=>{let s=1;for(const l of t)s*=l.evaluate(i);return s}],"-":{type:Ne,overloads:[[[Ne,Ne],(i,[t,s])=>t.evaluate(i)-s.evaluate(i)],[[Ne],(i,[t])=>-t.evaluate(i)]]},"/":[Ne,[Ne,Ne],(i,[t,s])=>t.evaluate(i)/s.evaluate(i)],"%":[Ne,[Ne,Ne],(i,[t,s])=>t.evaluate(i)%s.evaluate(i)],ln2:[Ne,[],()=>Math.LN2],pi:[Ne,[],()=>Math.PI],e:[Ne,[],()=>Math.E],"^":[Ne,[Ne,Ne],(i,[t,s])=>Math.pow(t.evaluate(i),s.evaluate(i))],sqrt:[Ne,[Ne],(i,[t])=>Math.sqrt(t.evaluate(i))],log10:[Ne,[Ne],(i,[t])=>Math.log(t.evaluate(i))/Math.LN10],ln:[Ne,[Ne],(i,[t])=>Math.log(t.evaluate(i))],log2:[Ne,[Ne],(i,[t])=>Math.log(t.evaluate(i))/Math.LN2],sin:[Ne,[Ne],(i,[t])=>Math.sin(t.evaluate(i))],cos:[Ne,[Ne],(i,[t])=>Math.cos(t.evaluate(i))],tan:[Ne,[Ne],(i,[t])=>Math.tan(t.evaluate(i))],asin:[Ne,[Ne],(i,[t])=>Math.asin(t.evaluate(i))],acos:[Ne,[Ne],(i,[t])=>Math.acos(t.evaluate(i))],atan:[Ne,[Ne],(i,[t])=>Math.atan(t.evaluate(i))],min:[Ne,Os(Ne),(i,t)=>Math.min(...t.map(s=>s.evaluate(i)))],max:[Ne,Os(Ne),(i,t)=>Math.max(...t.map(s=>s.evaluate(i)))],abs:[Ne,[Ne],(i,[t])=>Math.abs(t.evaluate(i))],round:[Ne,[Ne],(i,[t])=>{const s=t.evaluate(i);return s<0?-Math.round(-s):Math.round(s)}],floor:[Ne,[Ne],(i,[t])=>Math.floor(t.evaluate(i))],ceil:[Ne,[Ne],(i,[t])=>Math.ceil(t.evaluate(i))],"filter-==":[dt,[St,_t],(i,[t,s])=>i.properties()[t.value]===s.value],"filter-id-==":[dt,[_t],(i,[t])=>i.id()===t.value],"filter-type-==":[dt,[St],(i,[t])=>i.geometryType()===t.value],"filter-<":[dt,[St,_t],(i,[t,s])=>{const l=i.properties()[t.value],p=s.value;return typeof l==typeof p&&l<p}],"filter-id-<":[dt,[_t],(i,[t])=>{const s=i.id(),l=t.value;return typeof s==typeof l&&s<l}],"filter->":[dt,[St,_t],(i,[t,s])=>{const l=i.properties()[t.value],p=s.value;return typeof l==typeof p&&l>p}],"filter-id->":[dt,[_t],(i,[t])=>{const s=i.id(),l=t.value;return typeof s==typeof l&&s>l}],"filter-<=":[dt,[St,_t],(i,[t,s])=>{const l=i.properties()[t.value],p=s.value;return typeof l==typeof p&&l<=p}],"filter-id-<=":[dt,[_t],(i,[t])=>{const s=i.id(),l=t.value;return typeof s==typeof l&&s<=l}],"filter->=":[dt,[St,_t],(i,[t,s])=>{const l=i.properties()[t.value],p=s.value;return typeof l==typeof p&&l>=p}],"filter-id->=":[dt,[_t],(i,[t])=>{const s=i.id(),l=t.value;return typeof s==typeof l&&s>=l}],"filter-has":[dt,[_t],(i,[t])=>t.value in i.properties()],"filter-has-id":[dt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[dt,[B(St)],(i,[t])=>t.value.indexOf(i.geometryType())>=0],"filter-id-in":[dt,[B(_t)],(i,[t])=>t.value.indexOf(i.id())>=0],"filter-in-small":[dt,[St,B(_t)],(i,[t,s])=>s.value.indexOf(i.properties()[t.value])>=0],"filter-in-large":[dt,[St,B(_t)],(i,[t,s])=>function(l,p,y,_){for(;y<=_;){const w=y+_>>1;if(p[w]===l)return!0;p[w]>l?_=w-1:y=w+1}return!1}(i.properties()[t.value],s.value,0,s.value.length-1)],all:{type:dt,overloads:[[[dt,dt],(i,[t,s])=>t.evaluate(i)&&s.evaluate(i)],[Os(dt),(i,t)=>{for(const s of t)if(!s.evaluate(i))return!1;return!0}]]},any:{type:dt,overloads:[[[dt,dt],(i,[t,s])=>t.evaluate(i)||s.evaluate(i)],[Os(dt),(i,t)=>{for(const s of t)if(s.evaluate(i))return!0;return!1}]]},"!":[dt,[dt],(i,[t])=>!t.evaluate(i)],"is-supported-script":[dt,[St],(i,[t])=>{const s=i.globals&&i.globals.isSupportedScript;return!s||s(t.evaluate(i))}],upcase:[St,[St],(i,[t])=>t.evaluate(i).toUpperCase()],downcase:[St,[St],(i,[t])=>t.evaluate(i).toLowerCase()],concat:[St,Os(_t),(i,t)=>t.map(s=>So(s.evaluate(i))).join("")],"resolved-locale":[St,[Mi],(i,[t])=>t.evaluate(i).resolvedLocale()]});class Ll{constructor(t,s){var l;this.expression=t,this._warningHistory={},this._evaluator=new vl,this._defaultValue=s?(l=s).type==="color"&&zl(l.default)?new qt(0,0,0,0):l.type==="color"?qt.parse(l.default)||null:l.type==="padding"?Mn.parse(l.default)||null:l.type==="variableAnchorOffsetCollection"?qn.parse(l.default)||null:l.default===void 0?null:l.default:null,this._enumValues=s&&s.type==="enum"?s.values:null}evaluateWithoutErrorHandling(t,s,l,p,y,_){return this._evaluator.globals=t,this._evaluator.feature=s,this._evaluator.featureState=l,this._evaluator.canonical=p,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=_,this.expression.evaluate(this._evaluator)}evaluate(t,s,l,p,y,_){this._evaluator.globals=t,this._evaluator.feature=s||null,this._evaluator.featureState=l||null,this._evaluator.canonical=p,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=_||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new xr(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function Rl(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in _a}function Sa(i,t){const s=new As(_a,Mo,[],t?function(p){const y={color:fn,string:St,number:Ne,enum:St,boolean:dt,formatted:Gi,padding:cs,resolvedImage:Ai,variableAnchorOffsetCollection:Q};return p.type==="array"?B(y[p.value]||_t,p.length):y[p.type]}(t):void 0),l=s.parse(i,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return l?Al(new Ll(l,t)):xa(s.errors)}class ka{constructor(t,s){this.kind=t,this._styleExpression=s,this.isStateDependent=t!=="constant"&&!va(s.expression)}evaluateWithoutErrorHandling(t,s,l,p,y,_){return this._styleExpression.evaluateWithoutErrorHandling(t,s,l,p,y,_)}evaluate(t,s,l,p,y,_){return this._styleExpression.evaluate(t,s,l,p,y,_)}}class Ta{constructor(t,s,l,p){this.kind=t,this.zoomStops=l,this._styleExpression=s,this.isStateDependent=t!=="camera"&&!va(s.expression),this.interpolationType=p}evaluateWithoutErrorHandling(t,s,l,p,y,_){return this._styleExpression.evaluateWithoutErrorHandling(t,s,l,p,y,_)}evaluate(t,s,l,p,y,_){return this._styleExpression.evaluate(t,s,l,p,y,_)}interpolationFactor(t,s,l){return this.interpolationType?gn.interpolationFactor(this.interpolationType,t,s,l):0}}function xc(i,t){const s=Sa(i,t);if(s.result==="error")return s;const l=s.value.expression,p=Ao(l);if(!p&&!wa(t))return xa([new rn("","data expressions not supported")]);const y=zo(l,["zoom"]);if(!y&&!Rd(t))return xa([new rn("","zoom expressions not supported")]);const _=Do(l);return _||y?_ instanceof rn?xa([_]):_ instanceof gn&&!vc(t)?xa([new rn("",'"interpolate" expressions cannot be used with this property')]):Al(_?new Ta(p?"camera":"composite",s.value,_.labels,_ instanceof gn?_.interpolation:void 0):new ka(p?"constant":"source",s.value)):xa([new rn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ia{constructor(t,s){this._parameters=t,this._specification=s,Pi(this,Bd(this._parameters,this._specification))}static deserialize(t){return new Ia(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Do(i){let t=null;if(i instanceof hs)t=Do(i.result);else if(i instanceof Sl){for(const s of i.args)if(t=Do(s),t)break}else(i instanceof ma||i instanceof gn)&&i.input instanceof Zn&&i.input.name==="zoom"&&(t=i);return t instanceof rn||i.eachChild(s=>{const l=Do(s);l instanceof rn?t=l:!t&&l?t=new rn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&l&&t!==l&&(t=new rn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Bl(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const t of i.slice(1))if(!Bl(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const Fl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function wc(i){if(i==null)return{filter:()=>!0,needGeometry:!1};Bl(i)||(i=Ol(i));const t=Sa(i,Fl);if(t.result==="error")throw new Error(t.value.map(s=>`${s.key}: ${s.message}`).join(", "));return{filter:(s,l,p)=>t.value.evaluate(s,l,{},p),needGeometry:jd(i)}}function Em(i,t){return i<t?-1:i>t?1:0}function jd(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let t=1;t<i.length;t++)if(jd(i[t]))return!0;return!1}function Ol(i){if(!i)return!0;const t=i[0];return i.length<=1?t!=="any":t==="=="?bc(i[1],i[2],"=="):t==="!="?Gr(bc(i[1],i[2],"==")):t==="<"||t===">"||t==="<="||t===">="?bc(i[1],i[2],t):t==="any"?(s=i.slice(1),["any"].concat(s.map(Ol))):t==="all"?["all"].concat(i.slice(1).map(Ol)):t==="none"?["all"].concat(i.slice(1).map(Ol).map(Gr)):t==="in"?Lo(i[1],i.slice(2)):t==="!in"?Gr(Lo(i[1],i.slice(2))):t==="has"?Ro(i[1]):t!=="!has"||Gr(Ro(i[1]));var s}function bc(i,t,s){switch(i){case"$type":return[`filter-type-${s}`,t];case"$id":return[`filter-id-${s}`,t];default:return[`filter-${s}`,i,t]}}function Lo(i,t){if(t.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(s=>typeof s!=typeof t[0])?["filter-in-large",i,["literal",t.sort(Em)]]:["filter-in-small",i,["literal",t]]}}function Ro(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Gr(i){return["!",i]}function Ns(i){const t=typeof i;if(t==="number"||t==="boolean"||t==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let p="[";for(const y of i)p+=`${Ns(y)},`;return`${p}]`}const s=Object.keys(i).sort();let l="{";for(let p=0;p<s.length;p++)l+=`${JSON.stringify(s[p])}:${Ns(i[s[p]])},`;return`${l}}`}function Vd(i){let t="";for(const s of Cs)t+=`/${Ns(i[s])}`;return t}function Ud(i){const t=i.value;return t?[new Le(i.key,t,"constants have been deprecated as of v8")]:[]}function mr(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function ci(i){if(Array.isArray(i))return i.map(ci);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const t={};for(const s in i)t[s]=ci(i[s]);return t}return mr(i)}function zn(i){const t=i.key,s=i.value,l=i.valueSpec||{},p=i.objectElementValidators||{},y=i.style,_=i.styleSpec,w=i.validateSpec;let S=[];const I=Rt(s);if(I!=="object")return[new Le(t,s,`object expected, ${I} found`)];for(const E in s){const M=E.split(".")[0],D=l[M]||l["*"];let F;if(p[M])F=p[M];else if(l[M])F=w;else if(p["*"])F=p["*"];else{if(!l["*"]){S.push(new Le(t,s[E],`unknown property "${E}"`));continue}F=w}S=S.concat(F({key:(t&&`${t}.`)+E,value:s[E],valueSpec:D,style:y,styleSpec:_,object:s,objectKey:E,validateSpec:w},s))}for(const E in l)p[E]||l[E].required&&l[E].default===void 0&&s[E]===void 0&&S.push(new Le(t,s,`missing required property "${E}"`));return S}function Bo(i){const t=i.value,s=i.valueSpec,l=i.style,p=i.styleSpec,y=i.key,_=i.arrayElementValidator||i.validateSpec;if(Rt(t)!=="array")return[new Le(y,t,`array expected, ${Rt(t)} found`)];if(s.length&&t.length!==s.length)return[new Le(y,t,`array length ${s.length} expected, length ${t.length} found`)];if(s["min-length"]&&t.length<s["min-length"])return[new Le(y,t,`array length at least ${s["min-length"]} expected, length ${t.length} found`)];let w={type:s.value,values:s.values};p.$version<7&&(w.function=s.function),Rt(s.value)==="object"&&(w=s.value);let S=[];for(let I=0;I<t.length;I++)S=S.concat(_({array:t,arrayIndex:I,value:t[I],valueSpec:w,validateSpec:i.validateSpec,style:l,styleSpec:p,key:`${y}[${I}]`}));return S}function Sc(i){const t=i.key,s=i.value,l=i.valueSpec;let p=Rt(s);return p==="number"&&s!=s&&(p="NaN"),p!=="number"?[new Le(t,s,`number expected, ${p} found`)]:"minimum"in l&&s<l.minimum?[new Le(t,s,`${s} is less than the minimum value ${l.minimum}`)]:"maximum"in l&&s>l.maximum?[new Le(t,s,`${s} is greater than the maximum value ${l.maximum}`)]:[]}function Nl(i){const t=i.valueSpec,s=mr(i.value.type);let l,p,y,_={};const w=s!=="categorical"&&i.value.property===void 0,S=!w,I=Rt(i.value.stops)==="array"&&Rt(i.value.stops[0])==="array"&&Rt(i.value.stops[0][0])==="object",E=zn({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(F){if(s==="identity")return[new Le(F.key,F.value,'identity function may not have a "stops" property')];let V=[];const $=F.value;return V=V.concat(Bo({key:F.key,value:$,valueSpec:F.valueSpec,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,arrayElementValidator:M})),Rt($)==="array"&&$.length===0&&V.push(new Le(F.key,$,"array must have at least one stop")),V},default:function(F){return F.validateSpec({key:F.key,value:F.value,valueSpec:t,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec})}}});return s==="identity"&&w&&E.push(new Le(i.key,i.value,'missing required property "property"')),s==="identity"||i.value.stops||E.push(new Le(i.key,i.value,'missing required property "stops"')),s==="exponential"&&i.valueSpec.expression&&!vc(i.valueSpec)&&E.push(new Le(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(S&&!wa(i.valueSpec)?E.push(new Le(i.key,i.value,"property functions not supported")):w&&!Rd(i.valueSpec)&&E.push(new Le(i.key,i.value,"zoom functions not supported"))),s!=="categorical"&&!I||i.value.property!==void 0||E.push(new Le(i.key,i.value,'"property" property is required')),E;function M(F){let V=[];const $=F.value,X=F.key;if(Rt($)!=="array")return[new Le(X,$,`array expected, ${Rt($)} found`)];if($.length!==2)return[new Le(X,$,`array length 2 expected, length ${$.length} found`)];if(I){if(Rt($[0])!=="object")return[new Le(X,$,`object expected, ${Rt($[0])} found`)];if($[0].zoom===void 0)return[new Le(X,$,"object stop key must have zoom")];if($[0].value===void 0)return[new Le(X,$,"object stop key must have value")];if(y&&y>mr($[0].zoom))return[new Le(X,$[0].zoom,"stop zoom values must appear in ascending order")];mr($[0].zoom)!==y&&(y=mr($[0].zoom),p=void 0,_={}),V=V.concat(zn({key:`${X}[0]`,value:$[0],valueSpec:{zoom:{}},validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,objectElementValidators:{zoom:Sc,value:D}}))}else V=V.concat(D({key:`${X}[0]`,value:$[0],validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec},$));return Rl(ci($[1]))?V.concat([new Le(`${X}[1]`,$[1],"expressions are not allowed in function stops.")]):V.concat(F.validateSpec({key:`${X}[1]`,value:$[1],valueSpec:t,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec}))}function D(F,V){const $=Rt(F.value),X=mr(F.value),te=F.value!==null?F.value:V;if(l){if($!==l)return[new Le(F.key,te,`${$} stop domain type must match previous stop domain type ${l}`)]}else l=$;if($!=="number"&&$!=="string"&&$!=="boolean")return[new Le(F.key,te,"stop domain value must be a number, string, or boolean")];if($!=="number"&&s!=="categorical"){let ge=`number expected, ${$} found`;return wa(t)&&s===void 0&&(ge+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Le(F.key,te,ge)]}return s!=="categorical"||$!=="number"||isFinite(X)&&Math.floor(X)===X?s!=="categorical"&&$==="number"&&p!==void 0&&X<p?[new Le(F.key,te,"stop domain values must appear in ascending order")]:(p=X,s==="categorical"&&X in _?[new Le(F.key,te,"stop domain values must be unique")]:(_[X]=!0,[])):[new Le(F.key,te,`integer expected, found ${X}`)]}}function Ea(i){const t=(i.expressionContext==="property"?xc:Sa)(ci(i.value),i.valueSpec);if(t.result==="error")return t.value.map(l=>new Le(`${i.key}${l.key}`,i.value,l.message));const s=t.value.expression||t.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!s.outputDefined())return[new Le(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!va(s))return[new Le(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!va(s))return[new Le(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!zo(s,["zoom","feature-state"]))return[new Le(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Ao(s))return[new Le(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ki(i){const t=i.key,s=i.value,l=i.valueSpec,p=[];return Array.isArray(l.values)?l.values.indexOf(mr(s))===-1&&p.push(new Le(t,s,`expected one of [${l.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(l.values).indexOf(mr(s))===-1&&p.push(new Le(t,s,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(s)} found`)),p}function kc(i){return Bl(ci(i.value))?Ea(Pi({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):jl(i)}function jl(i){const t=i.value,s=i.key;if(Rt(t)!=="array")return[new Le(s,t,`array expected, ${Rt(t)} found`)];const l=i.styleSpec;let p,y=[];if(t.length<1)return[new Le(s,t,"filter array must have at least 1 element")];switch(y=y.concat(Ki({key:`${s}[0]`,value:t[0],valueSpec:l.filter_operator,style:i.style,styleSpec:i.styleSpec})),mr(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&mr(t[1])==="$type"&&y.push(new Le(s,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&y.push(new Le(s,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(p=Rt(t[1]),p!=="string"&&y.push(new Le(`${s}[1]`,t[1],`string expected, ${p} found`)));for(let _=2;_<t.length;_++)p=Rt(t[_]),mr(t[1])==="$type"?y=y.concat(Ki({key:`${s}[${_}]`,value:t[_],valueSpec:l.geometry_type,style:i.style,styleSpec:i.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&y.push(new Le(`${s}[${_}]`,t[_],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let _=1;_<t.length;_++)y=y.concat(jl({key:`${s}[${_}]`,value:t[_],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":p=Rt(t[1]),t.length!==2?y.push(new Le(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):p!=="string"&&y.push(new Le(`${s}[1]`,t[1],`string expected, ${p} found`))}return y}function Tc(i,t){const s=i.key,l=i.validateSpec,p=i.style,y=i.styleSpec,_=i.value,w=i.objectKey,S=y[`${t}_${i.layerType}`];if(!S)return[];const I=w.match(/^(.*)-transition$/);if(t==="paint"&&I&&S[I[1]]&&S[I[1]].transition)return l({key:s,value:_,valueSpec:y.transition,style:p,styleSpec:y});const E=i.valueSpec||S[w];if(!E)return[new Le(s,_,`unknown property "${w}"`)];let M;if(Rt(_)==="string"&&wa(E)&&!E.tokens&&(M=/^{([^}]+)}$/.exec(_)))return[new Le(s,_,`"${w}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(M[1])} }\`.`)];const D=[];return i.layerType==="symbol"&&(w==="text-field"&&p&&!p.glyphs&&D.push(new Le(s,_,'use of "text-field" requires a style "glyphs" property')),w==="text-font"&&zl(ci(_))&&mr(_.type)==="identity"&&D.push(new Le(s,_,'"text-font" does not support identity functions'))),D.concat(l({key:i.key,value:_,valueSpec:E,style:p,styleSpec:y,expressionContext:"property",propertyType:t,propertyKey:w}))}function Vl(i){return Tc(i,"paint")}function Ic(i){return Tc(i,"layout")}function Ec(i){let t=[];const s=i.value,l=i.key,p=i.style,y=i.styleSpec;s.type||s.ref||t.push(new Le(l,s,'either "type" or "ref" is required'));let _=mr(s.type);const w=mr(s.ref);if(s.id){const S=mr(s.id);for(let I=0;I<i.arrayIndex;I++){const E=p.layers[I];mr(E.id)===S&&t.push(new Le(l,s.id,`duplicate layer id "${s.id}", previously used at line ${E.id.__line__}`))}}if("ref"in s){let S;["type","source","source-layer","filter","layout"].forEach(I=>{I in s&&t.push(new Le(l,s[I],`"${I}" is prohibited for ref layers`))}),p.layers.forEach(I=>{mr(I.id)===w&&(S=I)}),S?S.ref?t.push(new Le(l,s.ref,"ref cannot reference another ref layer")):_=mr(S.type):t.push(new Le(l,s.ref,`ref layer "${w}" not found`))}else if(_!=="background")if(s.source){const S=p.sources&&p.sources[s.source],I=S&&mr(S.type);S?I==="vector"&&_==="raster"?t.push(new Le(l,s.source,`layer "${s.id}" requires a raster source`)):I!=="raster-dem"&&_==="hillshade"?t.push(new Le(l,s.source,`layer "${s.id}" requires a raster-dem source`)):I==="raster"&&_!=="raster"?t.push(new Le(l,s.source,`layer "${s.id}" requires a vector source`)):I!=="vector"||s["source-layer"]?I==="raster-dem"&&_!=="hillshade"?t.push(new Le(l,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):_!=="line"||!s.paint||!s.paint["line-gradient"]||I==="geojson"&&S.lineMetrics||t.push(new Le(l,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Le(l,s,`layer "${s.id}" must specify a "source-layer"`)):t.push(new Le(l,s.source,`source "${s.source}" not found`))}else t.push(new Le(l,s,'missing required property "source"'));return t=t.concat(zn({key:l,value:s,valueSpec:y.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${l}.type`,value:s.type,valueSpec:y.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:s,objectKey:"type"}),filter:kc,layout:S=>zn({layer:s,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":I=>Ic(Pi({layerType:_},I))}}),paint:S=>zn({layer:s,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":I=>Vl(Pi({layerType:_},I))}})}})),t}function js(i){const t=i.value,s=i.key,l=Rt(t);return l!=="string"?[new Le(s,t,`string expected, ${l} found`)]:[]}const Ul={promoteId:function({key:i,value:t}){if(Rt(t)==="string")return js({key:i,value:t});{const s=[];for(const l in t)s.push(...js({key:`${i}.${l}`,value:t[l]}));return s}}};function Fo(i){const t=i.value,s=i.key,l=i.styleSpec,p=i.style,y=i.validateSpec;if(!t.type)return[new Le(s,t,'"type" is required')];const _=mr(t.type);let w;switch(_){case"vector":case"raster":return w=zn({key:s,value:t,valueSpec:l[`source_${_.replace("-","_")}`],style:i.style,styleSpec:l,objectElementValidators:Ul,validateSpec:y}),w;case"raster-dem":return w=function(S){var I;const E=(I=S.sourceName)!==null&&I!==void 0?I:"",M=S.value,D=S.styleSpec,F=D.source_raster_dem,V=S.style;let $=[];const X=Rt(M);if(M===void 0)return $;if(X!=="object")return $.push(new Le("source_raster_dem",M,`object expected, ${X} found`)),$;const te=mr(M.encoding)==="custom",ge=["redFactor","greenFactor","blueFactor","baseShift"],ae=S.value.encoding?`"${S.value.encoding}"`:"Default";for(const fe in M)!te&&ge.includes(fe)?$.push(new Le(fe,M[fe],`In "${E}": "${fe}" is only valid when "encoding" is set to "custom". ${ae} encoding found`)):F[fe]?$=$.concat(S.validateSpec({key:fe,value:M[fe],valueSpec:F[fe],validateSpec:S.validateSpec,style:V,styleSpec:D})):$.push(new Le(fe,M[fe],`unknown property "${fe}"`));return $}({sourceName:s,value:t,style:i.style,styleSpec:l,validateSpec:y}),w;case"geojson":if(w=zn({key:s,value:t,valueSpec:l.source_geojson,style:p,styleSpec:l,validateSpec:y,objectElementValidators:Ul}),t.cluster)for(const S in t.clusterProperties){const[I,E]=t.clusterProperties[S],M=typeof I=="string"?[I,["accumulated"],["get",S]]:I;w.push(...Ea({key:`${s}.${S}.map`,value:E,expressionContext:"cluster-map"})),w.push(...Ea({key:`${s}.${S}.reduce`,value:M,expressionContext:"cluster-reduce"}))}return w;case"video":return zn({key:s,value:t,valueSpec:l.source_video,style:p,validateSpec:y,styleSpec:l});case"image":return zn({key:s,value:t,valueSpec:l.source_image,style:p,validateSpec:y,styleSpec:l});case"canvas":return[new Le(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ki({key:`${s}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Pc(i){const t=i.value,s=i.styleSpec,l=s.light,p=i.style;let y=[];const _=Rt(t);if(t===void 0)return y;if(_!=="object")return y=y.concat([new Le("light",t,`object expected, ${_} found`)]),y;for(const w in t){const S=w.match(/^(.*)-transition$/);y=y.concat(S&&l[S[1]]&&l[S[1]].transition?i.validateSpec({key:w,value:t[w],valueSpec:s.transition,validateSpec:i.validateSpec,style:p,styleSpec:s}):l[w]?i.validateSpec({key:w,value:t[w],valueSpec:l[w],validateSpec:i.validateSpec,style:p,styleSpec:s}):[new Le(w,t[w],`unknown property "${w}"`)])}return y}function Cc(i){const t=i.value,s=i.styleSpec,l=s.sky,p=i.style,y=Rt(t);if(t===void 0)return[];if(y!=="object")return[new Le("sky",t,`object expected, ${y} found`)];let _=[];for(const w in t)_=_.concat(l[w]?i.validateSpec({key:w,value:t[w],valueSpec:l[w],style:p,styleSpec:s}):[new Le(w,t[w],`unknown property "${w}"`)]);return _}function Mc(i){const t=i.value,s=i.styleSpec,l=s.terrain,p=i.style;let y=[];const _=Rt(t);if(t===void 0)return y;if(_!=="object")return y=y.concat([new Le("terrain",t,`object expected, ${_} found`)]),y;for(const w in t)y=y.concat(l[w]?i.validateSpec({key:w,value:t[w],valueSpec:l[w],validateSpec:i.validateSpec,style:p,styleSpec:s}):[new Le(w,t[w],`unknown property "${w}"`)]);return y}function Ac(i){let t=[];const s=i.value,l=i.key;if(Array.isArray(s)){const p=[],y=[];for(const _ in s)s[_].id&&p.includes(s[_].id)&&t.push(new Le(l,s,`all the sprites' ids must be unique, but ${s[_].id} is duplicated`)),p.push(s[_].id),s[_].url&&y.includes(s[_].url)&&t.push(new Le(l,s,`all the sprites' URLs must be unique, but ${s[_].url} is duplicated`)),y.push(s[_].url),t=t.concat(zn({key:`${l}[${_}]`,value:s[_],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return t}return js({key:l,value:s})}const $l={"*":()=>[],array:Bo,boolean:function(i){const t=i.value,s=i.key,l=Rt(t);return l!=="boolean"?[new Le(s,t,`boolean expected, ${l} found`)]:[]},number:Sc,color:function(i){const t=i.key,s=i.value,l=Rt(s);return l!=="string"?[new Le(t,s,`color expected, ${l} found`)]:qt.parse(String(s))?[]:[new Le(t,s,`color expected, "${s}" found`)]},constants:Ud,enum:Ki,filter:kc,function:Nl,layer:Ec,object:zn,source:Fo,light:Pc,sky:Cc,terrain:Mc,projection:function(i){const t=i.value,s=i.styleSpec,l=s.projection,p=i.style,y=Rt(t);if(t===void 0)return[];if(y!=="object")return[new Le("projection",t,`object expected, ${y} found`)];let _=[];for(const w in t)_=_.concat(l[w]?i.validateSpec({key:w,value:t[w],valueSpec:l[w],style:p,styleSpec:s}):[new Le(w,t[w],`unknown property "${w}"`)]);return _},string:js,formatted:function(i){return js(i).length===0?[]:Ea(i)},resolvedImage:function(i){return js(i).length===0?[]:Ea(i)},padding:function(i){const t=i.key,s=i.value;if(Rt(s)==="array"){if(s.length<1||s.length>4)return[new Le(t,s,`padding requires 1 to 4 values; ${s.length} values found`)];const l={type:"number"};let p=[];for(let y=0;y<s.length;y++)p=p.concat(i.validateSpec({key:`${t}[${y}]`,value:s[y],validateSpec:i.validateSpec,valueSpec:l}));return p}return Sc({key:t,value:s,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const t=i.key,s=i.value,l=Rt(s),p=i.styleSpec;if(l!=="array"||s.length<1||s.length%2!=0)return[new Le(t,s,"variableAnchorOffsetCollection requires a non-empty array of even length")];let y=[];for(let _=0;_<s.length;_+=2)y=y.concat(Ki({key:`${t}[${_}]`,value:s[_],valueSpec:p.layout_symbol["text-anchor"]})),y=y.concat(Bo({key:`${t}[${_+1}]`,value:s[_+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:p}));return y},sprite:Ac};function Oo(i){const t=i.value,s=i.valueSpec,l=i.styleSpec;return i.validateSpec=Oo,s.expression&&zl(mr(t))?Nl(i):s.expression&&Rl(ci(t))?Ea(i):s.type&&$l[s.type]?$l[s.type](i):zn(Pi({},i,{valueSpec:s.type?l[s.type]:s}))}function $d(i){const t=i.value,s=i.key,l=js(i);return l.length||(t.indexOf("{fontstack}")===-1&&l.push(new Le(s,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&l.push(new Le(s,t,'"glyphs" url must include a "{range}" token'))),l}function Gn(i,t=we){let s=[];return s=s.concat(Oo({key:"",value:i,valueSpec:t.$root,styleSpec:t,style:i,validateSpec:Oo,objectElementValidators:{glyphs:$d,"*":()=>[]}})),i.constants&&(s=s.concat(Ud({key:"constants",value:i.constants}))),zc(s)}function Di(i){return function(t){return i({...t,validateSpec:Oo})}}function zc(i){return[].concat(i).sort((t,s)=>t.line-s.line)}function hi(i){return function(...t){return zc(i.apply(this,t))}}Gn.source=hi(Di(Fo)),Gn.sprite=hi(Di(Ac)),Gn.glyphs=hi(Di($d)),Gn.light=hi(Di(Pc)),Gn.sky=hi(Di(Cc)),Gn.terrain=hi(Di(Mc)),Gn.layer=hi(Di(Ec)),Gn.filter=hi(Di(kc)),Gn.paintProperty=hi(Di(Vl)),Gn.layoutProperty=hi(Di(Ic));const Vs=Gn,Pm=Vs.light,Cm=Vs.sky,qd=Vs.paintProperty,Zd=Vs.layoutProperty;function Dc(i,t){let s=!1;if(t&&t.length)for(const l of t)i.fire(new os(new Error(l.message))),s=!0;return s}class Pa{constructor(t,s,l){const p=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const _=new Int32Array(this.arrayBuffer);t=_[0],this.d=(s=_[1])+2*(l=_[2]);for(let S=0;S<this.d*this.d;S++){const I=_[3+S],E=_[3+S+1];p.push(I===E?null:_.subarray(I,E))}const w=_[3+p.length+1];this.keys=_.subarray(_[3+p.length],w),this.bboxes=_.subarray(w),this.insert=this._insertReadonly}else{this.d=s+2*l;for(let _=0;_<this.d*this.d;_++)p.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=t,this.padding=l,this.scale=s/t,this.uid=0;const y=l/s*t;this.min=-y,this.max=t+y}insert(t,s,l,p,y){this._forEachCell(s,l,p,y,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(y)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,s,l,p,y,_){this.cells[y].push(_)}query(t,s,l,p,y){const _=this.min,w=this.max;if(t<=_&&s<=_&&w<=l&&w<=p&&!y)return Array.prototype.slice.call(this.keys);{const S=[];return this._forEachCell(t,s,l,p,this._queryCell,S,{},y),S}}_queryCell(t,s,l,p,y,_,w,S){const I=this.cells[y];if(I!==null){const E=this.keys,M=this.bboxes;for(let D=0;D<I.length;D++){const F=I[D];if(w[F]===void 0){const V=4*F;(S?S(M[V+0],M[V+1],M[V+2],M[V+3]):t<=M[V+2]&&s<=M[V+3]&&l>=M[V+0]&&p>=M[V+1])?(w[F]=!0,_.push(E[F])):w[F]=!1}}}}_forEachCell(t,s,l,p,y,_,w,S){const I=this._convertToCellCoord(t),E=this._convertToCellCoord(s),M=this._convertToCellCoord(l),D=this._convertToCellCoord(p);for(let F=I;F<=M;F++)for(let V=E;V<=D;V++){const $=this.d*V+F;if((!S||S(this._convertFromCellCoord(F),this._convertFromCellCoord(V),this._convertFromCellCoord(F+1),this._convertFromCellCoord(V+1)))&&y.call(this,t,s,l,p,$,_,w,S))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,s=3+this.cells.length+1+1;let l=0;for(let _=0;_<this.cells.length;_++)l+=this.cells[_].length;const p=new Int32Array(s+l+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;let y=s;for(let _=0;_<t.length;_++){const w=t[_];p[3+_]=y,p.set(w,y),y+=w.length}return p[3+t.length]=y,p.set(this.keys,y),y+=this.keys.length,p[3+t.length+1]=y,p.set(this.bboxes,y),y+=this.bboxes.length,p.buffer}static serialize(t,s){const l=t.toArrayBuffer();return s&&s.push(l),{buffer:l}}static deserialize(t){return new Pa(t.buffer)}}const Hn={};function Xe(i,t,s={}){if(Hn[i])throw new Error(`${i} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:i,writeable:!1}),Hn[i]={klass:t,omit:s.omit||[],shallow:s.shallow||[]}}Xe("Object",Object),Xe("TransferableGridIndex",Pa),Xe("Color",qt),Xe("Error",Error),Xe("AJAXError",zr),Xe("ResolvedImage",An),Xe("StylePropertyFunction",Ia),Xe("StyleExpression",Ll,{omit:["_evaluator"]}),Xe("ZoomDependentExpression",Ta),Xe("ZoomConstantExpression",ka),Xe("CompoundExpression",Zn,{omit:["_evaluate"]});for(const i in _a)_a[i]._classRegistryKey||Xe(`Expression_${i}`,_a[i]);function ql(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Lc(i){return i.$name||i.constructor._classRegistryKey}function Gd(i){return!function(t){if(t===null||typeof t!="object")return!1;const s=Lc(t);return!(!s||s==="Object")}(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||ql(i)||Nt(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function Ca(i,t){if(Gd(i))return(ql(i)||Nt(i))&&t&&t.push(i),ArrayBuffer.isView(i)&&t&&t.push(i.buffer),i instanceof ImageData&&t&&t.push(i.data.buffer),i;if(Array.isArray(i)){const y=[];for(const _ of i)y.push(Ca(_,t));return y}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);const s=Lc(i);if(!s)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!Hn[s])throw new Error(`${s} is not registered.`);const{klass:l}=Hn[s],p=l.serialize?l.serialize(i,t):{};if(l.serialize){if(t&&p===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const y in i){if(!i.hasOwnProperty(y)||Hn[s].omit.indexOf(y)>=0)continue;const _=i[y];p[y]=Hn[s].shallow.indexOf(y)>=0?_:Ca(_,t)}i instanceof Error&&(p.message=i.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(p.$name=s),p}function Ma(i){if(Gd(i))return i;if(Array.isArray(i))return i.map(Ma);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);const t=Lc(i)||"Object";if(!Hn[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:s}=Hn[t];if(!s)throw new Error(`can't deserialize unregistered class ${t}`);if(s.deserialize)return s.deserialize(i);const l=Object.create(s.prototype);for(const p of Object.keys(i)){if(p==="$name")continue;const y=i[p];l[p]=Hn[t].shallow.indexOf(p)>=0?y:Ma(y)}return l}class Rc{constructor(){this.first=!0}update(t,s){const l=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=s),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=l,!0))}}const Ct={"Latin-1 Supplement":i=>i>=128&&i<=255,"Hangul Jamo":i=>i>=4352&&i<=4607,Khmer:i=>i>=6016&&i<=6143,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Katakana:i=>i>=12448&&i<=12543,Kanbun:i=>i>=12688&&i<=12703,"CJK Strokes":i=>i>=12736&&i<=12783,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"Private Use Area":i=>i>=57344&&i<=63743,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function Bc(i){for(const t of i)if(Oc(t.charCodeAt(0)))return!0;return!1}function Mm(i){for(const t of i)if(!Aa(t.charCodeAt(0)))return!1;return!0}function Fc(i){const t=i.map(s=>{try{return new RegExp(`\\p{sc=${s}}`,"u").source}catch{return null}}).filter(s=>s);return new RegExp(t.join("|"),"u")}const Am=Fc(["Arab","Dupl","Mong","Ougr","Syrc"]);function Aa(i){return!Am.test(String.fromCodePoint(i))}const Hd=Fc(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Oc(i){return!(i!==746&&i!==747&&(i<4352||!(Ct["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Ct["CJK Compatibility"](i)||Ct["CJK Strokes"](i)||!(!Ct["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Ct["Enclosed CJK Letters and Months"](i)||Ct["Ideographic Description Characters"](i)||Ct.Kanbun(i)||Ct.Katakana(i)&&i!==12540||!(!Ct["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Ct["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Ct["Vertical Forms"](i)||Ct["Yijing Hexagram Symbols"](i)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(i))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(i))||Hd.test(String.fromCodePoint(i)))))}function Kd(i){return!(Oc(i)||function(t){return!!(Ct["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Ct["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Ct["Letterlike Symbols"](t)||Ct["Number Forms"](t)||Ct["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Ct["Control Pictures"](t)&&t!==9251||Ct["Optical Character Recognition"](t)||Ct["Enclosed Alphanumerics"](t)||Ct["Geometric Shapes"](t)||Ct["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Ct["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Ct["CJK Symbols and Punctuation"](t)||Ct.Katakana(t)||Ct["Private Use Area"](t)||Ct["CJK Compatibility Forms"](t)||Ct["Small Form Variants"](t)||Ct["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(i))}const zm=Fc(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Nc(i){return zm.test(String.fromCodePoint(i))}function Dm(i,t){return!(!t&&Nc(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Ct.Khmer(i))}function Lm(i){for(const t of i)if(Nc(t.charCodeAt(0)))return!0;return!1}const Dn=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class er{constructor(t,s){this.zoom=t,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Rc,this.transition={})}isSupportedScript(t){return function(s,l){for(const p of s)if(!Dm(p.charCodeAt(0),l))return!1;return!0}(t,Dn.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,s=t-Math.floor(t),l=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*s}}}class za{constructor(t,s){this.property=t,this.value=s,this.expression=function(l,p){if(zl(l))return new Ia(l,p);if(Rl(l)){const y=xc(l,p);if(y.result==="error")throw new Error(y.value.map(_=>`${_.key}: ${_.message}`).join(", "));return y.value}{let y=l;return p.type==="color"&&typeof l=="string"?y=qt.parse(l):p.type!=="padding"||typeof l!="number"&&!Array.isArray(l)?p.type==="variableAnchorOffsetCollection"&&Array.isArray(l)&&(y=qn.parse(l)):y=Mn.parse(l),{kind:"constant",evaluate:()=>y}}}(s===void 0?t.specification.default:s,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,s,l){return this.property.possiblyEvaluate(this,t,s,l)}}class Zl{constructor(t){this.property=t,this.value=new za(t,void 0)}transitioned(t,s){return new Wd(this.property,this.value,s,xe({},t.transition,this.transition),t.now)}untransitioned(){return new Wd(this.property,this.value,null,{},0)}}class Gl{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return Ye(this._values[t].value.value)}setValue(t,s){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Zl(this._values[t].property)),this._values[t].value=new za(this._values[t].property,s===null?void 0:Ye(s))}getTransition(t){return Ye(this._values[t].transition)}setTransition(t,s){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Zl(this._values[t].property)),this._values[t].transition=Ye(s)||void 0}serialize(){const t={};for(const s of Object.keys(this._values)){const l=this.getValue(s);l!==void 0&&(t[s]=l);const p=this.getTransition(s);p!==void 0&&(t[`${s}-transition`]=p)}return t}transitioned(t,s){const l=new No(this._properties);for(const p of Object.keys(this._values))l._values[p]=this._values[p].transitioned(t,s._values[p]);return l}untransitioned(){const t=new No(this._properties);for(const s of Object.keys(this._values))t._values[s]=this._values[s].untransitioned();return t}}class Wd{constructor(t,s,l,p,y){this.property=t,this.value=s,this.begin=y+p.delay||0,this.end=this.begin+p.duration||0,t.specification.transition&&(p.delay||p.duration)&&(this.prior=l)}possiblyEvaluate(t,s,l){const p=t.now||0,y=this.value.possiblyEvaluate(t,s,l),_=this.prior;if(_){if(p>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(p<this.begin)return _.possiblyEvaluate(t,s,l);{const w=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(t,s,l),y,function(S){if(S<=0)return 0;if(S>=1)return 1;const I=S*S,E=I*S;return 4*(S<.5?E:3*(S-I)+E-.75)}(w))}}return y}}class No{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,s,l){const p=new Vo(this._properties);for(const y of Object.keys(this._values))p._values[y]=this._values[y].possiblyEvaluate(t,s,l);return p}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class jo{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return Ye(this._values[t].value)}setValue(t,s){this._values[t]=new za(this._values[t].property,s===null?void 0:Ye(s))}serialize(){const t={};for(const s of Object.keys(this._values)){const l=this.getValue(s);l!==void 0&&(t[s]=l)}return t}possiblyEvaluate(t,s,l){const p=new Vo(this._properties);for(const y of Object.keys(this._values))p._values[y]=this._values[y].possiblyEvaluate(t,s,l);return p}}class Li{constructor(t,s,l){this.property=t,this.value=s,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,s,l,p){return this.property.evaluate(this.value,this.parameters,t,s,l,p)}}class Vo{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Qe{constructor(t){this.specification=t}possiblyEvaluate(t,s){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(s)}interpolate(t,s,l){const p=mn[this.specification.type];return p?p(t,s,l):t}}class ct{constructor(t,s){this.specification=t,this.overrides=s}possiblyEvaluate(t,s,l,p){return new Li(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(s,null,{},l,p)}:t.expression,s)}interpolate(t,s,l){if(t.value.kind!=="constant"||s.value.kind!=="constant")return t;if(t.value.value===void 0||s.value.value===void 0)return new Li(this,{kind:"constant",value:void 0},t.parameters);const p=mn[this.specification.type];if(p){const y=p(t.value.value,s.value.value,l);return new Li(this,{kind:"constant",value:y},t.parameters)}return t}evaluate(t,s,l,p,y,_){return t.kind==="constant"?t.value:t.evaluate(s,l,p,y,_)}}class Hl extends ct{possiblyEvaluate(t,s,l,p){if(t.value===void 0)return new Li(this,{kind:"constant",value:void 0},s);if(t.expression.kind==="constant"){const y=t.expression.evaluate(s,null,{},l,p),_=t.property.specification.type==="resolvedImage"&&typeof y!="string"?y.name:y,w=this._calculate(_,_,_,s);return new Li(this,{kind:"constant",value:w},s)}if(t.expression.kind==="camera"){const y=this._calculate(t.expression.evaluate({zoom:s.zoom-1}),t.expression.evaluate({zoom:s.zoom}),t.expression.evaluate({zoom:s.zoom+1}),s);return new Li(this,{kind:"constant",value:y},s)}return new Li(this,t.expression,s)}evaluate(t,s,l,p,y,_){if(t.kind==="source"){const w=t.evaluate(s,l,p,y,_);return this._calculate(w,w,w,s)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(s.zoom)-1},l,p),t.evaluate({zoom:Math.floor(s.zoom)},l,p),t.evaluate({zoom:Math.floor(s.zoom)+1},l,p),s):t.value}_calculate(t,s,l,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:t,to:s}:{from:l,to:s}}interpolate(t){return t}}class Kl{constructor(t){this.specification=t}possiblyEvaluate(t,s,l,p){if(t.value!==void 0){if(t.expression.kind==="constant"){const y=t.expression.evaluate(s,null,{},l,p);return this._calculate(y,y,y,s)}return this._calculate(t.expression.evaluate(new er(Math.floor(s.zoom-1),s)),t.expression.evaluate(new er(Math.floor(s.zoom),s)),t.expression.evaluate(new er(Math.floor(s.zoom+1),s)),s)}}_calculate(t,s,l,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:t,to:s}:{from:l,to:s}}interpolate(t){return t}}class jc{constructor(t){this.specification=t}possiblyEvaluate(t,s,l,p){return!!t.expression.evaluate(s,null,{},l,p)}interpolate(){return!1}}class m{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in t){const l=t[s];l.specification.overridable&&this.overridableProperties.push(s);const p=this.defaultPropertyValues[s]=new za(l,void 0),y=this.defaultTransitionablePropertyValues[s]=new Zl(l);this.defaultTransitioningPropertyValues[s]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=p.possiblyEvaluate({})}}}Xe("DataDrivenProperty",ct),Xe("DataConstantProperty",Qe),Xe("CrossFadedDataDrivenProperty",Hl),Xe("CrossFadedProperty",Kl),Xe("ColorRampProperty",jc);const e="-transition";class a extends ca{constructor(t,s){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),s.layout&&(this._unevaluatedLayout=new jo(s.layout)),s.paint)){this._transitionablePaint=new Gl(s.paint);for(const l in t.paint)this.setPaintProperty(l,t.paint[l],{validate:!1});for(const l in t.layout)this.setLayoutProperty(l,t.layout[l],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Vo(s.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,s,l={}){s!=null&&this._validate(Zd,`layers.${this.id}.layout.${t}`,t,s,l)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,s):this.visibility=s)}getPaintProperty(t){return t.endsWith(e)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,s,l={}){if(s!=null&&this._validate(qd,`layers.${this.id}.paint.${t}`,t,s,l))return!1;if(t.endsWith(e))return this._transitionablePaint.setTransition(t.slice(0,-11),s||void 0),!1;{const p=this._transitionablePaint._values[t],y=p.property.specification["property-type"]==="cross-faded-data-driven",_=p.value.isDataDriven(),w=p.value;this._transitionablePaint.setValue(t,s),this._handleSpecialPaintPropertyUpdate(t);const S=this._transitionablePaint._values[t].value;return S.isDataDriven()||_||y||this._handleOverridablePaintPropertyUpdate(t,w,S)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,s,l){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,s){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,s)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),rt(t,(s,l)=>!(s===void 0||l==="layout"&&!Object.keys(s).length||l==="paint"&&!Object.keys(s).length))}_validate(t,s,l,p,y={}){return(!y||y.validate!==!1)&&Dc(this,t.call(Vs,{key:s,layerType:this.type,objectKey:l,value:p,styleSpec:we,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const s=this.paint.get(t);if(s instanceof Li&&wa(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}}const c={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class d{constructor(t,s){this._structArray=t,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class f{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,s){return t._trim(),s&&(t.isTransferred=!0,s.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const s=Object.create(this.prototype);return s.arrayBuffer=t.arrayBuffer,s.length=t.length,s.capacity=t.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function b(i,t=1){let s=0,l=0;return{members:i.map(p=>{const y=c[p.type].BYTES_PER_ELEMENT,_=s=k(s,Math.max(t,y)),w=p.components||1;return l=Math.max(l,y),s+=y*w,{name:p.name,type:p.type,components:w,offset:_}}),size:k(s,Math.max(l,t)),alignment:t}}function k(i,t){return Math.ceil(i/t)*t}class T extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,s)}emplace(t,s,l){const p=2*t;return this.int16[p+0]=s,this.int16[p+1]=l,t}}T.prototype.bytesPerElement=4,Xe("StructArrayLayout2i4",T);class P extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,l){const p=this.length;return this.resize(p+1),this.emplace(p,t,s,l)}emplace(t,s,l,p){const y=3*t;return this.int16[y+0]=s,this.int16[y+1]=l,this.int16[y+2]=p,t}}P.prototype.bytesPerElement=6,Xe("StructArrayLayout3i6",P);class A extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,l,p){const y=this.length;return this.resize(y+1),this.emplace(y,t,s,l,p)}emplace(t,s,l,p,y){const _=4*t;return this.int16[_+0]=s,this.int16[_+1]=l,this.int16[_+2]=p,this.int16[_+3]=y,t}}A.prototype.bytesPerElement=8,Xe("StructArrayLayout4i8",A);class z extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,l,p,y,_){const w=this.length;return this.resize(w+1),this.emplace(w,t,s,l,p,y,_)}emplace(t,s,l,p,y,_,w){const S=6*t;return this.int16[S+0]=s,this.int16[S+1]=l,this.int16[S+2]=p,this.int16[S+3]=y,this.int16[S+4]=_,this.int16[S+5]=w,t}}z.prototype.bytesPerElement=12,Xe("StructArrayLayout2i4i12",z);class N extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,l,p,y,_){const w=this.length;return this.resize(w+1),this.emplace(w,t,s,l,p,y,_)}emplace(t,s,l,p,y,_,w){const S=4*t,I=8*t;return this.int16[S+0]=s,this.int16[S+1]=l,this.uint8[I+4]=p,this.uint8[I+5]=y,this.uint8[I+6]=_,this.uint8[I+7]=w,t}}N.prototype.bytesPerElement=8,Xe("StructArrayLayout2i4ub8",N);class Z extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,s)}emplace(t,s,l){const p=2*t;return this.float32[p+0]=s,this.float32[p+1]=l,t}}Z.prototype.bytesPerElement=8,Xe("StructArrayLayout2f8",Z);class H extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,l,p,y,_,w,S,I,E){const M=this.length;return this.resize(M+1),this.emplace(M,t,s,l,p,y,_,w,S,I,E)}emplace(t,s,l,p,y,_,w,S,I,E,M){const D=10*t;return this.uint16[D+0]=s,this.uint16[D+1]=l,this.uint16[D+2]=p,this.uint16[D+3]=y,this.uint16[D+4]=_,this.uint16[D+5]=w,this.uint16[D+6]=S,this.uint16[D+7]=I,this.uint16[D+8]=E,this.uint16[D+9]=M,t}}H.prototype.bytesPerElement=20,Xe("StructArrayLayout10ui20",H);class J extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,l,p,y,_,w,S,I,E,M,D){const F=this.length;return this.resize(F+1),this.emplace(F,t,s,l,p,y,_,w,S,I,E,M,D)}emplace(t,s,l,p,y,_,w,S,I,E,M,D,F){const V=12*t;return this.int16[V+0]=s,this.int16[V+1]=l,this.int16[V+2]=p,this.int16[V+3]=y,this.uint16[V+4]=_,this.uint16[V+5]=w,this.uint16[V+6]=S,this.uint16[V+7]=I,this.int16[V+8]=E,this.int16[V+9]=M,this.int16[V+10]=D,this.int16[V+11]=F,t}}J.prototype.bytesPerElement=24,Xe("StructArrayLayout4i4ui4i24",J);class re extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,l){const p=this.length;return this.resize(p+1),this.emplace(p,t,s,l)}emplace(t,s,l,p){const y=3*t;return this.float32[y+0]=s,this.float32[y+1]=l,this.float32[y+2]=p,t}}re.prototype.bytesPerElement=12,Xe("StructArrayLayout3f12",re);class ne extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint32[1*t+0]=s,t}}ne.prototype.bytesPerElement=4,Xe("StructArrayLayout1ul4",ne);class se extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,l,p,y,_,w,S,I){const E=this.length;return this.resize(E+1),this.emplace(E,t,s,l,p,y,_,w,S,I)}emplace(t,s,l,p,y,_,w,S,I,E){const M=10*t,D=5*t;return this.int16[M+0]=s,this.int16[M+1]=l,this.int16[M+2]=p,this.int16[M+3]=y,this.int16[M+4]=_,this.int16[M+5]=w,this.uint32[D+3]=S,this.uint16[M+8]=I,this.uint16[M+9]=E,t}}se.prototype.bytesPerElement=20,Xe("StructArrayLayout6i1ul2ui20",se);class W extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,l,p,y,_){const w=this.length;return this.resize(w+1),this.emplace(w,t,s,l,p,y,_)}emplace(t,s,l,p,y,_,w){const S=6*t;return this.int16[S+0]=s,this.int16[S+1]=l,this.int16[S+2]=p,this.int16[S+3]=y,this.int16[S+4]=_,this.int16[S+5]=w,t}}W.prototype.bytesPerElement=12,Xe("StructArrayLayout2i2i2i12",W);class ue extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,l,p,y){const _=this.length;return this.resize(_+1),this.emplace(_,t,s,l,p,y)}emplace(t,s,l,p,y,_){const w=4*t,S=8*t;return this.float32[w+0]=s,this.float32[w+1]=l,this.float32[w+2]=p,this.int16[S+6]=y,this.int16[S+7]=_,t}}ue.prototype.bytesPerElement=16,Xe("StructArrayLayout2f1f2i16",ue);class pe extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,s,l,p,y,_){const w=this.length;return this.resize(w+1),this.emplace(w,t,s,l,p,y,_)}emplace(t,s,l,p,y,_,w){const S=16*t,I=4*t,E=8*t;return this.uint8[S+0]=s,this.uint8[S+1]=l,this.float32[I+1]=p,this.float32[I+2]=y,this.int16[E+6]=_,this.int16[E+7]=w,t}}pe.prototype.bytesPerElement=16,Xe("StructArrayLayout2ub2f2i16",pe);class ye extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,l){const p=this.length;return this.resize(p+1),this.emplace(p,t,s,l)}emplace(t,s,l,p){const y=3*t;return this.uint16[y+0]=s,this.uint16[y+1]=l,this.uint16[y+2]=p,t}}ye.prototype.bytesPerElement=6,Xe("StructArrayLayout3ui6",ye);class Me extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,l,p,y,_,w,S,I,E,M,D,F,V,$,X,te){const ge=this.length;return this.resize(ge+1),this.emplace(ge,t,s,l,p,y,_,w,S,I,E,M,D,F,V,$,X,te)}emplace(t,s,l,p,y,_,w,S,I,E,M,D,F,V,$,X,te,ge){const ae=24*t,fe=12*t,be=48*t;return this.int16[ae+0]=s,this.int16[ae+1]=l,this.uint16[ae+2]=p,this.uint16[ae+3]=y,this.uint32[fe+2]=_,this.uint32[fe+3]=w,this.uint32[fe+4]=S,this.uint16[ae+10]=I,this.uint16[ae+11]=E,this.uint16[ae+12]=M,this.float32[fe+7]=D,this.float32[fe+8]=F,this.uint8[be+36]=V,this.uint8[be+37]=$,this.uint8[be+38]=X,this.uint32[fe+10]=te,this.int16[ae+22]=ge,t}}Me.prototype.bytesPerElement=48,Xe("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Me);class De extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,l,p,y,_,w,S,I,E,M,D,F,V,$,X,te,ge,ae,fe,be,ze,Ge,ut,qe,Ue,nt,Je){const We=this.length;return this.resize(We+1),this.emplace(We,t,s,l,p,y,_,w,S,I,E,M,D,F,V,$,X,te,ge,ae,fe,be,ze,Ge,ut,qe,Ue,nt,Je)}emplace(t,s,l,p,y,_,w,S,I,E,M,D,F,V,$,X,te,ge,ae,fe,be,ze,Ge,ut,qe,Ue,nt,Je,We){const Ee=32*t,it=16*t;return this.int16[Ee+0]=s,this.int16[Ee+1]=l,this.int16[Ee+2]=p,this.int16[Ee+3]=y,this.int16[Ee+4]=_,this.int16[Ee+5]=w,this.int16[Ee+6]=S,this.int16[Ee+7]=I,this.uint16[Ee+8]=E,this.uint16[Ee+9]=M,this.uint16[Ee+10]=D,this.uint16[Ee+11]=F,this.uint16[Ee+12]=V,this.uint16[Ee+13]=$,this.uint16[Ee+14]=X,this.uint16[Ee+15]=te,this.uint16[Ee+16]=ge,this.uint16[Ee+17]=ae,this.uint16[Ee+18]=fe,this.uint16[Ee+19]=be,this.uint16[Ee+20]=ze,this.uint16[Ee+21]=Ge,this.uint16[Ee+22]=ut,this.uint32[it+12]=qe,this.float32[it+13]=Ue,this.float32[it+14]=nt,this.uint16[Ee+30]=Je,this.uint16[Ee+31]=We,t}}De.prototype.bytesPerElement=64,Xe("StructArrayLayout8i15ui1ul2f2ui64",De);class $e extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.float32[1*t+0]=s,t}}$e.prototype.bytesPerElement=4,Xe("StructArrayLayout1f4",$e);class Ke extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,l){const p=this.length;return this.resize(p+1),this.emplace(p,t,s,l)}emplace(t,s,l,p){const y=3*t;return this.uint16[6*t+0]=s,this.float32[y+1]=l,this.float32[y+2]=p,t}}Ke.prototype.bytesPerElement=12,Xe("StructArrayLayout1ui2f12",Ke);class Oe extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s,l){const p=this.length;return this.resize(p+1),this.emplace(p,t,s,l)}emplace(t,s,l,p){const y=4*t;return this.uint32[2*t+0]=s,this.uint16[y+2]=l,this.uint16[y+3]=p,t}}Oe.prototype.bytesPerElement=8,Xe("StructArrayLayout1ul2ui8",Oe);class Fe extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,s)}emplace(t,s,l){const p=2*t;return this.uint16[p+0]=s,this.uint16[p+1]=l,t}}Fe.prototype.bytesPerElement=4,Xe("StructArrayLayout2ui4",Fe);class et extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const s=this.length;return this.resize(s+1),this.emplace(s,t)}emplace(t,s){return this.uint16[1*t+0]=s,t}}et.prototype.bytesPerElement=2,Xe("StructArrayLayout1ui2",et);class gt extends f{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,s,l,p){const y=this.length;return this.resize(y+1),this.emplace(y,t,s,l,p)}emplace(t,s,l,p,y){const _=4*t;return this.float32[_+0]=s,this.float32[_+1]=l,this.float32[_+2]=p,this.float32[_+3]=y,t}}gt.prototype.bytesPerElement=16,Xe("StructArrayLayout4f16",gt);class je extends d{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new j(this.anchorPointX,this.anchorPointY)}}je.prototype.size=20;class Ze extends se{get(t){return new je(this,t)}}Xe("CollisionBoxArray",Ze);class ft extends d{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ft.prototype.size=48;class tr extends Me{get(t){return new ft(this,t)}}Xe("PlacedSymbolArray",tr);class wt extends d{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}wt.prototype.size=64;class Pt extends De{get(t){return new wt(this,t)}}Xe("SymbolInstanceArray",Pt);class rr extends $e{getoffsetX(t){return this.float32[1*t+0]}}Xe("GlyphOffsetArray",rr);class Hr extends P{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Xe("SymbolLineVertexArray",Hr);class di extends d{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}di.prototype.size=12;class nr extends Ke{get(t){return new di(this,t)}}Xe("TextAnchorOffsetArray",nr);class yn extends d{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}yn.prototype.size=8;class sn extends Oe{get(t){return new yn(this,t)}}Xe("FeatureIndexArray",sn);class Kr extends T{}class an extends T{}class Ri extends T{}class Da extends z{}class Wl extends N{}class La extends Z{}class Kn extends H{}class Xl extends J{}class Vc extends re{}class Wn extends ne{}class Xn extends W{}class ps extends pe{}class pi extends ye{}class jr extends Fe{}const Wr=b([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ln}=Wr;class Mt{constructor(t=[]){this.segments=t}prepareSegment(t,s,l,p){let y=this.segments[this.segments.length-1];return t>Mt.MAX_VERTEX_ARRAY_LENGTH&&Tt(`Max vertices per segment is ${Mt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!y||y.vertexLength+t>Mt.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==p)&&(y={vertexOffset:s.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0},p!==void 0&&(y.sortKey=p),this.segments.push(y)),y}get(){return this.segments}destroy(){for(const t of this.segments)for(const s in t.vaos)t.vaos[s].destroy()}static simpleSegment(t,s,l,p){return new Mt([{vertexOffset:t,primitiveOffset:s,vertexLength:l,primitiveLength:p,vaos:{},sortKey:0}])}}function Us(i,t){return 256*(i=Se(Math.floor(i),0,255))+Se(Math.floor(t),0,255)}Mt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Xe("SegmentVector",Mt);const Ra=b([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Ba={exports:{}},Xd={exports:{}};Xd.exports=function(i,t){var s,l,p,y,_,w,S,I;for(l=i.length-(s=3&i.length),p=t,_=3432918353,w=461845907,I=0;I<l;)S=255&i.charCodeAt(I)|(255&i.charCodeAt(++I))<<8|(255&i.charCodeAt(++I))<<16|(255&i.charCodeAt(++I))<<24,++I,p=27492+(65535&(y=5*(65535&(p=(p^=S=(65535&(S=(S=(65535&S)*_+(((S>>>16)*_&65535)<<16)&4294967295)<<15|S>>>17))*w+(((S>>>16)*w&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(S=0,s){case 3:S^=(255&i.charCodeAt(I+2))<<16;case 2:S^=(255&i.charCodeAt(I+1))<<8;case 1:p^=S=(65535&(S=(S=(65535&(S^=255&i.charCodeAt(I)))*_+(((S>>>16)*_&65535)<<16)&4294967295)<<15|S>>>17))*w+(((S>>>16)*w&65535)<<16)&4294967295}return p^=i.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0};var Rm=Xd.exports,Yd={exports:{}};Yd.exports=function(i,t){for(var s,l=i.length,p=t^l,y=0;l>=4;)s=1540483477*(65535&(s=255&i.charCodeAt(y)|(255&i.charCodeAt(++y))<<8|(255&i.charCodeAt(++y))<<16|(255&i.charCodeAt(++y))<<24))+((1540483477*(s>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),l-=4,++y;switch(l){case 3:p^=(255&i.charCodeAt(y+2))<<16;case 2:p^=(255&i.charCodeAt(y+1))<<8;case 1:p=1540483477*(65535&(p^=255&i.charCodeAt(y)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0};var fs=Rm,Jd=Yd.exports;Ba.exports=fs,Ba.exports.murmur3=fs,Ba.exports.murmur2=Jd;var Yl=C(Ba.exports);class Uo{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,s,l,p){this.ids.push(Jl(t)),this.positions.push(s,l,p)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const s=Jl(t);let l=0,p=this.ids.length-1;for(;l<p;){const _=l+p>>1;this.ids[_]>=s?p=_:l=_+1}const y=[];for(;this.ids[l]===s;)y.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return y}static serialize(t,s){const l=new Float64Array(t.ids),p=new Uint32Array(t.positions);return Ql(l,p,0,l.length-1),s&&s.push(l.buffer,p.buffer),{ids:l,positions:p}}static deserialize(t){const s=new Uo;return s.ids=t.ids,s.positions=t.positions,s.indexed=!0,s}}function Jl(i){const t=+i;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Yl(String(i))}function Ql(i,t,s,l){for(;s<l;){const p=i[s+l>>1];let y=s-1,_=l+1;for(;;){do y++;while(i[y]<p);do _--;while(i[_]>p);if(y>=_)break;Fa(i,y,_),Fa(t,3*y,3*_),Fa(t,3*y+1,3*_+1),Fa(t,3*y+2,3*_+2)}_-s<l-_?(Ql(i,t,s,_),s=_+1):(Ql(i,t,_+1,l),l=_)}}function Fa(i,t,s){const l=i[t];i[t]=i[s],i[s]=l}Xe("FeaturePositionMap",Uo);class $o{constructor(t,s){this.gl=t.gl,this.location=s}}class Qd extends $o{constructor(t,s){super(t,s),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Av extends $o{constructor(t,s){super(t,s),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class zv extends $o{constructor(t,s){super(t,s),this.current=qt.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const N2=new Float32Array(16);function Bm(i){return[Us(255*i.r,255*i.g),Us(255*i.b,255*i.a)]}class Uc{constructor(t,s,l){this.value=t,this.uniformNames=s.map(p=>`u_${p}`),this.type=l}setUniform(t,s,l){t.set(l.constantOr(this.value))}getBinding(t,s,l){return this.type==="color"?new zv(t,s):new Qd(t,s)}}class eu{constructor(t,s){this.uniformNames=s.map(l=>`u_${l}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=t.tlbr}setUniform(t,s,l,p){const y=p==="u_pattern_to"?this.patternTo:p==="u_pattern_from"?this.patternFrom:p==="u_pixel_ratio_to"?this.pixelRatioTo:p==="u_pixel_ratio_from"?this.pixelRatioFrom:null;y&&t.set(y)}getBinding(t,s,l){return l.substr(0,9)==="u_pattern"?new Av(t,s):new Qd(t,s)}}class $s{constructor(t,s,l,p){this.expression=t,this.type=l,this.maxValue=0,this.paintVertexAttributes=s.map(y=>({name:`a_${y}`,type:"Float32",components:l==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(t,s,l,p,y){const _=this.paintVertexArray.length,w=this.expression.evaluate(new er(0),s,{},p,[],y);this.paintVertexArray.resize(t),this._setPaintValue(_,t,w)}updatePaintArray(t,s,l,p){const y=this.expression.evaluate({zoom:0},l,p);this._setPaintValue(t,s,y)}_setPaintValue(t,s,l){if(this.type==="color"){const p=Bm(l);for(let y=t;y<s;y++)this.paintVertexArray.emplace(y,p[0],p[1])}else{for(let p=t;p<s;p++)this.paintVertexArray.emplace(p,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Wi{constructor(t,s,l,p,y,_){this.expression=t,this.uniformNames=s.map(w=>`u_${w}_t`),this.type=l,this.useIntegerZoom=p,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=s.map(w=>({name:`a_${w}`,type:"Float32",components:l==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(t,s,l,p,y){const _=this.expression.evaluate(new er(this.zoom),s,{},p,[],y),w=this.expression.evaluate(new er(this.zoom+1),s,{},p,[],y),S=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(S,t,_,w)}updatePaintArray(t,s,l,p){const y=this.expression.evaluate({zoom:this.zoom},l,p),_=this.expression.evaluate({zoom:this.zoom+1},l,p);this._setPaintValue(t,s,y,_)}_setPaintValue(t,s,l,p){if(this.type==="color"){const y=Bm(l),_=Bm(p);for(let w=t;w<s;w++)this.paintVertexArray.emplace(w,y[0],y[1],_[0],_[1])}else{for(let y=t;y<s;y++)this.paintVertexArray.emplace(y,l,p);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(p))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,s){const l=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,p=Se(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);t.set(p)}getBinding(t,s,l){return new Qd(t,s)}}class Oa{constructor(t,s,l,p,y,_){this.expression=t,this.type=s,this.useIntegerZoom=l,this.zoom=p,this.layerId=_,this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y}populatePaintArray(t,s,l){const p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(p,t,s.patterns&&s.patterns[this.layerId],l)}updatePaintArray(t,s,l,p,y){this._setPaintValues(t,s,l.patterns&&l.patterns[this.layerId],y)}_setPaintValues(t,s,l,p){if(!p||!l)return;const{min:y,mid:_,max:w}=l,S=p[y],I=p[_],E=p[w];if(S&&I&&E)for(let M=t;M<s;M++)this.zoomInPaintVertexArray.emplace(M,I.tl[0],I.tl[1],I.br[0],I.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],I.pixelRatio,S.pixelRatio),this.zoomOutPaintVertexArray.emplace(M,I.tl[0],I.tl[1],I.br[0],I.br[1],E.tl[0],E.tl[1],E.br[0],E.br[1],I.pixelRatio,E.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Ra.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Ra.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Dv{constructor(t,s,l){this.binders={},this._buffers=[];const p=[];for(const y in t.paint._values){if(!l(y))continue;const _=t.paint.get(y);if(!(_ instanceof Li&&wa(_.property.specification)))continue;const w=j2(y,t.type),S=_.value,I=_.property.specification.type,E=_.property.useIntegerZoom,M=_.property.specification["property-type"],D=M==="cross-faded"||M==="cross-faded-data-driven";if(S.kind==="constant")this.binders[y]=D?new eu(S.value,w):new Uc(S.value,w,I),p.push(`/u_${y}`);else if(S.kind==="source"||D){const F=Lv(y,I,"source");this.binders[y]=D?new Oa(S,I,E,s,F,t.id):new $s(S,w,I,F),p.push(`/a_${y}`)}else{const F=Lv(y,I,"composite");this.binders[y]=new Wi(S,w,I,E,s,F),p.push(`/z_${y}`)}}this.cacheKey=p.sort().join("")}getMaxValue(t){const s=this.binders[t];return s instanceof $s||s instanceof Wi?s.maxValue:0}populatePaintArrays(t,s,l,p,y){for(const _ in this.binders){const w=this.binders[_];(w instanceof $s||w instanceof Wi||w instanceof Oa)&&w.populatePaintArray(t,s,l,p,y)}}setConstantPatternPositions(t,s){for(const l in this.binders){const p=this.binders[l];p instanceof eu&&p.setConstantPatternPositions(t,s)}}updatePaintArrays(t,s,l,p,y){let _=!1;for(const w in t){const S=s.getPositions(w);for(const I of S){const E=l.feature(I.index);for(const M in this.binders){const D=this.binders[M];if((D instanceof $s||D instanceof Wi||D instanceof Oa)&&D.expression.isStateDependent===!0){const F=p.paint.get(M);D.expression=F.value,D.updatePaintArray(I.start,I.end,E,t[w],y),_=!0}}}}return _}defines(){const t=[];for(const s in this.binders){const l=this.binders[s];(l instanceof Uc||l instanceof eu)&&t.push(...l.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return t}getBinderAttributes(){const t=[];for(const s in this.binders){const l=this.binders[s];if(l instanceof $s||l instanceof Wi)for(let p=0;p<l.paintVertexAttributes.length;p++)t.push(l.paintVertexAttributes[p].name);else if(l instanceof Oa)for(let p=0;p<Ra.members.length;p++)t.push(Ra.members[p].name)}return t}getBinderUniforms(){const t=[];for(const s in this.binders){const l=this.binders[s];if(l instanceof Uc||l instanceof eu||l instanceof Wi)for(const p of l.uniformNames)t.push(p)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,s){const l=[];for(const p in this.binders){const y=this.binders[p];if(y instanceof Uc||y instanceof eu||y instanceof Wi){for(const _ of y.uniformNames)if(s[_]){const w=y.getBinding(t,s[_],_);l.push({name:_,property:p,binding:w})}}}return l}setUniforms(t,s,l,p){for(const{name:y,property:_,binding:w}of s)this.binders[_].setUniform(w,p,l.get(_),y)}updatePaintBuffers(t){this._buffers=[];for(const s in this.binders){const l=this.binders[s];if(t&&l instanceof Oa){const p=t.fromScale===2?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(l instanceof $s||l instanceof Wi)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(t){for(const s in this.binders){const l=this.binders[s];(l instanceof $s||l instanceof Wi||l instanceof Oa)&&l.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const s=this.binders[t];(s instanceof $s||s instanceof Wi||s instanceof Oa)&&s.destroy()}}}class qo{constructor(t,s,l=()=>!0){this.programConfigurations={};for(const p of t)this.programConfigurations[p.id]=new Dv(p,s,l);this.needsUpload=!1,this._featureMap=new Uo,this._bufferOffset=0}populatePaintArrays(t,s,l,p,y,_){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(t,s,p,y,_);s.id!==void 0&&this._featureMap.add(s.id,l,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,s,l,p){for(const y of l)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(t,this._featureMap,s,y,p)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function j2(i,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${t}-`,"").replace(/-/g,"_")]}function Lv(i,t,s){const l={color:{source:Z,composite:gt},number:{source:$e,composite:Z}},p=function(y){return{"line-pattern":{source:Kn,composite:Kn},"fill-pattern":{source:Kn,composite:Kn},"fill-extrusion-pattern":{source:Kn,composite:Kn}}[y]}(i);return p&&p[s]||l[t][s]}Xe("ConstantBinder",Uc),Xe("CrossFadedConstantBinder",eu),Xe("SourceExpressionBinder",$s),Xe("CrossFadedCompositeBinder",Oa),Xe("CompositeExpressionBinder",Wi),Xe("ProgramConfiguration",Dv,{omit:["_buffers"]}),Xe("ProgramConfigurationSet",qo);const Pr=8192,Fm=Math.pow(2,14)-1,Rv=-Fm-1;function Zo(i){const t=Pr/i.extent,s=i.loadGeometry();for(let l=0;l<s.length;l++){const p=s[l];for(let y=0;y<p.length;y++){const _=p[y],w=Math.round(_.x*t),S=Math.round(_.y*t);_.x=Se(w,Rv,Fm),_.y=Se(S,Rv,Fm),(w<_.x||w>_.x+1||S<_.y||S>_.y+1)&&Tt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return s}function Go(i,t){return{type:i.type,id:i.id,properties:i.properties,geometry:t?Zo(i):[]}}function ep(i,t,s,l,p){i.emplaceBack(2*t+(l+1)/2,2*s+(p+1)/2)}class Om{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new an,this.indexArray=new pi,this.segments=new Mt,this.programConfigurations=new qo(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,l){const p=this.layers[0],y=[];let _=null,w=!1;p.type==="circle"&&(_=p.layout.get("circle-sort-key"),w=!_.isConstant());for(const{feature:S,id:I,index:E,sourceLayerIndex:M}of t){const D=this.layers[0]._featureFilter.needGeometry,F=Go(S,D);if(!this.layers[0]._featureFilter.filter(new er(this.zoom),F,l))continue;const V=w?_.evaluate(F,{},l):void 0,$={id:I,properties:S.properties,type:S.type,sourceLayerIndex:M,index:E,geometry:D?F.geometry:Zo(S),patterns:{},sortKey:V};y.push($)}w&&y.sort((S,I)=>S.sortKey-I.sortKey);for(const S of y){const{geometry:I,index:E,sourceLayerIndex:M}=S,D=t[E].feature;this.addFeature(S,I,E,l),s.featureIndex.insert(D,I,E,M,this.index)}}update(t,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ln),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,s,l,p){for(const y of s)for(const _ of y){const w=_.x,S=_.y;if(w<0||w>=Pr||S<0||S>=Pr)continue;const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),E=I.vertexLength;ep(this.layoutVertexArray,w,S,-1,-1),ep(this.layoutVertexArray,w,S,1,-1),ep(this.layoutVertexArray,w,S,1,1),ep(this.layoutVertexArray,w,S,-1,1),this.indexArray.emplaceBack(E,E+1,E+2),this.indexArray.emplaceBack(E,E+3,E+2),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,{},p)}}function Bv(i,t){for(let s=0;s<i.length;s++)if(tu(t,i[s]))return!0;for(let s=0;s<t.length;s++)if(tu(i,t[s]))return!0;return!!Nm(i,t)}function V2(i,t,s){return!!tu(i,t)||!!jm(t,i,s)}function Fv(i,t){if(i.length===1)return Nv(t,i[0]);for(let s=0;s<t.length;s++){const l=t[s];for(let p=0;p<l.length;p++)if(tu(i,l[p]))return!0}for(let s=0;s<i.length;s++)if(Nv(t,i[s]))return!0;for(let s=0;s<t.length;s++)if(Nm(i,t[s]))return!0;return!1}function U2(i,t,s){if(i.length>1){if(Nm(i,t))return!0;for(let l=0;l<t.length;l++)if(jm(t[l],i,s))return!0}for(let l=0;l<i.length;l++)if(jm(i[l],t,s))return!0;return!1}function Nm(i,t){if(i.length===0||t.length===0)return!1;for(let s=0;s<i.length-1;s++){const l=i[s],p=i[s+1];for(let y=0;y<t.length-1;y++)if($2(l,p,t[y],t[y+1]))return!0}return!1}function $2(i,t,s,l){return bt(i,s,l)!==bt(t,s,l)&&bt(i,t,s)!==bt(i,t,l)}function jm(i,t,s){const l=s*s;if(t.length===1)return i.distSqr(t[0])<l;for(let p=1;p<t.length;p++)if(Ov(i,t[p-1],t[p])<l)return!0;return!1}function Ov(i,t,s){const l=t.distSqr(s);if(l===0)return i.distSqr(t);const p=((i.x-t.x)*(s.x-t.x)+(i.y-t.y)*(s.y-t.y))/l;return i.distSqr(p<0?t:p>1?s:s.sub(t)._mult(p)._add(t))}function Nv(i,t){let s,l,p,y=!1;for(let _=0;_<i.length;_++){s=i[_];for(let w=0,S=s.length-1;w<s.length;S=w++)l=s[w],p=s[S],l.y>t.y!=p.y>t.y&&t.x<(p.x-l.x)*(t.y-l.y)/(p.y-l.y)+l.x&&(y=!y)}return y}function tu(i,t){let s=!1;for(let l=0,p=i.length-1;l<i.length;p=l++){const y=i[l],_=i[p];y.y>t.y!=_.y>t.y&&t.x<(_.x-y.x)*(t.y-y.y)/(_.y-y.y)+y.x&&(s=!s)}return s}function q2(i,t,s){const l=s[0],p=s[2];if(i.x<l.x&&t.x<l.x||i.x>p.x&&t.x>p.x||i.y<l.y&&t.y<l.y||i.y>p.y&&t.y>p.y)return!1;const y=bt(i,t,s[0]);return y!==bt(i,t,s[1])||y!==bt(i,t,s[2])||y!==bt(i,t,s[3])}function $c(i,t,s){const l=t.paint.get(i).value;return l.kind==="constant"?l.value:s.programConfigurations.get(t.id).getMaxValue(i)}function tp(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function rp(i,t,s,l,p){if(!t[0]&&!t[1])return i;const y=j.convert(t)._mult(p);s==="viewport"&&y._rotate(-l);const _=[];for(let w=0;w<i.length;w++)_.push(i[w].sub(y));return _}let jv,Vv;Xe("CircleBucket",Om,{omit:["layers"]});var Z2={get paint(){return Vv=Vv||new m({"circle-radius":new ct(we.paint_circle["circle-radius"]),"circle-color":new ct(we.paint_circle["circle-color"]),"circle-blur":new ct(we.paint_circle["circle-blur"]),"circle-opacity":new ct(we.paint_circle["circle-opacity"]),"circle-translate":new Qe(we.paint_circle["circle-translate"]),"circle-translate-anchor":new Qe(we.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Qe(we.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Qe(we.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ct(we.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ct(we.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ct(we.paint_circle["circle-stroke-opacity"])})},get layout(){return jv=jv||new m({"circle-sort-key":new ct(we.layout_circle["circle-sort-key"])})}},_n=1e-6,ru=typeof Float32Array<"u"?Float32Array:Array;function Vm(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Uv(i,t,s){var l=t[0],p=t[1],y=t[2],_=t[3],w=t[4],S=t[5],I=t[6],E=t[7],M=t[8],D=t[9],F=t[10],V=t[11],$=t[12],X=t[13],te=t[14],ge=t[15],ae=s[0],fe=s[1],be=s[2],ze=s[3];return i[0]=ae*l+fe*w+be*M+ze*$,i[1]=ae*p+fe*S+be*D+ze*X,i[2]=ae*y+fe*I+be*F+ze*te,i[3]=ae*_+fe*E+be*V+ze*ge,i[4]=(ae=s[4])*l+(fe=s[5])*w+(be=s[6])*M+(ze=s[7])*$,i[5]=ae*p+fe*S+be*D+ze*X,i[6]=ae*y+fe*I+be*F+ze*te,i[7]=ae*_+fe*E+be*V+ze*ge,i[8]=(ae=s[8])*l+(fe=s[9])*w+(be=s[10])*M+(ze=s[11])*$,i[9]=ae*p+fe*S+be*D+ze*X,i[10]=ae*y+fe*I+be*F+ze*te,i[11]=ae*_+fe*E+be*V+ze*ge,i[12]=(ae=s[12])*l+(fe=s[13])*w+(be=s[14])*M+(ze=s[15])*$,i[13]=ae*p+fe*S+be*D+ze*X,i[14]=ae*y+fe*I+be*F+ze*te,i[15]=ae*_+fe*E+be*V+ze*ge,i}Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});var qc,G2=Uv;function np(i,t,s){var l=t[0],p=t[1],y=t[2],_=t[3];return i[0]=s[0]*l+s[4]*p+s[8]*y+s[12]*_,i[1]=s[1]*l+s[5]*p+s[9]*y+s[13]*_,i[2]=s[2]*l+s[6]*p+s[10]*y+s[14]*_,i[3]=s[3]*l+s[7]*p+s[11]*y+s[15]*_,i}qc=new ru(4),ru!=Float32Array&&(qc[0]=0,qc[1]=0,qc[2]=0,qc[3]=0);class H2 extends a{constructor(t){super(t,Z2)}createBucket(t){return new Om(t)}queryRadius(t){const s=t;return $c("circle-radius",this,s)+$c("circle-stroke-width",this,s)+tp(this.paint.get("circle-translate"))}queryIntersectsFeature(t,s,l,p,y,_,w,S){const I=rp(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),_.angle,w),E=this.paint.get("circle-radius").evaluate(s,l)+this.paint.get("circle-stroke-width").evaluate(s,l),M=this.paint.get("circle-pitch-alignment")==="map",D=M?I:function(V,$){return V.map(X=>$v(X,$))}(I,S),F=M?E*w:E;for(const V of p)for(const $ of V){const X=M?$:$v($,S);let te=F;const ge=np([],[$.x,$.y,0,1],S);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?te*=ge[3]/_.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(te*=_.cameraToCenterDistance/ge[3]),V2(D,X,te))return!0}return!1}}function $v(i,t){const s=np([],[i.x,i.y,0,1],t);return new j(s[0]/s[3],s[1]/s[3])}class qv extends Om{}let Zv;Xe("HeatmapBucket",qv,{omit:["layers"]});var K2={get paint(){return Zv=Zv||new m({"heatmap-radius":new ct(we.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ct(we.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Qe(we.paint_heatmap["heatmap-intensity"]),"heatmap-color":new jc(we.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Qe(we.paint_heatmap["heatmap-opacity"])})}};function Um(i,{width:t,height:s},l,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==t*s*l)throw new RangeError(`mismatched image size. expected: ${p.length} but got: ${t*s*l}`)}else p=new Uint8Array(t*s*l);return i.width=t,i.height=s,i.data=p,i}function Gv(i,{width:t,height:s},l){if(t===i.width&&s===i.height)return;const p=Um({},{width:t,height:s},l);$m(i,p,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,t),height:Math.min(i.height,s)},l),i.width=t,i.height=s,i.data=p.data}function $m(i,t,s,l,p,y){if(p.width===0||p.height===0)return t;if(p.width>i.width||p.height>i.height||s.x>i.width-p.width||s.y>i.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>t.width||p.height>t.height||l.x>t.width-p.width||l.y>t.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const _=i.data,w=t.data;if(_===w)throw new Error("srcData equals dstData, so image is already copied");for(let S=0;S<p.height;S++){const I=((s.y+S)*i.width+s.x)*y,E=((l.y+S)*t.width+l.x)*y;for(let M=0;M<p.width*y;M++)w[E+M]=_[I+M]}return t}class Zc{constructor(t,s){Um(this,t,1,s)}resize(t){Gv(this,t,1)}clone(){return new Zc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,l,p,y){$m(t,s,l,p,y,1)}}class fi{constructor(t,s){Um(this,t,4,s)}resize(t){Gv(this,t,4)}replace(t,s){s?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new fi({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,s,l,p,y){$m(t,s,l,p,y,4)}}function Hv(i){const t={},s=i.resolution||256,l=i.clips?i.clips.length:1,p=i.image||new fi({width:s,height:l});if(Math.log(s)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${s}`);const y=(_,w,S)=>{t[i.evaluationKey]=S;const I=i.expression.evaluate(t);p.data[_+w+0]=Math.floor(255*I.r/I.a),p.data[_+w+1]=Math.floor(255*I.g/I.a),p.data[_+w+2]=Math.floor(255*I.b/I.a),p.data[_+w+3]=Math.floor(255*I.a)};if(i.clips)for(let _=0,w=0;_<l;++_,w+=4*s)for(let S=0,I=0;S<s;S++,I+=4){const E=S/(s-1),{start:M,end:D}=i.clips[_];y(w,I,M*(1-E)+D*E)}else for(let _=0,w=0;_<s;_++,w+=4)y(0,w,_/(s-1));return p}Xe("AlphaImage",Zc),Xe("RGBAImage",fi);const qm="big-fb";class W2 extends a{createBucket(t){return new qv(t)}constructor(t){super(t,K2),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Hv({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(qm)&&this.heatmapFbos.delete(qm)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Kv;var X2={get paint(){return Kv=Kv||new m({"hillshade-illumination-direction":new Qe(we.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Qe(we.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Qe(we.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Qe(we.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Qe(we.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Qe(we.paint_hillshade["hillshade-accent-color"])})}};class Y2 extends a{constructor(t){super(t,X2)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const J2=b([{name:"a_pos",components:2,type:"Int16"}],4),{members:Q2}=J2;function Wv(i,t,s=2){const l=t&&t.length,p=l?t[0]*s:i.length;let y=Xv(i,0,p,s,!0);const _=[];if(!y||y.next===y.prev)return _;let w,S,I;if(l&&(y=function(E,M,D,F){const V=[];for(let $=0,X=M.length;$<X;$++){const te=Xv(E,M[$]*F,$<X-1?M[$+1]*F:E.length,F,!1);te===te.next&&(te.steiner=!0),V.push(oS(te))}V.sort(iS);for(let $=0;$<V.length;$++)D=sS(V[$],D);return D}(i,t,y,s)),i.length>80*s){w=1/0,S=1/0;let E=-1/0,M=-1/0;for(let D=s;D<p;D+=s){const F=i[D],V=i[D+1];F<w&&(w=F),V<S&&(S=V),F>E&&(E=F),V>M&&(M=V)}I=Math.max(E-w,M-S),I=I!==0?32767/I:0}return Gc(y,_,s,w,S,I,0),_}function Xv(i,t,s,l,p){let y;if(p===function(_,w,S,I){let E=0;for(let M=w,D=S-I;M<S;M+=I)E+=(_[D]-_[M])*(_[M+1]+_[D+1]),D=M;return E}(i,t,s,l)>0)for(let _=t;_<s;_+=l)y=Qv(_/l|0,i[_],i[_+1],y);else for(let _=s-l;_>=t;_-=l)y=Qv(_/l|0,i[_],i[_+1],y);return y&&ip(y,y.next)&&(Kc(y),y=y.next),y}function Ho(i,t){if(!i)return i;t||(t=i);let s,l=i;do if(s=!1,l.steiner||!ip(l,l.next)&&wr(l.prev,l,l.next)!==0)l=l.next;else{if(Kc(l),l=t=l.prev,l===l.next)break;s=!0}while(s||l!==t);return t}function Gc(i,t,s,l,p,y,_){if(!i)return;!_&&y&&function(S,I,E,M){let D=S;do D.z===0&&(D.z=Zm(D.x,D.y,I,E,M)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==S);D.prevZ.nextZ=null,D.prevZ=null,function(F){let V,$=1;do{let X,te=F;F=null;let ge=null;for(V=0;te;){V++;let ae=te,fe=0;for(let ze=0;ze<$&&(fe++,ae=ae.nextZ,ae);ze++);let be=$;for(;fe>0||be>0&&ae;)fe!==0&&(be===0||!ae||te.z<=ae.z)?(X=te,te=te.nextZ,fe--):(X=ae,ae=ae.nextZ,be--),ge?ge.nextZ=X:F=X,X.prevZ=ge,ge=X;te=ae}ge.nextZ=null,$*=2}while(V>1)}(D)}(i,l,p,y);let w=i;for(;i.prev!==i.next;){const S=i.prev,I=i.next;if(y?tS(i,l,p,y):eS(i))t.push(S.i,i.i,I.i),Kc(i),i=I.next,w=I.next;else if((i=I)===w){_?_===1?Gc(i=rS(Ho(i),t),t,s,l,p,y,2):_===2&&nS(i,t,s,l,p,y):Gc(Ho(i),t,s,l,p,y,1);break}}}function eS(i){const t=i.prev,s=i,l=i.next;if(wr(t,s,l)>=0)return!1;const p=t.x,y=s.x,_=l.x,w=t.y,S=s.y,I=l.y,E=p<y?p<_?p:_:y<_?y:_,M=w<S?w<I?w:I:S<I?S:I,D=p>y?p>_?p:_:y>_?y:_,F=w>S?w>I?w:I:S>I?S:I;let V=l.next;for(;V!==t;){if(V.x>=E&&V.x<=D&&V.y>=M&&V.y<=F&&nu(p,w,y,S,_,I,V.x,V.y)&&wr(V.prev,V,V.next)>=0)return!1;V=V.next}return!0}function tS(i,t,s,l){const p=i.prev,y=i,_=i.next;if(wr(p,y,_)>=0)return!1;const w=p.x,S=y.x,I=_.x,E=p.y,M=y.y,D=_.y,F=w<S?w<I?w:I:S<I?S:I,V=E<M?E<D?E:D:M<D?M:D,$=w>S?w>I?w:I:S>I?S:I,X=E>M?E>D?E:D:M>D?M:D,te=Zm(F,V,t,s,l),ge=Zm($,X,t,s,l);let ae=i.prevZ,fe=i.nextZ;for(;ae&&ae.z>=te&&fe&&fe.z<=ge;){if(ae.x>=F&&ae.x<=$&&ae.y>=V&&ae.y<=X&&ae!==p&&ae!==_&&nu(w,E,S,M,I,D,ae.x,ae.y)&&wr(ae.prev,ae,ae.next)>=0||(ae=ae.prevZ,fe.x>=F&&fe.x<=$&&fe.y>=V&&fe.y<=X&&fe!==p&&fe!==_&&nu(w,E,S,M,I,D,fe.x,fe.y)&&wr(fe.prev,fe,fe.next)>=0))return!1;fe=fe.nextZ}for(;ae&&ae.z>=te;){if(ae.x>=F&&ae.x<=$&&ae.y>=V&&ae.y<=X&&ae!==p&&ae!==_&&nu(w,E,S,M,I,D,ae.x,ae.y)&&wr(ae.prev,ae,ae.next)>=0)return!1;ae=ae.prevZ}for(;fe&&fe.z<=ge;){if(fe.x>=F&&fe.x<=$&&fe.y>=V&&fe.y<=X&&fe!==p&&fe!==_&&nu(w,E,S,M,I,D,fe.x,fe.y)&&wr(fe.prev,fe,fe.next)>=0)return!1;fe=fe.nextZ}return!0}function rS(i,t){let s=i;do{const l=s.prev,p=s.next.next;!ip(l,p)&&Yv(l,s,s.next,p)&&Hc(l,p)&&Hc(p,l)&&(t.push(l.i,s.i,p.i),Kc(s),Kc(s.next),s=i=p),s=s.next}while(s!==i);return Ho(s)}function nS(i,t,s,l,p,y){let _=i;do{let w=_.next.next;for(;w!==_.prev;){if(_.i!==w.i&&lS(_,w)){let S=Jv(_,w);return _=Ho(_,_.next),S=Ho(S,S.next),Gc(_,t,s,l,p,y,0),void Gc(S,t,s,l,p,y,0)}w=w.next}_=_.next}while(_!==i)}function iS(i,t){return i.x-t.x}function sS(i,t){const s=function(p,y){let _=y;const w=p.x,S=p.y;let I,E=-1/0;do{if(S<=_.y&&S>=_.next.y&&_.next.y!==_.y){const $=_.x+(S-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if($<=w&&$>E&&(E=$,I=_.x<_.next.x?_:_.next,$===w))return I}_=_.next}while(_!==y);if(!I)return null;const M=I,D=I.x,F=I.y;let V=1/0;_=I;do{if(w>=_.x&&_.x>=D&&w!==_.x&&nu(S<F?w:E,S,D,F,S<F?E:w,S,_.x,_.y)){const $=Math.abs(S-_.y)/(w-_.x);Hc(_,p)&&($<V||$===V&&(_.x>I.x||_.x===I.x&&aS(I,_)))&&(I=_,V=$)}_=_.next}while(_!==M);return I}(i,t);if(!s)return t;const l=Jv(s,i);return Ho(l,l.next),Ho(s,s.next)}function aS(i,t){return wr(i.prev,i,t.prev)<0&&wr(t.next,i,i.next)<0}function Zm(i,t,s,l,p){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-s)*p|0)|i<<8))|i<<4))|i<<2))|i<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-l)*p|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function oS(i){let t=i,s=i;do(t.x<s.x||t.x===s.x&&t.y<s.y)&&(s=t),t=t.next;while(t!==i);return s}function nu(i,t,s,l,p,y,_,w){return(p-_)*(t-w)>=(i-_)*(y-w)&&(i-_)*(l-w)>=(s-_)*(t-w)&&(s-_)*(y-w)>=(p-_)*(l-w)}function lS(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!function(s,l){let p=s;do{if(p.i!==s.i&&p.next.i!==s.i&&p.i!==l.i&&p.next.i!==l.i&&Yv(p,p.next,s,l))return!0;p=p.next}while(p!==s);return!1}(i,t)&&(Hc(i,t)&&Hc(t,i)&&function(s,l){let p=s,y=!1;const _=(s.x+l.x)/2,w=(s.y+l.y)/2;do p.y>w!=p.next.y>w&&p.next.y!==p.y&&_<(p.next.x-p.x)*(w-p.y)/(p.next.y-p.y)+p.x&&(y=!y),p=p.next;while(p!==s);return y}(i,t)&&(wr(i.prev,i,t.prev)||wr(i,t.prev,t))||ip(i,t)&&wr(i.prev,i,i.next)>0&&wr(t.prev,t,t.next)>0)}function wr(i,t,s){return(t.y-i.y)*(s.x-t.x)-(t.x-i.x)*(s.y-t.y)}function ip(i,t){return i.x===t.x&&i.y===t.y}function Yv(i,t,s,l){const p=ap(wr(i,t,s)),y=ap(wr(i,t,l)),_=ap(wr(s,l,i)),w=ap(wr(s,l,t));return p!==y&&_!==w||!(p!==0||!sp(i,s,t))||!(y!==0||!sp(i,l,t))||!(_!==0||!sp(s,i,l))||!(w!==0||!sp(s,t,l))}function sp(i,t,s){return t.x<=Math.max(i.x,s.x)&&t.x>=Math.min(i.x,s.x)&&t.y<=Math.max(i.y,s.y)&&t.y>=Math.min(i.y,s.y)}function ap(i){return i>0?1:i<0?-1:0}function Hc(i,t){return wr(i.prev,i,i.next)<0?wr(i,t,i.next)>=0&&wr(i,i.prev,t)>=0:wr(i,t,i.prev)<0||wr(i,i.next,t)<0}function Jv(i,t){const s=Gm(i.i,i.x,i.y),l=Gm(t.i,t.x,t.y),p=i.next,y=t.prev;return i.next=t,t.prev=i,s.next=p,p.prev=s,l.next=s,s.prev=l,y.next=l,l.prev=y,l}function Qv(i,t,s,l){const p=Gm(i,t,s);return l?(p.next=l.next,p.prev=l,l.next.prev=p,l.next=p):(p.prev=p,p.next=p),p}function Kc(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Gm(i,t,s){return{i,x:t,y:s,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Hm(i,t,s){const l=s.patternDependencies;let p=!1;for(const y of t){const _=y.paint.get(`${i}-pattern`);_.isConstant()||(p=!0);const w=_.constantOr(null);w&&(p=!0,l[w.to]=!0,l[w.from]=!0)}return p}function Km(i,t,s,l,p){const y=p.patternDependencies;for(const _ of t){const w=_.paint.get(`${i}-pattern`).value;if(w.kind!=="constant"){let S=w.evaluate({zoom:l-1},s,{},p.availableImages),I=w.evaluate({zoom:l},s,{},p.availableImages),E=w.evaluate({zoom:l+1},s,{},p.availableImages);S=S&&S.name?S.name:S,I=I&&I.name?I.name:I,E=E&&E.name?E.name:E,y[S]=!0,y[I]=!0,y[E]=!0,s.patterns[_.id]={min:S,mid:I,max:E}}}return s}class Wm{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ri,this.indexArray=new pi,this.indexArray2=new jr,this.programConfigurations=new qo(t.layers,t.zoom),this.segments=new Mt,this.segments2=new Mt,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,l){this.hasPattern=Hm("fill",this.layers,s);const p=this.layers[0].layout.get("fill-sort-key"),y=!p.isConstant(),_=[];for(const{feature:w,id:S,index:I,sourceLayerIndex:E}of t){const M=this.layers[0]._featureFilter.needGeometry,D=Go(w,M);if(!this.layers[0]._featureFilter.filter(new er(this.zoom),D,l))continue;const F=y?p.evaluate(D,{},l,s.availableImages):void 0,V={id:S,properties:w.properties,type:w.type,sourceLayerIndex:E,index:I,geometry:M?D.geometry:Zo(w),patterns:{},sortKey:F};_.push(V)}y&&_.sort((w,S)=>w.sortKey-S.sortKey);for(const w of _){const{geometry:S,index:I,sourceLayerIndex:E}=w;if(this.hasPattern){const M=Km("fill",this.layers,w,this.zoom,s);this.patternFeatures.push(M)}else this.addFeature(w,S,I,l,{});s.featureIndex.insert(t[I].feature,S,I,E,this.index)}}update(t,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,l)}addFeatures(t,s,l){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,s,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Q2),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,s,l,p,y){for(const _ of El(s,500)){let w=0;for(const F of _)w+=F.length;const S=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),I=S.vertexLength,E=[],M=[];for(const F of _){if(F.length===0)continue;F!==_[0]&&M.push(E.length/2);const V=this.segments2.prepareSegment(F.length,this.layoutVertexArray,this.indexArray2),$=V.vertexLength;this.layoutVertexArray.emplaceBack(F[0].x,F[0].y),this.indexArray2.emplaceBack($+F.length-1,$),E.push(F[0].x),E.push(F[0].y);for(let X=1;X<F.length;X++)this.layoutVertexArray.emplaceBack(F[X].x,F[X].y),this.indexArray2.emplaceBack($+X-1,$+X),E.push(F[X].x),E.push(F[X].y);V.vertexLength+=F.length,V.primitiveLength+=F.length}const D=Wv(E,M);for(let F=0;F<D.length;F+=3)this.indexArray.emplaceBack(I+D[F],I+D[F+1],I+D[F+2]);S.vertexLength+=w,S.primitiveLength+=D.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,y,p)}}let ex,tx;Xe("FillBucket",Wm,{omit:["layers","patternFeatures"]});var uS={get paint(){return tx=tx||new m({"fill-antialias":new Qe(we.paint_fill["fill-antialias"]),"fill-opacity":new ct(we.paint_fill["fill-opacity"]),"fill-color":new ct(we.paint_fill["fill-color"]),"fill-outline-color":new ct(we.paint_fill["fill-outline-color"]),"fill-translate":new Qe(we.paint_fill["fill-translate"]),"fill-translate-anchor":new Qe(we.paint_fill["fill-translate-anchor"]),"fill-pattern":new Hl(we.paint_fill["fill-pattern"])})},get layout(){return ex=ex||new m({"fill-sort-key":new ct(we.layout_fill["fill-sort-key"])})}};class cS extends a{constructor(t){super(t,uS)}recalculate(t,s){super.recalculate(t,s);const l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Wm(t)}queryRadius(){return tp(this.paint.get("fill-translate"))}queryIntersectsFeature(t,s,l,p,y,_,w){return Fv(rp(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),_.angle,w),p)}isTileClipped(){return!0}}const hS=b([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),dS=b([{name:"a_centroid",components:2,type:"Int16"}],4),{members:pS}=hS;var Na={},fS=O,rx=iu;function iu(i,t,s,l,p){this.properties={},this.extent=s,this.type=0,this._pbf=i,this._geometry=-1,this._keys=l,this._values=p,i.readFields(mS,this,t)}function mS(i,t,s){i==1?t.id=s.readVarint():i==2?function(l,p){for(var y=l.readVarint()+l.pos;l.pos<y;){var _=p._keys[l.readVarint()],w=p._values[l.readVarint()];p.properties[_]=w}}(s,t):i==3?t.type=s.readVarint():i==4&&(t._geometry=s.pos)}function gS(i){for(var t,s,l=0,p=0,y=i.length,_=y-1;p<y;_=p++)l+=((s=i[_]).x-(t=i[p]).x)*(t.y+s.y);return l}iu.types=["Unknown","Point","LineString","Polygon"],iu.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var t,s=i.readVarint()+i.pos,l=1,p=0,y=0,_=0,w=[];i.pos<s;){if(p<=0){var S=i.readVarint();l=7&S,p=S>>3}if(p--,l===1||l===2)y+=i.readSVarint(),_+=i.readSVarint(),l===1&&(t&&w.push(t),t=[]),t.push(new fS(y,_));else{if(l!==7)throw new Error("unknown command "+l);t&&t.push(t[0].clone())}}return t&&w.push(t),w},iu.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var t=i.readVarint()+i.pos,s=1,l=0,p=0,y=0,_=1/0,w=-1/0,S=1/0,I=-1/0;i.pos<t;){if(l<=0){var E=i.readVarint();s=7&E,l=E>>3}if(l--,s===1||s===2)(p+=i.readSVarint())<_&&(_=p),p>w&&(w=p),(y+=i.readSVarint())<S&&(S=y),y>I&&(I=y);else if(s!==7)throw new Error("unknown command "+s)}return[_,S,w,I]},iu.prototype.toGeoJSON=function(i,t,s){var l,p,y=this.extent*Math.pow(2,s),_=this.extent*i,w=this.extent*t,S=this.loadGeometry(),I=iu.types[this.type];function E(F){for(var V=0;V<F.length;V++){var $=F[V];F[V]=[360*($.x+_)/y-180,360/Math.PI*Math.atan(Math.exp((180-360*($.y+w)/y)*Math.PI/180))-90]}}switch(this.type){case 1:var M=[];for(l=0;l<S.length;l++)M[l]=S[l][0];E(S=M);break;case 2:for(l=0;l<S.length;l++)E(S[l]);break;case 3:for(S=function(F){var V=F.length;if(V<=1)return[F];for(var $,X,te=[],ge=0;ge<V;ge++){var ae=gS(F[ge]);ae!==0&&(X===void 0&&(X=ae<0),X===ae<0?($&&te.push($),$=[F[ge]]):$.push(F[ge]))}return $&&te.push($),te}(S),l=0;l<S.length;l++)for(p=0;p<S[l].length;p++)E(S[l][p])}S.length===1?S=S[0]:I="Multi"+I;var D={type:"Feature",geometry:{type:I,coordinates:S},properties:this.properties};return"id"in this&&(D.id=this.id),D};var yS=rx,nx=ix;function ix(i,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(_S,this,t),this.length=this._features.length}function _S(i,t,s){i===15?t.version=s.readVarint():i===1?t.name=s.readString():i===5?t.extent=s.readVarint():i===2?t._features.push(s.pos):i===3?t._keys.push(s.readString()):i===4&&t._values.push(function(l){for(var p=null,y=l.readVarint()+l.pos;l.pos<y;){var _=l.readVarint()>>3;p=_===1?l.readString():_===2?l.readFloat():_===3?l.readDouble():_===4?l.readVarint64():_===5?l.readVarint():_===6?l.readSVarint():_===7?l.readBoolean():null}return p}(s))}ix.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var t=this._pbf.readVarint()+this._pbf.pos;return new yS(this._pbf,t,this.extent,this._keys,this._values)};var vS=nx;function xS(i,t,s){if(i===3){var l=new vS(s,s.readVarint()+s.pos);l.length&&(t[l.name]=l)}}Na.VectorTile=function(i,t){this.layers=i.readFields(xS,{},t)},Na.VectorTileFeature=rx,Na.VectorTileLayer=nx;const wS=Na.VectorTileFeature.types,Xm=Math.pow(2,13);function Wc(i,t,s,l,p,y,_,w){i.emplaceBack(t,s,2*Math.floor(l*Xm)+_,p*Xm*2,y*Xm*2,Math.round(w))}class Ym{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Da,this.centroidVertexArray=new Kr,this.indexArray=new pi,this.programConfigurations=new qo(t.layers,t.zoom),this.segments=new Mt,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,l){this.features=[],this.hasPattern=Hm("fill-extrusion",this.layers,s);for(const{feature:p,id:y,index:_,sourceLayerIndex:w}of t){const S=this.layers[0]._featureFilter.needGeometry,I=Go(p,S);if(!this.layers[0]._featureFilter.filter(new er(this.zoom),I,l))continue;const E={id:y,sourceLayerIndex:w,index:_,geometry:S?I.geometry:Zo(p),properties:p.properties,type:p.type,patterns:{}};this.hasPattern?this.features.push(Km("fill-extrusion",this.layers,E,this.zoom,s)):this.addFeature(E,E.geometry,_,l,{}),s.featureIndex.insert(p,E.geometry,_,w,this.index,!0)}}addFeatures(t,s,l){for(const p of this.features){const{geometry:y}=p;this.addFeature(p,y,p.index,s,l)}}update(t,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,l)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,pS),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,dS.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,s,l,p,y){for(const _ of El(s,500)){const w={x:0,y:0,vertexCount:0};let S=0;for(const V of _)S+=V.length;let I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const V of _){if(V.length===0||SS(V))continue;let $=0;for(let X=0;X<V.length;X++){const te=V[X];if(X>=1){const ge=V[X-1];if(!bS(te,ge)){I.vertexLength+4>Mt.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ae=te.sub(ge)._perp()._unit(),fe=ge.dist(te);$+fe>32768&&($=0),Wc(this.layoutVertexArray,te.x,te.y,ae.x,ae.y,0,0,$),Wc(this.layoutVertexArray,te.x,te.y,ae.x,ae.y,0,1,$),w.x+=2*te.x,w.y+=2*te.y,w.vertexCount+=2,$+=fe,Wc(this.layoutVertexArray,ge.x,ge.y,ae.x,ae.y,0,0,$),Wc(this.layoutVertexArray,ge.x,ge.y,ae.x,ae.y,0,1,$),w.x+=2*ge.x,w.y+=2*ge.y,w.vertexCount+=2;const be=I.vertexLength;this.indexArray.emplaceBack(be,be+2,be+1),this.indexArray.emplaceBack(be+1,be+2,be+3),I.vertexLength+=4,I.primitiveLength+=2}}}}if(I.vertexLength+S>Mt.MAX_VERTEX_ARRAY_LENGTH&&(I=this.segments.prepareSegment(S,this.layoutVertexArray,this.indexArray)),wS[t.type]!=="Polygon")continue;const E=[],M=[],D=I.vertexLength;for(const V of _)if(V.length!==0){V!==_[0]&&M.push(E.length/2);for(let $=0;$<V.length;$++){const X=V[$];Wc(this.layoutVertexArray,X.x,X.y,0,0,1,1,0),w.x+=X.x,w.y+=X.y,w.vertexCount+=1,E.push(X.x),E.push(X.y)}}const F=Wv(E,M);for(let V=0;V<F.length;V+=3)this.indexArray.emplaceBack(D+F[V],D+F[V+2],D+F[V+1]);I.primitiveLength+=F.length/3,I.vertexLength+=S;for(let V=0;V<w.vertexCount;V++){const $=Math.floor(w.x/w.vertexCount),X=Math.floor(w.y/w.vertexCount);this.centroidVertexArray.emplaceBack($,X)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,y,p)}}function bS(i,t){return i.x===t.x&&(i.x<0||i.x>Pr)||i.y===t.y&&(i.y<0||i.y>Pr)}function SS(i){return i.every(t=>t.x<0)||i.every(t=>t.x>Pr)||i.every(t=>t.y<0)||i.every(t=>t.y>Pr)}let sx;Xe("FillExtrusionBucket",Ym,{omit:["layers","features"]});var kS={get paint(){return sx=sx||new m({"fill-extrusion-opacity":new Qe(we["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ct(we["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Qe(we["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Qe(we["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Hl(we["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ct(we["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ct(we["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Qe(we["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class TS extends a{constructor(t){super(t,kS)}createBucket(t){return new Ym(t)}queryRadius(){return tp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,s,l,p,y,_,w,S){const I=rp(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),_.angle,w),E=this.paint.get("fill-extrusion-height").evaluate(s,l),M=this.paint.get("fill-extrusion-base").evaluate(s,l),D=function(V,$,X,te){const ge=[];for(const ae of V){const fe=[ae.x,ae.y,0,1];np(fe,fe,$),ge.push(new j(fe[0]/fe[3],fe[1]/fe[3]))}return ge}(I,S),F=function(V,$,X,te){const ge=[],ae=[],fe=te[8]*$,be=te[9]*$,ze=te[10]*$,Ge=te[11]*$,ut=te[8]*X,qe=te[9]*X,Ue=te[10]*X,nt=te[11]*X;for(const Je of V){const We=[],Ee=[];for(const it of Je){const tt=it.x,mt=it.y,Xt=te[0]*tt+te[4]*mt+te[12],Ht=te[1]*tt+te[5]*mt+te[13],Lr=te[2]*tt+te[6]*mt+te[14],Bi=te[3]*tt+te[7]*mt+te[15],Yr=Lr+ze,Rr=Bi+Ge,vn=Xt+ut,xn=Ht+qe,wn=Lr+Ue,gr=Bi+nt,Br=new j((Xt+fe)/Rr,(Ht+be)/Rr);Br.z=Yr/Rr,We.push(Br);const on=new j(vn/gr,xn/gr);on.z=wn/gr,Ee.push(on)}ge.push(We),ae.push(Ee)}return[ge,ae]}(p,M,E,S);return function(V,$,X){let te=1/0;Fv(X,$)&&(te=ax(X,$[0]));for(let ge=0;ge<$.length;ge++){const ae=$[ge],fe=V[ge];for(let be=0;be<ae.length-1;be++){const ze=ae[be],Ge=[ze,ae[be+1],fe[be+1],fe[be],ze];Bv(X,Ge)&&(te=Math.min(te,ax(X,Ge)))}}return te!==1/0&&te}(F[0],F[1],D)}}function Xc(i,t){return i.x*t.x+i.y*t.y}function ax(i,t){if(i.length===1){let s=0;const l=t[s++];let p;for(;!p||l.equals(p);)if(p=t[s++],!p)return 1/0;for(;s<t.length;s++){const y=t[s],_=i[0],w=p.sub(l),S=y.sub(l),I=_.sub(l),E=Xc(w,w),M=Xc(w,S),D=Xc(S,S),F=Xc(I,w),V=Xc(I,S),$=E*D-M*M,X=(D*F-M*V)/$,te=(E*V-M*F)/$,ge=l.z*(1-X-te)+p.z*X+y.z*te;if(isFinite(ge))return ge}return 1/0}{let s=1/0;for(const l of t)s=Math.min(s,l.z);return s}}const IS=b([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:ES}=IS,PS=b([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:CS}=PS,MS=Na.VectorTileFeature.types,AS=Math.cos(Math.PI/180*37.5),ox=Math.pow(2,14)/.5;class Jm{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(s=>s.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new Wl,this.layoutVertexArray2=new La,this.indexArray=new pi,this.programConfigurations=new qo(t.layers,t.zoom),this.segments=new Mt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(t,s,l){this.hasPattern=Hm("line",this.layers,s);const p=this.layers[0].layout.get("line-sort-key"),y=!p.isConstant(),_=[];for(const{feature:w,id:S,index:I,sourceLayerIndex:E}of t){const M=this.layers[0]._featureFilter.needGeometry,D=Go(w,M);if(!this.layers[0]._featureFilter.filter(new er(this.zoom),D,l))continue;const F=y?p.evaluate(D,{},l):void 0,V={id:S,properties:w.properties,type:w.type,sourceLayerIndex:E,index:I,geometry:M?D.geometry:Zo(w),patterns:{},sortKey:F};_.push(V)}y&&_.sort((w,S)=>w.sortKey-S.sortKey);for(const w of _){const{geometry:S,index:I,sourceLayerIndex:E}=w;if(this.hasPattern){const M=Km("line",this.layers,w,this.zoom,s);this.patternFeatures.push(M)}else this.addFeature(w,S,I,l,{});s.featureIndex.insert(t[I].feature,S,I,E,this.index)}}update(t,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,s,this.stateDependentLayers,l)}addFeatures(t,s,l){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,s,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,CS)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ES),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,s,l,p,y){const _=this.layers[0].layout,w=_.get("line-join").evaluate(t,{}),S=_.get("line-cap"),I=_.get("line-miter-limit"),E=_.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const M of s)this.addLine(M,t,w,S,I,E);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,y,p)}addLine(t,s,l,p,y,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let te=0;te<t.length-1;te++)this.totalDistance+=t[te].dist(t[te+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const w=MS[s.type]==="Polygon";let S=t.length;for(;S>=2&&t[S-1].equals(t[S-2]);)S--;let I=0;for(;I<S-1&&t[I].equals(t[I+1]);)I++;if(S<(w?3:2))return;l==="bevel"&&(y=1.05);const E=this.overscaling<=16?15*Pr/(512*this.overscaling):0,M=this.segments.prepareSegment(10*S,this.layoutVertexArray,this.indexArray);let D,F,V,$,X;this.e1=this.e2=-1,w&&(D=t[S-2],X=t[I].sub(D)._unit()._perp());for(let te=I;te<S;te++){if(V=te===S-1?w?t[I+1]:void 0:t[te+1],V&&t[te].equals(V))continue;X&&($=X),D&&(F=D),D=t[te],X=V?V.sub(D)._unit()._perp():$,$=$||X;let ge=$.add(X);ge.x===0&&ge.y===0||ge._unit();const ae=$.x*X.x+$.y*X.y,fe=ge.x*X.x+ge.y*X.y,be=fe!==0?1/fe:1/0,ze=2*Math.sqrt(2-2*fe),Ge=fe<AS&&F&&V,ut=$.x*X.y-$.y*X.x>0;if(Ge&&te>I){const nt=D.dist(F);if(nt>2*E){const Je=D.sub(D.sub(F)._mult(E/nt)._round());this.updateDistance(F,Je),this.addCurrentVertex(Je,$,0,0,M),F=Je}}const qe=F&&V;let Ue=qe?l:w?"butt":p;if(qe&&Ue==="round"&&(be<_?Ue="miter":be<=2&&(Ue="fakeround")),Ue==="miter"&&be>y&&(Ue="bevel"),Ue==="bevel"&&(be>2&&(Ue="flipbevel"),be<y&&(Ue="miter")),F&&this.updateDistance(F,D),Ue==="miter")ge._mult(be),this.addCurrentVertex(D,ge,0,0,M);else if(Ue==="flipbevel"){if(be>100)ge=X.mult(-1);else{const nt=be*$.add(X).mag()/$.sub(X).mag();ge._perp()._mult(nt*(ut?-1:1))}this.addCurrentVertex(D,ge,0,0,M),this.addCurrentVertex(D,ge.mult(-1),0,0,M)}else if(Ue==="bevel"||Ue==="fakeround"){const nt=-Math.sqrt(be*be-1),Je=ut?nt:0,We=ut?0:nt;if(F&&this.addCurrentVertex(D,$,Je,We,M),Ue==="fakeround"){const Ee=Math.round(180*ze/Math.PI/20);for(let it=1;it<Ee;it++){let tt=it/Ee;if(tt!==.5){const Xt=tt-.5;tt+=tt*Xt*(tt-1)*((1.0904+ae*(ae*(3.55645-1.43519*ae)-3.2452))*Xt*Xt+(.848013+ae*(.215638*ae-1.06021)))}const mt=X.sub($)._mult(tt)._add($)._unit()._mult(ut?-1:1);this.addHalfVertex(D,mt.x,mt.y,!1,ut,0,M)}}V&&this.addCurrentVertex(D,X,-Je,-We,M)}else if(Ue==="butt")this.addCurrentVertex(D,ge,0,0,M);else if(Ue==="square"){const nt=F?1:-1;this.addCurrentVertex(D,ge,nt,nt,M)}else Ue==="round"&&(F&&(this.addCurrentVertex(D,$,0,0,M),this.addCurrentVertex(D,$,1,1,M,!0)),V&&(this.addCurrentVertex(D,X,-1,-1,M,!0),this.addCurrentVertex(D,X,0,0,M)));if(Ge&&te<S-1){const nt=D.dist(V);if(nt>2*E){const Je=D.add(V.sub(D)._mult(E/nt)._round());this.updateDistance(D,Je),this.addCurrentVertex(Je,X,0,0,M),D=Je}}}}addCurrentVertex(t,s,l,p,y,_=!1){const w=s.y*p-s.x,S=-s.y-s.x*p;this.addHalfVertex(t,s.x+s.y*l,s.y-s.x*l,_,!1,l,y),this.addHalfVertex(t,w,S,_,!0,-p,y),this.distance>ox/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,s,l,p,y,_))}addHalfVertex({x:t,y:s},l,p,y,_,w,S){const I=.5*(this.lineClips?this.scaledDistance*(ox-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(y?1:0),(s<<1)+(_?1:0),Math.round(63*l)+128,Math.round(63*p)+128,1+(w===0?0:w<0?-1:1)|(63&I)<<2,I>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const E=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),S.primitiveLength++),_?this.e2=E:this.e1=E}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,s){this.distance+=t.dist(s),this.updateScaledDistance()}}let lx,ux;Xe("LineBucket",Jm,{omit:["layers","patternFeatures"]});var cx={get paint(){return ux=ux||new m({"line-opacity":new ct(we.paint_line["line-opacity"]),"line-color":new ct(we.paint_line["line-color"]),"line-translate":new Qe(we.paint_line["line-translate"]),"line-translate-anchor":new Qe(we.paint_line["line-translate-anchor"]),"line-width":new ct(we.paint_line["line-width"]),"line-gap-width":new ct(we.paint_line["line-gap-width"]),"line-offset":new ct(we.paint_line["line-offset"]),"line-blur":new ct(we.paint_line["line-blur"]),"line-dasharray":new Kl(we.paint_line["line-dasharray"]),"line-pattern":new Hl(we.paint_line["line-pattern"]),"line-gradient":new jc(we.paint_line["line-gradient"])})},get layout(){return lx=lx||new m({"line-cap":new Qe(we.layout_line["line-cap"]),"line-join":new ct(we.layout_line["line-join"]),"line-miter-limit":new Qe(we.layout_line["line-miter-limit"]),"line-round-limit":new Qe(we.layout_line["line-round-limit"]),"line-sort-key":new ct(we.layout_line["line-sort-key"])})}};class zS extends ct{possiblyEvaluate(t,s){return s=new er(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,zoomHistory:s.zoomHistory,transition:s.transition}),super.possiblyEvaluate(t,s)}evaluate(t,s,l,p){return s=xe({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(t,s,l,p)}}let op;class DS extends a{constructor(t){super(t,cx),this.gradientVersion=0,op||(op=new zS(cx.paint.properties["line-width"].specification),op.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const s=this.gradientExpression();this.stepInterpolant=!!function(l){return l._styleExpression!==void 0}(s)&&s._styleExpression.expression instanceof ma,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,s){super.recalculate(t,s),this.paint._values["line-floorwidth"]=op.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Jm(t)}queryRadius(t){const s=t,l=hx($c("line-width",this,s),$c("line-gap-width",this,s)),p=$c("line-offset",this,s);return l/2+Math.abs(p)+tp(this.paint.get("line-translate"))}queryIntersectsFeature(t,s,l,p,y,_,w){const S=rp(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),_.angle,w),I=w/2*hx(this.paint.get("line-width").evaluate(s,l),this.paint.get("line-gap-width").evaluate(s,l)),E=this.paint.get("line-offset").evaluate(s,l);return E&&(p=function(M,D){const F=[];for(let V=0;V<M.length;V++){const $=M[V],X=[];for(let te=0;te<$.length;te++){const ge=$[te-1],ae=$[te],fe=$[te+1],be=te===0?new j(0,0):ae.sub(ge)._unit()._perp(),ze=te===$.length-1?new j(0,0):fe.sub(ae)._unit()._perp(),Ge=be._add(ze)._unit(),ut=Ge.x*ze.x+Ge.y*ze.y;ut!==0&&Ge._mult(1/ut),X.push(Ge._mult(D)._add(ae))}F.push(X)}return F}(p,E*w)),function(M,D,F){for(let V=0;V<D.length;V++){const $=D[V];if(M.length>=3){for(let X=0;X<$.length;X++)if(tu(M,$[X]))return!0}if(U2(M,$,F))return!0}return!1}(S,p,I)}isTileClipped(){return!0}}function hx(i,t){return t>0?t+2*i:i}const LS=b([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),RS=b([{name:"a_projected_pos",components:3,type:"Float32"}],4);b([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const BS=b([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);b([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const dx=b([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),FS=b([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function OS(i,t,s){return i.sections.forEach(l=>{l.text=function(p,y,_){const w=y.layout.get("text-transform").evaluate(_,{});return w==="uppercase"?p=p.toLocaleUpperCase():w==="lowercase"&&(p=p.toLocaleLowerCase()),Dn.applyArabicShaping&&(p=Dn.applyArabicShaping(p)),p}(l.text,t,s)}),i}b([{name:"triangle",components:3,type:"Uint16"}]),b([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),b([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),b([{type:"Float32",name:"offsetX"}]),b([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),b([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Yc={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Mr=24,px=Gt,fx=function(i,t,s,l,p){var y,_,w=8*p-l-1,S=(1<<w)-1,I=S>>1,E=-7,M=p-1,D=-1,F=i[t+M];for(M+=D,y=F&(1<<-E)-1,F>>=-E,E+=w;E>0;y=256*y+i[t+M],M+=D,E-=8);for(_=y&(1<<-E)-1,y>>=-E,E+=l;E>0;_=256*_+i[t+M],M+=D,E-=8);if(y===0)y=1-I;else{if(y===S)return _?NaN:1/0*(F?-1:1);_+=Math.pow(2,l),y-=I}return(F?-1:1)*_*Math.pow(2,y-l)},mx=function(i,t,s,l,p,y){var _,w,S,I=8*y-p-1,E=(1<<I)-1,M=E>>1,D=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,F=0,V=1,$=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(w=isNaN(t)?1:0,_=E):(_=Math.floor(Math.log(t)/Math.LN2),t*(S=Math.pow(2,-_))<1&&(_--,S*=2),(t+=_+M>=1?D/S:D*Math.pow(2,1-M))*S>=2&&(_++,S/=2),_+M>=E?(w=0,_=E):_+M>=1?(w=(t*S-1)*Math.pow(2,p),_+=M):(w=t*Math.pow(2,M-1)*Math.pow(2,p),_=0));p>=8;i[s+F]=255&w,F+=V,w/=256,p-=8);for(_=_<<p|w,I+=p;I>0;i[s+F]=255&_,F+=V,_/=256,I-=8);i[s+F-V]|=128*$};function Gt(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Gt.Varint=0,Gt.Fixed64=1,Gt.Bytes=2,Gt.Fixed32=5;var Qm=4294967296,gx=1/Qm,yx=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function qs(i){return i.type===Gt.Bytes?i.readVarint()+i.pos:i.pos+1}function su(i,t,s){return s?4294967296*t+(i>>>0):4294967296*(t>>>0)+(i>>>0)}function _x(i,t,s){var l=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));s.realloc(l);for(var p=s.pos-1;p>=i;p--)s.buf[p+l]=s.buf[p]}function NS(i,t){for(var s=0;s<i.length;s++)t.writeVarint(i[s])}function jS(i,t){for(var s=0;s<i.length;s++)t.writeSVarint(i[s])}function VS(i,t){for(var s=0;s<i.length;s++)t.writeFloat(i[s])}function US(i,t){for(var s=0;s<i.length;s++)t.writeDouble(i[s])}function $S(i,t){for(var s=0;s<i.length;s++)t.writeBoolean(i[s])}function qS(i,t){for(var s=0;s<i.length;s++)t.writeFixed32(i[s])}function ZS(i,t){for(var s=0;s<i.length;s++)t.writeSFixed32(i[s])}function GS(i,t){for(var s=0;s<i.length;s++)t.writeFixed64(i[s])}function HS(i,t){for(var s=0;s<i.length;s++)t.writeSFixed64(i[s])}function lp(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+16777216*i[t+3]}function au(i,t,s){i[s]=t,i[s+1]=t>>>8,i[s+2]=t>>>16,i[s+3]=t>>>24}function vx(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+(i[t+3]<<24)}Gt.prototype={destroy:function(){this.buf=null},readFields:function(i,t,s){for(s=s||this.length;this.pos<s;){var l=this.readVarint(),p=l>>3,y=this.pos;this.type=7&l,i(p,t,this),this.pos===y&&this.skip(l)}return t},readMessage:function(i,t){return this.readFields(i,t,this.readVarint()+this.pos)},readFixed32:function(){var i=lp(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=vx(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=lp(this.buf,this.pos)+lp(this.buf,this.pos+4)*Qm;return this.pos+=8,i},readSFixed64:function(){var i=lp(this.buf,this.pos)+vx(this.buf,this.pos+4)*Qm;return this.pos+=8,i},readFloat:function(){var i=fx(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=fx(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var t,s,l=this.buf;return t=127&(s=l[this.pos++]),s<128?t:(t|=(127&(s=l[this.pos++]))<<7,s<128?t:(t|=(127&(s=l[this.pos++]))<<14,s<128?t:(t|=(127&(s=l[this.pos++]))<<21,s<128?t:function(p,y,_){var w,S,I=_.buf;if(w=(112&(S=I[_.pos++]))>>4,S<128||(w|=(127&(S=I[_.pos++]))<<3,S<128)||(w|=(127&(S=I[_.pos++]))<<10,S<128)||(w|=(127&(S=I[_.pos++]))<<17,S<128)||(w|=(127&(S=I[_.pos++]))<<24,S<128)||(w|=(1&(S=I[_.pos++]))<<31,S<128))return su(p,w,y);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(s=l[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,t=this.pos;return this.pos=i,i-t>=12&&yx?function(s,l,p){return yx.decode(s.subarray(l,p))}(this.buf,t,i):function(s,l,p){for(var y="",_=l;_<p;){var w,S,I,E=s[_],M=null,D=E>239?4:E>223?3:E>191?2:1;if(_+D>p)break;D===1?E<128&&(M=E):D===2?(192&(w=s[_+1]))==128&&(M=(31&E)<<6|63&w)<=127&&(M=null):D===3?(S=s[_+2],(192&(w=s[_+1]))==128&&(192&S)==128&&((M=(15&E)<<12|(63&w)<<6|63&S)<=2047||M>=55296&&M<=57343)&&(M=null)):D===4&&(S=s[_+2],I=s[_+3],(192&(w=s[_+1]))==128&&(192&S)==128&&(192&I)==128&&((M=(15&E)<<18|(63&w)<<12|(63&S)<<6|63&I)<=65535||M>=1114112)&&(M=null)),M===null?(M=65533,D=1):M>65535&&(M-=65536,y+=String.fromCharCode(M>>>10&1023|55296),M=56320|1023&M),y+=String.fromCharCode(M),_+=D}return y}(this.buf,t,i)},readBytes:function(){var i=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,i);return this.pos=i,t},readPackedVarint:function(i,t){if(this.type!==Gt.Bytes)return i.push(this.readVarint(t));var s=qs(this);for(i=i||[];this.pos<s;)i.push(this.readVarint(t));return i},readPackedSVarint:function(i){if(this.type!==Gt.Bytes)return i.push(this.readSVarint());var t=qs(this);for(i=i||[];this.pos<t;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Gt.Bytes)return i.push(this.readBoolean());var t=qs(this);for(i=i||[];this.pos<t;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Gt.Bytes)return i.push(this.readFloat());var t=qs(this);for(i=i||[];this.pos<t;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Gt.Bytes)return i.push(this.readDouble());var t=qs(this);for(i=i||[];this.pos<t;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Gt.Bytes)return i.push(this.readFixed32());var t=qs(this);for(i=i||[];this.pos<t;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Gt.Bytes)return i.push(this.readSFixed32());var t=qs(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Gt.Bytes)return i.push(this.readFixed64());var t=qs(this);for(i=i||[];this.pos<t;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Gt.Bytes)return i.push(this.readSFixed64());var t=qs(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed64());return i},skip:function(i){var t=7&i;if(t===Gt.Varint)for(;this.buf[this.pos++]>127;);else if(t===Gt.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Gt.Fixed32)this.pos+=4;else{if(t!==Gt.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(i,t){this.writeVarint(i<<3|t)},realloc:function(i){for(var t=this.length||16;t<this.pos+i;)t*=2;if(t!==this.length){var s=new Uint8Array(t);s.set(this.buf),this.buf=s,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),au(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),au(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),au(this.buf,-1&i,this.pos),au(this.buf,Math.floor(i*gx),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),au(this.buf,-1&i,this.pos),au(this.buf,Math.floor(i*gx),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(t,s){var l,p;if(t>=0?(l=t%4294967296|0,p=t/4294967296|0):(p=~(-t/4294967296),4294967295^(l=~(-t%4294967296))?l=l+1|0:(l=0,p=p+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(y,_,w){w.buf[w.pos++]=127&y|128,y>>>=7,w.buf[w.pos++]=127&y|128,y>>>=7,w.buf[w.pos++]=127&y|128,y>>>=7,w.buf[w.pos++]=127&y|128,w.buf[w.pos]=127&(y>>>=7)}(l,0,s),function(y,_){var w=(7&y)<<4;_.buf[_.pos++]|=w|((y>>>=3)?128:0),y&&(_.buf[_.pos++]=127&y|((y>>>=7)?128:0),y&&(_.buf[_.pos++]=127&y|((y>>>=7)?128:0),y&&(_.buf[_.pos++]=127&y|((y>>>=7)?128:0),y&&(_.buf[_.pos++]=127&y|((y>>>=7)?128:0),y&&(_.buf[_.pos++]=127&y)))))}(p,s)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var t=this.pos;this.pos=function(l,p,y){for(var _,w,S=0;S<p.length;S++){if((_=p.charCodeAt(S))>55295&&_<57344){if(!w){_>56319||S+1===p.length?(l[y++]=239,l[y++]=191,l[y++]=189):w=_;continue}if(_<56320){l[y++]=239,l[y++]=191,l[y++]=189,w=_;continue}_=w-55296<<10|_-56320|65536,w=null}else w&&(l[y++]=239,l[y++]=191,l[y++]=189,w=null);_<128?l[y++]=_:(_<2048?l[y++]=_>>6|192:(_<65536?l[y++]=_>>12|224:(l[y++]=_>>18|240,l[y++]=_>>12&63|128),l[y++]=_>>6&63|128),l[y++]=63&_|128)}return y}(this.buf,i,this.pos);var s=this.pos-t;s>=128&&_x(t,s,this),this.pos=t-1,this.writeVarint(s),this.pos+=s},writeFloat:function(i){this.realloc(4),mx(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),mx(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var t=i.length;this.writeVarint(t),this.realloc(t);for(var s=0;s<t;s++)this.buf[this.pos++]=i[s]},writeRawMessage:function(i,t){this.pos++;var s=this.pos;i(t,this);var l=this.pos-s;l>=128&&_x(s,l,this),this.pos=s-1,this.writeVarint(l),this.pos+=l},writeMessage:function(i,t,s){this.writeTag(i,Gt.Bytes),this.writeRawMessage(t,s)},writePackedVarint:function(i,t){t.length&&this.writeMessage(i,NS,t)},writePackedSVarint:function(i,t){t.length&&this.writeMessage(i,jS,t)},writePackedBoolean:function(i,t){t.length&&this.writeMessage(i,$S,t)},writePackedFloat:function(i,t){t.length&&this.writeMessage(i,VS,t)},writePackedDouble:function(i,t){t.length&&this.writeMessage(i,US,t)},writePackedFixed32:function(i,t){t.length&&this.writeMessage(i,qS,t)},writePackedSFixed32:function(i,t){t.length&&this.writeMessage(i,ZS,t)},writePackedFixed64:function(i,t){t.length&&this.writeMessage(i,GS,t)},writePackedSFixed64:function(i,t){t.length&&this.writeMessage(i,HS,t)},writeBytesField:function(i,t){this.writeTag(i,Gt.Bytes),this.writeBytes(t)},writeFixed32Field:function(i,t){this.writeTag(i,Gt.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(i,t){this.writeTag(i,Gt.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(i,t){this.writeTag(i,Gt.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(i,t){this.writeTag(i,Gt.Fixed64),this.writeSFixed64(t)},writeVarintField:function(i,t){this.writeTag(i,Gt.Varint),this.writeVarint(t)},writeSVarintField:function(i,t){this.writeTag(i,Gt.Varint),this.writeSVarint(t)},writeStringField:function(i,t){this.writeTag(i,Gt.Bytes),this.writeString(t)},writeFloatField:function(i,t){this.writeTag(i,Gt.Fixed32),this.writeFloat(t)},writeDoubleField:function(i,t){this.writeTag(i,Gt.Fixed64),this.writeDouble(t)},writeBooleanField:function(i,t){this.writeVarintField(i,!!t)}};var eg=C(px);const tg=3;function KS(i,t,s){i===1&&s.readMessage(WS,t)}function WS(i,t,s){if(i===3){const{id:l,bitmap:p,width:y,height:_,left:w,top:S,advance:I}=s.readMessage(XS,{});t.push({id:l,bitmap:new Zc({width:y+2*tg,height:_+2*tg},p),metrics:{width:y,height:_,left:w,top:S,advance:I}})}}function XS(i,t,s){i===1?t.id=s.readVarint():i===2?t.bitmap=s.readBytes():i===3?t.width=s.readVarint():i===4?t.height=s.readVarint():i===5?t.left=s.readSVarint():i===6?t.top=s.readSVarint():i===7&&(t.advance=s.readVarint())}const xx=tg;function wx(i){let t=0,s=0;for(const _ of i)t+=_.w*_.h,s=Math.max(s,_.w);i.sort((_,w)=>w.h-_.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),s),h:1/0}];let p=0,y=0;for(const _ of i)for(let w=l.length-1;w>=0;w--){const S=l[w];if(!(_.w>S.w||_.h>S.h)){if(_.x=S.x,_.y=S.y,y=Math.max(y,_.y+_.h),p=Math.max(p,_.x+_.w),_.w===S.w&&_.h===S.h){const I=l.pop();w<l.length&&(l[w]=I)}else _.h===S.h?(S.x+=_.w,S.w-=_.w):_.w===S.w?(S.y+=_.h,S.h-=_.h):(l.push({x:S.x+_.w,y:S.y,w:S.w-_.w,h:_.h}),S.y+=_.h,S.h-=_.h);break}}return{w:p,h:y,fill:t/(p*y)||0}}const Rn=1;class rg{constructor(t,{pixelRatio:s,version:l,stretchX:p,stretchY:y,content:_,textFitWidth:w,textFitHeight:S}){this.paddedRect=t,this.pixelRatio=s,this.stretchX=p,this.stretchY=y,this.content=_,this.version=l,this.textFitWidth=w,this.textFitHeight=S}get tl(){return[this.paddedRect.x+Rn,this.paddedRect.y+Rn]}get br(){return[this.paddedRect.x+this.paddedRect.w-Rn,this.paddedRect.y+this.paddedRect.h-Rn]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Rn)/this.pixelRatio,(this.paddedRect.h-2*Rn)/this.pixelRatio]}}class bx{constructor(t,s){const l={},p={};this.haveRenderCallbacks=[];const y=[];this.addImages(t,l,y),this.addImages(s,p,y);const{w:_,h:w}=wx(y),S=new fi({width:_||1,height:w||1});for(const I in t){const E=t[I],M=l[I].paddedRect;fi.copy(E.data,S,{x:0,y:0},{x:M.x+Rn,y:M.y+Rn},E.data)}for(const I in s){const E=s[I],M=p[I].paddedRect,D=M.x+Rn,F=M.y+Rn,V=E.data.width,$=E.data.height;fi.copy(E.data,S,{x:0,y:0},{x:D,y:F},E.data),fi.copy(E.data,S,{x:0,y:$-1},{x:D,y:F-1},{width:V,height:1}),fi.copy(E.data,S,{x:0,y:0},{x:D,y:F+$},{width:V,height:1}),fi.copy(E.data,S,{x:V-1,y:0},{x:D-1,y:F},{width:1,height:$}),fi.copy(E.data,S,{x:0,y:0},{x:D+V,y:F},{width:1,height:$})}this.image=S,this.iconPositions=l,this.patternPositions=p}addImages(t,s,l){for(const p in t){const y=t[p],_={x:0,y:0,w:y.data.width+2*Rn,h:y.data.height+2*Rn};l.push(_),s[p]=new rg(_,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(t,s){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in t.updatedImages)this.patchUpdatedImage(this.iconPositions[l],t.getImage(l),s),this.patchUpdatedImage(this.patternPositions[l],t.getImage(l),s)}patchUpdatedImage(t,s,l){if(!t||!s||t.version===s.version)return;t.version=s.version;const[p,y]=t.tl;l.update(s.data,void 0,{x:p,y})}}var ja;Xe("ImagePosition",rg),Xe("ImageAtlas",bx),v.ah=void 0,(ja=v.ah||(v.ah={}))[ja.none=0]="none",ja[ja.horizontal=1]="horizontal",ja[ja.vertical=2]="vertical",ja[ja.horizontalOnly=3]="horizontalOnly";const Jc=-17;class Qc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,s){const l=new Qc;return l.scale=t||1,l.fontStack=s,l}static forImage(t){const s=new Qc;return s.imageName=t,s}}class ou{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,s){const l=new ou;for(let p=0;p<t.sections.length;p++){const y=t.sections[p];y.image?l.addImageSection(y):l.addTextSection(y,s)}return l}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let s="";for(let l=0;l<t.length;l++){const p=t.charCodeAt(l+1)||null,y=t.charCodeAt(l-1)||null;s+=p&&Kd(p)&&!Yc[t[l+1]]||y&&Kd(y)&&!Yc[t[l-1]]||!Yc[t[l]]?t[l]:Yc[t[l]]}return s}(this.text)}trim(){let t=0;for(let l=0;l<this.text.length&&cp[this.text.charCodeAt(l)];l++)t++;let s=this.text.length;for(let l=this.text.length-1;l>=0&&l>=t&&cp[this.text.charCodeAt(l)];l--)s--;this.text=this.text.substring(t,s),this.sectionIndex=this.sectionIndex.slice(t,s)}substring(t,s){const l=new ou;return l.text=this.text.substring(t,s),l.sectionIndex=this.sectionIndex.slice(t,s),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,s)=>Math.max(t,this.sections[s].scale),0)}addTextSection(t,s){this.text+=t.text,this.sections.push(Qc.forText(t.scale,t.fontStack||s));const l=this.sections.length-1;for(let p=0;p<t.text.length;++p)this.sectionIndex.push(l)}addImageSection(t){const s=t.image?t.image.name:"";if(s.length===0)return void Tt("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push(Qc.forImage(s)),this.sectionIndex.push(this.sections.length-1)):Tt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function up(i,t,s,l,p,y,_,w,S,I,E,M,D,F,V){const $=ou.fromFeature(i,p);let X;M===v.ah.vertical&&$.verticalizePunctuation();const{processBidirectionalText:te,processStyledBidirectionalText:ge}=Dn;if(te&&$.sections.length===1){X=[];const be=te($.toString(),ng($,I,y,t,l,F));for(const ze of be){const Ge=new ou;Ge.text=ze,Ge.sections=$.sections;for(let ut=0;ut<ze.length;ut++)Ge.sectionIndex.push(0);X.push(Ge)}}else if(ge){X=[];const be=ge($.text,$.sectionIndex,ng($,I,y,t,l,F));for(const ze of be){const Ge=new ou;Ge.text=ze[0],Ge.sectionIndex=ze[1],Ge.sections=$.sections,X.push(Ge)}}else X=function(be,ze){const Ge=[],ut=be.text;let qe=0;for(const Ue of ze)Ge.push(be.substring(qe,Ue)),qe=Ue;return qe<ut.length&&Ge.push(be.substring(qe,ut.length)),Ge}($,ng($,I,y,t,l,F));const ae=[],fe={positionedLines:ae,text:$.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:M,iconsInText:!1,verticalizable:!1};return function(be,ze,Ge,ut,qe,Ue,nt,Je,We,Ee,it,tt){let mt=0,Xt=Jc,Ht=0,Lr=0;const Bi=Je==="right"?1:Je==="left"?0:.5;let Yr=0;for(const gr of qe){gr.trim();const Br=gr.getMaxScale(),on=(Br-1)*Mr,Jr={positionedGlyphs:[],lineOffset:0};be.positionedLines[Yr]=Jr;const bn=Jr.positionedGlyphs;let Qr=0;if(!gr.length()){Xt+=Ue,++Yr;continue}for(let Bn=0;Bn<gr.length();Bn++){const Bt=gr.getSection(Bn),Jt=gr.getSectionIndex(Bn),ir=gr.getCharCode(Bn);let Yn=0,cr=null,hu=null,gs=null,ys=Mr;const Fi=!(We===v.ah.horizontal||!it&&!Oc(ir)||it&&(cp[ir]||(Rr=ir,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(Rr)))));if(Bt.imageName){const yi=ut[Bt.imageName];if(!yi)continue;gs=Bt.imageName,be.iconsInText=be.iconsInText||!0,hu=yi.paddedRect;const Vr=yi.displaySize;Bt.scale=Bt.scale*Mr/tt,cr={width:Vr[0],height:Vr[1],left:Rn,top:-xx,advance:Fi?Vr[1]:Vr[0]},Yn=on+(Mr-Vr[1]*Bt.scale),ys=cr.advance;const Zs=Fi?Vr[0]*Bt.scale-Mr*Br:Vr[1]*Bt.scale-Mr*Br;Zs>0&&Zs>Qr&&(Qr=Zs)}else{const yi=Ge[Bt.fontStack],Vr=yi&&yi[ir];if(Vr&&Vr.rect)hu=Vr.rect,cr=Vr.metrics;else{const Zs=ze[Bt.fontStack],sh=Zs&&Zs[ir];if(!sh)continue;cr=sh.metrics}Yn=(Br-Bt.scale)*Mr}Fi?(be.verticalizable=!0,bn.push({glyph:ir,imageName:gs,x:mt,y:Xt+Yn,vertical:Fi,scale:Bt.scale,fontStack:Bt.fontStack,sectionIndex:Jt,metrics:cr,rect:hu}),mt+=ys*Bt.scale+Ee):(bn.push({glyph:ir,imageName:gs,x:mt,y:Xt+Yn,vertical:Fi,scale:Bt.scale,fontStack:Bt.fontStack,sectionIndex:Jt,metrics:cr,rect:hu}),mt+=cr.advance*Bt.scale+Ee)}bn.length!==0&&(Ht=Math.max(mt-Ee,Ht),ek(bn,0,bn.length-1,Bi,Qr)),mt=0;const gi=Ue*Br+Qr;Jr.lineOffset=Math.max(Qr,on),Xt+=gi,Lr=Math.max(gi,Lr),++Yr}var Rr;const vn=Xt-Jc,{horizontalAlign:xn,verticalAlign:wn}=ig(nt);(function(gr,Br,on,Jr,bn,Qr,gi,Bn,Bt){const Jt=(Br-on)*bn;let ir=0;ir=Qr!==gi?-Bn*Jr-Jc:(-Jr*Bt+.5)*gi;for(const Yn of gr)for(const cr of Yn.positionedGlyphs)cr.x+=Jt,cr.y+=ir})(be.positionedLines,Bi,xn,wn,Ht,Lr,Ue,vn,qe.length),be.top+=-wn*vn,be.bottom=be.top+vn,be.left+=-xn*Ht,be.right=be.left+Ht}(fe,t,s,l,X,_,w,S,M,I,D,V),!function(be){for(const ze of be)if(ze.positionedGlyphs.length!==0)return!1;return!0}(ae)&&fe}const cp={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},YS={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},JS={40:!0};function Sx(i,t,s,l,p,y){if(t.imageName){const _=l[t.imageName];return _?_.displaySize[0]*t.scale*Mr/y+p:0}{const _=s[t.fontStack],w=_&&_[i];return w?w.metrics.advance*t.scale+p:0}}function kx(i,t,s,l){const p=Math.pow(i-t,2);return l?i<t?p/2:2*p:p+Math.abs(s)*s}function QS(i,t,s){let l=0;return i===10&&(l-=1e4),s&&(l+=150),i!==40&&i!==65288||(l+=50),t!==41&&t!==65289||(l+=50),l}function Tx(i,t,s,l,p,y){let _=null,w=kx(t,s,p,y);for(const S of l){const I=kx(t-S.x,s,p,y)+S.badness;I<=w&&(_=S,w=I)}return{index:i,x:t,priorBreak:_,badness:w}}function Ix(i){return i?Ix(i.priorBreak).concat(i.index):[]}function ng(i,t,s,l,p,y){if(!i)return[];const _=[],w=function(M,D,F,V,$,X){let te=0;for(let ge=0;ge<M.length();ge++){const ae=M.getSection(ge);te+=Sx(M.getCharCode(ge),ae,V,$,D,X)}return te/Math.max(1,Math.ceil(te/F))}(i,t,s,l,p,y),S=i.text.indexOf("")>=0;let I=0;for(let M=0;M<i.length();M++){const D=i.getSection(M),F=i.getCharCode(M);if(cp[F]||(I+=Sx(F,D,l,p,t,y)),M<i.length()-1){const V=!((E=F)<11904)&&(!!Ct["CJK Compatibility Forms"](E)||!!Ct["CJK Compatibility"](E)||!!Ct["CJK Strokes"](E)||!!Ct["CJK Symbols and Punctuation"](E)||!!Ct["Enclosed CJK Letters and Months"](E)||!!Ct["Halfwidth and Fullwidth Forms"](E)||!!Ct["Ideographic Description Characters"](E)||!!Ct["Vertical Forms"](E)||Hd.test(String.fromCodePoint(E)));(YS[F]||V||D.imageName||M!==i.length()-2&&JS[i.getCharCode(M+1)])&&_.push(Tx(M+1,I,w,_,QS(F,i.getCharCode(M+1),V&&S),!1))}}var E;return Ix(Tx(i.length(),I,w,_,0,!0))}function ig(i){let t=.5,s=.5;switch(i){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:t,verticalAlign:s}}function ek(i,t,s,l,p){if(!l&&!p)return;const y=i[s],_=(i[s].x+y.metrics.advance*y.scale)*l;for(let w=t;w<=s;w++)i[w].x-=_,i[w].y+=p}function tk(i,t,s){const{horizontalAlign:l,verticalAlign:p}=ig(s),y=t[0]-i.displaySize[0]*l,_=t[1]-i.displaySize[1]*p;return{image:i,top:_,bottom:_+i.displaySize[1],left:y,right:y+i.displaySize[0]}}function Ex(i){var t,s;let l=i.left,p=i.top,y=i.right-l,_=i.bottom-p;const w=(t=i.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",S=(s=i.image.textFitHeight)!==null&&s!==void 0?s:"stretchOrShrink",I=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(S==="proportional"){if(w==="stretchOnly"&&y/_<I||w==="proportional"){const E=Math.ceil(_*I);l*=E/y,y=E}}else if(w==="proportional"&&S==="stretchOnly"&&I!==0&&y/_>I){const E=Math.ceil(y/I);p*=E/_,_=E}return{x1:l,y1:p,x2:l+y,y2:p+_}}function Px(i,t,s,l,p,y){const _=i.image;let w;if(_.content){const X=_.content,te=_.pixelRatio||1;w=[X[0]/te,X[1]/te,_.displaySize[0]-X[2]/te,_.displaySize[1]-X[3]/te]}const S=t.left*y,I=t.right*y;let E,M,D,F;s==="width"||s==="both"?(F=p[0]+S-l[3],M=p[0]+I+l[1]):(F=p[0]+(S+I-_.displaySize[0])/2,M=F+_.displaySize[0]);const V=t.top*y,$=t.bottom*y;return s==="height"||s==="both"?(E=p[1]+V-l[0],D=p[1]+$+l[2]):(E=p[1]+(V+$-_.displaySize[1])/2,D=E+_.displaySize[1]),{image:_,top:E,right:M,bottom:D,left:F,collisionPadding:w}}const eh=255,ms=128,Va=eh*ms;function Cx(i,t){const{expression:s}=t;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new er(i+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:l,interpolationType:p}=s;let y=0;for(;y<l.length&&l[y]<=i;)y++;y=Math.max(0,y-1);let _=y;for(;_<l.length&&l[_]<i+1;)_++;_=Math.min(l.length-1,_);const w=l[y],S=l[_];return s.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:S,interpolationType:p}:{kind:"camera",minZoom:w,maxZoom:S,minSize:s.evaluate(new er(w)),maxSize:s.evaluate(new er(S)),interpolationType:p}}}function sg(i,t,s){let l="never";const p=i.get(t);return p?l=p:i.get(s)&&(l="always"),l}const rk=Na.VectorTileFeature.types,nk=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function hp(i,t,s,l,p,y,_,w,S,I,E,M,D){const F=w?Math.min(Va,Math.round(w[0])):0,V=w?Math.min(Va,Math.round(w[1])):0;i.emplaceBack(t,s,Math.round(32*l),Math.round(32*p),y,_,(F<<1)+(S?1:0),V,16*I,16*E,256*M,256*D)}function ag(i,t,s){i.emplaceBack(t.x,t.y,s),i.emplaceBack(t.x,t.y,s),i.emplaceBack(t.x,t.y,s),i.emplaceBack(t.x,t.y,s)}function ik(i){for(const t of i.sections)if(Lm(t.text))return!0;return!1}class og{constructor(t){this.layoutVertexArray=new Xl,this.indexArray=new pi,this.programConfigurations=t,this.segments=new Mt,this.dynamicLayoutVertexArray=new Vc,this.opacityVertexArray=new Wn,this.hasVisibleVertices=!1,this.placedSymbolArray=new tr}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,s,l,p){this.isEmpty()||(l&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,LS.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,RS.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,nk,!0),this.opacityVertexBuffer.itemSize=1),(l||p)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Xe("SymbolBuffers",og);class lg{constructor(t,s,l){this.layoutVertexArray=new t,this.layoutAttributes=s,this.indexArray=new l,this.segments=new Mt,this.collisionVertexArray=new ps}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,BS.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Xe("CollisionBuffers",lg);class lu{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(_=>_.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Vm([]),this.placementViewportMatrix=Vm([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Cx(this.zoom,s["text-size"]),this.iconSizeData=Cx(this.zoom,s["icon-size"]);const l=this.layers[0].layout,p=l.get("symbol-sort-key"),y=l.get("symbol-z-order");this.canOverlap=sg(l,"text-overlap","text-allow-overlap")!=="never"||sg(l,"icon-overlap","icon-allow-overlap")!=="never"||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&!p.isConstant(),this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,l.get("symbol-placement")==="point"&&(this.writingModes=l.get("text-writing-mode").map(_=>v.ah[_])),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=t.sourceID}createArrays(){this.text=new og(new qo(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new og(new qo(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new rr,this.lineVertexArray=new Hr,this.symbolInstances=new Pt,this.textAnchorOffsets=new nr}calculateGlyphDependencies(t,s,l,p,y){for(let _=0;_<t.length;_++)if(s[t.charCodeAt(_)]=!0,(l||p)&&y){const w=Yc[t.charAt(_)];w&&(s[w.charCodeAt(0)]=!0)}}populate(t,s,l){const p=this.layers[0],y=p.layout,_=y.get("text-font"),w=y.get("text-field"),S=y.get("icon-image"),I=(w.value.kind!=="constant"||w.value.value instanceof Cn&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(_.value.kind!=="constant"||_.value.value.length>0),E=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,M=y.get("symbol-sort-key");if(this.features=[],!I&&!E)return;const D=s.iconDependencies,F=s.glyphDependencies,V=s.availableImages,$=new er(this.zoom);for(const{feature:X,id:te,index:ge,sourceLayerIndex:ae}of t){const fe=p._featureFilter.needGeometry,be=Go(X,fe);if(!p._featureFilter.filter($,be,l))continue;let ze,Ge;if(fe||(be.geometry=Zo(X)),I){const qe=p.getValueAndResolveTokens("text-field",be,l,V),Ue=Cn.factory(qe),nt=this.hasRTLText=this.hasRTLText||ik(Ue);(!nt||Dn.getRTLTextPluginStatus()==="unavailable"||nt&&Dn.isParsed())&&(ze=OS(Ue,p,be))}if(E){const qe=p.getValueAndResolveTokens("icon-image",be,l,V);Ge=qe instanceof An?qe:An.fromString(qe)}if(!ze&&!Ge)continue;const ut=this.sortFeaturesByKey?M.evaluate(be,{},l):void 0;if(this.features.push({id:te,text:ze,icon:Ge,index:ge,sourceLayerIndex:ae,geometry:be.geometry,properties:X.properties,type:rk[X.type],sortKey:ut}),Ge&&(D[Ge.name]=!0),ze){const qe=_.evaluate(be,{},l).join(","),Ue=y.get("text-rotation-alignment")!=="viewport"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(v.ah.vertical)>=0;for(const nt of ze.sections)if(nt.image)D[nt.image.name]=!0;else{const Je=Bc(ze.toString()),We=nt.fontStack||qe,Ee=F[We]=F[We]||{};this.calculateGlyphDependencies(nt.text,Ee,Ue,this.allowVerticalPlacement,Je)}}}y.get("symbol-placement")==="line"&&(this.features=function(X){const te={},ge={},ae=[];let fe=0;function be(qe){ae.push(X[qe]),fe++}function ze(qe,Ue,nt){const Je=ge[qe];return delete ge[qe],ge[Ue]=Je,ae[Je].geometry[0].pop(),ae[Je].geometry[0]=ae[Je].geometry[0].concat(nt[0]),Je}function Ge(qe,Ue,nt){const Je=te[Ue];return delete te[Ue],te[qe]=Je,ae[Je].geometry[0].shift(),ae[Je].geometry[0]=nt[0].concat(ae[Je].geometry[0]),Je}function ut(qe,Ue,nt){const Je=nt?Ue[0][Ue[0].length-1]:Ue[0][0];return`${qe}:${Je.x}:${Je.y}`}for(let qe=0;qe<X.length;qe++){const Ue=X[qe],nt=Ue.geometry,Je=Ue.text?Ue.text.toString():null;if(!Je){be(qe);continue}const We=ut(Je,nt),Ee=ut(Je,nt,!0);if(We in ge&&Ee in te&&ge[We]!==te[Ee]){const it=Ge(We,Ee,nt),tt=ze(We,Ee,ae[it].geometry);delete te[We],delete ge[Ee],ge[ut(Je,ae[tt].geometry,!0)]=tt,ae[it].geometry=null}else We in ge?ze(We,Ee,nt):Ee in te?Ge(We,Ee,nt):(be(qe),te[We]=fe-1,ge[Ee]=fe-1)}return ae.filter(qe=>qe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((X,te)=>X.sortKey-te.sortKey)}update(t,s,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,s,this.layers,l),this.icon.programConfigurations.updatePaintArrays(t,s,this.layers,l))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,s){const l=this.lineVertexArray.length;if(t.segment!==void 0){let p=t.dist(s[t.segment+1]),y=t.dist(s[t.segment]);const _={};for(let w=t.segment+1;w<s.length;w++)_[w]={x:s[w].x,y:s[w].y,tileUnitDistanceFromAnchor:p},w<s.length-1&&(p+=s[w+1].dist(s[w]));for(let w=t.segment||0;w>=0;w--)_[w]={x:s[w].x,y:s[w].y,tileUnitDistanceFromAnchor:y},w>0&&(y+=s[w-1].dist(s[w]));for(let w=0;w<s.length;w++){const S=_[w];this.lineVertexArray.emplaceBack(S.x,S.y,S.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(t,s,l,p,y,_,w,S,I,E,M,D){const F=t.indexArray,V=t.layoutVertexArray,$=t.segments.prepareSegment(4*s.length,V,F,this.canOverlap?_.sortKey:void 0),X=this.glyphOffsetArray.length,te=$.vertexLength,ge=this.allowVerticalPlacement&&w===v.ah.vertical?Math.PI/2:0,ae=_.text&&_.text.sections;for(let fe=0;fe<s.length;fe++){const{tl:be,tr:ze,bl:Ge,br:ut,tex:qe,pixelOffsetTL:Ue,pixelOffsetBR:nt,minFontScaleX:Je,minFontScaleY:We,glyphOffset:Ee,isSDF:it,sectionIndex:tt}=s[fe],mt=$.vertexLength,Xt=Ee[1];hp(V,S.x,S.y,be.x,Xt+be.y,qe.x,qe.y,l,it,Ue.x,Ue.y,Je,We),hp(V,S.x,S.y,ze.x,Xt+ze.y,qe.x+qe.w,qe.y,l,it,nt.x,Ue.y,Je,We),hp(V,S.x,S.y,Ge.x,Xt+Ge.y,qe.x,qe.y+qe.h,l,it,Ue.x,nt.y,Je,We),hp(V,S.x,S.y,ut.x,Xt+ut.y,qe.x+qe.w,qe.y+qe.h,l,it,nt.x,nt.y,Je,We),ag(t.dynamicLayoutVertexArray,S,ge),F.emplaceBack(mt,mt+1,mt+2),F.emplaceBack(mt+1,mt+2,mt+3),$.vertexLength+=4,$.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ee[0]),fe!==s.length-1&&tt===s[fe+1].sectionIndex||t.programConfigurations.populatePaintArrays(V.length,_,_.index,{},D,ae&&ae[tt])}t.placedSymbolArray.emplaceBack(S.x,S.y,X,this.glyphOffsetArray.length-X,te,I,E,S.segment,l?l[0]:0,l?l[1]:0,p[0],p[1],w,0,!1,0,M)}_addCollisionDebugVertex(t,s,l,p,y,_){return s.emplaceBack(0,0),t.emplaceBack(l.x,l.y,p,y,Math.round(_.x),Math.round(_.y))}addCollisionDebugVertices(t,s,l,p,y,_,w){const S=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),I=S.vertexLength,E=y.layoutVertexArray,M=y.collisionVertexArray,D=w.anchorX,F=w.anchorY;this._addCollisionDebugVertex(E,M,_,D,F,new j(t,s)),this._addCollisionDebugVertex(E,M,_,D,F,new j(l,s)),this._addCollisionDebugVertex(E,M,_,D,F,new j(l,p)),this._addCollisionDebugVertex(E,M,_,D,F,new j(t,p)),S.vertexLength+=4;const V=y.indexArray;V.emplaceBack(I,I+1),V.emplaceBack(I+1,I+2),V.emplaceBack(I+2,I+3),V.emplaceBack(I+3,I),S.primitiveLength+=4}addDebugCollisionBoxes(t,s,l,p){for(let y=t;y<s;y++){const _=this.collisionBoxArray.get(y);this.addCollisionDebugVertices(_.x1,_.y1,_.x2,_.y2,p?this.textCollisionBox:this.iconCollisionBox,_.anchorPoint,l)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new lg(Xn,dx.members,jr),this.iconCollisionBox=new lg(Xn,dx.members,jr);for(let t=0;t<this.symbolInstances.length;t++){const s=this.symbolInstances.get(t);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}}_deserializeCollisionBoxesForSymbol(t,s,l,p,y,_,w,S,I){const E={};for(let M=s;M<l;M++){const D=t.get(M);E.textBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},E.textFeatureIndex=D.featureIndex;break}for(let M=p;M<y;M++){const D=t.get(M);E.verticalTextBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},E.verticalTextFeatureIndex=D.featureIndex;break}for(let M=_;M<w;M++){const D=t.get(M);E.iconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},E.iconFeatureIndex=D.featureIndex;break}for(let M=S;M<I;M++){const D=t.get(M);E.verticalIconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},E.verticalIconFeatureIndex=D.featureIndex;break}return E}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const l=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,s){const l=t.placedSymbolArray.get(s),p=l.vertexStartIndex+4*l.numGlyphs;for(let y=l.vertexStartIndex;y<p;y+=4)t.indexArray.emplaceBack(y,y+1,y+2),t.indexArray.emplaceBack(y+1,y+2,y+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(t),l=Math.cos(t),p=[],y=[],_=[];for(let w=0;w<this.symbolInstances.length;++w){_.push(w);const S=this.symbolInstances.get(w);p.push(0|Math.round(s*S.anchorX+l*S.anchorY)),y.push(S.featureIndex)}return _.sort((w,S)=>p[w]-p[S]||y[S]-y[w]),_}addToSortKeyRanges(t,s){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===s?l.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const l=this.symbolInstances.get(s);this.featureSortOrder.push(l.featureIndex),[l.rightJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.leftJustifiedTextSymbolIndex].forEach((p,y,_)=>{p>=0&&_.indexOf(p)===y&&this.addIndicesForPlacedSymbol(this.text,p)}),l.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,l.verticalPlacedTextSymbolIndex),l.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.placedIconSymbolIndex),l.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Mx,Ax;Xe("SymbolBucket",lu,{omit:["layers","collisionBoxArray","features","compareText"]}),lu.MAX_GLYPHS=65535,lu.addDynamicAttributes=ag;var ug={get paint(){return Ax=Ax||new m({"icon-opacity":new ct(we.paint_symbol["icon-opacity"]),"icon-color":new ct(we.paint_symbol["icon-color"]),"icon-halo-color":new ct(we.paint_symbol["icon-halo-color"]),"icon-halo-width":new ct(we.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ct(we.paint_symbol["icon-halo-blur"]),"icon-translate":new Qe(we.paint_symbol["icon-translate"]),"icon-translate-anchor":new Qe(we.paint_symbol["icon-translate-anchor"]),"text-opacity":new ct(we.paint_symbol["text-opacity"]),"text-color":new ct(we.paint_symbol["text-color"],{runtimeType:fn,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new ct(we.paint_symbol["text-halo-color"]),"text-halo-width":new ct(we.paint_symbol["text-halo-width"]),"text-halo-blur":new ct(we.paint_symbol["text-halo-blur"]),"text-translate":new Qe(we.paint_symbol["text-translate"]),"text-translate-anchor":new Qe(we.paint_symbol["text-translate-anchor"])})},get layout(){return Mx=Mx||new m({"symbol-placement":new Qe(we.layout_symbol["symbol-placement"]),"symbol-spacing":new Qe(we.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Qe(we.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ct(we.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Qe(we.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Qe(we.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Qe(we.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Qe(we.layout_symbol["icon-ignore-placement"]),"icon-optional":new Qe(we.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Qe(we.layout_symbol["icon-rotation-alignment"]),"icon-size":new ct(we.layout_symbol["icon-size"]),"icon-text-fit":new Qe(we.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Qe(we.layout_symbol["icon-text-fit-padding"]),"icon-image":new ct(we.layout_symbol["icon-image"]),"icon-rotate":new ct(we.layout_symbol["icon-rotate"]),"icon-padding":new ct(we.layout_symbol["icon-padding"]),"icon-keep-upright":new Qe(we.layout_symbol["icon-keep-upright"]),"icon-offset":new ct(we.layout_symbol["icon-offset"]),"icon-anchor":new ct(we.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Qe(we.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Qe(we.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Qe(we.layout_symbol["text-rotation-alignment"]),"text-field":new ct(we.layout_symbol["text-field"]),"text-font":new ct(we.layout_symbol["text-font"]),"text-size":new ct(we.layout_symbol["text-size"]),"text-max-width":new ct(we.layout_symbol["text-max-width"]),"text-line-height":new Qe(we.layout_symbol["text-line-height"]),"text-letter-spacing":new ct(we.layout_symbol["text-letter-spacing"]),"text-justify":new ct(we.layout_symbol["text-justify"]),"text-radial-offset":new ct(we.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Qe(we.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new ct(we.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new ct(we.layout_symbol["text-anchor"]),"text-max-angle":new Qe(we.layout_symbol["text-max-angle"]),"text-writing-mode":new Qe(we.layout_symbol["text-writing-mode"]),"text-rotate":new ct(we.layout_symbol["text-rotate"]),"text-padding":new Qe(we.layout_symbol["text-padding"]),"text-keep-upright":new Qe(we.layout_symbol["text-keep-upright"]),"text-transform":new ct(we.layout_symbol["text-transform"]),"text-offset":new ct(we.layout_symbol["text-offset"]),"text-allow-overlap":new Qe(we.layout_symbol["text-allow-overlap"]),"text-overlap":new Qe(we.layout_symbol["text-overlap"]),"text-ignore-placement":new Qe(we.layout_symbol["text-ignore-placement"]),"text-optional":new Qe(we.layout_symbol["text-optional"])})}};class zx{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:us,this.defaultValue=t}evaluate(t){if(t.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(t.formattedSection))return s.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Xe("FormatSectionOverride",zx,{omit:["defaultValue"]});class dp extends a{constructor(t){super(t,ug)}recalculate(t,s){if(super.recalculate(t,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const l=this.layout.get("text-writing-mode");if(l){const p=[];for(const y of l)p.indexOf(y)<0&&p.push(y);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,s,l,p){const y=this.layout.get(t).evaluate(s,{},l,p),_=this._unevaluatedLayout._values[t];return _.isDataDriven()||Rl(_.value)||!y?y:function(w,S){return S.replace(/{([^{}]+)}/g,(I,E)=>w&&E in w?String(w[E]):"")}(s.properties,y)}createBucket(t){return new lu(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of ug.paint.overridableProperties){if(!dp.hasPaintOverride(this.layout,t))continue;const s=this.paint.get(t),l=new zx(s),p=new Ll(l,s.property.specification);let y=null;y=s.value.kind==="constant"||s.value.kind==="source"?new ka("source",p):new Ta("composite",p,s.value.zoomStops),this.paint._values[t]=new Li(s.property,y,s.parameters)}}_handleOverridablePaintPropertyUpdate(t,s,l){return!(!this.layout||s.isDataDriven()||l.isDataDriven())&&dp.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,s){const l=t.get("text-field"),p=ug.paint.properties[s];let y=!1;const _=w=>{for(const S of w)if(p.overrides&&p.overrides.hasOverride(S))return void(y=!0)};if(l.value.kind==="constant"&&l.value.value instanceof Cn)_(l.value.value.sections);else if(l.value.kind==="source"){const w=I=>{y||(I instanceof oi&&Er(I.value)===Gi?_(I.value.sections):I instanceof Tl?_(I.sections):I.eachChild(w))},S=l.value;S._styleExpression&&w(S._styleExpression.expression)}return y}}let Dx;var sk={get paint(){return Dx=Dx||new m({"background-color":new Qe(we.paint_background["background-color"]),"background-pattern":new Kl(we.paint_background["background-pattern"]),"background-opacity":new Qe(we.paint_background["background-opacity"])})}};class ak extends a{constructor(t){super(t,sk)}}let Lx;var ok={get paint(){return Lx=Lx||new m({"raster-opacity":new Qe(we.paint_raster["raster-opacity"]),"raster-hue-rotate":new Qe(we.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Qe(we.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Qe(we.paint_raster["raster-brightness-max"]),"raster-saturation":new Qe(we.paint_raster["raster-saturation"]),"raster-contrast":new Qe(we.paint_raster["raster-contrast"]),"raster-resampling":new Qe(we.paint_raster["raster-resampling"]),"raster-fade-duration":new Qe(we.paint_raster["raster-fade-duration"])})}};class lk extends a{constructor(t){super(t,ok)}}class uk extends a{constructor(t){super(t,{}),this.onAdd=s=>{this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)},this.onRemove=s=>{this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class ck{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const cg=63710088e-1;class Ua{constructor(t,s){if(isNaN(t)||isNaN(s))throw new Error(`Invalid LngLat object: (${t}, ${s})`);if(this.lng=+t,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ua(Te(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const s=Math.PI/180,l=this.lat*s,p=t.lat*s,y=Math.sin(l)*Math.sin(p)+Math.cos(l)*Math.cos(p)*Math.cos((t.lng-this.lng)*s);return cg*Math.acos(Math.min(y,1))}static convert(t){if(t instanceof Ua)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Ua(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Ua(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Rx=2*Math.PI*cg;function Bx(i){return Rx*Math.cos(i*Math.PI/180)}function Fx(i){return(180+i)/360}function Ox(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Nx(i,t){return i/Bx(t)}function hg(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class th{constructor(t,s,l=0){this.x=+t,this.y=+s,this.z=+l}static fromLngLat(t,s=0){const l=Ua.convert(t);return new th(Fx(l.lng),Ox(l.lat),Nx(s,l.lat))}toLngLat(){return new Ua(360*this.x-180,hg(this.y))}toAltitude(){return this.z*Bx(hg(this.y))}meterInMercatorCoordinateUnits(){return 1/Rx*(t=hg(this.y),1/Math.cos(t*Math.PI/180));var t}}function jx(i,t,s){var l=2*Math.PI*6378137/256/Math.pow(2,s);return[i*l-2*Math.PI*6378137/2,t*l-2*Math.PI*6378137/2]}class dg{constructor(t,s,l){if(!function(p,y,_){return!(p<0||p>25||_<0||_>=Math.pow(2,p)||y<0||y>=Math.pow(2,p))}(t,s,l))throw new Error(`x=${s}, y=${l}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=s,this.y=l,this.key=rh(0,t,t,s,l)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,s,l){const p=(_=this.y,w=this.z,S=jx(256*(y=this.x),256*(_=Math.pow(2,w)-_-1),w),I=jx(256*(y+1),256*(_+1),w),S[0]+","+S[1]+","+I[0]+","+I[1]);var y,_,w,S,I;const E=function(M,D,F){let V,$="";for(let X=M;X>0;X--)V=1<<X-1,$+=(D&V?1:0)+(F&V?2:0);return $}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,s>1?"@2x":"").replace(/{quadkey}/g,E).replace(/{bbox-epsg-3857}/g,p)}isChildOf(t){const s=this.z-t.z;return s>0&&t.x===this.x>>s&&t.y===this.y>>s}getTilePoint(t){const s=Math.pow(2,this.z);return new j((t.x*s-this.x)*Pr,(t.y*s-this.y)*Pr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Vx{constructor(t,s){this.wrap=t,this.canonical=s,this.key=rh(t,s.z,s.z,s.x,s.y)}}class mi{constructor(t,s,l,p,y){if(t<l)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${l}`);this.overscaledZ=t,this.wrap=s,this.canonical=new dg(l,+p,+y),this.key=rh(s,t,l,p,y)}clone(){return new mi(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-t;return t>this.canonical.z?new mi(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new mi(t,this.wrap,t,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(t,s){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-t;return t>this.canonical.z?rh(this.wrap*+s,t,this.canonical.z,this.canonical.x,this.canonical.y):rh(this.wrap*+s,t,t,this.canonical.x>>l,this.canonical.y>>l)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const s=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>s&&t.canonical.y===this.canonical.y>>s}children(t){if(this.overscaledZ>=t)return[new mi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,l=2*this.canonical.x,p=2*this.canonical.y;return[new mi(s,this.wrap,s,l,p),new mi(s,this.wrap,s,l+1,p),new mi(s,this.wrap,s,l,p+1),new mi(s,this.wrap,s,l+1,p+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new mi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new mi(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Vx(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new th(t.x-this.wrap,t.y))}}function rh(i,t,s,l,p){(i*=2)<0&&(i=-1*i-1);const y=1<<s;return(y*y*i+y*p+l).toString(36)+s.toString(36)+t.toString(36)}Xe("CanonicalTileID",dg),Xe("OverscaledTileID",mi,{omit:["posMatrix"]});class Ux{constructor(t,s,l,p=1,y=1,_=1,w=0){if(this.uid=t,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(l&&!["mapbox","terrarium","custom"].includes(l))return void Tt(`"${l}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=s.height;const S=this.dim=s.height-2;switch(this.data=new Uint32Array(s.data.buffer),l){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=p,this.greenFactor=y,this.blueFactor=_,this.baseShift=w;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let I=0;I<S;I++)this.data[this._idx(-1,I)]=this.data[this._idx(0,I)],this.data[this._idx(S,I)]=this.data[this._idx(S-1,I)],this.data[this._idx(I,-1)]=this.data[this._idx(I,0)],this.data[this._idx(I,S)]=this.data[this._idx(I,S-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(S,-1)]=this.data[this._idx(S-1,0)],this.data[this._idx(-1,S)]=this.data[this._idx(0,S-1)],this.data[this._idx(S,S)]=this.data[this._idx(S-1,S-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let I=0;I<S;I++)for(let E=0;E<S;E++){const M=this.get(I,E);M>this.max&&(this.max=M),M<this.min&&(this.min=M)}}get(t,s){const l=new Uint8Array(this.data.buffer),p=4*this._idx(t,s);return this.unpack(l[p],l[p+1],l[p+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,s){if(t<-1||t>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(t+1)}unpack(t,s,l){return t*this.redFactor+s*this.greenFactor+l*this.blueFactor-this.baseShift}getPixels(){return new fi({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,s,l){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let p=s*this.dim,y=s*this.dim+this.dim,_=l*this.dim,w=l*this.dim+this.dim;switch(s){case-1:p=y-1;break;case 1:y=p+1}switch(l){case-1:_=w-1;break;case 1:w=_+1}const S=-s*this.dim,I=-l*this.dim;for(let E=_;E<w;E++)for(let M=p;M<y;M++)this.data[this._idx(M,E)]=t.data[this._idx(M+S,E+I)]}}Xe("DEMData",Ux);class $x{constructor(t){this._stringToNumber={},this._numberToString=[];for(let s=0;s<t.length;s++){const l=t[s];this._stringToNumber[l]=s,this._numberToString[s]=l}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class qx{constructor(t,s,l,p,y){this.type="Feature",this._vectorTileFeature=t,t._z=s,t._x=l,t._y=p,this.properties=t.properties,this.id=y}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(t[s]=this[s]);return t}}class Zx{constructor(t,s){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Pa(Pr,16,0),this.grid3D=new Pa(Pr,16,0),this.featureIndexArray=new sn,this.promoteId=s}insert(t,s,l,p,y,_){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,p,y);const S=_?this.grid3D:this.grid;for(let I=0;I<s.length;I++){const E=s[I],M=[1/0,1/0,-1/0,-1/0];for(let D=0;D<E.length;D++){const F=E[D];M[0]=Math.min(M[0],F.x),M[1]=Math.min(M[1],F.y),M[2]=Math.max(M[2],F.x),M[3]=Math.max(M[3],F.y)}M[0]<Pr&&M[1]<Pr&&M[2]>=0&&M[3]>=0&&S.insert(w,M[0],M[1],M[2],M[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Na.VectorTile(new eg(this.rawTileData)).layers,this.sourceLayerCoder=new $x(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,s,l,p){this.loadVTLayers();const y=t.params||{},_=Pr/t.tileSize/t.scale,w=wc(y.filter),S=t.queryGeometry,I=t.queryPadding*_,E=Hx(S),M=this.grid.query(E.minX-I,E.minY-I,E.maxX+I,E.maxY+I),D=Hx(t.cameraQueryGeometry),F=this.grid3D.query(D.minX-I,D.minY-I,D.maxX+I,D.maxY+I,(X,te,ge,ae)=>function(fe,be,ze,Ge,ut){for(const Ue of fe)if(be<=Ue.x&&ze<=Ue.y&&Ge>=Ue.x&&ut>=Ue.y)return!0;const qe=[new j(be,ze),new j(be,ut),new j(Ge,ut),new j(Ge,ze)];if(fe.length>2){for(const Ue of qe)if(tu(fe,Ue))return!0}for(let Ue=0;Ue<fe.length-1;Ue++)if(q2(fe[Ue],fe[Ue+1],qe))return!0;return!1}(t.cameraQueryGeometry,X-I,te-I,ge+I,ae+I));for(const X of F)M.push(X);M.sort(hk);const V={};let $;for(let X=0;X<M.length;X++){const te=M[X];if(te===$)continue;$=te;const ge=this.featureIndexArray.get(te);let ae=null;this.loadMatchingFeature(V,ge.bucketIndex,ge.sourceLayerIndex,ge.featureIndex,w,y.layers,y.availableImages,s,l,p,(fe,be,ze)=>(ae||(ae=Zo(fe)),be.queryIntersectsFeature(S,fe,ze,ae,this.z,t.transform,_,t.pixelPosMatrix)))}return V}loadMatchingFeature(t,s,l,p,y,_,w,S,I,E,M){const D=this.bucketLayerIDs[s];if(_&&!function(X,te){for(let ge=0;ge<X.length;ge++)if(te.indexOf(X[ge])>=0)return!0;return!1}(_,D))return;const F=this.sourceLayerCoder.decode(l),V=this.vtLayers[F].feature(p);if(y.needGeometry){const X=Go(V,!0);if(!y.filter(new er(this.tileID.overscaledZ),X,this.tileID.canonical))return}else if(!y.filter(new er(this.tileID.overscaledZ),V))return;const $=this.getId(V,F);for(let X=0;X<D.length;X++){const te=D[X];if(_&&_.indexOf(te)<0)continue;const ge=S[te];if(!ge)continue;let ae={};$&&E&&(ae=E.getState(ge.sourceLayer||"_geojsonTileLayer",$));const fe=xe({},I[te]);fe.paint=Gx(fe.paint,ge.paint,V,ae,w),fe.layout=Gx(fe.layout,ge.layout,V,ae,w);const be=!M||M(V,ge,ae);if(!be)continue;const ze=new qx(V,this.z,this.x,this.y,$);ze.layer=fe;let Ge=t[te];Ge===void 0&&(Ge=t[te]=[]),Ge.push({featureIndex:p,feature:ze,intersectionZ:be})}}lookupSymbolFeatures(t,s,l,p,y,_,w,S){const I={};this.loadVTLayers();const E=wc(y);for(const M of t)this.loadMatchingFeature(I,l,p,M,E,_,w,S,s);return I}hasLayer(t){for(const s of this.bucketLayerIDs)for(const l of s)if(t===l)return!0;return!1}getId(t,s){let l=t.id;return this.promoteId&&(l=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]],typeof l=="boolean"&&(l=Number(l))),l}}function Gx(i,t,s,l,p){return Ce(i,(y,_)=>{const w=t instanceof Vo?t.get(_):null;return w&&w.evaluate?w.evaluate(s,l,p):w})}function Hx(i){let t=1/0,s=1/0,l=-1/0,p=-1/0;for(const y of i)t=Math.min(t,y.x),s=Math.min(s,y.y),l=Math.max(l,y.x),p=Math.max(p,y.y);return{minX:t,minY:s,maxX:l,maxY:p}}function hk(i,t){return t-i}function Kx(i,t,s,l,p){const y=[];for(let _=0;_<i.length;_++){const w=i[_];let S;for(let I=0;I<w.length-1;I++){let E=w[I],M=w[I+1];E.x<t&&M.x<t||(E.x<t?E=new j(t,E.y+(t-E.x)/(M.x-E.x)*(M.y-E.y))._round():M.x<t&&(M=new j(t,E.y+(t-E.x)/(M.x-E.x)*(M.y-E.y))._round()),E.y<s&&M.y<s||(E.y<s?E=new j(E.x+(s-E.y)/(M.y-E.y)*(M.x-E.x),s)._round():M.y<s&&(M=new j(E.x+(s-E.y)/(M.y-E.y)*(M.x-E.x),s)._round()),E.x>=l&&M.x>=l||(E.x>=l?E=new j(l,E.y+(l-E.x)/(M.x-E.x)*(M.y-E.y))._round():M.x>=l&&(M=new j(l,E.y+(l-E.x)/(M.x-E.x)*(M.y-E.y))._round()),E.y>=p&&M.y>=p||(E.y>=p?E=new j(E.x+(p-E.y)/(M.y-E.y)*(M.x-E.x),p)._round():M.y>=p&&(M=new j(E.x+(p-E.y)/(M.y-E.y)*(M.x-E.x),p)._round()),S&&E.equals(S[S.length-1])||(S=[E],y.push(S)),S.push(M)))))}}return y}Xe("FeatureIndex",Zx,{omit:["rawTileData","sourceLayerCoder"]});class $a extends j{constructor(t,s,l,p){super(t,s),this.angle=l,p!==void 0&&(this.segment=p)}clone(){return new $a(this.x,this.y,this.angle,this.segment)}}function Wx(i,t,s,l,p){if(t.segment===void 0||s===0)return!0;let y=t,_=t.segment+1,w=0;for(;w>-s/2;){if(_--,_<0)return!1;w-=i[_].dist(y),y=i[_]}w+=i[_].dist(i[_+1]),_++;const S=[];let I=0;for(;w<s/2;){const E=i[_],M=i[_+1];if(!M)return!1;let D=i[_-1].angleTo(E)-E.angleTo(M);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:w,angleDelta:D}),I+=D;w-S[0].distance>l;)I-=S.shift().angleDelta;if(I>p)return!1;_++,w+=E.dist(M)}return!0}function Xx(i){let t=0;for(let s=0;s<i.length-1;s++)t+=i[s].dist(i[s+1]);return t}function Yx(i,t,s){return i?.6*t*s:0}function Jx(i,t){return Math.max(i?i.right-i.left:0,t?t.right-t.left:0)}function dk(i,t,s,l,p,y){const _=Yx(s,p,y),w=Jx(s,l)*y;let S=0;const I=Xx(i)/2;for(let E=0;E<i.length-1;E++){const M=i[E],D=i[E+1],F=M.dist(D);if(S+F>I){const V=(I-S)/F,$=mn.number(M.x,D.x,V),X=mn.number(M.y,D.y,V),te=new $a($,X,D.angleTo(M),E);return te._round(),!_||Wx(i,te,w,_,t)?te:void 0}S+=F}}function pk(i,t,s,l,p,y,_,w,S){const I=Yx(l,y,_),E=Jx(l,p),M=E*_,D=i[0].x===0||i[0].x===S||i[0].y===0||i[0].y===S;return t-M<t/4&&(t=M+t/4),Qx(i,D?t/2*w%t:(E/2+2*y)*_*w%t,t,I,s,M,D,!1,S)}function Qx(i,t,s,l,p,y,_,w,S){const I=y/2,E=Xx(i);let M=0,D=t-s,F=[];for(let V=0;V<i.length-1;V++){const $=i[V],X=i[V+1],te=$.dist(X),ge=X.angleTo($);for(;D+s<M+te;){D+=s;const ae=(D-M)/te,fe=mn.number($.x,X.x,ae),be=mn.number($.y,X.y,ae);if(fe>=0&&fe<S&&be>=0&&be<S&&D-I>=0&&D+I<=E){const ze=new $a(fe,be,ge,V);ze._round(),l&&!Wx(i,ze,y,l,p)||F.push(ze)}}M+=te}return w||F.length||_||(F=Qx(i,M/2,s,l,p,y,_,!0,S)),F}Xe("Anchor",$a);const uu=Rn;function e0(i,t,s,l){const p=[],y=i.image,_=y.pixelRatio,w=y.paddedRect.w-2*uu,S=y.paddedRect.h-2*uu;let I={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom};const E=y.stretchX||[[0,w]],M=y.stretchY||[[0,S]],D=(Ee,it)=>Ee+it[1]-it[0],F=E.reduce(D,0),V=M.reduce(D,0),$=w-F,X=S-V;let te=0,ge=F,ae=0,fe=V,be=0,ze=$,Ge=0,ut=X;if(y.content&&l){const Ee=y.content,it=Ee[2]-Ee[0],tt=Ee[3]-Ee[1];(y.textFitWidth||y.textFitHeight)&&(I=Ex(i)),te=pp(E,0,Ee[0]),ae=pp(M,0,Ee[1]),ge=pp(E,Ee[0],Ee[2]),fe=pp(M,Ee[1],Ee[3]),be=Ee[0]-te,Ge=Ee[1]-ae,ze=it-ge,ut=tt-fe}const qe=I.x1,Ue=I.y1,nt=I.x2-qe,Je=I.y2-Ue,We=(Ee,it,tt,mt)=>{const Xt=fp(Ee.stretch-te,ge,nt,qe),Ht=mp(Ee.fixed-be,ze,Ee.stretch,F),Lr=fp(it.stretch-ae,fe,Je,Ue),Bi=mp(it.fixed-Ge,ut,it.stretch,V),Yr=fp(tt.stretch-te,ge,nt,qe),Rr=mp(tt.fixed-be,ze,tt.stretch,F),vn=fp(mt.stretch-ae,fe,Je,Ue),xn=mp(mt.fixed-Ge,ut,mt.stretch,V),wn=new j(Xt,Lr),gr=new j(Yr,Lr),Br=new j(Yr,vn),on=new j(Xt,vn),Jr=new j(Ht/_,Bi/_),bn=new j(Rr/_,xn/_),Qr=t*Math.PI/180;if(Qr){const Bt=Math.sin(Qr),Jt=Math.cos(Qr),ir=[Jt,-Bt,Bt,Jt];wn._matMult(ir),gr._matMult(ir),on._matMult(ir),Br._matMult(ir)}const gi=Ee.stretch+Ee.fixed,Bn=it.stretch+it.fixed;return{tl:wn,tr:gr,bl:on,br:Br,tex:{x:y.paddedRect.x+uu+gi,y:y.paddedRect.y+uu+Bn,w:tt.stretch+tt.fixed-gi,h:mt.stretch+mt.fixed-Bn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Jr,pixelOffsetBR:bn,minFontScaleX:ze/_/nt,minFontScaleY:ut/_/Je,isSDF:s}};if(l&&(y.stretchX||y.stretchY)){const Ee=t0(E,$,F),it=t0(M,X,V);for(let tt=0;tt<Ee.length-1;tt++){const mt=Ee[tt],Xt=Ee[tt+1];for(let Ht=0;Ht<it.length-1;Ht++)p.push(We(mt,it[Ht],Xt,it[Ht+1]))}}else p.push(We({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:S+1}));return p}function pp(i,t,s){let l=0;for(const p of i)l+=Math.max(t,Math.min(s,p[1]))-Math.max(t,Math.min(s,p[0]));return l}function t0(i,t,s){const l=[{fixed:-uu,stretch:0}];for(const[p,y]of i){const _=l[l.length-1];l.push({fixed:p-_.stretch,stretch:_.stretch}),l.push({fixed:p-_.stretch,stretch:_.stretch+(y-p)})}return l.push({fixed:t+uu,stretch:s}),l}function fp(i,t,s,l){return i/t*s+l}function mp(i,t,s,l){return i-t*s/l}class gp{constructor(t,s,l,p,y,_,w,S,I,E){var M;if(this.boxStartIndex=t.length,I){let D=_.top,F=_.bottom;const V=_.collisionPadding;V&&(D-=V[1],F+=V[3]);let $=F-D;$>0&&($=Math.max(10,$),this.circleDiameter=$)}else{const D=!((M=_.image)===null||M===void 0)&&M.content&&(_.image.textFitWidth||_.image.textFitHeight)?Ex(_):{x1:_.left,y1:_.top,x2:_.right,y2:_.bottom};D.y1=D.y1*w-S[0],D.y2=D.y2*w+S[2],D.x1=D.x1*w-S[3],D.x2=D.x2*w+S[1];const F=_.collisionPadding;if(F&&(D.x1-=F[0]*w,D.y1-=F[1]*w,D.x2+=F[2]*w,D.y2+=F[3]*w),E){const V=new j(D.x1,D.y1),$=new j(D.x2,D.y1),X=new j(D.x1,D.y2),te=new j(D.x2,D.y2),ge=E*Math.PI/180;V._rotate(ge),$._rotate(ge),X._rotate(ge),te._rotate(ge),D.x1=Math.min(V.x,$.x,X.x,te.x),D.x2=Math.max(V.x,$.x,X.x,te.x),D.y1=Math.min(V.y,$.y,X.y,te.y),D.y2=Math.max(V.y,$.y,X.y,te.y)}t.emplaceBack(s.x,s.y,D.x1,D.y1,D.x2,D.y2,l,p,y)}this.boxEndIndex=t.length}}class fk{constructor(t=[],s=(l,p)=>l<p?-1:l>p?1:0){if(this.data=t,this.length=this.data.length,this.compare=s,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:s,compare:l}=this,p=s[t];for(;t>0;){const y=t-1>>1,_=s[y];if(l(p,_)>=0)break;s[t]=_,t=y}s[t]=p}_down(t){const{data:s,compare:l}=this,p=this.length>>1,y=s[t];for(;t<p;){let _=1+(t<<1);const w=_+1;if(w<this.length&&l(s[w],s[_])<0&&(_=w),l(s[_],y)>=0)break;s[t]=s[_],t=_}s[t]=y}}function mk(i,t=1,s=!1){let l=1/0,p=1/0,y=-1/0,_=-1/0;const w=i[0];for(let F=0;F<w.length;F++){const V=w[F];(!F||V.x<l)&&(l=V.x),(!F||V.y<p)&&(p=V.y),(!F||V.x>y)&&(y=V.x),(!F||V.y>_)&&(_=V.y)}const S=Math.min(y-l,_-p);let I=S/2;const E=new fk([],gk);if(S===0)return new j(l,p);for(let F=l;F<y;F+=S)for(let V=p;V<_;V+=S)E.push(new cu(F+I,V+I,I,i));let M=function(F){let V=0,$=0,X=0;const te=F[0];for(let ge=0,ae=te.length,fe=ae-1;ge<ae;fe=ge++){const be=te[ge],ze=te[fe],Ge=be.x*ze.y-ze.x*be.y;$+=(be.x+ze.x)*Ge,X+=(be.y+ze.y)*Ge,V+=3*Ge}return new cu($/V,X/V,0,F)}(i),D=E.length;for(;E.length;){const F=E.pop();(F.d>M.d||!M.d)&&(M=F,s&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,D)),F.max-M.d<=t||(I=F.h/2,E.push(new cu(F.p.x-I,F.p.y-I,I,i)),E.push(new cu(F.p.x+I,F.p.y-I,I,i)),E.push(new cu(F.p.x-I,F.p.y+I,I,i)),E.push(new cu(F.p.x+I,F.p.y+I,I,i)),D+=4)}return s&&(console.log(`num probes: ${D}`),console.log(`best distance: ${M.d}`)),M.p}function gk(i,t){return t.max-i.max}function cu(i,t,s,l){this.p=new j(i,t),this.h=s,this.d=function(p,y){let _=!1,w=1/0;for(let S=0;S<y.length;S++){const I=y[S];for(let E=0,M=I.length,D=M-1;E<M;D=E++){const F=I[E],V=I[D];F.y>p.y!=V.y>p.y&&p.x<(V.x-F.x)*(p.y-F.y)/(V.y-F.y)+F.x&&(_=!_),w=Math.min(w,Ov(p,F,V))}}return(_?1:-1)*Math.sqrt(w)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}var Xr;v.aq=void 0,(Xr=v.aq||(v.aq={}))[Xr.center=1]="center",Xr[Xr.left=2]="left",Xr[Xr.right=3]="right",Xr[Xr.top=4]="top",Xr[Xr.bottom=5]="bottom",Xr[Xr["top-left"]=6]="top-left",Xr[Xr["top-right"]=7]="top-right",Xr[Xr["bottom-left"]=8]="bottom-left",Xr[Xr["bottom-right"]=9]="bottom-right";const qa=7,pg=Number.POSITIVE_INFINITY;function r0(i,t){return t[1]!==pg?function(s,l,p){let y=0,_=0;switch(l=Math.abs(l),p=Math.abs(p),s){case"top-right":case"top-left":case"top":_=p-qa;break;case"bottom-right":case"bottom-left":case"bottom":_=-p+qa}switch(s){case"top-right":case"bottom-right":case"right":y=-l;break;case"top-left":case"bottom-left":case"left":y=l}return[y,_]}(i,t[0],t[1]):function(s,l){let p=0,y=0;l<0&&(l=0);const _=l/Math.SQRT2;switch(s){case"top-right":case"top-left":y=_-qa;break;case"bottom-right":case"bottom-left":y=-_+qa;break;case"bottom":y=-l+qa;break;case"top":y=l-qa}switch(s){case"top-right":case"bottom-right":p=-_;break;case"top-left":case"bottom-left":p=_;break;case"left":p=l;break;case"right":p=-l}return[p,y]}(i,t[0])}function n0(i,t,s){var l;const p=i.layout,y=(l=p.get("text-variable-anchor-offset"))===null||l===void 0?void 0:l.evaluate(t,{},s);if(y){const w=y.values,S=[];for(let I=0;I<w.length;I+=2){const E=S[I]=w[I],M=w[I+1].map(D=>D*Mr);E.startsWith("top")?M[1]-=qa:E.startsWith("bottom")&&(M[1]+=qa),S[I+1]=M}return new qn(S)}const _=p.get("text-variable-anchor");if(_){let w;w=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[p.get("text-radial-offset").evaluate(t,{},s)*Mr,pg]:p.get("text-offset").evaluate(t,{},s).map(I=>I*Mr);const S=[];for(const I of _)S.push(I,r0(I,w));return new qn(S)}return null}function fg(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function yk(i,t,s,l,p,y,_,w,S,I,E){let M=y.textMaxSize.evaluate(t,{});M===void 0&&(M=_);const D=i.layers[0].layout,F=D.get("icon-offset").evaluate(t,{},E),V=s0(s.horizontal),$=_/24,X=i.tilePixelRatio*$,te=i.tilePixelRatio*M/24,ge=i.tilePixelRatio*w,ae=i.tilePixelRatio*D.get("symbol-spacing"),fe=D.get("text-padding")*i.tilePixelRatio,be=function(Ee,it,tt,mt=1){const Xt=Ee.get("icon-padding").evaluate(it,{},tt),Ht=Xt&&Xt.values;return[Ht[0]*mt,Ht[1]*mt,Ht[2]*mt,Ht[3]*mt]}(D,t,E,i.tilePixelRatio),ze=D.get("text-max-angle")/180*Math.PI,Ge=D.get("text-rotation-alignment")!=="viewport"&&D.get("symbol-placement")!=="point",ut=D.get("icon-rotation-alignment")==="map"&&D.get("symbol-placement")!=="point",qe=D.get("symbol-placement"),Ue=ae/2,nt=D.get("icon-text-fit");let Je;l&&nt!=="none"&&(i.allowVerticalPlacement&&s.vertical&&(Je=Px(l,s.vertical,nt,D.get("icon-text-fit-padding"),F,$)),V&&(l=Px(l,V,nt,D.get("icon-text-fit-padding"),F,$)));const We=(Ee,it)=>{it.x<0||it.x>=Pr||it.y<0||it.y>=Pr||function(tt,mt,Xt,Ht,Lr,Bi,Yr,Rr,vn,xn,wn,gr,Br,on,Jr,bn,Qr,gi,Bn,Bt,Jt,ir,Yn,cr,hu){const gs=tt.addToLineVertexArray(mt,Xt);let ys,Fi,yi,Vr,Zs=0,sh=0,u0=0,c0=0,bg=-1,Sg=-1;const Gs={};let h0=Yl("");if(tt.allowVerticalPlacement&&Ht.vertical){const ln=Rr.layout.get("text-rotate").evaluate(Jt,{},cr)+90;yi=new gp(vn,mt,xn,wn,gr,Ht.vertical,Br,on,Jr,ln),Yr&&(Vr=new gp(vn,mt,xn,wn,gr,Yr,Qr,gi,Jr,ln))}if(Lr){const ln=Rr.layout.get("icon-rotate").evaluate(Jt,{}),_i=Rr.layout.get("icon-text-fit")!=="none",Ko=e0(Lr,ln,Yn,_i),Yi=Yr?e0(Yr,ln,Yn,_i):void 0;Fi=new gp(vn,mt,xn,wn,gr,Lr,Qr,gi,!1,ln),Zs=4*Ko.length;const Wo=tt.iconSizeData;let _s=null;Wo.kind==="source"?(_s=[ms*Rr.layout.get("icon-size").evaluate(Jt,{})],_s[0]>Va&&Tt(`${tt.layerIds[0]}: Value for "icon-size" is >= ${eh}. Reduce your "icon-size".`)):Wo.kind==="composite"&&(_s=[ms*ir.compositeIconSizes[0].evaluate(Jt,{},cr),ms*ir.compositeIconSizes[1].evaluate(Jt,{},cr)],(_s[0]>Va||_s[1]>Va)&&Tt(`${tt.layerIds[0]}: Value for "icon-size" is >= ${eh}. Reduce your "icon-size".`)),tt.addSymbols(tt.icon,Ko,_s,Bt,Bn,Jt,v.ah.none,mt,gs.lineStartIndex,gs.lineLength,-1,cr),bg=tt.icon.placedSymbolArray.length-1,Yi&&(sh=4*Yi.length,tt.addSymbols(tt.icon,Yi,_s,Bt,Bn,Jt,v.ah.vertical,mt,gs.lineStartIndex,gs.lineLength,-1,cr),Sg=tt.icon.placedSymbolArray.length-1)}const d0=Object.keys(Ht.horizontal);for(const ln of d0){const _i=Ht.horizontal[ln];if(!ys){h0=Yl(_i.text);const Yi=Rr.layout.get("text-rotate").evaluate(Jt,{},cr);ys=new gp(vn,mt,xn,wn,gr,_i,Br,on,Jr,Yi)}const Ko=_i.positionedLines.length===1;if(u0+=i0(tt,mt,_i,Bi,Rr,Jr,Jt,bn,gs,Ht.vertical?v.ah.horizontal:v.ah.horizontalOnly,Ko?d0:[ln],Gs,bg,ir,cr),Ko)break}Ht.vertical&&(c0+=i0(tt,mt,Ht.vertical,Bi,Rr,Jr,Jt,bn,gs,v.ah.vertical,["vertical"],Gs,Sg,ir,cr));const xk=ys?ys.boxStartIndex:tt.collisionBoxArray.length,wk=ys?ys.boxEndIndex:tt.collisionBoxArray.length,bk=yi?yi.boxStartIndex:tt.collisionBoxArray.length,Sk=yi?yi.boxEndIndex:tt.collisionBoxArray.length,kk=Fi?Fi.boxStartIndex:tt.collisionBoxArray.length,Tk=Fi?Fi.boxEndIndex:tt.collisionBoxArray.length,Ik=Vr?Vr.boxStartIndex:tt.collisionBoxArray.length,Ek=Vr?Vr.boxEndIndex:tt.collisionBoxArray.length;let Xi=-1;const _p=(ln,_i)=>ln&&ln.circleDiameter?Math.max(ln.circleDiameter,_i):_i;Xi=_p(ys,Xi),Xi=_p(yi,Xi),Xi=_p(Fi,Xi),Xi=_p(Vr,Xi);const p0=Xi>-1?1:0;p0&&(Xi*=hu/Mr),tt.glyphOffsetArray.length>=lu.MAX_GLYPHS&&Tt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Jt.sortKey!==void 0&&tt.addToSortKeyRanges(tt.symbolInstances.length,Jt.sortKey);const Pk=n0(Rr,Jt,cr),[Ck,Mk]=function(ln,_i){const Ko=ln.length,Yi=_i==null?void 0:_i.values;if((Yi==null?void 0:Yi.length)>0)for(let Wo=0;Wo<Yi.length;Wo+=2){const _s=Yi[Wo+1];ln.emplaceBack(v.aq[Yi[Wo]],_s[0],_s[1])}return[Ko,ln.length]}(tt.textAnchorOffsets,Pk);tt.symbolInstances.emplaceBack(mt.x,mt.y,Gs.right>=0?Gs.right:-1,Gs.center>=0?Gs.center:-1,Gs.left>=0?Gs.left:-1,Gs.vertical||-1,bg,Sg,h0,xk,wk,bk,Sk,kk,Tk,Ik,Ek,xn,u0,c0,Zs,sh,p0,0,Br,Xi,Ck,Mk)}(i,it,Ee,s,l,p,Je,i.layers[0],i.collisionBoxArray,t.index,t.sourceLayerIndex,i.index,X,[fe,fe,fe,fe],Ge,S,ge,be,ut,F,t,y,I,E,_)};if(qe==="line")for(const Ee of Kx(t.geometry,0,0,Pr,Pr)){const it=pk(Ee,ae,ze,s.vertical||V,l,24,te,i.overscaling,Pr);for(const tt of it)V&&_k(i,V.text,Ue,tt)||We(Ee,tt)}else if(qe==="line-center"){for(const Ee of t.geometry)if(Ee.length>1){const it=dk(Ee,ze,s.vertical||V,l,24,te);it&&We(Ee,it)}}else if(t.type==="Polygon")for(const Ee of El(t.geometry,0)){const it=mk(Ee,16);We(Ee[0],new $a(it.x,it.y,0))}else if(t.type==="LineString")for(const Ee of t.geometry)We(Ee,new $a(Ee[0].x,Ee[0].y,0));else if(t.type==="Point")for(const Ee of t.geometry)for(const it of Ee)We([it],new $a(it.x,it.y,0))}function i0(i,t,s,l,p,y,_,w,S,I,E,M,D,F,V){const $=function(ge,ae,fe,be,ze,Ge,ut,qe){const Ue=be.layout.get("text-rotate").evaluate(Ge,{})*Math.PI/180,nt=[];for(const Je of ae.positionedLines)for(const We of Je.positionedGlyphs){if(!We.rect)continue;const Ee=We.rect||{};let it=xx+1,tt=!0,mt=1,Xt=0;const Ht=(ze||qe)&&We.vertical,Lr=We.metrics.advance*We.scale/2;if(qe&&ae.verticalizable&&(Xt=Je.lineOffset/2-(We.imageName?-(Mr-We.metrics.width*We.scale)/2:(We.scale-1)*Mr)),We.imageName){const Bt=ut[We.imageName];tt=Bt.sdf,mt=Bt.pixelRatio,it=Rn/mt}const Bi=ze?[We.x+Lr,We.y]:[0,0];let Yr=ze?[0,0]:[We.x+Lr+fe[0],We.y+fe[1]-Xt],Rr=[0,0];Ht&&(Rr=Yr,Yr=[0,0]);const vn=We.metrics.isDoubleResolution?2:1,xn=(We.metrics.left-it)*We.scale-Lr+Yr[0],wn=(-We.metrics.top-it)*We.scale+Yr[1],gr=xn+Ee.w/vn*We.scale/mt,Br=wn+Ee.h/vn*We.scale/mt,on=new j(xn,wn),Jr=new j(gr,wn),bn=new j(xn,Br),Qr=new j(gr,Br);if(Ht){const Bt=new j(-Lr,Lr-Jc),Jt=-Math.PI/2,ir=Mr/2-Lr,Yn=new j(5-Jc-ir,-(We.imageName?ir:0)),cr=new j(...Rr);on._rotateAround(Jt,Bt)._add(Yn)._add(cr),Jr._rotateAround(Jt,Bt)._add(Yn)._add(cr),bn._rotateAround(Jt,Bt)._add(Yn)._add(cr),Qr._rotateAround(Jt,Bt)._add(Yn)._add(cr)}if(Ue){const Bt=Math.sin(Ue),Jt=Math.cos(Ue),ir=[Jt,-Bt,Bt,Jt];on._matMult(ir),Jr._matMult(ir),bn._matMult(ir),Qr._matMult(ir)}const gi=new j(0,0),Bn=new j(0,0);nt.push({tl:on,tr:Jr,bl:bn,br:Qr,tex:Ee,writingMode:ae.writingMode,glyphOffset:Bi,sectionIndex:We.sectionIndex,isSDF:tt,pixelOffsetTL:gi,pixelOffsetBR:Bn,minFontScaleX:0,minFontScaleY:0})}return nt}(0,s,w,p,y,_,l,i.allowVerticalPlacement),X=i.textSizeData;let te=null;X.kind==="source"?(te=[ms*p.layout.get("text-size").evaluate(_,{})],te[0]>Va&&Tt(`${i.layerIds[0]}: Value for "text-size" is >= ${eh}. Reduce your "text-size".`)):X.kind==="composite"&&(te=[ms*F.compositeTextSizes[0].evaluate(_,{},V),ms*F.compositeTextSizes[1].evaluate(_,{},V)],(te[0]>Va||te[1]>Va)&&Tt(`${i.layerIds[0]}: Value for "text-size" is >= ${eh}. Reduce your "text-size".`)),i.addSymbols(i.text,$,te,w,y,_,I,t,S.lineStartIndex,S.lineLength,D,V);for(const ge of E)M[ge]=i.text.placedSymbolArray.length-1;return 4*$.length}function s0(i){for(const t in i)return i[t];return null}function _k(i,t,s,l){const p=i.compareText;if(t in p){const y=p[t];for(let _=y.length-1;_>=0;_--)if(l.dist(y[_])<s)return!0}else p[t]=[];return p[t].push(l),!1}const a0=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class mg{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,l]=new Uint8Array(t,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=l>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const y=a0[15&l];if(!y)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(t,2,1),[w]=new Uint32Array(t,4,1);return new mg(w,_,y,t)}constructor(t,s=64,l=Float64Array,p){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=l,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const y=a0.indexOf(this.ArrayType),_=2*t*this.ArrayType.BYTES_PER_ELEMENT,w=t*this.IndexArrayType.BYTES_PER_ELEMENT,S=(8-w%8)%8;if(y<0)throw new Error(`Unexpected typed array class: ${l}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+w+S,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+_+w+S),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+w+S,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+y]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=t)}add(t,s){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=t,this.coords[this._pos++]=s,l}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return gg(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,s,l,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:y,coords:_,nodeSize:w}=this,S=[0,y.length-1,0],I=[];for(;S.length;){const E=S.pop()||0,M=S.pop()||0,D=S.pop()||0;if(M-D<=w){for(let X=D;X<=M;X++){const te=_[2*X],ge=_[2*X+1];te>=t&&te<=l&&ge>=s&&ge<=p&&I.push(y[X])}continue}const F=D+M>>1,V=_[2*F],$=_[2*F+1];V>=t&&V<=l&&$>=s&&$<=p&&I.push(y[F]),(E===0?t<=V:s<=$)&&(S.push(D),S.push(F-1),S.push(1-E)),(E===0?l>=V:p>=$)&&(S.push(F+1),S.push(M),S.push(1-E))}return I}within(t,s,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:y,nodeSize:_}=this,w=[0,p.length-1,0],S=[],I=l*l;for(;w.length;){const E=w.pop()||0,M=w.pop()||0,D=w.pop()||0;if(M-D<=_){for(let X=D;X<=M;X++)l0(y[2*X],y[2*X+1],t,s)<=I&&S.push(p[X]);continue}const F=D+M>>1,V=y[2*F],$=y[2*F+1];l0(V,$,t,s)<=I&&S.push(p[F]),(E===0?t-l<=V:s-l<=$)&&(w.push(D),w.push(F-1),w.push(1-E)),(E===0?t+l>=V:s+l>=$)&&(w.push(F+1),w.push(M),w.push(1-E))}return S}}function gg(i,t,s,l,p,y){if(p-l<=s)return;const _=l+p>>1;o0(i,t,_,l,p,y),gg(i,t,s,l,_-1,1-y),gg(i,t,s,_+1,p,1-y)}function o0(i,t,s,l,p,y){for(;p>l;){if(p-l>600){const I=p-l+1,E=s-l+1,M=Math.log(I),D=.5*Math.exp(2*M/3),F=.5*Math.sqrt(M*D*(I-D)/I)*(E-I/2<0?-1:1);o0(i,t,s,Math.max(l,Math.floor(s-E*D/I+F)),Math.min(p,Math.floor(s+(I-E)*D/I+F)),y)}const _=t[2*s+y];let w=l,S=p;for(nh(i,t,l,s),t[2*p+y]>_&&nh(i,t,l,p);w<S;){for(nh(i,t,w,S),w++,S--;t[2*w+y]<_;)w++;for(;t[2*S+y]>_;)S--}t[2*l+y]===_?nh(i,t,l,S):(S++,nh(i,t,S,p)),S<=s&&(l=S+1),s<=S&&(p=S-1)}}function nh(i,t,s,l){yg(i,s,l),yg(t,2*s,2*l),yg(t,2*s+1,2*l+1)}function yg(i,t,s){const l=i[t];i[t]=i[s],i[s]=l}function l0(i,t,s,l){const p=i-s,y=t-l;return p*p+y*y}var _g;v.bg=void 0,(_g=v.bg||(v.bg={})).create="create",_g.load="load",_g.fullLoad="fullLoad";let yp=null,ih=[];const vg=1e3/60,xg="loadTime",wg="fullLoadTime",vk={mark(i){performance.mark(i)},frame(i){const t=i;yp!=null&&ih.push(t-yp),yp=t},clearMetrics(){yp=null,ih=[],performance.clearMeasures(xg),performance.clearMeasures(wg);for(const i in v.bg)performance.clearMarks(v.bg[i])},getPerformanceMetrics(){performance.measure(xg,v.bg.create,v.bg.load),performance.measure(wg,v.bg.create,v.bg.fullLoad);const i=performance.getEntriesByName(xg)[0].duration,t=performance.getEntriesByName(wg)[0].duration,s=ih.length,l=1/(ih.reduce((y,_)=>y+_,0)/s/1e3),p=ih.filter(y=>y>vg).reduce((y,_)=>y+(_-vg)/vg,0);return{loadTime:i,fullLoadTime:t,fps:l,percentDroppedFrames:p/(s+p)*100,totalFrames:s}}};v.$=class extends A{},v.A=ru,v.B=Cm,v.C=function(i){if(Tr==null){const t=i.navigator?i.navigator.userAgent:null;Tr=!!i.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Tr},v.D=Qe,v.E=ca,v.F=class{constructor(i,t){this.target=i,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new ck(()=>this.process()),this.subscription=function(s,l,p,y){return s.addEventListener(l,p,!1),{unsubscribe:()=>{s.removeEventListener(l,p,!1)}}}(this.target,"message",s=>this.receive(s)),this.globalScope=vr(self)?i:window}registerMessageHandler(i,t){this.messageHandlers[i]=t}sendAsync(i,t){return new Promise((s,l)=>{const p=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[p]={resolve:s,reject:l},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[p];const w={id:p,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(w)},{once:!0});const y=[],_=Object.assign(Object.assign({},i),{id:p,sourceMapId:this.mapId,origin:location.origin,data:Ca(i.data,y)});this.target.postMessage(_,{transfer:y})})}receive(i){const t=i.data,s=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[s];const l=this.abortControllers[s];return delete this.abortControllers[s],void(l&&l.abort())}if(vr(self)||t.mustQueue)return this.tasks[s]=t,this.taskQueue.push(s),void this.invoker.trigger();this.processTask(s,t)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),t=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(i,t)}processTask(i,t){return u(this,void 0,void 0,function*(){if(t.type==="<response>"){const p=this.resolveRejects[i];return delete this.resolveRejects[i],p?void(t.error?p.reject(Ma(t.error)):p.resolve(Ma(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const s=Ma(t.data),l=new AbortController;this.abortControllers[i]=l;try{const p=yield this.messageHandlers[t.type](t.sourceMapId,s,l);this.completeTask(i,null,p)}catch(p){this.completeTask(i,p)}})}completeTask(i,t,s){const l=[];delete this.abortControllers[i];const p={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?Ca(t):null,data:Ca(s,l)};this.target.postMessage(p,{transfer:l})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},v.G=pn,v.H=function(){var i=new ru(16);return ru!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},v.I=rg,v.J=function(i,t,s){var l,p,y,_,w,S,I,E,M,D,F,V,$=s[0],X=s[1],te=s[2];return t===i?(i[12]=t[0]*$+t[4]*X+t[8]*te+t[12],i[13]=t[1]*$+t[5]*X+t[9]*te+t[13],i[14]=t[2]*$+t[6]*X+t[10]*te+t[14],i[15]=t[3]*$+t[7]*X+t[11]*te+t[15]):(p=t[1],y=t[2],_=t[3],w=t[4],S=t[5],I=t[6],E=t[7],M=t[8],D=t[9],F=t[10],V=t[11],i[0]=l=t[0],i[1]=p,i[2]=y,i[3]=_,i[4]=w,i[5]=S,i[6]=I,i[7]=E,i[8]=M,i[9]=D,i[10]=F,i[11]=V,i[12]=l*$+w*X+M*te+t[12],i[13]=p*$+S*X+D*te+t[13],i[14]=y*$+I*X+F*te+t[14],i[15]=_*$+E*X+V*te+t[15]),i},v.K=function(i,t,s){var l=s[0],p=s[1],y=s[2];return i[0]=t[0]*l,i[1]=t[1]*l,i[2]=t[2]*l,i[3]=t[3]*l,i[4]=t[4]*p,i[5]=t[5]*p,i[6]=t[6]*p,i[7]=t[7]*p,i[8]=t[8]*y,i[9]=t[9]*y,i[10]=t[10]*y,i[11]=t[11]*y,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},v.L=Uv,v.M=function(i,t){const s={};for(let l=0;l<t.length;l++){const p=t[l];p in i&&(s[p]=i[p])}return s},v.N=Ua,v.O=Fx,v.P=j,v.Q=Ox,v.R=fi,v.S=mi,v.T=Gl,v.U=K,v.V=G,v.W=ht,v.X=Pr,v.Y=b,v.Z=th,v._=u,v.a=Zr,v.a$=function(i,t){var s=i[0],l=i[1],p=i[2],y=i[3],_=i[4],w=i[5],S=i[6],I=i[7],E=i[8],M=i[9],D=i[10],F=i[11],V=i[12],$=i[13],X=i[14],te=i[15],ge=t[0],ae=t[1],fe=t[2],be=t[3],ze=t[4],Ge=t[5],ut=t[6],qe=t[7],Ue=t[8],nt=t[9],Je=t[10],We=t[11],Ee=t[12],it=t[13],tt=t[14],mt=t[15];return Math.abs(s-ge)<=_n*Math.max(1,Math.abs(s),Math.abs(ge))&&Math.abs(l-ae)<=_n*Math.max(1,Math.abs(l),Math.abs(ae))&&Math.abs(p-fe)<=_n*Math.max(1,Math.abs(p),Math.abs(fe))&&Math.abs(y-be)<=_n*Math.max(1,Math.abs(y),Math.abs(be))&&Math.abs(_-ze)<=_n*Math.max(1,Math.abs(_),Math.abs(ze))&&Math.abs(w-Ge)<=_n*Math.max(1,Math.abs(w),Math.abs(Ge))&&Math.abs(S-ut)<=_n*Math.max(1,Math.abs(S),Math.abs(ut))&&Math.abs(I-qe)<=_n*Math.max(1,Math.abs(I),Math.abs(qe))&&Math.abs(E-Ue)<=_n*Math.max(1,Math.abs(E),Math.abs(Ue))&&Math.abs(M-nt)<=_n*Math.max(1,Math.abs(M),Math.abs(nt))&&Math.abs(D-Je)<=_n*Math.max(1,Math.abs(D),Math.abs(Je))&&Math.abs(F-We)<=_n*Math.max(1,Math.abs(F),Math.abs(We))&&Math.abs(V-Ee)<=_n*Math.max(1,Math.abs(V),Math.abs(Ee))&&Math.abs($-it)<=_n*Math.max(1,Math.abs($),Math.abs(it))&&Math.abs(X-tt)<=_n*Math.max(1,Math.abs(X),Math.abs(tt))&&Math.abs(te-mt)<=_n*Math.max(1,Math.abs(te),Math.abs(mt))},v.a0=Mt,v.a1=dg,v.a2=Le,v.a3=i=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(s=>{t.onloadstart=()=>{s(t)};for(const l of i){const p=window.document.createElement("source");Ps(l)||(t.crossOrigin="Anonymous"),p.src=l,t.appendChild(p)}})},v.a4=function(){return Pe++},v.a5=Ze,v.a6=lu,v.a7=wc,v.a8=Go,v.a9=qx,v.aA=function(i){if(i.type==="custom")return new uk(i);switch(i.type){case"background":return new ak(i);case"circle":return new H2(i);case"fill":return new cS(i);case"fill-extrusion":return new TS(i);case"heatmap":return new W2(i);case"hillshade":return new Y2(i);case"line":return new DS(i);case"raster":return new lk(i);case"symbol":return new dp(i)}},v.aB=Ye,v.aC=function(i,t){if(!i)return[{command:"setStyle",args:[t]}];let s=[];try{if(!Ft(i.version,t.version))return[{command:"setStyle",args:[t]}];Ft(i.center,t.center)||s.push({command:"setCenter",args:[t.center]}),Ft(i.zoom,t.zoom)||s.push({command:"setZoom",args:[t.zoom]}),Ft(i.bearing,t.bearing)||s.push({command:"setBearing",args:[t.bearing]}),Ft(i.pitch,t.pitch)||s.push({command:"setPitch",args:[t.pitch]}),Ft(i.sprite,t.sprite)||s.push({command:"setSprite",args:[t.sprite]}),Ft(i.glyphs,t.glyphs)||s.push({command:"setGlyphs",args:[t.glyphs]}),Ft(i.transition,t.transition)||s.push({command:"setTransition",args:[t.transition]}),Ft(i.light,t.light)||s.push({command:"setLight",args:[t.light]}),Ft(i.terrain,t.terrain)||s.push({command:"setTerrain",args:[t.terrain]}),Ft(i.sky,t.sky)||s.push({command:"setSky",args:[t.sky]}),Ft(i.projection,t.projection)||s.push({command:"setProjection",args:[t.projection]});const l={},p=[];(function(_,w,S,I){let E;for(E in w=w||{},_=_||{})Object.prototype.hasOwnProperty.call(_,E)&&(Object.prototype.hasOwnProperty.call(w,E)||ls(E,S,I));for(E in w)Object.prototype.hasOwnProperty.call(w,E)&&(Object.prototype.hasOwnProperty.call(_,E)?Ft(_[E],w[E])||(_[E].type==="geojson"&&w[E].type==="geojson"&&ha(_,w,E)?lr(S,{command:"setGeoJSONSourceData",args:[E,w[E].data]}):Zi(E,w,S,I)):xo(E,w,S))})(i.sources,t.sources,p,l);const y=[];i.layers&&i.layers.forEach(_=>{"source"in _&&l[_.source]?s.push({command:"removeLayer",args:[_.id]}):y.push(_)}),s=s.concat(p),function(_,w,S){w=w||[];const I=(_=_||[]).map(wo),E=w.map(wo),M=_.reduce(bo,{}),D=w.reduce(bo,{}),F=I.slice(),V=Object.create(null);let $,X,te,ge,ae;for(let fe=0,be=0;fe<I.length;fe++)$=I[fe],Object.prototype.hasOwnProperty.call(D,$)?be++:(lr(S,{command:"removeLayer",args:[$]}),F.splice(F.indexOf($,be),1));for(let fe=0,be=0;fe<E.length;fe++)$=E[E.length-1-fe],F[F.length-1-fe]!==$&&(Object.prototype.hasOwnProperty.call(M,$)?(lr(S,{command:"removeLayer",args:[$]}),F.splice(F.lastIndexOf($,F.length-be),1)):be++,ge=F[F.length-fe],lr(S,{command:"addLayer",args:[D[$],ge]}),F.splice(F.length-fe,0,$),V[$]=!0);for(let fe=0;fe<E.length;fe++)if($=E[fe],X=M[$],te=D[$],!V[$]&&!Ft(X,te))if(Ft(X.source,te.source)&&Ft(X["source-layer"],te["source-layer"])&&Ft(X.type,te.type)){for(ae in $n(X.layout,te.layout,S,$,null,"setLayoutProperty"),$n(X.paint,te.paint,S,$,null,"setPaintProperty"),Ft(X.filter,te.filter)||lr(S,{command:"setFilter",args:[$,te.filter]}),Ft(X.minzoom,te.minzoom)&&Ft(X.maxzoom,te.maxzoom)||lr(S,{command:"setLayerZoomRange",args:[$,te.minzoom,te.maxzoom]}),X)Object.prototype.hasOwnProperty.call(X,ae)&&ae!=="layout"&&ae!=="paint"&&ae!=="filter"&&ae!=="metadata"&&ae!=="minzoom"&&ae!=="maxzoom"&&(ae.indexOf("paint.")===0?$n(X[ae],te[ae],S,$,ae.slice(6),"setPaintProperty"):Ft(X[ae],te[ae])||lr(S,{command:"setLayerProperty",args:[$,ae,te[ae]]}));for(ae in te)Object.prototype.hasOwnProperty.call(te,ae)&&!Object.prototype.hasOwnProperty.call(X,ae)&&ae!=="layout"&&ae!=="paint"&&ae!=="filter"&&ae!=="metadata"&&ae!=="minzoom"&&ae!=="maxzoom"&&(ae.indexOf("paint.")===0?$n(X[ae],te[ae],S,$,ae.slice(6),"setPaintProperty"):Ft(X[ae],te[ae])||lr(S,{command:"setLayerProperty",args:[$,ae,te[ae]]}))}else lr(S,{command:"removeLayer",args:[$]}),ge=F[F.lastIndexOf($)+1],lr(S,{command:"addLayer",args:[te,ge]})}(y,t.layers,s)}catch(l){console.warn("Unable to compute style diff:",l),s=[{command:"setStyle",args:[t]}]}return s},v.aD=function(i){const t=[],s=i.id;return s===void 0&&t.push({message:`layers.${s}: missing required property "id"`}),i.render===void 0&&t.push({message:`layers.${s}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&t.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),t},v.aE=function i(t,s){if(Array.isArray(t)){if(!Array.isArray(s)||t.length!==s.length)return!1;for(let l=0;l<t.length;l++)if(!i(t[l],s[l]))return!1;return!0}if(typeof t=="object"&&t!==null&&s!==null){if(typeof s!="object"||Object.keys(t).length!==Object.keys(s).length)return!1;for(const l in t)if(!i(t[l],s[l]))return!1;return!0}return t===s},v.aF=Ce,v.aG=rt,v.aH=class extends $o{constructor(i,t){super(i,t),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},v.aI=Qd,v.aJ=class extends $o{constructor(i,t){super(i,t),this.current=N2}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},v.aK=Av,v.aL=zv,v.aM=qt,v.aN=class extends $o{constructor(i,t){super(i,t),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},v.aO=class extends $o{constructor(i,t){super(i,t),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},v.aP=function(i,t,s,l,p,y,_){var w=1/(t-s),S=1/(l-p),I=1/(y-_);return i[0]=-2*w,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*S,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*I,i[11]=0,i[12]=(t+s)*w,i[13]=(p+l)*S,i[14]=(_+y)*I,i[15]=1,i},v.aQ=G2,v.aR=class extends ue{},v.aS=FS,v.aT=class extends ye{},v.aU=qm,v.aV=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},v.aW=Hv,v.aX=Kr,v.aY=pi,v.aZ=class extends et{},v.a_=function(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]&&i[4]===t[4]&&i[5]===t[5]&&i[6]===t[6]&&i[7]===t[7]&&i[8]===t[8]&&i[9]===t[9]&&i[10]===t[10]&&i[11]===t[11]&&i[12]===t[12]&&i[13]===t[13]&&i[14]===t[14]&&i[15]===t[15]},v.aa=function(i){const t={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,l,p,y)=>{const _=p||y;return t[l]=!_||_.toLowerCase(),""}),t["max-age"]){const s=parseInt(t["max-age"],10);isNaN(s)?delete t["max-age"]:t["max-age"]=s}return t},v.ab=function(i,t){const s=[];for(const l in i)l in t||s.push(l);return s},v.ac=Se,v.ad=function(i,t,s){var l=Math.sin(s),p=Math.cos(s),y=t[0],_=t[1],w=t[2],S=t[3],I=t[4],E=t[5],M=t[6],D=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=y*p+I*l,i[1]=_*p+E*l,i[2]=w*p+M*l,i[3]=S*p+D*l,i[4]=I*p-y*l,i[5]=E*p-_*l,i[6]=M*p-w*l,i[7]=D*p-S*l,i},v.ae=function(i){var t=new ru(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t},v.af=np,v.ag=function(i,t){let s=0,l=0;if(i.kind==="constant")l=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:p,minZoom:y,maxZoom:_}=i,w=p?Se(gn.interpolationFactor(p,t,y,_),0,1):0;i.kind==="camera"?l=mn.number(i.minSize,i.maxSize,w):s=w}return{uSizeT:s,uSize:l}},v.ai=function(i,{uSize:t,uSizeT:s},{lowerSize:l,upperSize:p}){return i.kind==="source"?l/ms:i.kind==="composite"?mn.number(l/ms,p/ms,s):t},v.aj=ag,v.ak=function(i,t,s,l){const p=t.y-i.y,y=t.x-i.x,_=l.y-s.y,w=l.x-s.x,S=_*y-w*p;if(S===0)return null;const I=(w*(i.y-s.y)-_*(i.x-s.x))/S;return new j(i.x+I*y,i.y+I*p)},v.al=Kx,v.am=Bv,v.an=Vm,v.ao=function(i){let t=1/0,s=1/0,l=-1/0,p=-1/0;for(const y of i)t=Math.min(t,y.x),s=Math.min(s,y.y),l=Math.max(l,y.x),p=Math.max(p,y.y);return[t,s,l,p]},v.ap=Mr,v.ar=sg,v.as=function(i,t){var s=t[0],l=t[1],p=t[2],y=t[3],_=t[4],w=t[5],S=t[6],I=t[7],E=t[8],M=t[9],D=t[10],F=t[11],V=t[12],$=t[13],X=t[14],te=t[15],ge=s*w-l*_,ae=s*S-p*_,fe=s*I-y*_,be=l*S-p*w,ze=l*I-y*w,Ge=p*I-y*S,ut=E*$-M*V,qe=E*X-D*V,Ue=E*te-F*V,nt=M*X-D*$,Je=M*te-F*$,We=D*te-F*X,Ee=ge*We-ae*Je+fe*nt+be*Ue-ze*qe+Ge*ut;return Ee?(i[0]=(w*We-S*Je+I*nt)*(Ee=1/Ee),i[1]=(p*Je-l*We-y*nt)*Ee,i[2]=($*Ge-X*ze+te*be)*Ee,i[3]=(D*ze-M*Ge-F*be)*Ee,i[4]=(S*Ue-_*We-I*qe)*Ee,i[5]=(s*We-p*Ue+y*qe)*Ee,i[6]=(X*fe-V*Ge-te*ae)*Ee,i[7]=(E*Ge-D*fe+F*ae)*Ee,i[8]=(_*Je-w*Ue+I*ut)*Ee,i[9]=(l*Ue-s*Je-y*ut)*Ee,i[10]=(V*ze-$*fe+te*ge)*Ee,i[11]=(M*fe-E*ze-F*ge)*Ee,i[12]=(w*qe-_*nt-S*ut)*Ee,i[13]=(s*nt-l*qe+p*ut)*Ee,i[14]=($*ae-V*be-X*ge)*Ee,i[15]=(E*be-M*ae+D*ge)*Ee,i):null},v.at=fg,v.au=ig,v.av=mg,v.aw=function(){const i={},t=we.$version;for(const s in we.$root){const l=we.$root[s];if(l.required){let p=null;p=s==="version"?t:l.type==="array"?[]:{},p!=null&&(i[s]=p)}}return i},v.ax=Rc,v.ay=si,v.az=function(i){i=i.slice();const t=Object.create(null);for(let s=0;s<i.length;s++)t[i[s].id]=i[s];for(let s=0;s<i.length;s++)"ref"in i[s]&&(i[s]=vo(i[s],t[i[s].ref]));return i},v.b=Nt,v.b0=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},v.b1=function(i,t,s){return i[0]=t[0]*s[0],i[1]=t[1]*s[1],i[2]=t[2]*s[2],i[3]=t[3]*s[3],i},v.b2=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]*t[3]},v.b3=Te,v.b4=Vx,v.b5=Nx,v.b6=function(i,t,s,l,p){var y,_=1/Math.tan(t/2);return i[0]=_/s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=_,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,p!=null&&p!==1/0?(i[10]=(p+l)*(y=1/(l-p)),i[14]=2*p*l*y):(i[10]=-1,i[14]=-2*l),i},v.b7=function(i,t,s){var l=Math.sin(s),p=Math.cos(s),y=t[4],_=t[5],w=t[6],S=t[7],I=t[8],E=t[9],M=t[10],D=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=y*p+I*l,i[5]=_*p+E*l,i[6]=w*p+M*l,i[7]=S*p+D*l,i[8]=I*p-y*l,i[9]=E*p-_*l,i[10]=M*p-w*l,i[11]=D*p-S*l,i},v.b8=ee,v.b9=_e,v.bA=px,v.bB=function(i){return i.message===Ut},v.bC=Sa,v.bD=Dn,v.ba=function(i){return i*Math.PI/180},v.bb=function(i,t){const{x:s,y:l}=th.fromLngLat(t);return!(i<0||i>25||l<0||l>=1||s<0||s>=1)},v.bc=function(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},v.bd=class extends P{},v.be=cg,v.bf=vk,v.bh=zr,v.bi=function(i,t){Zr.REGISTERED_PROTOCOLS[i]=t},v.bj=function(i){delete Zr.REGISTERED_PROTOCOLS[i]},v.bk=function(i,t){const s={};for(let p=0;p<i.length;p++){const y=t&&t[i[p].id]||Vd(i[p]);t&&(t[i[p].id]=y);let _=s[y];_||(_=s[y]=[]),_.push(i[p])}const l=[];for(const p in s)l.push(s[p]);return l},v.bl=Xe,v.bm=$x,v.bn=Zx,v.bo=bx,v.bp=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=Pr/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const t=i.bucket.layers[0],s=t.layout,l=t._unevaluatedLayout._values,p={layoutIconSize:l["icon-size"].possiblyEvaluate(new er(i.bucket.zoom+1),i.canonical),layoutTextSize:l["text-size"].possiblyEvaluate(new er(i.bucket.zoom+1),i.canonical),textMaxSize:l["text-size"].possiblyEvaluate(new er(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:I,maxZoom:E}=i.bucket.textSizeData;p.compositeTextSizes=[l["text-size"].possiblyEvaluate(new er(I),i.canonical),l["text-size"].possiblyEvaluate(new er(E),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:I,maxZoom:E}=i.bucket.iconSizeData;p.compositeIconSizes=[l["icon-size"].possiblyEvaluate(new er(I),i.canonical),l["icon-size"].possiblyEvaluate(new er(E),i.canonical)]}const y=s.get("text-line-height")*Mr,_=s.get("text-rotation-alignment")!=="viewport"&&s.get("symbol-placement")!=="point",w=s.get("text-keep-upright"),S=s.get("text-size");for(const I of i.bucket.features){const E=s.get("text-font").evaluate(I,{},i.canonical).join(","),M=S.evaluate(I,{},i.canonical),D=p.layoutTextSize.evaluate(I,{},i.canonical),F=p.layoutIconSize.evaluate(I,{},i.canonical),V={horizontal:{},vertical:void 0},$=I.text;let X,te=[0,0];if($){const fe=$.toString(),be=s.get("text-letter-spacing").evaluate(I,{},i.canonical)*Mr,ze=Mm(fe)?be:0,Ge=s.get("text-anchor").evaluate(I,{},i.canonical),ut=n0(t,I,i.canonical);if(!ut){const Je=s.get("text-radial-offset").evaluate(I,{},i.canonical);te=Je?r0(Ge,[Je*Mr,pg]):s.get("text-offset").evaluate(I,{},i.canonical).map(We=>We*Mr)}let qe=_?"center":s.get("text-justify").evaluate(I,{},i.canonical);const Ue=s.get("symbol-placement")==="point"?s.get("text-max-width").evaluate(I,{},i.canonical)*Mr:1/0,nt=()=>{i.bucket.allowVerticalPlacement&&Bc(fe)&&(V.vertical=up($,i.glyphMap,i.glyphPositions,i.imagePositions,E,Ue,y,Ge,"left",ze,te,v.ah.vertical,!0,D,M))};if(!_&&ut){const Je=new Set;if(qe==="auto")for(let Ee=0;Ee<ut.values.length;Ee+=2)Je.add(fg(ut.values[Ee]));else Je.add(qe);let We=!1;for(const Ee of Je)if(!V.horizontal[Ee])if(We)V.horizontal[Ee]=V.horizontal[0];else{const it=up($,i.glyphMap,i.glyphPositions,i.imagePositions,E,Ue,y,"center",Ee,ze,te,v.ah.horizontal,!1,D,M);it&&(V.horizontal[Ee]=it,We=it.positionedLines.length===1)}nt()}else{qe==="auto"&&(qe=fg(Ge));const Je=up($,i.glyphMap,i.glyphPositions,i.imagePositions,E,Ue,y,Ge,qe,ze,te,v.ah.horizontal,!1,D,M);Je&&(V.horizontal[qe]=Je),nt(),Bc(fe)&&_&&w&&(V.vertical=up($,i.glyphMap,i.glyphPositions,i.imagePositions,E,Ue,y,Ge,qe,ze,te,v.ah.vertical,!1,D,M))}}let ge=!1;if(I.icon&&I.icon.name){const fe=i.imageMap[I.icon.name];fe&&(X=tk(i.imagePositions[I.icon.name],s.get("icon-offset").evaluate(I,{},i.canonical),s.get("icon-anchor").evaluate(I,{},i.canonical)),ge=!!fe.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=ge:i.bucket.sdfIcons!==ge&&Tt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(fe.pixelRatio!==i.bucket.pixelRatio||s.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const ae=s0(V.horizontal)||V.vertical;i.bucket.iconsInText=!!ae&&ae.iconsInText,(ae||X)&&yk(i.bucket,I,V,X,i.imageMap,p,D,F,te,ge,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},v.bq=Jm,v.br=Wm,v.bs=Ym,v.bt=Na,v.bu=eg,v.bv=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},v.bw=function(i,t,s,l,p){return u(this,void 0,void 0,function*(){if(G())try{return yield ht(i,t,s,l,p)}catch{}return function(y,_,w,S,I){const E=y.width,M=y.height;pt&&At||(pt=new OffscreenCanvas(E,M),At=pt.getContext("2d",{willReadFrequently:!0})),pt.width=E,pt.height=M,At.drawImage(y,0,0,E,M);const D=At.getImageData(_,w,S,I);return At.clearRect(0,0,E,M),D.data}(i,t,s,l,p)})},v.bx=Ux,v.by=C,v.bz=O,v.c=ii,v.d=i=>u(void 0,void 0,void 0,function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(t)}catch(s){throw new Error(`Could not load image because of ${s.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),v.e=xe,v.f=i=>new Promise((t,s)=>{const l=new Image;l.onload=()=>{t(l),URL.revokeObjectURL(l.src),l.onload=null,window.requestAnimationFrame(()=>{l.src=He})},l.onerror=()=>s(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const p=new Blob([new Uint8Array(i)],{type:"image/png"});l.src=i.byteLength?URL.createObjectURL(p):He}),v.g=dn,v.h=(i,t)=>Es(xe(i,{type:"json"}),t),v.i=vr,v.j=os,v.k=as,v.l=(i,t)=>Es(xe(i,{type:"arrayBuffer"}),t),v.m=Es,v.n=function(i){return new eg(i).readFields(KS,[])},v.o=Zc,v.p=wx,v.q=m,v.r=Pm,v.s=Ps,v.t=Dc,v.u=Vs,v.v=we,v.w=Tt,v.x=function([i,t,s]){return t+=90,t*=Math.PI/180,s*=Math.PI/180,{x:i*Math.cos(t)*Math.sin(s),y:i*Math.sin(t)*Math.sin(s),z:i*Math.cos(s)}},v.y=mn,v.z=er}),g("worker",["./shared"],function(v){class u{constructor(B){this.keyCache={},B&&this.replace(B)}replace(B){this._layerConfigs={},this._layers={},this.update(B,[])}update(B,R){for(const Y of B){this._layerConfigs[Y.id]=Y;const le=this._layers[Y.id]=v.aA(Y);le._featureFilter=v.a7(le.filter),this.keyCache[Y.id]&&delete this.keyCache[Y.id]}for(const Y of R)delete this.keyCache[Y],delete this._layerConfigs[Y],delete this._layers[Y];this.familiesBySource={};const q=v.bk(Object.values(this._layerConfigs),this.keyCache);for(const Y of q){const le=Y.map(ve=>this._layers[ve.id]),ce=le[0];if(ce.visibility==="none")continue;const me=ce.source||"";let ie=this.familiesBySource[me];ie||(ie=this.familiesBySource[me]={});const ke=ce.sourceLayer||"_geojsonTileLayer";let Ae=ie[ke];Ae||(Ae=ie[ke]=[]),Ae.push(le)}}}class C{constructor(B){const R={},q=[];for(const me in B){const ie=B[me],ke=R[me]={};for(const Ae in ie){const ve=ie[+Ae];if(!ve||ve.bitmap.width===0||ve.bitmap.height===0)continue;const Be={x:0,y:0,w:ve.bitmap.width+2,h:ve.bitmap.height+2};q.push(Be),ke[Ae]={rect:Be,metrics:ve.metrics}}}const{w:Y,h:le}=v.p(q),ce=new v.o({width:Y||1,height:le||1});for(const me in B){const ie=B[me];for(const ke in ie){const Ae=ie[+ke];if(!Ae||Ae.bitmap.width===0||Ae.bitmap.height===0)continue;const ve=R[me][ke].rect;v.o.copy(Ae.bitmap,ce,{x:0,y:0},{x:ve.x+1,y:ve.y+1},Ae.bitmap)}}this.image=ce,this.positions=R}}v.bl("GlyphAtlas",C);class O{constructor(B){this.tileID=new v.S(B.tileID.overscaledZ,B.tileID.wrap,B.tileID.canonical.z,B.tileID.canonical.x,B.tileID.canonical.y),this.uid=B.uid,this.zoom=B.zoom,this.pixelRatio=B.pixelRatio,this.tileSize=B.tileSize,this.source=B.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=B.showCollisionBoxes,this.collectResourceTiming=!!B.collectResourceTiming,this.returnDependencies=!!B.returnDependencies,this.promoteId=B.promoteId,this.inFlightDependencies=[]}parse(B,R,q,Y){return v._(this,void 0,void 0,function*(){this.status="parsing",this.data=B,this.collisionBoxArray=new v.a5;const le=new v.bm(Object.keys(B.layers).sort()),ce=new v.bn(this.tileID,this.promoteId);ce.bucketLayerIDs=[];const me={},ie={featureIndex:ce,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:q},ke=R.familiesBySource[this.source];for(const kt in ke){const $t=B.layers[kt];if(!$t)continue;$t.version===1&&v.w(`Vector tile source "${this.source}" layer "${kt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const sr=le.encode(kt),Dr=[];for(let Nr=0;Nr<$t.length;Nr++){const nn=$t.feature(Nr),da=ce.getId(nn,kt);Dr.push({feature:nn,id:da,index:Nr,sourceLayerIndex:sr})}for(const Nr of ke[kt]){const nn=Nr[0];nn.source!==this.source&&v.w(`layer.source = ${nn.source} does not equal this.source = ${this.source}`),nn.minzoom&&this.zoom<Math.floor(nn.minzoom)||nn.maxzoom&&this.zoom>=nn.maxzoom||nn.visibility!=="none"&&(U(Nr,this.zoom,q),(me[nn.id]=nn.createBucket({index:ce.bucketLayerIDs.length,layers:Nr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:sr,sourceID:this.source})).populate(Dr,ie,this.tileID.canonical),ce.bucketLayerIDs.push(Nr.map(da=>da.id)))}}const Ae=v.aF(ie.glyphDependencies,kt=>Object.keys(kt).map(Number));this.inFlightDependencies.forEach(kt=>kt==null?void 0:kt.abort()),this.inFlightDependencies=[];let ve=Promise.resolve({});if(Object.keys(Ae).length){const kt=new AbortController;this.inFlightDependencies.push(kt),ve=Y.sendAsync({type:"GG",data:{stacks:Ae,source:this.source,tileID:this.tileID,type:"glyphs"}},kt)}const Be=Object.keys(ie.iconDependencies);let at=Promise.resolve({});if(Be.length){const kt=new AbortController;this.inFlightDependencies.push(kt),at=Y.sendAsync({type:"GI",data:{icons:Be,source:this.source,tileID:this.tileID,type:"icons"}},kt)}const lt=Object.keys(ie.patternDependencies);let zt=Promise.resolve({});if(lt.length){const kt=new AbortController;this.inFlightDependencies.push(kt),zt=Y.sendAsync({type:"GI",data:{icons:lt,source:this.source,tileID:this.tileID,type:"patterns"}},kt)}const[vt,Dt,Et]=yield Promise.all([ve,at,zt]),Ir=new C(vt),ur=new v.bo(Dt,Et);for(const kt in me){const $t=me[kt];$t instanceof v.a6?(U($t.layers,this.zoom,q),v.bp({bucket:$t,glyphMap:vt,glyphPositions:Ir.positions,imageMap:Dt,imagePositions:ur.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):$t.hasPattern&&($t instanceof v.bq||$t instanceof v.br||$t instanceof v.bs)&&(U($t.layers,this.zoom,q),$t.addFeatures(ie,this.tileID.canonical,ur.patternPositions))}return this.status="done",{buckets:Object.values(me).filter(kt=>!kt.isEmpty()),featureIndex:ce,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ir.image,imageAtlas:ur,glyphMap:this.returnDependencies?vt:null,iconMap:this.returnDependencies?Dt:null,glyphPositions:this.returnDependencies?Ir.positions:null}})}}function U(Q,B,R){const q=new v.z(B);for(const Y of Q)Y.recalculate(q,R)}class j{constructor(B,R,q){this.actor=B,this.layerIndex=R,this.availableImages=q,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(B,R){return v._(this,void 0,void 0,function*(){const q=yield v.l(B.request,R);try{return{vectorTile:new v.bt.VectorTile(new v.bu(q.data)),rawData:q.data,cacheControl:q.cacheControl,expires:q.expires}}catch(Y){const le=new Uint8Array(q.data);let ce=`Unable to parse the tile at ${B.request.url}, `;throw ce+=le[0]===31&&le[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Y.message}`,new Error(ce)}})}loadTile(B){return v._(this,void 0,void 0,function*(){const R=B.uid,q=!!(B&&B.request&&B.request.collectResourceTiming)&&new v.bv(B.request),Y=new O(B);this.loading[R]=Y;const le=new AbortController;Y.abort=le;try{const ce=yield this.loadVectorTile(B,le);if(delete this.loading[R],!ce)return null;const me=ce.rawData,ie={};ce.expires&&(ie.expires=ce.expires),ce.cacheControl&&(ie.cacheControl=ce.cacheControl);const ke={};if(q){const ve=q.finish();ve&&(ke.resourceTiming=JSON.parse(JSON.stringify(ve)))}Y.vectorTile=ce.vectorTile;const Ae=Y.parse(ce.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[R]=Y,this.fetching[R]={rawTileData:me,cacheControl:ie,resourceTiming:ke};try{const ve=yield Ae;return v.e({rawTileData:me.slice(0)},ve,ie,ke)}finally{delete this.fetching[R]}}catch(ce){throw delete this.loading[R],Y.status="done",this.loaded[R]=Y,ce}})}reloadTile(B){return v._(this,void 0,void 0,function*(){const R=B.uid;if(!this.loaded||!this.loaded[R])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const q=this.loaded[R];if(q.showCollisionBoxes=B.showCollisionBoxes,q.status==="parsing"){const Y=yield q.parse(q.vectorTile,this.layerIndex,this.availableImages,this.actor);let le;if(this.fetching[R]){const{rawTileData:ce,cacheControl:me,resourceTiming:ie}=this.fetching[R];delete this.fetching[R],le=v.e({rawTileData:ce.slice(0)},Y,me,ie)}else le=Y;return le}if(q.status==="done"&&q.vectorTile)return q.parse(q.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(B){return v._(this,void 0,void 0,function*(){const R=this.loading,q=B.uid;R&&R[q]&&R[q].abort&&(R[q].abort.abort(),delete R[q])})}removeTile(B){return v._(this,void 0,void 0,function*(){this.loaded&&this.loaded[B.uid]&&delete this.loaded[B.uid]})}}class L{constructor(){this.loaded={}}loadTile(B){return v._(this,void 0,void 0,function*(){const{uid:R,encoding:q,rawImageData:Y,redFactor:le,greenFactor:ce,blueFactor:me,baseShift:ie}=B,ke=Y.width+2,Ae=Y.height+2,ve=v.b(Y)?new v.R({width:ke,height:Ae},yield v.bw(Y,-1,-1,ke,Ae)):Y,Be=new v.bx(R,ve,q,le,ce,me,ie);return this.loaded=this.loaded||{},this.loaded[R]=Be,Be})}removeTile(B){const R=this.loaded,q=B.uid;R&&R[q]&&delete R[q]}}function oe(Q,B){if(Q.length!==0){de(Q[0],B);for(var R=1;R<Q.length;R++)de(Q[R],!B)}}function de(Q,B){for(var R=0,q=0,Y=0,le=Q.length,ce=le-1;Y<le;ce=Y++){var me=(Q[Y][0]-Q[ce][0])*(Q[ce][1]+Q[Y][1]),ie=R+me;q+=Math.abs(R)>=Math.abs(me)?R-ie+me:me-ie+R,R=ie}R+q>=0!=!!B&&Q.reverse()}var he=v.by(function Q(B,R){var q,Y=B&&B.type;if(Y==="FeatureCollection")for(q=0;q<B.features.length;q++)Q(B.features[q],R);else if(Y==="GeometryCollection")for(q=0;q<B.geometries.length;q++)Q(B.geometries[q],R);else if(Y==="Feature")Q(B.geometry,R);else if(Y==="Polygon")oe(B.coordinates,R);else if(Y==="MultiPolygon")for(q=0;q<B.coordinates.length;q++)oe(B.coordinates[q],R);return B});const Ie=v.bt.VectorTileFeature.prototype.toGeoJSON;var K={exports:{}},G=v.bz,ee=v.bt.VectorTileFeature,_e=Se;function Se(Q,B){this.options=B||{},this.features=Q,this.length=Q.length}function Te(Q,B){this.id=typeof Q.id=="number"?Q.id:void 0,this.type=Q.type,this.rawGeometry=Q.type===1?[Q.geometry]:Q.geometry,this.properties=Q.tags,this.extent=B||4096}Se.prototype.feature=function(Q){return new Te(this.features[Q],this.options.extent)},Te.prototype.loadGeometry=function(){var Q=this.rawGeometry;this.geometry=[];for(var B=0;B<Q.length;B++){for(var R=Q[B],q=[],Y=0;Y<R.length;Y++)q.push(new G(R[Y][0],R[Y][1]));this.geometry.push(q)}return this.geometry},Te.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Q=this.geometry,B=1/0,R=-1/0,q=1/0,Y=-1/0,le=0;le<Q.length;le++)for(var ce=Q[le],me=0;me<ce.length;me++){var ie=ce[me];B=Math.min(B,ie.x),R=Math.max(R,ie.x),q=Math.min(q,ie.y),Y=Math.max(Y,ie.y)}return[B,q,R,Y]},Te.prototype.toGeoJSON=ee.prototype.toGeoJSON;var xe=v.bA,Pe=_e;function Ce(Q){var B=new xe;return function(R,q){for(var Y in R.layers)q.writeMessage(3,rt,R.layers[Y])}(Q,B),B.finish()}function rt(Q,B){var R;B.writeVarintField(15,Q.version||1),B.writeStringField(1,Q.name||""),B.writeVarintField(5,Q.extent||4096);var q={keys:[],values:[],keycache:{},valuecache:{}};for(R=0;R<Q.length;R++)q.feature=Q.feature(R),B.writeMessage(2,Ye,q);var Y=q.keys;for(R=0;R<Y.length;R++)B.writeStringField(3,Y[R]);var le=q.values;for(R=0;R<le.length;R++)B.writeMessage(4,Tr,le[R])}function Ye(Q,B){var R=Q.feature;R.id!==void 0&&B.writeVarintField(1,R.id),B.writeMessage(2,Wt,Q),B.writeVarintField(3,R.type),B.writeMessage(4,vr,R)}function Wt(Q,B){var R=Q.feature,q=Q.keys,Y=Q.values,le=Q.keycache,ce=Q.valuecache;for(var me in R.properties){var ie=R.properties[me],ke=le[me];if(ie!==null){ke===void 0&&(q.push(me),le[me]=ke=q.length-1),B.writeVarint(ke);var Ae=typeof ie;Ae!=="string"&&Ae!=="boolean"&&Ae!=="number"&&(ie=JSON.stringify(ie));var ve=Ae+":"+ie,Be=ce[ve];Be===void 0&&(Y.push(ie),ce[ve]=Be=Y.length-1),B.writeVarint(Be)}}}function Tt(Q,B){return(B<<3)+(7&Q)}function bt(Q){return Q<<1^Q>>31}function vr(Q,B){for(var R=Q.loadGeometry(),q=Q.type,Y=0,le=0,ce=R.length,me=0;me<ce;me++){var ie=R[me],ke=1;q===1&&(ke=ie.length),B.writeVarint(Tt(1,ke));for(var Ae=q===3?ie.length-1:ie.length,ve=0;ve<Ae;ve++){ve===1&&q!==1&&B.writeVarint(Tt(2,Ae-1));var Be=ie[ve].x-Y,at=ie[ve].y-le;B.writeVarint(bt(Be)),B.writeVarint(bt(at)),Y+=Be,le+=at}q===3&&B.writeVarint(Tt(7,1))}}function Tr(Q,B){var R=typeof Q;R==="string"?B.writeStringField(1,Q):R==="boolean"?B.writeBooleanField(7,Q):R==="number"&&(Q%1!=0?B.writeDoubleField(3,Q):Q<0?B.writeSVarintField(6,Q):B.writeVarintField(5,Q))}K.exports=Ce,K.exports.fromVectorTileJs=Ce,K.exports.fromGeojsonVt=function(Q,B){B=B||{};var R={};for(var q in Q)R[q]=new Pe(Q[q].features,B),R[q].name=q,R[q].version=B.version,R[q].extent=B.extent;return Ce({layers:R})},K.exports.GeoJSONWrapper=Pe;var Nt=v.by(K.exports);const He={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Q=>Q},ht=Math.fround||(pt=new Float32Array(1),Q=>(pt[0]=+Q,pt[0]));var pt;const At=3,Ut=5,ii=6;class Zr{constructor(B){this.options=Object.assign(Object.create(He),B),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(B){const{log:R,minZoom:q,maxZoom:Y}=this.options;R&&console.time("total time");const le=`prepare ${B.length} points`;R&&console.time(le),this.points=B;const ce=[];for(let ie=0;ie<B.length;ie++){const ke=B[ie];if(!ke.geometry)continue;const[Ae,ve]=ke.geometry.coordinates,Be=ht(zr(Ae)),at=ht(si(ve));ce.push(Be,at,1/0,ie,-1,1),this.options.reduce&&ce.push(0)}let me=this.trees[Y+1]=this._createTree(ce);R&&console.timeEnd(le);for(let ie=Y;ie>=q;ie--){const ke=+Date.now();me=this.trees[ie]=this._createTree(this._cluster(me,ie)),R&&console.log("z%d: %d clusters in %dms",ie,me.numItems,+Date.now()-ke)}return R&&console.timeEnd("total time"),this}getClusters(B,R){let q=((B[0]+180)%360+360)%360-180;const Y=Math.max(-90,Math.min(90,B[1]));let le=B[2]===180?180:((B[2]+180)%360+360)%360-180;const ce=Math.max(-90,Math.min(90,B[3]));if(B[2]-B[0]>=360)q=-180,le=180;else if(q>le){const ve=this.getClusters([q,Y,180,ce],R),Be=this.getClusters([-180,Y,le,ce],R);return ve.concat(Be)}const me=this.trees[this._limitZoom(R)],ie=me.range(zr(q),si(ce),zr(le),si(Y)),ke=me.data,Ae=[];for(const ve of ie){const Be=this.stride*ve;Ae.push(ke[Be+Ut]>1?dn(ke,Be,this.clusterProps):this.points[ke[Be+At]])}return Ae}getChildren(B){const R=this._getOriginId(B),q=this._getOriginZoom(B),Y="No cluster with the specified id.",le=this.trees[q];if(!le)throw new Error(Y);const ce=le.data;if(R*this.stride>=ce.length)throw new Error(Y);const me=this.options.radius/(this.options.extent*Math.pow(2,q-1)),ie=le.within(ce[R*this.stride],ce[R*this.stride+1],me),ke=[];for(const Ae of ie){const ve=Ae*this.stride;ce[ve+4]===B&&ke.push(ce[ve+Ut]>1?dn(ce,ve,this.clusterProps):this.points[ce[ve+At]])}if(ke.length===0)throw new Error(Y);return ke}getLeaves(B,R,q){const Y=[];return this._appendLeaves(Y,B,R=R||10,q=q||0,0),Y}getTile(B,R,q){const Y=this.trees[this._limitZoom(B)],le=Math.pow(2,B),{extent:ce,radius:me}=this.options,ie=me/ce,ke=(q-ie)/le,Ae=(q+1+ie)/le,ve={features:[]};return this._addTileFeatures(Y.range((R-ie)/le,ke,(R+1+ie)/le,Ae),Y.data,R,q,le,ve),R===0&&this._addTileFeatures(Y.range(1-ie/le,ke,1,Ae),Y.data,le,q,le,ve),R===le-1&&this._addTileFeatures(Y.range(0,ke,ie/le,Ae),Y.data,-1,q,le,ve),ve.features.length?ve:null}getClusterExpansionZoom(B){let R=this._getOriginZoom(B)-1;for(;R<=this.options.maxZoom;){const q=this.getChildren(B);if(R++,q.length!==1)break;B=q[0].properties.cluster_id}return R}_appendLeaves(B,R,q,Y,le){const ce=this.getChildren(R);for(const me of ce){const ie=me.properties;if(ie&&ie.cluster?le+ie.point_count<=Y?le+=ie.point_count:le=this._appendLeaves(B,ie.cluster_id,q,Y,le):le<Y?le++:B.push(me),B.length===q)break}return le}_createTree(B){const R=new v.av(B.length/this.stride|0,this.options.nodeSize,Float32Array);for(let q=0;q<B.length;q+=this.stride)R.add(B[q],B[q+1]);return R.finish(),R.data=B,R}_addTileFeatures(B,R,q,Y,le,ce){for(const me of B){const ie=me*this.stride,ke=R[ie+Ut]>1;let Ae,ve,Be;if(ke)Ae=pn(R,ie,this.clusterProps),ve=R[ie],Be=R[ie+1];else{const zt=this.points[R[ie+At]];Ae=zt.properties;const[vt,Dt]=zt.geometry.coordinates;ve=zr(vt),Be=si(Dt)}const at={type:1,geometry:[[Math.round(this.options.extent*(ve*le-q)),Math.round(this.options.extent*(Be*le-Y))]],tags:Ae};let lt;lt=ke||this.options.generateId?R[ie+At]:this.points[R[ie+At]].id,lt!==void 0&&(at.id=lt),ce.features.push(at)}}_limitZoom(B){return Math.max(this.options.minZoom,Math.min(Math.floor(+B),this.options.maxZoom+1))}_cluster(B,R){const{radius:q,extent:Y,reduce:le,minPoints:ce}=this.options,me=q/(Y*Math.pow(2,R)),ie=B.data,ke=[],Ae=this.stride;for(let ve=0;ve<ie.length;ve+=Ae){if(ie[ve+2]<=R)continue;ie[ve+2]=R;const Be=ie[ve],at=ie[ve+1],lt=B.within(ie[ve],ie[ve+1],me),zt=ie[ve+Ut];let vt=zt;for(const Dt of lt){const Et=Dt*Ae;ie[Et+2]>R&&(vt+=ie[Et+Ut])}if(vt>zt&&vt>=ce){let Dt,Et=Be*zt,Ir=at*zt,ur=-1;const kt=((ve/Ae|0)<<5)+(R+1)+this.points.length;for(const $t of lt){const sr=$t*Ae;if(ie[sr+2]<=R)continue;ie[sr+2]=R;const Dr=ie[sr+Ut];Et+=ie[sr]*Dr,Ir+=ie[sr+1]*Dr,ie[sr+4]=kt,le&&(Dt||(Dt=this._map(ie,ve,!0),ur=this.clusterProps.length,this.clusterProps.push(Dt)),le(Dt,this._map(ie,sr)))}ie[ve+4]=kt,ke.push(Et/vt,Ir/vt,1/0,kt,-1,vt),le&&ke.push(ur)}else{for(let Dt=0;Dt<Ae;Dt++)ke.push(ie[ve+Dt]);if(vt>1)for(const Dt of lt){const Et=Dt*Ae;if(!(ie[Et+2]<=R)){ie[Et+2]=R;for(let Ir=0;Ir<Ae;Ir++)ke.push(ie[Et+Ir])}}}}return ke}_getOriginId(B){return B-this.points.length>>5}_getOriginZoom(B){return(B-this.points.length)%32}_map(B,R,q){if(B[R+Ut]>1){const ce=this.clusterProps[B[R+ii]];return q?Object.assign({},ce):ce}const Y=this.points[B[R+At]].properties,le=this.options.map(Y);return q&&le===Y?Object.assign({},le):le}}function dn(Q,B,R){return{type:"Feature",id:Q[B+At],properties:pn(Q,B,R),geometry:{type:"Point",coordinates:[(q=Q[B],360*(q-.5)),Es(Q[B+1])]}};var q}function pn(Q,B,R){const q=Q[B+Ut],Y=q>=1e4?`${Math.round(q/1e3)}k`:q>=1e3?Math.round(q/100)/10+"k":q,le=Q[B+ii],ce=le===-1?{}:Object.assign({},R[le]);return Object.assign(ce,{cluster:!0,cluster_id:Q[B+At],point_count:q,point_count_abbreviated:Y})}function zr(Q){return Q/360+.5}function si(Q){const B=Math.sin(Q*Math.PI/180),R=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return R<0?0:R>1?1:R}function Es(Q){const B=(180-360*Q)*Math.PI/180;return 360*Math.atan(Math.exp(B))/Math.PI-90}function Ps(Q,B,R,q){let Y=q;const le=B+(R-B>>1);let ce,me=R-B;const ie=Q[B],ke=Q[B+1],Ae=Q[R],ve=Q[R+1];for(let Be=B+3;Be<R;Be+=3){const at=_o(Q[Be],Q[Be+1],ie,ke,Ae,ve);if(at>Y)ce=Be,Y=at;else if(at===Y){const lt=Math.abs(Be-le);lt<me&&(ce=Be,me=lt)}}Y>q&&(ce-B>3&&Ps(Q,B,ce,q),Q[ce+2]=Y,R-ce>3&&Ps(Q,ce,R,q))}function _o(Q,B,R,q,Y,le){let ce=Y-R,me=le-q;if(ce!==0||me!==0){const ie=((Q-R)*ce+(B-q)*me)/(ce*ce+me*me);ie>1?(R=Y,q=le):ie>0&&(R+=ce*ie,q+=me*ie)}return ce=Q-R,me=B-q,ce*ce+me*me}function qi(Q,B,R,q){const Y={id:Q??null,type:B,geometry:R,tags:q,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(B==="Point"||B==="MultiPoint"||B==="LineString")as(Y,R);else if(B==="Polygon")as(Y,R[0]);else if(B==="MultiLineString")for(const le of R)as(Y,le);else if(B==="MultiPolygon")for(const le of R)as(Y,le[0]);return Y}function as(Q,B){for(let R=0;R<B.length;R+=3)Q.minX=Math.min(Q.minX,B[R]),Q.minY=Math.min(Q.minY,B[R+1]),Q.maxX=Math.max(Q.maxX,B[R]),Q.maxY=Math.max(Q.maxY,B[R+1])}function os(Q,B,R,q){if(!B.geometry)return;const Y=B.geometry.coordinates;if(Y&&Y.length===0)return;const le=B.geometry.type,ce=Math.pow(R.tolerance/((1<<R.maxZoom)*R.extent),2);let me=[],ie=B.id;if(R.promoteId?ie=B.properties[R.promoteId]:R.generateId&&(ie=q||0),le==="Point")ca(Y,me);else if(le==="MultiPoint")for(const ke of Y)ca(ke,me);else if(le==="LineString")we(Y,me,ce,!1);else if(le==="MultiLineString"){if(R.lineMetrics){for(const ke of Y)me=[],we(ke,me,ce,!1),Q.push(qi(ie,"LineString",me,B.properties));return}Cs(Y,me,ce,!1)}else if(le==="Polygon")Cs(Y,me,ce,!0);else{if(le!=="MultiPolygon"){if(le==="GeometryCollection"){for(const ke of B.geometry.geometries)os(Q,{id:ie,geometry:ke,properties:B.properties},R,q);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const ke of Y){const Ae=[];Cs(ke,Ae,ce,!0),me.push(Ae)}}Q.push(qi(ie,le,me,B.properties))}function ca(Q,B){B.push(vo(Q[0]),Ft(Q[1]),0)}function we(Q,B,R,q){let Y,le,ce=0;for(let ie=0;ie<Q.length;ie++){const ke=vo(Q[ie][0]),Ae=Ft(Q[ie][1]);B.push(ke,Ae,0),ie>0&&(ce+=q?(Y*Ae-ke*le)/2:Math.sqrt(Math.pow(ke-Y,2)+Math.pow(Ae-le,2))),Y=ke,le=Ae}const me=B.length-3;B[2]=1,Ps(B,0,me,R),B[me+2]=1,B.size=Math.abs(ce),B.start=0,B.end=B.size}function Cs(Q,B,R,q){for(let Y=0;Y<Q.length;Y++){const le=[];we(Q[Y],le,R,q),B.push(le)}}function vo(Q){return Q/360+.5}function Ft(Q){const B=Math.sin(Q*Math.PI/180),R=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return R<0?0:R>1?1:R}function lr(Q,B,R,q,Y,le,ce,me){if(q/=B,le>=(R/=B)&&ce<q)return Q;if(ce<R||le>=q)return null;const ie=[];for(const ke of Q){const Ae=ke.geometry;let ve=ke.type;const Be=Y===0?ke.minX:ke.minY,at=Y===0?ke.maxX:ke.maxY;if(Be>=R&&at<q){ie.push(ke);continue}if(at<R||Be>=q)continue;let lt=[];if(ve==="Point"||ve==="MultiPoint")xo(Ae,lt,R,q,Y);else if(ve==="LineString")ls(Ae,lt,R,q,Y,!1,me.lineMetrics);else if(ve==="MultiLineString")ha(Ae,lt,R,q,Y,!1);else if(ve==="Polygon")ha(Ae,lt,R,q,Y,!0);else if(ve==="MultiPolygon")for(const zt of Ae){const vt=[];ha(zt,vt,R,q,Y,!0),vt.length&&lt.push(vt)}if(lt.length){if(me.lineMetrics&&ve==="LineString"){for(const zt of lt)ie.push(qi(ke.id,ve,zt,ke.tags));continue}ve!=="LineString"&&ve!=="MultiLineString"||(lt.length===1?(ve="LineString",lt=lt[0]):ve="MultiLineString"),ve!=="Point"&&ve!=="MultiPoint"||(ve=lt.length===3?"Point":"MultiPoint"),ie.push(qi(ke.id,ve,lt,ke.tags))}}return ie.length?ie:null}function xo(Q,B,R,q,Y){for(let le=0;le<Q.length;le+=3){const ce=Q[le+Y];ce>=R&&ce<=q&&$n(B,Q[le],Q[le+1],Q[le+2])}}function ls(Q,B,R,q,Y,le,ce){let me=Zi(Q);const ie=Y===0?wo:bo;let ke,Ae,ve=Q.start;for(let vt=0;vt<Q.length-3;vt+=3){const Dt=Q[vt],Et=Q[vt+1],Ir=Q[vt+2],ur=Q[vt+3],kt=Q[vt+4],$t=Y===0?Dt:Et,sr=Y===0?ur:kt;let Dr=!1;ce&&(ke=Math.sqrt(Math.pow(Dt-ur,2)+Math.pow(Et-kt,2))),$t<R?sr>R&&(Ae=ie(me,Dt,Et,ur,kt,R),ce&&(me.start=ve+ke*Ae)):$t>q?sr<q&&(Ae=ie(me,Dt,Et,ur,kt,q),ce&&(me.start=ve+ke*Ae)):$n(me,Dt,Et,Ir),sr<R&&$t>=R&&(Ae=ie(me,Dt,Et,ur,kt,R),Dr=!0),sr>q&&$t<=q&&(Ae=ie(me,Dt,Et,ur,kt,q),Dr=!0),!le&&Dr&&(ce&&(me.end=ve+ke*Ae),B.push(me),me=Zi(Q)),ce&&(ve+=ke)}let Be=Q.length-3;const at=Q[Be],lt=Q[Be+1],zt=Y===0?at:lt;zt>=R&&zt<=q&&$n(me,at,lt,Q[Be+2]),Be=me.length-3,le&&Be>=3&&(me[Be]!==me[0]||me[Be+1]!==me[1])&&$n(me,me[0],me[1],me[2]),me.length&&B.push(me)}function Zi(Q){const B=[];return B.size=Q.size,B.start=Q.start,B.end=Q.end,B}function ha(Q,B,R,q,Y,le){for(const ce of Q)ls(ce,B,R,q,Y,le,!1)}function $n(Q,B,R,q){Q.push(B,R,q)}function wo(Q,B,R,q,Y,le){const ce=(le-B)/(q-B);return $n(Q,le,R+(Y-R)*ce,1),ce}function bo(Q,B,R,q,Y,le){const ce=(le-R)/(Y-R);return $n(Q,B+(q-B)*ce,le,1),ce}function Le(Q,B){const R=[];for(let q=0;q<Q.length;q++){const Y=Q[q],le=Y.type;let ce;if(le==="Point"||le==="MultiPoint"||le==="LineString")ce=Pi(Y.geometry,B);else if(le==="MultiLineString"||le==="Polygon"){ce=[];for(const me of Y.geometry)ce.push(Pi(me,B))}else if(le==="MultiPolygon"){ce=[];for(const me of Y.geometry){const ie=[];for(const ke of me)ie.push(Pi(ke,B));ce.push(ie)}}R.push(qi(Y.id,le,ce,Y.tags))}return R}function Pi(Q,B){const R=[];R.size=Q.size,Q.start!==void 0&&(R.start=Q.start,R.end=Q.end);for(let q=0;q<Q.length;q+=3)R.push(Q[q]+B,Q[q+1],Q[q+2]);return R}function rn(Q,B){if(Q.transformed)return Q;const R=1<<Q.z,q=Q.x,Y=Q.y;for(const le of Q.features){const ce=le.geometry,me=le.type;if(le.geometry=[],me===1)for(let ie=0;ie<ce.length;ie+=2)le.geometry.push(Ci(ce[ie],ce[ie+1],B,R,q,Y));else for(let ie=0;ie<ce.length;ie++){const ke=[];for(let Ae=0;Ae<ce[ie].length;Ae+=2)ke.push(Ci(ce[ie][Ae],ce[ie][Ae+1],B,R,q,Y));le.geometry.push(ke)}}return Q.transformed=!0,Q}function Ci(Q,B,R,q,Y,le){return[Math.round(R*(Q*q-Y)),Math.round(R*(B*q-le))]}function us(Q,B,R,q,Y){const le=B===Y.maxZoom?0:Y.tolerance/((1<<B)*Y.extent),ce={features:[],numPoints:0,numSimplified:0,numFeatures:Q.length,source:null,x:R,y:q,z:B,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const me of Q)Ne(ce,me,le,Y);return ce}function Ne(Q,B,R,q){const Y=B.geometry,le=B.type,ce=[];if(Q.minX=Math.min(Q.minX,B.minX),Q.minY=Math.min(Q.minY,B.minY),Q.maxX=Math.max(Q.maxX,B.maxX),Q.maxY=Math.max(Q.maxY,B.maxY),le==="Point"||le==="MultiPoint")for(let me=0;me<Y.length;me+=3)ce.push(Y[me],Y[me+1]),Q.numPoints++,Q.numSimplified++;else if(le==="LineString")St(ce,Y,Q,R,!1,!1);else if(le==="MultiLineString"||le==="Polygon")for(let me=0;me<Y.length;me++)St(ce,Y[me],Q,R,le==="Polygon",me===0);else if(le==="MultiPolygon")for(let me=0;me<Y.length;me++){const ie=Y[me];for(let ke=0;ke<ie.length;ke++)St(ce,ie[ke],Q,R,!0,ke===0)}if(ce.length){let me=B.tags||null;if(le==="LineString"&&q.lineMetrics){me={};for(const ke in B.tags)me[ke]=B.tags[ke];me.mapbox_clip_start=Y.start/Y.size,me.mapbox_clip_end=Y.end/Y.size}const ie={geometry:ce,type:le==="Polygon"||le==="MultiPolygon"?3:le==="LineString"||le==="MultiLineString"?2:1,tags:me};B.id!==null&&(ie.id=B.id),Q.features.push(ie)}}function St(Q,B,R,q,Y,le){const ce=q*q;if(q>0&&B.size<(Y?ce:q))return void(R.numPoints+=B.length/3);const me=[];for(let ie=0;ie<B.length;ie+=3)(q===0||B[ie+2]>ce)&&(R.numSimplified++,me.push(B[ie],B[ie+1])),R.numPoints++;Y&&function(ie,ke){let Ae=0;for(let ve=0,Be=ie.length,at=Be-2;ve<Be;at=ve,ve+=2)Ae+=(ie[ve]-ie[at])*(ie[ve+1]+ie[at+1]);if(Ae>0===ke)for(let ve=0,Be=ie.length;ve<Be/2;ve+=2){const at=ie[ve],lt=ie[ve+1];ie[ve]=ie[Be-2-ve],ie[ve+1]=ie[Be-1-ve],ie[Be-2-ve]=at,ie[Be-1-ve]=lt}}(me,le),Q.push(me)}const dt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class fn{constructor(B,R){const q=(R=this.options=function(le,ce){for(const me in ce)le[me]=ce[me];return le}(Object.create(dt),R)).debug;if(q&&console.time("preprocess data"),R.maxZoom<0||R.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(R.promoteId&&R.generateId)throw new Error("promoteId and generateId cannot be used together.");let Y=function(le,ce){const me=[];if(le.type==="FeatureCollection")for(let ie=0;ie<le.features.length;ie++)os(me,le.features[ie],ce,ie);else os(me,le.type==="Feature"?le:{geometry:le},ce);return me}(B,R);this.tiles={},this.tileCoords=[],q&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",R.indexMaxZoom,R.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Y=function(le,ce){const me=ce.buffer/ce.extent;let ie=le;const ke=lr(le,1,-1-me,me,0,-1,2,ce),Ae=lr(le,1,1-me,2+me,0,-1,2,ce);return(ke||Ae)&&(ie=lr(le,1,-me,1+me,0,-1,2,ce)||[],ke&&(ie=Le(ke,1).concat(ie)),Ae&&(ie=ie.concat(Le(Ae,-1)))),ie}(Y,R),Y.length&&this.splitTile(Y,0,0,0),q&&(Y.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(B,R,q,Y,le,ce,me){const ie=[B,R,q,Y],ke=this.options,Ae=ke.debug;for(;ie.length;){Y=ie.pop(),q=ie.pop(),R=ie.pop(),B=ie.pop();const ve=1<<R,Be=ai(R,q,Y);let at=this.tiles[Be];if(!at&&(Ae>1&&console.time("creation"),at=this.tiles[Be]=us(B,R,q,Y,ke),this.tileCoords.push({z:R,x:q,y:Y}),Ae)){Ae>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",R,q,Y,at.numFeatures,at.numPoints,at.numSimplified),console.timeEnd("creation"));const Dr=`z${R}`;this.stats[Dr]=(this.stats[Dr]||0)+1,this.total++}if(at.source=B,le==null){if(R===ke.indexMaxZoom||at.numPoints<=ke.indexMaxPoints)continue}else{if(R===ke.maxZoom||R===le)continue;if(le!=null){const Dr=le-R;if(q!==ce>>Dr||Y!==me>>Dr)continue}}if(at.source=null,B.length===0)continue;Ae>1&&console.time("clipping");const lt=.5*ke.buffer/ke.extent,zt=.5-lt,vt=.5+lt,Dt=1+lt;let Et=null,Ir=null,ur=null,kt=null,$t=lr(B,ve,q-lt,q+vt,0,at.minX,at.maxX,ke),sr=lr(B,ve,q+zt,q+Dt,0,at.minX,at.maxX,ke);B=null,$t&&(Et=lr($t,ve,Y-lt,Y+vt,1,at.minY,at.maxY,ke),Ir=lr($t,ve,Y+zt,Y+Dt,1,at.minY,at.maxY,ke),$t=null),sr&&(ur=lr(sr,ve,Y-lt,Y+vt,1,at.minY,at.maxY,ke),kt=lr(sr,ve,Y+zt,Y+Dt,1,at.minY,at.maxY,ke),sr=null),Ae>1&&console.timeEnd("clipping"),ie.push(Et||[],R+1,2*q,2*Y),ie.push(Ir||[],R+1,2*q,2*Y+1),ie.push(ur||[],R+1,2*q+1,2*Y),ie.push(kt||[],R+1,2*q+1,2*Y+1)}}getTile(B,R,q){B=+B,R=+R,q=+q;const Y=this.options,{extent:le,debug:ce}=Y;if(B<0||B>24)return null;const me=1<<B,ie=ai(B,R=R+me&me-1,q);if(this.tiles[ie])return rn(this.tiles[ie],le);ce>1&&console.log("drilling down to z%d-%d-%d",B,R,q);let ke,Ae=B,ve=R,Be=q;for(;!ke&&Ae>0;)Ae--,ve>>=1,Be>>=1,ke=this.tiles[ai(Ae,ve,Be)];return ke&&ke.source?(ce>1&&(console.log("found parent tile z%d-%d-%d",Ae,ve,Be),console.time("drilling down")),this.splitTile(ke.source,Ae,ve,Be,B,R,q),ce>1&&console.timeEnd("drilling down"),this.tiles[ie]?rn(this.tiles[ie],le):null):null}}function ai(Q,B,R){return 32*((1<<Q)*R+B)+Q}function _t(Q,B){return B?Q.properties[B]:Q.id}function Mi(Q,B){if(Q==null)return!0;if(Q.type==="Feature")return _t(Q,B)!=null;if(Q.type==="FeatureCollection"){const R=new Set;for(const q of Q.features){const Y=_t(q,B);if(Y==null||R.has(Y))return!1;R.add(Y)}return!0}return!1}function Gi(Q,B){const R=new Map;if(Q!=null)if(Q.type==="Feature")R.set(_t(Q,B),Q);else for(const q of Q.features)R.set(_t(q,B),q);return R}class cs extends j{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(B,R){return v._(this,void 0,void 0,function*(){const q=B.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Y=this._geoJSONIndex.getTile(q.z,q.x,q.y);if(!Y)return null;const le=new class{constructor(me){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=v.X,this.length=me.length,this._features=me}feature(me){return new class{constructor(ie){this._feature=ie,this.extent=v.X,this.type=ie.type,this.properties=ie.tags,"id"in ie&&!isNaN(ie.id)&&(this.id=parseInt(ie.id,10))}loadGeometry(){if(this._feature.type===1){const ie=[];for(const ke of this._feature.geometry)ie.push([new v.P(ke[0],ke[1])]);return ie}{const ie=[];for(const ke of this._feature.geometry){const Ae=[];for(const ve of ke)Ae.push(new v.P(ve[0],ve[1]));ie.push(Ae)}return ie}}toGeoJSON(ie,ke,Ae){return Ie.call(this,ie,ke,Ae)}}(this._features[me])}}(Y.features);let ce=Nt(le);return ce.byteOffset===0&&ce.byteLength===ce.buffer.byteLength||(ce=new Uint8Array(ce)),{vectorTile:le,rawData:ce.buffer}})}loadData(B){return v._(this,void 0,void 0,function*(){var R;(R=this._pendingRequest)===null||R===void 0||R.abort();const q=!!(B&&B.request&&B.request.collectResourceTiming)&&new v.bv(B.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(B,this._pendingRequest),this._geoJSONIndex=B.cluster?new Zr(function({superclusterOptions:ce,clusterProperties:me}){if(!me||!ce)return ce;const ie={},ke={},Ae={accumulated:null,zoom:0},ve={properties:null},Be=Object.keys(me);for(const at of Be){const[lt,zt]=me[at],vt=v.bC(zt),Dt=v.bC(typeof lt=="string"?[lt,["accumulated"],["get",at]]:lt);ie[at]=vt.value,ke[at]=Dt.value}return ce.map=at=>{ve.properties=at;const lt={};for(const zt of Be)lt[zt]=ie[zt].evaluate(Ae,ve);return lt},ce.reduce=(at,lt)=>{ve.properties=lt;for(const zt of Be)Ae.accumulated=at[zt],at[zt]=ke[zt].evaluate(Ae,ve)},ce}(B)).load((yield this._pendingData).features):(Y=yield this._pendingData,new fn(Y,B.geojsonVtOptions)),this.loaded={};const le={};if(q){const ce=q.finish();ce&&(le.resourceTiming={},le.resourceTiming[B.source]=JSON.parse(JSON.stringify(ce)))}return le}catch(le){if(delete this._pendingRequest,v.bB(le))return{abandoned:!0};throw le}var Y})}getData(){return v._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(B){const R=this.loaded;return R&&R[B.uid]?super.reloadTile(B):this.loadTile(B)}loadAndProcessGeoJSON(B,R){return v._(this,void 0,void 0,function*(){let q=yield this.loadGeoJSON(B,R);if(delete this._pendingRequest,typeof q!="object")throw new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`);if(he(q,!0),B.filter){const Y=v.bC(B.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Y.result==="error")throw new Error(Y.value.map(ce=>`${ce.key}: ${ce.message}`).join(", "));q={type:"FeatureCollection",features:q.features.filter(ce=>Y.value.evaluate({zoom:0},ce))}}return q})}loadGeoJSON(B,R){return v._(this,void 0,void 0,function*(){const{promoteId:q}=B;if(B.request){const Y=yield v.h(B.request,R);return this._dataUpdateable=Mi(Y.data,q)?Gi(Y.data,q):void 0,Y.data}if(typeof B.data=="string")try{const Y=JSON.parse(B.data);return this._dataUpdateable=Mi(Y,q)?Gi(Y,q):void 0,Y}catch{throw new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`)}if(!B.dataDiff)throw new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${B.source}`);return function(Y,le,ce){var me,ie,ke,Ae;if(le.removeAll&&Y.clear(),le.remove)for(const ve of le.remove)Y.delete(ve);if(le.add)for(const ve of le.add){const Be=_t(ve,ce);Be!=null&&Y.set(Be,ve)}if(le.update)for(const ve of le.update){let Be=Y.get(ve.id);if(Be==null)continue;const at=!ve.removeAllProperties&&(((me=ve.removeProperties)===null||me===void 0?void 0:me.length)>0||((ie=ve.addOrUpdateProperties)===null||ie===void 0?void 0:ie.length)>0);if((ve.newGeometry||ve.removeAllProperties||at)&&(Be=Object.assign({},Be),Y.set(ve.id,Be),at&&(Be.properties=Object.assign({},Be.properties))),ve.newGeometry&&(Be.geometry=ve.newGeometry),ve.removeAllProperties)Be.properties={};else if(((ke=ve.removeProperties)===null||ke===void 0?void 0:ke.length)>0)for(const lt of ve.removeProperties)Object.prototype.hasOwnProperty.call(Be.properties,lt)&&delete Be.properties[lt];if(((Ae=ve.addOrUpdateProperties)===null||Ae===void 0?void 0:Ae.length)>0)for(const{key:lt,value:zt}of ve.addOrUpdateProperties)Be.properties[lt]=zt}}(this._dataUpdateable,B.dataDiff,q),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(B){return v._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(B){return this._geoJSONIndex.getClusterExpansionZoom(B.clusterId)}getClusterChildren(B){return this._geoJSONIndex.getChildren(B.clusterId)}getClusterLeaves(B){return this._geoJSONIndex.getLeaves(B.clusterId,B.limit,B.offset)}}class Ai{constructor(B){this.self=B,this.actor=new v.F(B),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(R,q)=>{if(this.externalWorkerSourceTypes[R])throw new Error(`Worker source with name "${R}" already registered.`);this.externalWorkerSourceTypes[R]=q},this.self.addProtocol=v.bi,this.self.removeProtocol=v.bj,this.self.registerRTLTextPlugin=R=>{if(v.bD.isParsed())throw new Error("RTL text plugin already registered.");v.bD.setMethods(R)},this.actor.registerMessageHandler("LDT",(R,q)=>this._getDEMWorkerSource(R,q.source).loadTile(q)),this.actor.registerMessageHandler("RDT",(R,q)=>v._(this,void 0,void 0,function*(){this._getDEMWorkerSource(R,q.source).removeTile(q)})),this.actor.registerMessageHandler("GCEZ",(R,q)=>v._(this,void 0,void 0,function*(){return this._getWorkerSource(R,q.type,q.source).getClusterExpansionZoom(q)})),this.actor.registerMessageHandler("GCC",(R,q)=>v._(this,void 0,void 0,function*(){return this._getWorkerSource(R,q.type,q.source).getClusterChildren(q)})),this.actor.registerMessageHandler("GCL",(R,q)=>v._(this,void 0,void 0,function*(){return this._getWorkerSource(R,q.type,q.source).getClusterLeaves(q)})),this.actor.registerMessageHandler("LD",(R,q)=>this._getWorkerSource(R,q.type,q.source).loadData(q)),this.actor.registerMessageHandler("GD",(R,q)=>this._getWorkerSource(R,q.type,q.source).getData()),this.actor.registerMessageHandler("LT",(R,q)=>this._getWorkerSource(R,q.type,q.source).loadTile(q)),this.actor.registerMessageHandler("RT",(R,q)=>this._getWorkerSource(R,q.type,q.source).reloadTile(q)),this.actor.registerMessageHandler("AT",(R,q)=>this._getWorkerSource(R,q.type,q.source).abortTile(q)),this.actor.registerMessageHandler("RMT",(R,q)=>this._getWorkerSource(R,q.type,q.source).removeTile(q)),this.actor.registerMessageHandler("RS",(R,q)=>v._(this,void 0,void 0,function*(){if(!this.workerSources[R]||!this.workerSources[R][q.type]||!this.workerSources[R][q.type][q.source])return;const Y=this.workerSources[R][q.type][q.source];delete this.workerSources[R][q.type][q.source],Y.removeSource!==void 0&&Y.removeSource(q)})),this.actor.registerMessageHandler("RM",R=>v._(this,void 0,void 0,function*(){delete this.layerIndexes[R],delete this.availableImages[R],delete this.workerSources[R],delete this.demWorkerSources[R]})),this.actor.registerMessageHandler("SR",(R,q)=>v._(this,void 0,void 0,function*(){this.referrer=q})),this.actor.registerMessageHandler("SRPS",(R,q)=>this._syncRTLPluginState(R,q)),this.actor.registerMessageHandler("IS",(R,q)=>v._(this,void 0,void 0,function*(){this.self.importScripts(q)})),this.actor.registerMessageHandler("SI",(R,q)=>this._setImages(R,q)),this.actor.registerMessageHandler("UL",(R,q)=>v._(this,void 0,void 0,function*(){this._getLayerIndex(R).update(q.layers,q.removedIds)})),this.actor.registerMessageHandler("SL",(R,q)=>v._(this,void 0,void 0,function*(){this._getLayerIndex(R).replace(q)}))}_setImages(B,R){return v._(this,void 0,void 0,function*(){this.availableImages[B]=R;for(const q in this.workerSources[B]){const Y=this.workerSources[B][q];for(const le in Y)Y[le].availableImages=R}})}_syncRTLPluginState(B,R){return v._(this,void 0,void 0,function*(){if(v.bD.isParsed())return v.bD.getState();if(R.pluginStatus!=="loading")return v.bD.setState(R),R;const q=R.pluginURL;if(this.self.importScripts(q),v.bD.isParsed()){const Y={pluginStatus:"loaded",pluginURL:q};return v.bD.setState(Y),Y}throw v.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${q}`)})}_getAvailableImages(B){let R=this.availableImages[B];return R||(R=[]),R}_getLayerIndex(B){let R=this.layerIndexes[B];return R||(R=this.layerIndexes[B]=new u),R}_getWorkerSource(B,R,q){if(this.workerSources[B]||(this.workerSources[B]={}),this.workerSources[B][R]||(this.workerSources[B][R]={}),!this.workerSources[B][R][q]){const Y={sendAsync:(le,ce)=>(le.targetMapId=B,this.actor.sendAsync(le,ce))};switch(R){case"vector":this.workerSources[B][R][q]=new j(Y,this._getLayerIndex(B),this._getAvailableImages(B));break;case"geojson":this.workerSources[B][R][q]=new cs(Y,this._getLayerIndex(B),this._getAvailableImages(B));break;default:this.workerSources[B][R][q]=new this.externalWorkerSourceTypes[R](Y,this._getLayerIndex(B),this._getAvailableImages(B))}}return this.workerSources[B][R][q]}_getDEMWorkerSource(B,R){return this.demWorkerSources[B]||(this.demWorkerSources[B]={}),this.demWorkerSources[B][R]||(this.demWorkerSources[B][R]=new L),this.demWorkerSources[B][R]}}return v.i(self)&&(self.worker=new Ai(self)),Ai}),g("index",["exports","./shared"],function(v,u){var C="4.7.1";let O,U;const j={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:m=>new Promise((e,a)=>{const c=requestAnimationFrame(e);m.signal.addEventListener("abort",()=>{cancelAnimationFrame(c),a(u.c())})}),getImageData(m,e=0){return this.getImageCanvasContext(m).getImageData(-e,-e,m.width+2*e,m.height+2*e)},getImageCanvasContext(m){const e=window.document.createElement("canvas"),a=e.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return e.width=m.width,e.height=m.height,a.drawImage(m,0,0,m.width,m.height),a},resolveURL:m=>(O||(O=document.createElement("a")),O.href=m,O.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(U==null&&(U=matchMedia("(prefers-reduced-motion: reduce)")),U.matches)}};class L{static testProp(e){if(!L.docStyle)return e[0];for(let a=0;a<e.length;a++)if(e[a]in L.docStyle)return e[a];return e[0]}static create(e,a,c){const d=window.document.createElement(e);return a!==void 0&&(d.className=a),c&&c.appendChild(d),d}static createNS(e,a){return window.document.createElementNS(e,a)}static disableDrag(){L.docStyle&&L.selectProp&&(L.userSelect=L.docStyle[L.selectProp],L.docStyle[L.selectProp]="none")}static enableDrag(){L.docStyle&&L.selectProp&&(L.docStyle[L.selectProp]=L.userSelect)}static setTransform(e,a){e.style[L.transformProp]=a}static addEventListener(e,a,c,d={}){e.addEventListener(a,c,"passive"in d?d:d.capture)}static removeEventListener(e,a,c,d={}){e.removeEventListener(a,c,"passive"in d?d:d.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",L.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",L.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",L.suppressClickInternal,!0)},0)}static getScale(e){const a=e.getBoundingClientRect();return{x:a.width/e.offsetWidth||1,y:a.height/e.offsetHeight||1,boundingClientRect:a}}static getPoint(e,a,c){const d=a.boundingClientRect;return new u.P((c.clientX-d.left)/a.x-e.clientLeft,(c.clientY-d.top)/a.y-e.clientTop)}static mousePos(e,a){const c=L.getScale(e);return L.getPoint(e,c,a)}static touchPos(e,a){const c=[],d=L.getScale(e);for(let f=0;f<a.length;f++)c.push(L.getPoint(e,d,a[f]));return c}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}L.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,L.selectProp=L.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),L.transformProp=L.testProp(["transform","WebkitTransform"]);const oe={supported:!1,testSupport:function(m){!Ie&&he&&(K?G(m):de=m)}};let de,he,Ie=!1,K=!1;function G(m){const e=m.createTexture();m.bindTexture(m.TEXTURE_2D,e);try{if(m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,he),m.isContextLost())return;oe.supported=!0}catch{}m.deleteTexture(e),Ie=!0}var ee;typeof document<"u"&&(he=document.createElement("img"),he.onload=()=>{de&&G(de),de=null,K=!0},he.onerror=()=>{Ie=!0,de=null},he.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(m){let e,a,c,d;m.resetRequestQueue=()=>{e=[],a=0,c=0,d={}},m.addThrottleControl=T=>{const P=c++;return d[P]=T,P},m.removeThrottleControl=T=>{delete d[T],b()},m.getImage=(T,P,A=!0)=>new Promise((z,N)=>{oe.supported&&(T.headers||(T.headers={}),T.headers.accept="image/webp,*/*"),u.e(T,{type:"image"}),e.push({abortController:P,requestParameters:T,supportImageRefresh:A,state:"queued",onError:Z=>{N(Z)},onSuccess:Z=>{z(Z)}}),b()});const f=T=>u._(this,void 0,void 0,function*(){T.state="running";const{requestParameters:P,supportImageRefresh:A,onError:z,onSuccess:N,abortController:Z}=T,H=A===!1&&!u.i(self)&&!u.g(P.url)&&(!P.headers||Object.keys(P.headers).reduce((ne,se)=>ne&&se==="accept",!0));a++;const J=H?k(P,Z):u.m(P,Z);try{const ne=yield J;delete T.abortController,T.state="completed",ne.data instanceof HTMLImageElement||u.b(ne.data)?N(ne):ne.data&&N({data:yield(re=ne.data,typeof createImageBitmap=="function"?u.d(re):u.f(re)),cacheControl:ne.cacheControl,expires:ne.expires})}catch(ne){delete T.abortController,z(ne)}finally{a--,b()}var re}),b=()=>{const T=(()=>{for(const P of Object.keys(d))if(d[P]())return!0;return!1})()?u.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:u.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let P=a;P<T&&e.length>0;P++){const A=e.shift();A.abortController.signal.aborted?P--:f(A)}},k=(T,P)=>new Promise((A,z)=>{const N=new Image,Z=T.url,H=T.credentials;H&&H==="include"?N.crossOrigin="use-credentials":(H&&H==="same-origin"||!u.s(Z))&&(N.crossOrigin="anonymous"),P.signal.addEventListener("abort",()=>{N.src="",z(u.c())}),N.fetchPriority="high",N.onload=()=>{N.onerror=N.onload=null,A({data:N})},N.onerror=()=>{N.onerror=N.onload=null,P.signal.aborted||z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},N.src=Z})}(ee||(ee={})),ee.resetRequestQueue();class _e{constructor(e){this._transformRequestFn=e}transformRequest(e,a){return this._transformRequestFn&&this._transformRequestFn(e,a)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function Se(m){var e=new u.A(3);return e[0]=m[0],e[1]=m[1],e[2]=m[2],e}var Te,xe=function(m,e,a){return m[0]=e[0]-a[0],m[1]=e[1]-a[1],m[2]=e[2]-a[2],m};Te=new u.A(3),u.A!=Float32Array&&(Te[0]=0,Te[1]=0,Te[2]=0);var Pe=function(m){var e=m[0],a=m[1];return e*e+a*a};function Ce(m){const e=[];if(typeof m=="string")e.push({id:"default",url:m});else if(m&&m.length>0){const a=[];for(const{id:c,url:d}of m){const f=`${c}${d}`;a.indexOf(f)===-1&&(a.push(f),e.push({id:c,url:d}))}}return e}function rt(m,e,a){const c=m.split("?");return c[0]+=`${e}${a}`,c.join("?")}(function(){var m=new u.A(2);u.A!=Float32Array&&(m[0]=0,m[1]=0)})();class Ye{constructor(e,a,c,d){this.context=e,this.format=c,this.texture=e.gl.createTexture(),this.update(a,d)}update(e,a,c){const{width:d,height:f}=e,b=!(this.size&&this.size[0]===d&&this.size[1]===f||c),{context:k}=this,{gl:T}=k;if(this.useMipmap=!!(a&&a.useMipmap),T.bindTexture(T.TEXTURE_2D,this.texture),k.pixelStoreUnpackFlipY.set(!1),k.pixelStoreUnpack.set(1),k.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA&&(!a||a.premultiply!==!1)),b)this.size=[d,f],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||u.b(e)?T.texImage2D(T.TEXTURE_2D,0,this.format,this.format,T.UNSIGNED_BYTE,e):T.texImage2D(T.TEXTURE_2D,0,this.format,d,f,0,this.format,T.UNSIGNED_BYTE,e.data);else{const{x:P,y:A}=c||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||u.b(e)?T.texSubImage2D(T.TEXTURE_2D,0,P,A,T.RGBA,T.UNSIGNED_BYTE,e):T.texSubImage2D(T.TEXTURE_2D,0,P,A,d,f,T.RGBA,T.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&T.generateMipmap(T.TEXTURE_2D)}bind(e,a,c){const{context:d}=this,{gl:f}=d;f.bindTexture(f.TEXTURE_2D,this.texture),c!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(c=f.LINEAR),e!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,c||e),this.filter=e),a!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,a),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,a),this.wrap=a)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function Wt(m){const{userImage:e}=m;return!!(e&&e.render&&e.render())&&(m.data.replace(new Uint8Array(e.data.buffer)),!0)}class Tt extends u.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new u.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:a,promiseResolve:c}of this.requestors)c(this._getImagesForIds(a));this.requestors=[]}}getImage(e){const a=this.images[e];if(a&&!a.data&&a.spriteData){const c=a.spriteData;a.data=new u.R({width:c.width,height:c.height},c.context.getImageData(c.x,c.y,c.width,c.height).data),a.spriteData=null}return a}addImage(e,a){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,a)&&(this.images[e]=a)}_validate(e,a){let c=!0;const d=a.data||a.spriteData;return this._validateStretch(a.stretchX,d&&d.width)||(this.fire(new u.j(new Error(`Image "${e}" has invalid "stretchX" value`))),c=!1),this._validateStretch(a.stretchY,d&&d.height)||(this.fire(new u.j(new Error(`Image "${e}" has invalid "stretchY" value`))),c=!1),this._validateContent(a.content,a)||(this.fire(new u.j(new Error(`Image "${e}" has invalid "content" value`))),c=!1),c}_validateStretch(e,a){if(!e)return!0;let c=0;for(const d of e){if(d[0]<c||d[1]<d[0]||a<d[1])return!1;c=d[1]}return!0}_validateContent(e,a){if(!e)return!0;if(e.length!==4)return!1;const c=a.spriteData,d=c&&c.width||a.data.width,f=c&&c.height||a.data.height;return!(e[0]<0||d<e[0]||e[1]<0||f<e[1]||e[2]<0||d<e[2]||e[3]<0||f<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,a,c=!0){const d=this.getImage(e);if(c&&(d.data.width!==a.data.width||d.data.height!==a.data.height))throw new Error(`size mismatch between old image (${d.data.width}x${d.data.height}) and new image (${a.data.width}x${a.data.height}).`);a.version=d.version+1,this.images[e]=a,this.updatedImages[e]=!0}removeImage(e){const a=this.images[e];delete this.images[e],delete this.patterns[e],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((a,c)=>{let d=!0;if(!this.isLoaded())for(const f of e)this.images[f]||(d=!1);this.isLoaded()||d?a(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:a})})}_getImagesForIds(e){const a={};for(const c of e){let d=this.getImage(c);d||(this.fire(new u.k("styleimagemissing",{id:c})),d=this.getImage(c)),d?a[c]={data:d.data.clone(),pixelRatio:d.pixelRatio,sdf:d.sdf,version:d.version,stretchX:d.stretchX,stretchY:d.stretchY,content:d.content,textFitWidth:d.textFitWidth,textFitHeight:d.textFitHeight,hasRenderCallback:!!(d.userImage&&d.userImage.render)}:u.w(`Image "${c}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return a}getPixelSize(){const{width:e,height:a}=this.atlasImage;return{width:e,height:a}}getPattern(e){const a=this.patterns[e],c=this.getImage(e);if(!c)return null;if(a&&a.position.version===c.version)return a.position;if(a)a.position.version=c.version;else{const d={w:c.data.width+2,h:c.data.height+2,x:0,y:0},f=new u.I(d,c);this.patterns[e]={bin:d,position:f}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const a=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Ye(e,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const f in this.patterns)e.push(this.patterns[f].bin);const{w:a,h:c}=u.p(e),d=this.atlasImage;d.resize({width:a||1,height:c||1});for(const f in this.patterns){const{bin:b}=this.patterns[f],k=b.x+1,T=b.y+1,P=this.getImage(f).data,A=P.width,z=P.height;u.R.copy(P,d,{x:0,y:0},{x:k,y:T},{width:A,height:z}),u.R.copy(P,d,{x:0,y:z-1},{x:k,y:T-1},{width:A,height:1}),u.R.copy(P,d,{x:0,y:0},{x:k,y:T+z},{width:A,height:1}),u.R.copy(P,d,{x:A-1,y:0},{x:k-1,y:T},{width:1,height:z}),u.R.copy(P,d,{x:0,y:0},{x:k+A,y:T},{width:1,height:z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const a of e){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const c=this.getImage(a);c||u.w(`Image with ID: "${a}" was not found`),Wt(c)&&this.updateImage(a,c)}}}const bt=1e20;function vr(m,e,a,c,d,f,b,k,T){for(let P=e;P<e+c;P++)Tr(m,a*f+P,f,d,b,k,T);for(let P=a;P<a+d;P++)Tr(m,P*f+e,1,c,b,k,T)}function Tr(m,e,a,c,d,f,b){f[0]=0,b[0]=-bt,b[1]=bt,d[0]=m[e];for(let k=1,T=0,P=0;k<c;k++){d[k]=m[e+k*a];const A=k*k;do{const z=f[T];P=(d[k]-d[z]+A-z*z)/(k-z)/2}while(P<=b[T]&&--T>-1);T++,f[T]=k,b[T]=P,b[T+1]=bt}for(let k=0,T=0;k<c;k++){for(;b[T+1]<k;)T++;const P=f[T],A=k-P;m[e+k*a]=d[P]+A*A}}class Nt{constructor(e,a){this.requestManager=e,this.localIdeographFontFamily=a,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return u._(this,void 0,void 0,function*(){const a=[];for(const f in e)for(const b of e[f])a.push(this._getAndCacheGlyphsPromise(f,b));const c=yield Promise.all(a),d={};for(const{stack:f,id:b,glyph:k}of c)d[f]||(d[f]={}),d[f][b]=k&&{id:k.id,bitmap:k.bitmap.clone(),metrics:k.metrics};return d})}_getAndCacheGlyphsPromise(e,a){return u._(this,void 0,void 0,function*(){let c=this.entries[e];c||(c=this.entries[e]={glyphs:{},requests:{},ranges:{}});let d=c.glyphs[a];if(d!==void 0)return{stack:e,id:a,glyph:d};if(d=this._tinySDF(c,e,a),d)return c.glyphs[a]=d,{stack:e,id:a,glyph:d};const f=Math.floor(a/256);if(256*f>65535)throw new Error("glyphs > 65535 not supported");if(c.ranges[f])return{stack:e,id:a,glyph:d};if(!this.url)throw new Error("glyphsUrl is not set");if(!c.requests[f]){const k=Nt.loadGlyphRange(e,f,this.url,this.requestManager);c.requests[f]=k}const b=yield c.requests[f];for(const k in b)this._doesCharSupportLocalGlyph(+k)||(c.glyphs[+k]=b[+k]);return c.ranges[f]=!0,{stack:e,id:a,glyph:b[a]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))}_tinySDF(e,a,c){const d=this.localIdeographFontFamily;if(!d||!this._doesCharSupportLocalGlyph(c))return;let f=e.tinySDF;if(!f){let k="400";/bold/i.test(a)?k="900":/medium/i.test(a)?k="500":/light/i.test(a)&&(k="200"),f=e.tinySDF=new Nt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:d,fontWeight:k})}const b=f.draw(String.fromCharCode(c));return{id:c,bitmap:new u.o({width:b.width||60,height:b.height||60},b.data),metrics:{width:b.glyphWidth/2||24,height:b.glyphHeight/2||24,left:b.glyphLeft/2+.5||0,top:b.glyphTop/2-27.5||-8,advance:b.glyphAdvance/2||24,isDoubleResolution:!0}}}}Nt.loadGlyphRange=function(m,e,a,c){return u._(this,void 0,void 0,function*(){const d=256*e,f=d+255,b=c.transformRequest(a.replace("{fontstack}",m).replace("{range}",`${d}-${f}`),"Glyphs"),k=yield u.l(b,new AbortController);if(!k||!k.data)throw new Error(`Could not load glyph range. range: ${e}, ${d}-${f}`);const T={};for(const P of u.n(k.data))T[P.id]=P;return T})},Nt.TinySDF=class{constructor({fontSize:m=24,buffer:e=3,radius:a=8,cutoff:c=.25,fontFamily:d="sans-serif",fontWeight:f="normal",fontStyle:b="normal"}={}){this.buffer=e,this.cutoff=c,this.radius=a;const k=this.size=m+4*e,T=this._createCanvas(k),P=this.ctx=T.getContext("2d",{willReadFrequently:!0});P.font=`${b} ${f} ${m}px ${d}`,P.textBaseline="alphabetic",P.textAlign="left",P.fillStyle="black",this.gridOuter=new Float64Array(k*k),this.gridInner=new Float64Array(k*k),this.f=new Float64Array(k),this.z=new Float64Array(k+1),this.v=new Uint16Array(k)}_createCanvas(m){const e=document.createElement("canvas");return e.width=e.height=m,e}draw(m){const{width:e,actualBoundingBoxAscent:a,actualBoundingBoxDescent:c,actualBoundingBoxLeft:d,actualBoundingBoxRight:f}=this.ctx.measureText(m),b=Math.ceil(a),k=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-d))),T=Math.min(this.size-this.buffer,b+Math.ceil(c)),P=k+2*this.buffer,A=T+2*this.buffer,z=Math.max(P*A,0),N=new Uint8ClampedArray(z),Z={data:N,width:P,height:A,glyphWidth:k,glyphHeight:T,glyphTop:b,glyphLeft:0,glyphAdvance:e};if(k===0||T===0)return Z;const{ctx:H,buffer:J,gridInner:re,gridOuter:ne}=this;H.clearRect(J,J,k,T),H.fillText(m,J,J+b);const se=H.getImageData(J,J,k,T);ne.fill(bt,0,z),re.fill(0,0,z);for(let W=0;W<T;W++)for(let ue=0;ue<k;ue++){const pe=se.data[4*(W*k+ue)+3]/255;if(pe===0)continue;const ye=(W+J)*P+ue+J;if(pe===1)ne[ye]=0,re[ye]=bt;else{const Me=.5-pe;ne[ye]=Me>0?Me*Me:0,re[ye]=Me<0?Me*Me:0}}vr(ne,0,0,P,A,P,this.f,this.v,this.z),vr(re,J,J,k,T,P,this.f,this.v,this.z);for(let W=0;W<z;W++){const ue=Math.sqrt(ne[W])-Math.sqrt(re[W]);N[W]=Math.round(255-255*(ue/this.radius+this.cutoff))}return Z}};class He{constructor(){this.specification=u.v.light.position}possiblyEvaluate(e,a){return u.x(e.expression.evaluate(a))}interpolate(e,a,c){return{x:u.y.number(e.x,a.x,c),y:u.y.number(e.y,a.y,c),z:u.y.number(e.z,a.z,c)}}}let ht;class pt extends u.E{constructor(e){super(),ht=ht||new u.q({anchor:new u.D(u.v.light.anchor),position:new He,color:new u.D(u.v.light.color),intensity:new u.D(u.v.light.intensity)}),this._transitionable=new u.T(ht),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,a={}){if(!this._validate(u.r,e,a))for(const c in e){const d=e[c];c.endsWith("-transition")?this._transitionable.setTransition(c.slice(0,-11),d):this._transitionable.setValue(c,d)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,a,c){return(!c||c.validate!==!1)&&u.t(this,e.call(u.u,{value:a,style:{glyphs:!0,sprite:!0},styleSpec:u.v}))}}const At=new u.q({"sky-color":new u.D(u.v.sky["sky-color"]),"horizon-color":new u.D(u.v.sky["horizon-color"]),"fog-color":new u.D(u.v.sky["fog-color"]),"fog-ground-blend":new u.D(u.v.sky["fog-ground-blend"]),"horizon-fog-blend":new u.D(u.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new u.D(u.v.sky["sky-horizon-blend"]),"atmosphere-blend":new u.D(u.v.sky["atmosphere-blend"])});class Ut extends u.E{constructor(e){super(),this._transitionable=new u.T(At),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new u.z(0))}setSky(e,a={}){if(!this._validate(u.B,e,a)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const c in e){const d=e[c];c.endsWith("-transition")?this._transitionable.setTransition(c.slice(0,-11),d):this._transitionable.setValue(c,d)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,a,c={}){return(c==null?void 0:c.validate)!==!1&&u.t(this,e.call(u.u,u.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:u.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class ii{constructor(e,a){this.width=e,this.height=a,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,a){const c=e.join(",")+String(a);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(e,a)),this.dashEntry[c]}getDashRanges(e,a,c){const d=[];let f=e.length%2==1?-e[e.length-1]*c:0,b=e[0]*c,k=!0;d.push({left:f,right:b,isDash:k,zeroLength:e[0]===0});let T=e[0];for(let P=1;P<e.length;P++){k=!k;const A=e[P];f=T*c,T+=A,b=T*c,d.push({left:f,right:b,isDash:k,zeroLength:A===0})}return d}addRoundDash(e,a,c){const d=a/2;for(let f=-c;f<=c;f++){const b=this.width*(this.nextRow+c+f);let k=0,T=e[k];for(let P=0;P<this.width;P++){P/T.right>1&&(T=e[++k]);const A=Math.abs(P-T.left),z=Math.abs(P-T.right),N=Math.min(A,z);let Z;const H=f/c*(d+1);if(T.isDash){const J=d-Math.abs(H);Z=Math.sqrt(N*N+J*J)}else Z=d-Math.sqrt(N*N+H*H);this.data[b+P]=Math.max(0,Math.min(255,Z+128))}}}addRegularDash(e){for(let k=e.length-1;k>=0;--k){const T=e[k],P=e[k+1];T.zeroLength?e.splice(k,1):P&&P.isDash===T.isDash&&(P.left=T.left,e.splice(k,1))}const a=e[0],c=e[e.length-1];a.isDash===c.isDash&&(a.left=c.left-this.width,c.right=a.right+this.width);const d=this.width*this.nextRow;let f=0,b=e[f];for(let k=0;k<this.width;k++){k/b.right>1&&(b=e[++f]);const T=Math.abs(k-b.left),P=Math.abs(k-b.right),A=Math.min(T,P);this.data[d+k]=Math.max(0,Math.min(255,(b.isDash?A:-A)+128))}}addDash(e,a){const c=a?7:0,d=2*c+1;if(this.nextRow+d>this.height)return u.w("LineAtlas out of space"),null;let f=0;for(let k=0;k<e.length;k++)f+=e[k];if(f!==0){const k=this.width/f,T=this.getDashRanges(e,this.width,k);a?this.addRoundDash(T,k,c):this.addRegularDash(T)}const b={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:f};return this.nextRow+=d,this.dirty=!0,b}bind(e){const a=e.gl;this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,this.data))}}const Zr="maplibre_preloaded_worker_pool";class dn{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<dn.workerCount;)this.workers.push(new Worker(u.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Zr]}numActive(){return Object.keys(this.active).length}}const pn=Math.floor(j.hardwareConcurrency/2);let zr,si;function Es(){return zr||(zr=new dn),zr}dn.workerCount=u.C(globalThis)?Math.max(Math.min(pn,3),1):1;class Ps{constructor(e,a){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=a;const c=this.workerPool.acquire(a);for(let d=0;d<c.length;d++){const f=new u.F(c[d],a);f.name=`Worker ${d}`,this.actors.push(f)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,a){const c=[];for(const d of this.actors)c.push(d.sendAsync({type:e,data:a}));return Promise.all(c)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(a=>{a.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,a){for(const c of this.actors)c.registerMessageHandler(e,a)}}function _o(){return si||(si=new Ps(Es(),u.G),si.registerMessageHandler("GR",(m,e,a)=>u.m(e,a))),si}function qi(m,e){const a=u.H();return u.J(a,a,[1,1,0]),u.K(a,a,[.5*m.width,.5*m.height,1]),u.L(a,a,m.calculatePosMatrix(e.toUnwrapped()))}function as(m,e,a,c,d,f){const b=function(z,N,Z){if(z)for(const H of z){const J=N[H];if(J&&J.source===Z&&J.type==="fill-extrusion")return!0}else for(const H in N){const J=N[H];if(J.source===Z&&J.type==="fill-extrusion")return!0}return!1}(d&&d.layers,e,m.id),k=f.maxPitchScaleFactor(),T=m.tilesIn(c,k,b);T.sort(os);const P=[];for(const z of T)P.push({wrappedTileID:z.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(e,a,m._state,z.queryGeometry,z.cameraQueryGeometry,z.scale,d,f,k,qi(m.transform,z.tileID))});const A=function(z){const N={},Z={};for(const H of z){const J=H.queryResults,re=H.wrappedTileID,ne=Z[re]=Z[re]||{};for(const se in J){const W=J[se],ue=ne[se]=ne[se]||{},pe=N[se]=N[se]||[];for(const ye of W)ue[ye.featureIndex]||(ue[ye.featureIndex]=!0,pe.push(ye))}}return N}(P);for(const z in A)A[z].forEach(N=>{const Z=N.feature,H=m.getFeatureState(Z.layer["source-layer"],Z.id);Z.source=Z.layer.source,Z.layer["source-layer"]&&(Z.sourceLayer=Z.layer["source-layer"]),Z.state=H});return A}function os(m,e){const a=m.tileID,c=e.tileID;return a.overscaledZ-c.overscaledZ||a.canonical.y-c.canonical.y||a.wrap-c.wrap||a.canonical.x-c.canonical.x}function ca(m,e,a){return u._(this,void 0,void 0,function*(){let c=m;if(m.url?c=(yield u.h(e.transformRequest(m.url,"Source"),a)).data:yield j.frameAsync(a),!c)return null;const d=u.M(u.e(c,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in c&&c.vector_layers&&(d.vectorLayerIds=c.vector_layers.map(f=>f.id)),d})}class we{constructor(e,a){e&&(a?this.setSouthWest(e).setNorthEast(a):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof u.N?new u.N(e.lng,e.lat):u.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof u.N?new u.N(e.lng,e.lat):u.N.convert(e),this}extend(e){const a=this._sw,c=this._ne;let d,f;if(e instanceof u.N)d=e,f=e;else{if(!(e instanceof we))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(we.convert(e)):this.extend(u.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(u.N.convert(e)):this;if(d=e._sw,f=e._ne,!d||!f)return this}return a||c?(a.lng=Math.min(d.lng,a.lng),a.lat=Math.min(d.lat,a.lat),c.lng=Math.max(f.lng,c.lng),c.lat=Math.max(f.lat,c.lat)):(this._sw=new u.N(d.lng,d.lat),this._ne=new u.N(f.lng,f.lat)),this}getCenter(){return new u.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new u.N(this.getWest(),this.getNorth())}getSouthEast(){return new u.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:a,lat:c}=u.N.convert(e);let d=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&d}static convert(e){return e instanceof we?e:e&&new we(e)}static fromLngLat(e,a=0){const c=360*a/40075017,d=c/Math.cos(Math.PI/180*e.lat);return new we(new u.N(e.lng-d,e.lat-c),new u.N(e.lng+d,e.lat+c))}adjustAntiMeridian(){const e=new u.N(this._sw.lng,this._sw.lat),a=new u.N(this._ne.lng,this._ne.lat);return new we(e,e.lng>a.lng?new u.N(a.lng+360,a.lat):a)}}class Cs{constructor(e,a,c){this.bounds=we.convert(this.validateBounds(e)),this.minzoom=a||0,this.maxzoom=c||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const a=Math.pow(2,e.z),c=Math.floor(u.O(this.bounds.getWest())*a),d=Math.floor(u.Q(this.bounds.getNorth())*a),f=Math.ceil(u.O(this.bounds.getEast())*a),b=Math.ceil(u.Q(this.bounds.getSouth())*a);return e.x>=c&&e.x<f&&e.y>=d&&e.y<b}}class vo extends u.E{constructor(e,a,c,d){if(super(),this.id=e,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,u.e(this,u.M(a,["url","scheme","tileSize","promoteId"])),this._options=u.e({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(d)}load(){return u._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new u.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield ca(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(u.e(this,e),e.bounds&&(this.tileBounds=new Cs(e.bounds,this.minzoom,this.maxzoom)),this.fire(new u.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new u.j(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return u.e({},this._options)}loadTile(e){return u._(this,void 0,void 0,function*(){const a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c={request:this.map._requestManager.transformRequest(a,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};c.request.collectResourceTiming=this._collectResourceTiming;let d="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((f,b)=>{e.reloadPromise={resolve:f,reject:b}})}else e.actor=this.dispatcher.getActor(),d="LT";e.abortController=new AbortController;try{const f=yield e.actor.sendAsync({type:d,data:c},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,f)}catch(f){if(delete e.abortController,e.aborted)return;if(f&&f.status!==404)throw f;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,a){if(a&&a.resourceTiming&&(e.resourceTiming=a.resourceTiming),a&&this.map._refreshExpiredTiles&&e.setExpiryData(a),e.loadVectorData(a,this.map.painter),e.reloadPromise){const c=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(c.resolve).catch(c.reject)}}abortTile(e){return u._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return u._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Ft extends u.E{constructor(e,a,c,d){super(),this.id=e,this.dispatcher=c,this.setEventedParent(d),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=u.e({type:"raster"},a),u.e(this,u.M(a,["url","scheme","tileSize"]))}load(){return u._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new u.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield ca(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(u.e(this,e),e.bounds&&(this.tileBounds=new Cs(e.bounds,this.minzoom,this.maxzoom)),this.fire(new u.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new u.j(e))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return u.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return u._(this,void 0,void 0,function*(){const a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const c=yield ee.getImage(this.map._requestManager.transformRequest(a,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(c&&c.data){this.map._refreshExpiredTiles&&c.cacheControl&&c.expires&&e.setExpiryData({cacheControl:c.cacheControl,expires:c.expires});const d=this.map.painter.context,f=d.gl,b=c.data;e.texture=this.map.painter.getTileTexture(b.width),e.texture?e.texture.update(b,{useMipmap:!0}):(e.texture=new Ye(d,b,f.RGBA,{useMipmap:!0}),e.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE,f.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(c){if(delete e.abortController,e.aborted)e.state="unloaded";else if(c)throw e.state="errored",c}})}abortTile(e){return u._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return u._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class lr extends Ft{constructor(e,a,c,d){super(e,a,c,d),this.type="raster-dem",this.maxzoom=22,this._options=u.e({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox",this.redFactor=a.redFactor,this.greenFactor=a.greenFactor,this.blueFactor=a.blueFactor,this.baseShift=a.baseShift}loadTile(e){return u._(this,void 0,void 0,function*(){const a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c=this.map._requestManager.transformRequest(a,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const d=yield ee.getImage(c,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(d&&d.data){const f=d.data;this.map._refreshExpiredTiles&&d.cacheControl&&d.expires&&e.setExpiryData({cacheControl:d.cacheControl,expires:d.expires});const b=u.b(f)&&u.U()?f:yield this.readImageNow(f),k={type:this.type,uid:e.uid,source:this.id,rawImageData:b,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const T=yield e.actor.sendAsync({type:"LDT",data:k});e.dem=T,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(d){if(delete e.abortController,e.aborted)e.state="unloaded";else if(d)throw e.state="errored",d}})}readImageNow(e){return u._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&u.V()){const a=e.width+2,c=e.height+2;try{return new u.R({width:a,height:c},yield u.W(e,-1,-1,a,c))}catch{}}return j.getImageData(e,1)})}_getNeighboringTiles(e){const a=e.canonical,c=Math.pow(2,a.z),d=(a.x-1+c)%c,f=a.x===0?e.wrap-1:e.wrap,b=(a.x+1+c)%c,k=a.x+1===c?e.wrap+1:e.wrap,T={};return T[new u.S(e.overscaledZ,f,a.z,d,a.y).key]={backfilled:!1},T[new u.S(e.overscaledZ,k,a.z,b,a.y).key]={backfilled:!1},a.y>0&&(T[new u.S(e.overscaledZ,f,a.z,d,a.y-1).key]={backfilled:!1},T[new u.S(e.overscaledZ,e.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},T[new u.S(e.overscaledZ,k,a.z,b,a.y-1).key]={backfilled:!1}),a.y+1<c&&(T[new u.S(e.overscaledZ,f,a.z,d,a.y+1).key]={backfilled:!1},T[new u.S(e.overscaledZ,e.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},T[new u.S(e.overscaledZ,k,a.z,b,a.y+1).key]={backfilled:!1}),T}unloadTile(e){return u._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class xo extends u.E{constructor(e,a,c,d){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=c.getActor(),this.setEventedParent(d),this._data=a.data,this._options=u.e({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;const f=u.X/this.tileSize;a.clusterMaxZoom!==void 0&&this.maxzoom<=a.clusterMaxZoom&&u.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${a.clusterMaxZoom}".`),this.workerOptions=u.e({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(a.buffer!==void 0?a.buffer:128)*f,tolerance:(a.tolerance!==void 0?a.tolerance:.375)*f,extent:u.X,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:a.clusterMaxZoom!==void 0?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:u.X,radius:(a.clusterRadius||50)*f,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return u._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return u._(this,void 0,void 0,function*(){const e=u.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,a,c){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:a,offset:c}})}_updateWorkerData(e){return u._(this,void 0,void 0,function*(){const a=u.e({type:this.type},this.workerOptions);e?a.dataDiff=e:typeof this._data=="string"?(a.request=this.map._requestManager.transformRequest(j.resolveURL(this._data),"Source"),a.request.collectResourceTiming=this._collectResourceTiming):a.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new u.k("dataloading",{dataType:"source"}));try{const c=yield this.actor.sendAsync({type:"LD",data:a});if(this._pendingLoads--,this._removed||c.abandoned)return void this.fire(new u.k("dataabort",{dataType:"source"}));let d=null;c.resourceTiming&&c.resourceTiming[this.id]&&(d=c.resourceTiming[this.id].slice(0));const f={dataType:"source"};this._collectResourceTiming&&d&&d.length>0&&u.e(f,{resourceTiming:d}),this.fire(new u.k("data",Object.assign(Object.assign({},f),{sourceDataType:"metadata"}))),this.fire(new u.k("data",Object.assign(Object.assign({},f),{sourceDataType:"content"})))}catch(c){if(this._pendingLoads--,this._removed)return void this.fire(new u.k("dataabort",{dataType:"source"}));this.fire(new u.j(c))}})}loaded(){return this._pendingLoads===0}loadTile(e){return u._(this,void 0,void 0,function*(){const a=e.actor?"RT":"LT";e.actor=this.actor;const c={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;const d=yield this.actor.sendAsync({type:a,data:c},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(d,this.map.painter,a==="RT")})}abortTile(e){return u._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return u._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return u.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var ls=u.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Zi extends u.E{constructor(e,a,c,d){super(),this.id=e,this.dispatcher=c,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(d),this.options=a}load(e){return u._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new u.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const a=yield ee.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,a&&a.data&&(this.image=a.data,e&&(this.coordinates=e),this._finishLoading())}catch(a){this._request=null,this._loaded=!0,this.fire(new u.j(a))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new u.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const a=e.map(u.Z.fromLngLat);this.tileID=function(d){let f=1/0,b=1/0,k=-1/0,T=-1/0;for(const N of d)f=Math.min(f,N.x),b=Math.min(b,N.y),k=Math.max(k,N.x),T=Math.max(T,N.y);const P=Math.max(k-f,T-b),A=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),z=Math.pow(2,A);return new u.a1(A,Math.floor((f+k)/2*z),Math.floor((b+T)/2*z))}(a),this.minzoom=this.maxzoom=this.tileID.z;const c=a.map(d=>this.tileID.getTilePoint(d)._round());return this._boundsArray=new u.$,this._boundsArray.emplaceBack(c[0].x,c[0].y,0,0),this._boundsArray.emplaceBack(c[1].x,c[1].y,u.X,0),this._boundsArray.emplaceBack(c[3].x,c[3].y,0,u.X),this._boundsArray.emplaceBack(c[2].x,c[2].y,u.X,u.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new u.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,a=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,ls.members)),this.boundsSegments||(this.boundsSegments=u.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Ye(e,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let c=!1;for(const d in this.tiles){const f=this.tiles[d];f.state!=="loaded"&&(f.state="loaded",f.texture=this.texture,c=!0)}c&&this.fire(new u.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return u._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class ha extends Zi{constructor(e,a,c,d){super(e,a,c,d),this.roundZoom=!0,this.type="video",this.options=a}load(){return u._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const a of e.urls)this.urls.push(this.map._requestManager.transformRequest(a,"Source").url);try{const a=yield u.a3(this.urls);if(this._loaded=!0,!a)return;this.video=a,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(a){this.fire(new u.j(a))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const a=this.video.seekable;e<a.start(0)||e>a.end(0)?this.fire(new u.j(new u.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,a=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,ls.members)),this.boundsSegments||(this.boundsSegments=u.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new Ye(e,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let c=!1;for(const d in this.tiles){const f=this.tiles[d];f.state!=="loaded"&&(f.state="loaded",f.texture=this.texture,c=!0)}c&&this.fire(new u.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class $n extends Zi{constructor(e,a,c,d){super(e,a,c,d),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some(f=>!Array.isArray(f)||f.length!==2||f.some(b=>typeof b!="number"))||this.fire(new u.j(new u.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new u.j(new u.a2(`sources.${e}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new u.j(new u.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new u.j(new u.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new u.j(new u.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){return u._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new u.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context,c=a.gl;this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,ls.members)),this.boundsSegments||(this.boundsSegments=u.a0.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Ye(a,this.canvas,c.RGBA,{premultiply:!0});let d=!1;for(const f in this.tiles){const b=this.tiles[f];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,d=!0)}d&&this.fire(new u.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const wo={},bo=m=>{switch(m){case"geojson":return xo;case"image":return Zi;case"raster":return Ft;case"raster-dem":return lr;case"vector":return vo;case"video":return ha;case"canvas":return $n}return wo[m]},Le="RTLPluginLoaded";class Pi extends u.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=_o()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(a=>{throw this.status="error",a})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return u._(this,arguments,void 0,function*(a,c=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=j.resolveURL(a),!this.url)throw new Error(`requested url ${a} is invalid`);if(this.status==="unavailable"){if(!c)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return u._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new u.k(Le))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let rn=null;function Ci(){return rn||(rn=new Pi),rn}class us{constructor(e,a){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=u.a4(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const a=e+this.timeAdded;a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,a,c){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(d,f){const b={};if(!f)return b;for(const k of d){const T=k.layerIds.map(P=>f.getLayer(P)).filter(Boolean);if(T.length!==0){k.layers=T,k.stateDependentLayerIds&&(k.stateDependentLayers=k.stateDependentLayerIds.map(P=>T.filter(A=>A.id===P)[0]));for(const P of T)b[P.id]=k}}return b}(e.buckets,a.style),this.hasSymbolBuckets=!1;for(const d in this.buckets){const f=this.buckets[d];if(f instanceof u.a6){if(this.hasSymbolBuckets=!0,!c)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const d in this.buckets){const f=this.buckets[d];if(f instanceof u.a6&&f.hasRTLText){this.hasRTLText=!0,Ci().lazyLoad();break}}this.queryPadding=0;for(const d in this.buckets){const f=this.buckets[d];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(d).queryRadius(f))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new u.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const c in this.buckets){const d=this.buckets[c];d.uploadPending()&&d.upload(e)}const a=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Ye(e,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ye(e,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,a,c,d,f,b,k,T,P,A){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:d,cameraQueryGeometry:f,scale:b,tileSize:this.tileSize,pixelPosMatrix:A,transform:T,params:k,queryPadding:this.queryPadding*P},e,a,c):{}}querySourceFeatures(e,a){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const d=c.loadVTLayers(),f=a&&a.sourceLayer?a.sourceLayer:"",b=d._geojsonTileLayer||d[f];if(!b)return;const k=u.a7(a&&a.filter),{z:T,x:P,y:A}=this.tileID.canonical,z={z:T,x:P,y:A};for(let N=0;N<b.length;N++){const Z=b.feature(N);if(k.needGeometry){const re=u.a8(Z,!0);if(!k.filter(new u.z(this.tileID.overscaledZ),re,this.tileID.canonical))continue}else if(!k.filter(new u.z(this.tileID.overscaledZ),Z))continue;const H=c.getId(Z,f),J=new u.a9(Z,T,P,A,H);J.tile=z,e.push(J)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const a=this.expirationTime;if(e.cacheControl){const c=u.aa(e.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const c=Date.now();let d=!1;if(this.expirationTime>c)d=!1;else if(a)if(this.expirationTime<a)d=!0;else{const f=this.expirationTime-a;f?this.expirationTime=c+Math.max(f,3e4):d=!0}else d=!0;d?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const c=this.latestFeatureIndex.loadVTLayers();for(const d in this.buckets){if(!a.style.hasLayer(d))continue;const f=this.buckets[d],b=f.layers[0].sourceLayer||"_geojsonTileLayer",k=c[b],T=e[b];if(!k||!T||Object.keys(T).length===0)continue;f.update(T,k,this.imageAtlas&&this.imageAtlas.patternPositions||{});const P=a&&a.style&&a.style.getLayer(d);P&&(this.queryPadding=Math.max(this.queryPadding,P.queryRadius(f)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<j.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=j.now()+e}setDependencies(e,a){const c={};for(const d of a)c[d]=!0;this.dependencies[e]=c}hasDependency(e,a){for(const c of e){const d=this.dependencies[c];if(d){for(const f of a)if(d[f])return!0}}return!1}}class Ne{constructor(e,a){this.max=e,this.onRemove=a,this.reset()}reset(){for(const e in this.data)for(const a of this.data[e])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(e,a,c){const d=e.wrapped().key;this.data[d]===void 0&&(this.data[d]=[]);const f={value:a,timeout:void 0};if(c!==void 0&&(f.timeout=setTimeout(()=>{this.remove(e,f)},c)),this.data[d].push(f),this.order.push(d),this.order.length>this.max){const b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const a=this.data[e].shift();return a.timeout&&clearTimeout(a.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),a.value}getByKey(e){const a=this.data[e];return a?a[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,a){if(!this.has(e))return this;const c=e.wrapped().key,d=a===void 0?0:this.data[c].indexOf(a),f=this.data[c][d];return this.data[c].splice(d,1),f.timeout&&clearTimeout(f.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(f.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(e){const a=[];for(const c in this.data)for(const d of this.data[c])e(d.value)||a.push(d);for(const c of a)this.remove(c.value.tileID,c)}}class St{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,a,c){const d=String(a);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][d]=this.stateChanges[e][d]||{},u.e(this.stateChanges[e][d],c),this.deletedStates[e]===null){this.deletedStates[e]={};for(const f in this.state[e])f!==d&&(this.deletedStates[e][f]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][d]===null){this.deletedStates[e][d]={};for(const f in this.state[e][d])c[f]||(this.deletedStates[e][d][f]=null)}else for(const f in c)this.deletedStates[e]&&this.deletedStates[e][d]&&this.deletedStates[e][d][f]===null&&delete this.deletedStates[e][d][f]}removeFeatureState(e,a,c){if(this.deletedStates[e]===null)return;const d=String(a);if(this.deletedStates[e]=this.deletedStates[e]||{},c&&a!==void 0)this.deletedStates[e][d]!==null&&(this.deletedStates[e][d]=this.deletedStates[e][d]||{},this.deletedStates[e][d][c]=null);else if(a!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][d])for(c in this.deletedStates[e][d]={},this.stateChanges[e][d])this.deletedStates[e][d][c]=null;else this.deletedStates[e][d]=null;else this.deletedStates[e]=null}getState(e,a){const c=String(a),d=u.e({},(this.state[e]||{})[c],(this.stateChanges[e]||{})[c]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const f=this.deletedStates[e][a];if(f===null)return{};for(const b in f)delete d[b]}return d}initializeTileState(e,a){e.setFeatureState(this.state,a)}coalesceChanges(e,a){const c={};for(const d in this.stateChanges){this.state[d]=this.state[d]||{};const f={};for(const b in this.stateChanges[d])this.state[d][b]||(this.state[d][b]={}),u.e(this.state[d][b],this.stateChanges[d][b]),f[b]=this.state[d][b];c[d]=f}for(const d in this.deletedStates){this.state[d]=this.state[d]||{};const f={};if(this.deletedStates[d]===null)for(const b in this.state[d])f[b]={},this.state[d][b]={};else for(const b in this.deletedStates[d]){if(this.deletedStates[d][b]===null)this.state[d][b]={};else for(const k of Object.keys(this.deletedStates[d][b]))delete this.state[d][b][k];f[b]=this.state[d][b]}c[d]=c[d]||{},u.e(c[d],f)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(const d in e)e[d].setFeatureState(c,a)}}class dt extends u.E{constructor(e,a,c){super(),this.id=e,this.dispatcher=c,this.on("data",d=>this._dataHandler(d)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((d,f,b,k)=>{const T=new(bo(f.type))(d,f,b,k);if(T.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${T.id}`);return T})(e,a,c,this),this._tiles={},this._cache=new Ne(0,d=>this._unloadTile(d)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new St,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const a=this._tiles[e];if(a.state!=="loaded"&&a.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,a,c){return u._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,a,c)}catch(d){e.state="errored",d.status!==404?this._source.fire(new u.j(d,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new u.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const c=this._tiles[a];c.upload(e),c.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(fn).map(e=>e.key)}getRenderableIds(e){const a=[];for(const c in this._tiles)this._isIdRenderable(c,e)&&a.push(this._tiles[c]);return e?a.sort((c,d)=>{const f=c.tileID,b=d.tileID,k=new u.P(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),T=new u.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-b.overscaledZ||T.y-k.y||T.x-k.x}).map(c=>c.tileID.key):a.map(c=>c.tileID).sort(fn).map(c=>c.key)}hasRenderableParent(e){const a=this.findLoadedParent(e,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(e,a){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(a||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,a){return u._(this,void 0,void 0,function*(){const c=this._tiles[e];c&&(c.state!=="loading"&&(c.state=a),yield this._loadTile(c,e,a))})}_tileLoaded(e,a,c){e.timeAdded=j.now(),c==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(a,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new u.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const a=this.getRenderableIds();for(let d=0;d<a.length;d++){const f=a[d];if(e.neighboringTiles&&e.neighboringTiles[f]){const b=this.getTileByID(f);c(e,b),c(b,e)}}function c(d,f){d.needsHillshadePrepare=!0,d.needsTerrainPrepare=!0;let b=f.tileID.canonical.x-d.tileID.canonical.x;const k=f.tileID.canonical.y-d.tileID.canonical.y,T=Math.pow(2,d.tileID.canonical.z),P=f.tileID.key;b===0&&k===0||Math.abs(k)>1||(Math.abs(b)>1&&(Math.abs(b+T)===1?b+=T:Math.abs(b-T)===1&&(b-=T)),f.dem&&d.dem&&(d.dem.backfillBorder(f.dem,b,k),d.neighboringTiles&&d.neighboringTiles[P]&&(d.neighboringTiles[P].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,a,c,d){for(const f in this._tiles){let b=this._tiles[f];if(d[f]||!b.hasData()||b.tileID.overscaledZ<=a||b.tileID.overscaledZ>c)continue;let k=b.tileID;for(;b&&b.tileID.overscaledZ>a+1;){const P=b.tileID.scaledTo(b.tileID.overscaledZ-1);b=this._tiles[P.key],b&&b.hasData()&&(k=P)}let T=k;for(;T.overscaledZ>a;)if(T=T.scaledTo(T.overscaledZ-1),e[T.key]){d[k.key]=k;break}}}findLoadedParent(e,a){if(e.key in this._loadedParentTiles){const c=this._loadedParentTiles[e.key];return c&&c.tileID.overscaledZ>=a?c:null}for(let c=e.overscaledZ-1;c>=a;c--){const d=e.scaledTo(c),f=this._getLoadedTile(d);if(f)return f}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const a=this._tiles[e.key];return a&&a.hasData()?a:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const a=Math.ceil(e.width/this._source.tileSize)+1,c=Math.ceil(e.height/this._source.tileSize)+1,d=Math.floor(a*c*(this._maxTileCacheZoomLevels===null?u.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),f=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,d):d;this._cache.setMaxSize(f)}handleWrapJump(e){const a=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,a){const c={};for(const d in this._tiles){const f=this._tiles[d];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+a),c[f.tileID.key]=f}this._tiles=c;for(const d in this._timers)clearTimeout(this._timers[d]),delete this._timers[d];for(const d in this._tiles)this._setTileReloadTimer(d,this._tiles[d])}}_updateCoveredAndRetainedTiles(e,a,c,d,f,b){const k={},T={},P=Object.keys(e),A=j.now();for(const z of P){const N=e[z],Z=this._tiles[z];if(!Z||Z.fadeEndTime!==0&&Z.fadeEndTime<=A)continue;const H=this.findLoadedParent(N,a),J=this.findLoadedSibling(N),re=H||J||null;re&&(this._addTile(re.tileID),k[re.tileID.key]=re.tileID),T[z]=N}this._retainLoadedChildren(T,d,c,e);for(const z in k)e[z]||(this._coveredTiles[z]=!0,e[z]=k[z]);if(b){const z={},N={};for(const Z of f)this._tiles[Z.key].hasData()?z[Z.key]=Z:N[Z.key]=Z;for(const Z in N){const H=N[Z].children(this._source.maxzoom);this._tiles[H[0].key]&&this._tiles[H[1].key]&&this._tiles[H[2].key]&&this._tiles[H[3].key]&&(z[H[0].key]=e[H[0].key]=H[0],z[H[1].key]=e[H[1].key]=H[1],z[H[2].key]=e[H[2].key]=H[2],z[H[3].key]=e[H[3].key]=H[3],delete N[Z])}for(const Z in N){const H=N[Z],J=this.findLoadedParent(H,this._source.minzoom),re=this.findLoadedSibling(H),ne=J||re||null;if(ne){z[ne.tileID.key]=e[ne.tileID.key]=ne.tileID;for(const se in z)z[se].isChildOf(ne.tileID)&&delete z[se]}}for(const Z in this._tiles)z[Z]||(this._coveredTiles[Z]=!0)}}update(e,a){if(!this._sourceLoaded||this._paused)return;let c;this.transform=e,this.terrain=a,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?c=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(A=>new u.S(A.canonical.z,A.wrap,A.canonical.z,A.canonical.x,A.canonical.y)):(c=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:a}),this._source.hasTile&&(c=c.filter(A=>this._source.hasTile(A)))):c=[];const d=e.coveringZoomLevel(this._source),f=Math.max(d-dt.maxOverzooming,this._source.minzoom),b=Math.max(d+dt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const A={};for(const z of c)if(z.canonical.z>this._source.minzoom){const N=z.scaledTo(z.canonical.z-1);A[N.key]=N;const Z=z.scaledTo(Math.max(this._source.minzoom,Math.min(z.canonical.z,5)));A[Z.key]=Z}c=c.concat(Object.values(A))}const k=c.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,k&&this.fire(new u.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const T=this._updateRetainedTiles(c,d);ai(this._source.type)&&this._updateCoveredAndRetainedTiles(T,f,b,d,c,a);for(const A in T)this._tiles[A].clearFadeHold();const P=u.ab(this._tiles,T);for(const A of P){const z=this._tiles[A];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(A)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,a){var c;const d={},f={},b=Math.max(a-dt.maxOverzooming,this._source.minzoom),k=Math.max(a+dt.maxUnderzooming,this._source.minzoom),T={};for(const P of e){const A=this._addTile(P);d[P.key]=P,A.hasData()||a<this._source.maxzoom&&(T[P.key]=P)}this._retainLoadedChildren(T,a,k,d);for(const P of e){let A=this._tiles[P.key];if(A.hasData())continue;if(a+1>this._source.maxzoom){const N=P.children(this._source.maxzoom)[0],Z=this.getTile(N);if(Z&&Z.hasData()){d[N.key]=N;continue}}else{const N=P.children(this._source.maxzoom);if(d[N[0].key]&&d[N[1].key]&&d[N[2].key]&&d[N[3].key])continue}let z=A.wasRequested();for(let N=P.overscaledZ-1;N>=b;--N){const Z=P.scaledTo(N);if(f[Z.key])break;if(f[Z.key]=!0,A=this.getTile(Z),!A&&z&&(A=this._addTile(Z)),A){const H=A.hasData();if((H||!(!((c=this.map)===null||c===void 0)&&c.cancelPendingTileRequestsWhileZooming)||z)&&(d[Z.key]=Z),z=A.wasRequested(),H)break}}}return d}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const a=[];let c,d=this._tiles[e].tileID;for(;d.overscaledZ>0;){if(d.key in this._loadedParentTiles){c=this._loadedParentTiles[d.key];break}a.push(d.key);const f=d.scaledTo(d.overscaledZ-1);if(c=this._getLoadedTile(f),c)break;d=f}for(const f of a)this._loadedParentTiles[f]=c}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const a=this._tiles[e].tileID,c=this._getLoadedTile(a);this._loadedSiblingTiles[a.key]=c}}_addTile(e){let a=this._tiles[e.key];if(a)return a;a=this._cache.getAndRemove(e),a&&(this._setTileReloadTimer(e.key,a),a.tileID=e,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,a)));const c=a;return a||(a=new us(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(a,e.key,a.state)),a.uses++,this._tiles[e.key]=a,c||this._source.fire(new u.k("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(e,a){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const c=a.getExpiryTimeout();c&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},c))}_removeTile(e){const a=this._tiles[e];a&&(a.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}_dataHandler(e){const a=e.sourceDataType;e.dataType==="source"&&a==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&a==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,a,c){const d=[],f=this.transform;if(!f)return d;const b=c?f.getCameraQueryGeometry(e):e,k=e.map(H=>f.pointCoordinate(H,this.terrain)),T=b.map(H=>f.pointCoordinate(H,this.terrain)),P=this.getIds();let A=1/0,z=1/0,N=-1/0,Z=-1/0;for(const H of T)A=Math.min(A,H.x),z=Math.min(z,H.y),N=Math.max(N,H.x),Z=Math.max(Z,H.y);for(let H=0;H<P.length;H++){const J=this._tiles[P[H]];if(J.holdingForFade())continue;const re=J.tileID,ne=Math.pow(2,f.zoom-J.tileID.overscaledZ),se=a*J.queryPadding*u.X/J.tileSize/ne,W=[re.getTilePoint(new u.Z(A,z)),re.getTilePoint(new u.Z(N,Z))];if(W[0].x-se<u.X&&W[0].y-se<u.X&&W[1].x+se>=0&&W[1].y+se>=0){const ue=k.map(ye=>re.getTilePoint(ye)),pe=T.map(ye=>re.getTilePoint(ye));d.push({tile:J,tileID:re,queryGeometry:ue,cameraQueryGeometry:pe,scale:ne})}}return d}getVisibleCoordinates(e){const a=this.getRenderableIds(e).map(c=>this._tiles[c].tileID);for(const c of a)c.posMatrix=this.transform.calculatePosMatrix(c.toUnwrapped());return a}hasTransition(){if(this._source.hasTransition())return!0;if(ai(this._source.type)){const e=j.now();for(const a in this._tiles)if(this._tiles[a].fadeEndTime>=e)return!0}return!1}setFeatureState(e,a,c){this._state.updateState(e=e||"_geojsonTileLayer",a,c)}removeFeatureState(e,a,c){this._state.removeFeatureState(e=e||"_geojsonTileLayer",a,c)}getFeatureState(e,a){return this._state.getState(e=e||"_geojsonTileLayer",a)}setDependencies(e,a,c){const d=this._tiles[e];d&&d.setDependencies(a,c)}reloadTilesForDependencies(e,a){for(const c in this._tiles)this._tiles[c].hasDependency(e,a)&&this._reloadTile(c,"reloading");this._cache.filter(c=>!c.hasDependency(e,a))}}function fn(m,e){const a=Math.abs(2*m.wrap)-+(m.wrap<0),c=Math.abs(2*e.wrap)-+(e.wrap<0);return m.overscaledZ-e.overscaledZ||c-a||e.canonical.y-m.canonical.y||e.canonical.x-m.canonical.x}function ai(m){return m==="raster"||m==="image"||m==="video"}dt.maxOverzooming=10,dt.maxUnderzooming=3;class _t{constructor(e,a){this.reset(e,a)}reset(e,a){this.points=e||[],this._distances=[0];for(let c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=u.ac(e,0,1);let a=1,c=this._distances[a];const d=e*this.paddedLength+this.padding;for(;c<d&&a<this._distances.length;)c=this._distances[++a];const f=a-1,b=this._distances[f],k=c-b,T=k>0?(d-b)/k:0;return this.points[f].mult(1-T).add(this.points[a].mult(T))}}function Mi(m,e){let a=!0;return m==="always"||m!=="never"&&e!=="never"||(a=!1),a}class Gi{constructor(e,a,c){const d=this.boxCells=[],f=this.circleCells=[];this.xCellCount=Math.ceil(e/c),this.yCellCount=Math.ceil(a/c);for(let b=0;b<this.xCellCount*this.yCellCount;b++)d.push([]),f.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=a,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,a,c,d,f){this._forEachCell(a,c,d,f,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(a),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(f)}insertCircle(e,a,c,d){this._forEachCell(a-d,c-d,a+d,c+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(a),this.circles.push(c),this.circles.push(d)}_insertBoxCell(e,a,c,d,f,b){this.boxCells[f].push(b)}_insertCircleCell(e,a,c,d,f,b){this.circleCells[f].push(b)}_query(e,a,c,d,f,b,k){if(c<0||e>this.width||d<0||a>this.height)return[];const T=[];if(e<=0&&a<=0&&this.width<=c&&this.height<=d){if(f)return[{key:null,x1:e,y1:a,x2:c,y2:d}];for(let P=0;P<this.boxKeys.length;P++)T.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const A=this.circles[3*P],z=this.circles[3*P+1],N=this.circles[3*P+2];T.push({key:this.circleKeys[P],x1:A-N,y1:z-N,x2:A+N,y2:z+N})}}else this._forEachCell(e,a,c,d,this._queryCell,T,{hitTest:f,overlapMode:b,seenUids:{box:{},circle:{}}},k);return T}query(e,a,c,d){return this._query(e,a,c,d,!1,null)}hitTest(e,a,c,d,f,b){return this._query(e,a,c,d,!0,f,b).length>0}hitTestCircle(e,a,c,d,f){const b=e-c,k=e+c,T=a-c,P=a+c;if(k<0||b>this.width||P<0||T>this.height)return!1;const A=[];return this._forEachCell(b,T,k,P,this._queryCellCircle,A,{hitTest:!0,overlapMode:d,circle:{x:e,y:a,radius:c},seenUids:{box:{},circle:{}}},f),A.length>0}_queryCell(e,a,c,d,f,b,k,T){const{seenUids:P,hitTest:A,overlapMode:z}=k,N=this.boxCells[f];if(N!==null){const H=this.bboxes;for(const J of N)if(!P.box[J]){P.box[J]=!0;const re=4*J,ne=this.boxKeys[J];if(e<=H[re+2]&&a<=H[re+3]&&c>=H[re+0]&&d>=H[re+1]&&(!T||T(ne))&&(!A||!Mi(z,ne.overlapMode))&&(b.push({key:ne,x1:H[re],y1:H[re+1],x2:H[re+2],y2:H[re+3]}),A))return!0}}const Z=this.circleCells[f];if(Z!==null){const H=this.circles;for(const J of Z)if(!P.circle[J]){P.circle[J]=!0;const re=3*J,ne=this.circleKeys[J];if(this._circleAndRectCollide(H[re],H[re+1],H[re+2],e,a,c,d)&&(!T||T(ne))&&(!A||!Mi(z,ne.overlapMode))){const se=H[re],W=H[re+1],ue=H[re+2];if(b.push({key:ne,x1:se-ue,y1:W-ue,x2:se+ue,y2:W+ue}),A)return!0}}}return!1}_queryCellCircle(e,a,c,d,f,b,k,T){const{circle:P,seenUids:A,overlapMode:z}=k,N=this.boxCells[f];if(N!==null){const H=this.bboxes;for(const J of N)if(!A.box[J]){A.box[J]=!0;const re=4*J,ne=this.boxKeys[J];if(this._circleAndRectCollide(P.x,P.y,P.radius,H[re+0],H[re+1],H[re+2],H[re+3])&&(!T||T(ne))&&!Mi(z,ne.overlapMode))return b.push(!0),!0}}const Z=this.circleCells[f];if(Z!==null){const H=this.circles;for(const J of Z)if(!A.circle[J]){A.circle[J]=!0;const re=3*J,ne=this.circleKeys[J];if(this._circlesCollide(H[re],H[re+1],H[re+2],P.x,P.y,P.radius)&&(!T||T(ne))&&!Mi(z,ne.overlapMode))return b.push(!0),!0}}}_forEachCell(e,a,c,d,f,b,k,T){const P=this._convertToXCellCoord(e),A=this._convertToYCellCoord(a),z=this._convertToXCellCoord(c),N=this._convertToYCellCoord(d);for(let Z=P;Z<=z;Z++)for(let H=A;H<=N;H++)if(f.call(this,e,a,c,d,this.xCellCount*H+Z,b,k,T))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,a,c,d,f,b){const k=d-e,T=f-a,P=c+b;return P*P>k*k+T*T}_circleAndRectCollide(e,a,c,d,f,b,k){const T=(b-d)/2,P=Math.abs(e-(d+T));if(P>T+c)return!1;const A=(k-f)/2,z=Math.abs(a-(f+A));if(z>A+c)return!1;if(P<=T||z<=A)return!0;const N=P-T,Z=z-A;return N*N+Z*Z<=c*c}}function cs(m,e,a,c,d){const f=u.H();return e?(u.K(f,f,[1/d,1/d,1]),a||u.ad(f,f,c.angle)):u.L(f,c.labelPlaneMatrix,m),f}function Ai(m,e,a,c,d){if(e){const f=u.ae(m);return u.K(f,f,[d,d,1]),a||u.ad(f,f,-c.angle),f}return c.glCoordMatrix}function Q(m,e,a,c){let d;c?(d=[m,e,c(m,e),1],u.af(d,d,a)):(d=[m,e,0,1],zt(d,d,a));const f=d[3];return{point:new u.P(d[0]/f,d[1]/f),signedDistanceFromCamera:f,isOccluded:!1}}function B(m,e){return .5+m/e*.5}function R(m,e){return m.x>=-e[0]&&m.x<=e[0]&&m.y>=-e[1]&&m.y<=e[1]}function q(m,e,a,c,d,f,b,k,T,P,A,z,N,Z,H){const J=c?m.textSizeData:m.iconSizeData,re=u.ag(J,a.transform.zoom),ne=[256/a.width*2+1,256/a.height*2+1],se=c?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;se.clear();const W=m.lineVertexArray,ue=c?m.text.placedSymbolArray:m.icon.placedSymbolArray,pe=a.transform.width/a.transform.height;let ye=!1;for(let Me=0;Me<ue.length;Me++){const De=ue.get(Me);if(De.hidden||De.writingMode===u.ah.vertical&&!ye){lt(De.numGlyphs,se);continue}ye=!1;const $e=Q(De.anchorX,De.anchorY,e,H);if(!R($e.point,ne)){lt(De.numGlyphs,se);continue}const Ke=B(a.transform.cameraToCenterDistance,$e.signedDistanceFromCamera),Oe=u.ai(J,re,De),Fe=b?Oe/Ke:Oe*Ke,et={getElevation:H,labelPlaneMatrix:d,lineVertexArray:W,pitchWithMap:b,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:P,tileAnchorPoint:new u.P(De.anchorX,De.anchorY),unwrappedTileID:A,width:z,height:N,translation:Z},gt=ce(et,De,Fe,!1,k,e,f,m.glyphOffsetArray,se,pe,T);ye=gt.useVertical,(gt.notEnoughRoom||ye||gt.needsFlipping&&ce(et,De,Fe,!0,k,e,f,m.glyphOffsetArray,se,pe,T).notEnoughRoom)&&lt(De.numGlyphs,se)}c?m.text.dynamicLayoutVertexBuffer.updateData(se):m.icon.dynamicLayoutVertexBuffer.updateData(se)}function Y(m,e,a,c,d,f,b,k){const T=f.glyphStartIndex+f.numGlyphs,P=f.lineStartIndex,A=f.lineStartIndex+f.lineLength,z=e.getoffsetX(f.glyphStartIndex),N=e.getoffsetX(T-1),Z=Be(m*z,a,c,d,f.segment,P,A,k,b);if(!Z)return null;const H=Be(m*N,a,c,d,f.segment,P,A,k,b);return H?k.projectionCache.anyProjectionOccluded?null:{first:Z,last:H}:null}function le(m,e,a,c){return m===u.ah.horizontal&&Math.abs(a.y-e.y)>Math.abs(a.x-e.x)*c?{useVertical:!0}:(m===u.ah.vertical?e.y<a.y:e.x>a.x)?{needsFlipping:!0}:null}function ce(m,e,a,c,d,f,b,k,T,P,A){const z=a/24,N=e.lineOffsetX*z,Z=e.lineOffsetY*z;let H;if(e.numGlyphs>1){const J=e.glyphStartIndex+e.numGlyphs,re=e.lineStartIndex,ne=e.lineStartIndex+e.lineLength,se=Y(z,k,N,Z,c,e,A,m);if(!se)return{notEnoughRoom:!0};const W=Q(se.first.point.x,se.first.point.y,b,m.getElevation).point,ue=Q(se.last.point.x,se.last.point.y,b,m.getElevation).point;if(d&&!c){const pe=le(e.writingMode,W,ue,P);if(pe)return pe}H=[se.first];for(let pe=e.glyphStartIndex+1;pe<J-1;pe++)H.push(Be(z*k.getoffsetX(pe),N,Z,c,e.segment,re,ne,m,A));H.push(se.last)}else{if(d&&!c){const re=Q(m.tileAnchorPoint.x,m.tileAnchorPoint.y,f,m.getElevation).point,ne=e.lineStartIndex+e.segment+1,se=new u.P(m.lineVertexArray.getx(ne),m.lineVertexArray.gety(ne)),W=Q(se.x,se.y,f,m.getElevation),ue=W.signedDistanceFromCamera>0?W.point:function(ye,Me,De,$e,Ke,Oe){return me(ye,Me,De,1,Ke,Oe)}(m.tileAnchorPoint,se,re,0,f,m),pe=le(e.writingMode,re,ue,P);if(pe)return pe}const J=Be(z*k.getoffsetX(e.glyphStartIndex),N,Z,c,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,m,A);if(!J||m.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};H=[J]}for(const J of H)u.aj(T,J.point,J.angle);return{}}function me(m,e,a,c,d,f){const b=m.add(m.sub(e)._unit()),k=d!==void 0?Q(b.x,b.y,d,f.getElevation).point:ke(b.x,b.y,f).point,T=a.sub(k);return a.add(T._mult(c/T.mag()))}function ie(m,e,a){const c=e.projectionCache;if(c.projections[m])return c.projections[m];const d=new u.P(e.lineVertexArray.getx(m),e.lineVertexArray.gety(m)),f=ke(d.x,d.y,e);if(f.signedDistanceFromCamera>0)return c.projections[m]=f.point,c.anyProjectionOccluded=c.anyProjectionOccluded||f.isOccluded,f.point;const b=m-a.direction;return function(k,T,P,A,z){return me(k,T,P,A,void 0,z)}(a.distanceFromAnchor===0?e.tileAnchorPoint:new u.P(e.lineVertexArray.getx(b),e.lineVertexArray.gety(b)),d,a.previousVertex,a.absOffsetX-a.distanceFromAnchor+1,e)}function ke(m,e,a){const c=m+a.translation[0],d=e+a.translation[1];let f;return!a.pitchWithMap&&a.projection.useSpecialProjectionForSymbols?(f=a.projection.projectTileCoordinates(c,d,a.unwrappedTileID,a.getElevation),f.point.x=(.5*f.point.x+.5)*a.width,f.point.y=(.5*-f.point.y+.5)*a.height):(f=Q(c,d,a.labelPlaneMatrix,a.getElevation),f.isOccluded=!1),f}function Ae(m,e,a){return m._unit()._perp()._mult(e*a)}function ve(m,e,a,c,d,f,b,k,T){if(k.projectionCache.offsets[m])return k.projectionCache.offsets[m];const P=a.add(e);if(m+T.direction<c||m+T.direction>=d)return k.projectionCache.offsets[m]=P,P;const A=ie(m+T.direction,k,T),z=Ae(A.sub(a),b,T.direction),N=a.add(z),Z=A.add(z);return k.projectionCache.offsets[m]=u.ak(f,P,N,Z)||P,k.projectionCache.offsets[m]}function Be(m,e,a,c,d,f,b,k,T){const P=c?m-e:m+e;let A=P>0?1:-1,z=0;c&&(A*=-1,z=Math.PI),A<0&&(z+=Math.PI);let N,Z=A>0?f+d:f+d+1;k.projectionCache.cachedAnchorPoint?N=k.projectionCache.cachedAnchorPoint:(N=ke(k.tileAnchorPoint.x,k.tileAnchorPoint.y,k).point,k.projectionCache.cachedAnchorPoint=N);let H,J,re=N,ne=N,se=0,W=0;const ue=Math.abs(P),pe=[];let ye;for(;se+W<=ue;){if(Z+=A,Z<f||Z>=b)return null;se+=W,ne=re,J=H;const $e={absOffsetX:ue,direction:A,distanceFromAnchor:se,previousVertex:ne};if(re=ie(Z,k,$e),a===0)pe.push(ne),ye=re.sub(ne);else{let Ke;const Oe=re.sub(ne);Ke=Oe.mag()===0?Ae(ie(Z+A,k,$e).sub(re),a,A):Ae(Oe,a,A),J||(J=ne.add(Ke)),H=ve(Z,Ke,re,f,b,J,a,k,$e),pe.push(J),ye=H.sub(J)}W=ye.mag()}const Me=ye._mult((ue-se)/W)._add(J||ne),De=z+Math.atan2(re.y-ne.y,re.x-ne.x);return pe.push(Me),{point:Me,angle:T?De:0,path:pe}}const at=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function lt(m,e){for(let a=0;a<m;a++){const c=e.length;e.resize(c+4),e.float32.set(at,3*c)}}function zt(m,e,a){const c=e[0],d=e[1];return m[0]=a[0]*c+a[4]*d+a[12],m[1]=a[1]*c+a[5]*d+a[13],m[3]=a[3]*c+a[7]*d+a[15],m}const vt=100;class Dt{constructor(e,a,c=new Gi(e.width+200,e.height+200,25),d=new Gi(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=a,this.grid=c,this.ignoredGrid=d,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+vt,this.screenBottomBoundary=e.height+vt,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,a,c,d,f,b,k,T,P,A,z){const N=e.anchorPointX+T[0],Z=e.anchorPointY+T[1],H=this.projectAndGetPerspectiveRatio(d,N,Z,f,A),J=c*H.perspectiveRatio;let re;if(b||k)re=this._projectCollisionBox(e,J,d,f,b,k,T,H,A,z);else{const pe=H.point.x+(z?z.x*J:0),ye=H.point.y+(z?z.y*J:0);re={allPointsOccluded:!1,box:[pe+e.x1*J,ye+e.y1*J,pe+e.x2*J,ye+e.y2*J]}}const[ne,se,W,ue]=re.box;return this.mapProjection.useSpecialProjectionForSymbols&&(b?re.allPointsOccluded:this.mapProjection.isOccluded(N,Z,f))||H.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(ne,se,W,ue)||a!=="always"&&this.grid.hitTest(ne,se,W,ue,a,P)?{box:[ne,se,W,ue],placeable:!1,offscreen:!1}:{box:[ne,se,W,ue],placeable:!0,offscreen:this.isOffscreen(ne,se,W,ue)}}placeCollisionCircles(e,a,c,d,f,b,k,T,P,A,z,N,Z,H,J,re){const ne=[],se=new u.P(a.anchorX,a.anchorY),W=this.getPerspectiveRatio(b,se.x,se.y,k,re),ue=(z?f/W:f*W)/u.ap,pe={getElevation:re,labelPlaneMatrix:T,lineVertexArray:c,pitchWithMap:z,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:se,unwrappedTileID:k,width:this.transform.width,height:this.transform.height,translation:J},ye=Y(ue,d,a.lineOffsetX*ue,a.lineOffsetY*ue,!1,a,!1,pe);let Me=!1,De=!1,$e=!0;if(ye){const Ke=.5*Z*W+H,Oe=new u.P(-100,-100),Fe=new u.P(this.screenRightBoundary,this.screenBottomBoundary),et=new _t,gt=ye.first,je=ye.last;let Ze=[];for(let wt=gt.path.length-1;wt>=1;wt--)Ze.push(gt.path[wt]);for(let wt=1;wt<je.path.length;wt++)Ze.push(je.path[wt]);const ft=2.5*Ke;if(P){const wt=this.projectPathToScreenSpace(Ze,pe,P);Ze=wt.some(Pt=>Pt.signedDistanceFromCamera<=0)?[]:wt.map(Pt=>Pt.point)}let tr=[];if(Ze.length>0){const wt=Ze[0].clone(),Pt=Ze[0].clone();for(let rr=1;rr<Ze.length;rr++)wt.x=Math.min(wt.x,Ze[rr].x),wt.y=Math.min(wt.y,Ze[rr].y),Pt.x=Math.max(Pt.x,Ze[rr].x),Pt.y=Math.max(Pt.y,Ze[rr].y);tr=wt.x>=Oe.x&&Pt.x<=Fe.x&&wt.y>=Oe.y&&Pt.y<=Fe.y?[Ze]:Pt.x<Oe.x||wt.x>Fe.x||Pt.y<Oe.y||wt.y>Fe.y?[]:u.al([Ze],Oe.x,Oe.y,Fe.x,Fe.y)}for(const wt of tr){et.reset(wt,.25*Ke);let Pt=0;Pt=et.length<=.5*Ke?1:Math.ceil(et.paddedLength/ft)+1;for(let rr=0;rr<Pt;rr++){const Hr=rr/Math.max(Pt-1,1),di=et.lerp(Hr),nr=di.x+vt,yn=di.y+vt;ne.push(nr,yn,Ke,0);const sn=nr-Ke,Kr=yn-Ke,an=nr+Ke,Ri=yn+Ke;if($e=$e&&this.isOffscreen(sn,Kr,an,Ri),De=De||this.isInsideGrid(sn,Kr,an,Ri),e!=="always"&&this.grid.hitTestCircle(nr,yn,Ke,e,N)&&(Me=!0,!A))return{circles:[],offscreen:!1,collisionDetected:Me}}}}return{circles:!A&&Me||!De||W<this.perspectiveRatioCutoff?[]:ne,offscreen:$e,collisionDetected:Me}}projectPathToScreenSpace(e,a,c){return e.map(d=>Q(d.x,d.y,c,a.getElevation))}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let c=1/0,d=1/0,f=-1/0,b=-1/0;for(const A of e){const z=new u.P(A.x+vt,A.y+vt);c=Math.min(c,z.x),d=Math.min(d,z.y),f=Math.max(f,z.x),b=Math.max(b,z.y),a.push(z)}const k=this.grid.query(c,d,f,b).concat(this.ignoredGrid.query(c,d,f,b)),T={},P={};for(const A of k){const z=A.key;if(T[z.bucketInstanceId]===void 0&&(T[z.bucketInstanceId]={}),T[z.bucketInstanceId][z.featureIndex])continue;const N=[new u.P(A.x1,A.y1),new u.P(A.x2,A.y1),new u.P(A.x2,A.y2),new u.P(A.x1,A.y2)];u.am(a,N)&&(T[z.bucketInstanceId][z.featureIndex]=!0,P[z.bucketInstanceId]===void 0&&(P[z.bucketInstanceId]=[]),P[z.bucketInstanceId].push(z.featureIndex))}return P}insertCollisionBox(e,a,c,d,f,b){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:f,collisionGroupID:b,overlapMode:a},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,a,c,d,f,b){const k=c?this.ignoredGrid:this.grid,T={bucketInstanceId:d,featureIndex:f,collisionGroupID:b,overlapMode:a};for(let P=0;P<e.length;P+=4)k.insertCircle(T,e[P],e[P+1],e[P+2])}projectAndGetPerspectiveRatio(e,a,c,d,f){let b;f?(b=[a,c,f(a,c),1],u.af(b,b,e)):(b=[a,c,0,1],zt(b,b,e));const k=b[3];return{point:new u.P((b[0]/k+1)/2*this.transform.width+vt,(-b[1]/k+1)/2*this.transform.height+vt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/k*.5,isOccluded:!1,signedDistanceFromCamera:k}}getPerspectiveRatio(e,a,c,d,f){const b=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(a,c,d,f):Q(a,c,e,f);return .5+this.transform.cameraToCenterDistance/b.signedDistanceFromCamera*.5}isOffscreen(e,a,c,d){return c<vt||e>=this.screenRightBoundary||d<vt||a>this.screenBottomBoundary}isInsideGrid(e,a,c,d){return c>=0&&e<this.gridRightBoundary&&d>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const e=u.an([]);return u.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,a,c,d,f,b,k,T,P,A){let z=new u.P(1,0),N=new u.P(0,1);const Z=new u.P(e.anchorPointX+k[0],e.anchorPointY+k[1]);if(b&&!f){const $e=this.projectAndGetPerspectiveRatio(c,Z.x+1,Z.y,d,P).point.sub(T.point).unit(),Ke=Math.atan($e.y/$e.x)+($e.x<0?Math.PI:0),Oe=Math.sin(Ke),Fe=Math.cos(Ke);z=new u.P(Fe,Oe),N=new u.P(-Oe,Fe)}else if(!b&&f){const $e=-this.transform.angle,Ke=Math.sin($e),Oe=Math.cos($e);z=new u.P(Oe,Ke),N=new u.P(-Ke,Oe)}let H=T.point,J=a;if(f){H=Z;const $e=this.transform.zoom-Math.floor(this.transform.zoom);J=Math.pow(2,-$e),J*=this.mapProjection.getPitchedTextCorrection(this.transform,Z,d),A||(J*=u.ac(.5+T.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}A&&(H=H.add(z.mult(A.x*J)).add(N.mult(A.y*J)));const re=e.x1*J,ne=e.x2*J,se=(re+ne)/2,W=e.y1*J,ue=e.y2*J,pe=(W+ue)/2,ye=[{offsetX:re,offsetY:W},{offsetX:se,offsetY:W},{offsetX:ne,offsetY:W},{offsetX:ne,offsetY:pe},{offsetX:ne,offsetY:ue},{offsetX:se,offsetY:ue},{offsetX:re,offsetY:ue},{offsetX:re,offsetY:pe}];let Me=[];for(const{offsetX:$e,offsetY:Ke}of ye)Me.push(new u.P(H.x+z.x*$e+N.x*Ke,H.y+z.y*$e+N.y*Ke));let De=!1;if(f){const $e=Me.map(Ke=>this.projectAndGetPerspectiveRatio(c,Ke.x,Ke.y,d,P));De=$e.some(Ke=>!Ke.isOccluded),Me=$e.map(Ke=>Ke.point)}else De=!0;return{box:u.ao(Me),allPointsOccluded:!De}}}function Et(m,e,a){return e*(u.X/(m.tileSize*Math.pow(2,a-m.tileID.overscaledZ)))}class Ir{constructor(e,a,c,d){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?a:-a))):d&&c?1:0,this.placed=c}isHidden(){return this.opacity===0&&!this.placed}}class ur{constructor(e,a,c,d,f){this.text=new Ir(e?e.text:null,a,c,f),this.icon=new Ir(e?e.icon:null,a,d,f)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class kt{constructor(e,a,c){this.text=e,this.icon=a,this.skipFade=c}}class $t{constructor(){this.invProjMatrix=u.H(),this.viewportMatrix=u.H(),this.circles=[]}}class sr{constructor(e,a,c,d,f){this.bucketInstanceId=e,this.featureIndex=a,this.sourceLayerIndex=c,this.bucketIndex=d,this.tileID=f}}class Dr{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const a=++this.maxGroupID;this.collisionGroups[e]={ID:a,predicate:c=>c.collisionGroupID===a}}return this.collisionGroups[e]}}function Nr(m,e,a,c,d){const{horizontalAlign:f,verticalAlign:b}=u.au(m);return new u.P(-(f-.5)*e+c[0]*d,-(b-.5)*a+c[1]*d)}class nn{constructor(e,a,c,d,f,b){this.transform=e.clone(),this.terrain=c,this.collisionIndex=new Dt(this.transform,a),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new Dr(f),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const a=this.terrain;return a?(c,d)=>a.getElevation(e,c,d):null}getBucketParts(e,a,c,d){const f=c.getBucket(a),b=c.latestFeatureIndex;if(!f||!b||a.id!==f.layerIds[0])return;const k=c.collisionBoxArray,T=f.layers[0].layout,P=f.layers[0].paint,A=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),z=c.tileSize/u.X,N=c.tileID.toUnwrapped(),Z=this.transform.calculatePosMatrix(N),H=T.get("text-pitch-alignment")==="map",J=T.get("text-rotation-alignment")==="map",re=Et(c,1,this.transform.zoom),ne=this.collisionIndex.mapProjection.translatePosition(this.transform,c,P.get("text-translate"),P.get("text-translate-anchor")),se=this.collisionIndex.mapProjection.translatePosition(this.transform,c,P.get("icon-translate"),P.get("icon-translate-anchor")),W=cs(Z,H,J,this.transform,re);let ue=null;if(H){const ye=Ai(Z,H,J,this.transform,re);ue=u.L([],this.transform.labelPlaneMatrix,ye)}this.retainedQueryData[f.bucketInstanceId]=new sr(f.bucketInstanceId,b,f.sourceLayerIndex,f.index,c.tileID);const pe={bucket:f,layout:T,translationText:ne,translationIcon:se,posMatrix:Z,unwrappedTileID:N,textLabelPlaneMatrix:W,labelToScreenMatrix:ue,scale:A,textPixelRatio:z,holdingForFade:c.holdingForFade(),collisionBoxArray:k,partiallyEvaluatedTextSize:u.ag(f.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(f.sourceID)};if(d)for(const ye of f.sortKeyRanges){const{sortKey:Me,symbolInstanceStart:De,symbolInstanceEnd:$e}=ye;e.push({sortKey:Me,symbolInstanceStart:De,symbolInstanceEnd:$e,parameters:pe})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:f.symbolInstances.length,parameters:pe})}attemptAnchorPlacement(e,a,c,d,f,b,k,T,P,A,z,N,Z,H,J,re,ne,se,W){const ue=u.aq[e.textAnchor],pe=[e.textOffset0,e.textOffset1],ye=Nr(ue,c,d,pe,f),Me=this.collisionIndex.placeCollisionBox(a,N,T,P,A,k,b,re,z.predicate,W,ye);if((!se||this.collisionIndex.placeCollisionBox(se,N,T,P,A,k,b,ne,z.predicate,W,ye).placeable)&&Me.placeable){let De;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID].text&&(De=this.prevPlacement.variableOffsets[Z.crossTileID].anchor),Z.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[Z.crossTileID]={textOffset:pe,width:c,height:d,anchor:ue,textBoxScale:f,prevAnchor:De},this.markUsedJustification(H,ue,Z,J),H.allowVerticalPlacement&&(this.markUsedOrientation(H,J,Z),this.placedOrientations[Z.crossTileID]=J),{shift:ye,placedGlyphBoxes:Me}}}placeLayerBucketPart(e,a,c){const{bucket:d,layout:f,translationText:b,translationIcon:k,posMatrix:T,unwrappedTileID:P,textLabelPlaneMatrix:A,labelToScreenMatrix:z,textPixelRatio:N,holdingForFade:Z,collisionBoxArray:H,partiallyEvaluatedTextSize:J,collisionGroup:re}=e.parameters,ne=f.get("text-optional"),se=f.get("icon-optional"),W=u.ar(f,"text-overlap","text-allow-overlap"),ue=W==="always",pe=u.ar(f,"icon-overlap","icon-allow-overlap"),ye=pe==="always",Me=f.get("text-rotation-alignment")==="map",De=f.get("text-pitch-alignment")==="map",$e=f.get("icon-text-fit")!=="none",Ke=f.get("symbol-z-order")==="viewport-y",Oe=ue&&(ye||!d.hasIconData()||se),Fe=ye&&(ue||!d.hasTextData()||ne);!d.collisionArrays&&H&&d.deserializeCollisionBoxes(H);const et=this._getTerrainElevationFunc(this.retainedQueryData[d.bucketInstanceId].tileID),gt=(je,Ze,ft)=>{var tr,wt;if(a[je.crossTileID])return;if(Z)return void(this.placements[je.crossTileID]=new kt(!1,!1,!1));let Pt=!1,rr=!1,Hr=!0,di=null,nr={box:null,placeable:!1,offscreen:null},yn={placeable:!1},sn=null,Kr=null,an=null,Ri=0,Da=0,Wl=0;Ze.textFeatureIndex?Ri=Ze.textFeatureIndex:je.useRuntimeCollisionCircles&&(Ri=je.featureIndex),Ze.verticalTextFeatureIndex&&(Da=Ze.verticalTextFeatureIndex);const La=Ze.textBox;if(La){const Wn=jr=>{let Wr=u.ah.horizontal;if(d.allowVerticalPlacement&&!jr&&this.prevPlacement){const Ln=this.prevPlacement.placedOrientations[je.crossTileID];Ln&&(this.placedOrientations[je.crossTileID]=Ln,Wr=Ln,this.markUsedOrientation(d,Wr,je))}return Wr},Xn=(jr,Wr)=>{if(d.allowVerticalPlacement&&je.numVerticalGlyphVertices>0&&Ze.verticalTextBox){for(const Ln of d.writingModes)if(Ln===u.ah.vertical?(nr=Wr(),yn=nr):nr=jr(),nr&&nr.placeable)break}else nr=jr()},ps=je.textAnchorOffsetStartIndex,pi=je.textAnchorOffsetEndIndex;if(pi===ps){const jr=(Wr,Ln)=>{const Mt=this.collisionIndex.placeCollisionBox(Wr,W,N,T,P,De,Me,b,re.predicate,et);return Mt&&Mt.placeable&&(this.markUsedOrientation(d,Ln,je),this.placedOrientations[je.crossTileID]=Ln),Mt};Xn(()=>jr(La,u.ah.horizontal),()=>{const Wr=Ze.verticalTextBox;return d.allowVerticalPlacement&&je.numVerticalGlyphVertices>0&&Wr?jr(Wr,u.ah.vertical):{box:null,offscreen:null}}),Wn(nr&&nr.placeable)}else{let jr=u.aq[(wt=(tr=this.prevPlacement)===null||tr===void 0?void 0:tr.variableOffsets[je.crossTileID])===null||wt===void 0?void 0:wt.anchor];const Wr=(Mt,Us,Ra)=>{const Ba=Mt.x2-Mt.x1,Xd=Mt.y2-Mt.y1,Rm=je.textBoxScale,Yd=$e&&pe==="never"?Us:null;let fs=null,Jd=W==="never"?1:2,Yl="never";jr&&Jd++;for(let Uo=0;Uo<Jd;Uo++){for(let Jl=ps;Jl<pi;Jl++){const Ql=d.textAnchorOffsets.get(Jl);if(jr&&Ql.textAnchor!==jr)continue;const Fa=this.attemptAnchorPlacement(Ql,Mt,Ba,Xd,Rm,Me,De,N,T,P,re,Yl,je,d,Ra,b,k,Yd,et);if(Fa&&(fs=Fa.placedGlyphBoxes,fs&&fs.placeable))return Pt=!0,di=Fa.shift,fs}jr?jr=null:Yl=W}return c&&!fs&&(fs={box:this.collisionIndex.placeCollisionBox(La,"always",N,T,P,De,Me,b,re.predicate,et,new u.P(0,0)).box,offscreen:!1,placeable:!1}),fs};Xn(()=>Wr(La,Ze.iconBox,u.ah.horizontal),()=>{const Mt=Ze.verticalTextBox;return d.allowVerticalPlacement&&(!nr||!nr.placeable)&&je.numVerticalGlyphVertices>0&&Mt?Wr(Mt,Ze.verticalIconBox,u.ah.vertical):{box:null,occluded:!0,offscreen:null}}),nr&&(Pt=nr.placeable,Hr=nr.offscreen);const Ln=Wn(nr&&nr.placeable);if(!Pt&&this.prevPlacement){const Mt=this.prevPlacement.variableOffsets[je.crossTileID];Mt&&(this.variableOffsets[je.crossTileID]=Mt,this.markUsedJustification(d,Mt.anchor,je,Ln))}}}if(sn=nr,Pt=sn&&sn.placeable,Hr=sn&&sn.offscreen,je.useRuntimeCollisionCircles){const Wn=d.text.placedSymbolArray.get(je.centerJustifiedTextSymbolIndex),Xn=u.ai(d.textSizeData,J,Wn),ps=f.get("text-padding");Kr=this.collisionIndex.placeCollisionCircles(W,Wn,d.lineVertexArray,d.glyphOffsetArray,Xn,T,P,A,z,c,De,re.predicate,je.collisionCircleDiameter,ps,b,et),Kr.circles.length&&Kr.collisionDetected&&!c&&u.w("Collisions detected, but collision boxes are not shown"),Pt=ue||Kr.circles.length>0&&!Kr.collisionDetected,Hr=Hr&&Kr.offscreen}if(Ze.iconFeatureIndex&&(Wl=Ze.iconFeatureIndex),Ze.iconBox){const Wn=Xn=>this.collisionIndex.placeCollisionBox(Xn,pe,N,T,P,De,Me,k,re.predicate,et,$e&&di?di:void 0);yn&&yn.placeable&&Ze.verticalIconBox?(an=Wn(Ze.verticalIconBox),rr=an.placeable):(an=Wn(Ze.iconBox),rr=an.placeable),Hr=Hr&&an.offscreen}const Kn=ne||je.numHorizontalGlyphVertices===0&&je.numVerticalGlyphVertices===0,Xl=se||je.numIconVertices===0;Kn||Xl?Xl?Kn||(rr=rr&&Pt):Pt=rr&&Pt:rr=Pt=rr&&Pt;const Vc=rr&&an.placeable;if(Pt&&sn.placeable&&this.collisionIndex.insertCollisionBox(sn.box,W,f.get("text-ignore-placement"),d.bucketInstanceId,yn&&yn.placeable&&Da?Da:Ri,re.ID),Vc&&this.collisionIndex.insertCollisionBox(an.box,pe,f.get("icon-ignore-placement"),d.bucketInstanceId,Wl,re.ID),Kr&&Pt&&this.collisionIndex.insertCollisionCircles(Kr.circles,W,f.get("text-ignore-placement"),d.bucketInstanceId,Ri,re.ID),c&&this.storeCollisionData(d.bucketInstanceId,ft,Ze,sn,an,Kr),je.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(d.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[je.crossTileID]=new kt(Pt||Oe,rr||Fe,Hr||d.justReloaded),a[je.crossTileID]=!0};if(Ke){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const je=d.getSortedSymbolIndexes(this.transform.angle);for(let Ze=je.length-1;Ze>=0;--Ze){const ft=je[Ze];gt(d.symbolInstances.get(ft),d.collisionArrays[ft],ft)}}else for(let je=e.symbolInstanceStart;je<e.symbolInstanceEnd;je++)gt(d.symbolInstances.get(je),d.collisionArrays[je],je);if(c&&d.bucketInstanceId in this.collisionCircleArrays){const je=this.collisionCircleArrays[d.bucketInstanceId];u.as(je.invProjMatrix,T),je.viewportMatrix=this.collisionIndex.getViewportMatrix()}d.justReloaded=!1}storeCollisionData(e,a,c,d,f,b){if(c.textBox||c.iconBox){let k,T;this.collisionBoxArrays.has(e)?k=this.collisionBoxArrays.get(e):(k=new Map,this.collisionBoxArrays.set(e,k)),k.has(a)?T=k.get(a):(T={text:null,icon:null},k.set(a,T)),c.textBox&&(T.text=d.box),c.iconBox&&(T.icon=f.box)}if(b){let k=this.collisionCircleArrays[e];k===void 0&&(k=this.collisionCircleArrays[e]=new $t);for(let T=0;T<b.circles.length;T+=4)k.circles.push(b.circles[T+0]),k.circles.push(b.circles[T+1]),k.circles.push(b.circles[T+2]),k.circles.push(b.collisionDetected?1:0)}}markUsedJustification(e,a,c,d){let f;f=d===u.ah.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[u.at(a)];const b=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];for(const k of b)k>=0&&(e.text.placedSymbolArray.get(k).crossTileID=f>=0&&k!==f?0:c.crossTileID)}markUsedOrientation(e,a,c){const d=a===u.ah.horizontal||a===u.ah.horizontalOnly?a:0,f=a===u.ah.vertical?a:0,b=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];for(const k of b)e.text.placedSymbolArray.get(k).placedOrientation=d;c.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=f)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let c=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const d=a?a.symbolFadeChange(e):1,f=a?a.opacities:{},b=a?a.variableOffsets:{},k=a?a.placedOrientations:{};for(const T in this.placements){const P=this.placements[T],A=f[T];A?(this.opacities[T]=new ur(A,d,P.text,P.icon),c=c||P.text!==A.text.placed||P.icon!==A.icon.placed):(this.opacities[T]=new ur(null,d,P.text,P.icon,P.skipFade),c=c||P.text||P.icon)}for(const T in f){const P=f[T];if(!this.opacities[T]){const A=new ur(P,d,!1,!1);A.isHidden()||(this.opacities[T]=A,c=c||P.text.placed||P.icon.placed)}}for(const T in b)this.variableOffsets[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.variableOffsets[T]=b[T]);for(const T in k)this.placedOrientations[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.placedOrientations[T]=k[T]);if(a&&a.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");c?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:e)}updateLayerOpacities(e,a){const c={};for(const d of a){const f=d.getBucket(e);f&&d.latestFeatureIndex&&e.id===f.layerIds[0]&&this.updateBucketOpacities(f,d.tileID,c,d.collisionBoxArray)}}updateBucketOpacities(e,a,c,d){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const f=e.layers[0],b=f.layout,k=new ur(null,0,!1,!1,!0),T=b.get("text-allow-overlap"),P=b.get("icon-allow-overlap"),A=f._unevaluatedLayout.hasValue("text-variable-anchor")||f._unevaluatedLayout.hasValue("text-variable-anchor-offset"),z=b.get("text-rotation-alignment")==="map",N=b.get("text-pitch-alignment")==="map",Z=b.get("icon-text-fit")!=="none",H=new ur(null,0,T&&(P||!e.hasIconData()||b.get("icon-optional")),P&&(T||!e.hasTextData()||b.get("text-optional")),!0);!e.collisionArrays&&d&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(d);const J=(ne,se,W)=>{for(let ue=0;ue<se/4;ue++)ne.opacityVertexArray.emplaceBack(W);ne.hasVisibleVertices=ne.hasVisibleVertices||W!==pa},re=this.collisionBoxArrays.get(e.bucketInstanceId);for(let ne=0;ne<e.symbolInstances.length;ne++){const se=e.symbolInstances.get(ne),{numHorizontalGlyphVertices:W,numVerticalGlyphVertices:ue,crossTileID:pe}=se;let ye=this.opacities[pe];c[pe]?ye=k:ye||(ye=H,this.opacities[pe]=ye),c[pe]=!0;const Me=se.numIconVertices>0,De=this.placedOrientations[se.crossTileID],$e=De===u.ah.vertical,Ke=De===u.ah.horizontal||De===u.ah.horizontalOnly;if(W>0||ue>0){const Fe=An(ye.text);J(e.text,W,$e?pa:Fe),J(e.text,ue,Ke?pa:Fe);const et=ye.text.isHidden();[se.rightJustifiedTextSymbolIndex,se.centerJustifiedTextSymbolIndex,se.leftJustifiedTextSymbolIndex].forEach(Ze=>{Ze>=0&&(e.text.placedSymbolArray.get(Ze).hidden=et||$e?1:0)}),se.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(se.verticalPlacedTextSymbolIndex).hidden=et||Ke?1:0);const gt=this.variableOffsets[se.crossTileID];gt&&this.markUsedJustification(e,gt.anchor,se,De);const je=this.placedOrientations[se.crossTileID];je&&(this.markUsedJustification(e,"left",se,je),this.markUsedOrientation(e,je,se))}if(Me){const Fe=An(ye.icon),et=!(Z&&se.verticalPlacedIconSymbolIndex&&$e);se.placedIconSymbolIndex>=0&&(J(e.icon,se.numIconVertices,et?Fe:pa),e.icon.placedSymbolArray.get(se.placedIconSymbolIndex).hidden=ye.icon.isHidden()),se.verticalPlacedIconSymbolIndex>=0&&(J(e.icon,se.numVerticalIconVertices,et?pa:Fe),e.icon.placedSymbolArray.get(se.verticalPlacedIconSymbolIndex).hidden=ye.icon.isHidden())}const Oe=re&&re.has(ne)?re.get(ne):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Fe=e.collisionArrays[ne];if(Fe){let et=new u.P(0,0);if(Fe.textBox||Fe.verticalTextBox){let gt=!0;if(A){const je=this.variableOffsets[pe];je?(et=Nr(je.anchor,je.width,je.height,je.textOffset,je.textBoxScale),z&&et._rotate(N?this.transform.angle:-this.transform.angle)):gt=!1}if(Fe.textBox||Fe.verticalTextBox){let je;Fe.textBox&&(je=$e),Fe.verticalTextBox&&(je=Ke),da(e.textCollisionBox.collisionVertexArray,ye.text.placed,!gt||je,Oe.text,et.x,et.y)}}if(Fe.iconBox||Fe.verticalIconBox){const gt=!!(!Ke&&Fe.verticalIconBox);let je;Fe.iconBox&&(je=gt),Fe.verticalIconBox&&(je=!gt),da(e.iconCollisionBox.collisionVertexArray,ye.icon.placed,je,Oe.icon,Z?et.x:0,Z?et.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const ne=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=ne.invProjMatrix,e.placementViewportMatrix=ne.viewportMatrix,e.collisionCircleArray=ne.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,a){const c=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*c>e}setStale(){this.stale=!0}}function da(m,e,a,c,d,f){c&&c.length!==0||(c=[0,0,0,0]);const b=c[0]-vt,k=c[1]-vt,T=c[2]-vt,P=c[3]-vt;m.emplaceBack(e?1:0,a?1:0,d||0,f||0,b,k),m.emplaceBack(e?1:0,a?1:0,d||0,f||0,T,k),m.emplaceBack(e?1:0,a?1:0,d||0,f||0,T,P),m.emplaceBack(e?1:0,a?1:0,d||0,f||0,b,P)}const qt=Math.pow(2,25),Ju=Math.pow(2,24),Qu=Math.pow(2,17),Cn=Math.pow(2,16),Mn=Math.pow(2,9),um=Math.pow(2,8),qn=Math.pow(2,1);function An(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const e=m.placed?1:0,a=Math.floor(127*m.opacity);return a*qt+e*Ju+a*Qu+e*Cn+a*Mn+e*um+a*qn+e}const pa=0;function Ms(){return{isOccluded:(m,e,a)=>!1,getPitchedTextCorrection:(m,e,a)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(m,e,a,c){throw new Error("Not implemented.")},translatePosition:(m,e,a,c)=>function(d,f,b,k,T=!1){if(!b[0]&&!b[1])return[0,0];const P=T?k==="map"?d.angle:0:k==="viewport"?-d.angle:0;if(P){const A=Math.sin(P),z=Math.cos(P);b=[b[0]*z-b[1]*A,b[0]*A+b[1]*z]}return[T?b[0]:Et(f,b[0],d.zoom),T?b[1]:Et(f,b[1],d.zoom)]}(m,e,a,c),getCircleRadiusCorrection:m=>1}}class Er{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,a,c,d,f){const b=this._bucketParts;for(;this._currentTileIndex<e.length;)if(a.getBucketParts(b,d,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,f())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort((k,T)=>k.sortKey-T.sortKey));this._currentPartIndex<b.length;)if(a.placeLayerBucketPart(b[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,f())return!0;return!1}}class So{constructor(e,a,c,d,f,b,k,T){this.placement=new nn(e,Ms(),a,b,k,T),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=f,this._done=!1}isDone(){return this._done}continuePlacement(e,a,c){const d=j.now(),f=()=>!this._forceFullPlacement&&j.now()-d>2;for(;this._currentPlacementIndex>=0;){const b=a[e[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if(b.type==="symbol"&&(!b.minzoom||b.minzoom<=k)&&(!b.maxzoom||b.maxzoom>k)){if(this._inProgressLayer||(this._inProgressLayer=new Er(b)),this._inProgressLayer.continuePlacement(c[b.source],this.placement,this._showCollisionBoxes,b,f))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const oi=512/u.X/2;class xr{constructor(e,a,c){this.tileID=e,this.bucketInstanceId=c,this._symbolsByKey={};const d=new Map;for(let f=0;f<a.length;f++){const b=a.get(f),k=b.key,T=d.get(k);T?T.push(b):d.set(k,[b])}for(const[f,b]of d){const k={positions:b.map(T=>({x:Math.floor(T.anchorX*oi),y:Math.floor(T.anchorY*oi)})),crossTileIDs:b.map(T=>T.crossTileID)};if(k.positions.length>128){const T=new u.av(k.positions.length,16,Uint16Array);for(const{x:P,y:A}of k.positions)T.add(P,A);T.finish(),delete k.positions,k.index=T}this._symbolsByKey[f]=k}}getScaledCoordinates(e,a){const{x:c,y:d,z:f}=this.tileID.canonical,{x:b,y:k,z:T}=a.canonical,P=oi/Math.pow(2,T-f),A=(k*u.X+e.anchorY)*P,z=d*u.X*oi;return{x:Math.floor((b*u.X+e.anchorX)*P-c*u.X*oi),y:Math.floor(A-z)}}findMatches(e,a,c){const d=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let f=0;f<e.length;f++){const b=e.get(f);if(b.crossTileID)continue;const k=this._symbolsByKey[b.key];if(!k)continue;const T=this.getScaledCoordinates(b,a);if(k.index){const P=k.index.range(T.x-d,T.y-d,T.x+d,T.y+d).sort();for(const A of P){const z=k.crossTileIDs[A];if(!c[z]){c[z]=!0,b.crossTileID=z;break}}}else if(k.positions)for(let P=0;P<k.positions.length;P++){const A=k.positions[P],z=k.crossTileIDs[P];if(Math.abs(A.x-T.x)<=d&&Math.abs(A.y-T.y)<=d&&!c[z]){c[z]=!0,b.crossTileID=z;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class _l{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class li{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const a=Math.round((e-this.lng)/360);if(a!==0)for(const c in this.indexes){const d=this.indexes[c],f={};for(const b in d){const k=d[b];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+a),f[k.tileID.key]=k}this.indexes[c]=f}this.lng=e}addBucket(e,a,c){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let f=0;f<a.symbolInstances.length;f++)a.symbolInstances.get(f).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const d=this.usedCrossTileIDs[e.overscaledZ];for(const f in this.indexes){const b=this.indexes[f];if(Number(f)>e.overscaledZ)for(const k in b){const T=b[k];T.tileID.isChildOf(e)&&T.findMatches(a.symbolInstances,e,d)}else{const k=b[e.scaledTo(Number(f)).key];k&&k.findMatches(a.symbolInstances,e,d)}}for(let f=0;f<a.symbolInstances.length;f++){const b=a.symbolInstances.get(f);b.crossTileID||(b.crossTileID=c.generate(),d[b.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new xr(e,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(e,a){for(const c of a.getCrossTileIDsLists())for(const d of c)delete this.usedCrossTileIDs[e][d]}removeStaleBuckets(e){let a=!1;for(const c in this.indexes){const d=this.indexes[c];for(const f in d)e[d[f].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,d[f]),delete d[f],a=!0)}return a}}class ec{constructor(){this.layerIndexes={},this.crossTileIDs=new _l,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,a,c){let d=this.layerIndexes[e.id];d===void 0&&(d=this.layerIndexes[e.id]=new li);let f=!1;const b={};d.handleWrapJump(c);for(const k of a){const T=k.getBucket(e);T&&e.id===T.layerIds[0]&&(T.bucketInstanceId||(T.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(k.tileID,T,this.crossTileIDs)&&(f=!0),b[T.bucketInstanceId]=!0)}return d.removeStaleBuckets(b)&&(f=!0),f}pruneUnusedLayers(e){const a={};e.forEach(c=>{a[c]=!0});for(const c in this.layerIndexes)a[c]||delete this.layerIndexes[c]}}const ui=(m,e)=>u.t(m,e&&e.filter(a=>a.identifier!=="source.canvas")),cm=u.aw();class vl extends u.E{constructor(e,a={}){super(),this._rtlPluginLoaded=()=>{for(const c in this.sourceCaches){const d=this.sourceCaches[c].getSource().type;d!=="vector"&&d!=="geojson"||this.sourceCaches[c].reload()}},this.map=e,this.dispatcher=new Ps(Es(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(c,d)=>this.getGlyphs(c,d)),this.dispatcher.registerMessageHandler("GI",(c,d)=>this.getImages(c,d)),this.imageManager=new Tt,this.imageManager.setEventedParent(this),this.glyphManager=new Nt(e._requestManager,a.localIdeographFontFamily),this.lineAtlas=new ii(256,512),this.crossTileSymbolIndex=new ec,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new u.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",u.ay()),Ci().on(Le,this._rtlPluginLoaded),this.on("data",c=>{if(c.dataType!=="source"||c.sourceDataType!=="metadata")return;const d=this.sourceCaches[c.sourceId];if(!d)return;const f=d.getSource();if(f&&f.vectorLayerIds)for(const b in this._layers){const k=this._layers[b];k.source===f.id&&this._validateLayer(k)}})}loadURL(e,a={},c){this.fire(new u.k("dataloading",{dataType:"style"})),a.validate=typeof a.validate!="boolean"||a.validate;const d=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const f=this._loadStyleRequest;u.h(d,this._loadStyleRequest).then(b=>{this._loadStyleRequest=null,this._load(b.data,a,c)}).catch(b=>{this._loadStyleRequest=null,b&&!f.signal.aborted&&this.fire(new u.j(b))})}loadJSON(e,a={},c){this.fire(new u.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,j.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,a.validate=a.validate!==!1,this._load(e,a,c)}).catch(()=>{})}loadEmpty(){this.fire(new u.k("dataloading",{dataType:"style"})),this._load(cm,{validate:!1})}_load(e,a,c){var d;const f=a.transformStyle?a.transformStyle(c,e):e;if(!a.validate||!ui(this,u.u(f))){this._loaded=!0,this.stylesheet=f;for(const b in f.sources)this.addSource(b,f.sources[b],{validate:!1});f.sprite?this._loadSprite(f.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(f.glyphs),this._createLayers(),this.light=new pt(this.stylesheet.light),this.sky=new Ut(this.stylesheet.sky),this.map.setTerrain((d=this.stylesheet.terrain)!==null&&d!==void 0?d:null),this.fire(new u.k("data",{dataType:"style"})),this.fire(new u.k("style.load"))}}_createLayers(){const e=u.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(a=>a.id),this._layers={},this._serializedLayers=null;for(const a of e){const c=u.aA(a);c.setEventedParent(this,{layer:{id:a.id}}),this._layers[a.id]=c}}_loadSprite(e,a=!1,c=void 0){let d;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(f,b,k,T){return u._(this,void 0,void 0,function*(){const P=Ce(f),A=k>1?"@2x":"",z={},N={};for(const{id:Z,url:H}of P){const J=b.transformRequest(rt(H,A,".json"),"SpriteJSON");z[Z]=u.h(J,T);const re=b.transformRequest(rt(H,A,".png"),"SpriteImage");N[Z]=ee.getImage(re,T)}return yield Promise.all([...Object.values(z),...Object.values(N)]),function(Z,H){return u._(this,void 0,void 0,function*(){const J={};for(const re in Z){J[re]={};const ne=j.getImageCanvasContext((yield H[re]).data),se=(yield Z[re]).data;for(const W in se){const{width:ue,height:pe,x:ye,y:Me,sdf:De,pixelRatio:$e,stretchX:Ke,stretchY:Oe,content:Fe,textFitWidth:et,textFitHeight:gt}=se[W];J[re][W]={data:null,pixelRatio:$e,sdf:De,stretchX:Ke,stretchY:Oe,content:Fe,textFitWidth:et,textFitHeight:gt,spriteData:{width:ue,height:pe,x:ye,y:Me,context:ne}}}}return J})}(z,N)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(f=>{if(this._spriteRequest=null,f)for(const b in f){this._spritesImagesIds[b]=[];const k=this._spritesImagesIds[b]?this._spritesImagesIds[b].filter(T=>!(T in f)):[];for(const T of k)this.imageManager.removeImage(T),this._changedImages[T]=!0;for(const T in f[b]){const P=b==="default"?T:`${b}:${T}`;this._spritesImagesIds[b].push(P),P in this.imageManager.images?this.imageManager.updateImage(P,f[b][T],!1):this.imageManager.addImage(P,f[b][T]),a&&(this._changedImages[P]=!0)}}}).catch(f=>{this._spriteRequest=null,d=f,this.fire(new u.j(d))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),a&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.k("data",{dataType:"style"})),c&&c(d)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.k("data",{dataType:"style"}))}_validateLayer(e){const a=this.sourceCaches[e.source];if(!a)return;const c=e.sourceLayer;if(!c)return;const d=a.getSource();(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(c)===-1)&&this.fire(new u.j(new Error(`Source layer "${c}" does not exist on source "${d.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,a=!1){const c=this._serializedAllLayers();if(!e||e.length===0)return Object.values(a?u.aB(c):c);const d=[];for(const f of e)if(c[f]){const b=a?u.aB(c[f]):c[f];d.push(b)}return d}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const a=Object.keys(this._layers);for(const c of a){const d=this._layers[c];d.type!=="custom"&&(e[c]=d.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const a=this._changed;if(a){const d=Object.keys(this._updatedLayers),f=Object.keys(this._removedLayers);(d.length||f.length)&&this._updateWorkerLayers(d,f);for(const b in this._updatedSources){const k=this._updatedSources[b];if(k==="reload")this._reloadSource(b);else{if(k!=="clear")throw new Error(`Invalid action ${k}`);this._clearSource(b)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const b in this._updatedPaintProps)this._layers[b].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const c={};for(const d in this.sourceCaches){const f=this.sourceCaches[d];c[d]=f.used,f.used=!1}for(const d of this._order){const f=this._layers[d];f.recalculate(e,this._availableImages),!f.isHidden(e.zoom)&&f.source&&(this.sourceCaches[f.source].used=!0)}for(const d in c){const f=this.sourceCaches[d];!!c[d]!=!!f.used&&f.fire(new u.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:d}))}this.light.recalculate(e),this.sky.recalculate(e),this.z=e.zoom,a&&this.fire(new u.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const a in this.sourceCaches)this.sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,a){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,a={}){var c;this._checkLoaded();const d=this.serialize();if(e=a.transformStyle?a.transformStyle(d,e):e,((c=a.validate)===null||c===void 0||c)&&ui(this,u.u(e)))return!1;(e=u.aB(e)).layers=u.az(e.layers);const f=u.aC(d,e),b=this._getOperationsToPerform(f);if(b.unimplemented.length>0)throw new Error(`Unimplemented: ${b.unimplemented.join(", ")}.`);if(b.operations.length===0)return!1;for(const k of b.operations)k();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const a=[],c=[];for(const d of e)switch(d.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":a.push(()=>this.addLayer.apply(this,d.args));break;case"removeLayer":a.push(()=>this.removeLayer.apply(this,d.args));break;case"setPaintProperty":a.push(()=>this.setPaintProperty.apply(this,d.args));break;case"setLayoutProperty":a.push(()=>this.setLayoutProperty.apply(this,d.args));break;case"setFilter":a.push(()=>this.setFilter.apply(this,d.args));break;case"addSource":a.push(()=>this.addSource.apply(this,d.args));break;case"removeSource":a.push(()=>this.removeSource.apply(this,d.args));break;case"setLayerZoomRange":a.push(()=>this.setLayerZoomRange.apply(this,d.args));break;case"setLight":a.push(()=>this.setLight.apply(this,d.args));break;case"setGeoJSONSourceData":a.push(()=>this.setGeoJSONSourceData.apply(this,d.args));break;case"setGlyphs":a.push(()=>this.setGlyphs.apply(this,d.args));break;case"setSprite":a.push(()=>this.setSprite.apply(this,d.args));break;case"setSky":a.push(()=>this.setSky.apply(this,d.args));break;case"setTerrain":a.push(()=>this.map.setTerrain.apply(this,d.args));break;case"setTransition":a.push(()=>{});break;default:c.push(d.command)}return{operations:a,unimplemented:c}}addImage(e,a){if(this.getImage(e))return this.fire(new u.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,a),this._afterImageUpdated(e)}updateImage(e,a){this.imageManager.updateImage(e,a)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new u.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,a,c={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(u.u.source,`sources.${e}`,a,null,c))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const d=this.sourceCaches[e]=new dt(e,a,this.dispatcher);d.style=this,d.setEventedParent(this,()=>({isSourceLoaded:d.loaded(),source:d.serialize(),sourceId:e})),d.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const c in this._layers)if(this._layers[c].source===e)return this.fire(new u.j(new Error(`Source "${e}" cannot be removed while layer "${c}" is using it.`)));const a=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],a.fire(new u.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),a.setEventedParent(null),a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,a){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const c=this.sourceCaches[e].getSource();if(c.type!=="geojson")throw new Error(`geojsonSource.type is ${c.type}, which is !== 'geojson`);c.setData(a),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,a,c={}){this._checkLoaded();const d=e.id;if(this.getLayer(d))return void this.fire(new u.j(new Error(`Layer "${d}" already exists on this map.`)));let f;if(e.type==="custom"){if(ui(this,u.aD(e)))return;f=u.aA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(d,e.source),e=u.aB(e),e=u.e(e,{source:d})),this._validate(u.u.layer,`layers.${d}`,e,{arrayIndex:-1},c))return;f=u.aA(e),this._validateLayer(f),f.setEventedParent(this,{layer:{id:d}})}const b=a?this._order.indexOf(a):this._order.length;if(a&&b===-1)this.fire(new u.j(new Error(`Cannot add layer "${d}" before non-existing layer "${a}".`)));else{if(this._order.splice(b,0,d),this._layerOrderChanged=!0,this._layers[d]=f,this._removedLayers[d]&&f.source&&f.type!=="custom"){const k=this._removedLayers[d];delete this._removedLayers[d],k.type!==f.type?this._updatedSources[f.source]="clear":(this._updatedSources[f.source]="reload",this.sourceCaches[f.source].pause())}this._updateLayer(f),f.onAdd&&f.onAdd(this.map)}}moveLayer(e,a){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new u.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===a)return;const c=this._order.indexOf(e);this._order.splice(c,1);const d=a?this._order.indexOf(a):this._order.length;a&&d===-1?this.fire(new u.j(new Error(`Cannot move layer "${e}" before non-existing layer "${a}".`))):(this._order.splice(d,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const a=this._layers[e];if(!a)return void this.fire(new u.j(new Error(`Cannot remove non-existing layer "${e}".`)));a.setEventedParent(null);const c=this._order.indexOf(e);this._order.splice(c,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=a,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],a.onRemove&&a.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,a,c){this._checkLoaded();const d=this.getLayer(e);d?d.minzoom===a&&d.maxzoom===c||(a!=null&&(d.minzoom=a),c!=null&&(d.maxzoom=c),this._updateLayer(d)):this.fire(new u.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,a,c={}){this._checkLoaded();const d=this.getLayer(e);if(d){if(!u.aE(d.filter,a))return a==null?(d.filter=void 0,void this._updateLayer(d)):void(this._validate(u.u.filter,`layers.${d.id}.filter`,a,null,c)||(d.filter=u.aB(a),this._updateLayer(d)))}else this.fire(new u.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return u.aB(this.getLayer(e).filter)}setLayoutProperty(e,a,c,d={}){this._checkLoaded();const f=this.getLayer(e);f?u.aE(f.getLayoutProperty(a),c)||(f.setLayoutProperty(a,c,d),this._updateLayer(f)):this.fire(new u.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,a){const c=this.getLayer(e);if(c)return c.getLayoutProperty(a);this.fire(new u.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,a,c,d={}){this._checkLoaded();const f=this.getLayer(e);f?u.aE(f.getPaintProperty(a),c)||(f.setPaintProperty(a,c,d)&&this._updateLayer(f),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new u.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,a){return this.getLayer(e).getPaintProperty(a)}setFeatureState(e,a){this._checkLoaded();const c=e.source,d=e.sourceLayer,f=this.sourceCaches[c];if(f===void 0)return void this.fire(new u.j(new Error(`The source '${c}' does not exist in the map's style.`)));const b=f.getSource().type;b==="geojson"&&d?this.fire(new u.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):b!=="vector"||d?(e.id===void 0&&this.fire(new u.j(new Error("The feature id parameter must be provided."))),f.setFeatureState(d,e.id,a)):this.fire(new u.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,a){this._checkLoaded();const c=e.source,d=this.sourceCaches[c];if(d===void 0)return void this.fire(new u.j(new Error(`The source '${c}' does not exist in the map's style.`)));const f=d.getSource().type,b=f==="vector"?e.sourceLayer:void 0;f!=="vector"||b?a&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new u.j(new Error("A feature id is required to remove its specific state property."))):d.removeFeatureState(b,e.id,a):this.fire(new u.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const a=e.source,c=e.sourceLayer,d=this.sourceCaches[a];if(d!==void 0)return d.getSource().type!=="vector"||c?(e.id===void 0&&this.fire(new u.j(new Error("The feature id parameter must be provided."))),d.getFeatureState(c,e.id)):void this.fire(new u.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new u.j(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return u.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=u.aF(this.sourceCaches,f=>f.serialize()),a=this._serializeByIds(this._order,!0),c=this.map.getTerrain()||void 0,d=this.stylesheet;return u.aG({version:d.version,name:d.name,metadata:d.metadata,light:d.light,sky:d.sky,center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch,sprite:d.sprite,glyphs:d.glyphs,transition:d.transition,sources:e,layers:a,terrain:c},f=>f!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const a=b=>this._layers[b].type==="fill-extrusion",c={},d=[];for(let b=this._order.length-1;b>=0;b--){const k=this._order[b];if(a(k)){c[k]=b;for(const T of e){const P=T[k];if(P)for(const A of P)d.push(A)}}}d.sort((b,k)=>k.intersectionZ-b.intersectionZ);const f=[];for(let b=this._order.length-1;b>=0;b--){const k=this._order[b];if(a(k))for(let T=d.length-1;T>=0;T--){const P=d[T].feature;if(c[P.layer.id]<b)break;f.push(P),d.pop()}else for(const T of e){const P=T[k];if(P)for(const A of P)f.push(A.feature)}}return f}queryRenderedFeatures(e,a,c){a&&a.filter&&this._validate(u.u.filter,"queryRenderedFeatures.filter",a.filter,null,a);const d={};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new u.j(new Error("parameters.layers must be an Array."))),[];for(const k of a.layers){const T=this._layers[k];if(!T)return this.fire(new u.j(new Error(`The layer '${k}' does not exist in the map's style and cannot be queried for features.`))),[];d[T.source]=!0}}const f=[];a.availableImages=this._availableImages;const b=this._serializedAllLayers();for(const k in this.sourceCaches)a.layers&&!d[k]||f.push(as(this.sourceCaches[k],this._layers,b,e,a,c));return this.placement&&f.push(function(k,T,P,A,z,N,Z){const H={},J=N.queryRenderedSymbols(A),re=[];for(const ne of Object.keys(J).map(Number))re.push(Z[ne]);re.sort(os);for(const ne of re){const se=ne.featureIndex.lookupSymbolFeatures(J[ne.bucketInstanceId],T,ne.bucketIndex,ne.sourceLayerIndex,z.filter,z.layers,z.availableImages,k);for(const W in se){const ue=H[W]=H[W]||[],pe=se[W];pe.sort((ye,Me)=>{const De=ne.featureSortOrder;if(De){const $e=De.indexOf(ye.featureIndex);return De.indexOf(Me.featureIndex)-$e}return Me.featureIndex-ye.featureIndex});for(const ye of pe)ue.push(ye)}}for(const ne in H)H[ne].forEach(se=>{const W=se.feature,ue=P[k[ne].source].getFeatureState(W.layer["source-layer"],W.id);W.source=W.layer.source,W.layer["source-layer"]&&(W.sourceLayer=W.layer["source-layer"]),W.state=ue});return H}(this._layers,b,this.sourceCaches,e,a,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(f)}querySourceFeatures(e,a){a&&a.filter&&this._validate(u.u.filter,"querySourceFeatures.filter",a.filter,null,a);const c=this.sourceCaches[e];return c?function(d,f){const b=d.getRenderableIds().map(P=>d.getTileByID(P)),k=[],T={};for(let P=0;P<b.length;P++){const A=b[P],z=A.tileID.canonical.key;T[z]||(T[z]=!0,A.querySourceFeatures(k,f))}return k}(c,a):[]}getLight(){return this.light.getLight()}setLight(e,a={}){this._checkLoaded();const c=this.light.getLight();let d=!1;for(const b in e)if(!u.aE(e[b],c[b])){d=!0;break}if(!d)return;const f={now:j.now(),transition:u.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,a),this.light.updateTransitions(f)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,a={}){const c=this.getSky();let d=!1;if(!e&&!c)return;if(e&&!c)d=!0;else if(!e&&c)d=!0;else for(const b in e)if(!u.aE(e[b],c[b])){d=!0;break}if(!d)return;const f={now:j.now(),transition:u.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,a),this.sky.updateTransitions(f)}_validate(e,a,c,d,f={}){return(!f||f.validate!==!1)&&ui(this,e.call(u.u,u.e({key:a,style:this.serialize(),value:c,styleSpec:u.v},d)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Ci().off(Le,this._rtlPluginLoaded);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this.sourceCaches){const c=this.sourceCaches[a];c.setEventedParent(null),c.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const a in this.sourceCaches)this.sourceCaches[a].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,a,c,d,f=!1){let b=!1,k=!1;const T={};for(const P of this._order){const A=this._layers[P];if(A.type!=="symbol")continue;if(!T[A.source]){const N=this.sourceCaches[A.source];T[A.source]=N.getRenderableIds(!0).map(Z=>N.getTileByID(Z)).sort((Z,H)=>H.tileID.overscaledZ-Z.tileID.overscaledZ||(Z.tileID.isLessThan(H.tileID)?-1:1))}const z=this.crossTileSymbolIndex.addLayer(A,T[A.source],e.center.lng);b=b||z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((f=f||this._layerOrderChanged||c===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(j.now(),e.zoom))&&(this.pauseablePlacement=new So(e,this.map.terrain,this._order,f,a,c,d,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,T),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(j.now()),k=!0),b&&this.pauseablePlacement.placement.setStale()),k||b)for(const P of this._order){const A=this._layers[P];A.type==="symbol"&&this.placement.updateLayerOpacities(A,T[A.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(j.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,a){return u._(this,void 0,void 0,function*(){const c=yield this.imageManager.getImages(a.icons);this._updateTilesForChangedImages();const d=this.sourceCaches[a.source];return d&&d.setDependencies(a.tileID.key,a.type,a.icons),c})}getGlyphs(e,a){return u._(this,void 0,void 0,function*(){const c=yield this.glyphManager.getGlyphs(a.stacks),d=this.sourceCaches[a.source];return d&&d.setDependencies(a.tileID.key,a.type,[""]),c})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,a={}){this._checkLoaded(),e&&this._validate(u.u.glyphs,"glyphs",e,null,a)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,a,c={},d){this._checkLoaded();const f=[{id:e,url:a}],b=[...Ce(this.stylesheet.sprite),...f];this._validate(u.u.sprite,"sprite",b,null,c)||(this.stylesheet.sprite=b,this._loadSprite(f,!0,d))}removeSprite(e){this._checkLoaded();const a=Ce(this.stylesheet.sprite);if(a.find(c=>c.id===e)){if(this._spritesImagesIds[e])for(const c of this._spritesImagesIds[e])this.imageManager.removeImage(c),this._changedImages[c]=!0;a.splice(a.findIndex(c=>c.id===e),1),this.stylesheet.sprite=a.length>0?a:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.k("data",{dataType:"style"}))}else this.fire(new u.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return Ce(this.stylesheet.sprite)}setSprite(e,a={},c){this._checkLoaded(),e&&this._validate(u.u.sprite,"sprite",e,null,a)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,c):(this._unloadSprite(),c&&c(null)))}}var As=u.Y([{name:"a_pos",type:"Int16",components:2}]);const hs={prelude:Ot(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Ot(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Ot(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Ot(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Ot("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ot(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:Ot(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Ot("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ot("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ot("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Ot(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Ot(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Ot(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Ot(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Ot(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Ot(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Ot(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ot(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Ot(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Ot(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Ot(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Ot(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Ot(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Ot(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Ot(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Ot(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Ot("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Ot("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Ot("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:Ot("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Ot(m,e){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,c=e.match(/attribute ([\w]+) ([\w]+)/g),d=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),f=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=f?f.concat(d):d,k={};return{fragmentSource:m=m.replace(a,(T,P,A,z,N)=>(k[N]=!0,P==="define"?`
#ifndef HAS_UNIFORM_u_${N}
varying ${A} ${z} ${N};
#else
uniform ${A} ${z} u_${N};
#endif
`:`
#ifdef HAS_UNIFORM_u_${N}
    ${A} ${z} ${N} = u_${N};
#endif
`)),vertexSource:e=e.replace(a,(T,P,A,z,N)=>{const Z=z==="float"?"vec2":"vec4",H=N.match(/color/)?"color":Z;return k[N]?P==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
attribute ${A} ${Z} a_${N};
varying ${A} ${z} ${N};
#else
uniform ${A} ${z} u_${N};
#endif
`:H==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = a_${N};
#else
    ${A} ${z} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = unpack_mix_${H}(a_${N}, u_${N}_t);
#else
    ${A} ${z} ${N} = u_${N};
#endif
`:P==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
attribute ${A} ${Z} a_${N};
#else
uniform ${A} ${z} u_${N};
#endif
`:H==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${A} ${z} ${N} = a_${N};
#else
    ${A} ${z} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${A} ${z} ${N} = unpack_mix_${H}(a_${N}, u_${N}_t);
#else
    ${A} ${z} ${N} = u_${N};
#endif
`}),staticAttributes:c,staticUniforms:b}}class tc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,a,c,d,f,b,k,T,P){this.context=e;let A=this.boundPaintVertexBuffers.length!==d.length;for(let z=0;!A&&z<d.length;z++)this.boundPaintVertexBuffers[z]!==d[z]&&(A=!0);!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==c||A||this.boundIndexBuffer!==f||this.boundVertexOffset!==b||this.boundDynamicVertexBuffer!==k||this.boundDynamicVertexBuffer2!==T||this.boundDynamicVertexBuffer3!==P?this.freshBind(a,c,d,f,b,k,T,P):(e.bindVertexArray.set(this.vao),k&&k.bind(),f&&f.dynamicDraw&&f.bind(),T&&T.bind(),P&&P.bind())}freshBind(e,a,c,d,f,b,k,T){const P=e.numAttributes,A=this.context,z=A.gl;this.vao&&this.destroy(),this.vao=A.createVertexArray(),A.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=d,this.boundVertexOffset=f,this.boundDynamicVertexBuffer=b,this.boundDynamicVertexBuffer2=k,this.boundDynamicVertexBuffer3=T,a.enableAttributes(z,e);for(const N of c)N.enableAttributes(z,e);b&&b.enableAttributes(z,e),k&&k.enableAttributes(z,e),T&&T.enableAttributes(z,e),a.bind(),a.setVertexAttribPointers(z,e,f);for(const N of c)N.bind(),N.setVertexAttribPointers(z,e,f);b&&(b.bind(),b.setVertexAttribPointers(z,e,f)),d&&d.bind(),k&&(k.bind(),k.setVertexAttribPointers(z,e,f)),T&&(T.bind(),T.setVertexAttribPointers(z,e,f)),A.currentNumAttributes=P}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const rc=(m,e,a,c,d)=>({u_matrix:m,u_texture:0,u_ele_delta:e,u_fog_matrix:a,u_fog_color:c?c.properties.get("fog-color"):u.aM.white,u_fog_ground_blend:c?c.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:c?c.calculateFogBlendOpacity(d):0,u_horizon_color:c?c.properties.get("horizon-color"):u.aM.white,u_horizon_fog_blend:c?c.properties.get("horizon-fog-blend"):1});function fa(m){const e=[];for(let a=0;a<m.length;a++){if(m[a]===null)continue;const c=m[a].split(" ");e.push(c.pop())}return e}class nc{constructor(e,a,c,d,f,b){const k=e.gl;this.program=k.createProgram();const T=fa(a.staticAttributes),P=c?c.getBinderAttributes():[],A=T.concat(P),z=hs.prelude.staticUniforms?fa(hs.prelude.staticUniforms):[],N=a.staticUniforms?fa(a.staticUniforms):[],Z=c?c.getBinderUniforms():[],H=z.concat(N).concat(Z),J=[];for(const ye of H)J.indexOf(ye)<0&&J.push(ye);const re=c?c.defines():[];f&&re.push("#define OVERDRAW_INSPECTOR;"),b&&re.push("#define TERRAIN3D;");const ne=re.concat(hs.prelude.fragmentSource,a.fragmentSource).join(`
`),se=re.concat(hs.prelude.vertexSource,a.vertexSource).join(`
`),W=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);if(k.shaderSource(W,ne),k.compileShader(W),!k.getShaderParameter(W,k.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${k.getShaderInfoLog(W)}`);k.attachShader(this.program,W);const ue=k.createShader(k.VERTEX_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);if(k.shaderSource(ue,se),k.compileShader(ue),!k.getShaderParameter(ue,k.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${k.getShaderInfoLog(ue)}`);k.attachShader(this.program,ue),this.attributes={};const pe={};this.numAttributes=A.length;for(let ye=0;ye<this.numAttributes;ye++)A[ye]&&(k.bindAttribLocation(this.program,ye,A[ye]),this.attributes[A[ye]]=ye);if(k.linkProgram(this.program),!k.getProgramParameter(this.program,k.LINK_STATUS))throw new Error(`Program failed to link: ${k.getProgramInfoLog(this.program)}`);k.deleteShader(ue),k.deleteShader(W);for(let ye=0;ye<J.length;ye++){const Me=J[ye];if(Me&&!pe[Me]){const De=k.getUniformLocation(this.program,Me);De&&(pe[Me]=De)}}this.fixedUniforms=d(e,pe),this.terrainUniforms=((ye,Me)=>({u_depth:new u.aH(ye,Me.u_depth),u_terrain:new u.aH(ye,Me.u_terrain),u_terrain_dim:new u.aI(ye,Me.u_terrain_dim),u_terrain_matrix:new u.aJ(ye,Me.u_terrain_matrix),u_terrain_unpack:new u.aK(ye,Me.u_terrain_unpack),u_terrain_exaggeration:new u.aI(ye,Me.u_terrain_exaggeration)}))(e,pe),this.binderUniforms=c?c.getUniforms(e,pe):[]}draw(e,a,c,d,f,b,k,T,P,A,z,N,Z,H,J,re,ne,se){const W=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(c),e.setStencilMode(d),e.setColorMode(f),e.setCullFace(b),T){e.activeTexture.set(W.TEXTURE2),W.bindTexture(W.TEXTURE_2D,T.depthTexture),e.activeTexture.set(W.TEXTURE3),W.bindTexture(W.TEXTURE_2D,T.texture);for(const pe in this.terrainUniforms)this.terrainUniforms[pe].set(T[pe])}for(const pe in this.fixedUniforms)this.fixedUniforms[pe].set(k[pe]);J&&J.setUniforms(e,this.binderUniforms,Z,{zoom:H});let ue=0;switch(a){case W.LINES:ue=2;break;case W.TRIANGLES:ue=3;break;case W.LINE_STRIP:ue=1}for(const pe of N.get()){const ye=pe.vaos||(pe.vaos={});(ye[P]||(ye[P]=new tc)).bind(e,this,A,J?J.getPaintVertexBuffers():[],z,pe.vertexOffset,re,ne,se),W.drawElements(a,pe.primitiveLength*ue,W.UNSIGNED_SHORT,pe.primitiveOffset*ue*2)}}}function xl(m,e,a){const c=1/Et(a,1,e.transform.tileZoom),d=Math.pow(2,a.tileID.overscaledZ),f=a.tileSize*Math.pow(2,e.transform.tileZoom)/d,b=f*(a.tileID.canonical.x+a.tileID.wrap*d),k=f*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[c,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[b>>16,k>>16],u_pixel_coord_lower:[65535&b,65535&k]}}const ko=(m,e,a,c)=>{const d=e.style.light,f=d.properties.get("position"),b=[f.x,f.y,f.z],k=function(){var P=new u.A(9);return u.A!=Float32Array&&(P[1]=0,P[2]=0,P[3]=0,P[5]=0,P[6]=0,P[7]=0),P[0]=1,P[4]=1,P[8]=1,P}();d.properties.get("anchor")==="viewport"&&function(P,A){var z=Math.sin(A),N=Math.cos(A);P[0]=N,P[1]=z,P[2]=0,P[3]=-z,P[4]=N,P[5]=0,P[6]=0,P[7]=0,P[8]=1}(k,-e.transform.angle),function(P,A,z){var N=A[0],Z=A[1],H=A[2];P[0]=N*z[0]+Z*z[3]+H*z[6],P[1]=N*z[1]+Z*z[4]+H*z[7],P[2]=N*z[2]+Z*z[5]+H*z[8]}(b,b,k);const T=d.properties.get("color");return{u_matrix:m,u_lightpos:b,u_lightintensity:d.properties.get("intensity"),u_lightcolor:[T.r,T.g,T.b],u_vertical_gradient:+a,u_opacity:c}},wl=(m,e,a,c,d,f,b)=>u.e(ko(m,e,a,c),xl(f,e,b),{u_height_factor:-Math.pow(2,d.overscaledZ)/b.tileSize/8}),ma=m=>({u_matrix:m}),yd=(m,e,a,c)=>u.e(ma(m),xl(a,e,c)),hm=(m,e)=>({u_matrix:m,u_world:e}),_d=(m,e,a,c,d)=>u.e(yd(m,e,a,c),{u_world:d}),dm=(m,e,a,c)=>{const d=m.transform;let f,b;if(c.paint.get("circle-pitch-alignment")==="map"){const k=Et(a,1,d.zoom);f=!0,b=[k,k]}else f=!1,b=d.pixelsToGLUnits;return{u_camera_to_center_distance:d.cameraToCenterDistance,u_scale_with_map:+(c.paint.get("circle-pitch-scale")==="map"),u_matrix:m.translatePosMatrix(e.posMatrix,a,c.paint.get("circle-translate"),c.paint.get("circle-translate-anchor")),u_pitch_with_map:+f,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:b}},zs=(m,e,a)=>({u_matrix:m,u_inv_matrix:e,u_camera_to_center_distance:a.cameraToCenterDistance,u_viewport_size:[a.width,a.height]}),To=(m,e,a=1)=>({u_matrix:m,u_color:e,u_overlay:0,u_overlay_scale:a}),mn=m=>({u_matrix:m}),gn=(m,e,a,c)=>({u_matrix:m,u_extrude_scale:Et(e,1,a),u_intensity:c}),bl=(m,e,a,c)=>{const d=u.H();u.aP(d,0,m.width,m.height,0,0,1);const f=m.context.gl;return{u_matrix:d,u_world:[f.drawingBufferWidth,f.drawingBufferHeight],u_image:a,u_color_ramp:c,u_opacity:e.paint.get("heatmap-opacity")}};function Sl(m,e){const a=Math.pow(2,e.canonical.z),c=e.canonical.y;return[new u.Z(0,c/a).toLngLat().lat,new u.Z(0,(c+1)/a).toLngLat().lat]}const kl=(m,e,a,c)=>{const d=m.transform;return{u_matrix:wd(m,e,a,c),u_ratio:1/Et(e,1,d.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},vd=(m,e,a,c,d)=>u.e(kl(m,e,a,d),{u_image:0,u_image_height:c}),ga=(m,e,a,c,d)=>{const f=m.transform,b=xd(e,f);return{u_matrix:wd(m,e,a,d),u_texsize:e.imageAtlasTexture.size,u_ratio:1/Et(e,1,f.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[b,c.fromScale,c.toScale],u_fade:c.t,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},pm=(m,e,a,c,d,f)=>{const b=m.lineAtlas,k=xd(e,m.transform),T=a.layout.get("line-cap")==="round",P=b.getDash(c.from,T),A=b.getDash(c.to,T),z=P.width*d.fromScale,N=A.width*d.toScale;return u.e(kl(m,e,a,f),{u_patternscale_a:[k/z,-P.height/2],u_patternscale_b:[k/N,-A.height/2],u_sdfgamma:b.width/(256*Math.min(z,N)*m.pixelRatio)/2,u_image:0,u_tex_y_a:P.y,u_tex_y_b:A.y,u_mix:d.t})};function xd(m,e){return 1/Et(m,1,e.tileZoom)}function wd(m,e,a,c){return m.translatePosMatrix(c?c.posMatrix:e.tileID.posMatrix,e,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const fm=(m,e,a,c,d)=>{return{u_matrix:m,u_tl_parent:e,u_scale_parent:a,u_buffer_scale:1,u_fade_t:c.mix,u_opacity:c.opacity*d.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:d.paint.get("raster-brightness-min"),u_brightness_high:d.paint.get("raster-brightness-max"),u_saturation_factor:(b=d.paint.get("raster-saturation"),b>0?1-1/(1.001-b):-b),u_contrast_factor:(f=d.paint.get("raster-contrast"),f>0?1/(1-f):1+f),u_spin_weights:mm(d.paint.get("raster-hue-rotate"))};var f,b};function mm(m){m*=Math.PI/180;const e=Math.sin(m),a=Math.cos(m);return[(2*a+1)/3,(-Math.sqrt(3)*e-a+1)/3,(Math.sqrt(3)*e-a+1)/3]}const bd=(m,e,a,c,d,f,b,k,T,P,A,z,N,Z)=>{const H=b.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:H.cameraToCenterDistance,u_pitch:H.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:H.width/H.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:k,u_label_plane_matrix:T,u_coord_matrix:P,u_is_text:+z,u_pitch_with_map:+c,u_is_along_line:d,u_is_variable_anchor:f,u_texsize:N,u_texture:0,u_translation:A,u_pitched_scale:Z}},Io=(m,e,a,c,d,f,b,k,T,P,A,z,N,Z,H)=>{const J=b.transform;return u.e(bd(m,e,a,c,d,f,b,k,T,P,A,z,N,H),{u_gamma_scale:c?Math.cos(J._pitch)*J.cameraToCenterDistance:1,u_device_pixel_ratio:b.pixelRatio,u_is_halo:1})},ic=(m,e,a,c,d,f,b,k,T,P,A,z,N,Z)=>u.e(Io(m,e,a,c,d,f,b,k,T,P,A,!0,z,!0,Z),{u_texsize_icon:N,u_texture_icon:1}),Tl=(m,e,a)=>({u_matrix:m,u_opacity:e,u_color:a}),sc=(m,e,a,c,d,f)=>u.e(function(b,k,T,P){const A=T.imageManager.getPattern(b.from.toString()),z=T.imageManager.getPattern(b.to.toString()),{width:N,height:Z}=T.imageManager.getPixelSize(),H=Math.pow(2,P.tileID.overscaledZ),J=P.tileSize*Math.pow(2,T.transform.tileZoom)/H,re=J*(P.tileID.canonical.x+P.tileID.wrap*H),ne=J*P.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:A.tl,u_pattern_br_a:A.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[N,Z],u_mix:k.t,u_pattern_size_a:A.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:k.fromScale,u_scale_b:k.toScale,u_tile_units_to_pixels:1/Et(P,1,T.transform.tileZoom),u_pixel_coord_upper:[re>>16,ne>>16],u_pixel_coord_lower:[65535&re,65535&ne]}}(c,f,a,d),{u_matrix:m,u_opacity:e}),ac={fillExtrusion:(m,e)=>({u_matrix:new u.aJ(m,e.u_matrix),u_lightpos:new u.aN(m,e.u_lightpos),u_lightintensity:new u.aI(m,e.u_lightintensity),u_lightcolor:new u.aN(m,e.u_lightcolor),u_vertical_gradient:new u.aI(m,e.u_vertical_gradient),u_opacity:new u.aI(m,e.u_opacity)}),fillExtrusionPattern:(m,e)=>({u_matrix:new u.aJ(m,e.u_matrix),u_lightpos:new u.aN(m,e.u_lightpos),u_lightintensity:new u.aI(m,e.u_lightintensity),u_lightcolor:new u.aN(m,e.u_lightcolor),u_vertical_gradient:new u.aI(m,e.u_vertical_gradient),u_height_factor:new u.aI(m,e.u_height_factor),u_image:new u.aH(m,e.u_image),u_texsize:new u.aO(m,e.u_texsize),u_pixel_coord_upper:new u.aO(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new u.aO(m,e.u_pixel_coord_lower),u_scale:new u.aN(m,e.u_scale),u_fade:new u.aI(m,e.u_fade),u_opacity:new u.aI(m,e.u_opacity)}),fill:(m,e)=>({u_matrix:new u.aJ(m,e.u_matrix)}),fillPattern:(m,e)=>({u_matrix:new u.aJ(m,e.u_matrix),u_image:new u.aH(m,e.u_image),u_texsize:new u.aO(m,e.u_texsize),u_pixel_coord_upper:new u.aO(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new u.aO(m,e.u_pixel_coord_lower),u_scale:new u.aN(m,e.u_scale),u_fade:new u.aI(m,e.u_fade)}),fillOutline:(m,e)=>({u_matrix:new u.aJ(m,e.u_matrix),u_world:new u.aO(m,e.u_world)}),fillOutlinePattern:(m,e)=>({u_matrix:new u.aJ(m,e.u_matrix),u_world:new u.aO(m,e.u_world),u_image:new u.aH(m,e.u_image),u_texsize:new u.aO(m,e.u_texsize),u_pixel_coord_upper:new u.aO(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new u.aO(m,e.u_pixel_coord_lower),u_scale:new u.aN(m,e.u_scale),u_fade:new u.aI(m,e.u_fade)}),circle:(m,e)=>({u_camera_to_center_distance:new u.aI(m,e.u_camera_to_center_distance),u_scale_with_map:new u.aH(m,e.u_scale_with_map),u_pitch_with_map:new u.aH(m,e.u_pitch_with_map),u_extrude_scale:new u.aO(m,e.u_extrude_scale),u_device_pixel_ratio:new u.aI(m,e.u_device_pixel_ratio),u_matrix:new u.aJ(m,e.u_matrix)}),collisionBox:(m,e)=>({u_matrix:new u.aJ(m,e.u_matrix),u_pixel_extrude_scale:new u.aO(m,e.u_pixel_extrude_scale)}),collisionCircle:(m,e)=>({u_matrix:new u.aJ(m,e.u_matrix),u_inv_matrix:new u.aJ(m,e.u_inv_matrix),u_camera_to_center_distance:new u.aI(m,e.u_camera_to_center_distance),u_viewport_size:new u.aO(m,e.u_viewport_size)}),debug:(m,e)=>({u_color:new u.aL(m,e.u_color),u_matrix:new u.aJ(m,e.u_matrix),u_overlay:new u.aH(m,e.u_overlay),u_overlay_scale:new u.aI(m,e.u_overlay_scale)}),clippingMask:(m,e)=>({u_matrix:new u.aJ(m,e.u_matrix)}),heatmap:(m,e)=>({u_extrude_scale:new u.aI(m,e.u_extrude_scale),u_intensity:new u.aI(m,e.u_intensity),u_matrix:new u.aJ(m,e.u_matrix)}),heatmapTexture:(m,e)=>({u_matrix:new u.aJ(m,e.u_matrix),u_world:new u.aO(m,e.u_world),u_image:new u.aH(m,e.u_image),u_color_ramp:new u.aH(m,e.u_color_ramp),u_opacity:new u.aI(m,e.u_opacity)}),hillshade:(m,e)=>({u_matrix:new u.aJ(m,e.u_matrix),u_image:new u.aH(m,e.u_image),u_latrange:new u.aO(m,e.u_latrange),u_light:new u.aO(m,e.u_light),u_shadow:new u.aL(m,e.u_shadow),u_highlight:new u.aL(m,e.u_highlight),u_accent:new u.aL(m,e.u_accent)}),hillshadePrepare:(m,e)=>({u_matrix:new u.aJ(m,e.u_matrix),u_image:new u.aH(m,e.u_image),u_dimension:new u.aO(m,e.u_dimension),u_zoom:new u.aI(m,e.u_zoom),u_unpack:new u.aK(m,e.u_unpack)}),line:(m,e)=>({u_matrix:new u.aJ(m,e.u_matrix),u_ratio:new u.aI(m,e.u_ratio),u_device_pixel_ratio:new u.aI(m,e.u_device_pixel_ratio),u_units_to_pixels:new u.aO(m,e.u_units_to_pixels)}),lineGradient:(m,e)=>({u_matrix:new u.aJ(m,e.u_matrix),u_ratio:new u.aI(m,e.u_ratio),u_device_pixel_ratio:new u.aI(m,e.u_device_pixel_ratio),u_units_to_pixels:new u.aO(m,e.u_units_to_pixels),u_image:new u.aH(m,e.u_image),u_image_height:new u.aI(m,e.u_image_height)}),linePattern:(m,e)=>({u_matrix:new u.aJ(m,e.u_matrix),u_texsize:new u.aO(m,e.u_texsize),u_ratio:new u.aI(m,e.u_ratio),u_device_pixel_ratio:new u.aI(m,e.u_device_pixel_ratio),u_image:new u.aH(m,e.u_image),u_units_to_pixels:new u.aO(m,e.u_units_to_pixels),u_scale:new u.aN(m,e.u_scale),u_fade:new u.aI(m,e.u_fade)}),lineSDF:(m,e)=>({u_matrix:new u.aJ(m,e.u_matrix),u_ratio:new u.aI(m,e.u_ratio),u_device_pixel_ratio:new u.aI(m,e.u_device_pixel_ratio),u_units_to_pixels:new u.aO(m,e.u_units_to_pixels),u_patternscale_a:new u.aO(m,e.u_patternscale_a),u_patternscale_b:new u.aO(m,e.u_patternscale_b),u_sdfgamma:new u.aI(m,e.u_sdfgamma),u_image:new u.aH(m,e.u_image),u_tex_y_a:new u.aI(m,e.u_tex_y_a),u_tex_y_b:new u.aI(m,e.u_tex_y_b),u_mix:new u.aI(m,e.u_mix)}),raster:(m,e)=>({u_matrix:new u.aJ(m,e.u_matrix),u_tl_parent:new u.aO(m,e.u_tl_parent),u_scale_parent:new u.aI(m,e.u_scale_parent),u_buffer_scale:new u.aI(m,e.u_buffer_scale),u_fade_t:new u.aI(m,e.u_fade_t),u_opacity:new u.aI(m,e.u_opacity),u_image0:new u.aH(m,e.u_image0),u_image1:new u.aH(m,e.u_image1),u_brightness_low:new u.aI(m,e.u_brightness_low),u_brightness_high:new u.aI(m,e.u_brightness_high),u_saturation_factor:new u.aI(m,e.u_saturation_factor),u_contrast_factor:new u.aI(m,e.u_contrast_factor),u_spin_weights:new u.aN(m,e.u_spin_weights)}),symbolIcon:(m,e)=>({u_is_size_zoom_constant:new u.aH(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new u.aH(m,e.u_is_size_feature_constant),u_size_t:new u.aI(m,e.u_size_t),u_size:new u.aI(m,e.u_size),u_camera_to_center_distance:new u.aI(m,e.u_camera_to_center_distance),u_pitch:new u.aI(m,e.u_pitch),u_rotate_symbol:new u.aH(m,e.u_rotate_symbol),u_aspect_ratio:new u.aI(m,e.u_aspect_ratio),u_fade_change:new u.aI(m,e.u_fade_change),u_matrix:new u.aJ(m,e.u_matrix),u_label_plane_matrix:new u.aJ(m,e.u_label_plane_matrix),u_coord_matrix:new u.aJ(m,e.u_coord_matrix),u_is_text:new u.aH(m,e.u_is_text),u_pitch_with_map:new u.aH(m,e.u_pitch_with_map),u_is_along_line:new u.aH(m,e.u_is_along_line),u_is_variable_anchor:new u.aH(m,e.u_is_variable_anchor),u_texsize:new u.aO(m,e.u_texsize),u_texture:new u.aH(m,e.u_texture),u_translation:new u.aO(m,e.u_translation),u_pitched_scale:new u.aI(m,e.u_pitched_scale)}),symbolSDF:(m,e)=>({u_is_size_zoom_constant:new u.aH(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new u.aH(m,e.u_is_size_feature_constant),u_size_t:new u.aI(m,e.u_size_t),u_size:new u.aI(m,e.u_size),u_camera_to_center_distance:new u.aI(m,e.u_camera_to_center_distance),u_pitch:new u.aI(m,e.u_pitch),u_rotate_symbol:new u.aH(m,e.u_rotate_symbol),u_aspect_ratio:new u.aI(m,e.u_aspect_ratio),u_fade_change:new u.aI(m,e.u_fade_change),u_matrix:new u.aJ(m,e.u_matrix),u_label_plane_matrix:new u.aJ(m,e.u_label_plane_matrix),u_coord_matrix:new u.aJ(m,e.u_coord_matrix),u_is_text:new u.aH(m,e.u_is_text),u_pitch_with_map:new u.aH(m,e.u_pitch_with_map),u_is_along_line:new u.aH(m,e.u_is_along_line),u_is_variable_anchor:new u.aH(m,e.u_is_variable_anchor),u_texsize:new u.aO(m,e.u_texsize),u_texture:new u.aH(m,e.u_texture),u_gamma_scale:new u.aI(m,e.u_gamma_scale),u_device_pixel_ratio:new u.aI(m,e.u_device_pixel_ratio),u_is_halo:new u.aH(m,e.u_is_halo),u_translation:new u.aO(m,e.u_translation),u_pitched_scale:new u.aI(m,e.u_pitched_scale)}),symbolTextAndIcon:(m,e)=>({u_is_size_zoom_constant:new u.aH(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new u.aH(m,e.u_is_size_feature_constant),u_size_t:new u.aI(m,e.u_size_t),u_size:new u.aI(m,e.u_size),u_camera_to_center_distance:new u.aI(m,e.u_camera_to_center_distance),u_pitch:new u.aI(m,e.u_pitch),u_rotate_symbol:new u.aH(m,e.u_rotate_symbol),u_aspect_ratio:new u.aI(m,e.u_aspect_ratio),u_fade_change:new u.aI(m,e.u_fade_change),u_matrix:new u.aJ(m,e.u_matrix),u_label_plane_matrix:new u.aJ(m,e.u_label_plane_matrix),u_coord_matrix:new u.aJ(m,e.u_coord_matrix),u_is_text:new u.aH(m,e.u_is_text),u_pitch_with_map:new u.aH(m,e.u_pitch_with_map),u_is_along_line:new u.aH(m,e.u_is_along_line),u_is_variable_anchor:new u.aH(m,e.u_is_variable_anchor),u_texsize:new u.aO(m,e.u_texsize),u_texsize_icon:new u.aO(m,e.u_texsize_icon),u_texture:new u.aH(m,e.u_texture),u_texture_icon:new u.aH(m,e.u_texture_icon),u_gamma_scale:new u.aI(m,e.u_gamma_scale),u_device_pixel_ratio:new u.aI(m,e.u_device_pixel_ratio),u_is_halo:new u.aH(m,e.u_is_halo),u_translation:new u.aO(m,e.u_translation),u_pitched_scale:new u.aI(m,e.u_pitched_scale)}),background:(m,e)=>({u_matrix:new u.aJ(m,e.u_matrix),u_opacity:new u.aI(m,e.u_opacity),u_color:new u.aL(m,e.u_color)}),backgroundPattern:(m,e)=>({u_matrix:new u.aJ(m,e.u_matrix),u_opacity:new u.aI(m,e.u_opacity),u_image:new u.aH(m,e.u_image),u_pattern_tl_a:new u.aO(m,e.u_pattern_tl_a),u_pattern_br_a:new u.aO(m,e.u_pattern_br_a),u_pattern_tl_b:new u.aO(m,e.u_pattern_tl_b),u_pattern_br_b:new u.aO(m,e.u_pattern_br_b),u_texsize:new u.aO(m,e.u_texsize),u_mix:new u.aI(m,e.u_mix),u_pattern_size_a:new u.aO(m,e.u_pattern_size_a),u_pattern_size_b:new u.aO(m,e.u_pattern_size_b),u_scale_a:new u.aI(m,e.u_scale_a),u_scale_b:new u.aI(m,e.u_scale_b),u_pixel_coord_upper:new u.aO(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new u.aO(m,e.u_pixel_coord_lower),u_tile_units_to_pixels:new u.aI(m,e.u_tile_units_to_pixels)}),terrain:(m,e)=>({u_matrix:new u.aJ(m,e.u_matrix),u_texture:new u.aH(m,e.u_texture),u_ele_delta:new u.aI(m,e.u_ele_delta),u_fog_matrix:new u.aJ(m,e.u_fog_matrix),u_fog_color:new u.aL(m,e.u_fog_color),u_fog_ground_blend:new u.aI(m,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new u.aI(m,e.u_fog_ground_blend_opacity),u_horizon_color:new u.aL(m,e.u_horizon_color),u_horizon_fog_blend:new u.aI(m,e.u_horizon_fog_blend)}),terrainDepth:(m,e)=>({u_matrix:new u.aJ(m,e.u_matrix),u_ele_delta:new u.aI(m,e.u_ele_delta)}),terrainCoords:(m,e)=>({u_matrix:new u.aJ(m,e.u_matrix),u_texture:new u.aH(m,e.u_texture),u_terrain_coords_id:new u.aI(m,e.u_terrain_coords_id),u_ele_delta:new u.aI(m,e.u_ele_delta)}),sky:(m,e)=>({u_sky_color:new u.aL(m,e.u_sky_color),u_horizon_color:new u.aL(m,e.u_horizon_color),u_horizon:new u.aI(m,e.u_horizon),u_sky_horizon_blend:new u.aI(m,e.u_sky_horizon_blend)})};class zi{constructor(e,a,c){this.context=e;const d=e.gl;this.buffer=d.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const a=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const gm={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class oc{constructor(e,a,c,d){this.length=a.length,this.attributes=c,this.itemSize=a.bytesPerElement,this.dynamicDraw=d,this.context=e;const f=e.gl;this.buffer=f.createBuffer(),e.bindVertexBuffer.set(this.buffer),f.bufferData(f.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,a){for(let c=0;c<this.attributes.length;c++){const d=a.attributes[this.attributes[c].name];d!==void 0&&e.enableVertexAttribArray(d)}}setVertexAttribPointers(e,a,c){for(let d=0;d<this.attributes.length;d++){const f=this.attributes[d],b=a.attributes[f.name];b!==void 0&&e.vertexAttribPointer(b,f.components,e[gm[f.type]],!1,this.itemSize,f.offset+this.itemSize*(c||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ds=new WeakMap;function ds(m){var e;if(Ds.has(m))return Ds.get(m);{const a=(e=m.getParameter(m.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return Ds.set(m,a),a}}class jt{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Il extends jt{getDefault(){return u.aM.transparent}set(e){const a=this.current;(e.r!==a.r||e.g!==a.g||e.b!==a.b||e.a!==a.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class ym extends jt{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class ya extends jt{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class _m extends jt{getDefault(){return[!0,!0,!0,!0]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||e[2]!==a[2]||e[3]!==a[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Sd extends jt{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class vm extends jt{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class kd extends jt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const a=this.current;(e.func!==a.func||e.ref!==a.ref||e.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class lc extends jt{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||e[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Td extends jt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;e?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=e,this.dirty=!1}}class Id extends jt{getDefault(){return[0,1]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Ed extends jt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;e?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=e,this.dirty=!1}}class Pd extends jt{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Ls extends jt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;e?a.enable(a.BLEND):a.disable(a.BLEND),this.current=e,this.dirty=!1}}class Cd extends jt{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class xm extends jt{getDefault(){return u.aM.transparent}set(e){const a=this.current;(e.r!==a.r||e.g!==a.g||e.b!==a.b||e.a!==a.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Md extends jt{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Eo extends jt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;e?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=e,this.dirty=!1}}class wm extends jt{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class El extends jt{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class bm extends jt{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Sm extends jt{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Ad extends jt{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||e[2]!==a[2]||e[3]!==a[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class zd extends jt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Dd extends jt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class uc extends jt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Ld extends jt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Pl extends jt{getDefault(){return null}set(e){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Hi extends jt{getDefault(){return null}set(e){var a;if(e===this.current&&!this.dirty)return;const c=this.gl;ds(c)?c.bindVertexArray(e):(a=c.getExtension("OES_vertex_array_object"))===null||a===void 0||a.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class cc extends jt{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class hc extends jt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class dc extends jt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Cl extends jt{constructor(e,a){super(e),this.context=e,this.parent=a}getDefault(){return null}}class pc extends Cl{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Rs extends Cl{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class fc extends Cl{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class km{constructor(e,a,c,d,f){this.context=e,this.width=a,this.height=c;const b=e.gl,k=this.framebuffer=b.createFramebuffer();if(this.colorAttachment=new pc(e,k),d)this.depthAttachment=f?new fc(e,k):new Rs(e,k);else if(f)throw new Error("Stencil cannot be set without depth");if(b.checkFramebufferStatus(b.FRAMEBUFFER)!==b.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,a=this.colorAttachment.get();if(a&&e.deleteTexture(a),this.depthAttachment){const c=this.depthAttachment.get();c&&e.deleteRenderbuffer(c)}e.deleteFramebuffer(this.framebuffer)}}class fr{constructor(e,a,c){this.blendFunction=e,this.blendColor=a,this.mask=c}}fr.Replace=[1,0],fr.disabled=new fr(fr.Replace,u.aM.transparent,[!1,!1,!1,!1]),fr.unblended=new fr(fr.Replace,u.aM.transparent,[!0,!0,!0,!0]),fr.alphaBlended=new fr([1,771],u.aM.transparent,[!0,!0,!0,!0]);class Tm{constructor(e){var a,c;if(this.gl=e,this.clearColor=new Il(this),this.clearDepth=new ym(this),this.clearStencil=new ya(this),this.colorMask=new _m(this),this.depthMask=new Sd(this),this.stencilMask=new vm(this),this.stencilFunc=new kd(this),this.stencilOp=new lc(this),this.stencilTest=new Td(this),this.depthRange=new Id(this),this.depthTest=new Ed(this),this.depthFunc=new Pd(this),this.blend=new Ls(this),this.blendFunc=new Cd(this),this.blendColor=new xm(this),this.blendEquation=new Md(this),this.cullFace=new Eo(this),this.cullFaceSide=new wm(this),this.frontFace=new El(this),this.program=new bm(this),this.activeTexture=new Sm(this),this.viewport=new Ad(this),this.bindFramebuffer=new zd(this),this.bindRenderbuffer=new Dd(this),this.bindTexture=new uc(this),this.bindVertexBuffer=new Ld(this),this.bindElementBuffer=new Pl(this),this.bindVertexArray=new Hi(this),this.pixelStoreUnpack=new cc(this),this.pixelStoreUnpackPremultiplyAlpha=new hc(this),this.pixelStoreUnpackFlipY=new dc(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),ds(e)){this.HALF_FLOAT=e.HALF_FLOAT;const d=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(a=e.RGBA16F)!==null&&a!==void 0?a:d==null?void 0:d.RGBA16F_EXT,this.RGB16F=(c=e.RGB16F)!==null&&c!==void 0?c:d==null?void 0:d.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const d=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=d==null?void 0:d.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,a){return new zi(this,e,a)}createVertexBuffer(e,a,c){return new oc(this,e,a,c)}createRenderbuffer(e,a,c){const d=this.gl,f=d.createRenderbuffer();return this.bindRenderbuffer.set(f),d.renderbufferStorage(d.RENDERBUFFER,e,a,c),this.bindRenderbuffer.set(null),f}createFramebuffer(e,a,c,d){return new km(this,e,a,c,d)}clear({color:e,depth:a,stencil:c}){const d=this.gl;let f=0;e&&(f|=d.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(f|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),c!==void 0&&(f|=d.STENCIL_BUFFER_BIT,this.clearStencil.set(c),this.stencilMask.set(255)),d.clear(f)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){u.aE(e.blendFunction,fr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return ds(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var a;return ds(this.gl)?this.gl.deleteVertexArray(e):(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class It{constructor(e,a,c){this.func=e,this.mask=a,this.range=c}}It.ReadOnly=!1,It.ReadWrite=!0,It.disabled=new It(519,It.ReadOnly,[0,1]);const Ml=7680;class Yt{constructor(e,a,c,d,f,b){this.test=e,this.ref=a,this.mask=c,this.fail=d,this.depthFail=f,this.pass=b}}Yt.disabled=new Yt({func:519,mask:0},0,0,Ml,Ml,Ml);class Zt{constructor(e,a,c){this.enable=e,this.mode=a,this.frontFace=c}}let Bs;function Po(m,e,a,c,d){const f=m.context,b=f.gl,k=m.useProgram("collisionBox"),T=[];let P=0,A=0;for(let ne=0;ne<c.length;ne++){const se=c[ne],W=e.getTile(se).getBucket(a);if(!W)continue;const ue=d?W.textCollisionBox:W.iconCollisionBox,pe=W.collisionCircleArray;if(pe.length>0){const ye=u.H();u.aQ(ye,W.placementInvProjMatrix,m.transform.glCoordMatrix),u.aQ(ye,ye,W.placementViewportMatrix),T.push({circleArray:pe,circleOffset:A,transform:se.posMatrix,invTransform:ye,coord:se}),P+=pe.length/4,A=P}ue&&k.draw(f,b.LINES,It.disabled,Yt.disabled,m.colorModeForRenderPass(),Zt.disabled,{u_matrix:se.posMatrix,u_pixel_extrude_scale:[1/(z=m.transform).width,1/z.height]},m.style.map.terrain&&m.style.map.terrain.getTerrainData(se),a.id,ue.layoutVertexBuffer,ue.indexBuffer,ue.segments,null,m.transform.zoom,null,null,ue.collisionVertexBuffer)}var z;if(!d||!T.length)return;const N=m.useProgram("collisionCircle"),Z=new u.aR;Z.resize(4*P),Z._trim();let H=0;for(const ne of T)for(let se=0;se<ne.circleArray.length/4;se++){const W=4*se,ue=ne.circleArray[W+0],pe=ne.circleArray[W+1],ye=ne.circleArray[W+2],Me=ne.circleArray[W+3];Z.emplace(H++,ue,pe,ye,Me,0),Z.emplace(H++,ue,pe,ye,Me,1),Z.emplace(H++,ue,pe,ye,Me,2),Z.emplace(H++,ue,pe,ye,Me,3)}(!Bs||Bs.length<2*P)&&(Bs=function(ne){const se=2*ne,W=new u.aT;W.resize(se),W._trim();for(let ue=0;ue<se;ue++){const pe=6*ue;W.uint16[pe+0]=4*ue+0,W.uint16[pe+1]=4*ue+1,W.uint16[pe+2]=4*ue+2,W.uint16[pe+3]=4*ue+2,W.uint16[pe+4]=4*ue+3,W.uint16[pe+5]=4*ue+0}return W}(P));const J=f.createIndexBuffer(Bs,!0),re=f.createVertexBuffer(Z,u.aS.members,!0);for(const ne of T){const se=zs(ne.transform,ne.invTransform,m.transform);N.draw(f,b.TRIANGLES,It.disabled,Yt.disabled,m.colorModeForRenderPass(),Zt.disabled,se,m.style.map.terrain&&m.style.map.terrain.getTerrainData(ne.coord),a.id,re,J,u.a0.simpleSegment(0,2*ne.circleOffset,ne.circleArray.length,ne.circleArray.length/2),null,m.transform.zoom,null,null,null)}re.destroy(),J.destroy()}Zt.disabled=new Zt(!1,1029,2305),Zt.backCCW=new Zt(!0,1029,2305);const Co=u.an(new Float32Array(16));function mc(m,e,a,c,d,f){const{horizontalAlign:b,verticalAlign:k}=u.au(m);return new u.P((-(b-.5)*e/d+c[0])*f,(-(k-.5)*a/d+c[1])*f)}function Fs(m,e,a,c,d,f){const b=e.tileAnchorPoint.add(new u.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let k=c.mult(f);a||(k=k.rotate(-d));const T=b.add(k);return Q(T.x,T.y,e.labelPlaneMatrix,e.getElevation).point}if(a){const k=ke(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(m),T=Math.atan(k.y/k.x)+(k.x<0?Math.PI:0);return m.add(c.rotate(T))}return m.add(c)}function _a(m,e,a,c,d,f,b,k,T,P,A,z,N,Z){const H=m.text.placedSymbolArray,J=m.text.dynamicLayoutVertexArray,re=m.icon.dynamicLayoutVertexArray,ne={};J.clear();for(let se=0;se<H.length;se++){const W=H.get(se),ue=W.hidden||!W.crossTileID||m.allowVerticalPlacement&&!W.placedOrientation?null:c[W.crossTileID];if(ue){const pe=new u.P(W.anchorX,W.anchorY),ye={getElevation:Z,width:d.width,height:d.height,labelPlaneMatrix:f,pitchWithMap:a,projection:A,tileAnchorPoint:pe,translation:z,unwrappedTileID:N},Me=a?Q(pe.x,pe.y,b,Z):ke(pe.x,pe.y,ye),De=B(d.cameraToCenterDistance,Me.signedDistanceFromCamera);let $e=u.ai(m.textSizeData,T,W)*De/u.ap;a&&($e*=m.tilePixelRatio/k);const{width:Ke,height:Oe,anchor:Fe,textOffset:et,textBoxScale:gt}=ue,je=mc(Fe,Ke,Oe,et,gt,$e),Ze=A.getPitchedTextCorrection(d,pe.add(new u.P(z[0],z[1])),N),ft=Fs(Me.point,ye,e,je,d.angle,Ze),tr=m.allowVerticalPlacement&&W.placedOrientation===u.ah.vertical?Math.PI/2:0;for(let wt=0;wt<W.numGlyphs;wt++)u.aj(J,ft,tr);P&&W.associatedIconIndex>=0&&(ne[W.associatedIconIndex]={shiftedAnchor:ft,angle:tr})}else lt(W.numGlyphs,J)}if(P){re.clear();const se=m.icon.placedSymbolArray;for(let W=0;W<se.length;W++){const ue=se.get(W);if(ue.hidden)lt(ue.numGlyphs,re);else{const pe=ne[W];if(pe)for(let ye=0;ye<ue.numGlyphs;ye++)u.aj(re,pe.shiftedAnchor,pe.angle);else lt(ue.numGlyphs,re)}}m.icon.dynamicLayoutVertexBuffer.updateData(re)}m.text.dynamicLayoutVertexBuffer.updateData(J)}function Zn(m,e,a){return a.iconsInText&&e?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function gc(m,e,a,c,d,f,b,k,T,P,A,z){const N=m.context,Z=N.gl,H=m.transform,J=Ms(),re=k==="map",ne=T==="map",se=k!=="viewport"&&a.layout.get("symbol-placement")!=="point",W=re&&!ne&&!se,ue=!ne&&se,pe=!a.layout.get("symbol-sort-key").isConstant();let ye=!1;const Me=m.depthModeForSublayer(0,It.ReadOnly),De=a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"),$e=[],Ke=J.getCircleRadiusCorrection(H);for(const Oe of c){const Fe=e.getTile(Oe),et=Fe.getBucket(a);if(!et)continue;const gt=d?et.text:et.icon;if(!gt||!gt.segments.get().length||!gt.hasVisibleVertices)continue;const je=gt.programConfigurations.get(a.id),Ze=d||et.sdfIcons,ft=d?et.textSizeData:et.iconSizeData,tr=ne||H.pitch!==0,wt=m.useProgram(Zn(Ze,d,et),je),Pt=u.ag(ft,H.zoom),rr=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Oe);let Hr,di,nr,yn,sn=[0,0],Kr=null;if(d)di=Fe.glyphAtlasTexture,nr=Z.LINEAR,Hr=Fe.glyphAtlasTexture.size,et.iconsInText&&(sn=Fe.imageAtlasTexture.size,Kr=Fe.imageAtlasTexture,yn=tr||m.options.rotating||m.options.zooming||ft.kind==="composite"||ft.kind==="camera"?Z.LINEAR:Z.NEAREST);else{const Mt=a.layout.get("icon-size").constantOr(0)!==1||et.iconsNeedLinear;di=Fe.imageAtlasTexture,nr=Ze||m.options.rotating||m.options.zooming||Mt||tr?Z.LINEAR:Z.NEAREST,Hr=Fe.imageAtlasTexture.size}const an=Et(Fe,1,m.transform.zoom),Ri=ue?Oe.posMatrix:Co,Da=cs(Ri,ne,re,m.transform,an),Wl=Ai(Ri,ne,re,m.transform,an),La=Ai(Oe.posMatrix,ne,re,m.transform,an),Kn=J.translatePosition(m.transform,Fe,f,b),Xl=De&&et.hasTextData(),Vc=a.layout.get("icon-text-fit")!=="none"&&Xl&&et.hasIconData();if(se){const Mt=m.style.map.terrain?(Ra,Ba)=>m.style.map.terrain.getElevation(Oe,Ra,Ba):null,Us=a.layout.get("text-rotation-alignment")==="map";q(et,Oe.posMatrix,m,d,Da,La,ne,P,Us,J,Oe.toUnwrapped(),H.width,H.height,Kn,Mt)}const Wn=Oe.posMatrix,Xn=d&&De||Vc,ps=se||Xn?Co:Da,pi=Wl,jr=Ze&&a.paint.get(d?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Wr;Wr=Ze?et.iconsInText?ic(ft.kind,Pt,W,ne,se,Xn,m,Wn,ps,pi,Kn,Hr,sn,Ke):Io(ft.kind,Pt,W,ne,se,Xn,m,Wn,ps,pi,Kn,d,Hr,!0,Ke):bd(ft.kind,Pt,W,ne,se,Xn,m,Wn,ps,pi,Kn,d,Hr,Ke);const Ln={program:wt,buffers:gt,uniformValues:Wr,atlasTexture:di,atlasTextureIcon:Kr,atlasInterpolation:nr,atlasInterpolationIcon:yn,isSDF:Ze,hasHalo:jr};if(pe&&et.canOverlap){ye=!0;const Mt=gt.segments.get();for(const Us of Mt)$e.push({segments:new u.a0([Us]),sortKey:Us.sortKey,state:Ln,terrainData:rr})}else $e.push({segments:gt.segments,sortKey:0,state:Ln,terrainData:rr})}ye&&$e.sort((Oe,Fe)=>Oe.sortKey-Fe.sortKey);for(const Oe of $e){const Fe=Oe.state;if(N.activeTexture.set(Z.TEXTURE0),Fe.atlasTexture.bind(Fe.atlasInterpolation,Z.CLAMP_TO_EDGE),Fe.atlasTextureIcon&&(N.activeTexture.set(Z.TEXTURE1),Fe.atlasTextureIcon&&Fe.atlasTextureIcon.bind(Fe.atlasInterpolationIcon,Z.CLAMP_TO_EDGE)),Fe.isSDF){const et=Fe.uniformValues;Fe.hasHalo&&(et.u_is_halo=1,yc(Fe.buffers,Oe.segments,a,m,Fe.program,Me,A,z,et,Oe.terrainData)),et.u_is_halo=0}yc(Fe.buffers,Oe.segments,a,m,Fe.program,Me,A,z,Fe.uniformValues,Oe.terrainData)}}function yc(m,e,a,c,d,f,b,k,T,P){const A=c.context;d.draw(A,A.gl.TRIANGLES,f,b,k,Zt.disabled,T,P,a.id,m.layoutVertexBuffer,m.indexBuffer,e,a.paint,c.transform.zoom,m.programConfigurations.get(a.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function _c(m,e,a,c){const d=m.context,f=d.gl,b=Yt.disabled,k=new fr([f.ONE,f.ONE],u.aM.transparent,[!0,!0,!0,!0]),T=e.getBucket(a);if(!T)return;const P=c.key;let A=a.heatmapFbos.get(P);A||(A=Mo(d,e.tileSize,e.tileSize),a.heatmapFbos.set(P,A)),d.bindFramebuffer.set(A.framebuffer),d.viewport.set([0,0,e.tileSize,e.tileSize]),d.clear({color:u.aM.transparent});const z=T.programConfigurations.get(a.id),N=m.useProgram("heatmap",z),Z=m.style.map.terrain.getTerrainData(c);N.draw(d,f.TRIANGLES,It.disabled,b,k,Zt.disabled,gn(c.posMatrix,e,m.transform.zoom,a.paint.get("heatmap-intensity")),Z,a.id,T.layoutVertexBuffer,T.indexBuffer,T.segments,a.paint,m.transform.zoom,z)}function Os(m,e,a){const c=m.context,d=c.gl;c.setColorMode(m.colorModeForRenderPass());const f=Ao(c,e),b=a.key,k=e.heatmapFbos.get(b);k&&(c.activeTexture.set(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,k.colorAttachment.get()),c.activeTexture.set(d.TEXTURE1),f.bind(d.LINEAR,d.CLAMP_TO_EDGE),m.useProgram("heatmapTexture").draw(c,d.TRIANGLES,It.disabled,Yt.disabled,m.colorModeForRenderPass(),Zt.disabled,bl(m,e,0,1),null,e.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments,e.paint,m.transform.zoom),k.destroy(),e.heatmapFbos.delete(b))}function Mo(m,e,a){var c,d;const f=m.gl,b=f.createTexture();f.bindTexture(f.TEXTURE_2D,b),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR);const k=(c=m.HALF_FLOAT)!==null&&c!==void 0?c:f.UNSIGNED_BYTE,T=(d=m.RGBA16F)!==null&&d!==void 0?d:f.RGBA;f.texImage2D(f.TEXTURE_2D,0,T,e,a,0,f.RGBA,k,null);const P=m.createFramebuffer(e,a,!1,!1);return P.colorAttachment.set(b),P}function Ao(m,e){return e.colorRampTexture||(e.colorRampTexture=new Ye(m,e.colorRamp,m.gl.RGBA)),e.colorRampTexture}function va(m,e,a,c,d){if(!a||!c||!c.imageAtlas)return;const f=c.imageAtlas.patternPositions;let b=f[a.to.toString()],k=f[a.from.toString()];if(!b&&k&&(b=k),!k&&b&&(k=b),!b||!k){const T=d.getPaintProperty(e);b=f[T],k=f[T]}b&&k&&m.setConstantPatternPositions(b,k)}function zo(m,e,a,c,d,f,b){const k=m.context.gl,T="fill-pattern",P=a.paint.get(T),A=P&&P.constantOr(1),z=a.getCrossfadeParameters();let N,Z,H,J,re;b?(Z=A&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",N=k.LINES):(Z=A?"fillPattern":"fill",N=k.TRIANGLES);const ne=P.constantOr(null);for(const se of c){const W=e.getTile(se);if(A&&!W.patternsLoaded())continue;const ue=W.getBucket(a);if(!ue)continue;const pe=ue.programConfigurations.get(a.id),ye=m.useProgram(Z,pe),Me=m.style.map.terrain&&m.style.map.terrain.getTerrainData(se);A&&(m.context.activeTexture.set(k.TEXTURE0),W.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),pe.updatePaintBuffers(z)),va(pe,T,ne,W,a);const De=Me?se:null,$e=m.translatePosMatrix(De?De.posMatrix:se.posMatrix,W,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));if(b){J=ue.indexBuffer2,re=ue.segments2;const Ke=[k.drawingBufferWidth,k.drawingBufferHeight];H=Z==="fillOutlinePattern"&&A?_d($e,m,z,W,Ke):hm($e,Ke)}else J=ue.indexBuffer,re=ue.segments,H=A?yd($e,m,z,W):ma($e);ye.draw(m.context,N,d,m.stencilModeForClipping(se),f,Zt.disabled,H,Me,a.id,ue.layoutVertexBuffer,J,re,a.paint,m.transform.zoom,pe)}}function Al(m,e,a,c,d,f,b){const k=m.context,T=k.gl,P="fill-extrusion-pattern",A=a.paint.get(P),z=A.constantOr(1),N=a.getCrossfadeParameters(),Z=a.paint.get("fill-extrusion-opacity"),H=A.constantOr(null);for(const J of c){const re=e.getTile(J),ne=re.getBucket(a);if(!ne)continue;const se=m.style.map.terrain&&m.style.map.terrain.getTerrainData(J),W=ne.programConfigurations.get(a.id),ue=m.useProgram(z?"fillExtrusionPattern":"fillExtrusion",W);z&&(m.context.activeTexture.set(T.TEXTURE0),re.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),W.updatePaintBuffers(N)),va(W,P,H,re,a);const pe=m.translatePosMatrix(J.posMatrix,re,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),ye=a.paint.get("fill-extrusion-vertical-gradient"),Me=z?wl(pe,m,ye,Z,J,N,re):ko(pe,m,ye,Z);ue.draw(k,k.gl.TRIANGLES,d,f,b,Zt.backCCW,Me,se,a.id,ne.layoutVertexBuffer,ne.indexBuffer,ne.segments,a.paint,m.transform.zoom,W,m.style.map.terrain&&ne.centroidVertexBuffer)}}function xa(m,e,a,c,d,f,b){const k=m.context,T=k.gl,P=a.fbo;if(!P)return;const A=m.useProgram("hillshade"),z=m.style.map.terrain&&m.style.map.terrain.getTerrainData(e);k.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,P.colorAttachment.get()),A.draw(k,T.TRIANGLES,d,f,b,Zt.disabled,((N,Z,H,J)=>{const re=H.paint.get("hillshade-shadow-color"),ne=H.paint.get("hillshade-highlight-color"),se=H.paint.get("hillshade-accent-color");let W=H.paint.get("hillshade-illumination-direction")*(Math.PI/180);H.paint.get("hillshade-illumination-anchor")==="viewport"&&(W-=N.transform.angle);const ue=!N.options.moving;return{u_matrix:J?J.posMatrix:N.transform.calculatePosMatrix(Z.tileID.toUnwrapped(),ue),u_image:0,u_latrange:Sl(0,Z.tileID),u_light:[H.paint.get("hillshade-exaggeration"),W],u_shadow:re,u_highlight:ne,u_accent:se}})(m,a,c,z?e:null),z,c.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}function wa(m,e,a,c,d,f){const b=m.context,k=b.gl,T=e.dem;if(T&&T.data){const P=T.dim,A=T.stride,z=T.getPixels();if(b.activeTexture.set(k.TEXTURE1),b.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||m.getTileTexture(A),e.demTexture){const Z=e.demTexture;Z.update(z,{premultiply:!1}),Z.bind(k.NEAREST,k.CLAMP_TO_EDGE)}else e.demTexture=new Ye(b,z,k.RGBA,{premultiply:!1}),e.demTexture.bind(k.NEAREST,k.CLAMP_TO_EDGE);b.activeTexture.set(k.TEXTURE0);let N=e.fbo;if(!N){const Z=new Ye(b,{width:P,height:P,data:null},k.RGBA);Z.bind(k.LINEAR,k.CLAMP_TO_EDGE),N=e.fbo=b.createFramebuffer(P,P,!0,!1),N.colorAttachment.set(Z.texture)}b.bindFramebuffer.set(N.framebuffer),b.viewport.set([0,0,P,P]),m.useProgram("hillshadePrepare").draw(b,k.TRIANGLES,c,d,f,Zt.disabled,((Z,H)=>{const J=H.stride,re=u.H();return u.aP(re,0,u.X,-u.X,0,0,1),u.J(re,re,[0,-u.X,0]),{u_matrix:re,u_image:1,u_dimension:[J,J],u_zoom:Z.overscaledZ,u_unpack:H.getUnpackVector()}})(e.tileID,T),null,a.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function Rd(m,e,a,c,d,f){const b=c.paint.get("raster-fade-duration");if(!f&&b>0){const k=j.now(),T=(k-m.timeAdded)/b,P=e?(k-e.timeAdded)/b:-1,A=a.getSource(),z=d.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),N=!e||Math.abs(e.tileID.overscaledZ-z)>Math.abs(m.tileID.overscaledZ-z),Z=N&&m.refreshedUponExpiration?1:u.ac(N?T:1-P,0,1);return m.refreshedUponExpiration&&T>=1&&(m.refreshedUponExpiration=!1),e?{opacity:1,mix:1-Z}:{opacity:Z,mix:0}}return{opacity:1,mix:0}}const vc=new u.aM(1,0,0,1),Rt=new u.aM(0,1,0,1),zl=new u.aM(0,0,1,1),Im=new u.aM(1,0,1,1),Bd=new u.aM(0,1,1,1);function ba(m,e,a,c){Dl(m,0,e+a/2,m.transform.width,a,c)}function Fd(m,e,a,c){Dl(m,e-a/2,0,a,m.transform.height,c)}function Dl(m,e,a,c,d,f){const b=m.context,k=b.gl;k.enable(k.SCISSOR_TEST),k.scissor(e*m.pixelRatio,a*m.pixelRatio,c*m.pixelRatio,d*m.pixelRatio),b.clear({color:f}),k.disable(k.SCISSOR_TEST)}function Od(m,e,a){const c=m.context,d=c.gl,f=a.posMatrix,b=m.useProgram("debug"),k=It.disabled,T=Yt.disabled,P=m.colorModeForRenderPass(),A="$debug",z=m.style.map.terrain&&m.style.map.terrain.getTerrainData(a);c.activeTexture.set(d.TEXTURE0);const N=e.getTileByID(a.key).latestRawTileData,Z=Math.floor((N&&N.byteLength||0)/1024),H=e.getTile(a).tileSize,J=512/Math.min(H,512)*(a.overscaledZ/m.transform.zoom)*.5;let re=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(re+=` => ${a.overscaledZ}`),function(ne,se){ne.initDebugOverlayCanvas();const W=ne.debugOverlayCanvas,ue=ne.context.gl,pe=ne.debugOverlayCanvas.getContext("2d");pe.clearRect(0,0,W.width,W.height),pe.shadowColor="white",pe.shadowBlur=2,pe.lineWidth=1.5,pe.strokeStyle="white",pe.textBaseline="top",pe.font="bold 36px Open Sans, sans-serif",pe.fillText(se,5,5),pe.strokeText(se,5,5),ne.debugOverlayTexture.update(W),ne.debugOverlayTexture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE)}(m,`${re} ${Z}kB`),b.draw(c,d.TRIANGLES,k,T,fr.alphaBlended,Zt.disabled,To(f,u.aM.transparent,J),null,A,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),b.draw(c,d.LINE_STRIP,k,T,P,Zt.disabled,To(f,u.aM.red),z,A,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function Nd(m,e,a){const c=m.context,d=c.gl,f=m.colorModeForRenderPass(),b=new It(d.LEQUAL,It.ReadWrite,m.depthRangeFor3D),k=m.useProgram("terrain"),T=e.getTerrainMesh();c.bindFramebuffer.set(null),c.viewport.set([0,0,m.width,m.height]);for(const P of a){const A=m.renderToTexture.getTexture(P),z=e.getTerrainData(P.tileID);c.activeTexture.set(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,A.texture);const N=m.transform.calculatePosMatrix(P.tileID.toUnwrapped()),Z=e.getMeshFrameDelta(m.transform.zoom),H=m.transform.calculateFogMatrix(P.tileID.toUnwrapped()),J=rc(N,Z,H,m.style.sky,m.transform.pitch);k.draw(c,d.TRIANGLES,b,Yt.disabled,f,Zt.backCCW,J,z,"terrain",T.vertexBuffer,T.indexBuffer,T.segments)}}class Ll{constructor(e,a,c){this.vertexBuffer=e,this.indexBuffer=a,this.segments=c}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class Rl{constructor(e,a){this.context=new Tm(e),this.transform=a,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:u.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=dt.maxUnderzooming+dt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ec}resize(e,a,c){if(this.width=Math.floor(e*c),this.height=Math.floor(a*c),this.pixelRatio=c,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style._order)this.style._layers[d].resize()}setup(){const e=this.context,a=new u.aX;a.emplaceBack(0,0),a.emplaceBack(u.X,0),a.emplaceBack(0,u.X),a.emplaceBack(u.X,u.X),this.tileExtentBuffer=e.createVertexBuffer(a,As.members),this.tileExtentSegments=u.a0.simpleSegment(0,0,4,2);const c=new u.aX;c.emplaceBack(0,0),c.emplaceBack(u.X,0),c.emplaceBack(0,u.X),c.emplaceBack(u.X,u.X),this.debugBuffer=e.createVertexBuffer(c,As.members),this.debugSegments=u.a0.simpleSegment(0,0,4,5);const d=new u.$;d.emplaceBack(0,0,0,0),d.emplaceBack(u.X,0,u.X,0),d.emplaceBack(0,u.X,0,u.X),d.emplaceBack(u.X,u.X,u.X,u.X),this.rasterBoundsBuffer=e.createVertexBuffer(d,ls.members),this.rasterBoundsSegments=u.a0.simpleSegment(0,0,4,2);const f=new u.aX;f.emplaceBack(0,0),f.emplaceBack(1,0),f.emplaceBack(0,1),f.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(f,As.members),this.viewportSegments=u.a0.simpleSegment(0,0,4,2);const b=new u.aZ;b.emplaceBack(0),b.emplaceBack(1),b.emplaceBack(3),b.emplaceBack(2),b.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(b);const k=new u.aY;k.emplaceBack(0,1,2),k.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(k);const T=this.context.gl;this.stencilClearMode=new Yt({func:T.ALWAYS,mask:0},0,255,T.ZERO,T.ZERO,T.ZERO)}clearStencil(){const e=this.context,a=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const c=u.H();u.aP(c,0,this.width,this.height,0,0,1),u.K(c,c,[a.drawingBufferWidth,a.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,a.TRIANGLES,It.disabled,this.stencilClearMode,fr.disabled,Zt.disabled,mn(c),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,a){if(this.currentStencilSource===e.source||!e.isTileClipped()||!a||!a.length)return;this.currentStencilSource=e.source;const c=this.context,d=c.gl;this.nextStencilID+a.length>256&&this.clearStencil(),c.setColorMode(fr.disabled),c.setDepthMode(It.disabled);const f=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const b of a){const k=this._tileClippingMaskIDs[b.key]=this.nextStencilID++,T=this.style.map.terrain&&this.style.map.terrain.getTerrainData(b);f.draw(c,d.TRIANGLES,It.disabled,new Yt({func:d.ALWAYS,mask:0},k,255,d.KEEP,d.KEEP,d.REPLACE),fr.disabled,Zt.disabled,mn(b.posMatrix),T,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,a=this.context.gl;return new Yt({func:a.NOTEQUAL,mask:255},e,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(e){const a=this.context.gl;return new Yt({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(e){const a=this.context.gl,c=e.sort((b,k)=>k.overscaledZ-b.overscaledZ),d=c[c.length-1].overscaledZ,f=c[0].overscaledZ-d+1;if(f>1){this.currentStencilSource=void 0,this.nextStencilID+f>256&&this.clearStencil();const b={};for(let k=0;k<f;k++)b[k+d]=new Yt({func:a.GEQUAL,mask:255},k+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=f,[b,c]}return[{[d]:Yt.disabled},c]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new fr([e.CONSTANT_COLOR,e.ONE],new u.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?fr.unblended:fr.alphaBlended}depthModeForSublayer(e,a,c){if(!this.opaquePassEnabledForLayer())return It.disabled;const d=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new It(c||this.context.gl.LEQUAL,a,[d,d])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,a){this.style=e,this.options=a,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(j.now()),this.imageManager.beginFrame();const c=this.style._order,d=this.style.sourceCaches,f={},b={},k={};for(const T in d){const P=d[T];P.used&&P.prepare(this.context),f[T]=P.getVisibleCoordinates(),b[T]=f[T].slice().reverse(),k[T]=P.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let T=0;T<c.length;T++)if(this.style._layers[c[T]].is3D()){this.opaquePassCutoff=T;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const T of c){const P=this.style._layers[T];if(!P.hasOffscreenPass()||P.isHidden(this.transform.zoom))continue;const A=b[P.source];(P.type==="custom"||A.length)&&this.renderLayer(this,d[P.source],P,A)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:a.showOverdrawInspector?u.aM.black:u.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(T,P){const A=T.context,z=A.gl,N=((ne,se,W)=>({u_sky_color:ne.properties.get("sky-color"),u_horizon_color:ne.properties.get("horizon-color"),u_horizon:(se.height/2+se.getHorizon())*W,u_sky_horizon_blend:ne.properties.get("sky-horizon-blend")*se.height/2*W}))(P,T.style.map.transform,T.pixelRatio),Z=new It(z.LEQUAL,It.ReadWrite,[0,1]),H=Yt.disabled,J=T.colorModeForRenderPass(),re=T.useProgram("sky");if(!P.mesh){const ne=new u.aX;ne.emplaceBack(-1,-1),ne.emplaceBack(1,-1),ne.emplaceBack(1,1),ne.emplaceBack(-1,1);const se=new u.aY;se.emplaceBack(0,1,2),se.emplaceBack(0,2,3),P.mesh=new Ll(A.createVertexBuffer(ne,As.members),A.createIndexBuffer(se),u.a0.simpleSegment(0,0,ne.length,se.length))}re.draw(A,z.TRIANGLES,Z,H,J,Zt.disabled,N,void 0,"sky",P.mesh.vertexBuffer,P.mesh.indexBuffer,P.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=a.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=c.length-1;this.currentLayer>=0;this.currentLayer--){const T=this.style._layers[c[this.currentLayer]],P=d[T.source],A=f[T.source];this._renderTileClippingMasks(T,A),this.renderLayer(this,P,T,A)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<c.length;this.currentLayer++){const T=this.style._layers[c[this.currentLayer]],P=d[T.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(T))continue;const A=(T.type==="symbol"?k:b)[T.source];this._renderTileClippingMasks(T,f[T.source]),this.renderLayer(this,P,T,A)}if(this.options.showTileBoundaries){const T=function(P,A){let z=null;const N=Object.values(P._layers).flatMap(re=>re.source&&!re.isHidden(A)?[P.sourceCaches[re.source]]:[]),Z=N.filter(re=>re.getSource().type==="vector"),H=N.filter(re=>re.getSource().type!=="vector"),J=re=>{(!z||z.getSource().maxzoom<re.getSource().maxzoom)&&(z=re)};return Z.forEach(re=>J(re)),z||H.forEach(re=>J(re)),z}(this.style,this.transform.zoom);T&&function(P,A,z){for(let N=0;N<z.length;N++)Od(P,A,z[N])}(this,T,T.getVisibleCoordinates())}this.options.showPadding&&function(T){const P=T.transform.padding;ba(T,T.transform.height-(P.top||0),3,vc),ba(T,P.bottom||0,3,Rt),Fd(T,P.left||0,3,zl),Fd(T,T.transform.width-(P.right||0),3,Im);const A=T.transform.centerPoint;(function(z,N,Z,H){Dl(z,N-1,Z-10,2,20,H),Dl(z,N-10,Z-1,20,2,H)})(T,A.x,T.transform.height-A.y,Bd)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const a=this.terrainFacilitator.matrix,c=this.transform.modelViewProjectionMatrix;let d=this.terrainFacilitator.dirty;d||(d=e?!u.a_(a,c):!u.a$(a,c)),d||(d=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),d&&(u.b0(a,c),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(f,b){const k=f.context,T=k.gl,P=fr.unblended,A=new It(T.LEQUAL,It.ReadWrite,[0,1]),z=b.getTerrainMesh(),N=b.sourceCache.getRenderableTiles(),Z=f.useProgram("terrainDepth");k.bindFramebuffer.set(b.getFramebuffer("depth").framebuffer),k.viewport.set([0,0,f.width/devicePixelRatio,f.height/devicePixelRatio]),k.clear({color:u.aM.transparent,depth:1});for(const H of N){const J=b.getTerrainData(H.tileID),re={u_matrix:f.transform.calculatePosMatrix(H.tileID.toUnwrapped()),u_ele_delta:b.getMeshFrameDelta(f.transform.zoom)};Z.draw(k,T.TRIANGLES,A,Yt.disabled,P,Zt.backCCW,re,J,"terrain",z.vertexBuffer,z.indexBuffer,z.segments)}k.bindFramebuffer.set(null),k.viewport.set([0,0,f.width,f.height])}(this,this.style.map.terrain),function(f,b){const k=f.context,T=k.gl,P=fr.unblended,A=new It(T.LEQUAL,It.ReadWrite,[0,1]),z=b.getTerrainMesh(),N=b.getCoordsTexture(),Z=b.sourceCache.getRenderableTiles(),H=f.useProgram("terrainCoords");k.bindFramebuffer.set(b.getFramebuffer("coords").framebuffer),k.viewport.set([0,0,f.width/devicePixelRatio,f.height/devicePixelRatio]),k.clear({color:u.aM.transparent,depth:1}),b.coordsIndex=[];for(const J of Z){const re=b.getTerrainData(J.tileID);k.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,N.texture);const ne={u_matrix:f.transform.calculatePosMatrix(J.tileID.toUnwrapped()),u_terrain_coords_id:(255-b.coordsIndex.length)/255,u_texture:0,u_ele_delta:b.getMeshFrameDelta(f.transform.zoom)};H.draw(k,T.TRIANGLES,A,Yt.disabled,P,Zt.backCCW,ne,re,"terrain",z.vertexBuffer,z.indexBuffer,z.segments),b.coordsIndex.push(J.tileID.key)}k.bindFramebuffer.set(null),k.viewport.set([0,0,f.width,f.height])}(this,this.style.map.terrain))}renderLayer(e,a,c,d){if(!c.isHidden(this.transform.zoom)&&(c.type==="background"||c.type==="custom"||(d||[]).length))switch(this.id=c.id,c.type){case"symbol":(function(f,b,k,T,P){if(f.renderPass!=="translucent")return;const A=Yt.disabled,z=f.colorModeForRenderPass();(k._unevaluatedLayout.hasValue("text-variable-anchor")||k._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(N,Z,H,J,re,ne,se,W,ue){const pe=Z.transform,ye=Ms(),Me=re==="map",De=ne==="map";for(const $e of N){const Ke=J.getTile($e),Oe=Ke.getBucket(H);if(!Oe||!Oe.text||!Oe.text.segments.get().length)continue;const Fe=u.ag(Oe.textSizeData,pe.zoom),et=Et(Ke,1,Z.transform.zoom),gt=cs($e.posMatrix,De,Me,Z.transform,et),je=H.layout.get("icon-text-fit")!=="none"&&Oe.hasIconData();if(Fe){const Ze=Math.pow(2,pe.zoom-Ke.tileID.overscaledZ),ft=Z.style.map.terrain?(wt,Pt)=>Z.style.map.terrain.getElevation($e,wt,Pt):null,tr=ye.translatePosition(pe,Ke,se,W);_a(Oe,Me,De,ue,pe,gt,$e.posMatrix,Ze,Fe,je,ye,tr,$e.toUnwrapped(),ft)}}}(T,f,k,b,k.layout.get("text-rotation-alignment"),k.layout.get("text-pitch-alignment"),k.paint.get("text-translate"),k.paint.get("text-translate-anchor"),P),k.paint.get("icon-opacity").constantOr(1)!==0&&gc(f,b,k,T,!1,k.paint.get("icon-translate"),k.paint.get("icon-translate-anchor"),k.layout.get("icon-rotation-alignment"),k.layout.get("icon-pitch-alignment"),k.layout.get("icon-keep-upright"),A,z),k.paint.get("text-opacity").constantOr(1)!==0&&gc(f,b,k,T,!0,k.paint.get("text-translate"),k.paint.get("text-translate-anchor"),k.layout.get("text-rotation-alignment"),k.layout.get("text-pitch-alignment"),k.layout.get("text-keep-upright"),A,z),b.map.showCollisionBoxes&&(Po(f,b,k,T,!0),Po(f,b,k,T,!1))})(e,a,c,d,this.style.placement.variableOffsets);break;case"circle":(function(f,b,k,T){if(f.renderPass!=="translucent")return;const P=k.paint.get("circle-opacity"),A=k.paint.get("circle-stroke-width"),z=k.paint.get("circle-stroke-opacity"),N=!k.layout.get("circle-sort-key").isConstant();if(P.constantOr(1)===0&&(A.constantOr(1)===0||z.constantOr(1)===0))return;const Z=f.context,H=Z.gl,J=f.depthModeForSublayer(0,It.ReadOnly),re=Yt.disabled,ne=f.colorModeForRenderPass(),se=[];for(let W=0;W<T.length;W++){const ue=T[W],pe=b.getTile(ue),ye=pe.getBucket(k);if(!ye)continue;const Me=ye.programConfigurations.get(k.id),De=f.useProgram("circle",Me),$e=ye.layoutVertexBuffer,Ke=ye.indexBuffer,Oe=f.style.map.terrain&&f.style.map.terrain.getTerrainData(ue),Fe={programConfiguration:Me,program:De,layoutVertexBuffer:$e,indexBuffer:Ke,uniformValues:dm(f,ue,pe,k),terrainData:Oe};if(N){const et=ye.segments.get();for(const gt of et)se.push({segments:new u.a0([gt]),sortKey:gt.sortKey,state:Fe})}else se.push({segments:ye.segments,sortKey:0,state:Fe})}N&&se.sort((W,ue)=>W.sortKey-ue.sortKey);for(const W of se){const{programConfiguration:ue,program:pe,layoutVertexBuffer:ye,indexBuffer:Me,uniformValues:De,terrainData:$e}=W.state;pe.draw(Z,H.TRIANGLES,J,re,ne,Zt.disabled,De,$e,k.id,ye,Me,W.segments,k.paint,f.transform.zoom,ue)}})(e,a,c,d);break;case"heatmap":(function(f,b,k,T){if(k.paint.get("heatmap-opacity")===0)return;const P=f.context;if(f.style.map.terrain){for(const A of T){const z=b.getTile(A);b.hasRenderableParent(A)||(f.renderPass==="offscreen"?_c(f,z,k,A):f.renderPass==="translucent"&&Os(f,k,A))}P.viewport.set([0,0,f.width,f.height])}else f.renderPass==="offscreen"?function(A,z,N,Z){const H=A.context,J=H.gl,re=Yt.disabled,ne=new fr([J.ONE,J.ONE],u.aM.transparent,[!0,!0,!0,!0]);(function(se,W,ue){const pe=se.gl;se.activeTexture.set(pe.TEXTURE1),se.viewport.set([0,0,W.width/4,W.height/4]);let ye=ue.heatmapFbos.get(u.aU);ye?(pe.bindTexture(pe.TEXTURE_2D,ye.colorAttachment.get()),se.bindFramebuffer.set(ye.framebuffer)):(ye=Mo(se,W.width/4,W.height/4),ue.heatmapFbos.set(u.aU,ye))})(H,A,N),H.clear({color:u.aM.transparent});for(let se=0;se<Z.length;se++){const W=Z[se];if(z.hasRenderableParent(W))continue;const ue=z.getTile(W),pe=ue.getBucket(N);if(!pe)continue;const ye=pe.programConfigurations.get(N.id),Me=A.useProgram("heatmap",ye),{zoom:De}=A.transform;Me.draw(H,J.TRIANGLES,It.disabled,re,ne,Zt.disabled,gn(W.posMatrix,ue,De,N.paint.get("heatmap-intensity")),null,N.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segments,N.paint,A.transform.zoom,ye)}H.viewport.set([0,0,A.width,A.height])}(f,b,k,T):f.renderPass==="translucent"&&function(A,z){const N=A.context,Z=N.gl;N.setColorMode(A.colorModeForRenderPass());const H=z.heatmapFbos.get(u.aU);H&&(N.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_2D,H.colorAttachment.get()),N.activeTexture.set(Z.TEXTURE1),Ao(N,z).bind(Z.LINEAR,Z.CLAMP_TO_EDGE),A.useProgram("heatmapTexture").draw(N,Z.TRIANGLES,It.disabled,Yt.disabled,A.colorModeForRenderPass(),Zt.disabled,bl(A,z,0,1),null,z.id,A.viewportBuffer,A.quadTriangleIndexBuffer,A.viewportSegments,z.paint,A.transform.zoom))}(f,k)})(e,a,c,d);break;case"line":(function(f,b,k,T){if(f.renderPass!=="translucent")return;const P=k.paint.get("line-opacity"),A=k.paint.get("line-width");if(P.constantOr(1)===0||A.constantOr(1)===0)return;const z=f.depthModeForSublayer(0,It.ReadOnly),N=f.colorModeForRenderPass(),Z=k.paint.get("line-dasharray"),H=k.paint.get("line-pattern"),J=H.constantOr(1),re=k.paint.get("line-gradient"),ne=k.getCrossfadeParameters(),se=J?"linePattern":Z?"lineSDF":re?"lineGradient":"line",W=f.context,ue=W.gl;let pe=!0;for(const ye of T){const Me=b.getTile(ye);if(J&&!Me.patternsLoaded())continue;const De=Me.getBucket(k);if(!De)continue;const $e=De.programConfigurations.get(k.id),Ke=f.context.program.get(),Oe=f.useProgram(se,$e),Fe=pe||Oe.program!==Ke,et=f.style.map.terrain&&f.style.map.terrain.getTerrainData(ye),gt=H.constantOr(null);if(gt&&Me.imageAtlas){const ft=Me.imageAtlas,tr=ft.patternPositions[gt.to.toString()],wt=ft.patternPositions[gt.from.toString()];tr&&wt&&$e.setConstantPatternPositions(tr,wt)}const je=et?ye:null,Ze=J?ga(f,Me,k,ne,je):Z?pm(f,Me,k,Z,ne,je):re?vd(f,Me,k,De.lineClipsArray.length,je):kl(f,Me,k,je);if(J)W.activeTexture.set(ue.TEXTURE0),Me.imageAtlasTexture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE),$e.updatePaintBuffers(ne);else if(Z&&(Fe||f.lineAtlas.dirty))W.activeTexture.set(ue.TEXTURE0),f.lineAtlas.bind(W);else if(re){const ft=De.gradients[k.id];let tr=ft.texture;if(k.gradientVersion!==ft.version){let wt=256;if(k.stepInterpolant){const Pt=b.getSource().maxzoom,rr=ye.canonical.z===Pt?Math.ceil(1<<f.transform.maxZoom-ye.canonical.z):1;wt=u.ac(u.aV(De.maxLineLength/u.X*1024*rr),256,W.maxTextureSize)}ft.gradient=u.aW({expression:k.gradientExpression(),evaluationKey:"lineProgress",resolution:wt,image:ft.gradient||void 0,clips:De.lineClipsArray}),ft.texture?ft.texture.update(ft.gradient):ft.texture=new Ye(W,ft.gradient,ue.RGBA),ft.version=k.gradientVersion,tr=ft.texture}W.activeTexture.set(ue.TEXTURE0),tr.bind(k.stepInterpolant?ue.NEAREST:ue.LINEAR,ue.CLAMP_TO_EDGE)}Oe.draw(W,ue.TRIANGLES,z,f.stencilModeForClipping(ye),N,Zt.disabled,Ze,et,k.id,De.layoutVertexBuffer,De.indexBuffer,De.segments,k.paint,f.transform.zoom,$e,De.layoutVertexBuffer2),pe=!1}})(e,a,c,d);break;case"fill":(function(f,b,k,T){const P=k.paint.get("fill-color"),A=k.paint.get("fill-opacity");if(A.constantOr(1)===0)return;const z=f.colorModeForRenderPass(),N=k.paint.get("fill-pattern"),Z=f.opaquePassEnabledForLayer()&&!N.constantOr(1)&&P.constantOr(u.aM.transparent).a===1&&A.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===Z){const H=f.depthModeForSublayer(1,f.renderPass==="opaque"?It.ReadWrite:It.ReadOnly);zo(f,b,k,T,H,z,!1)}if(f.renderPass==="translucent"&&k.paint.get("fill-antialias")){const H=f.depthModeForSublayer(k.getPaintProperty("fill-outline-color")?2:0,It.ReadOnly);zo(f,b,k,T,H,z,!0)}})(e,a,c,d);break;case"fill-extrusion":(function(f,b,k,T){const P=k.paint.get("fill-extrusion-opacity");if(P!==0&&f.renderPass==="translucent"){const A=new It(f.context.gl.LEQUAL,It.ReadWrite,f.depthRangeFor3D);if(P!==1||k.paint.get("fill-extrusion-pattern").constantOr(1))Al(f,b,k,T,A,Yt.disabled,fr.disabled),Al(f,b,k,T,A,f.stencilModeFor3D(),f.colorModeForRenderPass());else{const z=f.colorModeForRenderPass();Al(f,b,k,T,A,Yt.disabled,z)}}})(e,a,c,d);break;case"hillshade":(function(f,b,k,T){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent")return;const P=f.context,A=f.depthModeForSublayer(0,It.ReadOnly),z=f.colorModeForRenderPass(),[N,Z]=f.renderPass==="translucent"?f.stencilConfigForOverlap(T):[{},T];for(const H of Z){const J=b.getTile(H);J.needsHillshadePrepare!==void 0&&J.needsHillshadePrepare&&f.renderPass==="offscreen"?wa(f,J,k,A,Yt.disabled,z):f.renderPass==="translucent"&&xa(f,H,J,k,A,N[H.overscaledZ],z)}P.viewport.set([0,0,f.width,f.height])})(e,a,c,d);break;case"raster":(function(f,b,k,T){if(f.renderPass!=="translucent"||k.paint.get("raster-opacity")===0||!T.length)return;const P=f.context,A=P.gl,z=b.getSource(),N=f.useProgram("raster"),Z=f.colorModeForRenderPass(),[H,J]=z instanceof Zi?[{},T]:f.stencilConfigForOverlap(T),re=J[J.length-1].overscaledZ,ne=!f.options.moving;for(const se of J){const W=f.depthModeForSublayer(se.overscaledZ-re,k.paint.get("raster-opacity")===1?It.ReadWrite:It.ReadOnly,A.LESS),ue=b.getTile(se);ue.registerFadeDuration(k.paint.get("raster-fade-duration"));const pe=b.findLoadedParent(se,0),ye=b.findLoadedSibling(se),Me=Rd(ue,pe||ye||null,b,k,f.transform,f.style.map.terrain);let De,$e;const Ke=k.paint.get("raster-resampling")==="nearest"?A.NEAREST:A.LINEAR;P.activeTexture.set(A.TEXTURE0),ue.texture.bind(Ke,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),P.activeTexture.set(A.TEXTURE1),pe?(pe.texture.bind(Ke,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),De=Math.pow(2,pe.tileID.overscaledZ-ue.tileID.overscaledZ),$e=[ue.tileID.canonical.x*De%1,ue.tileID.canonical.y*De%1]):ue.texture.bind(Ke,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),ue.texture.useMipmap&&P.extTextureFilterAnisotropic&&f.transform.pitch>20&&A.texParameterf(A.TEXTURE_2D,P.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,P.extTextureFilterAnisotropicMax);const Oe=f.style.map.terrain&&f.style.map.terrain.getTerrainData(se),Fe=Oe?se:null,et=Fe?Fe.posMatrix:f.transform.calculatePosMatrix(se.toUnwrapped(),ne),gt=fm(et,$e||[0,0],De||1,Me,k);z instanceof Zi?N.draw(P,A.TRIANGLES,W,Yt.disabled,Z,Zt.disabled,gt,Oe,k.id,z.boundsBuffer,f.quadTriangleIndexBuffer,z.boundsSegments):N.draw(P,A.TRIANGLES,W,H[se.overscaledZ],Z,Zt.disabled,gt,Oe,k.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}})(e,a,c,d);break;case"background":(function(f,b,k,T){const P=k.paint.get("background-color"),A=k.paint.get("background-opacity");if(A===0)return;const z=f.context,N=z.gl,Z=f.transform,H=Z.tileSize,J=k.paint.get("background-pattern");if(f.isPatternMissing(J))return;const re=!J&&P.a===1&&A===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==re)return;const ne=Yt.disabled,se=f.depthModeForSublayer(0,re==="opaque"?It.ReadWrite:It.ReadOnly),W=f.colorModeForRenderPass(),ue=f.useProgram(J?"backgroundPattern":"background"),pe=T||Z.coveringTiles({tileSize:H,terrain:f.style.map.terrain});J&&(z.activeTexture.set(N.TEXTURE0),f.imageManager.bind(f.context));const ye=k.getCrossfadeParameters();for(const Me of pe){const De=T?Me.posMatrix:f.transform.calculatePosMatrix(Me.toUnwrapped()),$e=J?sc(De,A,f,J,{tileID:Me,tileSize:H},ye):Tl(De,A,P),Ke=f.style.map.terrain&&f.style.map.terrain.getTerrainData(Me);ue.draw(z,N.TRIANGLES,se,ne,W,Zt.disabled,$e,Ke,k.id,f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}})(e,0,c,d);break;case"custom":(function(f,b,k){const T=f.context,P=k.implementation;if(f.renderPass==="offscreen"){const A=P.prerender;A&&(f.setCustomLayerDefaults(),T.setColorMode(f.colorModeForRenderPass()),A.call(P,T.gl,f.transform.customLayerMatrix()),T.setDirty(),f.setBaseState())}else if(f.renderPass==="translucent"){f.setCustomLayerDefaults(),T.setColorMode(f.colorModeForRenderPass()),T.setStencilMode(Yt.disabled);const A=P.renderingMode==="3d"?new It(f.context.gl.LEQUAL,It.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,It.ReadOnly);T.setDepthMode(A),P.render(T.gl,f.transform.customLayerMatrix(),{farZ:f.transform.farZ,nearZ:f.transform.nearZ,fov:f.transform._fov,modelViewProjectionMatrix:f.transform.modelViewProjectionMatrix,projectionMatrix:f.transform.projectionMatrix}),T.setDirty(),f.setBaseState(),T.bindFramebuffer.set(null)}})(e,0,c)}}translatePosMatrix(e,a,c,d,f){if(!c[0]&&!c[1])return e;const b=f?d==="map"?this.transform.angle:0:d==="viewport"?-this.transform.angle:0;if(b){const P=Math.sin(b),A=Math.cos(b);c=[c[0]*A-c[1]*P,c[0]*P+c[1]*A]}const k=[f?c[0]:Et(a,c[0],this.transform.zoom),f?c[1]:Et(a,c[1],this.transform.zoom),0],T=new Float32Array(16);return u.J(T,e,k),T}saveTileTexture(e){const a=this._tileTextures[e.size[0]];a?a.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const a=this._tileTextures[e];return a&&a.length>0?a.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const a=this.imageManager.getPattern(e.from.toString()),c=this.imageManager.getPattern(e.to.toString());return!a||!c}useProgram(e,a){this.cache=this.cache||{};const c=e+(a?a.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[c]||(this.cache[c]=new nc(this.context,hs[e],a,ac[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[c]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Ye(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:a}=this.context.gl;return this.width!==e||this.height!==a}}class Sa{constructor(e,a){this.points=e,this.planes=a}static fromInvProjectionMatrix(e,a,c){const d=Math.pow(2,c),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(k=>{const T=1/(k=u.af([],k,e))[3]/a*d;return u.b1(k,k,[T,T,1/k[3],T])}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(k=>{const T=function(N,Z){var H=Z[0],J=Z[1],re=Z[2],ne=H*H+J*J+re*re;return ne>0&&(ne=1/Math.sqrt(ne)),N[0]=Z[0]*ne,N[1]=Z[1]*ne,N[2]=Z[2]*ne,N}([],function(N,Z,H){var J=Z[0],re=Z[1],ne=Z[2],se=H[0],W=H[1],ue=H[2];return N[0]=re*ue-ne*W,N[1]=ne*se-J*ue,N[2]=J*W-re*se,N}([],xe([],f[k[0]],f[k[1]]),xe([],f[k[2]],f[k[1]]))),P=-((A=T)[0]*(z=f[k[1]])[0]+A[1]*z[1]+A[2]*z[2]);var A,z;return T.concat(P)});return new Sa(f,b)}}class ka{constructor(e,a){this.min=e,this.max=a,this.center=function(c,d,f){return c[0]=.5*d[0],c[1]=.5*d[1],c[2]=.5*d[2],c}([],function(c,d,f){return c[0]=d[0]+f[0],c[1]=d[1]+f[1],c[2]=d[2]+f[2],c}([],this.min,this.max))}quadrant(e){const a=[e%2==0,e<2],c=Se(this.min),d=Se(this.max);for(let f=0;f<a.length;f++)c[f]=a[f]?this.min[f]:this.center[f],d[f]=a[f]?this.center[f]:this.max[f];return d[2]=this.max[2],new ka(c,d)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const a=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let c=!0;for(let d=0;d<e.planes.length;d++){const f=e.planes[d];let b=0;for(let k=0;k<a.length;k++)u.b2(f,a[k])>=0&&b++;if(b===0)return 0;b!==a.length&&(c=!1)}if(c)return 2;for(let d=0;d<3;d++){let f=Number.MAX_VALUE,b=-Number.MAX_VALUE;for(let k=0;k<e.points.length;k++){const T=e.points[k][d]-this.min[d];f=Math.min(f,T),b=Math.max(b,T)}if(b<0||f>this.max[d]-this.min[d])return 0}return 1}}class Ta{constructor(e=0,a=0,c=0,d=0){if(isNaN(e)||e<0||isNaN(a)||a<0||isNaN(c)||c<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=a,this.left=c,this.right=d}interpolate(e,a,c){return a.top!=null&&e.top!=null&&(this.top=u.y.number(e.top,a.top,c)),a.bottom!=null&&e.bottom!=null&&(this.bottom=u.y.number(e.bottom,a.bottom,c)),a.left!=null&&e.left!=null&&(this.left=u.y.number(e.left,a.left,c)),a.right!=null&&e.right!=null&&(this.right=u.y.number(e.right,a.right,c)),this}getCenter(e,a){const c=u.ac((this.left+e-this.right)/2,0,e),d=u.ac((this.top+a-this.bottom)/2,0,a);return new u.P(c,d)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Ta(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const xc=85.051129;class Ia{constructor(e,a,c,d,f){this.tileSize=512,this._renderWorldCopies=f===void 0||!!f,this._minZoom=e||0,this._maxZoom=a||22,this._minPitch=c??0,this._maxPitch=d??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new u.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Ta,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const e=new Ia(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.lngRange=e.lngRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new u.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const a=-u.b3(e,-180,180)*Math.PI/180;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=function(){var c=new u.A(4);return u.A!=Float32Array&&(c[1]=0,c[2]=0),c[0]=1,c[3]=1,c}(),function(c,d,f){var b=d[0],k=d[1],T=d[2],P=d[3],A=Math.sin(f),z=Math.cos(f);c[0]=b*z+T*A,c[1]=k*z+P*A,c[2]=b*-A+T*z,c[3]=k*-A+P*z}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const a=u.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const a=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._zoom=a,this.tileZoom=Math.max(0,Math.floor(a)),this.scale=this.zoomScale(a),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,a,c){this._unmodified=!1,this._edgeInsets.interpolate(e,a,c),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const a=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(e){const a=[new u.b4(0,e)];if(this._renderWorldCopies){const c=this.pointCoordinate(new u.P(0,0)),d=this.pointCoordinate(new u.P(this.width,0)),f=this.pointCoordinate(new u.P(this.width,this.height)),b=this.pointCoordinate(new u.P(0,this.height)),k=Math.floor(Math.min(c.x,d.x,f.x,b.x)),T=Math.floor(Math.max(c.x,d.x,f.x,b.x)),P=1;for(let A=k-P;A<=T+P;A++)A!==0&&a.push(new u.b4(A,e))}return a}coveringTiles(e){var a,c;let d=this.coveringZoomLevel(e);const f=d;if(e.minzoom!==void 0&&d<e.minzoom)return[];e.maxzoom!==void 0&&d>e.maxzoom&&(d=e.maxzoom);const b=this.pointCoordinate(this.getCameraPoint()),k=u.Z.fromLngLat(this.center),T=Math.pow(2,d),P=[T*b.x,T*b.y,0],A=[T*k.x,T*k.y,0],z=Sa.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,d);let N=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(N=d);const Z=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,H=W=>({aabb:new ka([W*T,0,0],[(W+1)*T,T,0]),zoom:0,x:0,y:0,wrap:W,fullyVisible:!1}),J=[],re=[],ne=d,se=e.reparseOverscaled?f:d;if(this._renderWorldCopies)for(let W=1;W<=3;W++)J.push(H(-W)),J.push(H(W));for(J.push(H(0));J.length>0;){const W=J.pop(),ue=W.x,pe=W.y;let ye=W.fullyVisible;if(!ye){const Oe=W.aabb.intersects(z);if(Oe===0)continue;ye=Oe===2}const Me=e.terrain?P:A,De=W.aabb.distanceX(Me),$e=W.aabb.distanceY(Me),Ke=Math.max(Math.abs(De),Math.abs($e));if(W.zoom===ne||Ke>Z+(1<<ne-W.zoom)-2&&W.zoom>=N){const Oe=ne-W.zoom,Fe=P[0]-.5-(ue<<Oe),et=P[1]-.5-(pe<<Oe);re.push({tileID:new u.S(W.zoom===ne?se:W.zoom,W.wrap,W.zoom,ue,pe),distanceSq:Pe([A[0]-.5-ue,A[1]-.5-pe]),tileDistanceToCamera:Math.sqrt(Fe*Fe+et*et)})}else for(let Oe=0;Oe<4;Oe++){const Fe=(ue<<1)+Oe%2,et=(pe<<1)+(Oe>>1),gt=W.zoom+1;let je=W.aabb.quadrant(Oe);if(e.terrain){const Ze=new u.S(gt,W.wrap,gt,Fe,et),ft=e.terrain.getMinMaxElevation(Ze),tr=(a=ft.minElevation)!==null&&a!==void 0?a:this.elevation,wt=(c=ft.maxElevation)!==null&&c!==void 0?c:this.elevation;je=new ka([je.min[0],je.min[1],tr],[je.max[0],je.max[1],wt])}J.push({aabb:je,zoom:gt,x:Fe,y:et,wrap:W.wrap,fullyVisible:ye})}}return re.sort((W,ue)=>W.distanceSq-ue.distanceSq).map(W=>W.tileID)}resize(e,a){this.width=e,this.height=a,this.pixelsToGLUnits=[2/e,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const a=u.ac(e.lat,-85.051129,xc);return new u.P(u.O(e.lng)*this.worldSize,u.Q(a)*this.worldSize)}unproject(e){return new u.Z(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const a=this.elevation,c=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,d=this.pointLocation(this.centerPoint,e),f=e.getElevationForLngLatZoom(d,this.tileZoom);if(!(this.elevation-f))return;const b=c+a-f,k=Math.cos(this._pitch)*this.cameraToCenterDistance/b/u.b5(1,d.lat),T=this.scaleZoom(k/this.tileSize);this._elevation=f,this._center=d,this.zoom=T}setLocationAtPoint(e,a){const c=this.pointCoordinate(a),d=this.pointCoordinate(this.centerPoint),f=this.locationCoordinate(e),b=new u.Z(f.x-(c.x-d.x),f.y-(c.y-d.y));this.center=this.coordinateLocation(b),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,a){return a?this.coordinatePoint(this.locationCoordinate(e),a.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,a){return this.coordinateLocation(this.pointCoordinate(e,a))}locationCoordinate(e){return u.Z.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,a){if(a){const N=a.pointCoordinate(e);if(N!=null)return N}const c=[e.x,e.y,0,1],d=[e.x,e.y,1,1];u.af(c,c,this.pixelMatrixInverse),u.af(d,d,this.pixelMatrixInverse);const f=c[3],b=d[3],k=c[1]/f,T=d[1]/b,P=c[2]/f,A=d[2]/b,z=P===A?0:(0-P)/(A-P);return new u.Z(u.y.number(c[0]/f,d[0]/b,z)/this.worldSize,u.y.number(k,T,z)/this.worldSize)}coordinatePoint(e,a=0,c=this.pixelMatrix){const d=[e.x*this.worldSize,e.y*this.worldSize,a,1];return u.af(d,d,c),new u.P(d[0]/d[3],d[1]/d[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new we().extend(this.pointLocation(new u.P(0,e))).extend(this.pointLocation(new u.P(this.width,e))).extend(this.pointLocation(new u.P(this.width,this.height))).extend(this.pointLocation(new u.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new we([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,xc])}calculateTileMatrix(e){const a=e.canonical,c=this.worldSize/this.zoomScale(a.z),d=a.x+Math.pow(2,a.z)*e.wrap,f=u.an(new Float64Array(16));return u.J(f,f,[d*c,a.y*c,0]),u.K(f,f,[c/u.X,c/u.X,1]),f}calculatePosMatrix(e,a=!1){const c=e.key,d=a?this._alignedPosMatrixCache:this._posMatrixCache;if(d[c])return d[c];const f=this.calculateTileMatrix(e);return u.L(f,a?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,f),d[c]=new Float32Array(f),d[c]}calculateFogMatrix(e){const a=e.key,c=this._fogMatrixCache;if(c[a])return c[a];const d=this.calculateTileMatrix(e);return u.L(d,this.fogMatrix,d),c[a]=new Float32Array(d),c[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,a){a=u.ac(+a,this.minZoom,this.maxZoom);const c={center:new u.N(e.lng,e.lat),zoom:a};let d=this.lngRange;if(!this._renderWorldCopies&&d===null){const W=179.9999999999;d=[-W,W]}const f=this.tileSize*this.zoomScale(c.zoom);let b=0,k=f,T=0,P=f,A=0,z=0;const{x:N,y:Z}=this.size;if(this.latRange){const W=this.latRange;b=u.Q(W[1])*f,k=u.Q(W[0])*f,k-b<Z&&(A=Z/(k-b))}d&&(T=u.b3(u.O(d[0])*f,0,f),P=u.b3(u.O(d[1])*f,0,f),P<T&&(P+=f),P-T<N&&(z=N/(P-T)));const{x:H,y:J}=this.project.call({worldSize:f},e);let re,ne;const se=Math.max(z||0,A||0);if(se){const W=new u.P(z?(P+T)/2:H,A?(k+b)/2:J);return c.center=this.unproject.call({worldSize:f},W).wrap(),c.zoom+=this.scaleZoom(se),c}if(this.latRange){const W=Z/2;J-W<b&&(ne=b+W),J+W>k&&(ne=k-W)}if(d){const W=(T+P)/2;let ue=H;this._renderWorldCopies&&(ue=u.b3(H,W-f/2,W+f/2));const pe=N/2;ue-pe<T&&(re=T+pe),ue+pe>P&&(re=P-pe)}if(re!==void 0||ne!==void 0){const W=new u.P(re??H,ne??J);c.center=this.unproject.call({worldSize:f},W).wrap()}return c}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:a,zoom:c}=this.getConstrained(this.center,this.zoom);this.center=a,this.zoom=c,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,a=this.point.x,c=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=u.b5(1,this.center.lat)*this.worldSize;let d=u.an(new Float64Array(16));u.K(d,d,[this.width/2,-this.height/2,1]),u.J(d,d,[1,-1,0]),this.labelPlaneMatrix=d,d=u.an(new Float64Array(16)),u.K(d,d,[1,-1,1]),u.J(d,d,[-1,-1,0]),u.K(d,d,[2/this.width,2/this.height,1]),this.glCoordMatrix=d;const f=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),b=Math.min(this.elevation,this.minElevationForCurrentTile),k=f-b*this._pixelPerMeter/Math.cos(this._pitch),T=b<0?k:f,P=Math.PI/2+this._pitch,A=this._fov*(.5+e.y/this.height),z=Math.sin(A)*T/Math.sin(u.ac(Math.PI-P-A,.01,Math.PI-.01)),N=this.getHorizon(),Z=2*Math.atan(N/this.cameraToCenterDistance)*(.5+e.y/(2*N)),H=Math.sin(Z)*T/Math.sin(u.ac(Math.PI-P-Z,.01,Math.PI-.01)),J=Math.min(z,H);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*J+T),this.nearZ=this.height/50,d=new Float64Array(16),u.b6(d,this._fov,this.width/this.height,this.nearZ,this.farZ),d[8]=2*-e.x/this.width,d[9]=2*e.y/this.height,this.projectionMatrix=u.ae(d),u.K(d,d,[1,-1,1]),u.J(d,d,[0,0,-this.cameraToCenterDistance]),u.b7(d,d,this._pitch),u.ad(d,d,this.angle),u.J(d,d,[-a,-c,0]),this.mercatorMatrix=u.K([],d,[this.worldSize,this.worldSize,this.worldSize]),u.K(d,d,[1,1,this._pixelPerMeter]),this.pixelMatrix=u.L(new Float64Array(16),this.labelPlaneMatrix,d),u.J(d,d,[0,0,-this.elevation]),this.modelViewProjectionMatrix=d,this.invModelViewProjectionMatrix=u.as([],d),this.fogMatrix=new Float64Array(16),u.b6(this.fogMatrix,this._fov,this.width/this.height,f,this.farZ),this.fogMatrix[8]=2*-e.x/this.width,this.fogMatrix[9]=2*e.y/this.height,u.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),u.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),u.b7(this.fogMatrix,this.fogMatrix,this._pitch),u.ad(this.fogMatrix,this.fogMatrix,this.angle),u.J(this.fogMatrix,this.fogMatrix,[-a,-c,0]),u.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),u.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=u.L(new Float64Array(16),this.labelPlaneMatrix,d);const re=this.width%2/2,ne=this.height%2/2,se=Math.cos(this.angle),W=Math.sin(this.angle),ue=a-Math.round(a)+se*re+W*ne,pe=c-Math.round(c)+se*ne+W*re,ye=new Float64Array(d);if(u.J(ye,ye,[ue>.5?ue-1:ue,pe>.5?pe-1:pe,0]),this.alignedModelViewProjectionMatrix=ye,d=u.as(new Float64Array(16),this.pixelMatrix),!d)throw new Error("failed to invert matrix");this.pixelMatrixInverse=d,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new u.P(0,0)),a=[e.x*this.worldSize,e.y*this.worldSize,0,1];return u.af(a,a,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new u.P(0,e))}getCameraQueryGeometry(e){const a=this.getCameraPoint();if(e.length===1)return[e[0],a];{let c=a.x,d=a.y,f=a.x,b=a.y;for(const k of e)c=Math.min(c,k.x),d=Math.min(d,k.y),f=Math.max(f,k.x),b=Math.max(b,k.y);return[new u.P(c,d),new u.P(f,d),new u.P(f,b),new u.P(c,b),new u.P(c,d)]}}lngLatToCameraDepth(e,a){const c=this.locationCoordinate(e),d=[c.x*this.worldSize,c.y*this.worldSize,a,1];return u.af(d,d,this.modelViewProjectionMatrix),d[2]/d[3]}}function Do(m,e){let a,c=!1,d=null,f=null;const b=()=>{d=null,c&&(m.apply(f,a),d=setTimeout(b,e),c=!1)};return(...k)=>(c=!0,f=this,a=k,d||b(),d)}class Bl{constructor(e){this._getCurrentHash=()=>{const a=window.location.hash.replace("#","");if(this._hashName){let c;return a.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(c=d)}),(c&&c[1]||"").split("/")}return a.split("/")},this._onHashChange=()=>{const a=this._getCurrentHash();if(a.length>=3&&!a.some(c=>isNaN(c))){const c=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:c,pitch:+(a[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const a=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,a)},this._removeHash=()=>{const a=this._getCurrentHash();if(a.length===0)return;const c=a.join("/");let d=c;d.split("&").length>0&&(d=d.split("&")[0]),this._hashName&&(d=`${this._hashName}=${c}`);let f=window.location.hash.replace(d,"");f.startsWith("#&")?f=f.slice(0,1)+f.slice(2):f==="#"&&(f="");let b=window.location.href.replace(/(#.+)?$/,f);b=b.replace("&&","&"),window.history.replaceState(window.history.state,null,b)},this._updateHash=Do(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const a=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,d=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),f=Math.pow(10,d),b=Math.round(a.lng*f)/f,k=Math.round(a.lat*f)/f,T=this._map.getBearing(),P=this._map.getPitch();let A="";if(A+=e?`/${b}/${k}/${c}`:`${c}/${k}/${b}`,(T||P)&&(A+="/"+Math.round(10*T)/10),P&&(A+=`/${Math.round(P)}`),this._hashName){const z=this._hashName;let N=!1;const Z=window.location.hash.slice(1).split("&").map(H=>{const J=H.split("=")[0];return J===z?(N=!0,`${J}=${A}`):H}).filter(H=>H);return N||Z.push(`${z}=${A}`),`#${Z.join("&")}`}return`#${A}`}}const Fl={linearity:.3,easing:u.b8(0,0,.3,1)},wc=u.e({deceleration:2500,maxSpeed:1400},Fl),Em=u.e({deceleration:20,maxSpeed:1400},Fl),jd=u.e({deceleration:1e3,maxSpeed:360},Fl),Ol=u.e({deceleration:1e3,maxSpeed:90},Fl);class bc{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:j.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,a=j.now();for(;e.length>0&&a-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,pan:new u.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:f}of this._inertiaBuffer)a.zoom+=f.zoomDelta||0,a.bearing+=f.bearingDelta||0,a.pitch+=f.pitchDelta||0,f.panDelta&&a.pan._add(f.panDelta),f.around&&(a.around=f.around),f.pinchAround&&(a.pinchAround=f.pinchAround);const c=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,d={};if(a.pan.mag()){const f=Ro(a.pan.mag(),c,u.e({},wc,e||{}));d.offset=a.pan.mult(f.amount/a.pan.mag()),d.center=this._map.transform.center,Lo(d,f)}if(a.zoom){const f=Ro(a.zoom,c,Em);d.zoom=this._map.transform.zoom+f.amount,Lo(d,f)}if(a.bearing){const f=Ro(a.bearing,c,jd);d.bearing=this._map.transform.bearing+u.ac(f.amount,-179,179),Lo(d,f)}if(a.pitch){const f=Ro(a.pitch,c,Ol);d.pitch=this._map.transform.pitch+f.amount,Lo(d,f)}if(d.zoom||d.bearing){const f=a.pinchAround===void 0?a.around:a.pinchAround;d.around=f?this._map.unproject(f):this._map.getCenter()}return this.clear(),u.e(d,{noMoveStart:!0})}}function Lo(m,e){(!m.duration||m.duration<e.duration)&&(m.duration=e.duration,m.easing=e.easing)}function Ro(m,e,a){const{maxSpeed:c,linearity:d,deceleration:f}=a,b=u.ac(m*d/(e/1e3),-c,c),k=Math.abs(b)/(f*d);return{easing:a.easing,duration:1e3*k,amount:b*(k/2)}}class Gr extends u.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,a,c,d={}){const f=L.mousePos(a.getCanvas(),c),b=a.unproject(f);super(e,u.e({point:f,lngLat:b,originalEvent:c},d)),this._defaultPrevented=!1,this.target=a}}class Ns extends u.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,a,c){const d=e==="touchend"?c.changedTouches:c.touches,f=L.touchPos(a.getCanvasContainer(),d),b=f.map(T=>a.unproject(T)),k=f.reduce((T,P,A,z)=>T.add(P.div(z.length)),new u.P(0,0));super(e,{points:f,point:k,lngLats:b,lngLat:a.unproject(k),originalEvent:c}),this._defaultPrevented=!1}}class Vd extends u.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,a,c){super(e,{originalEvent:c}),this._defaultPrevented=!1}}class Ud{constructor(e,a){this._map=e,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Vd(e.type,this._map,e))}mousedown(e,a){return this._mousedownPos=a,this._firePreventable(new Gr(e.type,this._map,e))}mouseup(e){this._map.fire(new Gr(e.type,this._map,e))}click(e,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||this._map.fire(new Gr(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Gr(e.type,this._map,e))}mouseover(e){this._map.fire(new Gr(e.type,this._map,e))}mouseout(e){this._map.fire(new Gr(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Ns(e.type,this._map,e))}touchmove(e){this._map.fire(new Ns(e.type,this._map,e))}touchend(e){this._map.fire(new Ns(e.type,this._map,e))}touchcancel(e){this._map.fire(new Ns(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class mr{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Gr(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Gr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Gr(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ci{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(u.P.convert(e),this._map.terrain)}}class zn{constructor(e,a){this._map=e,this._tr=new ci(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,a){this.isEnabled()&&e.shiftKey&&e.button===0&&(L.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(e,a){if(!this._active)return;const c=a;if(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)return;const d=this._startPos;this._lastPos=c,this._box||(this._box=L.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const f=Math.min(d.x,c.x),b=Math.max(d.x,c.x),k=Math.min(d.y,c.y),T=Math.max(d.y,c.y);L.setTransform(this._box,`translate(${f}px,${k}px)`),this._box.style.width=b-f+"px",this._box.style.height=T-k+"px"}mouseupWindow(e,a){if(!this._active||e.button!==0)return;const c=this._startPos,d=a;if(this.reset(),L.suppressClick(),c.x!==d.x||c.y!==d.y)return this._map.fire(new u.k("boxzoomend",{originalEvent:e})),{cameraAnimation:f=>f.fitScreenCoordinates(c,d,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(L.remove(this._box),this._box=null),L.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,a){return this._map.fire(new u.k(e,{originalEvent:a}))}}function Bo(m,e){if(m.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${e.length}`);const a={};for(let c=0;c<m.length;c++)a[m[c].identifier]=e[c];return a}class Sc{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,a,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),c.length===this.numTouches&&(this.centroid=function(d){const f=new u.P(0,0);for(const b of d)f._add(b);return f.div(d.length)}(a),this.touches=Bo(c,a)))}touchmove(e,a,c){if(this.aborted||!this.centroid)return;const d=Bo(c,a);for(const f in this.touches){const b=d[f];(!b||b.dist(this.touches[f])>30)&&(this.aborted=!0)}}touchend(e,a,c){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){const d=!this.aborted&&this.centroid;if(this.reset(),d)return d}}}class Nl{constructor(e){this.singleTap=new Sc(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,a,c){this.singleTap.touchstart(e,a,c)}touchmove(e,a,c){this.singleTap.touchmove(e,a,c)}touchend(e,a,c){const d=this.singleTap.touchend(e,a,c);if(d){const f=e.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(d)<30;if(f&&b||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}}}class Ea{constructor(e){this._tr=new ci(e),this._zoomIn=new Nl({numTouches:1,numTaps:2}),this._zoomOut=new Nl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,a,c){this._zoomIn.touchstart(e,a,c),this._zoomOut.touchstart(e,a,c)}touchmove(e,a,c){this._zoomIn.touchmove(e,a,c),this._zoomOut.touchmove(e,a,c)}touchend(e,a,c){const d=this._zoomIn.touchend(e,a,c),f=this._zoomOut.touchend(e,a,c),b=this._tr;return d?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:k=>k.easeTo({duration:300,zoom:b.zoom+1,around:b.unproject(d)},{originalEvent:e})}):f?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:k=>k.easeTo({duration:300,zoom:b.zoom-1,around:b.unproject(f)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ki{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const a=this._moveFunction(...e);if(a.bearingDelta||a.pitchDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(e,a){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=a.length?a[0]:a,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,a){if(!this.isEnabled())return;const c=this._lastPoint;if(!c)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const d=a.length?a[0]:a;return!this._moved&&d.dist(c)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=d,this._move(c,d))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&L.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const kc={0:1,2:2};class jl{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const a=L.mouseButton(e);this._eventButton=a}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(a,c){const d=kc[c];return a.buttons===void 0||(a.buttons&d)!==d}(e,this._eventButton)}isValidEndEvent(e){return L.mouseButton(e)===this._eventButton}}class Tc{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}const Vl=m=>{m.mousedown=m.dragStart,m.mousemoveWindow=m.dragMove,m.mouseup=m.dragEnd,m.contextmenu=e=>{e.preventDefault()}},Ic=({enable:m,clickTolerance:e,bearingDegreesPerPixelMoved:a=.8})=>{const c=new jl({checkCorrectEvent:d=>L.mouseButton(d)===0&&d.ctrlKey||L.mouseButton(d)===2});return new Ki({clickTolerance:e,move:(d,f)=>({bearingDelta:(f.x-d.x)*a}),moveStateManager:c,enable:m,assignEvents:Vl})},Ec=({enable:m,clickTolerance:e,pitchDegreesPerPixelMoved:a=-.5})=>{const c=new jl({checkCorrectEvent:d=>L.mouseButton(d)===0&&d.ctrlKey||L.mouseButton(d)===2});return new Ki({clickTolerance:e,move:(d,f)=>({pitchDelta:(f.y-d.y)*a}),moveStateManager:c,enable:m,assignEvents:Vl})};class js{constructor(e,a){this._clickTolerance=e.clickTolerance||1,this._map=a,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new u.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,a,c){return this._calculateTransform(e,a,c)}touchmove(e,a,c){if(this._active){if(!this._shouldBePrevented(c.length))return e.preventDefault(),this._calculateTransform(e,a,c);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,a,c){this._calculateTransform(e,a,c),this._active&&this._shouldBePrevented(c.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,a,c){c.length>0&&(this._active=!0);const d=Bo(c,a),f=new u.P(0,0),b=new u.P(0,0);let k=0;for(const P in d){const A=d[P],z=this._touches[P];z&&(f._add(A),b._add(A.sub(z)),k++,d[P]=A)}if(this._touches=d,this._shouldBePrevented(k)||!b.mag())return;const T=b.div(k);return this._sum._add(T),this._sum.mag()<this._clickTolerance?void 0:{around:f.div(k),panDelta:T}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ul{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,a,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([a[0],a[1]]))}touchmove(e,a,c){if(!this._firstTwoTouches)return;e.preventDefault();const[d,f]=this._firstTwoTouches,b=Fo(c,a,d),k=Fo(c,a,f);if(!b||!k)return;const T=this._aroundCenter?null:b.add(k).div(2);return this._move([b,k],T,e)}touchend(e,a,c){if(!this._firstTwoTouches)return;const[d,f]=this._firstTwoTouches,b=Fo(c,a,d),k=Fo(c,a,f);b&&k||(this._active&&L.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Fo(m,e,a){for(let c=0;c<m.length;c++)if(m[c].identifier===a)return e[c]}function Pc(m,e){return Math.log(m/e)/Math.LN2}class Cc extends Ul{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,a){const c=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Pc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Pc(this._distance,c),pinchAround:a}}}function Mc(m,e){return 180*m.angleWith(e)/Math.PI}class Ac extends Ul{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,a,c){const d=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Mc(this._vector,d),pinchAround:a}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const a=25/(Math.PI*this._minDiameter)*360,c=Mc(e,this._startVector);return Math.abs(c)<a}}function $l(m){return Math.abs(m.y)>Math.abs(m.x)}class Oo extends Ul{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,a,c){super.touchstart(e,a,c),this._currentTouchCount=c.length}_start(e){this._lastPoints=e,$l(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,a,c){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const d=e[0].sub(this._lastPoints[0]),f=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(d,f,c.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(d.y+f.y)/2*-.5}):void 0}gestureBeginsVertically(e,a,c){if(this._valid!==void 0)return this._valid;const d=e.mag()>=2,f=a.mag()>=2;if(!d&&!f)return;if(!d||!f)return this._firstMove===void 0&&(this._firstMove=c),c-this._firstMove<100&&void 0;const b=e.y>0==a.y>0;return $l(e)&&$l(a)&&b}}const $d={panStep:100,bearingStep:15,pitchStep:10};class Gn{constructor(e){this._tr=new ci(e);const a=$d;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let a=0,c=0,d=0,f=0,b=0;switch(e.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:e.shiftKey?c=-1:(e.preventDefault(),f=-1);break;case 39:e.shiftKey?c=1:(e.preventDefault(),f=1);break;case 38:e.shiftKey?d=1:(e.preventDefault(),b=-1);break;case 40:e.shiftKey?d=-1:(e.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(c=0,d=0),{cameraAnimation:k=>{const T=this._tr;k.easeTo({duration:300,easeId:"keyboardHandler",easing:Di,zoom:a?Math.round(T.zoom)+a*(e.shiftKey?2:1):T.zoom,bearing:T.bearing+c*this._bearingStep,pitch:T.pitch+d*this._pitchStep,offset:[-f*this._panStep,-b*this._panStep],center:T.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Di(m){return m*(2-m)}const zc=4.000244140625;class hi{constructor(e,a){this._onTimeout=c=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)},this._map=e,this._tr=new ci(e),this._triggerRenderFrame=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let a=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const c=j.now(),d=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,a!==0&&a%zc==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(d*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),e.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=e,this._delta-=a,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=L.mousePos(this._map.getCanvas(),e),c=this._tr;this._around=a.y>c.transform.height/2-c.transform.getHorizon()?u.N.convert(this._aroundCenter?c.center:c.unproject(a)):u.N.convert(c.center),this._aroundPoint=c.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(this._delta!==0){const T=this._type==="wheel"&&Math.abs(this._delta)>zc?this._wheelZoomRate:this._defaultZoomRate;let P=2/(1+Math.exp(-Math.abs(this._delta*T)));this._delta<0&&P!==0&&(P=1/P);const A=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(A*P))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const a=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,c=this._startZoom,d=this._easing;let f,b=!1;const k=j.now()-this._lastWheelEventTime;if(this._type==="wheel"&&c&&d&&k){const T=Math.min(k/200,1),P=d(T);f=u.y.number(c,a,P),T<1?this._frameId||(this._frameId=!0):b=!0}else f=a,b=!0;return this._active=!0,b&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!b,zoomDelta:f-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let a=u.b9;if(this._prevEase){const c=this._prevEase,d=(j.now()-c.start)/c.duration,f=c.easing(d+.01)-c.easing(d),b=.27/Math.sqrt(f*f+1e-4)*.01,k=Math.sqrt(.0729-b*b);a=u.b8(b,k,.25,1)}return this._prevEase={start:j.now(),duration:e,easing:a},a}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Vs{constructor(e,a){this._clickZoom=e,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Pm{constructor(e){this._tr=new ci(e),this.reset()}reset(){this._active=!1}dblclick(e,a){return e.preventDefault(),{cameraAnimation:c=>{c.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(a)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Cm{constructor(){this._tap=new Nl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,a,c){if(!this._swipePoint)if(this._tapTime){const d=a[0],f=e.timeStamp-this._tapTime<500,b=this._tapPoint.dist(d)<30;f&&b?c.length>0&&(this._swipePoint=d,this._swipeTouch=c[0].identifier):this.reset()}else this._tap.touchstart(e,a,c)}touchmove(e,a,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;const d=a[0],f=d.y-this._swipePoint.y;return this._swipePoint=d,e.preventDefault(),this._active=!0,{zoomDelta:f/128}}}else this._tap.touchmove(e,a,c)}touchend(e,a,c){if(this._tapTime)this._swipePoint&&c.length===0&&this.reset();else{const d=this._tap.touchend(e,a,c);d&&(this._tapTime=e.timeStamp,this._tapPoint=d)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qd{constructor(e,a,c){this._el=e,this._mousePan=a,this._touchPan=c}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Zd{constructor(e,a,c){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=a,this._mousePitch=c}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Dc{constructor(e,a,c,d){this._el=e,this._touchZoom=a,this._touchRotate=c,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Pa{constructor(e,a){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=a,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=L.create("div","maplibregl-cooperative-gesture-screen",e);let a=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(a=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const c=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),d=document.createElement("div");d.className="maplibregl-desktop-message",d.textContent=a,this._container.appendChild(d);const f=document.createElement("div");f.className="maplibregl-mobile-message",f.textContent=c,this._container.appendChild(f),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(L.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,a){this._enabled&&(this._map.fire(new u.k("cooperativegestureprevented",{gestureType:e,originalEvent:a})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Hn=m=>m.zoom||m.drag||m.pitch||m.rotate;class Xe extends u.k{}function ql(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class Lc{constructor(e,a){this.handleWindowEvent=d=>{this.handleEvent(d,`${d.type}Window`)},this.handleEvent=(d,f)=>{if(d.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const b=d.type==="renderFrame"?void 0:d,k={needsRenderFrame:!1},T={},P={},A=d.touches,z=A?this._getMapTouches(A):void 0,N=z?L.touchPos(this._map.getCanvas(),z):L.mousePos(this._map.getCanvas(),d);for(const{handlerName:J,handler:re,allowed:ne}of this._handlers){if(!re.isEnabled())continue;let se;this._blockedByActive(P,ne,J)?re.reset():re[f||d.type]&&(se=re[f||d.type](d,N,z),this.mergeHandlerResult(k,T,se,J,b),se&&se.needsRenderFrame&&this._triggerRenderFrame()),(se||re.isActive())&&(P[J]=re)}const Z={};for(const J in this._previousActiveHandlers)P[J]||(Z[J]=b);this._previousActiveHandlers=P,(Object.keys(Z).length||ql(k))&&(this._changes.push([k,T,Z]),this._triggerRenderFrame()),(Object.keys(P).length||ql(k))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:H}=k;H&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],H(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new bc(e),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(a);const c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[window,"blur",void 0]];for(const[d,f,b]of this._listeners)L.addEventListener(d,f,d===document?this.handleWindowEvent:this.handleEvent,b)}destroy(){for(const[e,a,c]of this._listeners)L.removeEventListener(e,a,e===document?this.handleWindowEvent:this.handleEvent,c)}_addDefaultHandlers(e){const a=this._map,c=a.getCanvasContainer();this._add("mapEvent",new Ud(a,e));const d=a.boxZoom=new zn(a,e);this._add("boxZoom",d),e.interactive&&e.boxZoom&&d.enable();const f=a.cooperativeGestures=new Pa(a,e.cooperativeGestures);this._add("cooperativeGestures",f),e.cooperativeGestures&&f.enable();const b=new Ea(a),k=new Pm(a);a.doubleClickZoom=new Vs(k,b),this._add("tapZoom",b),this._add("clickZoom",k),e.interactive&&e.doubleClickZoom&&a.doubleClickZoom.enable();const T=new Cm;this._add("tapDragZoom",T);const P=a.touchPitch=new Oo(a);this._add("touchPitch",P),e.interactive&&e.touchPitch&&a.touchPitch.enable(e.touchPitch);const A=Ic(e),z=Ec(e);a.dragRotate=new Zd(e,A,z),this._add("mouseRotate",A,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]),e.interactive&&e.dragRotate&&a.dragRotate.enable();const N=(({enable:se,clickTolerance:W})=>{const ue=new jl({checkCorrectEvent:pe=>L.mouseButton(pe)===0&&!pe.ctrlKey});return new Ki({clickTolerance:W,move:(pe,ye)=>({around:ye,panDelta:ye.sub(pe)}),activateOnStart:!0,moveStateManager:ue,enable:se,assignEvents:Vl})})(e),Z=new js(e,a);a.dragPan=new qd(c,N,Z),this._add("mousePan",N),this._add("touchPan",Z,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&a.dragPan.enable(e.dragPan);const H=new Ac,J=new Cc;a.touchZoomRotate=new Dc(c,J,H,T),this._add("touchRotate",H,["touchPan","touchZoom"]),this._add("touchZoom",J,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&a.touchZoomRotate.enable(e.touchZoomRotate);const re=a.scrollZoom=new hi(a,()=>this._triggerRenderFrame());this._add("scrollZoom",re,["mousePan"]),e.interactive&&e.scrollZoom&&a.scrollZoom.enable(e.scrollZoom);const ne=a.keyboard=new Gn(a);this._add("keyboard",ne),e.interactive&&e.keyboard&&a.keyboard.enable(),this._add("blockableMapEvent",new mr(a))}_add(e,a,c){this._handlers.push({handlerName:e,handler:a,allowed:c}),this._handlersById[e]=a}stop(e){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Hn(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,a,c){for(const d in e)if(d!==c&&(!a||a.indexOf(d)<0))return!0;return!1}_getMapTouches(e){const a=[];for(const c of e)this._el.contains(c.target)&&a.push(c);return a}mergeHandlerResult(e,a,c,d,f){if(!c)return;u.e(e,c);const b={handlerName:d,originalEvent:c.originalEvent||f};c.zoomDelta!==void 0&&(a.zoom=b),c.panDelta!==void 0&&(a.drag=b),c.pitchDelta!==void 0&&(a.pitch=b),c.bearingDelta!==void 0&&(a.rotate=b)}_applyChanges(){const e={},a={},c={};for(const[d,f,b]of this._changes)d.panDelta&&(e.panDelta=(e.panDelta||new u.P(0,0))._add(d.panDelta)),d.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+d.zoomDelta),d.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+d.bearingDelta),d.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+d.pitchDelta),d.around!==void 0&&(e.around=d.around),d.pinchAround!==void 0&&(e.pinchAround=d.pinchAround),d.noInertia&&(e.noInertia=d.noInertia),u.e(a,f),u.e(c,b);this._updateMapTransform(e,a,c),this._changes=[]}_updateMapTransform(e,a,c){const d=this._map,f=d._getTransformForUpdate(),b=d.terrain;if(!(ql(e)||b&&this._terrainMovement))return this._fireEvents(a,c,!0);let{panDelta:k,zoomDelta:T,bearingDelta:P,pitchDelta:A,around:z,pinchAround:N}=e;N!==void 0&&(z=N),d._stop(!0),z=z||d.transform.centerPoint;const Z=f.pointLocation(k?z.sub(k):z);P&&(f.bearing+=P),A&&(f.pitch+=A),T&&(f.zoom+=T),b?this._terrainMovement||!a.drag&&!a.zoom?a.drag&&this._terrainMovement?f.center=f.pointLocation(f.centerPoint.sub(k)):f.setLocationAtPoint(Z,z):(this._terrainMovement=!0,this._map._elevationFreeze=!0,f.setLocationAtPoint(Z,z)):f.setLocationAtPoint(Z,z),d._applyUpdatedTransform(f),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(a,c,!0)}_fireEvents(e,a,c){const d=Hn(this._eventsInProgress),f=Hn(e),b={};for(const z in e){const{originalEvent:N}=e[z];this._eventsInProgress[z]||(b[`${z}start`]=N),this._eventsInProgress[z]=e[z]}!d&&f&&this._fireEvent("movestart",f.originalEvent);for(const z in b)this._fireEvent(z,b[z]);f&&this._fireEvent("move",f.originalEvent);for(const z in e){const{originalEvent:N}=e[z];this._fireEvent(z,N)}const k={};let T;for(const z in this._eventsInProgress){const{handlerName:N,originalEvent:Z}=this._eventsInProgress[z];this._handlersById[N].isActive()||(delete this._eventsInProgress[z],T=a[N]||Z,k[`${z}end`]=T)}for(const z in k)this._fireEvent(z,k[z]);const P=Hn(this._eventsInProgress),A=(d||f)&&!P;if(A&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const z=this._map._getTransformForUpdate();z.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(z)}if(c&&A){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=Z=>Z!==0&&-this._bearingSnap<Z&&Z<this._bearingSnap;!z||!z.essential&&j.prefersReducedMotion?(this._map.fire(new u.k("moveend",{originalEvent:T})),N(this._map.getBearing())&&this._map.resetNorth()):(N(z.bearing||this._map.getBearing())&&(z.bearing=0),z.freezeElevation=!0,this._map.easeTo(z,{originalEvent:T})),this._updatingCamera=!1}}_fireEvent(e,a){this._map.fire(new u.k(e,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new Xe("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Gd extends u.E{constructor(e,a){super(),this._renderFrameCallback=()=>{const c=Math.min((j.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=a.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new u.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,a){return this.jumpTo({center:e},a)}panBy(e,a,c){return e=u.P.convert(e).mult(-1),this.panTo(this.transform.center,u.e({offset:e},a),c)}panTo(e,a,c){return this.easeTo(u.e({center:e},a),c)}getZoom(){return this.transform.zoom}setZoom(e,a){return this.jumpTo({zoom:e},a),this}zoomTo(e,a,c){return this.easeTo(u.e({zoom:e},a),c)}zoomIn(e,a){return this.zoomTo(this.getZoom()+1,e,a),this}zoomOut(e,a){return this.zoomTo(this.getZoom()-1,e,a),this}getBearing(){return this.transform.bearing}setBearing(e,a){return this.jumpTo({bearing:e},a),this}getPadding(){return this.transform.padding}setPadding(e,a){return this.jumpTo({padding:e},a),this}rotateTo(e,a,c){return this.easeTo(u.e({bearing:e},a),c)}resetNorth(e,a){return this.rotateTo(0,u.e({duration:1e3},e),a),this}resetNorthPitch(e,a){return this.easeTo(u.e({bearing:0,pitch:0,duration:1e3},e),a),this}snapToNorth(e,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,a):this}getPitch(){return this.transform.pitch}setPitch(e,a){return this.jumpTo({pitch:e},a),this}cameraForBounds(e,a){e=we.convert(e).adjustAntiMeridian();const c=a&&a.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),c,a)}_cameraForBoxAndBearing(e,a,c,d){const f={top:0,bottom:0,right:0,left:0};if(typeof(d=u.e({padding:f,offset:[0,0],maxZoom:this.transform.maxZoom},d)).padding=="number"){const Oe=d.padding;d.padding={top:Oe,bottom:Oe,right:Oe,left:Oe}}d.padding=u.e(f,d.padding);const b=this.transform,k=b.padding,T=new we(e,a),P=b.project(T.getNorthWest()),A=b.project(T.getNorthEast()),z=b.project(T.getSouthEast()),N=b.project(T.getSouthWest()),Z=u.ba(-c),H=P.rotate(Z),J=A.rotate(Z),re=z.rotate(Z),ne=N.rotate(Z),se=new u.P(Math.max(H.x,J.x,ne.x,re.x),Math.max(H.y,J.y,ne.y,re.y)),W=new u.P(Math.min(H.x,J.x,ne.x,re.x),Math.min(H.y,J.y,ne.y,re.y)),ue=se.sub(W),pe=(b.width-(k.left+k.right+d.padding.left+d.padding.right))/ue.x,ye=(b.height-(k.top+k.bottom+d.padding.top+d.padding.bottom))/ue.y;if(ye<0||pe<0)return void u.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Me=Math.min(b.scaleZoom(b.scale*Math.min(pe,ye)),d.maxZoom),De=u.P.convert(d.offset),$e=new u.P((d.padding.left-d.padding.right)/2,(d.padding.top-d.padding.bottom)/2).rotate(u.ba(c)),Ke=De.add($e).mult(b.scale/b.zoomScale(Me));return{center:b.unproject(P.add(z).div(2).sub(Ke)),zoom:Me,bearing:c}}fitBounds(e,a,c){return this._fitInternal(this.cameraForBounds(e,a),a,c)}fitScreenCoordinates(e,a,c,d,f){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(u.P.convert(e)),this.transform.pointLocation(u.P.convert(a)),c,d),d,f)}_fitInternal(e,a,c){return e?(delete(a=u.e(e,a)).padding,a.linear?this.easeTo(a,c):this.flyTo(a,c)):this}jumpTo(e,a){this.stop();const c=this._getTransformForUpdate();let d=!1,f=!1,b=!1;return"zoom"in e&&c.zoom!==+e.zoom&&(d=!0,c.zoom=+e.zoom),e.center!==void 0&&(c.center=u.N.convert(e.center)),"bearing"in e&&c.bearing!==+e.bearing&&(f=!0,c.bearing=+e.bearing),"pitch"in e&&c.pitch!==+e.pitch&&(b=!0,c.pitch=+e.pitch),e.padding==null||c.isPaddingEqual(e.padding)||(c.padding=e.padding),this._applyUpdatedTransform(c),this.fire(new u.k("movestart",a)).fire(new u.k("move",a)),d&&this.fire(new u.k("zoomstart",a)).fire(new u.k("zoom",a)).fire(new u.k("zoomend",a)),f&&this.fire(new u.k("rotatestart",a)).fire(new u.k("rotate",a)).fire(new u.k("rotateend",a)),b&&this.fire(new u.k("pitchstart",a)).fire(new u.k("pitch",a)).fire(new u.k("pitchend",a)),this.fire(new u.k("moveend",a))}calculateCameraOptionsFromTo(e,a,c,d=0){const f=u.Z.fromLngLat(e,a),b=u.Z.fromLngLat(c,d),k=b.x-f.x,T=b.y-f.y,P=b.z-f.z,A=Math.hypot(k,T,P);if(A===0)throw new Error("Can't calculate camera options with same From and To");const z=Math.hypot(k,T),N=this.transform.scaleZoom(this.transform.cameraToCenterDistance/A/this.transform.tileSize),Z=180*Math.atan2(k,-T)/Math.PI;let H=180*Math.acos(z/A)/Math.PI;return H=P<0?90-H:90+H,{center:b.toLngLat(),zoom:N,pitch:H,bearing:Z}}easeTo(e,a){var c;this._stop(!1,e.easeId),((e=u.e({offset:[0,0],duration:500,easing:u.b9},e)).animate===!1||!e.essential&&j.prefersReducedMotion)&&(e.duration=0);const d=this._getTransformForUpdate(),f=d.zoom,b=d.bearing,k=d.pitch,T=d.padding,P="bearing"in e?this._normalizeBearing(e.bearing,b):b,A="pitch"in e?+e.pitch:k,z="padding"in e?e.padding:d.padding,N=u.P.convert(e.offset);let Z=d.centerPoint.add(N);const H=d.pointLocation(Z),{center:J,zoom:re}=d.getConstrained(u.N.convert(e.center||H),(c=e.zoom)!==null&&c!==void 0?c:f);this._normalizeCenter(J,d);const ne=d.project(H),se=d.project(J).sub(ne),W=d.zoomScale(re-f);let ue,pe;e.around&&(ue=u.N.convert(e.around),pe=d.locationPoint(ue));const ye={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||re!==f,this._rotating=this._rotating||b!==P,this._pitching=this._pitching||A!==k,this._padding=!d.isPaddingEqual(z),this._easeId=e.easeId,this._prepareEase(a,e.noMoveStart,ye),this.terrain&&this._prepareElevation(J),this._ease(Me=>{if(this._zooming&&(d.zoom=u.y.number(f,re,Me)),this._rotating&&(d.bearing=u.y.number(b,P,Me)),this._pitching&&(d.pitch=u.y.number(k,A,Me)),this._padding&&(d.interpolatePadding(T,z,Me),Z=d.centerPoint.add(N)),this.terrain&&!e.freezeElevation&&this._updateElevation(Me),ue)d.setLocationAtPoint(ue,pe);else{const De=d.zoomScale(d.zoom-f),$e=re>f?Math.min(2,W):Math.max(.5,W),Ke=Math.pow($e,1-Me),Oe=d.unproject(ne.add(se.mult(Me*Ke)).mult(De));d.setLocationAtPoint(d.renderWorldCopies?Oe.wrap():Oe,Z)}this._applyUpdatedTransform(d),this._fireMoveEvents(a)},Me=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(a,Me)},e),this}_prepareEase(e,a,c={}){this._moving=!0,a||c.moving||this.fire(new u.k("movestart",e)),this._zooming&&!c.zooming&&this.fire(new u.k("zoomstart",e)),this._rotating&&!c.rotating&&this.fire(new u.k("rotatestart",e)),this._pitching&&!c.pitching&&this.fire(new u.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const a=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&a!==this._elevationTarget){const c=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(c-(a-(c*e+this._elevationStart))/(1-e)),this._elevationTarget=a}this.transform.elevation=u.y.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){const a=e.getCameraPosition(),c=this.terrain.getElevationForLngLatZoom(a.lngLat,e.zoom);if(a.altitude<c){const d=this.calculateCameraOptionsFromTo(a.lngLat,c,e.center,e.elevation);return{pitch:d.pitch,zoom:d.zoom}}return{}}_applyUpdatedTransform(e){const a=[];if(this.terrain&&a.push(d=>this._elevateCameraIfInsideTerrain(d)),this.transformCameraUpdate&&a.push(d=>this.transformCameraUpdate(d)),!a.length)return;const c=e.clone();for(const d of a){const f=c.clone(),{center:b,zoom:k,pitch:T,bearing:P,elevation:A}=d(f);b&&(f.center=b),k!==void 0&&(f.zoom=k),T!==void 0&&(f.pitch=T),P!==void 0&&(f.bearing=P),A!==void 0&&(f.elevation=A),c.apply(f)}this.transform.apply(c)}_fireMoveEvents(e){this.fire(new u.k("move",e)),this._zooming&&this.fire(new u.k("zoom",e)),this._rotating&&this.fire(new u.k("rotate",e)),this._pitching&&this.fire(new u.k("pitch",e))}_afterEase(e,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId;const c=this._zooming,d=this._rotating,f=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,c&&this.fire(new u.k("zoomend",e)),d&&this.fire(new u.k("rotateend",e)),f&&this.fire(new u.k("pitchend",e)),this.fire(new u.k("moveend",e))}flyTo(e,a){var c;if(!e.essential&&j.prefersReducedMotion){const Ze=u.M(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ze,a)}this.stop(),e=u.e({offset:[0,0],speed:1.2,curve:1.42,easing:u.b9},e);const d=this._getTransformForUpdate(),f=d.zoom,b=d.bearing,k=d.pitch,T=d.padding,P="bearing"in e?this._normalizeBearing(e.bearing,b):b,A="pitch"in e?+e.pitch:k,z="padding"in e?e.padding:d.padding,N=u.P.convert(e.offset);let Z=d.centerPoint.add(N);const H=d.pointLocation(Z),{center:J,zoom:re}=d.getConstrained(u.N.convert(e.center||H),(c=e.zoom)!==null&&c!==void 0?c:f);this._normalizeCenter(J,d);const ne=d.zoomScale(re-f),se=d.project(H),W=d.project(J).sub(se);let ue=e.curve;const pe=Math.max(d.width,d.height),ye=pe/ne,Me=W.mag();if("minZoom"in e){const Ze=u.ac(Math.min(e.minZoom,f,re),d.minZoom,d.maxZoom),ft=pe/d.zoomScale(Ze-f);ue=Math.sqrt(ft/Me*2)}const De=ue*ue;function $e(Ze){const ft=(ye*ye-pe*pe+(Ze?-1:1)*De*De*Me*Me)/(2*(Ze?ye:pe)*De*Me);return Math.log(Math.sqrt(ft*ft+1)-ft)}function Ke(Ze){return(Math.exp(Ze)-Math.exp(-Ze))/2}function Oe(Ze){return(Math.exp(Ze)+Math.exp(-Ze))/2}const Fe=$e(!1);let et=function(Ze){return Oe(Fe)/Oe(Fe+ue*Ze)},gt=function(Ze){return pe*((Oe(Fe)*(Ke(ft=Fe+ue*Ze)/Oe(ft))-Ke(Fe))/De)/Me;var ft},je=($e(!0)-Fe)/ue;if(Math.abs(Me)<1e-6||!isFinite(je)){if(Math.abs(pe-ye)<1e-6)return this.easeTo(e,a);const Ze=ye<pe?-1:1;je=Math.abs(Math.log(ye/pe))/ue,gt=()=>0,et=ft=>Math.exp(Ze*ue*ft)}return e.duration="duration"in e?+e.duration:1e3*je/("screenSpeed"in e?+e.screenSpeed/ue:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=b!==P,this._pitching=A!==k,this._padding=!d.isPaddingEqual(z),this._prepareEase(a,!1),this.terrain&&this._prepareElevation(J),this._ease(Ze=>{const ft=Ze*je,tr=1/et(ft);d.zoom=Ze===1?re:f+d.scaleZoom(tr),this._rotating&&(d.bearing=u.y.number(b,P,Ze)),this._pitching&&(d.pitch=u.y.number(k,A,Ze)),this._padding&&(d.interpolatePadding(T,z,Ze),Z=d.centerPoint.add(N)),this.terrain&&!e.freezeElevation&&this._updateElevation(Ze);const wt=Ze===1?J:d.unproject(se.add(W.mult(gt(ft))).mult(tr));d.setLocationAtPoint(d.renderWorldCopies?wt.wrap():wt,Z),this._applyUpdatedTransform(d),this._fireMoveEvents(a)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(a)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,a){var c;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const d=this._onEaseEnd;delete this._onEaseEnd,d.call(this,a)}return e||(c=this.handlers)===null||c===void 0||c.stop(!1),this}_ease(e,a,c){c.animate===!1||c.duration===0?(e(1),a()):(this._easeStart=j.now(),this._easeOptions=c,this._onEaseFrame=e,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,a){e=u.b3(e,-180,180);const c=Math.abs(e-a);return Math.abs(e-360-a)<c&&(e-=360),Math.abs(e+360-a)<c&&(e+=360),e}_normalizeCenter(e,a){if(!a.renderWorldCopies||a.lngRange)return;const c=e.lng-a.center.lng;e.lng+=c>180?-360:c<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(u.N.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}const Ca={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Ma{constructor(e=Ca){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=a=>{!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"&&a.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=L.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=L.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=L.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){L.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,a){const c=this._map._getUIString(`AttributionControl.${a}`);e.title=c,e.setAttribute("aria-label",c)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(d=>typeof d!="string"?"":d)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}const a=this._map.style.sourceCaches;for(const d in a){const f=a[d];if(f.used||f.usedForTerrain){const b=f.getSource();b.attribution&&e.indexOf(b.attribution)<0&&e.push(b.attribution)}}e=e.filter(d=>String(d).trim()),e.sort((d,f)=>d.length-f.length),e=e.filter((d,f)=>{for(let b=f+1;b<e.length;b++)if(e[b].indexOf(d)>=0)return!1;return!0});const c=e.join(" | ");c!==this._attribHTML&&(this._attribHTML=c,e.length?(this._innerContainer.innerHTML=c,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Rc{constructor(e={}){this._updateCompact=()=>{const a=this._container.children;if(a.length){const c=a[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&c.classList.add("maplibregl-compact"):c.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=L.create("div","maplibregl-ctrl");const a=L.create("a","maplibregl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://maplibre.org/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){L.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Ct{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const a=++this._id;return this._queue.push({callback:e,id:a,cancelled:!1}),a}remove(e){const a=this._currentlyRunning,c=a?this._queue.concat(a):this._queue;for(const d of c)if(d.id===e)return void(d.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const a=this._currentlyRunning=this._queue;this._queue=[];for(const c of a)if(!c.cancelled&&(c.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Bc=u.Y([{name:"a_pos3d",type:"Int16",components:3}]);class Mm extends u.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,a){this.sourceCache.update(e,a),this._renderableTilesKeys=[];const c={};for(const d of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:a}))c[d.key]=!0,this._renderableTilesKeys.push(d.key),this._tiles[d.key]||(d.posMatrix=new Float64Array(16),u.aP(d.posMatrix,0,u.X,0,u.X,0,1),this._tiles[d.key]=new us(d,this.tileSize));for(const d in this._tiles)c[d]||delete this._tiles[d]}freeRtt(e){for(const a in this._tiles){const c=this._tiles[a];(!e||c.tileID.equals(e)||c.tileID.isChildOf(e)||e.isChildOf(c.tileID))&&(c.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const a={};for(const c of this._renderableTilesKeys){const d=this._tiles[c].tileID;if(d.canonical.equals(e.canonical)){const f=e.clone();f.posMatrix=new Float64Array(16),u.aP(f.posMatrix,0,u.X,0,u.X,0,1),a[c]=f}else if(d.canonical.isChildOf(e.canonical)){const f=e.clone();f.posMatrix=new Float64Array(16);const b=d.canonical.z-e.canonical.z,k=d.canonical.x-(d.canonical.x>>b<<b),T=d.canonical.y-(d.canonical.y>>b<<b),P=u.X>>b;u.aP(f.posMatrix,0,P,0,P,0,1),u.J(f.posMatrix,f.posMatrix,[-k*P,-T*P,0]),a[c]=f}else if(e.canonical.isChildOf(d.canonical)){const f=e.clone();f.posMatrix=new Float64Array(16);const b=e.canonical.z-d.canonical.z,k=e.canonical.x-(e.canonical.x>>b<<b),T=e.canonical.y-(e.canonical.y>>b<<b),P=u.X>>b;u.aP(f.posMatrix,0,u.X,0,u.X,0,1),u.J(f.posMatrix,f.posMatrix,[k*P,T*P,0]),u.K(f.posMatrix,f.posMatrix,[1/2**b,1/2**b,0]),a[c]=f}}return a}getSourceTile(e,a){const c=this.sourceCache._source;let d=e.overscaledZ-this.deltaZoom;if(d>c.maxzoom&&(d=c.maxzoom),d<c.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(d).key);let f=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!f||!f.dem)&&a)for(;d>=c.minzoom&&(!f||!f.dem);)f=this.sourceCache.getTileByID(e.scaledTo(d--).key);return f}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(a=>a.timeAdded>=e)}}class Fc{constructor(e,a,c){this.painter=e,this.sourceCache=new Mm(a),this.options=c,this.exaggeration=typeof c.exaggeration=="number"?c.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,a,c,d=u.X){var f;if(!(a>=0&&a<d&&c>=0&&c<d))return 0;const b=this.getTerrainData(e),k=(f=b.tile)===null||f===void 0?void 0:f.dem;if(!k)return 0;const T=function(H,J,re){var ne=J[0],se=J[1];return H[0]=re[0]*ne+re[4]*se+re[12],H[1]=re[1]*ne+re[5]*se+re[13],H}([],[a/d*u.X,c/d*u.X],b.u_terrain_matrix),P=[T[0]*k.dim,T[1]*k.dim],A=Math.floor(P[0]),z=Math.floor(P[1]),N=P[0]-A,Z=P[1]-z;return k.get(A,z)*(1-N)*(1-Z)+k.get(A+1,z)*N*(1-Z)+k.get(A,z+1)*(1-N)*Z+k.get(A+1,z+1)*N*Z}getElevationForLngLatZoom(e,a){if(!u.bb(a,e.wrap()))return 0;const{tileID:c,mercatorX:d,mercatorY:f}=this._getOverscaledTileIDFromLngLatZoom(e,a);return this.getElevation(c,d%u.X,f%u.X,u.X)}getElevation(e,a,c,d=u.X){return this.getDEMElevation(e,a,c,d)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const d=this.painter.context,f=new u.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Ye(d,f,d.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Ye(d,new u.R({width:1,height:1}),d.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=u.an([])}const a=this.sourceCache.getSourceTile(e,!0);if(a&&a.dem&&(!a.demTexture||a.needsTerrainPrepare)){const d=this.painter.context;a.demTexture=this.painter.getTileTexture(a.dem.stride),a.demTexture?a.demTexture.update(a.dem.getPixels(),{premultiply:!1}):a.demTexture=new Ye(d,a.dem.getPixels(),d.gl.RGBA,{premultiply:!1}),a.demTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),a.needsTerrainPrepare=!1}const c=a&&a+a.tileID.key+e.key;if(c&&!this._demMatrixCache[c]){const d=this.sourceCache.sourceCache._source.maxzoom;let f=e.canonical.z-a.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=d?f=e.canonical.z-d:u.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const b=e.canonical.x-(e.canonical.x>>f<<f),k=e.canonical.y-(e.canonical.y>>f<<f),T=u.bc(new Float64Array(16),[1/(u.X<<f),1/(u.X<<f),0]);u.J(T,T,[b*u.X,k*u.X,0]),this._demMatrixCache[e.key]={matrix:T,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:a&&a.dem&&a.dem.dim||1,u_terrain_matrix:c?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:a&&a.dem&&a.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(a&&a.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:a}}getFramebuffer(e){const a=this.painter,c=a.width/devicePixelRatio,d=a.height/devicePixelRatio;return!this._fbo||this._fbo.width===c&&this._fbo.height===d||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Ye(a.context,{width:c,height:d,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Ye(a.context,{width:c,height:d,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=a.context.createFramebuffer(c,d,!0,!1),this._fbo.depthAttachment.set(a.context.createRenderbuffer(a.context.gl.DEPTH_COMPONENT16,c,d))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const a=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let f=0,b=0;f<this._coordsTextureSize;f++)for(let k=0;k<this._coordsTextureSize;k++,b+=4)a[b+0]=255&k,a[b+1]=255&f,a[b+2]=k>>8<<4|f>>8,a[b+3]=0;const c=new u.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(a.buffer)),d=new Ye(e,c,e.gl.RGBA,{premultiply:!1});return d.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=d,d}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const a=new Uint8Array(4),c=this.painter.context,d=c.gl,f=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),b=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),k=Math.round(this.painter.height/devicePixelRatio);c.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),d.readPixels(f,k-b-1,1,1,d.RGBA,d.UNSIGNED_BYTE,a),c.bindFramebuffer.set(null);const T=a[0]+(a[2]>>4<<8),P=a[1]+((15&a[2])<<8),A=this.coordsIndex[255-a[3]],z=A&&this.sourceCache.getTileByID(A);if(!z)return null;const N=this._coordsTextureSize,Z=(1<<z.tileID.canonical.z)*N;return new u.Z((z.tileID.canonical.x*N+T)/Z+z.tileID.wrap,(z.tileID.canonical.y*N+P)/Z,this.getElevation(z.tileID,T,P,N))}depthAtPoint(e){const a=new Uint8Array(4),c=this.painter.context,d=c.gl;return c.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),d.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,d.RGBA,d.UNSIGNED_BYTE,a),c.bindFramebuffer.set(null),(a[0]/16777216+a[1]/65536+a[2]/256+a[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,a=new u.bd,c=new u.aY,d=this.meshSize,f=u.X/d,b=d*d;for(let z=0;z<=d;z++)for(let N=0;N<=d;N++)a.emplaceBack(N*f,z*f,0);for(let z=0;z<b;z+=d+1)for(let N=0;N<d;N++)c.emplaceBack(N+z,d+N+z+1,d+N+z+2),c.emplaceBack(N+z,d+N+z+2,N+z+1);const k=a.length,T=k+2*(d+1);for(const z of[0,1])for(let N=0;N<=d;N++)for(const Z of[0,1])a.emplaceBack(N*f,z*u.X,Z);for(let z=0;z<2*d;z+=2)c.emplaceBack(T+z,T+z+1,T+z+3),c.emplaceBack(T+z,T+z+3,T+z+2),c.emplaceBack(k+z,k+z+3,k+z+1),c.emplaceBack(k+z,k+z+2,k+z+3);const P=a.length,A=P+2*(d+1);for(const z of[0,1])for(let N=0;N<=d;N++)for(const Z of[0,1])a.emplaceBack(z*u.X,N*f,Z);for(let z=0;z<2*d;z+=2)c.emplaceBack(P+z,P+z+1,P+z+3),c.emplaceBack(P+z,P+z+3,P+z+2),c.emplaceBack(A+z,A+z+3,A+z+1),c.emplaceBack(A+z,A+z+2,A+z+3);return this._mesh=new Ll(e.createVertexBuffer(a,Bc.members),e.createIndexBuffer(c),u.a0.simpleSegment(0,0,a.length,c.length)),this._mesh}getMeshFrameDelta(e){return 2*Math.PI*u.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,a){var c;const{tileID:d}=this._getOverscaledTileIDFromLngLatZoom(e,a);return(c=this.getMinMaxElevation(d).minElevation)!==null&&c!==void 0?c:0}getMinMaxElevation(e){const a=this.getTerrainData(e).tile,c={minElevation:null,maxElevation:null};return a&&a.dem&&(c.minElevation=a.dem.min*this.exaggeration,c.maxElevation=a.dem.max*this.exaggeration),c}_getOverscaledTileIDFromLngLatZoom(e,a){const c=u.Z.fromLngLat(e.wrap()),d=(1<<a)*u.X,f=c.x*d,b=c.y*d,k=Math.floor(f/u.X),T=Math.floor(b/u.X);return{tileID:new u.S(a,0,a,k,T),mercatorX:f,mercatorY:b}}}class Am{constructor(e,a,c){this._context=e,this._size=a,this._tileSize=c,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const a=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),c=new Ye(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return c.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),a.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),a.colorAttachment.set(c.texture),{id:e,fbo:a,texture:c,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(a=>e.id!==a),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const a of this._recentlyUsed)if(!this._objects[a].inUse)return this._objects[a];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const Aa={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Hd{constructor(e,a){this.painter=e,this.terrain=a,this.pool=new Am(e.context,30,a.sourceCache.tileSize*a.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,a){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(c=>!e._layers[c].isHidden(a)),this._coordsDescendingInv={};for(const c in e.sourceCaches){this._coordsDescendingInv[c]={};const d=e.sourceCaches[c].getVisibleCoordinates();for(const f of d){const b=this.terrain.sourceCache.getTerrainCoords(f);for(const k in b)this._coordsDescendingInv[c][k]||(this._coordsDescendingInv[c][k]=[]),this._coordsDescendingInv[c][k].push(b[k])}}this._coordsDescendingInvStr={};for(const c of e._order){const d=e._layers[c],f=d.source;if(Aa[d.type]&&!this._coordsDescendingInvStr[f]){this._coordsDescendingInvStr[f]={};for(const b in this._coordsDescendingInv[f])this._coordsDescendingInvStr[f][b]=this._coordsDescendingInv[f][b].map(k=>k.key).sort().join()}}for(const c of this._renderableTiles)for(const d in this._coordsDescendingInvStr){const f=this._coordsDescendingInvStr[d][c.tileID.key];f&&f!==c.rttCoords[d]&&(c.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const a=e.type,c=this.painter,d=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(Aa[a]&&(this._prevType&&Aa[this._prevType]||this._stacks.push([]),this._prevType=a,this._stacks[this._stacks.length-1].push(e.id),!d))return!0;if(Aa[this._prevType]||Aa[a]&&d){this._prevType=a;const f=this._stacks.length-1,b=this._stacks[f]||[];for(const k of this._renderableTiles){if(this.pool.isFull()&&(Nd(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(k),k.rtt[f]){const P=this.pool.getObjectForId(k.rtt[f].id);if(P.stamp===k.rtt[f].stamp){this.pool.useObject(P);continue}}const T=this.pool.getOrCreateFreeObject();this.pool.useObject(T),this.pool.stampObject(T),k.rtt[f]={id:T.id,stamp:T.stamp},c.context.bindFramebuffer.set(T.fbo.framebuffer),c.context.clear({color:u.aM.transparent,stencil:0}),c.currentStencilSource=void 0;for(let P=0;P<b.length;P++){const A=c.style._layers[b[P]],z=A.source?this._coordsDescendingInv[A.source][k.tileID.key]:[k.tileID];c.context.viewport.set([0,0,T.fbo.width,T.fbo.height]),c._renderTileClippingMasks(A,z),c.renderLayer(c,c.style.sourceCaches[A.source],A,z),A.source&&(k.rttCoords[A.source]=this._coordsDescendingInvStr[A.source][k.tileID.key])}}return Nd(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Aa[a]}return!1}}const Oc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Kd=C,zm={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Ca,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:u.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},Nc=m=>{m.touchstart=m.dragStart,m.touchmoveWindow=m.dragMove,m.touchend=m.dragEnd},Dm={showCompass:!0,showZoom:!0,visualizePitch:!1};class Lm{constructor(e,a,c=!1){this.mousedown=b=>{this.startMouse(u.e({},b,{ctrlKey:!0,preventDefault:()=>b.preventDefault()}),L.mousePos(this.element,b)),L.addEventListener(window,"mousemove",this.mousemove),L.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=b=>{this.moveMouse(b,L.mousePos(this.element,b))},this.mouseup=b=>{this.mouseRotate.dragEnd(b),this.mousePitch&&this.mousePitch.dragEnd(b),this.offTemp()},this.touchstart=b=>{b.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=L.touchPos(this.element,b.targetTouches)[0],this.startTouch(b,this._startPos),L.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),L.addEventListener(window,"touchend",this.touchend))},this.touchmove=b=>{b.targetTouches.length!==1?this.reset():(this._lastPos=L.touchPos(this.element,b.targetTouches)[0],this.moveTouch(b,this._lastPos))},this.touchend=b=>{b.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const d=e.dragRotate._mouseRotate.getClickTolerance(),f=e.dragRotate._mousePitch.getClickTolerance();this.element=a,this.mouseRotate=Ic({clickTolerance:d,enable:!0}),this.touchRotate=(({enable:b,clickTolerance:k,bearingDegreesPerPixelMoved:T=.8})=>{const P=new Tc;return new Ki({clickTolerance:k,move:(A,z)=>({bearingDelta:(z.x-A.x)*T}),moveStateManager:P,enable:b,assignEvents:Nc})})({clickTolerance:d,enable:!0}),this.map=e,c&&(this.mousePitch=Ec({clickTolerance:f,enable:!0}),this.touchPitch=(({enable:b,clickTolerance:k,pitchDegreesPerPixelMoved:T=-.5})=>{const P=new Tc;return new Ki({clickTolerance:k,move:(A,z)=>({pitchDelta:(z.y-A.y)*T}),moveStateManager:P,enable:b,assignEvents:Nc})})({clickTolerance:f,enable:!0})),L.addEventListener(a,"mousedown",this.mousedown),L.addEventListener(a,"touchstart",this.touchstart,{passive:!1}),L.addEventListener(a,"touchcancel",this.reset)}startMouse(e,a){this.mouseRotate.dragStart(e,a),this.mousePitch&&this.mousePitch.dragStart(e,a),L.disableDrag()}startTouch(e,a){this.touchRotate.dragStart(e,a),this.touchPitch&&this.touchPitch.dragStart(e,a),L.disableDrag()}moveMouse(e,a){const c=this.map,{bearingDelta:d}=this.mouseRotate.dragMove(e,a)||{};if(d&&c.setBearing(c.getBearing()+d),this.mousePitch){const{pitchDelta:f}=this.mousePitch.dragMove(e,a)||{};f&&c.setPitch(c.getPitch()+f)}}moveTouch(e,a){const c=this.map,{bearingDelta:d}=this.touchRotate.dragMove(e,a)||{};if(d&&c.setBearing(c.getBearing()+d),this.touchPitch){const{pitchDelta:f}=this.touchPitch.dragMove(e,a)||{};f&&c.setPitch(c.getPitch()+f)}}off(){const e=this.element;L.removeEventListener(e,"mousedown",this.mousedown),L.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),L.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),L.removeEventListener(window,"touchend",this.touchend),L.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){L.enableDrag(),L.removeEventListener(window,"mousemove",this.mousemove),L.removeEventListener(window,"mouseup",this.mouseup),L.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),L.removeEventListener(window,"touchend",this.touchend)}}let Dn;function er(m,e,a){const c=new u.N(m.lng,m.lat);if(m=new u.N(m.lng,m.lat),e){const d=new u.N(m.lng-360,m.lat),f=new u.N(m.lng+360,m.lat),b=a.locationPoint(m).distSqr(e);a.locationPoint(d).distSqr(e)<b?m=d:a.locationPoint(f).distSqr(e)<b&&(m=f)}for(;Math.abs(m.lng-a.center.lng)>180;){const d=a.locationPoint(m);if(d.x>=0&&d.y>=0&&d.x<=a.width&&d.y<=a.height)break;m.lng>a.center.lng?m.lng-=360:m.lng+=360}return m.lng!==c.lng&&a.locationPoint(m).y>a.height/2-a.getHorizon()?m:c}const za={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Zl(m,e,a){const c=m.classList;for(const d in za)c.remove(`maplibregl-${a}-anchor-${d}`);c.add(`maplibregl-${a}-anchor-${e}`)}class Gl extends u.E{constructor(e){if(super(),this._onKeyPress=a=>{const c=a.code,d=a.charCode||a.keyCode;c!=="Space"&&c!=="Enter"&&d!==32&&d!==13||this.togglePopup()},this._onMapClick=a=>{const c=a.originalEvent.target,d=this._element;this._popup&&(c===d||d.contains(c))&&this.togglePopup()},this._update=a=>{var c;if(!this._map)return;const d=this._map.loaded()&&!this._map.isMoving();((a==null?void 0:a.type)==="terrain"||(a==null?void 0:a.type)==="render"&&!d)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?er(this._lngLat,this._flatPos,this._map.transform):(c=this._lngLat)===null||c===void 0?void 0:c.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let f="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?f=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(f=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let b="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?b="rotateX(0deg)":this._pitchAlignment==="map"&&(b=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||a&&a.type!=="moveend"||(this._pos=this._pos.round()),L.setTransform(this._element,`${za[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${b} ${f}`),j.frameAsync(new AbortController).then(()=>{this._updateOpacity(a&&a.type==="moveend")}).catch(()=>{})},this._onMove=a=>{if(!this._isDragging){const c=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=c}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new u.k("dragstart"))),this.fire(new u.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new u.k("dragend")),this._state="inactive"},this._addDragHandler=a=>{this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=u.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=L.create("div");const a=L.createNS("http://www.w3.org/2000/svg","svg"),c=41,d=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${c}px`),a.setAttributeNS(null,"width",`${d}px`),a.setAttributeNS(null,"viewBox",`0 0 ${d} ${c}`);const f=L.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"stroke","none"),f.setAttributeNS(null,"stroke-width","1"),f.setAttributeNS(null,"fill","none"),f.setAttributeNS(null,"fill-rule","evenodd");const b=L.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"fill-rule","nonzero");const k=L.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"transform","translate(3.0, 29.0)"),k.setAttributeNS(null,"fill","#000000");const T=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ne of T){const se=L.createNS("http://www.w3.org/2000/svg","ellipse");se.setAttributeNS(null,"opacity","0.04"),se.setAttributeNS(null,"cx","10.5"),se.setAttributeNS(null,"cy","5.80029008"),se.setAttributeNS(null,"rx",ne.rx),se.setAttributeNS(null,"ry",ne.ry),k.appendChild(se)}const P=L.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill",this._color);const A=L.createNS("http://www.w3.org/2000/svg","path");A.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),P.appendChild(A);const z=L.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"opacity","0.25"),z.setAttributeNS(null,"fill","#000000");const N=L.createNS("http://www.w3.org/2000/svg","path");N.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),z.appendChild(N);const Z=L.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Z.setAttributeNS(null,"fill","#FFFFFF");const H=L.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"transform","translate(8.0, 8.0)");const J=L.createNS("http://www.w3.org/2000/svg","circle");J.setAttributeNS(null,"fill","#000000"),J.setAttributeNS(null,"opacity","0.25"),J.setAttributeNS(null,"cx","5.5"),J.setAttributeNS(null,"cy","5.5"),J.setAttributeNS(null,"r","5.4999962");const re=L.createNS("http://www.w3.org/2000/svg","circle");re.setAttributeNS(null,"fill","#FFFFFF"),re.setAttributeNS(null,"cx","5.5"),re.setAttributeNS(null,"cy","5.5"),re.setAttributeNS(null,"r","5.4999962"),H.appendChild(J),H.appendChild(re),b.appendChild(k),b.appendChild(P),b.appendChild(z),b.appendChild(Z),b.appendChild(H),a.appendChild(b),a.setAttributeNS(null,"height",c*this._scale+"px"),a.setAttributeNS(null,"width",d*this._scale+"px"),this._element.appendChild(a),this._offset=u.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",a=>{a.preventDefault()}),this._element.addEventListener("mousedown",a=>{a.preventDefault()}),Zl(this._element,this._anchor,"marker"),e&&e.className)for(const a of e.className.split(" "))this._element.classList.add(a);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),L.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=u.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const d=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(38.1-13.5+d)],"bottom-right":[-d,-1*(38.1-13.5+d)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var a,c;if(!(!((a=this._map)===null||a===void 0)&&a.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const d=this._map,f=d.terrain.depthAtPoint(this._pos),b=d.terrain.getElevationForLngLatZoom(this._lngLat,d.transform.tileZoom);if(d.transform.lngLatToCameraDepth(this._lngLat,b)-f<.006)return void(this._element.style.opacity=this._opacity);const k=-this._offset.y/d.transform._pixelPerMeter,T=Math.sin(d.getPitch()*Math.PI/180)*k,P=d.terrain.depthAtPoint(new u.P(this._pos.x,this._pos.y-this._offset.y)),A=d.transform.lngLatToCameraDepth(this._lngLat,b+T)-P>.006;!((c=this._popup)===null||c===void 0)&&c.isOpen()&&A&&this._popup.remove(),this._element.style.opacity=A?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=u.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,a){return e===void 0&&a===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),a!==void 0&&(this._opacityWhenCovered=a),this._map&&this._updateOpacity(!0),this}}const Wd={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let No=0,jo=!1;const Li={maxWidth:100,unit:"metric"};function Vo(m,e,a){const c=a&&a.maxWidth||100,d=m._container.clientHeight/2,f=m.unproject([0,d]),b=m.unproject([c,d]),k=f.distanceTo(b);if(a&&a.unit==="imperial"){const T=3.2808*k;T>5280?Qe(e,c,T/5280,m._getUIString("ScaleControl.Miles")):Qe(e,c,T,m._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?Qe(e,c,k/1852,m._getUIString("ScaleControl.NauticalMiles")):k>=1e3?Qe(e,c,k/1e3,m._getUIString("ScaleControl.Kilometers")):Qe(e,c,k,m._getUIString("ScaleControl.Meters"))}function Qe(m,e,a,c){const d=function(f){const b=Math.pow(10,`${Math.floor(f)}`.length-1);let k=f/b;return k=k>=10?10:k>=5?5:k>=3?3:k>=2?2:k>=1?1:function(T){const P=Math.pow(10,Math.ceil(-Math.log(T)/Math.LN10));return Math.round(T*P)/P}(k),b*k}(a);m.style.width=e*(d/a)+"px",m.innerHTML=`${d}&nbsp;${c}`}const ct={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Hl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Kl(m){if(m){if(typeof m=="number"){const e=Math.round(Math.abs(m)/Math.SQRT2);return{center:new u.P(0,0),top:new u.P(0,m),"top-left":new u.P(e,e),"top-right":new u.P(-e,e),bottom:new u.P(0,-m),"bottom-left":new u.P(e,-e),"bottom-right":new u.P(-e,-e),left:new u.P(m,0),right:new u.P(-m,0)}}if(m instanceof u.P||Array.isArray(m)){const e=u.P.convert(m);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:u.P.convert(m.center||[0,0]),top:u.P.convert(m.top||[0,0]),"top-left":u.P.convert(m["top-left"]||[0,0]),"top-right":u.P.convert(m["top-right"]||[0,0]),bottom:u.P.convert(m.bottom||[0,0]),"bottom-left":u.P.convert(m["bottom-left"]||[0,0]),"bottom-right":u.P.convert(m["bottom-right"]||[0,0]),left:u.P.convert(m.left||[0,0]),right:u.P.convert(m.right||[0,0])}}return Kl(new u.P(0,0))}const jc=C;v.AJAXError=u.bh,v.Evented=u.E,v.LngLat=u.N,v.MercatorCoordinate=u.Z,v.Point=u.P,v.addProtocol=u.bi,v.config=u.a,v.removeProtocol=u.bj,v.AttributionControl=Ma,v.BoxZoomHandler=zn,v.CanvasSource=$n,v.CooperativeGesturesHandler=Pa,v.DoubleClickZoomHandler=Vs,v.DragPanHandler=qd,v.DragRotateHandler=Zd,v.EdgeInsets=Ta,v.FullscreenControl=class extends u.E{constructor(m={}){super(),this._onFullscreenChange=()=>{var e;let a=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=a==null?void 0:a.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)a=a.shadowRoot.fullscreenElement;a===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:u.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){L.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const m=this._fullscreenButton=L.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);L.create("span","maplibregl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new u.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new u.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},v.GeoJSONSource=xo,v.GeolocateControl=class extends u.E{constructor(m){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new u.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new u.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const a=new u.N(e.coords.longitude,e.coords.latitude),c=e.coords.accuracy,d=this._map.getBearing(),f=u.e({bearing:d},this.options.fitBoundsOptions),b=we.fromLngLat(a,c);this._map.fitBounds(b,f,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const a=new u.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&jo)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new u.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=L.create("button","maplibregl-ctrl-geolocate",this._container),L.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){u.w("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=L.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Gl({element:this._dotElement}),this._circleElement=L.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Gl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||a.originalEvent&&a.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new u.k("trackuserlocationend")),this.fire(new u.k("userlocationlostfocus")))})}},this.options=u.e({},Wd,m)}onAdd(m){return this._map=m,this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return u._(this,arguments,void 0,function*(e=!1){if(Dn!==void 0&&!e)return Dn;if(window.navigator.permissions===void 0)return Dn=!!window.navigator.geolocation,Dn;try{Dn=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Dn=!!window.navigator.geolocation}return Dn})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),L.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,No=0,jo=!1}_isOutOfMapMaxBounds(m){const e=this._map.getMaxBounds(),a=m.coords;return e&&(a.longitude<e.getWest()||a.longitude>e.getEast()||a.latitude<e.getSouth()||a.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const m=this._map.getBounds(),e=m.getSouthEast(),a=m.getNorthEast(),c=e.distanceTo(a),d=Math.ceil(this._accuracy/(c/this._map._container.clientHeight)*2);this._circleElement.style.width=`${d}px`,this._circleElement.style.height=`${d}px`}trigger(){if(!this._setup)return u.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new u.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":No--,jo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new u.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new u.k("trackuserlocationstart")),this.fire(new u.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),No++,No>1?(m={maximumAge:6e5,timeout:0},jo=!0):(m=this.options.positionOptions,jo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},v.Hash=Bl,v.ImageSource=Zi,v.KeyboardHandler=Gn,v.LngLatBounds=we,v.LogoControl=Rc,v.Map=class extends Gd{constructor(m){u.bf.mark(u.bg.create);const e=Object.assign(Object.assign({},zm),m);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Ia(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Ct,this._controls=[],this._mapId=u.a4(),this._contextLost=a=>{a.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new u.k("webglcontextlost",{originalEvent:a}))},this._contextRestored=a=>{this._setupPainter(),this.resize(),this._update(),this.fire(new u.k("webglcontextrestored",{originalEvent:a}))},this._onMapScroll=a=>{if(a.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer===!0,this._antialias=e.antialias===!0,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles===!0,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions===!0,this._collectResourceTiming=e.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Oc),e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=ee.addThrottleControl(()=>this.isMoving()),this._requestManager=new _e(e.transformRequest),typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let a=!1;const c=Do(d=>{this._trackResize&&!this._removed&&(this.resize(d),this.redraw())},50);this._resizeObserver=new ResizeObserver(d=>{a?c(d):a=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Lc(this,e),this._hash=e.hash&&new Bl(typeof e.hash=="string"&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,u.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new Ma(typeof e.attributionControl=="boolean"?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new Rc,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",a=>{this._update(a.dataType==="style"),this.fire(new u.k(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new u.k(`${a.dataType}dataloading`,a))}),this.on("dataabort",a=>{this.fire(new u.k("sourcedataabort",a))})}_getMapId(){return this._mapId}addControl(m,e){if(e===void 0&&(e=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new u.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=m.onAdd(this);this._controls.push(m);const c=this._controlPositions[e];return e.indexOf("bottom")!==-1?c.insertBefore(a,c.firstChild):c.appendChild(a),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new u.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(m);return e>-1&&this._controls.splice(e,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}calculateCameraOptionsFromTo(m,e,a,c){return c==null&&this.terrain&&(c=this.terrain.getElevationForLngLatZoom(a,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(m,e,a,c)}resize(m){var e;const a=this._containerDimensions(),c=a[0],d=a[1],f=this._getClampedPixelRatio(c,d);if(this._resizeCanvas(c,d,f),this.painter.resize(c,d,f),this.painter.overLimit()){const k=this.painter.context.gl;this._maxCanvasSize=[k.drawingBufferWidth,k.drawingBufferHeight];const T=this._getClampedPixelRatio(c,d);this._resizeCanvas(c,d,T),this.painter.resize(c,d,T)}this.transform.resize(c,d),(e=this._requestedCameraState)===null||e===void 0||e.resize(c,d);const b=!this._moving;return b&&(this.stop(),this.fire(new u.k("movestart",m)).fire(new u.k("move",m))),this.fire(new u.k("resize",m)),b&&this.fire(new u.k("moveend",m)),this}_getClampedPixelRatio(m,e){const{0:a,1:c}=this._maxCanvasSize,d=this.getPixelRatio(),f=m*d,b=e*d;return Math.min(f>a?a/f:1,b>c?c/b:1)*d}getPixelRatio(){var m;return(m=this._overridePixelRatio)!==null&&m!==void 0?m:devicePixelRatio}setPixelRatio(m){this._overridePixelRatio=m,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(we.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this._update()}project(m){return this.transform.locationPoint(u.N.convert(m),this.style&&this.terrain)}unproject(m){return this.transform.pointLocation(u.P.convert(m),this.terrain)}isMoving(){var m;return this._moving||((m=this.handlers)===null||m===void 0?void 0:m.isMoving())}isZooming(){var m;return this._zooming||((m=this.handlers)===null||m===void 0?void 0:m.isZooming())}isRotating(){var m;return this._rotating||((m=this.handlers)===null||m===void 0?void 0:m.isRotating())}_createDelegatedListener(m,e,a){if(m==="mouseenter"||m==="mouseover"){let c=!1;return{layers:e,listener:a,delegates:{mousemove:f=>{const b=e.filter(T=>this.getLayer(T)),k=b.length!==0?this.queryRenderedFeatures(f.point,{layers:b}):[];k.length?c||(c=!0,a.call(this,new Gr(m,this,f.originalEvent,{features:k}))):c=!1},mouseout:()=>{c=!1}}}}if(m==="mouseleave"||m==="mouseout"){let c=!1;return{layers:e,listener:a,delegates:{mousemove:b=>{const k=e.filter(T=>this.getLayer(T));(k.length!==0?this.queryRenderedFeatures(b.point,{layers:k}):[]).length?c=!0:c&&(c=!1,a.call(this,new Gr(m,this,b.originalEvent)))},mouseout:b=>{c&&(c=!1,a.call(this,new Gr(m,this,b.originalEvent)))}}}}{const c=d=>{const f=e.filter(k=>this.getLayer(k)),b=f.length!==0?this.queryRenderedFeatures(d.point,{layers:f}):[];b.length&&(d.features=b,a.call(this,d),delete d.features)};return{layers:e,listener:a,delegates:{[m]:c}}}}_saveDelegatedListener(m,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(e)}_removeDelegatedListener(m,e,a){if(!this._delegatedListeners||!this._delegatedListeners[m])return;const c=this._delegatedListeners[m];for(let d=0;d<c.length;d++){const f=c[d];if(f.listener===a&&f.layers.length===e.length&&f.layers.every(b=>e.includes(b))){for(const b in f.delegates)this.off(b,f.delegates[b]);return void c.splice(d,1)}}}on(m,e,a){if(a===void 0)return super.on(m,e);const c=this._createDelegatedListener(m,typeof e=="string"?[e]:e,a);this._saveDelegatedListener(m,c);for(const d in c.delegates)this.on(d,c.delegates[d]);return this}once(m,e,a){if(a===void 0)return super.once(m,e);const c=typeof e=="string"?[e]:e,d=this._createDelegatedListener(m,c,a);for(const f in d.delegates){const b=d.delegates[f];d.delegates[f]=(...k)=>{this._removeDelegatedListener(m,c,a),b(...k)}}this._saveDelegatedListener(m,d);for(const f in d.delegates)this.once(f,d.delegates[f]);return this}off(m,e,a){return a===void 0?super.off(m,e):(this._removeDelegatedListener(m,typeof e=="string"?[e]:e,a),this)}queryRenderedFeatures(m,e){if(!this.style)return[];let a;const c=m instanceof u.P||Array.isArray(m),d=c?m:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(c?{}:m)||{},d instanceof u.P||typeof d[0]=="number")a=[u.P.convert(d)];else{const f=u.P.convert(d[0]),b=u.P.convert(d[1]);a=[f,new u.P(b.x,f.y),b,new u.P(f.x,b.y),f]}return this.style.queryRenderedFeatures(a,e,this.transform)}querySourceFeatures(m,e){return this.style.querySourceFeatures(m,e)}setStyle(m,e){return(e=u.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(m,e))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const e=this._locale[m];if(e==null)throw new Error(`Missing UI string '${m}'`);return e}_updateStyle(m,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(m,e));const a=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!m)),m?(this.style=new vl(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m,e,a):this.style.loadJSON(m,e,a),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new vl(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,e){if(typeof m=="string"){const a=this._requestManager.transformRequest(m,"Style");u.h(a,new AbortController).then(c=>{this._updateDiff(c.data,e)}).catch(c=>{c&&this.fire(new u.j(c))})}else typeof m=="object"&&this._updateDiff(m,e)}_updateDiff(m,e){try{this.style.setState(m,e)&&this._update(!0)}catch(a){u.w(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(m,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():u.w("There is no style added to the map.")}addSource(m,e){return this._lazyInitEmptyStyle(),this.style.addSource(m,e),this._update(!0)}isSourceLoaded(m){const e=this.style&&this.style.sourceCaches[m];if(e!==void 0)return e.loaded();this.fire(new u.j(new Error(`There is no source with ID '${m}'`)))}setTerrain(m){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),m){const e=this.style.sourceCaches[m.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${m.source}`);this.terrain===null&&e.reload();for(const a in this.style._layers){const c=this.style._layers[a];c.type==="hillshade"&&c.source===m.source&&u.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Fc(this.painter,e,m),this.painter.renderToTexture=new Hd(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=a=>{a.dataType==="style"?this.terrain.sourceCache.freeRtt():a.dataType==="source"&&a.tile&&(a.sourceId!==m.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(a.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new u.k("terrain",{terrain:m})),this}getTerrain(){var m,e;return(e=(m=this.terrain)===null||m===void 0?void 0:m.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const m=this.style&&this.style.sourceCaches;for(const e in m){const a=m[e]._tiles;for(const c in a){const d=a[c];if(d.state!=="loaded"&&d.state!=="errored")return!1}}return!0}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,e,a={}){const{pixelRatio:c=1,sdf:d=!1,stretchX:f,stretchY:b,content:k,textFitWidth:T,textFitHeight:P}=a;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||u.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new u.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:A,height:z,data:N}=e,Z=e;return this.style.addImage(m,{data:new u.R({width:A,height:z},new Uint8Array(N)),pixelRatio:c,stretchX:f,stretchY:b,content:k,textFitWidth:T,textFitHeight:P,sdf:d,version:0,userImage:Z}),Z.onAdd&&Z.onAdd(this,m),this}}{const{width:A,height:z,data:N}=j.getImageData(e);this.style.addImage(m,{data:new u.R({width:A,height:z},N),pixelRatio:c,stretchX:f,stretchY:b,content:k,textFitWidth:T,textFitHeight:P,sdf:d,version:0})}}updateImage(m,e){const a=this.style.getImage(m);if(!a)return this.fire(new u.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const c=e instanceof HTMLImageElement||u.b(e)?j.getImageData(e):e,{width:d,height:f,data:b}=c;if(d===void 0||f===void 0)return this.fire(new u.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(d!==a.data.width||f!==a.data.height)return this.fire(new u.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const k=!(e instanceof HTMLImageElement||u.b(e));return a.data.replace(b,k),this.style.updateImage(m,a),this}getImage(m){return this.style.getImage(m)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new u.j(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m){return ee.getImage(this._requestManager.transformRequest(m,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(m,e){return this._lazyInitEmptyStyle(),this.style.addLayer(m,e),this._update(!0)}moveLayer(m,e){return this.style.moveLayer(m,e),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(m,e,a){return this.style.setLayerZoomRange(m,e,a),this._update(!0)}setFilter(m,e,a={}){return this.style.setFilter(m,e,a),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,e,a,c={}){return this.style.setPaintProperty(m,e,a,c),this._update(!0)}getPaintProperty(m,e){return this.style.getPaintProperty(m,e)}setLayoutProperty(m,e,a,c={}){return this.style.setLayoutProperty(m,e,a,c),this._update(!0)}getLayoutProperty(m,e){return this.style.getLayoutProperty(m,e)}setGlyphs(m,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(m,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(m,e,a={}){return this._lazyInitEmptyStyle(),this.style.addSprite(m,e,a,c=>{c||this._update(!0)}),this}removeSprite(m){return this._lazyInitEmptyStyle(),this.style.removeSprite(m),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(m,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(m,e,a=>{a||this._update(!0)}),this}setLight(m,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(m){return this._lazyInitEmptyStyle(),this.style.setSky(m),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(m,e){return this.style.setFeatureState(m,e),this._update()}removeFeatureState(m,e){return this.style.removeFeatureState(m,e),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,e=0;return this._container&&(m=this._container.clientWidth||400,e=this._container.clientHeight||300),[m,e]}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map");const e=this._canvasContainer=L.create("div","maplibregl-canvas-container",m);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=L.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const a=this._containerDimensions(),c=this._getClampedPixelRatio(a[0],a[1]);this._resizeCanvas(a[0],a[1],c);const d=this._controlContainer=L.create("div","maplibregl-control-container",m),f=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(b=>{f[b]=L.create("div",`maplibregl-ctrl-${b} `,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,e,a){this._canvas.width=Math.floor(a*m),this._canvas.height=Math.floor(a*e),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const m={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",c=>{e={requestedAttributes:m},c&&(e.statusMessage=c.statusMessage,e.type=c.type)},{once:!0});const a=this._canvas.getContext("webgl2",m)||this._canvas.getContext("webgl",m);if(!a){const c="Failed to initialize WebGL";throw e?(e.message=c,new Error(JSON.stringify(e))):new Error(c)}this.painter=new Rl(a,this.transform),oe.testSupport(a)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){const e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let a=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const d=this.transform.zoom,f=j.now();this.style.zoomHistory.update(d,f);const b=new u.z(d,{now:f,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),k=b.crossFadingFactor();k===1&&k===this._crossFadingFactor||(a=!0,this._crossFadingFactor=k),this.style.update(b)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new u.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,u.bf.mark(u.bg.load),this.fire(new u.k("load"))),this.style&&(this.style.hasTransitions()||a)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const c=this._sourcesDirty||this._styleDirty||this._placementDirty;return c||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new u.k("idle")),!this._loaded||this._fullyLoaded||c||(this._fullyLoaded=!0,u.bf.mark(u.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var m;this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ee.removeThrottleControl(this._imageQueueHandle),(m=this._resizeObserver)===null||m===void 0||m.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),L.remove(this._canvasContainer),L.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),u.bf.clearMetrics(),this._removed=!0,this.fire(new u.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,j.frameAsync(this._frameRequest).then(m=>{u.bf.frame(m),this._frameRequest=null,this._render(m)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get version(){return Kd}getCameraTargetElevation(){return this.transform.elevation}},v.MapMouseEvent=Gr,v.MapTouchEvent=Ns,v.MapWheelEvent=Vd,v.Marker=Gl,v.NavigationControl=class{constructor(m){this._updateZoomButtons=()=>{const e=this._map.getZoom(),a=e===this._map.getMaxZoom(),c=e===this._map.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},this._rotateCompassArrow=()=>{const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,a)=>{const c=this._map._getUIString(`NavigationControl.${a}`);e.title=c,e.setAttribute("aria-label",c)},this.options=u.e({},Dm,m),this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),L.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),L.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=L.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Lm(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){L.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,e){const a=L.create("button",m,this._container);return a.type="button",a.addEventListener("click",e),a}},v.Popup=class extends u.E{constructor(m){super(),this.remove=()=>(this._content&&L.remove(this._content),this._container&&(L.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new u.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var a;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=L.create("div","maplibregl-popup",this._map.getContainer()),this._tip=L.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const k of this.options.className.split(" "))this._container.classList.add(k);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?er(this._lngLat,this._flatPos,this._map.transform):(a=this._lngLat)===null||a===void 0?void 0:a.wrap(),this._trackPointer&&!e)return;const c=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let d=this.options.anchor;const f=Kl(this.options.offset);if(!d){const k=this._container.offsetWidth,T=this._container.offsetHeight;let P;P=c.y+f.bottom.y<T?["top"]:c.y>this._map.transform.height-T?["bottom"]:[],c.x<k/2?P.push("left"):c.x>this._map.transform.width-k/2&&P.push("right"),d=P.length===0?"bottom":P.join("-")}let b=c.add(f[d]);this.options.subpixelPositioning||(b=b.round()),L.setTransform(this._container,`${za[d]} translate(${b.x}px,${b.y}px)`),Zl(this._container,d,"popup")},this._onClose=()=>{this.remove()},this.options=u.e(Object.create(ct),m)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new u.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=u.N.convert(m),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const e=document.createDocumentFragment(),a=document.createElement("body");let c;for(a.innerHTML=m;c=a.firstChild,c;)e.appendChild(c);return this.setDOMContent(e)}getMaxWidth(){var m;return(m=this._container)===null||m===void 0?void 0:m.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=L.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){return this._container&&this._container.classList.add(m),this}removeClassName(m){return this._container&&this._container.classList.remove(m),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}setSubpixelPositioning(m){this.options.subpixelPositioning=m}_createCloseButton(){this.options.closeButton&&(this._closeButton=L.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(Hl);m&&m.focus()}},v.RasterDEMTileSource=lr,v.RasterTileSource=Ft,v.ScaleControl=class{constructor(m){this._onMove=()=>{Vo(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Vo(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Li),m)}getDefaultPosition(){return"bottom-left"}onAdd(m){return this._map=m,this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){L.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},v.ScrollZoomHandler=hi,v.Style=vl,v.TerrainControl=class{constructor(m){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=m}onAdd(m){return this._map=m,this._container=L.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=L.create("button","maplibregl-ctrl-terrain",this._container),L.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){L.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},v.TwoFingersTouchPitchHandler=Oo,v.TwoFingersTouchRotateHandler=Ac,v.TwoFingersTouchZoomHandler=Cc,v.TwoFingersTouchZoomRotateHandler=Dc,v.VectorTileSource=vo,v.VideoSource=ha,v.addSourceType=(m,e)=>u._(void 0,void 0,void 0,function*(){if(bo(m))throw new Error(`A source type called "${m}" already exists.`);((a,c)=>{wo[a]=c})(m,e)}),v.clearPrewarmedResources=function(){const m=zr;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(Zr),zr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},v.getMaxParallelImageRequests=function(){return u.a.MAX_PARALLEL_IMAGE_REQUESTS},v.getRTLTextPluginStatus=function(){return Ci().getRTLTextPluginStatus()},v.getVersion=function(){return jc},v.getWorkerCount=function(){return dn.workerCount},v.getWorkerUrl=function(){return u.a.WORKER_URL},v.importScriptInWorkers=function(m){return _o().broadcast("IS",m)},v.prewarm=function(){Es().acquire(Zr)},v.setMaxParallelImageRequests=function(m){u.a.MAX_PARALLEL_IMAGE_REQUESTS=m},v.setRTLTextPlugin=function(m,e){return Ci().setRTLTextPlugin(m,e)},v.setWorkerCount=function(m){dn.workerCount=m},v.setWorkerUrl=function(m){u.a.WORKER_URL=m}});var x=o;return x})})(F2);var bP=F2.exports;const gh=qw(bP);function SP({boatPosition:r,restrictions:n,signs:o}){console.log(" MapView render:",{position:r,restrictionsCount:n.length,signsCount:o.length,restrictions:n});const h=Kt.useRef(null),g=Kt.useRef(null),x=Kt.useRef(null),v=Kt.useRef([]);return Kt.useEffect(()=>{if(!h.current)return;const u=new gh.Map({container:h.current,style:{version:8,sources:{osm:{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:" OpenStreetMap contributors"}},layers:[{id:"osm",type:"raster",source:"osm",minzoom:0,maxzoom:19}]},center:[25,60.5],zoom:8,attributionControl:!0});return u.addControl(new gh.NavigationControl,"top-right"),g.current=u,()=>{u.remove()}},[]),Kt.useEffect(()=>{if(!g.current||!r)return;const u=g.current;if(x.current)x.current.setLngLat([r.lng,r.lat]);else{const C=document.createElement("div");C.className="boat-marker",C.innerHTML="",x.current=new gh.Marker({element:C}).setLngLat([r.lng,r.lat]).addTo(u),u.flyTo({center:[r.lng,r.lat],zoom:13,duration:1e3})}if(r.heading!=null&&x.current){const C=x.current.getElement();C.style.transform=`rotate(${r.heading}deg)`}},[r]),Kt.useEffect(()=>{if(!g.current)return;const u=g.current;v.current.forEach(C=>C.remove()),v.current=[],o.forEach(C=>{const O=document.createElement("div");O.className="sign-marker";const U=document.createElement("img");U.src=C.iconUrl,U.alt=C.nimiFi||"Merkki",U.onerror=()=>{const L=C.iconKey.split("_")[0];U.src=`/icons/${L}.png`,U.onerror=()=>{U.src="/icons/merkki_default.png"}},O.appendChild(U);const j=new gh.Marker({element:O}).setLngLat(C.geometry.coordinates).setPopup(new gh.Popup({offset:25}).setHTML(`
              <div class="sign-popup">
                <strong>${C.nimiFi||C.nimiSv||"Merkki"}</strong>
                ${C.lisakilmentekstiFi?`<p>${C.lisakilmentekstiFi}</p>`:""}
                <p class="distance">${C.distance} m</p>
              </div>
            `)).addTo(u);v.current.push(j)})},[o]),Kt.useEffect(()=>{if(!g.current)return;const u=g.current;if(u.getLayer("restrictions-fill")&&u.removeLayer("restrictions-fill"),u.getLayer("restrictions-line")&&u.removeLayer("restrictions-line"),u.getSource("restrictions")&&u.removeSource("restrictions"),n.length===0)return;const C={type:"FeatureCollection",features:n.map(O=>({type:"Feature",properties:{id:O.id,isPrimary:O.isPrimary||!1,suuruusKmh:O.suuruusKmh},geometry:O.geometry}))};u.addSource("restrictions",{type:"geojson",data:C}),u.addLayer({id:"restrictions-fill",type:"fill",source:"restrictions",paint:{"fill-color":["case",["get","isPrimary"],"#ef4444","#f97316"],"fill-opacity":.3}}),u.addLayer({id:"restrictions-line",type:"line",source:"restrictions",paint:{"line-color":["case",["get","isPrimary"],"#dc2626","#ea580c"],"line-width":2}})},[n]),Ve.jsx("div",{ref:h,className:"map-container"})}function kP({restrictions:r,signs:n}){const[o,h]=Kt.useState(!1),g=r.length>0||n.length>0;return Ve.jsxs("div",{className:`bottom-sheet ${o?"expanded":""} ${g?"":"empty"}`,children:[Ve.jsxs("div",{className:"bottom-sheet-header",onClick:()=>h(!o),children:[Ve.jsx("div",{className:"drag-handle"}),Ve.jsxs("div",{className:"header-content",children:[r.length>0&&Ve.jsx("div",{className:"primary-info",children:Uw(r[0])}),r.length===0&&n.length===0&&Ve.jsx("div",{className:"no-data",children:"Ei rajoituksia tai merkkej lhistll"})]})]}),Ve.jsxs("div",{className:"bottom-sheet-content",children:[r.length>0&&Ve.jsxs("section",{className:"restrictions-section",children:[Ve.jsx("h3",{children:"Voimassa olevat rajoitukset"}),Ve.jsx("div",{className:"restrictions-list",children:r.map((x,v)=>Ve.jsxs("div",{className:`restriction-item ${x.isPrimary?"primary":""}`,children:[Ve.jsxs("div",{className:"restriction-title",children:[Uw(x),x.isPrimary&&Ve.jsx("span",{className:"badge",children:"Trkein"})]}),x.poikkeus&&Ve.jsxs("div",{className:"restriction-detail",children:[Ve.jsx("strong",{children:"Poikkeus:"})," ",x.poikkeus]}),x.lisatieto&&Ve.jsxs("div",{className:"restriction-detail",children:[Ve.jsx("strong",{children:"Listieto:"})," ",x.lisatieto]}),x.alkuPvm&&Ve.jsxs("div",{className:"restriction-meta",children:["Voimassa: ",new Date(x.alkuPvm).toLocaleDateString("fi-FI"),x.loppuPvm&&` - ${new Date(x.loppuPvm).toLocaleDateString("fi-FI")}`]})]},x.id))})]}),n.length>0&&Ve.jsxs("section",{className:"signs-section",children:[Ve.jsx("h3",{children:"Lhell olevat merkit"}),Ve.jsx("div",{className:"signs-list",children:n.map(x=>Ve.jsxs("div",{className:"sign-item",children:[Ve.jsx("div",{className:"sign-icon",children:Ve.jsx("img",{src:x.iconUrl,alt:$w(x),onError:v=>{const u=v.target,C=x.iconKey.split("_")[0];u.src.includes("_")?u.src=`/icons/${C}.png`:u.src.includes("default")||(u.src="/icons/merkki_default.png")}})}),Ve.jsxs("div",{className:"sign-info",children:[Ve.jsx("div",{className:"sign-name",children:$w(x)}),x.lisakilmentekstiFi&&Ve.jsx("div",{className:"sign-detail",children:x.lisakilmentekstiFi}),Ve.jsx("div",{className:"sign-distance",children:xP(x.distance)})]})]},x.id))})]})]})]})}function TP({filters:r,availableVlmtyyppi:n,onFilterChange:o,onClose:h}){const g=u=>{const C=new Set(r.selectedVlmtyyppi);C.has(u)?C.delete(u):C.add(u),o("selectedVlmtyyppi",C)},x=()=>{o("selectedVlmtyyppi",new Set(n))},v=()=>{o("selectedVlmtyyppi",new Set)};return Ve.jsx("div",{className:"settings-overlay",onClick:h,children:Ve.jsxs("div",{className:"settings-panel",onClick:u=>u.stopPropagation(),children:[Ve.jsxs("div",{className:"settings-header",children:[Ve.jsx("h2",{children:"Asetukset"}),Ve.jsx("button",{className:"close-btn",onClick:h,children:""})]}),Ve.jsxs("div",{className:"settings-content",children:[Ve.jsxs("section",{className:"settings-section",children:[Ve.jsx("h3",{children:"Rajoitussuodattimet"}),Ve.jsxs("div",{className:"setting-item",children:[Ve.jsxs("label",{className:"switch-label",children:[Ve.jsx("input",{type:"checkbox",checked:r.ammattiliikenne,onChange:u=>o("ammattiliikenne",u.target.checked)}),Ve.jsx("span",{className:"switch"}),Ve.jsx("span",{className:"label-text",children:"Ammattiliikenne"})]}),Ve.jsx("p",{className:"setting-description",children:'Kun pois plt, piilotetaan rajoitukset joissa poikkeus sislt "huvi"'})]}),Ve.jsxs("div",{className:"setting-item",children:[Ve.jsxs("label",{className:"switch-label",children:[Ve.jsx("input",{type:"checkbox",checked:r.vesiskootteri,onChange:u=>o("vesiskootteri",u.target.checked)}),Ve.jsx("span",{className:"switch"}),Ve.jsx("span",{className:"label-text",children:"Vesiskootteri"})]}),Ve.jsx("p",{className:"setting-description",children:"Kun pois plt, piilotetaan vesiskootteri-rajoitukset"})]})]}),Ve.jsxs("section",{className:"settings-section",children:[Ve.jsx("h3",{children:"Lheisten merkkien sde"}),Ve.jsx("div",{className:"setting-item",children:Ve.jsxs("label",{children:[Ve.jsxs("span",{className:"label-text",children:["Sde: ",r.nearbyRadius," m"]}),Ve.jsx("input",{type:"range",min:"50",max:"1000",step:"50",value:r.nearbyRadius,onChange:u=>o("nearbyRadius",parseInt(u.target.value)),className:"radius-slider"})]})})]}),Ve.jsxs("section",{className:"settings-section",children:[Ve.jsxs("div",{className:"section-header",children:[Ve.jsx("h3",{children:"Merkkityypit"}),Ve.jsxs("div",{className:"bulk-actions",children:[Ve.jsx("button",{onClick:x,className:"text-btn",children:"Valitse kaikki"}),Ve.jsx("button",{onClick:v,className:"text-btn",children:"Tyhjenn"})]})]}),Ve.jsx("p",{className:"setting-description",children:r.selectedVlmtyyppi.size===0?"Nytetn kaikki merkit":`Valittu ${r.selectedVlmtyyppi.size} tyyppi`}),Ve.jsx("div",{className:"vlmtyyppi-grid",children:n.map(u=>Ve.jsxs("label",{className:"checkbox-label",children:[Ve.jsx("input",{type:"checkbox",checked:r.selectedVlmtyyppi.has(u),onChange:()=>g(u)}),Ve.jsx("span",{className:"checkbox-custom"}),Ve.jsxs("span",{className:"label-text",children:["Tyyppi ",u]})]},u))})]})]})]})})}function IP({onUpdate:r,status:n}){const[o,h]=Kt.useState("");Kt.useEffect(()=>{g()},[n.isUpdating]);const g=async()=>{const x=await Rw("rajoitus"),v=await Rw("vesiliikenne");if(x||v){const u=new Date(x||v||"");h(u.toLocaleString("fi-FI"))}};return Ve.jsxs("div",{className:"update-button-container",children:[Ve.jsx("button",{className:"update-btn",onClick:r,disabled:n.isUpdating,children:n.isUpdating?Ve.jsxs(Ve.Fragment,{children:[Ve.jsx("span",{className:"spinner"}),"Pivitetn..."]}):Ve.jsxs(Ve.Fragment,{children:[Ve.jsx("span",{children:""}),"Pivit aineisto"]})}),n.message&&Ve.jsxs("div",{className:`update-message ${n.isUpdating?"active":""}`,children:[n.message,n.isUpdating&&n.progress>0&&Ve.jsx("div",{className:"progress-bar",children:Ve.jsx("div",{className:"progress-fill",style:{width:`${n.progress}%`}})})]}),o&&!n.isUpdating&&Ve.jsxs("div",{className:"last-update",children:["Viimeksi pivitetty: ",o]})]})}function EP(){const[r,n]=Kt.useState({isUpdating:!1,progress:0,message:""});Kt.useEffect(()=>(Ie.current||(Ie.current=new Fw(n)),()=>{var Pe;(Pe=Ie.current)==null||Pe.cleanup()}),[]);const[o,h]=Kt.useState({ammattiliikenne:!0,vesiskootteri:!0,selectedVlmtyyppi:new Set,nearbyRadius:250}),[g,x]=Kt.useState(null),[v,u]=Kt.useState([]),[C,O]=Kt.useState([]),[U,j]=Kt.useState(!1),[L,oe]=Kt.useState(!1),[de,he]=Kt.useState([]),Ie=Kt.useRef(null),K=Kt.useRef(null),G=Kt.useRef(0),ee=Kt.useRef(null);Kt.useEffect(()=>(Ie.current=new Fw(n),()=>{Ie.current&&Ie.current.cleanup()}),[]),Kt.useEffect(()=>{_e()},[]);const _e=async()=>{try{console.log("Loading data from IndexedDB...");const Pe=await wi.restriction_areas.toArray(),Ce=await wi.traffic_signs.toArray();console.log("Loaded from DB:",{areas:Pe.length,signs:Ce.length}),Pe.length>0&&Ce.length>0?(console.log("Building spatial indexes..."),Zp.buildAreaIndex(Pe),Zp.buildSignIndex(Ce),he(wP(Ce)),oe(!0),console.log("Data loaded and indexed successfully!")):console.log("No data in IndexedDB yet")}catch(Pe){console.error("Failed to load data from IndexedDB:",Pe)}},Se=async()=>{var Pe;console.log("=== UPDATE STARTED ===");try{console.log("Calling updater.updateData()..."),await((Pe=Ie.current)==null?void 0:Pe.updateData()),console.log("=== UPDATE COMPLETED SUCCESSFULLY ==="),console.log("Reloading data from IndexedDB..."),await _e(),console.log("Data reloaded!"),alert("Pivitys valmis! Ladattu "+await wi.restriction_areas.count()+" rajoitusaluetta ja "+await wi.traffic_signs.count()+" merkki.")}catch(Ce){console.error("=== UPDATE FAILED ==="),console.error("Update failed:",Ce),alert("Pivitys eponnistui: "+(Ce instanceof Error?Ce.message:"Unknown error"))}};Kt.useEffect(()=>{if(!navigator.geolocation){console.error("Geolocation not supported");return}return K.current=navigator.geolocation.watchPosition(Pe=>{const Ce={lat:Pe.coords.latitude,lng:Pe.coords.longitude,accuracy:Pe.coords.accuracy,heading:Pe.coords.heading??void 0,speed:Pe.coords.speed??void 0,timestamp:Pe.timestamp};x(Ce),ee.current=Ce,Te(Ce)},Pe=>{console.error("Geolocation error:",Pe)},{enableHighAccuracy:!0,maximumAge:1e3,timeout:1e4}),()=>{K.current!==null&&navigator.geolocation.clearWatch(K.current)}},[o,L]);const Te=Kt.useCallback(Pe=>{if(!L)return;const Ce=Date.now();if(Ce-G.current<1e3)return;if(ee.current){const vr=ee.current,Tr=Math.abs(Pe.lat-vr.lat),Nt=Math.abs(Pe.lng-vr.lng);if(Math.sqrt(Tr*Tr+Nt*Nt)*111e3<10)return}G.current=Ce;const Ye=Zp.getCandidateAreas(Pe.lng,Pe.lat,.05),Wt=gP(Ye,Pe,o);u(Wt);const Tt=Zp.getNearbySignsInRadius(Pe.lng,Pe.lat,o.nearbyRadius),bt=_P(Tt,Pe,o);O(bt.slice(0,10))},[o,L]),xe=(Pe,Ce)=>{h(rt=>({...rt,[Pe]:Ce}))};return Ve.jsxs("div",{className:"app",children:[Ve.jsx(SP,{boatPosition:g,restrictions:v,signs:C}),Ve.jsxs("div",{className:"controls",children:[Ve.jsx(IP,{onUpdate:Se,status:r}),Ve.jsx("button",{className:"settings-btn",onClick:()=>j(!U),"aria-label":"Asetukset",children:""})]}),Ve.jsx(kP,{restrictions:v,signs:C}),U&&Ve.jsx(TP,{filters:o,availableVlmtyyppi:de,onFilterChange:xe,onClose:()=>j(!1)}),r.error&&Ve.jsx("div",{className:"error-toast",children:r.error})]})}sy.createRoot(document.getElementById("root")).render(Ve.jsx(Wk.StrictMode,{children:Ve.jsx(EP,{})}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").catch(()=>{})});
